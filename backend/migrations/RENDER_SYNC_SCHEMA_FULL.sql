--
-- PostgreSQL database dump
--

\restrict bzCMb2LlePJtvACPfEvlBrY4KgeROMn3aJ6ajt7cgYcFCAfBymn6lBDo54JjAlX

-- Dumped from database version 16.10
-- Dumped by pg_dump version 16.10

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

ALTER TABLE IF EXISTS ONLY public.vendor_referrals DROP CONSTRAINT IF EXISTS vendor_referrals_referrer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_referrals DROP CONSTRAINT IF EXISTS vendor_referrals_referred_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_ratings DROP CONSTRAINT IF EXISTS vendor_ratings_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_ratings DROP CONSTRAINT IF EXISTS vendor_ratings_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_commissions DROP CONSTRAINT IF EXISTS vendor_commissions_referral_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_commissions DROP CONSTRAINT IF EXISTS vendor_commissions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vacation_scales DROP CONSTRAINT IF EXISTS vacation_scales_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vacation_requests DROP CONSTRAINT IF EXISTS vacation_requests_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vacation_requests DROP CONSTRAINT IF EXISTS vacation_requests_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vacation_requests DROP CONSTRAINT IF EXISTS vacation_requests_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.vacation_configurations DROP CONSTRAINT IF EXISTS vacation_configurations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_sector_id_fkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_salary_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_organizational_position_id_fkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_default_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_work_restrictions DROP CONSTRAINT IF EXISTS user_work_restrictions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_work_restrictions DROP CONSTRAINT IF EXISTS user_work_restrictions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_work_history DROP CONSTRAINT IF EXISTS user_work_history_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_work_history DROP CONSTRAINT IF EXISTS user_work_history_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_vaccinations DROP CONSTRAINT IF EXISTS user_vaccinations_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_vaccinations DROP CONSTRAINT IF EXISTS user_vaccinations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_union_affiliation DROP CONSTRAINT IF EXISTS user_union_affiliation_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_union_affiliation DROP CONSTRAINT IF EXISTS user_union_affiliation_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_sports_activities DROP CONSTRAINT IF EXISTS user_sports_activities_sport_catalog_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config_v2 DROP CONSTRAINT IF EXISTS user_salary_config_v2_salary_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config_v2 DROP CONSTRAINT IF EXISTS user_salary_config_v2_labor_agreement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config DROP CONSTRAINT IF EXISTS user_salary_config_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config DROP CONSTRAINT IF EXISTS user_salary_config_last_updated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config DROP CONSTRAINT IF EXISTS user_salary_config_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config DROP CONSTRAINT IF EXISTS user_salary_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_role_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_deactivated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_professional_licenses DROP CONSTRAINT IF EXISTS user_professional_licenses_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_professional_licenses DROP CONSTRAINT IF EXISTS user_professional_licenses_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_primary_physician DROP CONSTRAINT IF EXISTS user_primary_physician_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_primary_physician DROP CONSTRAINT IF EXISTS user_primary_physician_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permissions DROP CONSTRAINT IF EXISTS user_permissions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permissions DROP CONSTRAINT IF EXISTS user_permissions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permissions DROP CONSTRAINT IF EXISTS user_permissions_action_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permission_requests DROP CONSTRAINT IF EXISTS user_permission_requests_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permission_requests DROP CONSTRAINT IF EXISTS user_permission_requests_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_permission_requests DROP CONSTRAINT IF EXISTS user_permission_requests_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_template_concept_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_assignment_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_notification_preferences DROP CONSTRAINT IF EXISTS user_notification_preferences_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medications DROP CONSTRAINT IF EXISTS user_medications_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medications DROP CONSTRAINT IF EXISTS user_medications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_exams DROP CONSTRAINT IF EXISTS user_medical_exams_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_exams DROP CONSTRAINT IF EXISTS user_medical_exams_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_documents DROP CONSTRAINT IF EXISTS user_medical_documents_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_documents DROP CONSTRAINT IF EXISTS user_medical_documents_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_marital_status DROP CONSTRAINT IF EXISTS user_marital_status_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_marital_status DROP CONSTRAINT IF EXISTS user_marital_status_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_legal_issues DROP CONSTRAINT IF EXISTS user_legal_issues_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_legal_issues DROP CONSTRAINT IF EXISTS user_legal_issues_last_edited_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_legal_issues DROP CONSTRAINT IF EXISTS user_legal_issues_deleted_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_legal_issues DROP CONSTRAINT IF EXISTS user_legal_issues_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_household_members DROP CONSTRAINT IF EXISTS user_household_members_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_family_members DROP CONSTRAINT IF EXISTS user_family_members_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_family_members DROP CONSTRAINT IF EXISTS user_family_members_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_emergency_contacts DROP CONSTRAINT IF EXISTS user_emergency_contacts_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_emails DROP CONSTRAINT IF EXISTS user_emails_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_emails DROP CONSTRAINT IF EXISTS user_emails_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_education DROP CONSTRAINT IF EXISTS user_education_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_education DROP CONSTRAINT IF EXISTS user_education_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_driver_licenses DROP CONSTRAINT IF EXISTS user_driver_licenses_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_driver_licenses DROP CONSTRAINT IF EXISTS user_driver_licenses_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_documents DROP CONSTRAINT IF EXISTS user_documents_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_documents DROP CONSTRAINT IF EXISTS user_documents_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_disciplinary_actions DROP CONSTRAINT IF EXISTS user_disciplinary_actions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_disciplinary_actions DROP CONSTRAINT IF EXISTS user_disciplinary_actions_issued_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_disciplinary_actions DROP CONSTRAINT IF EXISTS user_disciplinary_actions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_contact_history DROP CONSTRAINT IF EXISTS user_contact_history_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_contact_history DROP CONSTRAINT IF EXISTS user_contact_history_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_contact_history DROP CONSTRAINT IF EXISTS user_contact_history_changed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_consents DROP CONSTRAINT IF EXISTS user_consents_consent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions_v2 DROP CONSTRAINT IF EXISTS user_chronic_conditions_v2_condition_catalog_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions DROP CONSTRAINT IF EXISTS user_chronic_conditions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions DROP CONSTRAINT IF EXISTS user_chronic_conditions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_children DROP CONSTRAINT IF EXISTS user_children_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_children DROP CONSTRAINT IF EXISTS user_children_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_task_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.user_allergies DROP CONSTRAINT IF EXISTS user_allergies_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_allergies DROP CONSTRAINT IF EXISTS user_allergies_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_activity_restrictions DROP CONSTRAINT IF EXISTS user_activity_restrictions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.user_activity_restrictions DROP CONSTRAINT IF EXISTS user_activity_restrictions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.used_tokens DROP CONSTRAINT IF EXISTS used_tokens_message_id_fkey;
ALTER TABLE IF EXISTS ONLY public.unified_notifications DROP CONSTRAINT IF EXISTS unified_notifications_parent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.unified_notifications DROP CONSTRAINT IF EXISTS unified_notifications_escalated_from_id_fkey;
ALTER TABLE IF EXISTS ONLY public.unified_notifications DROP CONSTRAINT IF EXISTS unified_notifications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.unauthorized_access_attempts DROP CONSTRAINT IF EXISTS unauthorized_access_attempts_kiosk_id_fkey;
ALTER TABLE IF EXISTS ONLY public.unauthorized_access_attempts DROP CONSTRAINT IF EXISTS unauthorized_access_attempts_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.trainings DROP CONSTRAINT IF EXISTS trainings_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.trainings DROP CONSTRAINT IF EXISTS trainings_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.training_assignments DROP CONSTRAINT IF EXISTS training_assignments_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.training_assignments DROP CONSTRAINT IF EXISTS training_assignments_training_id_fkey;
ALTER TABLE IF EXISTS ONLY public.training_assignments DROP CONSTRAINT IF EXISTS training_assignments_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.test_executions DROP CONSTRAINT IF EXISTS test_executions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.tax_rates DROP CONSTRAINT IF EXISTS tax_rates_tax_concept_id_fkey;
ALTER TABLE IF EXISTS ONLY public.tax_conditions DROP CONSTRAINT IF EXISTS tax_conditions_tax_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.tax_concepts DROP CONSTRAINT IF EXISTS tax_concepts_tax_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.task_compatibility DROP CONSTRAINT IF EXISTS task_compatibility_primary_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.task_compatibility DROP CONSTRAINT IF EXISTS task_compatibility_cover_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.task_compatibility DROP CONSTRAINT IF EXISTS task_compatibility_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.suspension_blocks DROP CONSTRAINT IF EXISTS suspension_blocks_sanction_id_fkey;
ALTER TABLE IF EXISTS ONLY public.suspension_blocks DROP CONSTRAINT IF EXISTS suspension_blocks_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.suspension_blocks DROP CONSTRAINT IF EXISTS suspension_blocks_deactivated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.suspension_blocks DROP CONSTRAINT IF EXISTS suspension_blocks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_supervisors DROP CONSTRAINT IF EXISTS support_vendor_supervisors_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_supervisors DROP CONSTRAINT IF EXISTS support_vendor_supervisors_supervisor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_supervisors DROP CONSTRAINT IF EXISTS support_vendor_supervisors_assigned_by_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_stats DROP CONSTRAINT IF EXISTS support_vendor_stats_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_temp_support_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_escalated_to_supervisor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_created_by_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_closed_by_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_assigned_to_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_assigned_staff_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_messages DROP CONSTRAINT IF EXISTS support_ticket_messages_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_messages DROP CONSTRAINT IF EXISTS support_ticket_messages_ticket_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_escalations DROP CONSTRAINT IF EXISTS support_ticket_escalations_to_staff_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_escalations DROP CONSTRAINT IF EXISTS support_ticket_escalations_ticket_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_escalations DROP CONSTRAINT IF EXISTS support_ticket_escalations_from_staff_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_escalations DROP CONSTRAINT IF EXISTS support_escalations_ticket_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_escalations DROP CONSTRAINT IF EXISTS support_escalations_escalated_to_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_escalations DROP CONSTRAINT IF EXISTS support_escalations_escalated_from_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_assistant_attempts DROP CONSTRAINT IF EXISTS support_assistant_attempts_ticket_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_activity_log DROP CONSTRAINT IF EXISTS support_activity_log_ticket_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_activity_log DROP CONSTRAINT IF EXISTS support_activity_log_support_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.support_activity_log DROP CONSTRAINT IF EXISTS support_activity_log_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_tipos_comprobantes DROP CONSTRAINT IF EXISTS siac_tipos_comprobantes_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_stock_movimientos DROP CONSTRAINT IF EXISTS siac_stock_movimientos_producto_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_sesiones_caja DROP CONSTRAINT IF EXISTS siac_sesiones_caja_caja_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_puntos_venta DROP CONSTRAINT IF EXISTS siac_puntos_venta_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_precios DROP CONSTRAINT IF EXISTS siac_productos_precios_producto_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_precios DROP CONSTRAINT IF EXISTS siac_productos_precios_lista_precios_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos DROP CONSTRAINT IF EXISTS siac_productos_marca_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_componentes DROP CONSTRAINT IF EXISTS siac_productos_componentes_producto_padre_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_componentes DROP CONSTRAINT IF EXISTS siac_productos_componentes_producto_componente_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_categorias DROP CONSTRAINT IF EXISTS siac_productos_categorias_categoria_padre_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos DROP CONSTRAINT IF EXISTS siac_productos_categoria_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_numeracion_comprobantes DROP CONSTRAINT IF EXISTS siac_numeracion_comprobantes_tipo_comprobante_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_numeracion_comprobantes DROP CONSTRAINT IF EXISTS siac_numeracion_comprobantes_caja_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS siac_facturas_tipo_comprobante_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_pagos DROP CONSTRAINT IF EXISTS siac_facturas_pagos_factura_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_items DROP CONSTRAINT IF EXISTS siac_facturas_items_factura_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_impuestos DROP CONSTRAINT IF EXISTS siac_facturas_impuestos_factura_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS siac_facturas_caja_id_fkey;
ALTER TABLE IF EXISTS ONLY public.siac_cajas DROP CONSTRAINT IF EXISTS siac_cajas_punto_venta_id_fkey;
ALTER TABLE IF EXISTS ONLY public.shifts DROP CONSTRAINT IF EXISTS shifts_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.shifts DROP CONSTRAINT IF EXISTS shifts_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sectors DROP CONSTRAINT IF EXISTS sectors_supervisor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sectors DROP CONSTRAINT IF EXISTS sectors_department_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sectors DROP CONSTRAINT IF EXISTS sectors_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_sanction_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_requester_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_rejected_by_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_lawyer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_hr_confirmation_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_appeal_resolved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.sanction_types DROP CONSTRAINT IF EXISTS sanction_types_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanction_history DROP CONSTRAINT IF EXISTS sanction_history_sanction_id_fkey;
ALTER TABLE IF EXISTS ONLY public.sanction_history DROP CONSTRAINT IF EXISTS sanction_history_actor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.salary_categories_v2 DROP CONSTRAINT IF EXISTS salary_categories_v2_labor_agreement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.salary_categories_v2 DROP CONSTRAINT IF EXISTS salary_categories_v2_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.salary_categories DROP CONSTRAINT IF EXISTS salary_categories_labor_agreement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.role_template_permissions DROP CONSTRAINT IF EXISTS role_template_permissions_action_id_fkey;
ALTER TABLE IF EXISTS ONLY public.role_definitions DROP CONSTRAINT IF EXISTS role_definitions_inherits_from_fkey;
ALTER TABLE IF EXISTS ONLY public.role_definitions DROP CONSTRAINT IF EXISTS role_definitions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.report_access_log DROP CONSTRAINT IF EXISTS report_access_log_report_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_reviewed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_published_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_parent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_draft_locked_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_versions DROP CONSTRAINT IF EXISTS procedure_versions_published_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_versions DROP CONSTRAINT IF EXISTS procedure_versions_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_versions DROP CONSTRAINT IF EXISTS procedure_versions_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_roles DROP CONSTRAINT IF EXISTS procedure_roles_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_roles DROP CONSTRAINT IF EXISTS procedure_roles_organizational_position_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_draft_locks DROP CONSTRAINT IF EXISTS procedure_draft_locks_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_draft_locks DROP CONSTRAINT IF EXISTS procedure_draft_locks_locked_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_comments DROP CONSTRAINT IF EXISTS procedure_comments_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_comments DROP CONSTRAINT IF EXISTS procedure_comments_resolved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_comments DROP CONSTRAINT IF EXISTS procedure_comments_procedure_version_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_comments DROP CONSTRAINT IF EXISTS procedure_comments_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_attachments DROP CONSTRAINT IF EXISTS procedure_attachments_uploaded_by_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_attachments DROP CONSTRAINT IF EXISTS procedure_attachments_procedure_version_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_attachments DROP CONSTRAINT IF EXISTS procedure_attachments_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_acknowledgements DROP CONSTRAINT IF EXISTS procedure_acknowledgements_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_acknowledgements DROP CONSTRAINT IF EXISTS procedure_acknowledgements_procedure_version_id_fkey;
ALTER TABLE IF EXISTS ONLY public.procedure_acknowledgements DROP CONSTRAINT IF EXISTS procedure_acknowledgements_procedure_id_fkey;
ALTER TABLE IF EXISTS ONLY public.proactive_executions DROP CONSTRAINT IF EXISTS proactive_executions_rule_id_fkey;
ALTER TABLE IF EXISTS ONLY public.permissions DROP CONSTRAINT IF EXISTS "permissions_UserId_fkey";
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_parent_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_labor_agreement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_template_concepts DROP CONSTRAINT IF EXISTS payroll_template_concepts_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_template_concepts DROP CONSTRAINT IF EXISTS payroll_template_concepts_entity_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_template_concepts DROP CONSTRAINT IF EXISTS payroll_template_concepts_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_details DROP CONSTRAINT IF EXISTS payroll_run_details_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_details DROP CONSTRAINT IF EXISTS payroll_run_details_run_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_details DROP CONSTRAINT IF EXISTS payroll_run_details_assignment_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_concept_details DROP CONSTRAINT IF EXISTS payroll_run_concept_details_template_concept_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_concept_details DROP CONSTRAINT IF EXISTS payroll_run_concept_details_run_detail_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_concept_details DROP CONSTRAINT IF EXISTS payroll_run_concept_details_entity_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_concept_details DROP CONSTRAINT IF EXISTS payroll_run_concept_details_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_templates DROP CONSTRAINT IF EXISTS payroll_payslip_templates_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_templates DROP CONSTRAINT IF EXISTS payroll_payslip_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_run_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_reviewed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_generated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_entity_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlement_details DROP CONSTRAINT IF EXISTS payroll_entity_settlement_details_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlement_details DROP CONSTRAINT IF EXISTS payroll_entity_settlement_details_settlement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlement_details DROP CONSTRAINT IF EXISTS payroll_entity_settlement_details_run_detail_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_categories DROP CONSTRAINT IF EXISTS payroll_entity_categories_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_categories DROP CONSTRAINT IF EXISTS payroll_entity_categories_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entities DROP CONSTRAINT IF EXISTS payroll_entities_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entities DROP CONSTRAINT IF EXISTS payroll_entities_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entities DROP CONSTRAINT IF EXISTS payroll_entities_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_types DROP CONSTRAINT IF EXISTS payroll_concept_types_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_types DROP CONSTRAINT IF EXISTS payroll_concept_types_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_types DROP CONSTRAINT IF EXISTS payroll_concept_types_classification_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_type_rates DROP CONSTRAINT IF EXISTS payroll_concept_type_rates_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_type_rates DROP CONSTRAINT IF EXISTS payroll_concept_type_rates_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payments DROP CONSTRAINT IF EXISTS payments_invoice_id_fkey;
ALTER TABLE IF EXISTS ONLY public.payments DROP CONSTRAINT IF EXISTS payments_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.password_auth_attempts DROP CONSTRAINT IF EXISTS password_auth_attempts_kiosk_id_fkey;
ALTER TABLE IF EXISTS ONLY public.password_auth_attempts DROP CONSTRAINT IF EXISTS password_auth_attempts_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.partner_commissions DROP CONSTRAINT IF EXISTS partner_commissions_partner_id_fkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_transactions DROP CONSTRAINT IF EXISTS partner_commission_transactions_partner_id_fkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_transactions DROP CONSTRAINT IF EXISTS partner_commission_transactions_partner_commission_id_fkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_transactions DROP CONSTRAINT IF EXISTS partner_commission_transactions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_summaries DROP CONSTRAINT IF EXISTS partner_commission_summaries_partner_id_fkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_salary_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_payslip_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_payroll_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_parent_position_id_fkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_workers_compensation_claims DROP CONSTRAINT IF EXISTS oh_workers_compensation_claims_claim_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_results DROP CONSTRAINT IF EXISTS oh_screening_results_screening_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_results DROP CONSTRAINT IF EXISTS oh_screening_results_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_documents DROP CONSTRAINT IF EXISTS oh_screening_documents_screening_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_documents DROP CONSTRAINT IF EXISTS oh_screening_documents_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_config DROP CONSTRAINT IF EXISTS oh_screening_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_pre_employment_screenings DROP CONSTRAINT IF EXISTS oh_pre_employment_screenings_screening_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_pre_employment_screenings DROP CONSTRAINT IF EXISTS oh_pre_employment_screenings_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_employee_certifications DROP CONSTRAINT IF EXISTS oh_employee_certifications_renewed_by_certification_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_employee_certifications DROP CONSTRAINT IF EXISTS oh_employee_certifications_is_renewal_of_certification_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_employee_certifications DROP CONSTRAINT IF EXISTS oh_employee_certifications_certification_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_claim_status_history DROP CONSTRAINT IF EXISTS oh_claim_status_history_claim_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_claim_documents DROP CONSTRAINT IF EXISTS oh_claim_documents_claim_id_fkey;
ALTER TABLE IF EXISTS ONLY public.oh_certification_alerts DROP CONSTRAINT IF EXISTS oh_certification_alerts_certification_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notifications DROP CONSTRAINT IF EXISTS notifications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_workflows DROP CONSTRAINT IF EXISTS notification_workflows_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_threads DROP CONSTRAINT IF EXISTS notification_threads_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_templates DROP CONSTRAINT IF EXISTS notification_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_sla_records DROP CONSTRAINT IF EXISTS notification_sla_records_message_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_messages DROP CONSTRAINT IF EXISTS notification_messages_group_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_flow_templates DROP CONSTRAINT IF EXISTS notification_flow_templates_request_type_code_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_escalations DROP CONSTRAINT IF EXISTS notification_escalations_message_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_context_data DROP CONSTRAINT IF EXISTS notification_context_data_notification_message_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_ai_learning DROP CONSTRAINT IF EXISTS notification_ai_learning_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.notification_actions_log DROP CONSTRAINT IF EXISTS notification_actions_log_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.messages DROP CONSTRAINT IF EXISTS "messages_recipientId_fkey";
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_signed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_locked_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_last_edited_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_deletion_authorized_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_deleted_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_leaves DROP CONSTRAINT IF EXISTS medical_leaves_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_leaves DROP CONSTRAINT IF EXISTS medical_leaves_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_leaves DROP CONSTRAINT IF EXISTS medical_leaves_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_exam_templates DROP CONSTRAINT IF EXISTS medical_exam_templates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_exam_templates DROP CONSTRAINT IF EXISTS medical_exam_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_edit_authorizations DROP CONSTRAINT IF EXISTS medical_edit_authorizations_requested_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_edit_authorizations DROP CONSTRAINT IF EXISTS medical_edit_authorizations_record_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_edit_authorizations DROP CONSTRAINT IF EXISTS medical_edit_authorizations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_edit_authorizations DROP CONSTRAINT IF EXISTS medical_edit_authorizations_authorized_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_communications DROP CONSTRAINT IF EXISTS medical_communications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_last_modified_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_auditor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_edit_authorizations DROP CONSTRAINT IF EXISTS legal_edit_authorizations_requested_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_edit_authorizations DROP CONSTRAINT IF EXISTS legal_edit_authorizations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_edit_authorizations DROP CONSTRAINT IF EXISTS legal_edit_authorizations_authorized_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_document_alerts DROP CONSTRAINT IF EXISTS legal_document_alerts_resolved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_document_alerts DROP CONSTRAINT IF EXISTS legal_document_alerts_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_document_alerts DROP CONSTRAINT IF EXISTS legal_document_alerts_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_document_alerts DROP CONSTRAINT IF EXISTS legal_document_alerts_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_stage_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_completed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_assigned_to_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_last_edited_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_deleted_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_defendant_lawyer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_assigned_to_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_timeline_events DROP CONSTRAINT IF EXISTS legal_case_timeline_events_stage_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_timeline_events DROP CONSTRAINT IF EXISTS legal_case_timeline_events_related_event_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_timeline_events DROP CONSTRAINT IF EXISTS legal_case_timeline_events_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_timeline_events DROP CONSTRAINT IF EXISTS legal_case_timeline_events_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_stages DROP CONSTRAINT IF EXISTS legal_case_stages_recorded_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_stages DROP CONSTRAINT IF EXISTS legal_case_stages_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_parties DROP CONSTRAINT IF EXISTS legal_case_parties_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_parties DROP CONSTRAINT IF EXISTS legal_case_parties_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_uploaded_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_timeline_event_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_stage_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_response_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_reviewed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_related_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_related_deadline_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_case_id_fkey;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_shift_id_fkey;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_requested_authorizer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_actual_authorizer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.labor_agreements_v2 DROP CONSTRAINT IF EXISTS labor_agreements_v2_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.labor_agreements_v2 DROP CONSTRAINT IF EXISTS labor_agreements_v2_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.kiosks DROP CONSTRAINT IF EXISTS kiosks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_recruiter_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_hiring_manager_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_department_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_reviewed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_rejected_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_referrer_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_medical_record_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_medical_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_job_posting_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_interviewer_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_hired_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_employee_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_assigned_department_id_fkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_admin_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_application_notes DROP CONSTRAINT IF EXISTS job_application_notes_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.job_application_notes DROP CONSTRAINT IF EXISTS job_application_notes_application_id_fkey;
ALTER TABLE IF EXISTS ONLY public.invoices DROP CONSTRAINT IF EXISTS invoices_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hse_ppe_detections DROP CONSTRAINT IF EXISTS hse_ppe_detections_zone_config_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hse_company_config DROP CONSTRAINT IF EXISTS hse_company_config_hse_manager_role_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hse_company_config DROP CONSTRAINT IF EXISTS hse_company_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_templates DROP CONSTRAINT IF EXISTS hour_bank_templates_parent_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_templates DROP CONSTRAINT IF EXISTS hour_bank_templates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_templates DROP CONSTRAINT IF EXISTS hour_bank_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_templates DROP CONSTRAINT IF EXISTS hour_bank_templates_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_scheduled_redemptions DROP CONSTRAINT IF EXISTS hour_bank_scheduled_redemptions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_scheduled_redemptions DROP CONSTRAINT IF EXISTS hour_bank_scheduled_redemptions_shift_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_scheduled_redemptions DROP CONSTRAINT IF EXISTS hour_bank_scheduled_redemptions_request_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_scheduled_redemptions DROP CONSTRAINT IF EXISTS hour_bank_scheduled_redemptions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_risk_analysis DROP CONSTRAINT IF EXISTS hour_bank_risk_analysis_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_transaction_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_supervisor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_hr_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_transaction_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_supervisor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_hr_approver_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_history DROP CONSTRAINT IF EXISTS hour_bank_redemption_history_request_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_history DROP CONSTRAINT IF EXISTS hour_bank_redemption_history_changed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_pending_decisions DROP CONSTRAINT IF EXISTS hour_bank_pending_decisions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_pending_decisions DROP CONSTRAINT IF EXISTS hour_bank_pending_decisions_transaction_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_pending_decisions DROP CONSTRAINT IF EXISTS hour_bank_pending_decisions_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_metrics_aggregated DROP CONSTRAINT IF EXISTS hour_bank_metrics_aggregated_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_loans DROP CONSTRAINT IF EXISTS hour_bank_loans_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_loans DROP CONSTRAINT IF EXISTS hour_bank_loans_redemption_request_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_loans DROP CONSTRAINT IF EXISTS hour_bank_loans_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_budgets DROP CONSTRAINT IF EXISTS hour_bank_budgets_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_budgets DROP CONSTRAINT IF EXISTS hour_bank_budgets_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_blackout_dates DROP CONSTRAINT IF EXISTS hour_bank_blackout_dates_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_blackout_dates DROP CONSTRAINT IF EXISTS hour_bank_blackout_dates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_blackout_dates DROP CONSTRAINT IF EXISTS hour_bank_blackout_dates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_blackout_dates DROP CONSTRAINT IF EXISTS hour_bank_blackout_dates_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_agreements DROP CONSTRAINT IF EXISTS hour_bank_agreements_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_agreements DROP CONSTRAINT IF EXISTS hour_bank_agreements_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_agreements DROP CONSTRAINT IF EXISTS hour_bank_agreements_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.vendor_commissions DROP CONSTRAINT IF EXISTS fk_vendor_commissions_vendor_staff;
ALTER TABLE IF EXISTS ONLY public.vendor_commissions DROP CONSTRAINT IF EXISTS fk_vendor_commissions_original_vendor_staff;
ALTER TABLE IF EXISTS ONLY public.user_shifts DROP CONSTRAINT IF EXISTS fk_user_shifts_user;
ALTER TABLE IF EXISTS ONLY public.user_shifts DROP CONSTRAINT IF EXISTS fk_user_shifts_shift;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS fk_user_shift_user;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS fk_user_shift_shift;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS fk_user_shift_deactivated_by;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS fk_user_shift_company;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS fk_user_shift_assigned_by;
ALTER TABLE IF EXISTS ONLY public.user_surgeries DROP CONSTRAINT IF EXISTS fk_surgeries_user;
ALTER TABLE IF EXISTS ONLY public.user_sports_activities DROP CONSTRAINT IF EXISTS fk_sports_user;
ALTER TABLE IF EXISTS ONLY public.siac_presupuestos DROP CONSTRAINT IF EXISTS fk_siac_presupuestos_company;
ALTER TABLE IF EXISTS ONLY public.siac_presupuestos DROP CONSTRAINT IF EXISTS fk_siac_presupuestos_cliente;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS fk_siac_facturas_presupuesto;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS fk_siac_facturas_company;
ALTER TABLE IF EXISTS ONLY public.scoring_history DROP CONSTRAINT IF EXISTS fk_scoring_history_user;
ALTER TABLE IF EXISTS ONLY public.scoring_history DROP CONSTRAINT IF EXISTS fk_scoring_history_company;
ALTER TABLE IF EXISTS ONLY public.user_salary_config_v2 DROP CONSTRAINT IF EXISTS fk_salary_v2_user;
ALTER TABLE IF EXISTS ONLY public.user_psychiatric_treatments DROP CONSTRAINT IF EXISTS fk_psychiatric_user;
ALTER TABLE IF EXISTS ONLY public.user_payroll_records DROP CONSTRAINT IF EXISTS fk_payroll_user;
ALTER TABLE IF EXISTS ONLY public.medical_communications DROP CONSTRAINT IF EXISTS fk_medical_comm_absence_case;
ALTER TABLE IF EXISTS ONLY public.consent_legal_documents DROP CONSTRAINT IF EXISTS fk_legal_doc_creator;
ALTER TABLE IF EXISTS ONLY public.consent_legal_documents DROP CONSTRAINT IF EXISTS fk_legal_doc_company;
ALTER TABLE IF EXISTS ONLY public.user_healthy_habits DROP CONSTRAINT IF EXISTS fk_habits_user;
ALTER TABLE IF EXISTS ONLY public.fingerprint_biometric_data DROP CONSTRAINT IF EXISTS fk_fingerprint_user;
ALTER TABLE IF EXISTS ONLY public.fingerprint_biometric_data DROP CONSTRAINT IF EXISTS fk_fingerprint_company;
ALTER TABLE IF EXISTS ONLY public.facial_biometric_data DROP CONSTRAINT IF EXISTS fk_facial_user;
ALTER TABLE IF EXISTS ONLY public.facial_biometric_data DROP CONSTRAINT IF EXISTS fk_facial_company;
ALTER TABLE IF EXISTS ONLY public.biometric_detections DROP CONSTRAINT IF EXISTS fk_employee;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS fk_departments_company;
ALTER TABLE IF EXISTS ONLY public.comparative_analytics DROP CONSTRAINT IF EXISTS fk_comparative_analytics_company;
ALTER TABLE IF EXISTS ONLY public.company_modules DROP CONSTRAINT IF EXISTS fk_company_modules_company;
ALTER TABLE IF EXISTS ONLY public.biometric_detections DROP CONSTRAINT IF EXISTS fk_company;
ALTER TABLE IF EXISTS ONLY public.oh_claim_status_history DROP CONSTRAINT IF EXISTS fk_claim_history_claim;
ALTER TABLE IF EXISTS ONLY public.oh_claim_documents DROP CONSTRAINT IF EXISTS fk_claim_doc_claim;
ALTER TABLE IF EXISTS ONLY public.oh_workers_compensation_claims DROP CONSTRAINT IF EXISTS fk_claim_company;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions_v2 DROP CONSTRAINT IF EXISTS fk_chronic_v2_user;
ALTER TABLE IF EXISTS ONLY public.oh_employee_certifications DROP CONSTRAINT IF EXISTS fk_cert_company;
ALTER TABLE IF EXISTS ONLY public.biometric_settings DROP CONSTRAINT IF EXISTS fk_biometric_settings_company;
ALTER TABLE IF EXISTS ONLY public.biometric_events DROP CONSTRAINT IF EXISTS fk_biometric_events_user;
ALTER TABLE IF EXISTS ONLY public.biometric_events DROP CONSTRAINT IF EXISTS fk_biometric_events_company;
ALTER TABLE IF EXISTS ONLY public.attendance_profiles DROP CONSTRAINT IF EXISTS fk_attendance_profiles_user;
ALTER TABLE IF EXISTS ONLY public.attendance_profiles DROP CONSTRAINT IF EXISTS fk_attendance_profiles_company;
ALTER TABLE IF EXISTS ONLY public.attendance_patterns DROP CONSTRAINT IF EXISTS fk_attendance_patterns_user;
ALTER TABLE IF EXISTS ONLY public.attendance_patterns DROP CONSTRAINT IF EXISTS fk_attendance_patterns_company;
ALTER TABLE IF EXISTS ONLY public.user_anthropometric_data DROP CONSTRAINT IF EXISTS fk_anthropometric_user;
ALTER TABLE IF EXISTS ONLY public.attendance_analytics_cache DROP CONSTRAINT IF EXISTS fk_analytics_cache_company;
ALTER TABLE IF EXISTS ONLY public.oh_certification_alert_config DROP CONSTRAINT IF EXISTS fk_alert_config_company;
ALTER TABLE IF EXISTS ONLY public.extraordinary_licenses DROP CONSTRAINT IF EXISTS extraordinary_licenses_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_role_requirements DROP CONSTRAINT IF EXISTS epp_role_requirements_position_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_role_requirements DROP CONSTRAINT IF EXISTS epp_role_requirements_epp_catalog_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_role_requirements DROP CONSTRAINT IF EXISTS epp_role_requirements_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_inspections DROP CONSTRAINT IF EXISTS epp_inspections_delivery_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_deliveries DROP CONSTRAINT IF EXISTS epp_deliveries_requirement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_deliveries DROP CONSTRAINT IF EXISTS epp_deliveries_replaced_by_delivery_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_deliveries DROP CONSTRAINT IF EXISTS epp_deliveries_epp_catalog_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_deliveries DROP CONSTRAINT IF EXISTS epp_deliveries_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_catalog DROP CONSTRAINT IF EXISTS epp_catalog_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.epp_catalog DROP CONSTRAINT IF EXISTS epp_catalog_category_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_locations DROP CONSTRAINT IF EXISTS "employee_locations_userId_fkey";
ALTER TABLE IF EXISTS ONLY public.employee_locations DROP CONSTRAINT IF EXISTS employee_locations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_documents DROP CONSTRAINT IF EXISTS "employee_documents_userId_fkey";
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_uploaded_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_reviewed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_replaced_by_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_dependency_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_status_changed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_company_benefit_policy_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefit_documents DROP CONSTRAINT IF EXISTS employee_benefit_documents_verified_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefit_documents DROP CONSTRAINT IF EXISTS employee_benefit_documents_uploaded_by_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefit_documents DROP CONSTRAINT IF EXISTS employee_benefit_documents_requirement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefit_documents DROP CONSTRAINT IF EXISTS employee_benefit_documents_employee_benefit_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_assigned_assets DROP CONSTRAINT IF EXISTS employee_assigned_assets_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_assigned_assets DROP CONSTRAINT IF EXISTS employee_assigned_assets_employee_benefit_id_fkey;
ALTER TABLE IF EXISTS ONLY public.employee_assigned_assets DROP CONSTRAINT IF EXISTS employee_assigned_assets_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.email_templates DROP CONSTRAINT IF EXISTS email_templates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.email_templates DROP CONSTRAINT IF EXISTS email_templates_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.email_logs DROP CONSTRAINT IF EXISTS email_logs_email_config_id_fkey;
ALTER TABLE IF EXISTS ONLY public.email_configurations DROP CONSTRAINT IF EXISTS email_configurations_updated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.email_configurations DROP CONSTRAINT IF EXISTS email_configurations_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.email_configurations DROP CONSTRAINT IF EXISTS email_configurations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_tasks DROP CONSTRAINT IF EXISTS ecosystem_tasks_phase_id_fkey;
ALTER TABLE IF EXISTS ONLY public.document_categories DROP CONSTRAINT IF EXISTS document_categories_parent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_instances DROP CONSTRAINT IF EXISTS dms_workflow_instances_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_instances DROP CONSTRAINT IF EXISTS dms_workflow_instances_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_approvals DROP CONSTRAINT IF EXISTS dms_workflow_approvals_workflow_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_approvals DROP CONSTRAINT IF EXISTS dms_workflow_approvals_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_folders DROP CONSTRAINT IF EXISTS dms_folders_parent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_documents DROP CONSTRAINT IF EXISTS dms_documents_supersedes_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_documents DROP CONSTRAINT IF EXISTS dms_documents_superseded_by_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_documents DROP CONSTRAINT IF EXISTS dms_documents_parent_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_documents DROP CONSTRAINT IF EXISTS dms_documents_folder_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_versions DROP CONSTRAINT IF EXISTS dms_document_versions_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_types DROP CONSTRAINT IF EXISTS dms_document_types_category_code_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_requests DROP CONSTRAINT IF EXISTS dms_document_requests_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_permissions DROP CONSTRAINT IF EXISTS dms_document_permissions_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_metadata DROP CONSTRAINT IF EXISTS dms_document_metadata_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_alerts DROP CONSTRAINT IF EXISTS dms_document_alerts_request_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_alerts DROP CONSTRAINT IF EXISTS dms_document_alerts_document_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dependency_evaluations DROP CONSTRAINT IF EXISTS dependency_evaluations_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dependency_evaluations DROP CONSTRAINT IF EXISTS dependency_evaluations_dependency_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dependency_evaluations DROP CONSTRAINT IF EXISTS dependency_evaluations_concept_id_fkey;
ALTER TABLE IF EXISTS ONLY public.dependency_evaluations DROP CONSTRAINT IF EXISTS dependency_evaluations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_manager_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_default_kiosk_id_fkey;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.cost_transactions DROP CONSTRAINT IF EXISTS cost_transactions_notification_group_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_budget_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_templates DROP CONSTRAINT IF EXISTS contract_templates_template_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_templates DROP CONSTRAINT IF EXISTS contract_templates_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_templates DROP CONSTRAINT IF EXISTS contract_templates_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_renewal_logs DROP CONSTRAINT IF EXISTS contract_renewal_logs_contract_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_apk_licenses DROP CONSTRAINT IF EXISTS contract_apk_licenses_contract_id_fkey;
ALTER TABLE IF EXISTS ONLY public.contract_apk_licenses DROP CONSTRAINT IF EXISTS contract_apk_licenses_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.consent_audit_log DROP CONSTRAINT IF EXISTS consent_audit_log_user_consent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.concept_dependencies DROP CONSTRAINT IF EXISTS concept_dependencies_dependency_id_fkey;
ALTER TABLE IF EXISTS ONLY public.concept_dependencies DROP CONSTRAINT IF EXISTS concept_dependencies_concept_id_fkey;
ALTER TABLE IF EXISTS ONLY public.concept_dependencies DROP CONSTRAINT IF EXISTS concept_dependencies_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.compliance_violations DROP CONSTRAINT IF EXISTS compliance_violations_rule_code_fkey;
ALTER TABLE IF EXISTS ONLY public.company_tax_config DROP CONSTRAINT IF EXISTS company_tax_config_tax_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_tasks DROP CONSTRAINT IF EXISTS company_tasks_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_tasks DROP CONSTRAINT IF EXISTS company_tasks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_support_assignments DROP CONSTRAINT IF EXISTS company_support_assignments_original_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_support_assignments DROP CONSTRAINT IF EXISTS company_support_assignments_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_support_assignments DROP CONSTRAINT IF EXISTS company_support_assignments_assigned_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_support_assignments DROP CONSTRAINT IF EXISTS company_support_assignments_assigned_by_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_risk_config DROP CONSTRAINT IF EXISTS company_risk_config_updated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_risk_config DROP CONSTRAINT IF EXISTS company_risk_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_medical_staff DROP CONSTRAINT IF EXISTS company_medical_staff_partner_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_medical_staff DROP CONSTRAINT IF EXISTS company_medical_staff_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_medical_staff DROP CONSTRAINT IF EXISTS company_medical_staff_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_inbox_processed DROP CONSTRAINT IF EXISTS company_inbox_processed_linked_inbound_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_fiscal_config DROP CONSTRAINT IF EXISTS company_fiscal_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_email_config DROP CONSTRAINT IF EXISTS company_email_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_dependencies DROP CONSTRAINT IF EXISTS company_dependencies_dependency_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_dependencies DROP CONSTRAINT IF EXISTS company_dependencies_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_dependencies DROP CONSTRAINT IF EXISTS company_dependencies_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_communications DROP CONSTRAINT IF EXISTS company_communications_parent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_communications DROP CONSTRAINT IF EXISTS company_communications_from_staff_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_communications DROP CONSTRAINT IF EXISTS company_communications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_default_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_default_agreement_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_benefit_policies DROP CONSTRAINT IF EXISTS company_benefit_policies_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_benefit_policies DROP CONSTRAINT IF EXISTS company_benefit_policies_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_benefit_policies DROP CONSTRAINT IF EXISTS company_benefit_policies_benefit_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_terminated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_role_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_associate_id_fkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.company_account_notifications DROP CONSTRAINT IF EXISTS company_account_notifications_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.companies DROP CONSTRAINT IF EXISTS companies_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.companies DROP CONSTRAINT IF EXISTS companies_support_sla_plan_id_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_reconciled_by_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_liquidation_id_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_approved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.calendar_events DROP CONSTRAINT IF EXISTS calendar_events_notification_group_id_fkey;
ALTER TABLE IF EXISTS ONLY public.calendar_events DROP CONSTRAINT IF EXISTS calendar_events_calendar_integration_id_fkey;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_vendor_id_fkey;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.branches DROP CONSTRAINT IF EXISTS branches_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.branch_offices_fiscal DROP CONSTRAINT IF EXISTS branch_offices_fiscal_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_emotional_analysis DROP CONSTRAINT IF EXISTS biometric_emotional_analysis_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_emotional_analysis DROP CONSTRAINT IF EXISTS biometric_emotional_analysis_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_devices DROP CONSTRAINT IF EXISTS biometric_devices_registered_by_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_devices DROP CONSTRAINT IF EXISTS biometric_devices_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_detections DROP CONSTRAINT IF EXISTS biometric_detections_attendance_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_data DROP CONSTRAINT IF EXISTS "biometric_data_UserId_fkey";
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_previous_consent_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_country_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_branch_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_company_config DROP CONSTRAINT IF EXISTS biometric_company_config_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_ai_analysis DROP CONSTRAINT IF EXISTS biometric_ai_analysis_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.biometric_ai_analysis DROP CONSTRAINT IF EXISTS biometric_ai_analysis_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_types DROP CONSTRAINT IF EXISTS benefit_types_payroll_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_payroll_concepts DROP CONSTRAINT IF EXISTS benefit_payroll_concepts_payroll_concept_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_payroll_concepts DROP CONSTRAINT IF EXISTS benefit_payroll_concepts_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_payroll_concepts DROP CONSTRAINT IF EXISTS benefit_payroll_concepts_benefit_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_submissions DROP CONSTRAINT IF EXISTS benefit_expense_submissions_verified_by_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_submissions DROP CONSTRAINT IF EXISTS benefit_expense_submissions_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_submissions DROP CONSTRAINT IF EXISTS benefit_expense_submissions_submitted_by_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_submissions DROP CONSTRAINT IF EXISTS benefit_expense_submissions_allowance_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_allowances DROP CONSTRAINT IF EXISTS benefit_expense_allowances_employee_benefit_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_document_requirements DROP CONSTRAINT IF EXISTS benefit_document_requirements_document_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_document_requirements DROP CONSTRAINT IF EXISTS benefit_document_requirements_benefit_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_workflows DROP CONSTRAINT IF EXISTS benefit_approval_workflows_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_workflows DROP CONSTRAINT IF EXISTS benefit_approval_workflows_benefit_type_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_workflows DROP CONSTRAINT IF EXISTS benefit_approval_workflows_approver_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_history DROP CONSTRAINT IF EXISTS benefit_approval_history_workflow_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_history DROP CONSTRAINT IF EXISTS benefit_approval_history_employee_benefit_id_fkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_history DROP CONSTRAINT IF EXISTS benefit_approval_history_approver_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.audit_test_logs DROP CONSTRAINT IF EXISTS audit_test_logs_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS attendances_kiosk_id_fkey;
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS attendances_authorized_by_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS "attendances_UserId_fkey";
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS "attendances_BranchId_fkey";
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_deactivated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_contract_id_fkey;
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_knowledge_base DROP CONSTRAINT IF EXISTS assistant_knowledge_base_verified_by_admin_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_knowledge_base DROP CONSTRAINT IF EXISTS assistant_knowledge_base_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_knowledge_base DROP CONSTRAINT IF EXISTS assistant_knowledge_base_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_conversations DROP CONSTRAINT IF EXISTS assistant_conversations_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_conversations DROP CONSTRAINT IF EXISTS assistant_conversations_knowledge_entry_id_fkey;
ALTER TABLE IF EXISTS ONLY public.assistant_conversations DROP CONSTRAINT IF EXISTS assistant_conversations_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_template_id_fkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_employee_signed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_company_signed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_asset_assignment_id_fkey;
ALTER TABLE IF EXISTS ONLY public.approved_shift_swaps DROP CONSTRAINT IF EXISTS approved_shift_swaps_notification_group_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_updated_by_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_role_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_reports_to_staff_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff_companies DROP CONSTRAINT IF EXISTS aponnt_staff_companies_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_bank_data_verified_by_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_pre_invoices DROP CONSTRAINT IF EXISTS aponnt_pre_invoices_contract_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_pre_invoices DROP CONSTRAINT IF EXISTS aponnt_pre_invoices_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_pre_invoices DROP CONSTRAINT IF EXISTS aponnt_pre_invoices_budget_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_associates DROP CONSTRAINT IF EXISTS aponnt_associates_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_admin_tasks DROP CONSTRAINT IF EXISTS aponnt_admin_tasks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.afip_cae_log DROP CONSTRAINT IF EXISTS afip_cae_log_factura_id_fkey;
ALTER TABLE IF EXISTS ONLY public.afip_cae_log DROP CONSTRAINT IF EXISTS afip_cae_log_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.afip_auth_log DROP CONSTRAINT IF EXISTS afip_auth_log_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_resolved_by_fkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_assigned_to_fkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_assigned_by_fkey;
ALTER TABLE IF EXISTS ONLY public.additional_role_types DROP CONSTRAINT IF EXISTS additional_role_types_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.access_audit_log DROP CONSTRAINT IF EXISTS access_audit_log_user_id_fkey;
ALTER TABLE IF EXISTS ONLY public.access_audit_log DROP CONSTRAINT IF EXISTS access_audit_log_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_notification_group_id_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_last_modified_by_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_employee_id_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_created_by_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_company_id_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_closed_by_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_certificate_id_fkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_assigned_doctor_id_fkey;
ALTER TABLE IF EXISTS ONLY public."UserShifts" DROP CONSTRAINT IF EXISTS "UserShifts_UserUserId_fkey";
ALTER TABLE IF EXISTS ONLY public."UserShifts" DROP CONSTRAINT IF EXISTS "UserShifts_ShiftId_fkey";
DROP TRIGGER IF EXISTS validate_user_department_company ON public.users;
DROP TRIGGER IF EXISTS validate_shift_assignment_company ON public.user_shift_assignments;
DROP TRIGGER IF EXISTS validate_attendance_company ON public.attendances;
DROP TRIGGER IF EXISTS users_prevent_core_deletion ON public.users;
DROP TRIGGER IF EXISTS users_core_immutable ON public.users;
DROP TRIGGER IF EXISTS update_work_restrictions_updated_at ON public.user_work_restrictions;
DROP TRIGGER IF EXISTS update_work_history_updated_at ON public.user_work_history;
DROP TRIGGER IF EXISTS update_vaccinations_updated_at ON public.user_vaccinations;
DROP TRIGGER IF EXISTS update_vacation_scales_timestamp ON public.vacation_scales;
DROP TRIGGER IF EXISTS update_vacation_requests_timestamp ON public.vacation_requests;
DROP TRIGGER IF EXISTS update_vacation_configurations_timestamp ON public.vacation_configurations;
DROP TRIGGER IF EXISTS update_user_documents_updated_at ON public.user_documents;
DROP TRIGGER IF EXISTS update_union_affiliation_updated_at ON public.user_union_affiliation;
DROP TRIGGER IF EXISTS update_task_compatibility_timestamp ON public.task_compatibility;
DROP TRIGGER IF EXISTS update_support_tickets_updated_at ON public.support_tickets;
DROP TRIGGER IF EXISTS update_support_sla_plans_updated_at ON public.support_sla_plans;
DROP TRIGGER IF EXISTS update_salary_config_updated_at ON public.user_salary_config;
DROP TRIGGER IF EXISTS update_professional_licenses_updated_at ON public.user_professional_licenses;
DROP TRIGGER IF EXISTS update_primary_physician_updated_at ON public.user_primary_physician;
DROP TRIGGER IF EXISTS update_permission_requests_updated_at ON public.user_permission_requests;
DROP TRIGGER IF EXISTS update_medications_updated_at ON public.user_medications;
DROP TRIGGER IF EXISTS update_medical_exams_updated_at ON public.user_medical_exams;
DROP TRIGGER IF EXISTS update_medical_documents_updated_at ON public.user_medical_documents;
DROP TRIGGER IF EXISTS update_marital_status_updated_at ON public.user_marital_status;
DROP TRIGGER IF EXISTS update_legal_issues_updated_at ON public.user_legal_issues;
DROP TRIGGER IF EXISTS update_fingerprint_biometric_data_updated_at ON public.fingerprint_biometric_data;
DROP TRIGGER IF EXISTS update_family_members_updated_at ON public.user_family_members;
DROP TRIGGER IF EXISTS update_facial_biometric_data_updated_at ON public.facial_biometric_data;
DROP TRIGGER IF EXISTS update_extraordinary_licenses_timestamp ON public.extraordinary_licenses;
DROP TRIGGER IF EXISTS update_education_updated_at ON public.user_education;
DROP TRIGGER IF EXISTS update_driver_licenses_updated_at ON public.user_driver_licenses;
DROP TRIGGER IF EXISTS update_disciplinary_actions_updated_at ON public.user_disciplinary_actions;
DROP TRIGGER IF EXISTS update_company_tasks_updated_at ON public.company_tasks;
DROP TRIGGER IF EXISTS update_chronic_conditions_updated_at ON public.user_chronic_conditions;
DROP TRIGGER IF EXISTS update_children_updated_at ON public.user_children;
DROP TRIGGER IF EXISTS update_biometric_settings_updated_at ON public.biometric_settings;
DROP TRIGGER IF EXISTS update_biometric_devices_updated_at ON public.biometric_devices;
DROP TRIGGER IF EXISTS update_assigned_tasks_updated_at ON public.user_assigned_tasks;
DROP TRIGGER IF EXISTS update_allergies_updated_at ON public.user_allergies;
DROP TRIGGER IF EXISTS update_activity_restrictions_updated_at ON public.user_activity_restrictions;
DROP TRIGGER IF EXISTS trigger_validate_email_config ON public.email_configurations;
DROP TRIGGER IF EXISTS trigger_update_vendor_stats_on_company ON public.companies;
DROP TRIGGER IF EXISTS trigger_update_user_emails_timestamp ON public.user_emails;
DROP TRIGGER IF EXISTS trigger_update_test_executions_timestamp ON public.test_executions;
DROP TRIGGER IF EXISTS trigger_update_staff_companies_updated_at ON public.aponnt_staff_companies;
DROP TRIGGER IF EXISTS trigger_update_siac_presupuestos_timestamp ON public.siac_presupuestos;
DROP TRIGGER IF EXISTS trigger_update_sesiones_updated_at ON public.siac_sesiones_locales;
DROP TRIGGER IF EXISTS trigger_update_partners_updated_at ON public.partners;
DROP TRIGGER IF EXISTS trigger_update_kiosks_timestamp ON public.kiosks;
DROP TRIGGER IF EXISTS trigger_update_email_config_timestamp ON public.email_configurations;
DROP TRIGGER IF EXISTS trigger_update_configuracion_terminal_updated_at ON public.siac_configuracion_terminal;
DROP TRIGGER IF EXISTS trigger_update_absence_cases_timestamp ON public.absence_cases;
DROP TRIGGER IF EXISTS trigger_tax_templates_updated_at ON public.tax_templates;
DROP TRIGGER IF EXISTS trigger_tax_concepts_updated_at ON public.tax_concepts;
DROP TRIGGER IF EXISTS trigger_sync_user_email ON public.users;
DROP TRIGGER IF EXISTS trigger_set_ticket_sla_deadlines ON public.support_tickets;
DROP TRIGGER IF EXISTS trigger_reset_email_counters ON public.email_configurations;
DROP TRIGGER IF EXISTS trigger_pre_invoices_updated ON public.aponnt_pre_invoices;
DROP TRIGGER IF EXISTS trigger_legal_comm_types_updated_at ON public.legal_communication_types;
DROP TRIGGER IF EXISTS trigger_fiscal_config_updated ON public.company_fiscal_config;
DROP TRIGGER IF EXISTS trigger_expire_temp_password ON public.support_tickets;
DROP TRIGGER IF EXISTS trigger_email_config_updated ON public.aponnt_email_config;
DROP TRIGGER IF EXISTS trigger_company_tax_config_updated_at ON public.company_tax_config;
DROP TRIGGER IF EXISTS trigger_calculate_credito ON public.siac_clientes;
DROP TRIGGER IF EXISTS trigger_auto_assign_partner_username ON public.partners;
DROP TRIGGER IF EXISTS trigger_assistant_knowledge_base_updated_at ON public.assistant_knowledge_base;
DROP TRIGGER IF EXISTS trigger_admin_tasks_updated ON public.aponnt_admin_tasks;
DROP TRIGGER IF EXISTS trg_validate_vacation_balance ON public.vacation_requests;
DROP TRIGGER IF EXISTS trg_validate_procedure_hierarchy ON public.procedures;
DROP TRIGGER IF EXISTS trg_validate_notification_recipient ON public.notifications;
DROP TRIGGER IF EXISTS trg_user_consents_updated_at ON public.user_consents;
DROP TRIGGER IF EXISTS trg_user_branch_change_consent ON public.users;
DROP TRIGGER IF EXISTS trg_update_thread_unread ON public.unified_notifications;
DROP TRIGGER IF EXISTS trg_update_response_confidence ON public.notification_learned_responses;
DROP TRIGGER IF EXISTS trg_update_procedure_path ON public.procedures;
DROP TRIGGER IF EXISTS trg_update_household_size ON public.user_household_members;
DROP TRIGGER IF EXISTS trg_update_group_activity ON public.notification_messages;
DROP TRIGGER IF EXISTS trg_update_documents_count ON public.oh_screening_documents;
DROP TRIGGER IF EXISTS trg_update_commission_summary ON public.partner_commission_transactions;
DROP TRIGGER IF EXISTS trg_update_budget_on_transaction ON public.hour_bank_transactions;
DROP TRIGGER IF EXISTS trg_update_benefit_docs_status ON public.employee_benefit_documents;
DROP TRIGGER IF EXISTS trg_update_applications_count ON public.job_applications;
DROP TRIGGER IF EXISTS trg_update_allowance_consumption ON public.benefit_expense_submissions;
DROP TRIGGER IF EXISTS trg_unified_notif_updated ON public.unified_notifications;
DROP TRIGGER IF EXISTS trg_threads_updated ON public.notification_threads;
DROP TRIGGER IF EXISTS trg_sync_user_position ON public.users;
DROP TRIGGER IF EXISTS trg_sync_active_modules ON public.company_modules;
DROP TRIGGER IF EXISTS trg_suspension_blocks_updated_at ON public.suspension_blocks;
DROP TRIGGER IF EXISTS trg_screening_expiration_check ON public.oh_pre_employment_screenings;
DROP TRIGGER IF EXISTS trg_sanction_types_updated_at ON public.sanction_types;
DROP TRIGGER IF EXISTS trg_role_definitions_updated_at ON public.role_definitions;
DROP TRIGGER IF EXISTS trg_redemption_status_log ON public.hour_bank_redemption_requests;
DROP TRIGGER IF EXISTS trg_propagate_salary_category_v2 ON public.salary_categories_v2;
DROP TRIGGER IF EXISTS trg_propagate_salary_category ON public.salary_categories;
DROP TRIGGER IF EXISTS trg_propagate_agreement_multipliers ON public.labor_agreements_v2;
DROP TRIGGER IF EXISTS trg_procedure_initial_owner ON public.procedures;
DROP TRIGGER IF EXISTS trg_prevent_duplicate_checkin ON public.attendances;
DROP TRIGGER IF EXISTS trg_payslip_template_updated ON public.payroll_payslip_templates;
DROP TRIGGER IF EXISTS trg_notify_benefit_approved ON public.employee_benefits;
DROP TRIGGER IF EXISTS trg_notif_thread_counters ON public.unified_notifications;
DROP TRIGGER IF EXISTS trg_module_definitions_updated_at ON public.module_definitions;
DROP TRIGGER IF EXISTS trg_medical_templates_updated ON public.medical_exam_templates;
DROP TRIGGER IF EXISTS trg_medical_records_updated ON public.medical_records;
DROP TRIGGER IF EXISTS trg_medical_record_expiration ON public.medical_records;
DROP TRIGGER IF EXISTS trg_medical_record_editable_until ON public.medical_records;
DROP TRIGGER IF EXISTS trg_medical_authorizations_updated ON public.medical_edit_authorizations;
DROP TRIGGER IF EXISTS trg_log_status_change ON public.job_applications;
DROP TRIGGER IF EXISTS trg_log_consent_changes ON public.user_consents;
DROP TRIGGER IF EXISTS trg_legal_stage_change ON public.legal_cases;
DROP TRIGGER IF EXISTS trg_legal_cases_updated_at ON public.legal_cases;
DROP TRIGGER IF EXISTS trg_legal_case_number ON public.legal_cases;
DROP TRIGGER IF EXISTS trg_legal_auth_updated_at ON public.legal_edit_authorizations;
DROP TRIGGER IF EXISTS trg_hse_case_number ON public.hse_cases;
DROP TRIGGER IF EXISTS trg_flag_payroll_recalculation ON public.user_salary_config_v2;
DROP TRIGGER IF EXISTS trg_emp_dep_docs_updated ON public.employee_dependency_documents;
DROP TRIGGER IF EXISTS trg_document_edit_window ON public.legal_case_documents;
DROP TRIGGER IF EXISTS trg_create_suspension_block ON public.sanctions;
DROP TRIGGER IF EXISTS trg_create_scheduled_redemption ON public.hour_bank_redemption_requests;
DROP TRIGGER IF EXISTS trg_contextual_help_updated_at ON public.contextual_help;
DROP TRIGGER IF EXISTS trg_consent_definitions_updated_at ON public.consent_definitions;
DROP TRIGGER IF EXISTS trg_concept_dependencies_updated ON public.concept_dependencies;
DROP TRIGGER IF EXISTS trg_company_dependencies_updated ON public.company_dependencies;
DROP TRIGGER IF EXISTS trg_company_associate_contracts_updated_at ON public.company_associate_contracts;
DROP TRIGGER IF EXISTS trg_check_user_shift ON public.users;
DROP TRIGGER IF EXISTS trg_check_unique_active_template ON public.hour_bank_templates;
DROP TRIGGER IF EXISTS trg_calculate_payroll ON public.user_payroll_records;
DROP TRIGGER IF EXISTS trg_calculate_epp_replacement ON public.epp_deliveries;
DROP TRIGGER IF EXISTS trg_calculate_bmi ON public.user_anthropometric_data;
DROP TRIGGER IF EXISTS trg_auto_create_user_salary_config ON public.users;
DROP TRIGGER IF EXISTS trg_auto_assign_contract_template ON public.asset_contracts;
DROP TRIGGER IF EXISTS trg_audit_medical_records ON public.medical_records;
DROP TRIGGER IF EXISTS trg_attendance_profiles_updated_at ON public.attendance_profiles;
DROP TRIGGER IF EXISTS trg_attendance_patterns_updated_at ON public.attendance_patterns;
DROP TRIGGER IF EXISTS trg_aponnt_associates_updated_at ON public.aponnt_associates;
DROP TRIGGER IF EXISTS tr_oh_claim_status_change ON public.oh_workers_compensation_claims;
DROP TRIGGER IF EXISTS tr_oh_claim_docs_count ON public.oh_claim_documents;
DROP TRIGGER IF EXISTS tr_formatear_numero_factura ON public.siac_facturas;
DROP TRIGGER IF EXISTS tr_company_comms_updated ON public.company_communications;
DROP TRIGGER IF EXISTS tr_actualizar_totales_items ON public.siac_facturas_items;
DROP TRIGGER IF EXISTS tr_actualizar_totales_impuestos ON public.siac_facturas_impuestos;
DROP TRIGGER IF EXISTS testing_tickets_update_timestamp ON public.testing_tickets;
DROP TRIGGER IF EXISTS siac_productos_calcular_precios_trigger ON public.siac_productos;
DROP TRIGGER IF EXISTS siac_clientes_before_insert_trigger ON public.siac_clientes;
DROP TRIGGER IF EXISTS contracts_updated_at ON public.contracts;
DROP TRIGGER IF EXISTS contracts_set_renewal_alert ON public.contracts;
DROP TRIGGER IF EXISTS contracts_auto_hash ON public.contracts;
DROP TRIGGER IF EXISTS companies_validate_modules_trial ON public.companies;
DROP TRIGGER IF EXISTS comm_pay_updated_at ON public.commission_payments;
DROP TRIGGER IF EXISTS comm_liq_updated_at ON public.commission_liquidations;
DROP TRIGGER IF EXISTS budgets_updated_at ON public.budgets;
DROP TRIGGER IF EXISTS admin_tasks_updated_at ON public.administrative_tasks;
CREATE OR REPLACE VIEW public.v_active_kiosks AS
SELECT
    NULL::integer AS id,
    NULL::character varying(100) AS name,
    NULL::text AS description,
    NULL::character varying(100) AS device_id,
    NULL::numeric(10,8) AS gps_lat,
    NULL::numeric(11,8) AS gps_lng,
    NULL::boolean AS is_configured,
    NULL::integer AS company_id,
    NULL::character varying(255) AS company_name,
    NULL::character varying(255) AS company_slug,
    NULL::timestamp without time zone AS created_at,
    NULL::bigint AS total_attendances;
DROP INDEX IF EXISTS public.visitors_visiting_department_id;
DROP INDEX IF EXISTS public.visitors_unique_keyring_id;
DROP INDEX IF EXISTS public.visitors_scheduled_visit_date;
DROP INDEX IF EXISTS public.visitors_responsible_employee_id;
DROP INDEX IF EXISTS public.visitors_dni_company_id;
DROP INDEX IF EXISTS public.visitors_company_id;
DROP INDEX IF EXISTS public.visitors_check_out;
DROP INDEX IF EXISTS public.visitors_check_in;
DROP INDEX IF EXISTS public.visitors_authorization_status;
DROP INDEX IF EXISTS public.visitor_gps_tracking_visitor_id;
DROP INDEX IF EXISTS public.visitor_gps_tracking_recorded_at;
DROP INDEX IF EXISTS public.visitor_gps_tracking_is_inside_facility;
DROP INDEX IF EXISTS public.visitor_gps_tracking_company_id;
DROP INDEX IF EXISTS public.vendor_commissions_vendor_id_is_active;
DROP INDEX IF EXISTS public.vendor_commissions_vendor_id_company_id_commission_type;
DROP INDEX IF EXISTS public.vendor_commissions_company_id_is_active;
DROP INDEX IF EXISTS public.vendor_commissions_commission_type;
DROP INDEX IF EXISTS public.users_role;
DROP INDEX IF EXISTS public.users_employee_id;
DROP INDEX IF EXISTS public.users_email;
DROP INDEX IF EXISTS public.users_dni;
DROP INDEX IF EXISTS public.user_payroll_concept_overrides_assignment_id;
DROP INDEX IF EXISTS public.user_payroll_bonuses_user_id_effective_from;
DROP INDEX IF EXISTS public.user_payroll_bonuses_user_id;
DROP INDEX IF EXISTS public.user_payroll_bonuses_is_active;
DROP INDEX IF EXISTS public.user_payroll_bonuses_frequency;
DROP INDEX IF EXISTS public.user_payroll_bonuses_company_id;
DROP INDEX IF EXISTS public.user_payroll_assignment_user_id;
DROP INDEX IF EXISTS public.user_payroll_assignment_template_id;
DROP INDEX IF EXISTS public.user_payroll_assignment_category_id;
DROP INDEX IF EXISTS public.user_payroll_assignment_branch_id;
DROP INDEX IF EXISTS public.user_consents_user_id_user_type;
DROP INDEX IF EXISTS public.user_consents_user_id_consent_id_status;
DROP INDEX IF EXISTS public.user_consents_status;
DROP INDEX IF EXISTS public.user_consents_rejected_at;
DROP INDEX IF EXISTS public.user_consents_consent_id;
DROP INDEX IF EXISTS public.user_consents_accepted_at;
DROP INDEX IF EXISTS public.user_audit_logs_user_id;
DROP INDEX IF EXISTS public.user_audit_logs_field_name;
DROP INDEX IF EXISTS public.user_audit_logs_created_at;
DROP INDEX IF EXISTS public.user_audit_logs_company_id;
DROP INDEX IF EXISTS public.user_audit_logs_changed_by_user_id;
DROP INDEX IF EXISTS public.user_audit_logs_action;
DROP INDEX IF EXISTS public.unique_vendor_supervisor;
DROP INDEX IF EXISTS public.unique_vendor_period;
DROP INDEX IF EXISTS public.unique_user_company_module;
DROP INDEX IF EXISTS public.unique_company_workflow_key;
DROP INDEX IF EXISTS public.unique_company_template_key;
DROP INDEX IF EXISTS public.trainings_company_id;
DROP INDEX IF EXISTS public.training_assignments_user_id;
DROP INDEX IF EXISTS public.training_assignments_training_id_user_id;
DROP INDEX IF EXISTS public.training_assignments_training_id;
DROP INDEX IF EXISTS public.training_assignments_status;
DROP INDEX IF EXISTS public.training_assignments_company_id_status;
DROP INDEX IF EXISTS public.training_assignments_company_id;
DROP INDEX IF EXISTS public.test_executions_status;
DROP INDEX IF EXISTS public.test_executions_module;
DROP INDEX IF EXISTS public.test_executions_execution_id;
DROP INDEX IF EXISTS public.test_executions_environment;
DROP INDEX IF EXISTS public.test_executions_created_at;
DROP INDEX IF EXISTS public.test_executions_company_id;
DROP INDEX IF EXISTS public.system_modules_module_key;
DROP INDEX IF EXISTS public.system_modules_is_core;
DROP INDEX IF EXISTS public.system_modules_is_active;
DROP INDEX IF EXISTS public.system_modules_display_order;
DROP INDEX IF EXISTS public.system_modules_category;
DROP INDEX IF EXISTS public.support_vendor_supervisors_vendor_id;
DROP INDEX IF EXISTS public.support_vendor_supervisors_supervisor_id;
DROP INDEX IF EXISTS public.support_vendor_supervisors_is_active;
DROP INDEX IF EXISTS public.support_vendor_stats_vendor_id;
DROP INDEX IF EXISTS public.support_vendor_stats_period_start_period_end;
DROP INDEX IF EXISTS public.support_tickets_status;
DROP INDEX IF EXISTS public.support_tickets_sla_escalation_deadline;
DROP INDEX IF EXISTS public.support_tickets_escalated_to_supervisor_id;
DROP INDEX IF EXISTS public.support_tickets_created_by_user_id;
DROP INDEX IF EXISTS public.support_tickets_created_at;
DROP INDEX IF EXISTS public.support_tickets_company_id;
DROP INDEX IF EXISTS public.support_tickets_assistant_attempted;
DROP INDEX IF EXISTS public.support_tickets_assigned_to_vendor_id;
DROP INDEX IF EXISTS public.support_ticket_messages_ticket_id;
DROP INDEX IF EXISTS public.support_ticket_messages_created_at;
DROP INDEX IF EXISTS public.support_sla_plans_is_active;
DROP INDEX IF EXISTS public.support_escalations_ticket_id;
DROP INDEX IF EXISTS public.support_escalations_escalated_to_user_id;
DROP INDEX IF EXISTS public.support_escalations_escalated_from_user_id;
DROP INDEX IF EXISTS public.support_escalations_escalated_at;
DROP INDEX IF EXISTS public.support_assistant_attempts_user_satisfied;
DROP INDEX IF EXISTS public.support_assistant_attempts_ticket_id;
DROP INDEX IF EXISTS public.support_assistant_attempts_attempted_at;
DROP INDEX IF EXISTS public.support_assistant_attempts_assistant_type;
DROP INDEX IF EXISTS public.support_activity_log_ticket_id;
DROP INDEX IF EXISTS public.support_activity_log_support_user_id;
DROP INDEX IF EXISTS public.support_activity_log_session_id;
DROP INDEX IF EXISTS public.support_activity_log_created_at;
DROP INDEX IF EXISTS public.support_activity_log_company_id;
DROP INDEX IF EXISTS public.shifts_shift_type;
DROP INDEX IF EXISTS public.shifts_name;
DROP INDEX IF EXISTS public.shifts_is_active;
DROP INDEX IF EXISTS public.shifts_flash_start_date_flash_end_date;
DROP INDEX IF EXISTS public.shifts_cycle_start_date;
DROP INDEX IF EXISTS public.shifts_company_id;
DROP INDEX IF EXISTS public.sectors_supervisor_id;
DROP INDEX IF EXISTS public.sectors_department_id_name;
DROP INDEX IF EXISTS public.sectors_department_id;
DROP INDEX IF EXISTS public.sectors_company_id_is_active;
DROP INDEX IF EXISTS public.sectors_company_id;
DROP INDEX IF EXISTS public.permissions_type;
DROP INDEX IF EXISTS public.permissions_status;
DROP INDEX IF EXISTS public.permissions_start_date;
DROP INDEX IF EXISTS public.permissions_end_date;
DROP INDEX IF EXISTS public.permissions__user_id;
DROP INDEX IF EXISTS public.payroll_templates_labor_agreement_id;
DROP INDEX IF EXISTS public.payroll_templates_is_active;
DROP INDEX IF EXISTS public.payroll_templates_country_id;
DROP INDEX IF EXISTS public.payroll_templates_company_id_template_code;
DROP INDEX IF EXISTS public.payroll_templates_company_id;
DROP INDEX IF EXISTS public.payroll_template_concepts_template_id;
DROP INDEX IF EXISTS public.payroll_template_concepts_is_active;
DROP INDEX IF EXISTS public.payroll_template_concepts_display_order;
DROP INDEX IF EXISTS public.payroll_template_concepts_concept_type_id;
DROP INDEX IF EXISTS public.payroll_entity_settlements_company_id_entity_id_period_year_per;
DROP INDEX IF EXISTS public.notifications_enterprise_to_user_id_status;
DROP INDEX IF EXISTS public.notifications_enterprise_company_id_status_priority;
DROP INDEX IF EXISTS public.notifications_enterprise_company_id;
DROP INDEX IF EXISTS public.notification_queue_status_scheduled_at;
DROP INDEX IF EXISTS public.notification_queue_company_id_status;
DROP INDEX IF EXISTS public.messages_type;
DROP INDEX IF EXISTS public.messages_recipient_id;
DROP INDEX IF EXISTS public.messages_priority;
DROP INDEX IF EXISTS public.messages_is_read;
DROP INDEX IF EXISTS public.messages_expires_at;
DROP INDEX IF EXISTS public.medical_records_result;
DROP INDEX IF EXISTS public.medical_records_record_type;
DROP INDEX IF EXISTS public.medical_records_is_locked;
DROP INDEX IF EXISTS public.medical_records_is_deleted;
DROP INDEX IF EXISTS public.medical_records_expiration_date;
DROP INDEX IF EXISTS public.medical_records_exam_date;
DROP INDEX IF EXISTS public.medical_records_employee_id;
DROP INDEX IF EXISTS public.medical_records_company_id;
DROP INDEX IF EXISTS public.medical_record_audit_log_record_id;
DROP INDEX IF EXISTS public.medical_record_audit_log_company_id;
DROP INDEX IF EXISTS public.medical_record_audit_log_authorization_id;
DROP INDEX IF EXISTS public.medical_record_audit_log_action_by;
DROP INDEX IF EXISTS public.medical_record_audit_log_action_at;
DROP INDEX IF EXISTS public.medical_record_audit_log_action;
DROP INDEX IF EXISTS public.medical_exam_templates_is_active;
DROP INDEX IF EXISTS public.medical_exam_templates_exam_type;
DROP INDEX IF EXISTS public.medical_exam_templates_company_id;
DROP INDEX IF EXISTS public.medical_edit_authorizations_status;
DROP INDEX IF EXISTS public.medical_edit_authorizations_requested_by;
DROP INDEX IF EXISTS public.medical_edit_authorizations_record_id;
DROP INDEX IF EXISTS public.medical_edit_authorizations_notification_id;
DROP INDEX IF EXISTS public.medical_edit_authorizations_company_id;
DROP INDEX IF EXISTS public.medical_edit_authorizations_authorized_by;
DROP INDEX IF EXISTS public.medical_diagnoses_requires_audit;
DROP INDEX IF EXISTS public.medical_diagnoses_is_active;
DROP INDEX IF EXISTS public.medical_diagnoses_code;
DROP INDEX IF EXISTS public.medical_diagnoses_category;
DROP INDEX IF EXISTS public.medical_certificates_user_id;
DROP INDEX IF EXISTS public.medical_certificates_status;
DROP INDEX IF EXISTS public.medical_certificates_issue_date;
DROP INDEX IF EXISTS public.medical_certificates_auditor_id;
DROP INDEX IF EXISTS public.labor_agreements_v2_is_active;
DROP INDEX IF EXISTS public.labor_agreements_v2_country_id;
DROP INDEX IF EXISTS public.labor_agreements_v2_company_id;
DROP INDEX IF EXISTS public.kiosks_unique_gps_per_company;
DROP INDEX IF EXISTS public.kiosks_unique_device_id;
DROP INDEX IF EXISTS public.kiosks_is_configured;
DROP INDEX IF EXISTS public.kiosks_is_active;
DROP INDEX IF EXISTS public.kiosks_company_id;
DROP INDEX IF EXISTS public.idx_zone_config_company;
DROP INDEX IF EXISTS public.idx_zone_config_branch;
DROP INDEX IF EXISTS public.idx_zone_config_active;
DROP INDEX IF EXISTS public.idx_workflows_company_module;
DROP INDEX IF EXISTS public.idx_work_restrictions_user;
DROP INDEX IF EXISTS public.idx_work_restrictions_company;
DROP INDEX IF EXISTS public.idx_work_history_user;
DROP INDEX IF EXISTS public.idx_work_history_company;
DROP INDEX IF EXISTS public.idx_violation_catalog_medical;
DROP INDEX IF EXISTS public.idx_violation_catalog_category;
DROP INDEX IF EXISTS public.idx_violation_catalog_ai;
DROP INDEX IF EXISTS public.idx_violation_catalog_active;
DROP INDEX IF EXISTS public.idx_vendor_statistics_vendor_id;
DROP INDEX IF EXISTS public.idx_vendor_statistics_rating;
DROP INDEX IF EXISTS public.idx_vendor_statistics_grand_total;
DROP INDEX IF EXISTS public.idx_vendor_referrals_status;
DROP INDEX IF EXISTS public.idx_vendor_referrals_referrer;
DROP INDEX IF EXISTS public.idx_vendor_referrals_referred;
DROP INDEX IF EXISTS public.idx_vendor_referrals_level;
DROP INDEX IF EXISTS public.idx_vendor_ratings_vendor;
DROP INDEX IF EXISTS public.idx_vendor_ratings_rating;
DROP INDEX IF EXISTS public.idx_vendor_ratings_company;
DROP INDEX IF EXISTS public.idx_vendor_commissions_vendor_id;
DROP INDEX IF EXISTS public.idx_vendor_commissions_vendor_active;
DROP INDEX IF EXISTS public.idx_vendor_commissions_type;
DROP INDEX IF EXISTS public.idx_vendor_commissions_original_vendor_id;
DROP INDEX IF EXISTS public.idx_vendor_commissions_company_active;
DROP INDEX IF EXISTS public.idx_vaccinations_user;
DROP INDEX IF EXISTS public.idx_vaccinations_company;
DROP INDEX IF EXISTS public.idx_vacation_scale_range;
DROP INDEX IF EXISTS public.idx_vacation_scale_priority;
DROP INDEX IF EXISTS public.idx_vacation_scale_company;
DROP INDEX IF EXISTS public.idx_vacation_requests_year;
DROP INDEX IF EXISTS public.idx_vacation_requests_user;
DROP INDEX IF EXISTS public.idx_vacation_requests_status;
DROP INDEX IF EXISTS public.idx_vacation_requests_dates;
DROP INDEX IF EXISTS public.idx_vacation_requests_company;
DROP INDEX IF EXISTS public.idx_vacation_req_user_status;
DROP INDEX IF EXISTS public.idx_vacation_req_user;
DROP INDEX IF EXISTS public.idx_vacation_req_type;
DROP INDEX IF EXISTS public.idx_vacation_req_source;
DROP INDEX IF EXISTS public.idx_vacation_req_dates;
DROP INDEX IF EXISTS public.idx_vacation_req_company;
DROP INDEX IF EXISTS public.idx_vacation_req_approval;
DROP INDEX IF EXISTS public.idx_vacation_config_company;
DROP INDEX IF EXISTS public.idx_vacation_config_active;
DROP INDEX IF EXISTS public.idx_ux_discoveries_validation;
DROP INDEX IF EXISTS public.idx_ux_discoveries_type;
DROP INDEX IF EXISTS public.idx_ux_discoveries_context;
DROP INDEX IF EXISTS public.idx_ux_discoveries_company;
DROP INDEX IF EXISTS public.idx_users_work_schedule_gin;
DROP INDEX IF EXISTS public.idx_users_sector;
DROP INDEX IF EXISTS public.idx_users_search;
DROP INDEX IF EXISTS public.idx_users_salary_category;
DROP INDEX IF EXISTS public.idx_users_role_active;
DROP INDEX IF EXISTS public.idx_users_permissions_gin;
DROP INDEX IF EXISTS public.idx_users_pending_consents;
DROP INDEX IF EXISTS public.idx_users_org_position;
DROP INDEX IF EXISTS public.idx_users_one_core_per_company;
DROP INDEX IF EXISTS public.idx_users_onboarding_trace;
DROP INDEX IF EXISTS public.idx_users_last_scan;
DROP INDEX IF EXISTS public.idx_users_last_login;
DROP INDEX IF EXISTS public.idx_users_is_core;
DROP INDEX IF EXISTS public.idx_users_health_insurance_expiry;
DROP INDEX IF EXISTS public.idx_users_has_flexible_schedule;
DROP INDEX IF EXISTS public.idx_users_gps_enabled;
DROP INDEX IF EXISTS public.idx_users_force_password_change;
DROP INDEX IF EXISTS public.idx_users_employee_id_active;
DROP INDEX IF EXISTS public.idx_users_email_verified;
DROP INDEX IF EXISTS public.idx_users_email_active;
DROP INDEX IF EXISTS public.idx_users_department_active;
DROP INDEX IF EXISTS public.idx_users_company_biometric;
DROP INDEX IF EXISTS public.idx_users_can_use_mobile_app;
DROP INDEX IF EXISTS public.idx_users_can_use_kiosk;
DROP INDEX IF EXISTS public.idx_users_can_authorize;
DROP INDEX IF EXISTS public.idx_users_branch_scope;
DROP INDEX IF EXISTS public.idx_users_branch_id;
DROP INDEX IF EXISTS public.idx_users_branch_active;
DROP INDEX IF EXISTS public.idx_users_biometric_photo_expiration;
DROP INDEX IF EXISTS public.idx_users_biometric_flags;
DROP INDEX IF EXISTS public.idx_users_biometric_enrolled;
DROP INDEX IF EXISTS public.idx_users_authorized_departments_gin;
DROP INDEX IF EXISTS public.idx_users_ai_enabled;
DROP INDEX IF EXISTS public.idx_users_account_status;
DROP INDEX IF EXISTS public.idx_user_shifts_user_id;
DROP INDEX IF EXISTS public.idx_user_shifts_shift_id;
DROP INDEX IF EXISTS public.idx_user_shift_unique_active;
DROP INDEX IF EXISTS public.idx_user_shift_sector;
DROP INDEX IF EXISTS public.idx_user_shift_phase;
DROP INDEX IF EXISTS public.idx_user_shift_company_shift;
DROP INDEX IF EXISTS public.idx_user_shift_active;
DROP INDEX IF EXISTS public.idx_user_salary_config_v2_current;
DROP INDEX IF EXISTS public.idx_user_salary_config_v2_category;
DROP INDEX IF EXISTS public.idx_user_salary_config_v2_agreement;
DROP INDEX IF EXISTS public.idx_user_roles_user;
DROP INDEX IF EXISTS public.idx_user_roles_role;
DROP INDEX IF EXISTS public.idx_user_roles_active;
DROP INDEX IF EXISTS public.idx_user_payroll_assignment_user;
DROP INDEX IF EXISTS public.idx_user_payroll_assignment_template;
DROP INDEX IF EXISTS public.idx_user_notification_prefs;
DROP INDEX IF EXISTS public.idx_user_emails_verified;
DROP INDEX IF EXISTS public.idx_user_emails_user;
DROP INDEX IF EXISTS public.idx_user_emails_email;
DROP INDEX IF EXISTS public.idx_user_emails_company;
DROP INDEX IF EXISTS public.idx_user_emails_active;
DROP INDEX IF EXISTS public.idx_user_documents_user;
DROP INDEX IF EXISTS public.idx_user_documents_company;
DROP INDEX IF EXISTS public.idx_user_consents_user;
DROP INDEX IF EXISTS public.idx_user_consents_status;
DROP INDEX IF EXISTS public.idx_user_consents_pending;
DROP INDEX IF EXISTS public.idx_user_consents_consent;
DROP INDEX IF EXISTS public.idx_user_concept_overrides_user;
DROP INDEX IF EXISTS public.idx_user_concept_overrides_assignment;
DROP INDEX IF EXISTS public.idx_user_bonuses_user;
DROP INDEX IF EXISTS public.idx_user_bonuses_next_payment;
DROP INDEX IF EXISTS public.idx_user_bonuses_company;
DROP INDEX IF EXISTS public.idx_user_audit_logs_user_id;
DROP INDEX IF EXISTS public.idx_user_audit_logs_user_date;
DROP INDEX IF EXISTS public.idx_user_audit_logs_field_name;
DROP INDEX IF EXISTS public.idx_user_audit_logs_created_at;
DROP INDEX IF EXISTS public.idx_user_audit_logs_company_id;
DROP INDEX IF EXISTS public.idx_user_audit_logs_changed_by;
DROP INDEX IF EXISTS public.idx_user_audit_logs_action;
DROP INDEX IF EXISTS public.idx_unique_aponnt_master;
DROP INDEX IF EXISTS public.idx_unique_active_template_per_branch;
DROP INDEX IF EXISTS public.idx_union_affiliation_user;
DROP INDEX IF EXISTS public.idx_union_affiliation_union;
DROP INDEX IF EXISTS public.idx_union_affiliation_fuero;
DROP INDEX IF EXISTS public.idx_union_affiliation_delegate;
DROP INDEX IF EXISTS public.idx_union_affiliation_company;
DROP INDEX IF EXISTS public.idx_union_affiliation_active;
DROP INDEX IF EXISTS public.idx_unified_notif_vendor;
DROP INDEX IF EXISTS public.idx_unified_notif_trace;
DROP INDEX IF EXISTS public.idx_unified_notif_thread;
DROP INDEX IF EXISTS public.idx_unified_notif_sla;
DROP INDEX IF EXISTS public.idx_unified_notif_recipient;
DROP INDEX IF EXISTS public.idx_unified_notif_origin;
DROP INDEX IF EXISTS public.idx_unified_notif_module;
DROP INDEX IF EXISTS public.idx_unified_notif_metadata;
DROP INDEX IF EXISTS public.idx_unified_notif_hierarchy;
DROP INDEX IF EXISTS public.idx_unified_notif_direction;
DROP INDEX IF EXISTS public.idx_unified_notif_company;
DROP INDEX IF EXISTS public.idx_unified_notif_commercial;
DROP INDEX IF EXISTS public.idx_unified_notif_aponnt_dept;
DROP INDEX IF EXISTS public.idx_unified_notif_action;
DROP INDEX IF EXISTS public.idx_unified_help_user;
DROP INDEX IF EXISTS public.idx_unified_help_type;
DROP INDEX IF EXISTS public.idx_unified_help_created;
DROP INDEX IF EXISTS public.idx_unified_help_company;
DROP INDEX IF EXISTS public.idx_unauthorized_timestamp;
DROP INDEX IF EXISTS public.idx_unauthorized_requires_review;
DROP INDEX IF EXISTS public.idx_unauthorized_kiosk;
DROP INDEX IF EXISTS public.idx_unauthorized_employee;
DROP INDEX IF EXISTS public.idx_unauthorized_company;
DROP INDEX IF EXISTS public.idx_transactions_redemption;
DROP INDEX IF EXISTS public.idx_trainings_company;
DROP INDEX IF EXISTS public.idx_trainings_category;
DROP INDEX IF EXISTS public.idx_training_assignments_user;
DROP INDEX IF EXISTS public.idx_training_assignments_training;
DROP INDEX IF EXISTS public.idx_training_assignments_status;
DROP INDEX IF EXISTS public.idx_training_assignments_company;
DROP INDEX IF EXISTS public.idx_tipos_comprobantes_letra;
DROP INDEX IF EXISTS public.idx_tipos_comprobantes_company;
DROP INDEX IF EXISTS public.idx_threads_module;
DROP INDEX IF EXISTS public.idx_threads_initiator;
DROP INDEX IF EXISTS public.idx_threads_company;
DROP INDEX IF EXISTS public.idx_thread_analysis_unresolved;
DROP INDEX IF EXISTS public.idx_thread_analysis_group;
DROP INDEX IF EXISTS public.idx_thread_analysis_company;
DROP INDEX IF EXISTS public.idx_testing_tickets_status;
DROP INDEX IF EXISTS public.idx_testing_tickets_priority;
DROP INDEX IF EXISTS public.idx_testing_tickets_pending;
DROP INDEX IF EXISTS public.idx_testing_tickets_module;
DROP INDEX IF EXISTS public.idx_testing_tickets_created;
DROP INDEX IF EXISTS public.idx_testing_tickets_assigned;
DROP INDEX IF EXISTS public.idx_test_results_timestamp;
DROP INDEX IF EXISTS public.idx_test_results_module;
DROP INDEX IF EXISTS public.idx_test_executions_status;
DROP INDEX IF EXISTS public.idx_test_executions_module;
DROP INDEX IF EXISTS public.idx_test_executions_execution_id;
DROP INDEX IF EXISTS public.idx_test_executions_environment;
DROP INDEX IF EXISTS public.idx_test_executions_created_at;
DROP INDEX IF EXISTS public.idx_test_executions_company_id;
DROP INDEX IF EXISTS public.idx_templates_type;
DROP INDEX IF EXISTS public.idx_templates_status;
DROP INDEX IF EXISTS public.idx_templates_default;
DROP INDEX IF EXISTS public.idx_templates_country;
DROP INDEX IF EXISTS public.idx_template_concepts_template;
DROP INDEX IF EXISTS public.idx_template_concepts_entity;
DROP INDEX IF EXISTS public.idx_tax_templates_country;
DROP INDEX IF EXISTS public.idx_tax_rates_concept;
DROP INDEX IF EXISTS public.idx_tax_conditions_template;
DROP INDEX IF EXISTS public.idx_tax_concepts_template_order;
DROP INDEX IF EXISTS public.idx_task_compat_score;
DROP INDEX IF EXISTS public.idx_task_compat_primary;
DROP INDEX IF EXISTS public.idx_task_compat_cover;
DROP INDEX IF EXISTS public.idx_task_compat_company;
DROP INDEX IF EXISTS public.idx_system_modules_ui_metadata;
DROP INDEX IF EXISTS public.idx_system_modules_requirements;
DROP INDEX IF EXISTS public.idx_system_modules_is_core;
DROP INDEX IF EXISTS public.idx_system_modules_bundled_modules;
DROP INDEX IF EXISTS public.idx_system_modules_available_in;
DROP INDEX IF EXISTS public.idx_system_metadata_type;
DROP INDEX IF EXISTS public.idx_system_metadata_key;
DROP INDEX IF EXISTS public.idx_system_metadata_active;
DROP INDEX IF EXISTS public.idx_suspension_blocks_company;
DROP INDEX IF EXISTS public.idx_suspension_blocks_active;
DROP INDEX IF EXISTS public.idx_surgeries_user;
DROP INDEX IF EXISTS public.idx_surgeries_company;
DROP INDEX IF EXISTS public.idx_support_vendor_supervisors_vendor;
DROP INDEX IF EXISTS public.idx_support_vendor_supervisors_supervisor;
DROP INDEX IF EXISTS public.idx_support_vendor_supervisors_active;
DROP INDEX IF EXISTS public.idx_support_vendor_stats_vendor;
DROP INDEX IF EXISTS public.idx_support_vendor_stats_period;
DROP INDEX IF EXISTS public.idx_support_tickets_thread_id;
DROP INDEX IF EXISTS public.idx_support_tickets_status;
DROP INDEX IF EXISTS public.idx_support_tickets_sla_escalation_deadline;
DROP INDEX IF EXISTS public.idx_support_tickets_escalated_to_supervisor;
DROP INDEX IF EXISTS public.idx_support_tickets_created_by;
DROP INDEX IF EXISTS public.idx_support_tickets_created_at;
DROP INDEX IF EXISTS public.idx_support_tickets_company;
DROP INDEX IF EXISTS public.idx_support_tickets_assistant_attempted;
DROP INDEX IF EXISTS public.idx_support_tickets_assigned_to;
DROP INDEX IF EXISTS public.idx_support_ticket_messages_ticket;
DROP INDEX IF EXISTS public.idx_support_ticket_messages_created_at;
DROP INDEX IF EXISTS public.idx_support_escalations_to;
DROP INDEX IF EXISTS public.idx_support_escalations_ticket;
DROP INDEX IF EXISTS public.idx_support_escalations_from;
DROP INDEX IF EXISTS public.idx_support_escalations_created_at;
DROP INDEX IF EXISTS public.idx_support_assistant_attempts_type;
DROP INDEX IF EXISTS public.idx_support_assistant_attempts_ticket;
DROP INDEX IF EXISTS public.idx_support_assistant_attempts_satisfied;
DROP INDEX IF EXISTS public.idx_support_assistant_attempts_created_at;
DROP INDEX IF EXISTS public.idx_support_activity_log_ticket;
DROP INDEX IF EXISTS public.idx_support_activity_log_support_user;
DROP INDEX IF EXISTS public.idx_support_activity_log_session;
DROP INDEX IF EXISTS public.idx_support_activity_log_created_at;
DROP INDEX IF EXISTS public.idx_support_activity_log_company;
DROP INDEX IF EXISTS public.idx_super_users_username;
DROP INDEX IF EXISTS public.idx_super_users_active;
DROP INDEX IF EXISTS public.idx_submissions_status;
DROP INDEX IF EXISTS public.idx_submissions_reimbursement;
DROP INDEX IF EXISTS public.idx_submissions_employee;
DROP INDEX IF EXISTS public.idx_submissions_date;
DROP INDEX IF EXISTS public.idx_submissions_allowance;
DROP INDEX IF EXISTS public.idx_staff_roles_reports_to;
DROP INDEX IF EXISTS public.idx_staff_roles_level;
DROP INDEX IF EXISTS public.idx_staff_roles_country_specific;
DROP INDEX IF EXISTS public.idx_staff_roles_area;
DROP INDEX IF EXISTS public.idx_staff_payment_method;
DROP INDEX IF EXISTS public.idx_staff_companies_staff;
DROP INDEX IF EXISTS public.idx_staff_companies_company;
DROP INDEX IF EXISTS public.idx_staff_companies_assigned_by;
DROP INDEX IF EXISTS public.idx_staff_companies_active;
DROP INDEX IF EXISTS public.idx_staff_cbu;
DROP INDEX IF EXISTS public.idx_staff_bank_verified;
DROP INDEX IF EXISTS public.idx_sports_user;
DROP INDEX IF EXISTS public.idx_sports_company;
DROP INDEX IF EXISTS public.idx_sla_records_sla_met;
DROP INDEX IF EXISTS public.idx_sla_records_employee;
DROP INDEX IF EXISTS public.idx_sla_records_company;
DROP INDEX IF EXISTS public.idx_sla_records_breach;
DROP INDEX IF EXISTS public.idx_siac_transacciones_session_estado;
DROP INDEX IF EXISTS public.idx_siac_stock_producto;
DROP INDEX IF EXISTS public.idx_siac_stock_fecha;
DROP INDEX IF EXISTS public.idx_siac_sesiones_terminal_active;
DROP INDEX IF EXISTS public.idx_siac_sesiones_session_id;
DROP INDEX IF EXISTS public.idx_siac_sesiones_last_activity;
DROP INDEX IF EXISTS public.idx_siac_sesiones_company_active;
DROP INDEX IF EXISTS public.idx_siac_productos_marca;
DROP INDEX IF EXISTS public.idx_siac_productos_estado;
DROP INDEX IF EXISTS public.idx_siac_productos_company;
DROP INDEX IF EXISTS public.idx_siac_productos_codigo;
DROP INDEX IF EXISTS public.idx_siac_productos_categoria;
DROP INDEX IF EXISTS public.idx_siac_productos_barras;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_tipo_facturacion;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_proximo_periodo;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_numero;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_fecha_emision;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_estado;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_contract;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_company;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_cliente;
DROP INDEX IF EXISTS public.idx_siac_presupuestos_auto_billing;
DROP INDEX IF EXISTS public.idx_siac_precios_producto;
DROP INDEX IF EXISTS public.idx_siac_precios_lista;
DROP INDEX IF EXISTS public.idx_siac_precios_cliente;
DROP INDEX IF EXISTS public.idx_siac_numeracion_timestamp;
DROP INDEX IF EXISTS public.idx_siac_numeracion_company_tipo;
DROP INDEX IF EXISTS public.idx_siac_marcas_company;
DROP INDEX IF EXISTS public.idx_siac_facturas_presupuesto;
DROP INDEX IF EXISTS public.idx_siac_facturas_company;
DROP INDEX IF EXISTS public.idx_siac_direcciones_cliente;
DROP INDEX IF EXISTS public.idx_siac_contactos_cliente;
DROP INDEX IF EXISTS public.idx_siac_configuracion_terminal_company;
DROP INDEX IF EXISTS public.idx_siac_clientes_razon_social;
DROP INDEX IF EXISTS public.idx_siac_clientes_documento;
DROP INDEX IF EXISTS public.idx_siac_clientes_company_id;
DROP INDEX IF EXISTS public.idx_siac_clientes_codigo;
DROP INDEX IF EXISTS public.idx_siac_categorias_company;
DROP INDEX IF EXISTS public.idx_shifts_global_cycle;
DROP INDEX IF EXISTS public.idx_shifts_branch_id;
DROP INDEX IF EXISTS public.idx_sesiones_caja_fecha;
DROP INDEX IF EXISTS public.idx_sesiones_caja_estado;
DROP INDEX IF EXISTS public.idx_sesiones_caja_caja;
DROP INDEX IF EXISTS public.idx_sectors_supervisor;
DROP INDEX IF EXISTS public.idx_sectors_department;
DROP INDEX IF EXISTS public.idx_sectors_company;
DROP INDEX IF EXISTS public.idx_sectors_active;
DROP INDEX IF EXISTS public.idx_scoring_history_user;
DROP INDEX IF EXISTS public.idx_scoring_history_trends;
DROP INDEX IF EXISTS public.idx_scoring_history_date;
DROP INDEX IF EXISTS public.idx_scheduled_redemption_user;
DROP INDEX IF EXISTS public.idx_scheduled_redemption_date;
DROP INDEX IF EXISTS public.idx_sanctions_workflow_status;
DROP INDEX IF EXISTS public.idx_sanctions_user;
DROP INDEX IF EXISTS public.idx_sanctions_type;
DROP INDEX IF EXISTS public.idx_sanctions_status;
DROP INDEX IF EXISTS public.idx_sanctions_requester;
DROP INDEX IF EXISTS public.idx_sanctions_pending_lawyer;
DROP INDEX IF EXISTS public.idx_sanctions_pending_hr;
DROP INDEX IF EXISTS public.idx_sanctions_lawyer;
DROP INDEX IF EXISTS public.idx_sanctions_employee_company;
DROP INDEX IF EXISTS public.idx_sanctions_date;
DROP INDEX IF EXISTS public.idx_sanctions_company;
DROP INDEX IF EXISTS public.idx_sanction_history_sanction_id;
DROP INDEX IF EXISTS public.idx_sanction_history_created_at;
DROP INDEX IF EXISTS public.idx_salary_v2_user;
DROP INDEX IF EXISTS public.idx_salary_v2_current;
DROP INDEX IF EXISTS public.idx_salary_v2_company;
DROP INDEX IF EXISTS public.idx_salary_config_user;
DROP INDEX IF EXISTS public.idx_salary_config_payment_frequency;
DROP INDEX IF EXISTS public.idx_salary_config_next_review;
DROP INDEX IF EXISTS public.idx_salary_config_company;
DROP INDEX IF EXISTS public.idx_salary_categories_v2_agreement;
DROP INDEX IF EXISTS public.idx_run_concept_details_run;
DROP INDEX IF EXISTS public.idx_role_key_company;
DROP INDEX IF EXISTS public.idx_role_definitions_company;
DROP INDEX IF EXISTS public.idx_role_definitions_category;
DROP INDEX IF EXISTS public.idx_renewal_logs_created;
DROP INDEX IF EXISTS public.idx_renewal_logs_contract;
DROP INDEX IF EXISTS public.idx_redemption_user;
DROP INDEX IF EXISTS public.idx_redemption_supervisor;
DROP INDEX IF EXISTS public.idx_redemption_status;
DROP INDEX IF EXISTS public.idx_redemption_history_request;
DROP INDEX IF EXISTS public.idx_redemption_date;
DROP INDEX IF EXISTS public.idx_redemption_company;
DROP INDEX IF EXISTS public.idx_puntos_venta_company;
DROP INDEX IF EXISTS public.idx_puntos_venta_activo;
DROP INDEX IF EXISTS public.idx_psychiatric_user;
DROP INDEX IF EXISTS public.idx_psychiatric_current;
DROP INDEX IF EXISTS public.idx_psychiatric_company;
DROP INDEX IF EXISTS public.idx_professional_licenses_user;
DROP INDEX IF EXISTS public.idx_professional_licenses_suspended;
DROP INDEX IF EXISTS public.idx_professional_licenses_profession;
DROP INDEX IF EXISTS public.idx_professional_licenses_expiry;
DROP INDEX IF EXISTS public.idx_professional_licenses_company;
DROP INDEX IF EXISTS public.idx_professional_licenses_active;
DROP INDEX IF EXISTS public.idx_procedures_type;
DROP INDEX IF EXISTS public.idx_procedures_status;
DROP INDEX IF EXISTS public.idx_procedures_sector;
DROP INDEX IF EXISTS public.idx_procedures_scope_type;
DROP INDEX IF EXISTS public.idx_procedures_scope_entities;
DROP INDEX IF EXISTS public.idx_procedures_parent_status;
DROP INDEX IF EXISTS public.idx_procedures_parent;
DROP INDEX IF EXISTS public.idx_procedures_owners;
DROP INDEX IF EXISTS public.idx_procedures_hierarchy_path;
DROP INDEX IF EXISTS public.idx_procedures_hierarchy_level;
DROP INDEX IF EXISTS public.idx_procedures_draft_locked_by;
DROP INDEX IF EXISTS public.idx_procedures_draft_expires;
DROP INDEX IF EXISTS public.idx_procedures_department;
DROP INDEX IF EXISTS public.idx_procedures_company_level;
DROP INDEX IF EXISTS public.idx_procedures_company;
DROP INDEX IF EXISTS public.idx_procedures_code;
DROP INDEX IF EXISTS public.idx_procedures_branch;
DROP INDEX IF EXISTS public.idx_procedure_versions_status;
DROP INDEX IF EXISTS public.idx_procedure_versions_procedure;
DROP INDEX IF EXISTS public.idx_procedure_roles_procedure;
DROP INDEX IF EXISTS public.idx_procedure_roles_position;
DROP INDEX IF EXISTS public.idx_procedure_draft_locks_user;
DROP INDEX IF EXISTS public.idx_procedure_draft_locks_procedure;
DROP INDEX IF EXISTS public.idx_procedure_acks_user;
DROP INDEX IF EXISTS public.idx_procedure_acks_status;
DROP INDEX IF EXISTS public.idx_procedure_acks_procedure;
DROP INDEX IF EXISTS public.idx_primary_physician_user;
DROP INDEX IF EXISTS public.idx_pre_invoice_status;
DROP INDEX IF EXISTS public.idx_pre_invoice_contract;
DROP INDEX IF EXISTS public.idx_pre_invoice_company;
DROP INDEX IF EXISTS public.idx_pre_invoice_code;
DROP INDEX IF EXISTS public.idx_ppe_stats_company_date;
DROP INDEX IF EXISTS public.idx_ppe_detections_timestamp;
DROP INDEX IF EXISTS public.idx_ppe_detections_status;
DROP INDEX IF EXISTS public.idx_ppe_detections_missing;
DROP INDEX IF EXISTS public.idx_ppe_detections_company;
DROP INDEX IF EXISTS public.idx_permission_requests_user;
DROP INDEX IF EXISTS public.idx_permission_requests_status;
DROP INDEX IF EXISTS public.idx_permission_requests_company;
DROP INDEX IF EXISTS public.idx_pct_status;
DROP INDEX IF EXISTS public.idx_pct_reference;
DROP INDEX IF EXISTS public.idx_pct_partner_id;
DROP INDEX IF EXISTS public.idx_pct_date;
DROP INDEX IF EXISTS public.idx_pct_company;
DROP INDEX IF EXISTS public.idx_pcs_status;
DROP INDEX IF EXISTS public.idx_pcs_partner_period;
DROP INDEX IF EXISTS public.idx_payslip_templates_country;
DROP INDEX IF EXISTS public.idx_payslip_templates_company;
DROP INDEX IF EXISTS public.idx_payslip_templates_active;
DROP INDEX IF EXISTS public.idx_payroll_user;
DROP INDEX IF EXISTS public.idx_payroll_templates_country;
DROP INDEX IF EXISTS public.idx_payroll_templates_company;
DROP INDEX IF EXISTS public.idx_payroll_templates_branch;
DROP INDEX IF EXISTS public.idx_payroll_status;
DROP INDEX IF EXISTS public.idx_payroll_runs_period;
DROP INDEX IF EXISTS public.idx_payroll_runs_company;
DROP INDEX IF EXISTS public.idx_payroll_run_details_user;
DROP INDEX IF EXISTS public.idx_payroll_run_details_snapshot_gin;
DROP INDEX IF EXISTS public.idx_payroll_run_details_run;
DROP INDEX IF EXISTS public.idx_payroll_period;
DROP INDEX IF EXISTS public.idx_payroll_entities_type;
DROP INDEX IF EXISTS public.idx_payroll_entities_country;
DROP INDEX IF EXISTS public.idx_payroll_entities_company;
DROP INDEX IF EXISTS public.idx_payroll_entities_code;
DROP INDEX IF EXISTS public.idx_payroll_entities_category;
DROP INDEX IF EXISTS public.idx_payroll_countries_privacy_law;
DROP INDEX IF EXISTS public.idx_payroll_countries_gdpr;
DROP INDEX IF EXISTS public.idx_payroll_company;
DROP INDEX IF EXISTS public.idx_patterns_user;
DROP INDEX IF EXISTS public.idx_patterns_severity;
DROP INDEX IF EXISTS public.idx_patterns_pattern_id;
DROP INDEX IF EXISTS public.idx_patterns_company_active;
DROP INDEX IF EXISTS public.idx_patterns_category;
DROP INDEX IF EXISTS public.idx_password_auth_timestamp;
DROP INDEX IF EXISTS public.idx_password_auth_requires_review;
DROP INDEX IF EXISTS public.idx_password_auth_employee;
DROP INDEX IF EXISTS public.idx_password_auth_company;
DROP INDEX IF EXISTS public.idx_partners_username;
DROP INDEX IF EXISTS public.idx_partners_pending_consents;
DROP INDEX IF EXISTS public.idx_partners_email_verified;
DROP INDEX IF EXISTS public.idx_partners_email_auth;
DROP INDEX IF EXISTS public.idx_partners_email;
DROP INDEX IF EXISTS public.idx_partners_dni_auth;
DROP INDEX IF EXISTS public.idx_partners_dni;
DROP INDEX IF EXISTS public.idx_partners_approval_status;
DROP INDEX IF EXISTS public.idx_partners_account_status;
DROP INDEX IF EXISTS public.idx_partner_commissions_partner_id;
DROP INDEX IF EXISTS public.idx_partner_commissions_active;
DROP INDEX IF EXISTS public.idx_org_positions_template;
DROP INDEX IF EXISTS public.idx_org_positions_parent;
DROP INDEX IF EXISTS public.idx_org_positions_hierarchy_level;
DROP INDEX IF EXISTS public.idx_org_positions_company;
DROP INDEX IF EXISTS public.idx_org_positions_branch;
DROP INDEX IF EXISTS public.idx_org_positions_active;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_status;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_number;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_incident_date;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_employee;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_deleted;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_country;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_company;
DROP INDEX IF EXISTS public.idx_oh_wc_claims_claim_type;
DROP INDEX IF EXISTS public.idx_oh_screenings_valid_until;
DROP INDEX IF EXISTS public.idx_oh_screenings_type;
DROP INDEX IF EXISTS public.idx_oh_screenings_status;
DROP INDEX IF EXISTS public.idx_oh_screenings_scheduled_date;
DROP INDEX IF EXISTS public.idx_oh_screenings_overall_result;
DROP INDEX IF EXISTS public.idx_oh_screenings_country;
DROP INDEX IF EXISTS public.idx_oh_screenings_company;
DROP INDEX IF EXISTS public.idx_oh_screenings_candidate_email;
DROP INDEX IF EXISTS public.idx_oh_screenings_approved;
DROP INDEX IF EXISTS public.idx_oh_screening_types_region;
DROP INDEX IF EXISTS public.idx_oh_screening_types_country;
DROP INDEX IF EXISTS public.idx_oh_screening_types_code;
DROP INDEX IF EXISTS public.idx_oh_screening_types_active;
DROP INDEX IF EXISTS public.idx_oh_results_status;
DROP INDEX IF EXISTS public.idx_oh_results_screening;
DROP INDEX IF EXISTS public.idx_oh_results_company;
DROP INDEX IF EXISTS public.idx_oh_results_category;
DROP INDEX IF EXISTS public.idx_oh_results_attention;
DROP INDEX IF EXISTS public.idx_oh_docs_type;
DROP INDEX IF EXISTS public.idx_oh_docs_status;
DROP INDEX IF EXISTS public.idx_oh_docs_screening;
DROP INDEX IF EXISTS public.idx_oh_docs_company;
DROP INDEX IF EXISTS public.idx_oh_config_country;
DROP INDEX IF EXISTS public.idx_oh_config_company;
DROP INDEX IF EXISTS public.idx_oh_config_active;
DROP INDEX IF EXISTS public.idx_oh_claim_types_region;
DROP INDEX IF EXISTS public.idx_oh_claim_types_active;
DROP INDEX IF EXISTS public.idx_oh_claim_history_date;
DROP INDEX IF EXISTS public.idx_oh_claim_history_claim;
DROP INDEX IF EXISTS public.idx_oh_claim_docs_type;
DROP INDEX IF EXISTS public.idx_oh_claim_docs_claim;
DROP INDEX IF EXISTS public.idx_numeracion_tipo;
DROP INDEX IF EXISTS public.idx_numeracion_caja;
DROP INDEX IF EXISTS public.idx_notifications_related_entity;
DROP INDEX IF EXISTS public.idx_notifications_recipient;
DROP INDEX IF EXISTS public.idx_notifications_priority;
DROP INDEX IF EXISTS public.idx_notifications_metadata_gin;
DROP INDEX IF EXISTS public.idx_notifications_escalation;
DROP INDEX IF EXISTS public.idx_notifications_company_module;
DROP INDEX IF EXISTS public.idx_notifications_action_status;
DROP INDEX IF EXISTS public.idx_notification_templates_module;
DROP INDEX IF EXISTS public.idx_notification_actions_user;
DROP INDEX IF EXISTS public.idx_notification_actions_type;
DROP INDEX IF EXISTS public.idx_notification_actions_notification;
DROP INDEX IF EXISTS public.idx_notification_actions_company;
DROP INDEX IF EXISTS public.idx_notif_threads_commercial;
DROP INDEX IF EXISTS public.idx_notif_msg_sla_breach;
DROP INDEX IF EXISTS public.idx_notif_msg_sender;
DROP INDEX IF EXISTS public.idx_notif_msg_requires_response;
DROP INDEX IF EXISTS public.idx_notif_msg_recipient;
DROP INDEX IF EXISTS public.idx_notif_msg_escalation;
DROP INDEX IF EXISTS public.idx_notif_msg_deadline;
DROP INDEX IF EXISTS public.idx_modules_registry_provides_to;
DROP INDEX IF EXISTS public.idx_modules_registry_key;
DROP INDEX IF EXISTS public.idx_modules_registry_dependencies;
DROP INDEX IF EXISTS public.idx_modules_registry_category;
DROP INDEX IF EXISTS public.idx_modules_registry_active;
DROP INDEX IF EXISTS public.idx_medications_user;
DROP INDEX IF EXISTS public.idx_medications_company;
DROP INDEX IF EXISTS public.idx_medical_templates_type;
DROP INDEX IF EXISTS public.idx_medical_templates_company;
DROP INDEX IF EXISTS public.idx_medical_templates_active;
DROP INDEX IF EXISTS public.idx_medical_records_type;
DROP INDEX IF EXISTS public.idx_medical_records_result;
DROP INDEX IF EXISTS public.idx_medical_records_locked;
DROP INDEX IF EXISTS public.idx_medical_records_expiration;
DROP INDEX IF EXISTS public.idx_medical_records_exam_date;
DROP INDEX IF EXISTS public.idx_medical_records_employee;
DROP INDEX IF EXISTS public.idx_medical_records_editable;
DROP INDEX IF EXISTS public.idx_medical_records_deleted;
DROP INDEX IF EXISTS public.idx_medical_records_company;
DROP INDEX IF EXISTS public.idx_medical_records_active;
DROP INDEX IF EXISTS public.idx_medical_leaves_user;
DROP INDEX IF EXISTS public.idx_medical_leaves_status;
DROP INDEX IF EXISTS public.idx_medical_leaves_dates;
DROP INDEX IF EXISTS public.idx_medical_leaves_company;
DROP INDEX IF EXISTS public.idx_medical_exams_user;
DROP INDEX IF EXISTS public.idx_medical_exams_company;
DROP INDEX IF EXISTS public.idx_medical_documents_user;
DROP INDEX IF EXISTS public.idx_medical_documents_company;
DROP INDEX IF EXISTS public.idx_medical_comm_unread;
DROP INDEX IF EXISTS public.idx_medical_comm_sender;
DROP INDEX IF EXISTS public.idx_medical_comm_receiver;
DROP INDEX IF EXISTS public.idx_medical_comm_company;
DROP INDEX IF EXISTS public.idx_medical_comm_case;
DROP INDEX IF EXISTS public.idx_medical_certificates_user;
DROP INDEX IF EXISTS public.idx_medical_certificates_status;
DROP INDEX IF EXISTS public.idx_medical_certificates_dates;
DROP INDEX IF EXISTS public.idx_medical_certificates_company;
DROP INDEX IF EXISTS public.idx_medical_auth_status;
DROP INDEX IF EXISTS public.idx_medical_auth_requested_by;
DROP INDEX IF EXISTS public.idx_medical_auth_record;
DROP INDEX IF EXISTS public.idx_medical_auth_pending;
DROP INDEX IF EXISTS public.idx_medical_auth_notification;
DROP INDEX IF EXISTS public.idx_medical_auth_company;
DROP INDEX IF EXISTS public.idx_medical_auth_authorized_by;
DROP INDEX IF EXISTS public.idx_medical_audit_timeline;
DROP INDEX IF EXISTS public.idx_medical_audit_record;
DROP INDEX IF EXISTS public.idx_medical_audit_company;
DROP INDEX IF EXISTS public.idx_medical_audit_authorization;
DROP INDEX IF EXISTS public.idx_medical_audit_action_by;
DROP INDEX IF EXISTS public.idx_medical_audit_action_at;
DROP INDEX IF EXISTS public.idx_medical_audit_action;
DROP INDEX IF EXISTS public.idx_marital_status_user;
DROP INDEX IF EXISTS public.idx_mapping_thread;
DROP INDEX IF EXISTS public.idx_mapping_recipient;
DROP INDEX IF EXISTS public.idx_mapping_outbound_id;
DROP INDEX IF EXISTS public.idx_mapping_notification;
DROP INDEX IF EXISTS public.idx_mapping_group;
DROP INDEX IF EXISTS public.idx_loans_user;
DROP INDEX IF EXISTS public.idx_loans_status;
DROP INDEX IF EXISTS public.idx_legal_timeline_type;
DROP INDEX IF EXISTS public.idx_legal_timeline_milestone;
DROP INDEX IF EXISTS public.idx_legal_timeline_date;
DROP INDEX IF EXISTS public.idx_legal_timeline_case;
DROP INDEX IF EXISTS public.idx_legal_stages_stage;
DROP INDEX IF EXISTS public.idx_legal_stages_case;
DROP INDEX IF EXISTS public.idx_legal_parties_type;
DROP INDEX IF EXISTS public.idx_legal_parties_case;
DROP INDEX IF EXISTS public.idx_legal_issues_user;
DROP INDEX IF EXISTS public.idx_legal_issues_type;
DROP INDEX IF EXISTS public.idx_legal_issues_status;
DROP INDEX IF EXISTS public.idx_legal_issues_employment;
DROP INDEX IF EXISTS public.idx_legal_issues_company;
DROP INDEX IF EXISTS public.idx_legal_docs_version;
DROP INDEX IF EXISTS public.idx_legal_docs_type;
DROP INDEX IF EXISTS public.idx_legal_docs_date;
DROP INDEX IF EXISTS public.idx_legal_docs_company_active;
DROP INDEX IF EXISTS public.idx_legal_docs_case;
DROP INDEX IF EXISTS public.idx_legal_doc_alerts_unresolved;
DROP INDEX IF EXISTS public.idx_legal_doc_alerts_due;
DROP INDEX IF EXISTS public.idx_legal_doc_alerts_company;
DROP INDEX IF EXISTS public.idx_legal_deadlines_status;
DROP INDEX IF EXISTS public.idx_legal_deadlines_pending;
DROP INDEX IF EXISTS public.idx_legal_deadlines_due;
DROP INDEX IF EXISTS public.idx_legal_deadlines_company;
DROP INDEX IF EXISTS public.idx_legal_deadlines_case;
DROP INDEX IF EXISTS public.idx_legal_deadlines_assigned;
DROP INDEX IF EXISTS public.idx_legal_comm_types_severity;
DROP INDEX IF EXISTS public.idx_legal_comm_types_category;
DROP INDEX IF EXISTS public.idx_legal_comm_types_active;
DROP INDEX IF EXISTS public.idx_legal_comm_type;
DROP INDEX IF EXISTS public.idx_legal_comm_status;
DROP INDEX IF EXISTS public.idx_legal_comm_reference;
DROP INDEX IF EXISTS public.idx_legal_comm_employee;
DROP INDEX IF EXISTS public.idx_legal_comm_deadline;
DROP INDEX IF EXISTS public.idx_legal_comm_created;
DROP INDEX IF EXISTS public.idx_legal_comm_company;
DROP INDEX IF EXISTS public.idx_legal_cases_type;
DROP INDEX IF EXISTS public.idx_legal_cases_stage;
DROP INDEX IF EXISTS public.idx_legal_cases_employee;
DROP INDEX IF EXISTS public.idx_legal_cases_dates;
DROP INDEX IF EXISTS public.idx_legal_cases_company;
DROP INDEX IF EXISTS public.idx_legal_cases_assigned;
DROP INDEX IF EXISTS public.idx_legal_cases_active;
DROP INDEX IF EXISTS public.idx_legal_auth_status;
DROP INDEX IF EXISTS public.idx_legal_auth_requested_by;
DROP INDEX IF EXISTS public.idx_legal_auth_record;
DROP INDEX IF EXISTS public.idx_legal_auth_pending_step;
DROP INDEX IF EXISTS public.idx_legal_auth_notification;
DROP INDEX IF EXISTS public.idx_legal_auth_company;
DROP INDEX IF EXISTS public.idx_legal_auth_authorized_by;
DROP INDEX IF EXISTS public.idx_legal_ai_type;
DROP INDEX IF EXISTS public.idx_legal_ai_company;
DROP INDEX IF EXISTS public.idx_legal_ai_case;
DROP INDEX IF EXISTS public.idx_learning_patterns_module;
DROP INDEX IF EXISTS public.idx_learned_responses_temporal;
DROP INDEX IF EXISTS public.idx_learned_responses_keywords;
DROP INDEX IF EXISTS public.idx_learned_responses_confidence;
DROP INDEX IF EXISTS public.idx_learned_responses_company;
DROP INDEX IF EXISTS public.idx_learned_responses_category;
DROP INDEX IF EXISTS public.idx_late_arrival_auth_status;
DROP INDEX IF EXISTS public.idx_late_arrival_auth_employee;
DROP INDEX IF EXISTS public.idx_late_arrival_auth_date;
DROP INDEX IF EXISTS public.idx_late_arrival_auth_company;
DROP INDEX IF EXISTS public.idx_late_arrival_auth_authorizer;
DROP INDEX IF EXISTS public.idx_labor_agreements_v2_country;
DROP INDEX IF EXISTS public.idx_labor_agreements_v2_company;
DROP INDEX IF EXISTS public.idx_knowledge_base_verified;
DROP INDEX IF EXISTS public.idx_knowledge_base_question_normalized;
DROP INDEX IF EXISTS public.idx_knowledge_base_module_name;
DROP INDEX IF EXISTS public.idx_knowledge_base_helpful;
DROP INDEX IF EXISTS public.idx_knowledge_base_created_at;
DROP INDEX IF EXISTS public.idx_knowledge_base_company_module_helpful;
DROP INDEX IF EXISTS public.idx_knowledge_base_company_id;
DROP INDEX IF EXISTS public.idx_kiosks_unique_gps_per_company;
DROP INDEX IF EXISTS public.idx_kiosks_is_configured;
DROP INDEX IF EXISTS public.idx_kiosks_is_active;
DROP INDEX IF EXISTS public.idx_kiosks_gps;
DROP INDEX IF EXISTS public.idx_kiosks_company_id;
DROP INDEX IF EXISTS public.idx_kb_question_trgm;
DROP INDEX IF EXISTS public.idx_job_postings_status;
DROP INDEX IF EXISTS public.idx_job_postings_department;
DROP INDEX IF EXISTS public.idx_job_postings_company;
DROP INDEX IF EXISTS public.idx_job_postings_active;
DROP INDEX IF EXISTS public.idx_job_applications_status;
DROP INDEX IF EXISTS public.idx_job_applications_posting;
DROP INDEX IF EXISTS public.idx_job_applications_pending_medical;
DROP INDEX IF EXISTS public.idx_job_applications_hired;
DROP INDEX IF EXISTS public.idx_job_applications_email;
DROP INDEX IF EXISTS public.idx_job_applications_dni;
DROP INDEX IF EXISTS public.idx_job_applications_company;
DROP INDEX IF EXISTS public.idx_job_app_notes_application;
DROP INDEX IF EXISTS public.idx_inbound_to_email;
DROP INDEX IF EXISTS public.idx_inbound_status;
DROP INDEX IF EXISTS public.idx_inbound_message_id;
DROP INDEX IF EXISTS public.idx_inbound_linked_thread;
DROP INDEX IF EXISTS public.idx_inbound_linked_notification;
DROP INDEX IF EXISTS public.idx_inbound_in_reply_to;
DROP INDEX IF EXISTS public.idx_inbound_from_email;
DROP INDEX IF EXISTS public.idx_inbound_created_at;
DROP INDEX IF EXISTS public.idx_hse_cases_violations;
DROP INDEX IF EXISTS public.idx_hse_cases_type;
DROP INDEX IF EXISTS public.idx_hse_cases_status;
DROP INDEX IF EXISTS public.idx_hse_cases_created;
DROP INDEX IF EXISTS public.idx_hse_cases_company;
DROP INDEX IF EXISTS public.idx_household_user_id;
DROP INDEX IF EXISTS public.idx_household_relationship;
DROP INDEX IF EXISTS public.idx_holidays_year;
DROP INDEX IF EXISTS public.idx_holidays_date;
DROP INDEX IF EXISTS public.idx_holidays_country_state_date;
DROP INDEX IF EXISTS public.idx_holidays_country_date;
DROP INDEX IF EXISTS public.idx_holidays_country;
DROP INDEX IF EXISTS public.idx_hbtx_user;
DROP INDEX IF EXISTS public.idx_hbtx_type;
DROP INDEX IF EXISTS public.idx_hbtx_status;
DROP INDEX IF EXISTS public.idx_hbtx_expires;
DROP INDEX IF EXISTS public.idx_hbtx_created;
DROP INDEX IF EXISTS public.idx_hbtx_company;
DROP INDEX IF EXISTS public.idx_hbt_unique_code;
DROP INDEX IF EXISTS public.idx_hbt_country;
DROP INDEX IF EXISTS public.idx_hbt_company;
DROP INDEX IF EXISTS public.idx_hbt_branch;
DROP INDEX IF EXISTS public.idx_hbr_user;
DROP INDEX IF EXISTS public.idx_hbr_status;
DROP INDEX IF EXISTS public.idx_hbr_date;
DROP INDEX IF EXISTS public.idx_hbr_company;
DROP INDEX IF EXISTS public.idx_hbpd_user;
DROP INDEX IF EXISTS public.idx_hbpd_status;
DROP INDEX IF EXISTS public.idx_hbpd_expires;
DROP INDEX IF EXISTS public.idx_hbbd_dates;
DROP INDEX IF EXISTS public.idx_hbbd_company;
DROP INDEX IF EXISTS public.idx_hbb_user;
DROP INDEX IF EXISTS public.idx_hbb_expiry;
DROP INDEX IF EXISTS public.idx_hbb_company;
DROP INDEX IF EXISTS public.idx_hba_user;
DROP INDEX IF EXISTS public.idx_hba_active;
DROP INDEX IF EXISTS public.idx_hb_risk_vicious;
DROP INDEX IF EXISTS public.idx_hb_risk_user;
DROP INDEX IF EXISTS public.idx_hb_risk_score;
DROP INDEX IF EXISTS public.idx_hb_risk_company;
DROP INDEX IF EXISTS public.idx_hb_metrics_period;
DROP INDEX IF EXISTS public.idx_hb_metrics_level;
DROP INDEX IF EXISTS public.idx_hb_metrics_company;
DROP INDEX IF EXISTS public.idx_hb_budgets_status;
DROP INDEX IF EXISTS public.idx_hb_budgets_period;
DROP INDEX IF EXISTS public.idx_hb_budgets_company;
DROP INDEX IF EXISTS public.idx_habits_user;
DROP INDEX IF EXISTS public.idx_habits_company;
DROP INDEX IF EXISTS public.idx_fiscal_config_cuit;
DROP INDEX IF EXISTS public.idx_fiscal_config_company;
DROP INDEX IF EXISTS public.idx_fiscal_config_active;
DROP INDEX IF EXISTS public.idx_fingerprint_user_id;
DROP INDEX IF EXISTS public.idx_fingerprint_company_id;
DROP INDEX IF EXISTS public.idx_faq_patterns_category;
DROP INDEX IF EXISTS public.idx_faq_patterns_active;
DROP INDEX IF EXISTS public.idx_family_members_user;
DROP INDEX IF EXISTS public.idx_family_members_company;
DROP INDEX IF EXISTS public.idx_facturas_tipo_afip;
DROP INDEX IF EXISTS public.idx_facturas_punto_venta;
DROP INDEX IF EXISTS public.idx_facturas_pagos_forma;
DROP INDEX IF EXISTS public.idx_facturas_pagos_factura;
DROP INDEX IF EXISTS public.idx_facturas_pagos_estado;
DROP INDEX IF EXISTS public.idx_facturas_numero_completo;
DROP INDEX IF EXISTS public.idx_facturas_items_producto_id;
DROP INDEX IF EXISTS public.idx_facturas_items_factura;
DROP INDEX IF EXISTS public.idx_facturas_items_codigo;
DROP INDEX IF EXISTS public.idx_facturas_impuestos_tipo;
DROP INDEX IF EXISTS public.idx_facturas_impuestos_factura;
DROP INDEX IF EXISTS public.idx_facturas_fecha;
DROP INDEX IF EXISTS public.idx_facturas_estado_afip;
DROP INDEX IF EXISTS public.idx_facturas_estado;
DROP INDEX IF EXISTS public.idx_facturas_cliente_id;
DROP INDEX IF EXISTS public.idx_facturas_cliente_cuit;
DROP INDEX IF EXISTS public.idx_facturas_caja;
DROP INDEX IF EXISTS public.idx_facturas_cae;
DROP INDEX IF EXISTS public.idx_facial_user_id;
DROP INDEX IF EXISTS public.idx_facial_company_id;
DROP INDEX IF EXISTS public.idx_facial_active;
DROP INDEX IF EXISTS public.idx_extraordinary_license_type;
DROP INDEX IF EXISTS public.idx_extraordinary_license_company;
DROP INDEX IF EXISTS public.idx_extraordinary_license_active;
DROP INDEX IF EXISTS public.idx_escalations_ticket;
DROP INDEX IF EXISTS public.idx_escalations_created;
DROP INDEX IF EXISTS public.idx_epp_role_req_position;
DROP INDEX IF EXISTS public.idx_epp_role_req_company;
DROP INDEX IF EXISTS public.idx_epp_role_req_catalog;
DROP INDEX IF EXISTS public.idx_epp_inspections_delivery;
DROP INDEX IF EXISTS public.idx_epp_inspections_date;
DROP INDEX IF EXISTS public.idx_epp_deliveries_status;
DROP INDEX IF EXISTS public.idx_epp_deliveries_expiring;
DROP INDEX IF EXISTS public.idx_epp_deliveries_employee;
DROP INDEX IF EXISTS public.idx_epp_deliveries_company;
DROP INDEX IF EXISTS public.idx_epp_deliveries_catalog;
DROP INDEX IF EXISTS public.idx_epp_catalog_company;
DROP INDEX IF EXISTS public.idx_epp_catalog_category;
DROP INDEX IF EXISTS public.idx_entity_settlements_unique;
DROP INDEX IF EXISTS public.idx_entity_settlements_status;
DROP INDEX IF EXISTS public.idx_entity_settlements_period;
DROP INDEX IF EXISTS public.idx_entity_settlements_entity;
DROP INDEX IF EXISTS public.idx_entity_settlements_company;
DROP INDEX IF EXISTS public.idx_entity_settlement_details_user;
DROP INDEX IF EXISTS public.idx_entity_settlement_details_settlement;
DROP INDEX IF EXISTS public.idx_entity_categories_flow;
DROP INDEX IF EXISTS public.idx_entity_categories_country;
DROP INDEX IF EXISTS public.idx_entity_categories_company;
DROP INDEX IF EXISTS public.idx_employee_doc_user_type;
DROP INDEX IF EXISTS public.idx_employee_doc_number;
DROP INDEX IF EXISTS public.idx_employee_doc_expiry;
DROP INDEX IF EXISTS public.idx_employee_doc_alerts;
DROP INDEX IF EXISTS public.idx_employee_benefits_status;
DROP INDEX IF EXISTS public.idx_employee_benefits_policy;
DROP INDEX IF EXISTS public.idx_employee_benefits_employee;
DROP INDEX IF EXISTS public.idx_employee_benefits_company;
DROP INDEX IF EXISTS public.idx_employee_benefits_active_dates;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_user;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_status;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_family;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_expiration;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_dependency;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_current;
DROP INDEX IF EXISTS public.idx_emp_dep_docs_company;
DROP INDEX IF EXISTS public.idx_emp_cert_type;
DROP INDEX IF EXISTS public.idx_emp_cert_status;
DROP INDEX IF EXISTS public.idx_emp_cert_expiration;
DROP INDEX IF EXISTS public.idx_emp_cert_employee;
DROP INDEX IF EXISTS public.idx_emp_cert_company;
DROP INDEX IF EXISTS public.idx_emp_cert_alerts;
DROP INDEX IF EXISTS public.idx_emp_cert_active;
DROP INDEX IF EXISTS public.idx_emotional_analysis_user_time;
DROP INDEX IF EXISTS public.idx_emotional_analysis_timestamp;
DROP INDEX IF EXISTS public.idx_emotional_analysis_fatigue;
DROP INDEX IF EXISTS public.idx_emergency_user_id;
DROP INDEX IF EXISTS public.idx_emergency_priority;
DROP INDEX IF EXISTS public.idx_email_verification_user;
DROP INDEX IF EXISTS public.idx_email_verification_token;
DROP INDEX IF EXISTS public.idx_email_verification_expires;
DROP INDEX IF EXISTS public.idx_email_templates_key;
DROP INDEX IF EXISTS public.idx_email_templates_company;
DROP INDEX IF EXISTS public.idx_email_templates_category;
DROP INDEX IF EXISTS public.idx_email_logs_tracking;
DROP INDEX IF EXISTS public.idx_email_logs_status;
DROP INDEX IF EXISTS public.idx_email_logs_sender;
DROP INDEX IF EXISTS public.idx_email_logs_recipient;
DROP INDEX IF EXISTS public.idx_email_logs_created;
DROP INDEX IF EXISTS public.idx_email_logs_category;
DROP INDEX IF EXISTS public.idx_email_config_email;
DROP INDEX IF EXISTS public.idx_email_config_company;
DROP INDEX IF EXISTS public.idx_email_config_active;
DROP INDEX IF EXISTS public.idx_education_user;
DROP INDEX IF EXISTS public.idx_education_company;
DROP INDEX IF EXISTS public.idx_ecosystem_workflows_module;
DROP INDEX IF EXISTS public.idx_ecosystem_tasks_status;
DROP INDEX IF EXISTS public.idx_ecosystem_tasks_phase;
DROP INDEX IF EXISTS public.idx_ecosystem_tasks_module;
DROP INDEX IF EXISTS public.idx_ecosystem_file_cache_valid;
DROP INDEX IF EXISTS public.idx_ecosystem_file_cache_type;
DROP INDEX IF EXISTS public.idx_driver_licenses_user;
DROP INDEX IF EXISTS public.idx_driver_licenses_type;
DROP INDEX IF EXISTS public.idx_driver_licenses_expiry;
DROP INDEX IF EXISTS public.idx_driver_licenses_company;
DROP INDEX IF EXISTS public.idx_driver_licenses_active;
DROP INDEX IF EXISTS public.idx_dms_workflows_company;
DROP INDEX IF EXISTS public.idx_dms_workflows;
DROP INDEX IF EXISTS public.idx_dms_versions;
DROP INDEX IF EXISTS public.idx_dms_requests_company;
DROP INDEX IF EXISTS public.idx_dms_requests;
DROP INDEX IF EXISTS public.idx_dms_permissions;
DROP INDEX IF EXISTS public.idx_dms_metadata;
DROP INDEX IF EXISTS public.idx_dms_folders_parent;
DROP INDEX IF EXISTS public.idx_dms_folders_owner;
DROP INDEX IF EXISTS public.idx_dms_folders_company;
DROP INDEX IF EXISTS public.idx_dms_documents_source_module;
DROP INDEX IF EXISTS public.idx_dms_documents_source_entity;
DROP INDEX IF EXISTS public.idx_dms_documents_owner_module;
DROP INDEX IF EXISTS public.idx_dms_docs_user_active;
DROP INDEX IF EXISTS public.idx_dms_docs_tags;
DROP INDEX IF EXISTS public.idx_dms_docs_status;
DROP INDEX IF EXISTS public.idx_dms_docs_source;
DROP INDEX IF EXISTS public.idx_dms_docs_search;
DROP INDEX IF EXISTS public.idx_dms_docs_owner;
DROP INDEX IF EXISTS public.idx_dms_docs_folder;
DROP INDEX IF EXISTS public.idx_dms_docs_expiration;
DROP INDEX IF EXISTS public.idx_dms_docs_company;
DROP INDEX IF EXISTS public.idx_dms_docs_category;
DROP INDEX IF EXISTS public.idx_dms_docs_active;
DROP INDEX IF EXISTS public.idx_dms_approvals_company;
DROP INDEX IF EXISTS public.idx_dms_approvals;
DROP INDEX IF EXISTS public.idx_dms_alerts_company;
DROP INDEX IF EXISTS public.idx_dms_alerts;
DROP INDEX IF EXISTS public.idx_dms_access_user;
DROP INDEX IF EXISTS public.idx_dms_access_document;
DROP INDEX IF EXISTS public.idx_dms_access_company;
DROP INDEX IF EXISTS public.idx_dms_access_action;
DROP INDEX IF EXISTS public.idx_disciplinary_actions_user;
DROP INDEX IF EXISTS public.idx_disciplinary_actions_company;
DROP INDEX IF EXISTS public.idx_detections_timestamp;
DROP INDEX IF EXISTS public.idx_detections_registered;
DROP INDEX IF EXISTS public.idx_detections_employee;
DROP INDEX IF EXISTS public.idx_detections_company_time;
DROP INDEX IF EXISTS public.idx_detections_company;
DROP INDEX IF EXISTS public.idx_dept_aliases_alias;
DROP INDEX IF EXISTS public.idx_dependency_types_code;
DROP INDEX IF EXISTS public.idx_dependency_types_active;
DROP INDEX IF EXISTS public.idx_departments_name_lower;
DROP INDEX IF EXISTS public.idx_departments_default_kiosk_id;
DROP INDEX IF EXISTS public.idx_departments_company_id;
DROP INDEX IF EXISTS public.idx_departments_allow_gps_attendance;
DROP INDEX IF EXISTS public.idx_dep_evaluations_user;
DROP INDEX IF EXISTS public.idx_dep_evaluations_run;
DROP INDEX IF EXISTS public.idx_dep_evaluations_period;
DROP INDEX IF EXISTS public.idx_dep_evaluations_concept;
DROP INDEX IF EXISTS public.idx_dep_evaluations_company;
DROP INDEX IF EXISTS public.idx_contracts_vendor;
DROP INDEX IF EXISTS public.idx_contracts_trace_id;
DROP INDEX IF EXISTS public.idx_contracts_status;
DROP INDEX IF EXISTS public.idx_contracts_signed_at;
DROP INDEX IF EXISTS public.idx_contracts_renewal_alert;
DROP INDEX IF EXISTS public.idx_contracts_grace_period;
DROP INDEX IF EXISTS public.idx_contracts_end_date;
DROP INDEX IF EXISTS public.idx_contracts_dates;
DROP INDEX IF EXISTS public.idx_contracts_contract_code;
DROP INDEX IF EXISTS public.idx_contracts_company;
DROP INDEX IF EXISTS public.idx_contracts_budget;
DROP INDEX IF EXISTS public.idx_contracts_associate;
DROP INDEX IF EXISTS public.idx_contracts_asset;
DROP INDEX IF EXISTS public.idx_contracts_active;
DROP INDEX IF EXISTS public.idx_contract_types_category;
DROP INDEX IF EXISTS public.idx_contact_history_user;
DROP INDEX IF EXISTS public.idx_consents_user_company;
DROP INDEX IF EXISTS public.idx_consents_type;
DROP INDEX IF EXISTS public.idx_consents_token;
DROP INDEX IF EXISTS public.idx_consents_method;
DROP INDEX IF EXISTS public.idx_consents_expires;
DROP INDEX IF EXISTS public.idx_consents_company_status;
DROP INDEX IF EXISTS public.idx_consents_active;
DROP INDEX IF EXISTS public.idx_consent_definitions_roles;
DROP INDEX IF EXISTS public.idx_consent_definitions_key;
DROP INDEX IF EXISTS public.idx_consent_definitions_active;
DROP INDEX IF EXISTS public.idx_consent_change_log_user;
DROP INDEX IF EXISTS public.idx_consent_change_log_type;
DROP INDEX IF EXISTS public.idx_consent_change_log_company;
DROP INDEX IF EXISTS public.idx_consent_audit_user_consent;
DROP INDEX IF EXISTS public.idx_consent_audit_created_at;
DROP INDEX IF EXISTS public.idx_consciousness_log_type;
DROP INDEX IF EXISTS public.idx_consciousness_log_result;
DROP INDEX IF EXISTS public.idx_consciousness_log_module;
DROP INDEX IF EXISTS public.idx_consciousness_log_created;
DROP INDEX IF EXISTS public.idx_consciousness_log_company;
DROP INDEX IF EXISTS public.idx_concept_types_country;
DROP INDEX IF EXISTS public.idx_concept_types_company;
DROP INDEX IF EXISTS public.idx_concept_types_classification;
DROP INDEX IF EXISTS public.idx_concept_rates_type;
DROP INDEX IF EXISTS public.idx_concept_rates_effective;
DROP INDEX IF EXISTS public.idx_concept_rates_country;
DROP INDEX IF EXISTS public.idx_concept_dependencies_dependency;
DROP INDEX IF EXISTS public.idx_concept_dependencies_concept;
DROP INDEX IF EXISTS public.idx_concept_dependencies_company;
DROP INDEX IF EXISTS public.idx_comparative_time;
DROP INDEX IF EXISTS public.idx_comparative_measure;
DROP INDEX IF EXISTS public.idx_comparative_dimensions;
DROP INDEX IF EXISTS public.idx_comparative_cube;
DROP INDEX IF EXISTS public.idx_company_tax_config_company;
DROP INDEX IF EXISTS public.idx_company_tasks_template;
DROP INDEX IF EXISTS public.idx_company_tasks_company;
DROP INDEX IF EXISTS public.idx_company_tasks_category;
DROP INDEX IF EXISTS public.idx_company_tasks_active;
DROP INDEX IF EXISTS public.idx_company_support_assignments_vendor;
DROP INDEX IF EXISTS public.idx_company_support_assignments_company;
DROP INDEX IF EXISTS public.idx_company_support_assignments_active;
DROP INDEX IF EXISTS public.idx_company_risk_config;
DROP INDEX IF EXISTS public.idx_company_modules_system_module_id;
DROP INDEX IF EXISTS public.idx_company_modules_company_id;
DROP INDEX IF EXISTS public.idx_company_modules_bundled;
DROP INDEX IF EXISTS public.idx_company_modules_activo;
DROP INDEX IF EXISTS public.idx_company_medical_partner;
DROP INDEX IF EXISTS public.idx_company_medical_company;
DROP INDEX IF EXISTS public.idx_company_inbox_message_id;
DROP INDEX IF EXISTS public.idx_company_inbox_company;
DROP INDEX IF EXISTS public.idx_company_email_config_imap_enabled;
DROP INDEX IF EXISTS public.idx_company_email_config_company;
DROP INDEX IF EXISTS public.idx_company_email_config_bidirectional;
DROP INDEX IF EXISTS public.idx_company_dependencies_type;
DROP INDEX IF EXISTS public.idx_company_dependencies_company;
DROP INDEX IF EXISTS public.idx_company_dependencies_active;
DROP INDEX IF EXISTS public.idx_company_comms_status;
DROP INDEX IF EXISTS public.idx_company_comms_parent;
DROP INDEX IF EXISTS public.idx_company_comms_direction;
DROP INDEX IF EXISTS public.idx_company_comms_created;
DROP INDEX IF EXISTS public.idx_company_comms_company;
DROP INDEX IF EXISTS public.idx_company_branches_country;
DROP INDEX IF EXISTS public.idx_company_branches_company;
DROP INDEX IF EXISTS public.idx_company_benefits_company;
DROP INDEX IF EXISTS public.idx_company_benefits_benefit;
DROP INDEX IF EXISTS public.idx_company_benefits_active;
DROP INDEX IF EXISTS public.idx_companies_vendor;
DROP INDEX IF EXISTS public.idx_companies_tax_id;
DROP INDEX IF EXISTS public.idx_companies_support_vendor_active;
DROP INDEX IF EXISTS public.idx_companies_support_vendor;
DROP INDEX IF EXISTS public.idx_companies_support_sla_plan;
DROP INDEX IF EXISTS public.idx_companies_supervision;
DROP INDEX IF EXISTS public.idx_companies_status;
DROP INDEX IF EXISTS public.idx_companies_onboarding_trace;
DROP INDEX IF EXISTS public.idx_companies_onboarding_status;
DROP INDEX IF EXISTS public.idx_companies_modules_trial_gin;
DROP INDEX IF EXISTS public.idx_companies_license_type;
DROP INDEX IF EXISTS public.idx_companies_created_by_staff;
DROP INDEX IF EXISTS public.idx_companies_contact_email;
DROP INDEX IF EXISTS public.idx_companies_assigned_vendor_active;
DROP INDEX IF EXISTS public.idx_companies_assigned_vendor;
DROP INDEX IF EXISTS public.idx_comm_pay_vendor;
DROP INDEX IF EXISTS public.idx_comm_pay_trace_id;
DROP INDEX IF EXISTS public.idx_comm_pay_status;
DROP INDEX IF EXISTS public.idx_comm_pay_scheduled;
DROP INDEX IF EXISTS public.idx_comm_pay_liquidation;
DROP INDEX IF EXISTS public.idx_comm_pay_date;
DROP INDEX IF EXISTS public.idx_comm_pay_company;
DROP INDEX IF EXISTS public.idx_comm_pay_code;
DROP INDEX IF EXISTS public.idx_comm_pay_batch;
DROP INDEX IF EXISTS public.idx_comm_liq_type;
DROP INDEX IF EXISTS public.idx_comm_liq_trace_id;
DROP INDEX IF EXISTS public.idx_comm_liq_status;
DROP INDEX IF EXISTS public.idx_comm_liq_period;
DROP INDEX IF EXISTS public.idx_comm_liq_payment_date;
DROP INDEX IF EXISTS public.idx_comm_liq_invoice;
DROP INDEX IF EXISTS public.idx_comm_liq_date;
DROP INDEX IF EXISTS public.idx_comm_liq_company;
DROP INDEX IF EXISTS public.idx_comm_liq_breakdown_gin;
DROP INDEX IF EXISTS public.idx_clientes_zona;
DROP INDEX IF EXISTS public.idx_clientes_vendedor;
DROP INDEX IF EXISTS public.idx_clientes_provincia;
DROP INDEX IF EXISTS public.idx_clientes_pais;
DROP INDEX IF EXISTS public.idx_clientes_cuenta_corriente;
DROP INDEX IF EXISTS public.idx_clientes_condicion_fiscal;
DROP INDEX IF EXISTS public.idx_clientes_bloqueados;
DROP INDEX IF EXISTS public.idx_chronic_v2_user;
DROP INDEX IF EXISTS public.idx_chronic_v2_company;
DROP INDEX IF EXISTS public.idx_chronic_conditions_user;
DROP INDEX IF EXISTS public.idx_chronic_conditions_company;
DROP INDEX IF EXISTS public.idx_children_user;
DROP INDEX IF EXISTS public.idx_children_company;
DROP INDEX IF EXISTS public.idx_cert_types_category;
DROP INDEX IF EXISTS public.idx_cert_types_active;
DROP INDEX IF EXISTS public.idx_cert_alerts_type;
DROP INDEX IF EXISTS public.idx_cert_alerts_sent_at;
DROP INDEX IF EXISTS public.idx_cert_alerts_employee;
DROP INDEX IF EXISTS public.idx_cert_alerts_company;
DROP INDEX IF EXISTS public.idx_cert_alerts_certification;
DROP INDEX IF EXISTS public.idx_cajas_punto_venta;
DROP INDEX IF EXISTS public.idx_cajas_activo;
DROP INDEX IF EXISTS public.idx_cae_log_factura;
DROP INDEX IF EXISTS public.idx_cae_log_comprobante;
DROP INDEX IF EXISTS public.idx_cae_log_company;
DROP INDEX IF EXISTS public.idx_cae_log_cae;
DROP INDEX IF EXISTS public.idx_budgets_vendor;
DROP INDEX IF EXISTS public.idx_budgets_valid_until;
DROP INDEX IF EXISTS public.idx_budgets_trace_id;
DROP INDEX IF EXISTS public.idx_budgets_status;
DROP INDEX IF EXISTS public.idx_budgets_company;
DROP INDEX IF EXISTS public.idx_budgets_budget_code;
DROP INDEX IF EXISTS public.idx_branch_fiscal_punto_venta;
DROP INDEX IF EXISTS public.idx_branch_fiscal_company;
DROP INDEX IF EXISTS public.idx_branch_fiscal_active;
DROP INDEX IF EXISTS public.idx_biometric_templates_hash;
DROP INDEX IF EXISTS public.idx_biometric_templates_employee;
DROP INDEX IF EXISTS public.idx_biometric_templates_company;
DROP INDEX IF EXISTS public.idx_biometric_events_user_id;
DROP INDEX IF EXISTS public.idx_biometric_events_type;
DROP INDEX IF EXISTS public.idx_biometric_events_timestamp;
DROP INDEX IF EXISTS public.idx_biometric_events_company_id;
DROP INDEX IF EXISTS public.idx_biometric_devices_company;
DROP INDEX IF EXISTS public.idx_biometric_devices_active;
DROP INDEX IF EXISTS public.idx_biometric_attempts_user;
DROP INDEX IF EXISTS public.idx_biometric_attempts_timestamp;
DROP INDEX IF EXISTS public.idx_biometric_ai_template;
DROP INDEX IF EXISTS public.idx_biometric_ai_employee;
DROP INDEX IF EXISTS public.idx_biometric_ai_company_date;
DROP INDEX IF EXISTS public.idx_benefit_types_category;
DROP INDEX IF EXISTS public.idx_benefit_types_active;
DROP INDEX IF EXISTS public.idx_benefit_payroll_concept;
DROP INDEX IF EXISTS public.idx_benefit_payroll_company;
DROP INDEX IF EXISTS public.idx_benefit_payroll_benefit;
DROP INDEX IF EXISTS public.idx_benefit_docs_status;
DROP INDEX IF EXISTS public.idx_benefit_docs_requirement;
DROP INDEX IF EXISTS public.idx_benefit_docs_expiration;
DROP INDEX IF EXISTS public.idx_benefit_docs_benefit;
DROP INDEX IF EXISTS public.idx_benefit_doc_reqs_doctype;
DROP INDEX IF EXISTS public.idx_benefit_doc_reqs_benefit;
DROP INDEX IF EXISTS public.idx_benchmarks_unique;
DROP INDEX IF EXISTS public.idx_benchmarks_country;
DROP INDEX IF EXISTS public.idx_benchmarks_ciuo;
DROP INDEX IF EXISTS public.idx_benchmarks_category;
DROP INDEX IF EXISTS public.idx_auth_log_service;
DROP INDEX IF EXISTS public.idx_auth_log_expiration;
DROP INDEX IF EXISTS public.idx_auth_log_company;
DROP INDEX IF EXISTS public.idx_audit_timeline;
DROP INDEX IF EXISTS public.idx_audit_test_logs_status;
DROP INDEX IF EXISTS public.idx_audit_test_logs_module_name;
DROP INDEX IF EXISTS public.idx_audit_test_logs_metadata_gin;
DROP INDEX IF EXISTS public.idx_audit_test_logs_fix_applied;
DROP INDEX IF EXISTS public.idx_audit_test_logs_execution_status;
DROP INDEX IF EXISTS public.idx_audit_test_logs_execution_id;
DROP INDEX IF EXISTS public.idx_audit_test_logs_created_at;
DROP INDEX IF EXISTS public.idx_audit_test_logs_company_id;
DROP INDEX IF EXISTS public.idx_audit_logs_user_id;
DROP INDEX IF EXISTS public.idx_audit_logs_module_id;
DROP INDEX IF EXISTS public.idx_audit_logs_created_at;
DROP INDEX IF EXISTS public.idx_audit_logs_company_id;
DROP INDEX IF EXISTS public.idx_audit_logs_action;
DROP INDEX IF EXISTS public.idx_attendances_weather_pattern;
DROP INDEX IF EXISTS public.idx_attendances_origin_type;
DROP INDEX IF EXISTS public.idx_attendances_open_checkins;
DROP INDEX IF EXISTS public.idx_attendances_kiosk_id;
DROP INDEX IF EXISTS public.idx_attendances_date_weather;
DROP INDEX IF EXISTS public.idx_attendances_company;
DROP INDEX IF EXISTS public.idx_attendances_checkout_gps;
DROP INDEX IF EXISTS public.idx_attendances_checkin_gps;
DROP INDEX IF EXISTS public.idx_attendances_authorized_by;
DROP INDEX IF EXISTS public.idx_attendances_authorization_token;
DROP INDEX IF EXISTS public.idx_attendances_authorization_status;
DROP INDEX IF EXISTS public.idx_attendance_user_date_primary;
DROP INDEX IF EXISTS public.idx_attendance_rankings_unique;
DROP INDEX IF EXISTS public.idx_attendance_rankings_global;
DROP INDEX IF EXISTS public.idx_attendance_rankings_dept;
DROP INDEX IF EXISTS public.idx_attendance_profiles_user_company;
DROP INDEX IF EXISTS public.idx_attendance_profiles_updated;
DROP INDEX IF EXISTS public.idx_attendance_profiles_scoring;
DROP INDEX IF EXISTS public.idx_attendance_profiles_dept;
DROP INDEX IF EXISTS public.idx_attendance_profiles_category;
DROP INDEX IF EXISTS public.idx_attendance_incomplete;
DROP INDEX IF EXISTS public.idx_attendance_clock_in_fast;
DROP INDEX IF EXISTS public.idx_attendance_batch_processing;
DROP INDEX IF EXISTS public.idx_associates_regions;
DROP INDEX IF EXISTS public.idx_associates_rating;
DROP INDEX IF EXISTS public.idx_associates_category;
DROP INDEX IF EXISTS public.idx_associates_active;
DROP INDEX IF EXISTS public.idx_assignments_employee;
DROP INDEX IF EXISTS public.idx_assignments_contract;
DROP INDEX IF EXISTS public.idx_assignments_active;
DROP INDEX IF EXISTS public.idx_assigned_tasks_user;
DROP INDEX IF EXISTS public.idx_assigned_tasks_task;
DROP INDEX IF EXISTS public.idx_assigned_tasks_status;
DROP INDEX IF EXISTS public.idx_assigned_tasks_priority;
DROP INDEX IF EXISTS public.idx_assigned_tasks_due_date;
DROP INDEX IF EXISTS public.idx_assigned_tasks_company;
DROP INDEX IF EXISTS public.idx_assigned_tasks_assigned_by;
DROP INDEX IF EXISTS public.idx_assets_type;
DROP INDEX IF EXISTS public.idx_assets_status;
DROP INDEX IF EXISTS public.idx_assets_maintenance;
DROP INDEX IF EXISTS public.idx_assets_employee;
DROP INDEX IF EXISTS public.idx_assets_benefit;
DROP INDEX IF EXISTS public.idx_art_priority;
DROP INDEX IF EXISTS public.idx_art_active;
DROP INDEX IF EXISTS public.idx_approval_workflows_level;
DROP INDEX IF EXISTS public.idx_approval_workflows_benefit;
DROP INDEX IF EXISTS public.idx_approval_history_decision;
DROP INDEX IF EXISTS public.idx_approval_history_benefit;
DROP INDEX IF EXISTS public.idx_approval_history_approver;
DROP INDEX IF EXISTS public.idx_aponnt_staff_vendors;
DROP INDEX IF EXISTS public.idx_aponnt_staff_user;
DROP INDEX IF EXISTS public.idx_aponnt_staff_role_active;
DROP INDEX IF EXISTS public.idx_aponnt_staff_role;
DROP INDEX IF EXISTS public.idx_aponnt_staff_reports_to_active;
DROP INDEX IF EXISTS public.idx_aponnt_staff_reports_to;
DROP INDEX IF EXISTS public.idx_aponnt_staff_level;
DROP INDEX IF EXISTS public.idx_aponnt_staff_email;
DROP INDEX IF EXISTS public.idx_aponnt_staff_country;
DROP INDEX IF EXISTS public.idx_aponnt_staff_area_country;
DROP INDEX IF EXISTS public.idx_aponnt_email_active;
DROP INDEX IF EXISTS public.idx_anthropometric_user;
DROP INDEX IF EXISTS public.idx_anthropometric_date;
DROP INDEX IF EXISTS public.idx_anthropometric_company;
DROP INDEX IF EXISTS public.idx_analytics_cache_type;
DROP INDEX IF EXISTS public.idx_analytics_cache_key;
DROP INDEX IF EXISTS public.idx_analytics_cache_jsonb;
DROP INDEX IF EXISTS public.idx_analytics_cache_expires;
DROP INDEX IF EXISTS public.idx_allowances_status;
DROP INDEX IF EXISTS public.idx_allowances_period;
DROP INDEX IF EXISTS public.idx_allowances_benefit;
DROP INDEX IF EXISTS public.idx_allergies_user;
DROP INDEX IF EXISTS public.idx_allergies_company;
DROP INDEX IF EXISTS public.idx_alert_config_enabled;
DROP INDEX IF EXISTS public.idx_alert_config_company;
DROP INDEX IF EXISTS public.idx_ai_suggestions_recipient;
DROP INDEX IF EXISTS public.idx_ai_suggestions_pending;
DROP INDEX IF EXISTS public.idx_ai_suggestions_message;
DROP INDEX IF EXISTS public.idx_ai_suggestions_group;
DROP INDEX IF EXISTS public.idx_ai_learning_pattern;
DROP INDEX IF EXISTS public.idx_ai_learning_category;
DROP INDEX IF EXISTS public.idx_admin_tasks_trace_id;
DROP INDEX IF EXISTS public.idx_admin_tasks_task_type;
DROP INDEX IF EXISTS public.idx_admin_tasks_status;
DROP INDEX IF EXISTS public.idx_admin_tasks_queue;
DROP INDEX IF EXISTS public.idx_admin_tasks_priority;
DROP INDEX IF EXISTS public.idx_admin_tasks_due_date;
DROP INDEX IF EXISTS public.idx_admin_tasks_created_at;
DROP INDEX IF EXISTS public.idx_admin_tasks_company;
DROP INDEX IF EXISTS public.idx_admin_tasks_assigned_to;
DROP INDEX IF EXISTS public.idx_admin_task_type;
DROP INDEX IF EXISTS public.idx_admin_task_status;
DROP INDEX IF EXISTS public.idx_admin_task_priority;
DROP INDEX IF EXISTS public.idx_admin_task_due;
DROP INDEX IF EXISTS public.idx_admin_task_assigned;
DROP INDEX IF EXISTS public.idx_additional_role_types_key_company;
DROP INDEX IF EXISTS public.idx_additional_role_types_company;
DROP INDEX IF EXISTS public.idx_additional_role_types_category;
DROP INDEX IF EXISTS public.idx_additional_role_types_active;
DROP INDEX IF EXISTS public.idx_activity_restrictions_user;
DROP INDEX IF EXISTS public.idx_activity_restrictions_company;
DROP INDEX IF EXISTS public.idx_actions_thread;
DROP INDEX IF EXISTS public.idx_actions_notification;
DROP INDEX IF EXISTS public.idx_actions_company;
DROP INDEX IF EXISTS public.idx_account_notif_user;
DROP INDEX IF EXISTS public.idx_account_notif_unread;
DROP INDEX IF EXISTS public.idx_account_notif_company;
DROP INDEX IF EXISTS public.idx_access_log_user_date;
DROP INDEX IF EXISTS public.idx_access_log_denied;
DROP INDEX IF EXISTS public.idx_access_log_company_date;
DROP INDEX IF EXISTS public.idx_absence_cases_type;
DROP INDEX IF EXISTS public.idx_absence_cases_status;
DROP INDEX IF EXISTS public.idx_absence_cases_employee;
DROP INDEX IF EXISTS public.idx_absence_cases_doctor;
DROP INDEX IF EXISTS public.idx_absence_cases_dates;
DROP INDEX IF EXISTS public.idx_absence_cases_company;
DROP INDEX IF EXISTS public.holidays_year;
DROP INDEX IF EXISTS public.holidays_date;
DROP INDEX IF EXISTS public.holidays_country_state_province_date;
DROP INDEX IF EXISTS public.holidays_country_date;
DROP INDEX IF EXISTS public.holidays_country;
DROP INDEX IF EXISTS public.facial_biometric_data_user_id;
DROP INDEX IF EXISTS public.facial_biometric_data_is_active;
DROP INDEX IF EXISTS public.facial_biometric_data_created_at;
DROP INDEX IF EXISTS public.facial_biometric_data_company_id;
DROP INDEX IF EXISTS public.employee_locations_user_id_reported_at;
DROP INDEX IF EXISTS public.employee_locations_user_id;
DROP INDEX IF EXISTS public.employee_locations_reported_at;
DROP INDEX IF EXISTS public.employee_locations_latitude_longitude;
DROP INDEX IF EXISTS public.employee_locations_is_working_hours;
DROP INDEX IF EXISTS public.employee_locations_is_in_geofence;
DROP INDEX IF EXISTS public.employee_locations_current_activity;
DROP INDEX IF EXISTS public.employee_locations_created_at;
DROP INDEX IF EXISTS public.employee_locations_company_id_reported_at;
DROP INDEX IF EXISTS public.employee_locations_company_id;
DROP INDEX IF EXISTS public.email_verification_tokens_user_id_user_type;
DROP INDEX IF EXISTS public.email_verification_tokens_token;
DROP INDEX IF EXISTS public.email_verification_tokens_is_verified;
DROP INDEX IF EXISTS public.email_verification_tokens_expires_at;
DROP INDEX IF EXISTS public.email_verification_tokens_email;
DROP INDEX IF EXISTS public.departments_name_company_id;
DROP INDEX IF EXISTS public.departments_name;
DROP INDEX IF EXISTS public.departments_is_active;
DROP INDEX IF EXISTS public.departments_gps_lat_gps_lng;
DROP INDEX IF EXISTS public.departments_company_id;
DROP INDEX IF EXISTS public.contracts_company_id;
DROP INDEX IF EXISTS public.consent_definitions_version;
DROP INDEX IF EXISTS public.consent_definitions_is_required;
DROP INDEX IF EXISTS public.consent_definitions_is_active;
DROP INDEX IF EXISTS public.consent_definitions_consent_key;
DROP INDEX IF EXISTS public.consent_definitions_category;
DROP INDEX IF EXISTS public.consent_audit_log_user_consent_id_created_at;
DROP INDEX IF EXISTS public.consent_audit_log_user_consent_id;
DROP INDEX IF EXISTS public.consent_audit_log_created_at;
DROP INDEX IF EXISTS public.consent_audit_log_changed_by;
DROP INDEX IF EXISTS public.consent_audit_log_action;
DROP INDEX IF EXISTS public.concept_dependencies_concept_id_dependency_id;
DROP INDEX IF EXISTS public.company_support_assignments_is_active;
DROP INDEX IF EXISTS public.company_support_assignments_company_id;
DROP INDEX IF EXISTS public.company_support_assignments_assigned_vendor_id;
DROP INDEX IF EXISTS public.company_modules_unique_company_module;
DROP INDEX IF EXISTS public.company_modules_system_module_id;
DROP INDEX IF EXISTS public.company_modules_company_id;
DROP INDEX IF EXISTS public.company_dependencies_company_id_dependency_code;
DROP INDEX IF EXISTS public.companies_tax_id;
DROP INDEX IF EXISTS public.companies_status;
DROP INDEX IF EXISTS public.companies_slug;
DROP INDEX IF EXISTS public.companies_license_type;
DROP INDEX IF EXISTS public.companies_is_active;
DROP INDEX IF EXISTS public.branches_is_active;
DROP INDEX IF EXISTS public.branches_company_id;
DROP INDEX IF EXISTS public.branches_code_company_id;
DROP INDEX IF EXISTS public.branches_code;
DROP INDEX IF EXISTS public.biometric_data_type;
DROP INDEX IF EXISTS public.biometric_data_is_active;
DROP INDEX IF EXISTS public.biometric_data__user_id_type_finger_index;
DROP INDEX IF EXISTS public.biometric_data__user_id;
DROP INDEX IF EXISTS public.audit_test_logs_test_type;
DROP INDEX IF EXISTS public.audit_test_logs_tags;
DROP INDEX IF EXISTS public.audit_test_logs_status;
DROP INDEX IF EXISTS public.audit_test_logs_started_at;
DROP INDEX IF EXISTS public.audit_test_logs_severity;
DROP INDEX IF EXISTS public.audit_test_logs_module_name;
DROP INDEX IF EXISTS public.audit_test_logs_execution_id;
DROP INDEX IF EXISTS public.audit_test_logs_environment;
DROP INDEX IF EXISTS public.audit_test_logs_company_id;
DROP INDEX IF EXISTS public.attendances_status;
DROP INDEX IF EXISTS public.attendances_date;
DROP INDEX IF EXISTS public.attendances__user_id;
DROP INDEX IF EXISTS public.assistant_knowledge_base_module_name;
DROP INDEX IF EXISTS public.assistant_knowledge_base_helpful;
DROP INDEX IF EXISTS public.assistant_knowledge_base_created_at;
DROP INDEX IF EXISTS public.assistant_knowledge_base_company_id_module_name_helpful;
DROP INDEX IF EXISTS public.assistant_knowledge_base_company_id;
DROP INDEX IF EXISTS public.assistant_conversations_user_id_created_at;
DROP INDEX IF EXISTS public.assistant_conversations_module_name_created_at;
DROP INDEX IF EXISTS public.assistant_conversations_helpful_created_at;
DROP INDEX IF EXISTS public.assistant_conversations_company_id_module_name_helpful_created_;
DROP INDEX IF EXISTS public.assistant_conversations_company_id_created_at;
DROP INDEX IF EXISTS public.art_configurations_is_active;
DROP INDEX IF EXISTS public.art_configurations_company_id;
DROP INDEX IF EXISTS public.art_configurations_art_code;
DROP INDEX IF EXISTS public.aponnt_staff_companies_staff_id_company_id;
DROP INDEX IF EXISTS public.aponnt_staff_companies_staff_id;
DROP INDEX IF EXISTS public.aponnt_staff_companies_is_active;
DROP INDEX IF EXISTS public.aponnt_staff_companies_company_id;
DROP INDEX IF EXISTS public.additional_role_types_is_active;
DROP INDEX IF EXISTS public.additional_role_types_company_id;
DROP INDEX IF EXISTS public.additional_role_types_category;
DROP INDEX IF EXISTS public.access_notifications_related_visitor_id;
DROP INDEX IF EXISTS public.access_notifications_related_user_id;
DROP INDEX IF EXISTS public.access_notifications_related_kiosk_id;
DROP INDEX IF EXISTS public.access_notifications_recipient_user_id;
DROP INDEX IF EXISTS public.access_notifications_priority;
DROP INDEX IF EXISTS public.access_notifications_notification_type;
DROP INDEX IF EXISTS public.access_notifications_is_read;
DROP INDEX IF EXISTS public.access_notifications_expires_at;
DROP INDEX IF EXISTS public.access_notifications_created_at;
DROP INDEX IF EXISTS public.access_notifications_compound2;
DROP INDEX IF EXISTS public.access_notifications_compound1;
DROP INDEX IF EXISTS public.access_notifications_company_id_recipient_user_id_is_read;
DROP INDEX IF EXISTS public.access_notifications_company_id_notification_type_created_at;
DROP INDEX IF EXISTS public.access_notifications_company_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p9_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p9_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p9_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p9_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p8_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p8_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p8_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p8_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p7_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p7_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p7_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p7_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p6_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p6_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p6_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p6_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p5_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p5_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p5_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p5_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p4_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p4_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p4_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p4_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p3_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p3_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p3_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p3_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p2_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p2_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p2_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p2_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p1_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p1_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p1_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p1_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p15_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p15_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p15_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p15_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p14_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p14_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p14_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p14_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p13_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p13_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p13_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p13_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p12_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p12_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p12_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p12_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p11_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p11_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p11_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p11_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p10_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p10_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p10_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p10_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p0_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p0_template_hash;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p0_created_at;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_scans_p0_ai_analysis;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p9_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p9_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p8_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p8_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p7_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p7_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p6_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p6_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p5_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p5_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p4_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p4_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p3_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p3_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p2_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p2_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p1_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p1_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p15_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p15_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p14_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p14_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p13_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p13_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p12_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p12_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p11_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p11_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p10_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p10_status;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p0_user_id;
DROP INDEX IF EXISTS biometric_partitions.idx_biometric_alerts_p0_status;
ALTER TABLE IF EXISTS ONLY public.visitors DROP CONSTRAINT IF EXISTS visitors_pkey;
ALTER TABLE IF EXISTS ONLY public.visitors DROP CONSTRAINT IF EXISTS visitors_keyring_id_key;
ALTER TABLE IF EXISTS ONLY public.visitor_gps_tracking DROP CONSTRAINT IF EXISTS visitor_gps_tracking_pkey;
ALTER TABLE IF EXISTS ONLY public.vendor_statistics DROP CONSTRAINT IF EXISTS vendor_statistics_vendor_id_unique;
ALTER TABLE IF EXISTS ONLY public.vendor_statistics DROP CONSTRAINT IF EXISTS vendor_statistics_pkey;
ALTER TABLE IF EXISTS ONLY public.vendor_referrals DROP CONSTRAINT IF EXISTS vendor_referrals_referrer_id_referred_id_key;
ALTER TABLE IF EXISTS ONLY public.vendor_referrals DROP CONSTRAINT IF EXISTS vendor_referrals_referral_code_key;
ALTER TABLE IF EXISTS ONLY public.vendor_referrals DROP CONSTRAINT IF EXISTS vendor_referrals_pkey;
ALTER TABLE IF EXISTS ONLY public.vendor_ratings DROP CONSTRAINT IF EXISTS vendor_ratings_vendor_id_company_id_key;
ALTER TABLE IF EXISTS ONLY public.vendor_ratings DROP CONSTRAINT IF EXISTS vendor_ratings_pkey;
ALTER TABLE IF EXISTS ONLY public.vendor_commissions DROP CONSTRAINT IF EXISTS vendor_commissions_pkey;
ALTER TABLE IF EXISTS ONLY public.vacation_scales DROP CONSTRAINT IF EXISTS vacation_scales_pkey;
ALTER TABLE IF EXISTS ONLY public.vacation_requests DROP CONSTRAINT IF EXISTS vacation_requests_pkey;
ALTER TABLE IF EXISTS ONLY public.vacation_configurations DROP CONSTRAINT IF EXISTS vacation_configurations_pkey;
ALTER TABLE IF EXISTS ONLY public.ux_discoveries DROP CONSTRAINT IF EXISTS ux_discoveries_pkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_vendor_code_key;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_pkey;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS "users_employeeId_key";
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_email_key;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_dni_key;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_cuil_key;
ALTER TABLE IF EXISTS ONLY public.users DROP CONSTRAINT IF EXISTS users_company_usuario_unique;
ALTER TABLE IF EXISTS ONLY public.user_work_restrictions DROP CONSTRAINT IF EXISTS user_work_restrictions_pkey;
ALTER TABLE IF EXISTS ONLY public.user_work_history DROP CONSTRAINT IF EXISTS user_work_history_pkey;
ALTER TABLE IF EXISTS ONLY public.user_vaccinations DROP CONSTRAINT IF EXISTS user_vaccinations_pkey;
ALTER TABLE IF EXISTS ONLY public.user_union_affiliation DROP CONSTRAINT IF EXISTS user_union_affiliation_pkey;
ALTER TABLE IF EXISTS ONLY public.user_surgeries DROP CONSTRAINT IF EXISTS user_surgeries_pkey;
ALTER TABLE IF EXISTS ONLY public.user_sports_activities DROP CONSTRAINT IF EXISTS user_sports_activities_pkey;
ALTER TABLE IF EXISTS ONLY public.user_shifts DROP CONSTRAINT IF EXISTS user_shifts_pkey;
ALTER TABLE IF EXISTS ONLY public.user_shift_assignments DROP CONSTRAINT IF EXISTS user_shift_assignments_pkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config_v2 DROP CONSTRAINT IF EXISTS user_salary_config_v2_pkey;
ALTER TABLE IF EXISTS ONLY public.user_salary_config DROP CONSTRAINT IF EXISTS user_salary_config_pkey;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_user_id_role_id_key;
ALTER TABLE IF EXISTS ONLY public.user_role_assignments DROP CONSTRAINT IF EXISTS user_role_assignments_pkey;
ALTER TABLE IF EXISTS ONLY public.user_psychiatric_treatments DROP CONSTRAINT IF EXISTS user_psychiatric_treatments_pkey;
ALTER TABLE IF EXISTS ONLY public.user_professional_licenses DROP CONSTRAINT IF EXISTS user_professional_licenses_pkey;
ALTER TABLE IF EXISTS ONLY public.user_primary_physician DROP CONSTRAINT IF EXISTS user_primary_physician_user_id_key;
ALTER TABLE IF EXISTS ONLY public.user_primary_physician DROP CONSTRAINT IF EXISTS user_primary_physician_pkey;
ALTER TABLE IF EXISTS ONLY public.user_permissions DROP CONSTRAINT IF EXISTS user_permissions_user_id_company_id_action_id_key;
ALTER TABLE IF EXISTS ONLY public.user_permissions DROP CONSTRAINT IF EXISTS user_permissions_pkey;
ALTER TABLE IF EXISTS ONLY public.user_permission_requests DROP CONSTRAINT IF EXISTS user_permission_requests_pkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_records DROP CONSTRAINT IF EXISTS user_payroll_records_pkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_concept_overrides DROP CONSTRAINT IF EXISTS user_payroll_concept_overrides_pkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_bonuses DROP CONSTRAINT IF EXISTS user_payroll_bonuses_pkey;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_user_id_effective_from_key;
ALTER TABLE IF EXISTS ONLY public.user_payroll_assignment DROP CONSTRAINT IF EXISTS user_payroll_assignment_pkey;
ALTER TABLE IF EXISTS ONLY public.user_notification_preferences DROP CONSTRAINT IF EXISTS user_notification_preferences_user_id_company_id_module_key;
ALTER TABLE IF EXISTS ONLY public.user_notification_preferences DROP CONSTRAINT IF EXISTS user_notification_preferences_pkey;
ALTER TABLE IF EXISTS ONLY public.user_medications DROP CONSTRAINT IF EXISTS user_medications_pkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_exams DROP CONSTRAINT IF EXISTS user_medical_exams_pkey;
ALTER TABLE IF EXISTS ONLY public.user_medical_documents DROP CONSTRAINT IF EXISTS user_medical_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.user_marital_status DROP CONSTRAINT IF EXISTS user_marital_status_user_id_key;
ALTER TABLE IF EXISTS ONLY public.user_marital_status DROP CONSTRAINT IF EXISTS user_marital_status_pkey;
ALTER TABLE IF EXISTS ONLY public.user_legal_issues DROP CONSTRAINT IF EXISTS user_legal_issues_pkey;
ALTER TABLE IF EXISTS ONLY public.user_household_members DROP CONSTRAINT IF EXISTS user_household_members_pkey;
ALTER TABLE IF EXISTS ONLY public.user_healthy_habits DROP CONSTRAINT IF EXISTS user_healthy_habits_pkey;
ALTER TABLE IF EXISTS ONLY public.user_family_members DROP CONSTRAINT IF EXISTS user_family_members_pkey;
ALTER TABLE IF EXISTS ONLY public.user_emergency_contacts DROP CONSTRAINT IF EXISTS user_emergency_contacts_pkey;
ALTER TABLE IF EXISTS ONLY public.user_emails DROP CONSTRAINT IF EXISTS user_emails_pkey;
ALTER TABLE IF EXISTS ONLY public.user_education DROP CONSTRAINT IF EXISTS user_education_pkey;
ALTER TABLE IF EXISTS ONLY public.user_driver_licenses DROP CONSTRAINT IF EXISTS user_driver_licenses_pkey;
ALTER TABLE IF EXISTS ONLY public.user_documents DROP CONSTRAINT IF EXISTS user_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.user_disciplinary_actions DROP CONSTRAINT IF EXISTS user_disciplinary_actions_pkey;
ALTER TABLE IF EXISTS ONLY public.user_contact_history DROP CONSTRAINT IF EXISTS user_contact_history_pkey;
ALTER TABLE IF EXISTS ONLY public.user_consents DROP CONSTRAINT IF EXISTS user_consents_pkey;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions_v2 DROP CONSTRAINT IF EXISTS user_chronic_conditions_v2_pkey;
ALTER TABLE IF EXISTS ONLY public.user_chronic_conditions DROP CONSTRAINT IF EXISTS user_chronic_conditions_pkey;
ALTER TABLE IF EXISTS ONLY public.user_children DROP CONSTRAINT IF EXISTS user_children_pkey;
ALTER TABLE IF EXISTS ONLY public.user_audit_logs DROP CONSTRAINT IF EXISTS user_audit_logs_pkey;
ALTER TABLE IF EXISTS ONLY public.user_assigned_tasks DROP CONSTRAINT IF EXISTS user_assigned_tasks_pkey;
ALTER TABLE IF EXISTS ONLY public.user_anthropometric_data DROP CONSTRAINT IF EXISTS user_anthropometric_data_pkey;
ALTER TABLE IF EXISTS ONLY public.user_allergies DROP CONSTRAINT IF EXISTS user_allergies_pkey;
ALTER TABLE IF EXISTS ONLY public.user_activity_restrictions DROP CONSTRAINT IF EXISTS user_activity_restrictions_pkey;
ALTER TABLE IF EXISTS ONLY public.used_tokens DROP CONSTRAINT IF EXISTS used_tokens_token_key;
ALTER TABLE IF EXISTS ONLY public.used_tokens DROP CONSTRAINT IF EXISTS used_tokens_pkey;
ALTER TABLE IF EXISTS ONLY public.user_emails DROP CONSTRAINT IF EXISTS uq_user_email;
ALTER TABLE IF EXISTS ONLY public.email_templates DROP CONSTRAINT IF EXISTS uq_template_key;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS uq_consent_user_type;
ALTER TABLE IF EXISTS ONLY public.concept_dependencies DROP CONSTRAINT IF EXISTS uq_concept_dependency;
ALTER TABLE IF EXISTS ONLY public.company_dependencies DROP CONSTRAINT IF EXISTS uq_company_dependency_code;
ALTER TABLE IF EXISTS ONLY public.hse_zone_configurations DROP CONSTRAINT IF EXISTS unique_zone_per_branch;
ALTER TABLE IF EXISTS ONLY public.consent_legal_documents DROP CONSTRAINT IF EXISTS unique_version_company;
ALTER TABLE IF EXISTS ONLY public.task_compatibility DROP CONSTRAINT IF EXISTS unique_task_compatibility_pair;
ALTER TABLE IF EXISTS ONLY public.aponnt_admin_tasks DROP CONSTRAINT IF EXISTS unique_task_code;
ALTER TABLE IF EXISTS ONLY public.hse_ppe_stats DROP CONSTRAINT IF EXISTS unique_stat_per_zone_date;
ALTER TABLE IF EXISTS ONLY public.support_sla_config DROP CONSTRAINT IF EXISTS unique_priority;
ALTER TABLE IF EXISTS ONLY public.aponnt_pre_invoices DROP CONSTRAINT IF EXISTS unique_pre_invoice_code;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS unique_license_per_company;
ALTER TABLE IF EXISTS ONLY public.medical_exam_templates DROP CONSTRAINT IF EXISTS unique_default_template;
ALTER TABLE IF EXISTS ONLY public.afip_cae_log DROP CONSTRAINT IF EXISTS unique_comprobante_cae;
ALTER TABLE IF EXISTS ONLY public.branch_offices_fiscal DROP CONSTRAINT IF EXISTS unique_company_punto_venta;
ALTER TABLE IF EXISTS ONLY public.company_fiscal_config DROP CONSTRAINT IF EXISTS unique_company_fiscal;
ALTER TABLE IF EXISTS ONLY public.afip_cae_log DROP CONSTRAINT IF EXISTS unique_cae;
ALTER TABLE IF EXISTS ONLY public.contract_apk_licenses DROP CONSTRAINT IF EXISTS unique_apk_per_contract;
ALTER TABLE IF EXISTS ONLY public.unified_notifications DROP CONSTRAINT IF EXISTS unified_notifications_pkey;
ALTER TABLE IF EXISTS ONLY public.unified_help_interactions DROP CONSTRAINT IF EXISTS unified_help_interactions_pkey;
ALTER TABLE IF EXISTS ONLY public.unauthorized_access_attempts DROP CONSTRAINT IF EXISTS unauthorized_access_attempts_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS uk_legal_case_number;
ALTER TABLE IF EXISTS ONLY public.company_modules DROP CONSTRAINT IF EXISTS uk_company_module_unique;
ALTER TABLE IF EXISTS ONLY public.trainings DROP CONSTRAINT IF EXISTS trainings_pkey;
ALTER TABLE IF EXISTS ONLY public.training_assignments DROP CONSTRAINT IF EXISTS training_assignments_pkey;
ALTER TABLE IF EXISTS ONLY public.testing_tickets DROP CONSTRAINT IF EXISTS testing_tickets_ticket_number_key;
ALTER TABLE IF EXISTS ONLY public.testing_tickets DROP CONSTRAINT IF EXISTS testing_tickets_pkey;
ALTER TABLE IF EXISTS ONLY public.test_results DROP CONSTRAINT IF EXISTS test_results_pkey;
ALTER TABLE IF EXISTS ONLY public.test_executions DROP CONSTRAINT IF EXISTS test_executions_pkey;
ALTER TABLE IF EXISTS ONLY public.test_executions DROP CONSTRAINT IF EXISTS test_executions_execution_id_key;
ALTER TABLE IF EXISTS ONLY public.tax_templates DROP CONSTRAINT IF EXISTS tax_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.tax_templates DROP CONSTRAINT IF EXISTS tax_templates_country_code_key;
ALTER TABLE IF EXISTS ONLY public.tax_rates DROP CONSTRAINT IF EXISTS tax_rates_tax_concept_id_rate_code_key;
ALTER TABLE IF EXISTS ONLY public.tax_rates DROP CONSTRAINT IF EXISTS tax_rates_pkey;
ALTER TABLE IF EXISTS ONLY public.tax_conditions DROP CONSTRAINT IF EXISTS tax_conditions_tax_template_id_condition_code_key;
ALTER TABLE IF EXISTS ONLY public.tax_conditions DROP CONSTRAINT IF EXISTS tax_conditions_pkey;
ALTER TABLE IF EXISTS ONLY public.tax_concepts DROP CONSTRAINT IF EXISTS tax_concepts_tax_template_id_concept_code_key;
ALTER TABLE IF EXISTS ONLY public.tax_concepts DROP CONSTRAINT IF EXISTS tax_concepts_pkey;
ALTER TABLE IF EXISTS ONLY public.task_compatibility DROP CONSTRAINT IF EXISTS task_compatibility_pkey;
ALTER TABLE IF EXISTS ONLY public.system_modules_registry DROP CONSTRAINT IF EXISTS system_modules_registry_pkey;
ALTER TABLE IF EXISTS ONLY public.system_modules_registry DROP CONSTRAINT IF EXISTS system_modules_registry_module_key_key;
ALTER TABLE IF EXISTS ONLY public.system_modules DROP CONSTRAINT IF EXISTS system_modules_pkey;
ALTER TABLE IF EXISTS ONLY public.system_modules DROP CONSTRAINT IF EXISTS system_modules_module_key_key;
ALTER TABLE IF EXISTS ONLY public.system_metadata DROP CONSTRAINT IF EXISTS system_metadata_pkey;
ALTER TABLE IF EXISTS ONLY public.system_metadata DROP CONSTRAINT IF EXISTS system_metadata_metadata_key_key;
ALTER TABLE IF EXISTS ONLY public.system_consciousness_log DROP CONSTRAINT IF EXISTS system_consciousness_log_pkey;
ALTER TABLE IF EXISTS ONLY public.system_config DROP CONSTRAINT IF EXISTS system_config_pkey;
ALTER TABLE IF EXISTS ONLY public.suspension_blocks DROP CONSTRAINT IF EXISTS suspension_blocks_pkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_supervisors DROP CONSTRAINT IF EXISTS support_vendor_supervisors_vendor_id_supervisor_id_key;
ALTER TABLE IF EXISTS ONLY public.support_vendor_supervisors DROP CONSTRAINT IF EXISTS support_vendor_supervisors_pkey;
ALTER TABLE IF EXISTS ONLY public.support_vendor_stats DROP CONSTRAINT IF EXISTS support_vendor_stats_vendor_id_period_start_period_end_key;
ALTER TABLE IF EXISTS ONLY public.support_vendor_stats DROP CONSTRAINT IF EXISTS support_vendor_stats_pkey;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_ticket_number_key;
ALTER TABLE IF EXISTS ONLY public.support_tickets DROP CONSTRAINT IF EXISTS support_tickets_pkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_messages DROP CONSTRAINT IF EXISTS support_ticket_messages_pkey;
ALTER TABLE IF EXISTS ONLY public.support_ticket_escalations DROP CONSTRAINT IF EXISTS support_ticket_escalations_pkey;
ALTER TABLE IF EXISTS ONLY public.support_sla_plans DROP CONSTRAINT IF EXISTS support_sla_plans_plan_name_key;
ALTER TABLE IF EXISTS ONLY public.support_sla_plans DROP CONSTRAINT IF EXISTS support_sla_plans_pkey;
ALTER TABLE IF EXISTS ONLY public.support_sla_config DROP CONSTRAINT IF EXISTS support_sla_config_pkey;
ALTER TABLE IF EXISTS ONLY public.support_escalations DROP CONSTRAINT IF EXISTS support_escalations_pkey;
ALTER TABLE IF EXISTS ONLY public.support_assistant_attempts DROP CONSTRAINT IF EXISTS support_assistant_attempts_pkey;
ALTER TABLE IF EXISTS ONLY public.support_activity_log DROP CONSTRAINT IF EXISTS support_activity_log_pkey;
ALTER TABLE IF EXISTS ONLY public.super_users DROP CONSTRAINT IF EXISTS super_users_username_key;
ALTER TABLE IF EXISTS ONLY public.super_users DROP CONSTRAINT IF EXISTS super_users_pkey;
ALTER TABLE IF EXISTS ONLY public.super_users DROP CONSTRAINT IF EXISTS super_users_email_key;
ALTER TABLE IF EXISTS ONLY public.sports_catalog DROP CONSTRAINT IF EXISTS sports_catalog_pkey;
ALTER TABLE IF EXISTS ONLY public.sla_metrics DROP CONSTRAINT IF EXISTS sla_metrics_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_transacciones_pendientes DROP CONSTRAINT IF EXISTS siac_transacciones_pendientes_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_tipos_comprobantes DROP CONSTRAINT IF EXISTS siac_tipos_comprobantes_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_tipos_comprobantes DROP CONSTRAINT IF EXISTS siac_tipos_comprobantes_company_id_codigo_tipo_key;
ALTER TABLE IF EXISTS ONLY public.siac_stock_movimientos DROP CONSTRAINT IF EXISTS siac_stock_movimientos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_sesiones_locales DROP CONSTRAINT IF EXISTS siac_sesiones_locales_session_id_key;
ALTER TABLE IF EXISTS ONLY public.siac_sesiones_locales DROP CONSTRAINT IF EXISTS siac_sesiones_locales_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_sesiones_locales DROP CONSTRAINT IF EXISTS siac_sesiones_locales_company_id_terminal_id_is_active_key;
ALTER TABLE IF EXISTS ONLY public.siac_sesiones_caja DROP CONSTRAINT IF EXISTS siac_sesiones_caja_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_puntos_venta DROP CONSTRAINT IF EXISTS siac_puntos_venta_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_puntos_venta DROP CONSTRAINT IF EXISTS siac_puntos_venta_company_id_codigo_punto_venta_key;
ALTER TABLE IF EXISTS ONLY public.siac_productos_precios DROP CONSTRAINT IF EXISTS siac_productos_precios_uk;
ALTER TABLE IF EXISTS ONLY public.siac_productos_precios DROP CONSTRAINT IF EXISTS siac_productos_precios_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos DROP CONSTRAINT IF EXISTS siac_productos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_marcas DROP CONSTRAINT IF EXISTS siac_productos_marcas_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_componentes DROP CONSTRAINT IF EXISTS siac_productos_componentes_uk;
ALTER TABLE IF EXISTS ONLY public.siac_productos_componentes DROP CONSTRAINT IF EXISTS siac_productos_componentes_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos DROP CONSTRAINT IF EXISTS siac_productos_codigo_company_uk;
ALTER TABLE IF EXISTS ONLY public.siac_productos_categorias DROP CONSTRAINT IF EXISTS siac_productos_categorias_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_presupuestos DROP CONSTRAINT IF EXISTS siac_presupuestos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_presupuestos DROP CONSTRAINT IF EXISTS siac_presupuestos_numero_unico;
ALTER TABLE IF EXISTS ONLY public.siac_numeracion_log DROP CONSTRAINT IF EXISTS siac_numeracion_log_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_numeracion_comprobantes DROP CONSTRAINT IF EXISTS siac_numeracion_comprobantes_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_numeracion_comprobantes DROP CONSTRAINT IF EXISTS siac_numeracion_comprobantes_caja_id_tipo_comprobante_id_key;
ALTER TABLE IF EXISTS ONLY public.siac_modulos_empresa DROP CONSTRAINT IF EXISTS siac_modulos_empresa_uk;
ALTER TABLE IF EXISTS ONLY public.siac_modulos_empresa DROP CONSTRAINT IF EXISTS siac_modulos_empresa_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_productos_marcas DROP CONSTRAINT IF EXISTS siac_marcas_codigo_company_uk;
ALTER TABLE IF EXISTS ONLY public.siac_listas_precios DROP CONSTRAINT IF EXISTS siac_listas_precios_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_listas_precios DROP CONSTRAINT IF EXISTS siac_listas_codigo_company_uk;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS siac_facturas_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_pagos DROP CONSTRAINT IF EXISTS siac_facturas_pagos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_items DROP CONSTRAINT IF EXISTS siac_facturas_items_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas_impuestos DROP CONSTRAINT IF EXISTS siac_facturas_impuestos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_facturas DROP CONSTRAINT IF EXISTS siac_facturas_caja_id_tipo_comprobante_id_prefijo_numero_key;
ALTER TABLE IF EXISTS ONLY public.siac_configuracion_terminal DROP CONSTRAINT IF EXISTS siac_configuracion_terminal_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_configuracion_terminal DROP CONSTRAINT IF EXISTS siac_configuracion_terminal_company_id_terminal_id_key;
ALTER TABLE IF EXISTS ONLY public.siac_configuracion_empresa DROP CONSTRAINT IF EXISTS siac_configuracion_empresa_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_configuracion_empresa DROP CONSTRAINT IF EXISTS siac_configuracion_empresa_company_id_key;
ALTER TABLE IF EXISTS ONLY public.siac_clientes_precios_especiales DROP CONSTRAINT IF EXISTS siac_clientes_precios_especiales_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_clientes DROP CONSTRAINT IF EXISTS siac_clientes_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_clientes_direcciones DROP CONSTRAINT IF EXISTS siac_clientes_direcciones_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_clientes_contactos DROP CONSTRAINT IF EXISTS siac_clientes_contactos_pkey;
ALTER TABLE IF EXISTS ONLY public.siac_clientes DROP CONSTRAINT IF EXISTS siac_clientes_codigo_company_uk;
ALTER TABLE IF EXISTS ONLY public.siac_productos_categorias DROP CONSTRAINT IF EXISTS siac_categorias_codigo_company_uk;
ALTER TABLE IF EXISTS ONLY public.siac_cajas DROP CONSTRAINT IF EXISTS siac_cajas_punto_venta_id_codigo_caja_key;
ALTER TABLE IF EXISTS ONLY public.siac_cajas DROP CONSTRAINT IF EXISTS siac_cajas_pkey;
ALTER TABLE IF EXISTS ONLY public.shifts DROP CONSTRAINT IF EXISTS shifts_pkey;
ALTER TABLE IF EXISTS ONLY public.sectors DROP CONSTRAINT IF EXISTS sectors_pkey;
ALTER TABLE IF EXISTS ONLY public.scoring_history DROP CONSTRAINT IF EXISTS scoring_history_pkey;
ALTER TABLE IF EXISTS ONLY public.schema_migrations DROP CONSTRAINT IF EXISTS schema_migrations_pkey;
ALTER TABLE IF EXISTS ONLY public.sanctions DROP CONSTRAINT IF EXISTS sanctions_pkey;
ALTER TABLE IF EXISTS ONLY public.sanction_types DROP CONSTRAINT IF EXISTS sanction_types_pkey;
ALTER TABLE IF EXISTS ONLY public.sanction_types DROP CONSTRAINT IF EXISTS sanction_types_company_id_code_key;
ALTER TABLE IF EXISTS ONLY public.sanction_history DROP CONSTRAINT IF EXISTS sanction_history_pkey;
ALTER TABLE IF EXISTS ONLY public.salary_categories_v2 DROP CONSTRAINT IF EXISTS salary_categories_v2_pkey;
ALTER TABLE IF EXISTS ONLY public.salary_categories DROP CONSTRAINT IF EXISTS salary_categories_pkey;
ALTER TABLE IF EXISTS ONLY public.role_template_permissions DROP CONSTRAINT IF EXISTS role_template_permissions_role_template_id_action_id_key;
ALTER TABLE IF EXISTS ONLY public.role_template_permissions DROP CONSTRAINT IF EXISTS role_template_permissions_pkey;
ALTER TABLE IF EXISTS ONLY public.role_definitions DROP CONSTRAINT IF EXISTS role_definitions_pkey;
ALTER TABLE IF EXISTS ONLY public.role_definitions DROP CONSTRAINT IF EXISTS role_definitions_company_id_role_key_key;
ALTER TABLE IF EXISTS ONLY public.risk_benchmarks DROP CONSTRAINT IF EXISTS risk_benchmarks_pkey;
ALTER TABLE IF EXISTS ONLY public.request_types DROP CONSTRAINT IF EXISTS request_types_pkey;
ALTER TABLE IF EXISTS ONLY public.request_types DROP CONSTRAINT IF EXISTS request_types_code_key;
ALTER TABLE IF EXISTS ONLY public.report_access_log DROP CONSTRAINT IF EXISTS report_access_log_pkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_pkey;
ALTER TABLE IF EXISTS ONLY public.procedures DROP CONSTRAINT IF EXISTS procedures_company_id_code_key;
ALTER TABLE IF EXISTS ONLY public.procedure_versions DROP CONSTRAINT IF EXISTS procedure_versions_procedure_id_version_number_key;
ALTER TABLE IF EXISTS ONLY public.procedure_versions DROP CONSTRAINT IF EXISTS procedure_versions_pkey;
ALTER TABLE IF EXISTS ONLY public.procedure_roles DROP CONSTRAINT IF EXISTS procedure_roles_procedure_id_organizational_position_id_key;
ALTER TABLE IF EXISTS ONLY public.procedure_roles DROP CONSTRAINT IF EXISTS procedure_roles_pkey;
ALTER TABLE IF EXISTS ONLY public.procedure_draft_locks DROP CONSTRAINT IF EXISTS procedure_draft_locks_pkey;
ALTER TABLE IF EXISTS ONLY public.procedure_comments DROP CONSTRAINT IF EXISTS procedure_comments_pkey;
ALTER TABLE IF EXISTS ONLY public.procedure_attachments DROP CONSTRAINT IF EXISTS procedure_attachments_pkey;
ALTER TABLE IF EXISTS ONLY public.procedure_acknowledgements DROP CONSTRAINT IF EXISTS procedure_acknowledgements_procedure_id_procedure_version_i_key;
ALTER TABLE IF EXISTS ONLY public.procedure_acknowledgements DROP CONSTRAINT IF EXISTS procedure_acknowledgements_pkey;
ALTER TABLE IF EXISTS ONLY public.proactive_rules DROP CONSTRAINT IF EXISTS proactive_rules_pkey;
ALTER TABLE IF EXISTS ONLY public.proactive_executions DROP CONSTRAINT IF EXISTS proactive_executions_pkey;
ALTER TABLE IF EXISTS ONLY public.permissions DROP CONSTRAINT IF EXISTS permissions_pkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_summaries DROP CONSTRAINT IF EXISTS pcs_unique_period;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_templates DROP CONSTRAINT IF EXISTS payroll_templates_company_id_template_code_version_key;
ALTER TABLE IF EXISTS ONLY public.payroll_template_concepts DROP CONSTRAINT IF EXISTS payroll_template_concepts_template_id_concept_code_key;
ALTER TABLE IF EXISTS ONLY public.payroll_template_concepts DROP CONSTRAINT IF EXISTS payroll_template_concepts_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_runs DROP CONSTRAINT IF EXISTS payroll_runs_company_id_run_code_key;
ALTER TABLE IF EXISTS ONLY public.payroll_run_details DROP CONSTRAINT IF EXISTS payroll_run_details_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_run_concept_details DROP CONSTRAINT IF EXISTS payroll_run_concept_details_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_templates DROP CONSTRAINT IF EXISTS payroll_payslip_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_templates DROP CONSTRAINT IF EXISTS payroll_payslip_templates_company_id_template_code_key;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_block_types DROP CONSTRAINT IF EXISTS payroll_payslip_block_types_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_payslip_block_types DROP CONSTRAINT IF EXISTS payroll_payslip_block_types_block_type_key;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlements DROP CONSTRAINT IF EXISTS payroll_entity_settlements_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_settlement_details DROP CONSTRAINT IF EXISTS payroll_entity_settlement_details_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_categories DROP CONSTRAINT IF EXISTS payroll_entity_categories_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_entity_categories DROP CONSTRAINT IF EXISTS payroll_entity_categories_country_id_company_id_category_co_key;
ALTER TABLE IF EXISTS ONLY public.payroll_entities DROP CONSTRAINT IF EXISTS payroll_entities_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_countries DROP CONSTRAINT IF EXISTS payroll_countries_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_countries DROP CONSTRAINT IF EXISTS payroll_countries_country_code_key;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_types DROP CONSTRAINT IF EXISTS payroll_concept_types_type_code_key;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_types DROP CONSTRAINT IF EXISTS payroll_concept_types_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_type_rates DROP CONSTRAINT IF EXISTS payroll_concept_type_rates_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_type_rates DROP CONSTRAINT IF EXISTS payroll_concept_type_rates_concept_type_id_country_id_effec_key;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_classifications DROP CONSTRAINT IF EXISTS payroll_concept_classifications_pkey;
ALTER TABLE IF EXISTS ONLY public.payroll_concept_classifications DROP CONSTRAINT IF EXISTS payroll_concept_classifications_classification_code_key;
ALTER TABLE IF EXISTS ONLY public.payments DROP CONSTRAINT IF EXISTS payments_pkey;
ALTER TABLE IF EXISTS ONLY public.password_auth_attempts DROP CONSTRAINT IF EXISTS password_auth_attempts_pkey;
ALTER TABLE IF EXISTS ONLY public.partners DROP CONSTRAINT IF EXISTS partners_username_key;
ALTER TABLE IF EXISTS ONLY public.partners DROP CONSTRAINT IF EXISTS partners_pkey;
ALTER TABLE IF EXISTS ONLY public.partners DROP CONSTRAINT IF EXISTS partners_email_key;
ALTER TABLE IF EXISTS ONLY public.partners DROP CONSTRAINT IF EXISTS partners_dni_key;
ALTER TABLE IF EXISTS ONLY public.partner_roles DROP CONSTRAINT IF EXISTS partner_roles_role_name_key;
ALTER TABLE IF EXISTS ONLY public.partner_roles DROP CONSTRAINT IF EXISTS partner_roles_pkey;
ALTER TABLE IF EXISTS ONLY public.partner_commissions DROP CONSTRAINT IF EXISTS partner_commissions_pkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_transactions DROP CONSTRAINT IF EXISTS partner_commission_transactions_pkey;
ALTER TABLE IF EXISTS ONLY public.partner_commission_summaries DROP CONSTRAINT IF EXISTS partner_commission_summaries_pkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_pkey;
ALTER TABLE IF EXISTS ONLY public.organizational_positions DROP CONSTRAINT IF EXISTS organizational_positions_company_id_position_code_key;
ALTER TABLE IF EXISTS ONLY public.oh_workers_compensation_claims DROP CONSTRAINT IF EXISTS oh_workers_compensation_claims_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_workers_compensation_claims DROP CONSTRAINT IF EXISTS oh_workers_compensation_claims_claim_number_key;
ALTER TABLE IF EXISTS ONLY public.oh_screening_types DROP CONSTRAINT IF EXISTS oh_screening_types_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_types DROP CONSTRAINT IF EXISTS oh_screening_types_code_region_key;
ALTER TABLE IF EXISTS ONLY public.oh_screening_results DROP CONSTRAINT IF EXISTS oh_screening_results_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_documents DROP CONSTRAINT IF EXISTS oh_screening_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_config DROP CONSTRAINT IF EXISTS oh_screening_config_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_screening_config DROP CONSTRAINT IF EXISTS oh_screening_config_company_id_country_code_key;
ALTER TABLE IF EXISTS ONLY public.oh_pre_employment_screenings DROP CONSTRAINT IF EXISTS oh_pre_employment_screenings_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_employee_certifications DROP CONSTRAINT IF EXISTS oh_employee_certifications_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_claim_types DROP CONSTRAINT IF EXISTS oh_claim_types_region_type_code_key;
ALTER TABLE IF EXISTS ONLY public.oh_claim_types DROP CONSTRAINT IF EXISTS oh_claim_types_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_claim_status_history DROP CONSTRAINT IF EXISTS oh_claim_status_history_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_claim_documents DROP CONSTRAINT IF EXISTS oh_claim_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_certification_types DROP CONSTRAINT IF EXISTS oh_certification_types_type_code_key;
ALTER TABLE IF EXISTS ONLY public.oh_certification_types DROP CONSTRAINT IF EXISTS oh_certification_types_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_certification_alerts DROP CONSTRAINT IF EXISTS oh_certification_alerts_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_certification_alert_config DROP CONSTRAINT IF EXISTS oh_certification_alert_config_pkey;
ALTER TABLE IF EXISTS ONLY public.oh_certification_alert_config DROP CONSTRAINT IF EXISTS oh_certification_alert_config_company_id_key;
ALTER TABLE IF EXISTS ONLY public.notifications DROP CONSTRAINT IF EXISTS notifications_uuid_key;
ALTER TABLE IF EXISTS ONLY public.notifications DROP CONSTRAINT IF EXISTS notifications_pkey;
ALTER TABLE IF EXISTS ONLY public.notifications_enterprise DROP CONSTRAINT IF EXISTS notifications_enterprise_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_workflows DROP CONSTRAINT IF EXISTS notification_workflows_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_workflows DROP CONSTRAINT IF EXISTS notification_workflows_company_id_workflow_key_key;
ALTER TABLE IF EXISTS ONLY public.notification_threads DROP CONSTRAINT IF EXISTS notification_threads_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_thread_analysis DROP CONSTRAINT IF EXISTS notification_thread_analysis_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_templates DROP CONSTRAINT IF EXISTS notification_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_templates DROP CONSTRAINT IF EXISTS notification_templates_company_id_template_key_key;
ALTER TABLE IF EXISTS ONLY public.notification_sla_records DROP CONSTRAINT IF EXISTS notification_sla_records_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_sla_config DROP CONSTRAINT IF EXISTS notification_sla_config_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_sla_config DROP CONSTRAINT IF EXISTS notification_sla_config_company_id_notification_type_key;
ALTER TABLE IF EXISTS ONLY public.notification_queue DROP CONSTRAINT IF EXISTS notification_queue_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_participant_types DROP CONSTRAINT IF EXISTS notification_participant_types_type_code_key;
ALTER TABLE IF EXISTS ONLY public.notification_participant_types DROP CONSTRAINT IF EXISTS notification_participant_types_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_messages DROP CONSTRAINT IF EXISTS notification_messages_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_messages DROP CONSTRAINT IF EXISTS notification_messages_group_id_sequence_number_key;
ALTER TABLE IF EXISTS ONLY public.notification_learned_responses DROP CONSTRAINT IF EXISTS notification_learned_responses_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_groups DROP CONSTRAINT IF EXISTS notification_groups_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_flow_templates DROP CONSTRAINT IF EXISTS notification_flow_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_faq_patterns DROP CONSTRAINT IF EXISTS notification_faq_patterns_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_escalations DROP CONSTRAINT IF EXISTS notification_escalations_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_context_data DROP CONSTRAINT IF EXISTS notification_context_data_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_audit_log DROP CONSTRAINT IF EXISTS notification_audit_log_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_ai_suggestions DROP CONSTRAINT IF EXISTS notification_ai_suggestions_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_ai_learning DROP CONSTRAINT IF EXISTS notification_ai_learning_pkey;
ALTER TABLE IF EXISTS ONLY public.notification_actions_log DROP CONSTRAINT IF EXISTS notification_actions_log_pkey;
ALTER TABLE IF EXISTS ONLY public.multiple_art_configurations DROP CONSTRAINT IF EXISTS multiple_art_configurations_pkey;
ALTER TABLE IF EXISTS ONLY public.module_definitions DROP CONSTRAINT IF EXISTS module_definitions_pkey;
ALTER TABLE IF EXISTS ONLY public.module_definitions DROP CONSTRAINT IF EXISTS module_definitions_module_key_key;
ALTER TABLE IF EXISTS ONLY public.module_actions DROP CONSTRAINT IF EXISTS module_actions_pkey;
ALTER TABLE IF EXISTS ONLY public.module_actions DROP CONSTRAINT IF EXISTS module_actions_module_key_action_name_key;
ALTER TABLE IF EXISTS ONLY public.migration_log DROP CONSTRAINT IF EXISTS migration_log_pkey;
ALTER TABLE IF EXISTS ONLY public.migration_log DROP CONSTRAINT IF EXISTS migration_log_migration_name_key;
ALTER TABLE IF EXISTS ONLY public.messages DROP CONSTRAINT IF EXISTS messages_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_user_id_key;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_staff DROP CONSTRAINT IF EXISTS medical_staff_email_key;
ALTER TABLE IF EXISTS ONLY public.medical_records DROP CONSTRAINT IF EXISTS medical_records_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_record_audit_log DROP CONSTRAINT IF EXISTS medical_record_audit_log_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_leaves DROP CONSTRAINT IF EXISTS medical_leaves_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_exam_templates DROP CONSTRAINT IF EXISTS medical_exam_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_edit_authorizations DROP CONSTRAINT IF EXISTS medical_edit_authorizations_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_diagnoses DROP CONSTRAINT IF EXISTS medical_diagnoses_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_diagnoses DROP CONSTRAINT IF EXISTS medical_diagnoses_code_key;
ALTER TABLE IF EXISTS ONLY public.medical_communications DROP CONSTRAINT IF EXISTS medical_communications_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_certificates DROP CONSTRAINT IF EXISTS medical_certificates_pkey;
ALTER TABLE IF EXISTS ONLY public.medical_absence_types DROP CONSTRAINT IF EXISTS medical_absence_types_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_edit_authorizations DROP CONSTRAINT IF EXISTS legal_edit_authorizations_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_document_alerts DROP CONSTRAINT IF EXISTS legal_document_alerts_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_deadlines DROP CONSTRAINT IF EXISTS legal_deadlines_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_reference_number_key;
ALTER TABLE IF EXISTS ONLY public.legal_communications DROP CONSTRAINT IF EXISTS legal_communications_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_communication_types DROP CONSTRAINT IF EXISTS legal_communication_types_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_cases DROP CONSTRAINT IF EXISTS legal_cases_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_timeline_events DROP CONSTRAINT IF EXISTS legal_case_timeline_events_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_stages DROP CONSTRAINT IF EXISTS legal_case_stages_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_parties DROP CONSTRAINT IF EXISTS legal_case_parties_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_case_documents DROP CONSTRAINT IF EXISTS legal_case_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.legal_ai_analysis DROP CONSTRAINT IF EXISTS legal_ai_analysis_pkey;
ALTER TABLE IF EXISTS ONLY public.learning_patterns DROP CONSTRAINT IF EXISTS learning_patterns_pkey;
ALTER TABLE IF EXISTS ONLY public.learning_patterns DROP CONSTRAINT IF EXISTS learning_patterns_module_key_key;
ALTER TABLE IF EXISTS ONLY public.late_arrival_authorizations DROP CONSTRAINT IF EXISTS late_arrival_authorizations_pkey;
ALTER TABLE IF EXISTS ONLY public.labor_agreements_v2 DROP CONSTRAINT IF EXISTS labor_agreements_v2_pkey;
ALTER TABLE IF EXISTS ONLY public.labor_agreements_catalog DROP CONSTRAINT IF EXISTS labor_agreements_catalog_pkey;
ALTER TABLE IF EXISTS ONLY public.labor_agreements_catalog DROP CONSTRAINT IF EXISTS labor_agreements_catalog_code_key;
ALTER TABLE IF EXISTS ONLY public.kiosks DROP CONSTRAINT IF EXISTS kiosks_unique_name_per_company;
ALTER TABLE IF EXISTS ONLY public.kiosks DROP CONSTRAINT IF EXISTS kiosks_pkey;
ALTER TABLE IF EXISTS ONLY public.kiosks DROP CONSTRAINT IF EXISTS kiosks_device_id_key;
ALTER TABLE IF EXISTS ONLY public.job_postings DROP CONSTRAINT IF EXISTS job_postings_pkey;
ALTER TABLE IF EXISTS ONLY public.job_applications DROP CONSTRAINT IF EXISTS job_applications_pkey;
ALTER TABLE IF EXISTS ONLY public.job_application_notes DROP CONSTRAINT IF EXISTS job_application_notes_pkey;
ALTER TABLE IF EXISTS ONLY public.invoices DROP CONSTRAINT IF EXISTS invoices_pkey;
ALTER TABLE IF EXISTS ONLY public.invoices DROP CONSTRAINT IF EXISTS invoices_invoice_number_key;
ALTER TABLE IF EXISTS ONLY public.biometric_emotional_analysis DROP CONSTRAINT IF EXISTS idx_emotional_analysis_unique;
ALTER TABLE IF EXISTS ONLY public.hse_zone_configurations DROP CONSTRAINT IF EXISTS hse_zone_configurations_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_violation_catalog DROP CONSTRAINT IF EXISTS hse_violation_catalog_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_ppe_stats DROP CONSTRAINT IF EXISTS hse_ppe_stats_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_ppe_detections DROP CONSTRAINT IF EXISTS hse_ppe_detections_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_company_config DROP CONSTRAINT IF EXISTS hse_company_config_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_company_config DROP CONSTRAINT IF EXISTS hse_company_config_company_id_key;
ALTER TABLE IF EXISTS ONLY public.hse_cases DROP CONSTRAINT IF EXISTS hse_cases_pkey;
ALTER TABLE IF EXISTS ONLY public.hse_cases DROP CONSTRAINT IF EXISTS hse_cases_case_number_key;
ALTER TABLE IF EXISTS ONLY public.hour_bank_transactions DROP CONSTRAINT IF EXISTS hour_bank_transactions_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_templates DROP CONSTRAINT IF EXISTS hour_bank_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_scheduled_redemptions DROP CONSTRAINT IF EXISTS hour_bank_scheduled_redemptions_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_risk_analysis DROP CONSTRAINT IF EXISTS hour_bank_risk_analysis_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_risk_analysis DROP CONSTRAINT IF EXISTS hour_bank_risk_analysis_company_id_user_id_analysis_date_key;
ALTER TABLE IF EXISTS ONLY public.hour_bank_requests DROP CONSTRAINT IF EXISTS hour_bank_requests_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_requests DROP CONSTRAINT IF EXISTS hour_bank_redemption_requests_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_redemption_history DROP CONSTRAINT IF EXISTS hour_bank_redemption_history_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_pending_decisions DROP CONSTRAINT IF EXISTS hour_bank_pending_decisions_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_metrics_aggregated DROP CONSTRAINT IF EXISTS hour_bank_metrics_aggregated_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_metrics_aggregated DROP CONSTRAINT IF EXISTS hour_bank_metrics_aggregated_aggregation_level_company_id_b_key;
ALTER TABLE IF EXISTS ONLY public.hour_bank_loans DROP CONSTRAINT IF EXISTS hour_bank_loans_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_budgets DROP CONSTRAINT IF EXISTS hour_bank_budgets_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_budgets DROP CONSTRAINT IF EXISTS hour_bank_budgets_company_id_branch_id_department_id_period_key;
ALTER TABLE IF EXISTS ONLY public.hour_bank_blackout_dates DROP CONSTRAINT IF EXISTS hour_bank_blackout_dates_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_user_id_company_id_key;
ALTER TABLE IF EXISTS ONLY public.hour_bank_balances DROP CONSTRAINT IF EXISTS hour_bank_balances_pkey;
ALTER TABLE IF EXISTS ONLY public.hour_bank_agreements DROP CONSTRAINT IF EXISTS hour_bank_agreements_pkey;
ALTER TABLE IF EXISTS ONLY public.holidays DROP CONSTRAINT IF EXISTS holidays_pkey;
ALTER TABLE IF EXISTS ONLY public.fingerprint_biometric_data DROP CONSTRAINT IF EXISTS fingerprint_biometric_data_pkey;
ALTER TABLE IF EXISTS ONLY public.facial_biometric_data DROP CONSTRAINT IF EXISTS facial_biometric_data_pkey;
ALTER TABLE IF EXISTS ONLY public.extraordinary_licenses DROP CONSTRAINT IF EXISTS extraordinary_licenses_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_role_requirements DROP CONSTRAINT IF EXISTS epp_role_requirements_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_role_requirements DROP CONSTRAINT IF EXISTS epp_role_requirements_company_id_position_id_epp_catalog_id_key;
ALTER TABLE IF EXISTS ONLY public.epp_inspections DROP CONSTRAINT IF EXISTS epp_inspections_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_deliveries DROP CONSTRAINT IF EXISTS epp_deliveries_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_categories DROP CONSTRAINT IF EXISTS epp_categories_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_categories DROP CONSTRAINT IF EXISTS epp_categories_code_key;
ALTER TABLE IF EXISTS ONLY public.epp_catalog DROP CONSTRAINT IF EXISTS epp_catalog_pkey;
ALTER TABLE IF EXISTS ONLY public.epp_catalog DROP CONSTRAINT IF EXISTS epp_catalog_company_id_code_key;
ALTER TABLE IF EXISTS ONLY public.employee_ppe_consents DROP CONSTRAINT IF EXISTS employee_ppe_consents_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_locations DROP CONSTRAINT IF EXISTS employee_locations_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_documents DROP CONSTRAINT IF EXISTS employee_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_dependency_documents DROP CONSTRAINT IF EXISTS employee_dependency_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefits DROP CONSTRAINT IF EXISTS employee_benefits_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_benefit_documents DROP CONSTRAINT IF EXISTS employee_benefit_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.employee_assigned_assets DROP CONSTRAINT IF EXISTS employee_assigned_assets_pkey;
ALTER TABLE IF EXISTS ONLY public.email_verification_tokens DROP CONSTRAINT IF EXISTS email_verification_tokens_token_key;
ALTER TABLE IF EXISTS ONLY public.email_verification_tokens DROP CONSTRAINT IF EXISTS email_verification_tokens_pkey;
ALTER TABLE IF EXISTS ONLY public.email_thread_mapping DROP CONSTRAINT IF EXISTS email_thread_mapping_pkey;
ALTER TABLE IF EXISTS ONLY public.email_thread_mapping DROP CONSTRAINT IF EXISTS email_thread_mapping_outbound_message_id_key;
ALTER TABLE IF EXISTS ONLY public.email_templates DROP CONSTRAINT IF EXISTS email_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.email_logs DROP CONSTRAINT IF EXISTS email_logs_pkey;
ALTER TABLE IF EXISTS ONLY public.email_inbound_log DROP CONSTRAINT IF EXISTS email_inbound_log_pkey;
ALTER TABLE IF EXISTS ONLY public.email_configurations DROP CONSTRAINT IF EXISTS email_configurations_pkey;
ALTER TABLE IF EXISTS ONLY public.email_configurations DROP CONSTRAINT IF EXISTS email_configurations_institutional_email_key;
ALTER TABLE IF EXISTS ONLY public.ecosystem_workflows DROP CONSTRAINT IF EXISTS ecosystem_workflows_workflow_key_key;
ALTER TABLE IF EXISTS ONLY public.ecosystem_workflows DROP CONSTRAINT IF EXISTS ecosystem_workflows_pkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_tasks DROP CONSTRAINT IF EXISTS ecosystem_tasks_task_code_key;
ALTER TABLE IF EXISTS ONLY public.ecosystem_tasks DROP CONSTRAINT IF EXISTS ecosystem_tasks_pkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_phases DROP CONSTRAINT IF EXISTS ecosystem_phases_pkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_phases DROP CONSTRAINT IF EXISTS ecosystem_phases_phase_key_key;
ALTER TABLE IF EXISTS ONLY public.ecosystem_file_cache DROP CONSTRAINT IF EXISTS ecosystem_file_cache_pkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_file_cache DROP CONSTRAINT IF EXISTS ecosystem_file_cache_file_path_key;
ALTER TABLE IF EXISTS ONLY public.ecosystem_applications DROP CONSTRAINT IF EXISTS ecosystem_applications_pkey;
ALTER TABLE IF EXISTS ONLY public.ecosystem_applications DROP CONSTRAINT IF EXISTS ecosystem_applications_app_key_key;
ALTER TABLE IF EXISTS ONLY public.document_types DROP CONSTRAINT IF EXISTS document_types_pkey;
ALTER TABLE IF EXISTS ONLY public.document_types DROP CONSTRAINT IF EXISTS document_types_code_key;
ALTER TABLE IF EXISTS ONLY public.document_statuses DROP CONSTRAINT IF EXISTS document_statuses_pkey;
ALTER TABLE IF EXISTS ONLY public.document_statuses DROP CONSTRAINT IF EXISTS document_statuses_code_key;
ALTER TABLE IF EXISTS ONLY public.document_categories DROP CONSTRAINT IF EXISTS document_categories_pkey;
ALTER TABLE IF EXISTS ONLY public.document_categories DROP CONSTRAINT IF EXISTS document_categories_code_key;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_templates DROP CONSTRAINT IF EXISTS dms_workflow_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_instances DROP CONSTRAINT IF EXISTS dms_workflow_instances_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_workflow_approvals DROP CONSTRAINT IF EXISTS dms_workflow_approvals_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_folders DROP CONSTRAINT IF EXISTS dms_folders_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_folders DROP CONSTRAINT IF EXISTS dms_folders_company_id_full_path_key;
ALTER TABLE IF EXISTS ONLY public.dms_documents DROP CONSTRAINT IF EXISTS dms_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_versions DROP CONSTRAINT IF EXISTS dms_document_versions_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_versions DROP CONSTRAINT IF EXISTS dms_document_versions_document_id_version_number_key;
ALTER TABLE IF EXISTS ONLY public.dms_document_types DROP CONSTRAINT IF EXISTS dms_document_types_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_statuses DROP CONSTRAINT IF EXISTS dms_document_statuses_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_requests DROP CONSTRAINT IF EXISTS dms_document_requests_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_permissions DROP CONSTRAINT IF EXISTS dms_document_permissions_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_metadata DROP CONSTRAINT IF EXISTS dms_document_metadata_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_metadata DROP CONSTRAINT IF EXISTS dms_document_metadata_document_id_metadata_key_key;
ALTER TABLE IF EXISTS ONLY public.dms_document_categories DROP CONSTRAINT IF EXISTS dms_document_categories_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_document_alerts DROP CONSTRAINT IF EXISTS dms_document_alerts_pkey;
ALTER TABLE IF EXISTS ONLY public.dms_access_log DROP CONSTRAINT IF EXISTS dms_access_log_pkey;
ALTER TABLE IF EXISTS ONLY public.dependency_types DROP CONSTRAINT IF EXISTS dependency_types_type_code_key;
ALTER TABLE IF EXISTS ONLY public.dependency_types DROP CONSTRAINT IF EXISTS dependency_types_pkey;
ALTER TABLE IF EXISTS ONLY public.dependency_evaluations DROP CONSTRAINT IF EXISTS dependency_evaluations_pkey;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_pkey;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_name_key2;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_name_key1;
ALTER TABLE IF EXISTS ONLY public.departments DROP CONSTRAINT IF EXISTS departments_name_key;
ALTER TABLE IF EXISTS ONLY public.department_aliases DROP CONSTRAINT IF EXISTS department_aliases_pkey;
ALTER TABLE IF EXISTS ONLY public.department_aliases DROP CONSTRAINT IF EXISTS department_aliases_alias_company_id_key;
ALTER TABLE IF EXISTS ONLY public.data_integrity_log DROP CONSTRAINT IF EXISTS data_integrity_log_pkey;
ALTER TABLE IF EXISTS ONLY public.country_safety_regulations DROP CONSTRAINT IF EXISTS country_safety_regulations_pkey;
ALTER TABLE IF EXISTS ONLY public.cost_transactions DROP CONSTRAINT IF EXISTS cost_transactions_pkey;
ALTER TABLE IF EXISTS ONLY public.cost_budgets DROP CONSTRAINT IF EXISTS cost_budgets_pkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_pkey;
ALTER TABLE IF EXISTS ONLY public.contracts DROP CONSTRAINT IF EXISTS contracts_contract_code_key;
ALTER TABLE IF EXISTS ONLY public.contract_templates DROP CONSTRAINT IF EXISTS contract_templates_template_type_id_country_code_version_key;
ALTER TABLE IF EXISTS ONLY public.contract_templates DROP CONSTRAINT IF EXISTS contract_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.contract_template_types DROP CONSTRAINT IF EXISTS contract_template_types_pkey;
ALTER TABLE IF EXISTS ONLY public.contract_template_types DROP CONSTRAINT IF EXISTS contract_template_types_code_key;
ALTER TABLE IF EXISTS ONLY public.contract_renewal_logs DROP CONSTRAINT IF EXISTS contract_renewal_logs_pkey;
ALTER TABLE IF EXISTS ONLY public.contract_apk_licenses DROP CONSTRAINT IF EXISTS contract_apk_licenses_pkey;
ALTER TABLE IF EXISTS ONLY public.contextual_help DROP CONSTRAINT IF EXISTS contextual_help_pkey;
ALTER TABLE IF EXISTS ONLY public.contextual_help DROP CONSTRAINT IF EXISTS contextual_help_module_key_screen_key_element_key_key;
ALTER TABLE IF EXISTS ONLY public.consent_legal_documents DROP CONSTRAINT IF EXISTS consent_legal_documents_pkey;
ALTER TABLE IF EXISTS ONLY public.consent_definitions DROP CONSTRAINT IF EXISTS consent_definitions_pkey;
ALTER TABLE IF EXISTS ONLY public.consent_definitions DROP CONSTRAINT IF EXISTS consent_definitions_consent_key_key;
ALTER TABLE IF EXISTS ONLY public.consent_change_log DROP CONSTRAINT IF EXISTS consent_change_log_pkey;
ALTER TABLE IF EXISTS ONLY public.consent_audit_log DROP CONSTRAINT IF EXISTS consent_audit_log_pkey;
ALTER TABLE IF EXISTS ONLY public.concept_dependencies DROP CONSTRAINT IF EXISTS concept_dependencies_pkey;
ALTER TABLE IF EXISTS ONLY public.compliance_violations DROP CONSTRAINT IF EXISTS compliance_violations_pkey;
ALTER TABLE IF EXISTS ONLY public.compliance_rules DROP CONSTRAINT IF EXISTS compliance_rules_rule_code_key;
ALTER TABLE IF EXISTS ONLY public.compliance_rules DROP CONSTRAINT IF EXISTS compliance_rules_pkey;
ALTER TABLE IF EXISTS ONLY public.comparative_analytics DROP CONSTRAINT IF EXISTS comparative_analytics_pkey;
ALTER TABLE IF EXISTS ONLY public.company_tax_config DROP CONSTRAINT IF EXISTS company_tax_config_pkey;
ALTER TABLE IF EXISTS ONLY public.company_tax_config DROP CONSTRAINT IF EXISTS company_tax_config_company_id_key;
ALTER TABLE IF EXISTS ONLY public.company_tasks DROP CONSTRAINT IF EXISTS company_tasks_pkey;
ALTER TABLE IF EXISTS ONLY public.company_support_assignments DROP CONSTRAINT IF EXISTS company_support_assignments_pkey;
ALTER TABLE IF EXISTS ONLY public.company_risk_config DROP CONSTRAINT IF EXISTS company_risk_config_pkey;
ALTER TABLE IF EXISTS ONLY public.company_non_working_days DROP CONSTRAINT IF EXISTS company_non_working_days_pkey;
ALTER TABLE IF EXISTS ONLY public.company_non_working_days DROP CONSTRAINT IF EXISTS company_non_working_days_company_id_date_key;
ALTER TABLE IF EXISTS ONLY public.company_modules DROP CONSTRAINT IF EXISTS company_modules_pkey;
ALTER TABLE IF EXISTS ONLY public.company_medical_staff DROP CONSTRAINT IF EXISTS company_medical_staff_pkey;
ALTER TABLE IF EXISTS ONLY public.company_medical_staff DROP CONSTRAINT IF EXISTS company_medical_staff_company_id_partner_id_key;
ALTER TABLE IF EXISTS ONLY public.company_inbox_processed DROP CONSTRAINT IF EXISTS company_inbox_processed_pkey;
ALTER TABLE IF EXISTS ONLY public.company_inbox_processed DROP CONSTRAINT IF EXISTS company_inbox_processed_company_id_message_uid_key;
ALTER TABLE IF EXISTS ONLY public.company_fiscal_config DROP CONSTRAINT IF EXISTS company_fiscal_config_pkey;
ALTER TABLE IF EXISTS ONLY public.company_email_config DROP CONSTRAINT IF EXISTS company_email_config_pkey;
ALTER TABLE IF EXISTS ONLY public.company_email_config DROP CONSTRAINT IF EXISTS company_email_config_company_id_key;
ALTER TABLE IF EXISTS ONLY public.company_dependencies DROP CONSTRAINT IF EXISTS company_dependencies_pkey;
ALTER TABLE IF EXISTS ONLY public.company_communications DROP CONSTRAINT IF EXISTS company_communications_pkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_pkey;
ALTER TABLE IF EXISTS ONLY public.company_branches DROP CONSTRAINT IF EXISTS company_branches_company_id_branch_code_key;
ALTER TABLE IF EXISTS ONLY public.company_benefit_policies DROP CONSTRAINT IF EXISTS company_benefit_policies_pkey;
ALTER TABLE IF EXISTS ONLY public.company_benefit_policies DROP CONSTRAINT IF EXISTS company_benefit_policies_company_id_benefit_type_id_key;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_pkey;
ALTER TABLE IF EXISTS ONLY public.company_associate_contracts DROP CONSTRAINT IF EXISTS company_associate_contracts_company_id_associate_id_status_key;
ALTER TABLE IF EXISTS ONLY public.company_account_notifications DROP CONSTRAINT IF EXISTS company_account_notifications_pkey;
ALTER TABLE IF EXISTS ONLY public.companies DROP CONSTRAINT IF EXISTS companies_pkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_trace_id_key;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_pkey;
ALTER TABLE IF EXISTS ONLY public.commission_payments DROP CONSTRAINT IF EXISTS commission_payments_payment_code_key;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_trace_id_key;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_pkey;
ALTER TABLE IF EXISTS ONLY public.commission_liquidations DROP CONSTRAINT IF EXISTS commission_liquidations_liquidation_code_key;
ALTER TABLE IF EXISTS ONLY public.chronic_conditions_catalog DROP CONSTRAINT IF EXISTS chronic_conditions_catalog_pkey;
ALTER TABLE IF EXISTS ONLY public.chronic_conditions_catalog DROP CONSTRAINT IF EXISTS chronic_conditions_catalog_code_key;
ALTER TABLE IF EXISTS ONLY public.calendar_integrations DROP CONSTRAINT IF EXISTS calendar_integrations_pkey;
ALTER TABLE IF EXISTS ONLY public.calendar_integrations DROP CONSTRAINT IF EXISTS calendar_integrations_employee_id_calendar_provider_key;
ALTER TABLE IF EXISTS ONLY public.calendar_events DROP CONSTRAINT IF EXISTS calendar_events_pkey;
ALTER TABLE IF EXISTS ONLY public.business_validations DROP CONSTRAINT IF EXISTS business_validations_pkey;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_trace_id_key;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_pkey;
ALTER TABLE IF EXISTS ONLY public.budgets DROP CONSTRAINT IF EXISTS budgets_budget_code_key;
ALTER TABLE IF EXISTS ONLY public.branches DROP CONSTRAINT IF EXISTS branches_pkey;
ALTER TABLE IF EXISTS ONLY public.branches DROP CONSTRAINT IF EXISTS branches_code_key1;
ALTER TABLE IF EXISTS ONLY public.branches DROP CONSTRAINT IF EXISTS branches_code_key;
ALTER TABLE IF EXISTS ONLY public.branch_offices_fiscal DROP CONSTRAINT IF EXISTS branch_offices_fiscal_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_templates DROP CONSTRAINT IF EXISTS biometric_templates_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_settings DROP CONSTRAINT IF EXISTS biometric_settings_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_settings DROP CONSTRAINT IF EXISTS biometric_settings_company_id_key;
ALTER TABLE IF EXISTS ONLY public.biometric_events DROP CONSTRAINT IF EXISTS biometric_events_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_emotional_analysis DROP CONSTRAINT IF EXISTS biometric_emotional_analysis_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_devices DROP CONSTRAINT IF EXISTS biometric_devices_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_devices DROP CONSTRAINT IF EXISTS biometric_devices_company_id_device_id_key;
ALTER TABLE IF EXISTS ONLY public.biometric_detections DROP CONSTRAINT IF EXISTS biometric_detections_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_data DROP CONSTRAINT IF EXISTS biometric_data_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_consents DROP CONSTRAINT IF EXISTS biometric_consents_consent_token_key;
ALTER TABLE IF EXISTS ONLY public.biometric_company_config DROP CONSTRAINT IF EXISTS biometric_company_config_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_company_config DROP CONSTRAINT IF EXISTS biometric_company_config_company_id_key;
ALTER TABLE IF EXISTS ONLY public.biometric_capture_attempts DROP CONSTRAINT IF EXISTS biometric_capture_attempts_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_audit_log DROP CONSTRAINT IF EXISTS biometric_audit_log_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_analytics_aggregated DROP CONSTRAINT IF EXISTS biometric_analytics_aggregated_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_analytics_aggregated DROP CONSTRAINT IF EXISTS biometric_analytics_aggregate_company_id_measurement_date_d_key;
ALTER TABLE IF EXISTS ONLY public.biometric_ai_analysis DROP CONSTRAINT IF EXISTS biometric_ai_analysis_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_types DROP CONSTRAINT IF EXISTS benefit_types_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_types DROP CONSTRAINT IF EXISTS benefit_types_code_key;
ALTER TABLE IF EXISTS ONLY public.benefit_payroll_concepts DROP CONSTRAINT IF EXISTS benefit_payroll_concepts_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_payroll_concepts DROP CONSTRAINT IF EXISTS benefit_payroll_concepts_benefit_type_id_payroll_concept_ty_key;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_submissions DROP CONSTRAINT IF EXISTS benefit_expense_submissions_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_expense_allowances DROP CONSTRAINT IF EXISTS benefit_expense_allowances_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_document_requirements DROP CONSTRAINT IF EXISTS benefit_document_requirements_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_workflows DROP CONSTRAINT IF EXISTS benefit_approval_workflows_pkey;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_workflows DROP CONSTRAINT IF EXISTS benefit_approval_workflows_company_id_benefit_type_id_appro_key;
ALTER TABLE IF EXISTS ONLY public.benefit_approval_history DROP CONSTRAINT IF EXISTS benefit_approval_history_pkey;
ALTER TABLE IF EXISTS ONLY public.audit_test_logs DROP CONSTRAINT IF EXISTS audit_test_logs_pkey;
ALTER TABLE IF EXISTS ONLY public.audit_reports DROP CONSTRAINT IF EXISTS audit_reports_verification_code_key;
ALTER TABLE IF EXISTS ONLY public.audit_reports DROP CONSTRAINT IF EXISTS audit_reports_pkey;
ALTER TABLE IF EXISTS ONLY public.audit_logs DROP CONSTRAINT IF EXISTS audit_logs_pkey;
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS attendances_pkey;
ALTER TABLE IF EXISTS ONLY public.attendances DROP CONSTRAINT IF EXISTS attendances_authorization_token_key;
ALTER TABLE IF EXISTS ONLY public.attendance_profiles DROP CONSTRAINT IF EXISTS attendance_profiles_pkey;
ALTER TABLE IF EXISTS ONLY public.attendance_patterns DROP CONSTRAINT IF EXISTS attendance_patterns_pkey;
ALTER TABLE IF EXISTS ONLY public.attendance_analytics_cache DROP CONSTRAINT IF EXISTS attendance_analytics_cache_pkey;
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_pkey;
ALTER TABLE IF EXISTS ONLY public.associate_employee_assignments DROP CONSTRAINT IF EXISTS associate_employee_assignments_contract_id_employee_id_key;
ALTER TABLE IF EXISTS ONLY public.assistant_knowledge_base DROP CONSTRAINT IF EXISTS assistant_knowledge_base_pkey;
ALTER TABLE IF EXISTS ONLY public.assistant_conversations DROP CONSTRAINT IF EXISTS assistant_conversations_pkey;
ALTER TABLE IF EXISTS ONLY public.assistant_action_handlers DROP CONSTRAINT IF EXISTS assistant_action_handlers_pkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_pkey;
ALTER TABLE IF EXISTS ONLY public.asset_contracts DROP CONSTRAINT IF EXISTS asset_contracts_contract_number_key;
ALTER TABLE IF EXISTS ONLY public.art_configurations DROP CONSTRAINT IF EXISTS art_configurations_pkey;
ALTER TABLE IF EXISTS ONLY public.approved_shift_swaps DROP CONSTRAINT IF EXISTS approved_shift_swaps_pkey;
ALTER TABLE IF EXISTS ONLY public.approved_shift_swaps DROP CONSTRAINT IF EXISTS approved_shift_swaps_company_id_employee_1_id_employee_2_id_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_user_id_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff_roles DROP CONSTRAINT IF EXISTS aponnt_staff_roles_role_code_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff_roles DROP CONSTRAINT IF EXISTS aponnt_staff_roles_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff DROP CONSTRAINT IF EXISTS aponnt_staff_email_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff_companies DROP CONSTRAINT IF EXISTS aponnt_staff_companies_staff_id_company_id_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_staff_companies DROP CONSTRAINT IF EXISTS aponnt_staff_companies_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_pre_invoices DROP CONSTRAINT IF EXISTS aponnt_pre_invoices_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_email_config DROP CONSTRAINT IF EXISTS aponnt_email_config_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_email_config DROP CONSTRAINT IF EXISTS aponnt_email_config_config_type_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_associates DROP CONSTRAINT IF EXISTS aponnt_associates_pkey;
ALTER TABLE IF EXISTS ONLY public.aponnt_associates DROP CONSTRAINT IF EXISTS aponnt_associates_email_key;
ALTER TABLE IF EXISTS ONLY public.aponnt_admin_tasks DROP CONSTRAINT IF EXISTS aponnt_admin_tasks_pkey;
ALTER TABLE IF EXISTS ONLY public.afip_cae_log DROP CONSTRAINT IF EXISTS afip_cae_log_pkey;
ALTER TABLE IF EXISTS ONLY public.afip_auth_log DROP CONSTRAINT IF EXISTS afip_auth_log_pkey;
ALTER TABLE IF EXISTS ONLY public.administrative_tasks DROP CONSTRAINT IF EXISTS administrative_tasks_pkey;
ALTER TABLE IF EXISTS ONLY public.additional_role_types DROP CONSTRAINT IF EXISTS additional_role_types_pkey;
ALTER TABLE IF EXISTS ONLY public.access_notifications DROP CONSTRAINT IF EXISTS access_notifications_pkey;
ALTER TABLE IF EXISTS ONLY public.access_audit_log DROP CONSTRAINT IF EXISTS access_audit_log_pkey;
ALTER TABLE IF EXISTS ONLY public.absence_cases DROP CONSTRAINT IF EXISTS absence_cases_pkey;
ALTER TABLE IF EXISTS ONLY public."UserShifts" DROP CONSTRAINT IF EXISTS "UserShifts_pkey";
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p9 DROP CONSTRAINT IF EXISTS biometric_scans_p9_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p8 DROP CONSTRAINT IF EXISTS biometric_scans_p8_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p7 DROP CONSTRAINT IF EXISTS biometric_scans_p7_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p6 DROP CONSTRAINT IF EXISTS biometric_scans_p6_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p5 DROP CONSTRAINT IF EXISTS biometric_scans_p5_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p4 DROP CONSTRAINT IF EXISTS biometric_scans_p4_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p3 DROP CONSTRAINT IF EXISTS biometric_scans_p3_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p2 DROP CONSTRAINT IF EXISTS biometric_scans_p2_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p1 DROP CONSTRAINT IF EXISTS biometric_scans_p1_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p15 DROP CONSTRAINT IF EXISTS biometric_scans_p15_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p14 DROP CONSTRAINT IF EXISTS biometric_scans_p14_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p13 DROP CONSTRAINT IF EXISTS biometric_scans_p13_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p12 DROP CONSTRAINT IF EXISTS biometric_scans_p12_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p11 DROP CONSTRAINT IF EXISTS biometric_scans_p11_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p10 DROP CONSTRAINT IF EXISTS biometric_scans_p10_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_scans_p0 DROP CONSTRAINT IF EXISTS biometric_scans_p0_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_scans DROP CONSTRAINT IF EXISTS pk_biometric_scans;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p9 DROP CONSTRAINT IF EXISTS biometric_alerts_p9_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p8 DROP CONSTRAINT IF EXISTS biometric_alerts_p8_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p7 DROP CONSTRAINT IF EXISTS biometric_alerts_p7_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p6 DROP CONSTRAINT IF EXISTS biometric_alerts_p6_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p5 DROP CONSTRAINT IF EXISTS biometric_alerts_p5_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p4 DROP CONSTRAINT IF EXISTS biometric_alerts_p4_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p3 DROP CONSTRAINT IF EXISTS biometric_alerts_p3_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p2 DROP CONSTRAINT IF EXISTS biometric_alerts_p2_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p1 DROP CONSTRAINT IF EXISTS biometric_alerts_p1_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p15 DROP CONSTRAINT IF EXISTS biometric_alerts_p15_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p14 DROP CONSTRAINT IF EXISTS biometric_alerts_p14_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p13 DROP CONSTRAINT IF EXISTS biometric_alerts_p13_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p12 DROP CONSTRAINT IF EXISTS biometric_alerts_p12_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p11 DROP CONSTRAINT IF EXISTS biometric_alerts_p11_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p10 DROP CONSTRAINT IF EXISTS biometric_alerts_p10_pkey;
ALTER TABLE IF EXISTS ONLY biometric_partitions.biometric_alerts_p0 DROP CONSTRAINT IF EXISTS biometric_alerts_p0_pkey;
ALTER TABLE IF EXISTS ONLY public.biometric_alerts DROP CONSTRAINT IF EXISTS pk_biometric_alerts;
ALTER TABLE IF EXISTS public.visitors ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.visitor_gps_tracking ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vendor_referrals ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vendor_ratings ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vendor_commissions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vacation_scales ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vacation_requests ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.vacation_configurations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.ux_discoveries ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_work_restrictions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_work_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_vaccinations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_union_affiliation ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_surgeries ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_sports_activities ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_shift_assignments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_salary_config_v2 ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_salary_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_role_assignments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_psychiatric_treatments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_professional_licenses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_primary_physician ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_permission_requests ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_payroll_records ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_payroll_concept_overrides ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_payroll_bonuses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_payroll_assignment ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_notification_preferences ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_medications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_medical_exams ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_medical_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_marital_status ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_legal_issues ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_household_members ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_healthy_habits ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_family_members ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_emergency_contacts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_emails ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_education ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_driver_licenses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_disciplinary_actions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_contact_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_chronic_conditions_v2 ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_chronic_conditions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_children ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_audit_logs ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_assigned_tasks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_anthropometric_data ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_allergies ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.user_activity_restrictions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.used_tokens ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.trainings ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.training_assignments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.testing_tickets ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.test_results ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.test_executions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.tax_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.tax_rates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.tax_conditions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.tax_concepts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.task_compatibility ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.system_modules_registry ALTER COLUMN registry_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.system_metadata ALTER COLUMN metadata_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.system_consciousness_log ALTER COLUMN log_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.suspension_blocks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.support_sla_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sports_catalog ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sla_metrics ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_transacciones_pendientes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_tipos_comprobantes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_stock_movimientos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_sesiones_locales ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_sesiones_caja ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_puntos_venta ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_productos_precios ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_productos_marcas ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_productos_componentes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_productos_categorias ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_productos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_presupuestos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_numeracion_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_numeracion_comprobantes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_modulos_empresa ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_listas_precios ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_facturas_pagos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_facturas_items ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_facturas_impuestos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_facturas ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_configuracion_terminal ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_configuracion_empresa ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_clientes_precios_especiales ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_clientes_direcciones ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_clientes_contactos ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_clientes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.siac_cajas ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sectors ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.scoring_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sanctions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sanction_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.sanction_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.salary_categories_v2 ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.salary_categories ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.role_definitions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.risk_benchmarks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.request_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.report_access_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.proactive_rules ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.proactive_executions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_template_concepts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_runs ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_run_details ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_run_concept_details ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_payslip_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_payslip_block_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_entity_settlements ALTER COLUMN settlement_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_entity_settlement_details ALTER COLUMN detail_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_entity_categories ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_entities ALTER COLUMN entity_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_countries ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_concept_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_concept_type_rates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payroll_concept_classifications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.payments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.partner_roles ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.organizational_positions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_workers_compensation_claims ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_screening_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_screening_results ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_screening_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_screening_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_employee_certifications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_claim_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_claim_status_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_claim_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_certification_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_certification_alerts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.oh_certification_alert_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notifications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_workflows ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_thread_analysis ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_sla_records ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_sla_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_participant_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_learned_responses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_flow_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_faq_patterns ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_escalations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_context_data ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_audit_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_ai_suggestions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_ai_learning ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.notification_actions_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.multiple_art_configurations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.module_definitions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.migration_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.medical_records ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.medical_record_audit_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.medical_exam_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.medical_edit_authorizations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.medical_certificates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_edit_authorizations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_document_alerts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_deadlines ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_cases ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_case_timeline_events ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_case_stages ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_case_parties ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_case_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.legal_ai_analysis ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.learning_patterns ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.labor_agreements_v2 ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.labor_agreements_catalog ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.kiosks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.job_postings ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.job_applications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.job_application_notes ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.invoices ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hse_ppe_stats ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hse_company_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hour_bank_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hour_bank_risk_analysis ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hour_bank_metrics_aggregated ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hour_bank_budgets ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.hour_bank_blackout_dates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.extraordinary_licenses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.epp_role_requirements ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.epp_inspections ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.epp_deliveries ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.epp_categories ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.epp_catalog ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.employee_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.employee_dependency_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.employee_benefits ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.employee_benefit_documents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.employee_assigned_assets ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.email_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.email_logs ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.email_configurations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.document_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.document_statuses ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.document_categories ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.dms_workflow_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.dms_access_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.dependency_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.dependency_evaluations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.departments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.department_aliases ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.data_integrity_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.cost_transactions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.cost_budgets ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.contract_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.contract_template_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.contextual_help ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.consent_change_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.concept_dependencies ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.compliance_violations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.compliance_rules ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.comparative_analytics ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_tax_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_tasks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_risk_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_non_working_days ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_fiscal_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_dependencies ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_communications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_branches ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_benefit_policies ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_associate_contracts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.company_account_notifications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.companies ALTER COLUMN company_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.chronic_conditions_catalog ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.calendar_integrations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.calendar_events ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.business_validations ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.branch_offices_fiscal ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_templates ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_scans ALTER COLUMN scan_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_emotional_analysis ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_consents ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_company_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_audit_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_analytics_aggregated ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.biometric_alerts ALTER COLUMN alert_id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_types ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_payroll_concepts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_expense_submissions ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_expense_allowances ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_document_requirements ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_approval_workflows ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.benefit_approval_history ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.audit_reports ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.attendance_profiles ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.attendance_patterns ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.attendance_analytics_cache ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.associate_employee_assignments ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.asset_contracts ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.approved_shift_swaps ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.aponnt_pre_invoices ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.aponnt_email_config ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.aponnt_admin_tasks ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.afip_cae_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.afip_auth_log ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.access_notifications ALTER COLUMN id DROP DEFAULT;
ALTER TABLE IF EXISTS public.access_audit_log ALTER COLUMN id DROP DEFAULT;
DROP VIEW IF EXISTS public.vw_user_salary_complete;
DROP VIEW IF EXISTS public.vw_positions_with_templates;
DROP VIEW IF EXISTS public.vw_payroll_historical_details;
DROP VIEW IF EXISTS public.vw_hour_bank_drilldown;
DROP VIEW IF EXISTS public.vw_commissions_dashboard;
DROP VIEW IF EXISTS public.vw_commission_payments_dashboard;
DROP VIEW IF EXISTS public.vw_admin_tasks_dashboard;
DROP SEQUENCE IF EXISTS public.visitors_id_seq;
DROP TABLE IF EXISTS public.visitors;
DROP SEQUENCE IF EXISTS public.visitor_gps_tracking_id_seq;
DROP TABLE IF EXISTS public.visitor_gps_tracking;
DROP TABLE IF EXISTS public.vendor_statistics;
DROP SEQUENCE IF EXISTS public.vendor_referrals_id_seq;
DROP TABLE IF EXISTS public.vendor_referrals;
DROP SEQUENCE IF EXISTS public.vendor_ratings_id_seq;
DROP TABLE IF EXISTS public.vendor_ratings;
DROP SEQUENCE IF EXISTS public.vendor_commissions_id_seq;
DROP TABLE IF EXISTS public.vendor_commissions;
DROP SEQUENCE IF EXISTS public.vacation_scales_id_seq;
DROP TABLE IF EXISTS public.vacation_scales;
DROP SEQUENCE IF EXISTS public.vacation_requests_id_seq;
DROP TABLE IF EXISTS public.vacation_requests;
DROP SEQUENCE IF EXISTS public.vacation_configurations_id_seq;
DROP TABLE IF EXISTS public.vacation_configurations;
DROP VIEW IF EXISTS public.v_wellness_trends;
DROP VIEW IF EXISTS public.v_vendor_notifications;
DROP VIEW IF EXISTS public.v_user_socioeconomic_summary;
DROP VIEW IF EXISTS public.v_template_concepts_with_entity;
DROP VIEW IF EXISTS public.v_staff_pyramid_percentage;
DROP VIEW IF EXISTS public.v_sent_notifications_awaiting_response;
DROP VIEW IF EXISTS public.v_procedure_hierarchy;
DROP VIEW IF EXISTS public.v_pending_supervisor_approvals;
DROP VIEW IF EXISTS public.v_pending_pre_invoices;
DROP VIEW IF EXISTS public.v_pending_inbound_emails;
DROP VIEW IF EXISTS public.v_pending_hr_approvals;
DROP VIEW IF EXISTS public.v_payslip_templates_full;
DROP VIEW IF EXISTS public.v_payroll_entities_with_category;
DROP VIEW IF EXISTS public.v_partner_commission_dashboard;
DROP VIEW IF EXISTS public.v_oh_active_screenings;
DROP VIEW IF EXISTS public.v_notification_pending_summary;
DROP VIEW IF EXISTS public.v_medical_selectable_violations;
DROP VIEW IF EXISTS public.v_job_applications_summary;
DROP VIEW IF EXISTS public.v_hse_pending_cases;
DROP VIEW IF EXISTS public.v_hr_security_alerts;
DROP VIEW IF EXISTS public.v_expiring_documents;
DROP VIEW IF EXISTS public.v_entity_settlements_summary;
DROP VIEW IF EXISTS public.v_entities_period_summary;
DROP VIEW IF EXISTS public.v_employee_procedures;
DROP VIEW IF EXISTS public.v_employee_loan_status;
DROP VIEW IF EXISTS public.v_employee_benefits_summary;
DROP VIEW IF EXISTS public.v_email_stats_by_company;
DROP VIEW IF EXISTS public.v_email_configurations_summary;
DROP VIEW IF EXISTS public.v_department_wellness;
DROP VIEW IF EXISTS public.v_concept_types_with_help;
DROP VIEW IF EXISTS public.v_concept_dependencies_summary;
DROP VIEW IF EXISTS public.v_companies_with_imap;
DROP VIEW IF EXISTS public.v_commercial_notifications;
DROP VIEW IF EXISTS public.v_candidates_pending_medical;
DROP VIEW IF EXISTS public.v_attendances_360;
DROP VIEW IF EXISTS public.v_assigned_assets_full;
DROP VIEW IF EXISTS public.v_ai_detectable_violations;
DROP VIEW IF EXISTS public.v_admin_tasks_dashboard;
DROP VIEW IF EXISTS public.v_active_kiosks;
DROP SEQUENCE IF EXISTS public.ux_discoveries_id_seq;
DROP TABLE IF EXISTS public.ux_discoveries;
DROP SEQUENCE IF EXISTS public.user_work_restrictions_id_seq;
DROP TABLE IF EXISTS public.user_work_restrictions;
DROP SEQUENCE IF EXISTS public.user_work_history_id_seq;
DROP TABLE IF EXISTS public.user_work_history;
DROP SEQUENCE IF EXISTS public.user_vaccinations_id_seq;
DROP TABLE IF EXISTS public.user_vaccinations;
DROP SEQUENCE IF EXISTS public.user_union_affiliation_id_seq;
DROP TABLE IF EXISTS public.user_union_affiliation;
DROP VIEW IF EXISTS public.user_tasks_summary;
DROP SEQUENCE IF EXISTS public.user_surgeries_id_seq;
DROP TABLE IF EXISTS public.user_surgeries;
DROP SEQUENCE IF EXISTS public.user_sports_activities_id_seq;
DROP TABLE IF EXISTS public.user_sports_activities;
DROP TABLE IF EXISTS public.user_shifts;
DROP SEQUENCE IF EXISTS public.user_shift_assignments_id_seq;
DROP TABLE IF EXISTS public.user_shift_assignments;
DROP SEQUENCE IF EXISTS public.user_salary_config_v2_id_seq;
DROP TABLE IF EXISTS public.user_salary_config_v2;
DROP SEQUENCE IF EXISTS public.user_salary_config_id_seq;
DROP TABLE IF EXISTS public.user_salary_config;
DROP SEQUENCE IF EXISTS public.user_role_assignments_id_seq;
DROP TABLE IF EXISTS public.user_role_assignments;
DROP SEQUENCE IF EXISTS public.user_psychiatric_treatments_id_seq;
DROP TABLE IF EXISTS public.user_psychiatric_treatments;
DROP SEQUENCE IF EXISTS public.user_professional_licenses_id_seq;
DROP TABLE IF EXISTS public.user_professional_licenses;
DROP SEQUENCE IF EXISTS public.user_primary_physician_id_seq;
DROP TABLE IF EXISTS public.user_primary_physician;
DROP TABLE IF EXISTS public.user_permissions;
DROP SEQUENCE IF EXISTS public.user_permission_requests_id_seq;
DROP TABLE IF EXISTS public.user_permission_requests;
DROP SEQUENCE IF EXISTS public.user_payroll_records_id_seq;
DROP TABLE IF EXISTS public.user_payroll_records;
DROP SEQUENCE IF EXISTS public.user_payroll_concept_overrides_id_seq;
DROP TABLE IF EXISTS public.user_payroll_concept_overrides;
DROP SEQUENCE IF EXISTS public.user_payroll_bonuses_id_seq;
DROP TABLE IF EXISTS public.user_payroll_bonuses;
DROP SEQUENCE IF EXISTS public.user_payroll_assignment_id_seq;
DROP TABLE IF EXISTS public.user_payroll_assignment;
DROP SEQUENCE IF EXISTS public.user_notification_preferences_id_seq;
DROP TABLE IF EXISTS public.user_notification_preferences;
DROP SEQUENCE IF EXISTS public.user_medications_id_seq;
DROP TABLE IF EXISTS public.user_medications;
DROP SEQUENCE IF EXISTS public.user_medical_exams_id_seq;
DROP TABLE IF EXISTS public.user_medical_exams;
DROP SEQUENCE IF EXISTS public.user_medical_documents_id_seq;
DROP TABLE IF EXISTS public.user_medical_documents;
DROP SEQUENCE IF EXISTS public.user_marital_status_id_seq;
DROP TABLE IF EXISTS public.user_marital_status;
DROP SEQUENCE IF EXISTS public.user_legal_issues_id_seq;
DROP TABLE IF EXISTS public.user_legal_issues;
DROP SEQUENCE IF EXISTS public.user_household_members_id_seq;
DROP TABLE IF EXISTS public.user_household_members;
DROP SEQUENCE IF EXISTS public.user_healthy_habits_id_seq;
DROP TABLE IF EXISTS public.user_healthy_habits;
DROP SEQUENCE IF EXISTS public.user_family_members_id_seq;
DROP TABLE IF EXISTS public.user_family_members;
DROP SEQUENCE IF EXISTS public.user_emergency_contacts_id_seq;
DROP TABLE IF EXISTS public.user_emergency_contacts;
DROP SEQUENCE IF EXISTS public.user_emails_id_seq;
DROP TABLE IF EXISTS public.user_emails;
DROP SEQUENCE IF EXISTS public.user_education_id_seq;
DROP TABLE IF EXISTS public.user_education;
DROP SEQUENCE IF EXISTS public.user_driver_licenses_id_seq;
DROP TABLE IF EXISTS public.user_driver_licenses;
DROP SEQUENCE IF EXISTS public.user_documents_id_seq;
DROP TABLE IF EXISTS public.user_documents;
DROP SEQUENCE IF EXISTS public.user_disciplinary_actions_id_seq;
DROP TABLE IF EXISTS public.user_disciplinary_actions;
DROP SEQUENCE IF EXISTS public.user_contact_history_id_seq;
DROP TABLE IF EXISTS public.user_contact_history;
DROP TABLE IF EXISTS public.user_consents;
DROP SEQUENCE IF EXISTS public.user_chronic_conditions_v2_id_seq;
DROP TABLE IF EXISTS public.user_chronic_conditions_v2;
DROP SEQUENCE IF EXISTS public.user_chronic_conditions_id_seq;
DROP TABLE IF EXISTS public.user_chronic_conditions;
DROP SEQUENCE IF EXISTS public.user_children_id_seq;
DROP TABLE IF EXISTS public.user_children;
DROP SEQUENCE IF EXISTS public.user_audit_logs_id_seq;
DROP TABLE IF EXISTS public.user_audit_logs;
DROP SEQUENCE IF EXISTS public.user_assigned_tasks_id_seq;
DROP TABLE IF EXISTS public.user_assigned_tasks;
DROP SEQUENCE IF EXISTS public.user_anthropometric_data_id_seq;
DROP TABLE IF EXISTS public.user_anthropometric_data;
DROP SEQUENCE IF EXISTS public.user_allergies_id_seq;
DROP TABLE IF EXISTS public.user_allergies;
DROP SEQUENCE IF EXISTS public.user_activity_restrictions_id_seq;
DROP TABLE IF EXISTS public.user_activity_restrictions;
DROP SEQUENCE IF EXISTS public.used_tokens_id_seq;
DROP TABLE IF EXISTS public.used_tokens;
DROP TABLE IF EXISTS public.unified_notifications;
DROP VIEW IF EXISTS public.unified_help_stats;
DROP TABLE IF EXISTS public.unified_help_interactions;
DROP TABLE IF EXISTS public.unauthorized_access_attempts;
DROP SEQUENCE IF EXISTS public.trainings_id_seq;
DROP TABLE IF EXISTS public.trainings;
DROP SEQUENCE IF EXISTS public.training_assignments_id_seq;
DROP TABLE IF EXISTS public.training_assignments;
DROP SEQUENCE IF EXISTS public.testing_tickets_id_seq;
DROP TABLE IF EXISTS public.testing_tickets;
DROP SEQUENCE IF EXISTS public.test_results_id_seq;
DROP TABLE IF EXISTS public.test_results;
DROP SEQUENCE IF EXISTS public.test_executions_id_seq;
DROP TABLE IF EXISTS public.test_executions;
DROP SEQUENCE IF EXISTS public.tax_templates_id_seq;
DROP TABLE IF EXISTS public.tax_templates;
DROP SEQUENCE IF EXISTS public.tax_rates_id_seq;
DROP TABLE IF EXISTS public.tax_rates;
DROP SEQUENCE IF EXISTS public.tax_conditions_id_seq;
DROP TABLE IF EXISTS public.tax_conditions;
DROP SEQUENCE IF EXISTS public.tax_concepts_id_seq;
DROP TABLE IF EXISTS public.tax_concepts;
DROP SEQUENCE IF EXISTS public.task_compatibility_id_seq;
DROP TABLE IF EXISTS public.task_compatibility;
DROP SEQUENCE IF EXISTS public.system_modules_registry_registry_id_seq;
DROP TABLE IF EXISTS public.system_modules_registry;
DROP TABLE IF EXISTS public.system_modules;
DROP SEQUENCE IF EXISTS public.system_metadata_metadata_id_seq;
DROP TABLE IF EXISTS public.system_metadata;
DROP SEQUENCE IF EXISTS public.system_consciousness_log_log_id_seq;
DROP TABLE IF EXISTS public.system_consciousness_log;
DROP TABLE IF EXISTS public.system_config;
DROP SEQUENCE IF EXISTS public.suspension_blocks_id_seq;
DROP TABLE IF EXISTS public.suspension_blocks;
DROP TABLE IF EXISTS public.support_vendor_supervisors;
DROP TABLE IF EXISTS public.support_vendor_stats;
DROP TABLE IF EXISTS public.support_tickets;
DROP TABLE IF EXISTS public.support_ticket_messages;
DROP TABLE IF EXISTS public.support_ticket_escalations;
DROP TABLE IF EXISTS public.support_sla_plans;
DROP SEQUENCE IF EXISTS public.support_sla_config_id_seq;
DROP TABLE IF EXISTS public.support_sla_config;
DROP TABLE IF EXISTS public.support_escalations;
DROP TABLE IF EXISTS public.support_assistant_attempts;
DROP TABLE IF EXISTS public.support_activity_log;
DROP TABLE IF EXISTS public.super_users;
DROP SEQUENCE IF EXISTS public.sports_catalog_id_seq;
DROP TABLE IF EXISTS public.sports_catalog;
DROP SEQUENCE IF EXISTS public.sla_metrics_id_seq;
DROP TABLE IF EXISTS public.sla_metrics;
DROP SEQUENCE IF EXISTS public.siac_transacciones_pendientes_id_seq;
DROP TABLE IF EXISTS public.siac_transacciones_pendientes;
DROP SEQUENCE IF EXISTS public.siac_tipos_comprobantes_id_seq;
DROP TABLE IF EXISTS public.siac_tipos_comprobantes;
DROP SEQUENCE IF EXISTS public.siac_stock_movimientos_id_seq;
DROP TABLE IF EXISTS public.siac_stock_movimientos;
DROP SEQUENCE IF EXISTS public.siac_sesiones_locales_id_seq;
DROP TABLE IF EXISTS public.siac_sesiones_locales;
DROP SEQUENCE IF EXISTS public.siac_sesiones_caja_id_seq;
DROP TABLE IF EXISTS public.siac_sesiones_caja;
DROP SEQUENCE IF EXISTS public.siac_puntos_venta_id_seq;
DROP TABLE IF EXISTS public.siac_puntos_venta;
DROP SEQUENCE IF EXISTS public.siac_productos_precios_id_seq;
DROP TABLE IF EXISTS public.siac_productos_precios;
DROP SEQUENCE IF EXISTS public.siac_productos_marcas_id_seq;
DROP TABLE IF EXISTS public.siac_productos_marcas;
DROP SEQUENCE IF EXISTS public.siac_productos_id_seq;
DROP SEQUENCE IF EXISTS public.siac_productos_componentes_id_seq;
DROP TABLE IF EXISTS public.siac_productos_componentes;
DROP SEQUENCE IF EXISTS public.siac_productos_categorias_id_seq;
DROP TABLE IF EXISTS public.siac_productos_categorias;
DROP TABLE IF EXISTS public.siac_productos;
DROP SEQUENCE IF EXISTS public.siac_presupuestos_id_seq;
DROP TABLE IF EXISTS public.siac_presupuestos;
DROP SEQUENCE IF EXISTS public.siac_numeracion_log_id_seq;
DROP TABLE IF EXISTS public.siac_numeracion_log;
DROP SEQUENCE IF EXISTS public.siac_numeracion_comprobantes_id_seq;
DROP TABLE IF EXISTS public.siac_numeracion_comprobantes;
DROP SEQUENCE IF EXISTS public.siac_modulos_empresa_id_seq;
DROP TABLE IF EXISTS public.siac_modulos_empresa;
DROP SEQUENCE IF EXISTS public.siac_listas_precios_id_seq;
DROP TABLE IF EXISTS public.siac_listas_precios;
DROP SEQUENCE IF EXISTS public.siac_facturas_pagos_id_seq;
DROP TABLE IF EXISTS public.siac_facturas_pagos;
DROP SEQUENCE IF EXISTS public.siac_facturas_items_id_seq;
DROP TABLE IF EXISTS public.siac_facturas_items;
DROP SEQUENCE IF EXISTS public.siac_facturas_impuestos_id_seq;
DROP TABLE IF EXISTS public.siac_facturas_impuestos;
DROP SEQUENCE IF EXISTS public.siac_facturas_id_seq;
DROP TABLE IF EXISTS public.siac_facturas;
DROP SEQUENCE IF EXISTS public.siac_configuracion_terminal_id_seq;
DROP TABLE IF EXISTS public.siac_configuracion_terminal;
DROP SEQUENCE IF EXISTS public.siac_configuracion_empresa_id_seq;
DROP TABLE IF EXISTS public.siac_configuracion_empresa;
DROP SEQUENCE IF EXISTS public.siac_clientes_precios_especiales_id_seq;
DROP TABLE IF EXISTS public.siac_clientes_precios_especiales;
DROP SEQUENCE IF EXISTS public.siac_clientes_id_seq;
DROP SEQUENCE IF EXISTS public.siac_clientes_direcciones_id_seq;
DROP TABLE IF EXISTS public.siac_clientes_direcciones;
DROP SEQUENCE IF EXISTS public.siac_clientes_contactos_id_seq;
DROP TABLE IF EXISTS public.siac_clientes_contactos;
DROP TABLE IF EXISTS public.siac_clientes;
DROP SEQUENCE IF EXISTS public.siac_cajas_id_seq;
DROP TABLE IF EXISTS public.siac_cajas;
DROP TABLE IF EXISTS public.shifts;
DROP SEQUENCE IF EXISTS public.sectors_id_seq;
DROP TABLE IF EXISTS public.sectors;
DROP SEQUENCE IF EXISTS public.scoring_history_id_seq;
DROP TABLE IF EXISTS public.scoring_history;
DROP TABLE IF EXISTS public.schema_migrations;
DROP SEQUENCE IF EXISTS public.sanctions_id_seq;
DROP TABLE IF EXISTS public.sanctions;
DROP SEQUENCE IF EXISTS public.sanction_types_id_seq;
DROP TABLE IF EXISTS public.sanction_types;
DROP SEQUENCE IF EXISTS public.sanction_history_id_seq;
DROP TABLE IF EXISTS public.sanction_history;
DROP SEQUENCE IF EXISTS public.salary_categories_v2_id_seq;
DROP TABLE IF EXISTS public.salary_categories_v2;
DROP SEQUENCE IF EXISTS public.salary_categories_id_seq;
DROP TABLE IF EXISTS public.salary_categories;
DROP TABLE IF EXISTS public.role_template_permissions;
DROP SEQUENCE IF EXISTS public.role_definitions_id_seq;
DROP TABLE IF EXISTS public.role_definitions;
DROP SEQUENCE IF EXISTS public.risk_benchmarks_id_seq;
DROP TABLE IF EXISTS public.risk_benchmarks;
DROP SEQUENCE IF EXISTS public.request_types_id_seq;
DROP TABLE IF EXISTS public.request_types;
DROP SEQUENCE IF EXISTS public.report_access_log_id_seq;
DROP TABLE IF EXISTS public.report_access_log;
DROP TABLE IF EXISTS public.procedures;
DROP TABLE IF EXISTS public.procedure_versions;
DROP TABLE IF EXISTS public.procedure_roles;
DROP TABLE IF EXISTS public.procedure_draft_locks;
DROP TABLE IF EXISTS public.procedure_comments;
DROP TABLE IF EXISTS public.procedure_attachments;
DROP TABLE IF EXISTS public.procedure_acknowledgements;
DROP SEQUENCE IF EXISTS public.proactive_rules_id_seq;
DROP TABLE IF EXISTS public.proactive_rules;
DROP SEQUENCE IF EXISTS public.proactive_executions_id_seq;
DROP TABLE IF EXISTS public.proactive_executions;
DROP TABLE IF EXISTS public.permissions;
DROP SEQUENCE IF EXISTS public.payroll_templates_id_seq;
DROP TABLE IF EXISTS public.payroll_templates;
DROP SEQUENCE IF EXISTS public.payroll_template_concepts_id_seq;
DROP TABLE IF EXISTS public.payroll_template_concepts;
DROP SEQUENCE IF EXISTS public.payroll_runs_id_seq;
DROP TABLE IF EXISTS public.payroll_runs;
DROP SEQUENCE IF EXISTS public.payroll_run_details_id_seq;
DROP TABLE IF EXISTS public.payroll_run_details;
DROP SEQUENCE IF EXISTS public.payroll_run_concept_details_id_seq;
DROP TABLE IF EXISTS public.payroll_run_concept_details;
DROP SEQUENCE IF EXISTS public.payroll_payslip_templates_id_seq;
DROP TABLE IF EXISTS public.payroll_payslip_templates;
DROP SEQUENCE IF EXISTS public.payroll_payslip_block_types_id_seq;
DROP TABLE IF EXISTS public.payroll_payslip_block_types;
DROP SEQUENCE IF EXISTS public.payroll_entity_settlements_settlement_id_seq;
DROP TABLE IF EXISTS public.payroll_entity_settlements;
DROP SEQUENCE IF EXISTS public.payroll_entity_settlement_details_detail_id_seq;
DROP TABLE IF EXISTS public.payroll_entity_settlement_details;
DROP SEQUENCE IF EXISTS public.payroll_entity_categories_id_seq;
DROP TABLE IF EXISTS public.payroll_entity_categories;
DROP SEQUENCE IF EXISTS public.payroll_entities_entity_id_seq;
DROP TABLE IF EXISTS public.payroll_entities;
DROP SEQUENCE IF EXISTS public.payroll_countries_id_seq;
DROP TABLE IF EXISTS public.payroll_countries;
DROP SEQUENCE IF EXISTS public.payroll_concept_types_id_seq;
DROP TABLE IF EXISTS public.payroll_concept_types;
DROP SEQUENCE IF EXISTS public.payroll_concept_type_rates_id_seq;
DROP TABLE IF EXISTS public.payroll_concept_type_rates;
DROP SEQUENCE IF EXISTS public.payroll_concept_classifications_id_seq;
DROP TABLE IF EXISTS public.payroll_concept_classifications;
DROP SEQUENCE IF EXISTS public.payments_id_seq;
DROP TABLE IF EXISTS public.payments;
DROP TABLE IF EXISTS public.password_auth_attempts;
DROP TABLE IF EXISTS public.partners;
DROP SEQUENCE IF EXISTS public.partner_roles_id_seq;
DROP TABLE IF EXISTS public.partner_roles;
DROP TABLE IF EXISTS public.partner_commissions;
DROP TABLE IF EXISTS public.partner_commission_transactions;
DROP TABLE IF EXISTS public.partner_commission_summaries;
DROP SEQUENCE IF EXISTS public.organizational_positions_id_seq;
DROP TABLE IF EXISTS public.organizational_positions;
DROP SEQUENCE IF EXISTS public.oh_workers_compensation_claims_id_seq;
DROP TABLE IF EXISTS public.oh_workers_compensation_claims;
DROP SEQUENCE IF EXISTS public.oh_screening_types_id_seq;
DROP TABLE IF EXISTS public.oh_screening_types;
DROP SEQUENCE IF EXISTS public.oh_screening_results_id_seq;
DROP TABLE IF EXISTS public.oh_screening_results;
DROP SEQUENCE IF EXISTS public.oh_screening_documents_id_seq;
DROP TABLE IF EXISTS public.oh_screening_documents;
DROP SEQUENCE IF EXISTS public.oh_screening_config_id_seq;
DROP TABLE IF EXISTS public.oh_screening_config;
DROP TABLE IF EXISTS public.oh_pre_employment_screenings;
DROP SEQUENCE IF EXISTS public.oh_employee_certifications_id_seq;
DROP TABLE IF EXISTS public.oh_employee_certifications;
DROP SEQUENCE IF EXISTS public.oh_claim_types_id_seq;
DROP TABLE IF EXISTS public.oh_claim_types;
DROP SEQUENCE IF EXISTS public.oh_claim_status_history_id_seq;
DROP TABLE IF EXISTS public.oh_claim_status_history;
DROP SEQUENCE IF EXISTS public.oh_claim_documents_id_seq;
DROP TABLE IF EXISTS public.oh_claim_documents;
DROP SEQUENCE IF EXISTS public.oh_certification_types_id_seq;
DROP TABLE IF EXISTS public.oh_certification_types;
DROP SEQUENCE IF EXISTS public.oh_certification_alerts_id_seq;
DROP TABLE IF EXISTS public.oh_certification_alerts;
DROP SEQUENCE IF EXISTS public.oh_certification_alert_config_id_seq;
DROP TABLE IF EXISTS public.oh_certification_alert_config;
DROP SEQUENCE IF EXISTS public.notifications_id_seq;
DROP TABLE IF EXISTS public.notifications_enterprise;
DROP TABLE IF EXISTS public.notifications;
DROP SEQUENCE IF EXISTS public.notification_workflows_id_seq;
DROP TABLE IF EXISTS public.notification_workflows;
DROP TABLE IF EXISTS public.notification_threads;
DROP SEQUENCE IF EXISTS public.notification_thread_analysis_id_seq;
DROP TABLE IF EXISTS public.notification_thread_analysis;
DROP SEQUENCE IF EXISTS public.notification_templates_id_seq;
DROP TABLE IF EXISTS public.notification_templates;
DROP SEQUENCE IF EXISTS public.notification_sla_records_id_seq;
DROP TABLE IF EXISTS public.notification_sla_records;
DROP SEQUENCE IF EXISTS public.notification_sla_config_id_seq;
DROP TABLE IF EXISTS public.notification_sla_config;
DROP TABLE IF EXISTS public.notification_queue;
DROP SEQUENCE IF EXISTS public.notification_participant_types_id_seq;
DROP TABLE IF EXISTS public.notification_participant_types;
DROP TABLE IF EXISTS public.notification_messages;
DROP SEQUENCE IF EXISTS public.notification_learned_responses_id_seq;
DROP TABLE IF EXISTS public.notification_learned_responses;
DROP TABLE IF EXISTS public.notification_groups;
DROP SEQUENCE IF EXISTS public.notification_flow_templates_id_seq;
DROP TABLE IF EXISTS public.notification_flow_templates;
DROP SEQUENCE IF EXISTS public.notification_faq_patterns_id_seq;
DROP TABLE IF EXISTS public.notification_faq_patterns;
DROP SEQUENCE IF EXISTS public.notification_escalations_id_seq;
DROP TABLE IF EXISTS public.notification_escalations;
DROP SEQUENCE IF EXISTS public.notification_context_data_id_seq;
DROP TABLE IF EXISTS public.notification_context_data;
DROP SEQUENCE IF EXISTS public.notification_audit_log_id_seq;
DROP TABLE IF EXISTS public.notification_audit_log;
DROP SEQUENCE IF EXISTS public.notification_ai_suggestions_id_seq;
DROP TABLE IF EXISTS public.notification_ai_suggestions;
DROP SEQUENCE IF EXISTS public.notification_ai_learning_id_seq;
DROP TABLE IF EXISTS public.notification_ai_learning;
DROP SEQUENCE IF EXISTS public.notification_actions_log_id_seq;
DROP TABLE IF EXISTS public.notification_actions_log;
DROP SEQUENCE IF EXISTS public.multiple_art_configurations_id_seq;
DROP TABLE IF EXISTS public.multiple_art_configurations;
DROP SEQUENCE IF EXISTS public.module_definitions_id_seq;
DROP TABLE IF EXISTS public.module_definitions;
DROP TABLE IF EXISTS public.module_actions;
DROP SEQUENCE IF EXISTS public.migration_log_id_seq;
DROP TABLE IF EXISTS public.migration_log;
DROP TABLE IF EXISTS public.messages;
DROP TABLE IF EXISTS public.medical_staff;
DROP SEQUENCE IF EXISTS public.medical_records_id_seq;
DROP TABLE IF EXISTS public.medical_records;
DROP SEQUENCE IF EXISTS public.medical_record_audit_log_id_seq;
DROP TABLE IF EXISTS public.medical_record_audit_log;
DROP TABLE IF EXISTS public.medical_leaves;
DROP SEQUENCE IF EXISTS public.medical_exam_templates_id_seq;
DROP TABLE IF EXISTS public.medical_exam_templates;
DROP SEQUENCE IF EXISTS public.medical_edit_authorizations_id_seq;
DROP TABLE IF EXISTS public.medical_edit_authorizations;
DROP TABLE IF EXISTS public.medical_diagnoses;
DROP TABLE IF EXISTS public.medical_communications;
DROP SEQUENCE IF EXISTS public.medical_certificates_id_seq;
DROP TABLE IF EXISTS public.medical_certificates;
DROP TABLE IF EXISTS public.medical_absence_types;
DROP SEQUENCE IF EXISTS public.legal_edit_authorizations_id_seq;
DROP TABLE IF EXISTS public.legal_edit_authorizations;
DROP SEQUENCE IF EXISTS public.legal_document_alerts_id_seq;
DROP TABLE IF EXISTS public.legal_document_alerts;
DROP SEQUENCE IF EXISTS public.legal_deadlines_id_seq;
DROP TABLE IF EXISTS public.legal_deadlines;
DROP TABLE IF EXISTS public.legal_communications;
DROP TABLE IF EXISTS public.legal_communication_types;
DROP SEQUENCE IF EXISTS public.legal_cases_id_seq;
DROP TABLE IF EXISTS public.legal_cases;
DROP SEQUENCE IF EXISTS public.legal_case_timeline_events_id_seq;
DROP TABLE IF EXISTS public.legal_case_timeline_events;
DROP SEQUENCE IF EXISTS public.legal_case_stages_id_seq;
DROP TABLE IF EXISTS public.legal_case_stages;
DROP SEQUENCE IF EXISTS public.legal_case_parties_id_seq;
DROP TABLE IF EXISTS public.legal_case_parties;
DROP SEQUENCE IF EXISTS public.legal_case_documents_id_seq;
DROP TABLE IF EXISTS public.legal_case_documents;
DROP SEQUENCE IF EXISTS public.legal_ai_analysis_id_seq;
DROP TABLE IF EXISTS public.legal_ai_analysis;
DROP SEQUENCE IF EXISTS public.learning_patterns_id_seq;
DROP TABLE IF EXISTS public.learning_patterns;
DROP TABLE IF EXISTS public.late_arrival_authorizations;
DROP SEQUENCE IF EXISTS public.labor_agreements_v2_id_seq;
DROP TABLE IF EXISTS public.labor_agreements_v2;
DROP SEQUENCE IF EXISTS public.labor_agreements_catalog_id_seq;
DROP TABLE IF EXISTS public.labor_agreements_catalog;
DROP SEQUENCE IF EXISTS public.kiosks_id_seq;
DROP TABLE IF EXISTS public.kiosks;
DROP SEQUENCE IF EXISTS public.job_postings_id_seq;
DROP TABLE IF EXISTS public.job_postings;
DROP SEQUENCE IF EXISTS public.job_applications_id_seq;
DROP TABLE IF EXISTS public.job_applications;
DROP SEQUENCE IF EXISTS public.job_application_notes_id_seq;
DROP TABLE IF EXISTS public.job_application_notes;
DROP SEQUENCE IF EXISTS public.invoices_id_seq;
DROP TABLE IF EXISTS public.invoices;
DROP TABLE IF EXISTS public.hse_zone_configurations;
DROP TABLE IF EXISTS public.hse_violation_catalog;
DROP SEQUENCE IF EXISTS public.hse_ppe_stats_id_seq;
DROP TABLE IF EXISTS public.hse_ppe_stats;
DROP TABLE IF EXISTS public.hse_ppe_detections;
DROP SEQUENCE IF EXISTS public.hse_company_config_id_seq;
DROP TABLE IF EXISTS public.hse_company_config;
DROP TABLE IF EXISTS public.hse_cases;
DROP SEQUENCE IF EXISTS public.hse_case_number_seq;
DROP TABLE IF EXISTS public.hour_bank_transactions;
DROP SEQUENCE IF EXISTS public.hour_bank_templates_id_seq;
DROP TABLE IF EXISTS public.hour_bank_templates;
DROP TABLE IF EXISTS public.hour_bank_scheduled_redemptions;
DROP SEQUENCE IF EXISTS public.hour_bank_risk_analysis_id_seq;
DROP TABLE IF EXISTS public.hour_bank_risk_analysis;
DROP TABLE IF EXISTS public.hour_bank_requests;
DROP TABLE IF EXISTS public.hour_bank_redemption_requests;
DROP TABLE IF EXISTS public.hour_bank_redemption_history;
DROP TABLE IF EXISTS public.hour_bank_pending_decisions;
DROP SEQUENCE IF EXISTS public.hour_bank_metrics_aggregated_id_seq;
DROP TABLE IF EXISTS public.hour_bank_metrics_aggregated;
DROP TABLE IF EXISTS public.hour_bank_loans;
DROP SEQUENCE IF EXISTS public.hour_bank_budgets_id_seq;
DROP TABLE IF EXISTS public.hour_bank_budgets;
DROP SEQUENCE IF EXISTS public.hour_bank_blackout_dates_id_seq;
DROP TABLE IF EXISTS public.hour_bank_blackout_dates;
DROP TABLE IF EXISTS public.hour_bank_balances;
DROP TABLE IF EXISTS public.hour_bank_agreements;
DROP TABLE IF EXISTS public.holidays;
DROP TABLE IF EXISTS public.fingerprint_biometric_data;
DROP TABLE IF EXISTS public.facial_biometric_data;
DROP SEQUENCE IF EXISTS public.extraordinary_licenses_id_seq;
DROP TABLE IF EXISTS public.extraordinary_licenses;
DROP SEQUENCE IF EXISTS public.epp_role_requirements_id_seq;
DROP TABLE IF EXISTS public.epp_role_requirements;
DROP SEQUENCE IF EXISTS public.epp_inspections_id_seq;
DROP TABLE IF EXISTS public.epp_inspections;
DROP SEQUENCE IF EXISTS public.epp_deliveries_id_seq;
DROP TABLE IF EXISTS public.epp_deliveries;
DROP SEQUENCE IF EXISTS public.epp_categories_id_seq;
DROP TABLE IF EXISTS public.epp_categories;
DROP SEQUENCE IF EXISTS public.epp_catalog_id_seq;
DROP TABLE IF EXISTS public.epp_catalog;
DROP TABLE IF EXISTS public.employee_ppe_consents;
DROP TABLE IF EXISTS public.employee_locations;
DROP SEQUENCE IF EXISTS public.employee_documents_id_seq;
DROP TABLE IF EXISTS public.employee_documents;
DROP SEQUENCE IF EXISTS public.employee_dependency_documents_id_seq;
DROP TABLE IF EXISTS public.employee_dependency_documents;
DROP SEQUENCE IF EXISTS public.employee_benefits_id_seq;
DROP TABLE IF EXISTS public.employee_benefits;
DROP SEQUENCE IF EXISTS public.employee_benefit_documents_id_seq;
DROP TABLE IF EXISTS public.employee_benefit_documents;
DROP SEQUENCE IF EXISTS public.employee_assigned_assets_id_seq;
DROP TABLE IF EXISTS public.employee_assigned_assets;
DROP TABLE IF EXISTS public.email_verification_tokens;
DROP TABLE IF EXISTS public.email_thread_mapping;
DROP SEQUENCE IF EXISTS public.email_templates_id_seq;
DROP TABLE IF EXISTS public.email_templates;
DROP SEQUENCE IF EXISTS public.email_logs_id_seq;
DROP TABLE IF EXISTS public.email_logs;
DROP TABLE IF EXISTS public.email_inbound_log;
DROP SEQUENCE IF EXISTS public.email_configurations_id_seq;
DROP TABLE IF EXISTS public.email_configurations;
DROP TABLE IF EXISTS public.ecosystem_workflows;
DROP TABLE IF EXISTS public.ecosystem_tasks;
DROP TABLE IF EXISTS public.ecosystem_phases;
DROP TABLE IF EXISTS public.ecosystem_file_cache;
DROP TABLE IF EXISTS public.ecosystem_applications;
DROP SEQUENCE IF EXISTS public.document_types_id_seq;
DROP TABLE IF EXISTS public.document_types;
DROP SEQUENCE IF EXISTS public.document_statuses_id_seq;
DROP TABLE IF EXISTS public.document_statuses;
DROP SEQUENCE IF EXISTS public.document_categories_id_seq;
DROP TABLE IF EXISTS public.document_categories;
DROP SEQUENCE IF EXISTS public.dms_workflow_templates_id_seq;
DROP TABLE IF EXISTS public.dms_workflow_templates;
DROP TABLE IF EXISTS public.dms_workflow_instances;
DROP TABLE IF EXISTS public.dms_workflow_approvals;
DROP TABLE IF EXISTS public.dms_folders;
DROP TABLE IF EXISTS public.dms_documents;
DROP TABLE IF EXISTS public.dms_document_versions;
DROP TABLE IF EXISTS public.dms_document_types;
DROP TABLE IF EXISTS public.dms_document_statuses;
DROP TABLE IF EXISTS public.dms_document_requests;
DROP TABLE IF EXISTS public.dms_document_permissions;
DROP TABLE IF EXISTS public.dms_document_metadata;
DROP TABLE IF EXISTS public.dms_document_categories;
DROP TABLE IF EXISTS public.dms_document_alerts;
DROP SEQUENCE IF EXISTS public.dms_access_log_id_seq;
DROP TABLE IF EXISTS public.dms_access_log;
DROP SEQUENCE IF EXISTS public.dependency_types_id_seq;
DROP TABLE IF EXISTS public.dependency_types;
DROP SEQUENCE IF EXISTS public.dependency_evaluations_id_seq;
DROP TABLE IF EXISTS public.dependency_evaluations;
DROP SEQUENCE IF EXISTS public.departments_id_seq;
DROP TABLE IF EXISTS public.departments;
DROP SEQUENCE IF EXISTS public.department_aliases_id_seq;
DROP TABLE IF EXISTS public.department_aliases;
DROP SEQUENCE IF EXISTS public.data_integrity_log_id_seq;
DROP TABLE IF EXISTS public.data_integrity_log;
DROP TABLE IF EXISTS public.country_safety_regulations;
DROP SEQUENCE IF EXISTS public.cost_transactions_id_seq;
DROP TABLE IF EXISTS public.cost_transactions;
DROP SEQUENCE IF EXISTS public.cost_budgets_id_seq;
DROP TABLE IF EXISTS public.cost_budgets;
DROP TABLE IF EXISTS public.contracts;
DROP SEQUENCE IF EXISTS public.contract_templates_id_seq;
DROP TABLE IF EXISTS public.contract_templates;
DROP SEQUENCE IF EXISTS public.contract_template_types_id_seq;
DROP TABLE IF EXISTS public.contract_template_types;
DROP TABLE IF EXISTS public.contract_renewal_logs;
DROP TABLE IF EXISTS public.contract_apk_licenses;
DROP SEQUENCE IF EXISTS public.contextual_help_id_seq;
DROP TABLE IF EXISTS public.contextual_help;
DROP TABLE IF EXISTS public.consent_legal_documents;
DROP TABLE IF EXISTS public.consent_definitions;
DROP SEQUENCE IF EXISTS public.consent_change_log_id_seq;
DROP TABLE IF EXISTS public.consent_change_log;
DROP TABLE IF EXISTS public.consent_audit_log;
DROP SEQUENCE IF EXISTS public.concept_dependencies_id_seq;
DROP TABLE IF EXISTS public.concept_dependencies;
DROP SEQUENCE IF EXISTS public.compliance_violations_id_seq;
DROP TABLE IF EXISTS public.compliance_violations;
DROP SEQUENCE IF EXISTS public.compliance_rules_id_seq;
DROP TABLE IF EXISTS public.compliance_rules;
DROP SEQUENCE IF EXISTS public.comparative_analytics_id_seq;
DROP TABLE IF EXISTS public.comparative_analytics;
DROP SEQUENCE IF EXISTS public.company_tax_config_id_seq;
DROP TABLE IF EXISTS public.company_tax_config;
DROP SEQUENCE IF EXISTS public.company_tasks_id_seq;
DROP TABLE IF EXISTS public.company_tasks;
DROP TABLE IF EXISTS public.company_support_assignments;
DROP SEQUENCE IF EXISTS public.company_risk_config_id_seq;
DROP TABLE IF EXISTS public.company_risk_config;
DROP SEQUENCE IF EXISTS public.company_non_working_days_id_seq;
DROP TABLE IF EXISTS public.company_non_working_days;
DROP TABLE IF EXISTS public.company_modules;
DROP TABLE IF EXISTS public.company_medical_staff;
DROP TABLE IF EXISTS public.company_inbox_processed;
DROP SEQUENCE IF EXISTS public.company_fiscal_config_id_seq;
DROP TABLE IF EXISTS public.company_fiscal_config;
DROP TABLE IF EXISTS public.company_email_config;
DROP SEQUENCE IF EXISTS public.company_dependencies_id_seq;
DROP TABLE IF EXISTS public.company_dependencies;
DROP SEQUENCE IF EXISTS public.company_communications_id_seq;
DROP TABLE IF EXISTS public.company_communications;
DROP SEQUENCE IF EXISTS public.company_branches_id_seq;
DROP TABLE IF EXISTS public.company_branches;
DROP SEQUENCE IF EXISTS public.company_benefit_policies_id_seq;
DROP TABLE IF EXISTS public.company_benefit_policies;
DROP SEQUENCE IF EXISTS public.company_associate_contracts_id_seq;
DROP TABLE IF EXISTS public.company_associate_contracts;
DROP SEQUENCE IF EXISTS public.company_account_notifications_id_seq;
DROP TABLE IF EXISTS public.company_account_notifications;
DROP SEQUENCE IF EXISTS public.companies_id_seq;
DROP TABLE IF EXISTS public.companies;
DROP TABLE IF EXISTS public.commission_payments;
DROP TABLE IF EXISTS public.commission_liquidations;
DROP SEQUENCE IF EXISTS public.chronic_conditions_catalog_id_seq;
DROP TABLE IF EXISTS public.chronic_conditions_catalog;
DROP SEQUENCE IF EXISTS public.calendar_integrations_id_seq;
DROP TABLE IF EXISTS public.calendar_integrations;
DROP SEQUENCE IF EXISTS public.calendar_events_id_seq;
DROP TABLE IF EXISTS public.calendar_events;
DROP SEQUENCE IF EXISTS public.business_validations_id_seq;
DROP TABLE IF EXISTS public.business_validations;
DROP TABLE IF EXISTS public.budgets;
DROP SEQUENCE IF EXISTS public.branches_id_seq;
DROP TABLE IF EXISTS public.branches;
DROP SEQUENCE IF EXISTS public.branch_offices_fiscal_id_seq;
DROP TABLE IF EXISTS public.branch_offices_fiscal;
DROP SEQUENCE IF EXISTS public.biometric_templates_id_seq;
DROP TABLE IF EXISTS public.biometric_templates;
DROP TABLE IF EXISTS public.biometric_settings;
DROP VIEW IF EXISTS public.biometric_photos_stats;
DROP TABLE IF EXISTS public.users;
DROP TABLE IF EXISTS public.biometric_events;
DROP SEQUENCE IF EXISTS public.biometric_emotional_analysis_id_seq;
DROP TABLE IF EXISTS public.biometric_emotional_analysis;
DROP TABLE IF EXISTS public.biometric_devices;
DROP TABLE IF EXISTS public.biometric_detections;
DROP TABLE IF EXISTS public.biometric_data;
DROP SEQUENCE IF EXISTS public.biometric_consents_id_seq;
DROP TABLE IF EXISTS public.biometric_consents;
DROP SEQUENCE IF EXISTS public.biometric_company_config_id_seq;
DROP TABLE IF EXISTS public.biometric_company_config;
DROP TABLE IF EXISTS public.biometric_capture_attempts;
DROP SEQUENCE IF EXISTS public.biometric_audit_log_id_seq;
DROP TABLE IF EXISTS public.biometric_audit_log;
DROP SEQUENCE IF EXISTS public.biometric_analytics_aggregated_id_seq;
DROP TABLE IF EXISTS public.biometric_analytics_aggregated;
DROP TABLE IF EXISTS public.biometric_ai_analysis;
DROP SEQUENCE IF EXISTS public.benefit_types_id_seq;
DROP TABLE IF EXISTS public.benefit_types;
DROP SEQUENCE IF EXISTS public.benefit_payroll_concepts_id_seq;
DROP TABLE IF EXISTS public.benefit_payroll_concepts;
DROP SEQUENCE IF EXISTS public.benefit_expense_submissions_id_seq;
DROP TABLE IF EXISTS public.benefit_expense_submissions;
DROP SEQUENCE IF EXISTS public.benefit_expense_allowances_id_seq;
DROP TABLE IF EXISTS public.benefit_expense_allowances;
DROP SEQUENCE IF EXISTS public.benefit_document_requirements_id_seq;
DROP TABLE IF EXISTS public.benefit_document_requirements;
DROP SEQUENCE IF EXISTS public.benefit_approval_workflows_id_seq;
DROP TABLE IF EXISTS public.benefit_approval_workflows;
DROP SEQUENCE IF EXISTS public.benefit_approval_history_id_seq;
DROP TABLE IF EXISTS public.benefit_approval_history;
DROP TABLE IF EXISTS public.audit_test_logs;
DROP SEQUENCE IF EXISTS public.audit_reports_id_seq;
DROP TABLE IF EXISTS public.audit_reports;
DROP TABLE IF EXISTS public.audit_logs;
DROP TABLE IF EXISTS public.attendances;
DROP MATERIALIZED VIEW IF EXISTS public.attendance_rankings;
DROP SEQUENCE IF EXISTS public.attendance_profiles_id_seq;
DROP TABLE IF EXISTS public.attendance_profiles;
DROP SEQUENCE IF EXISTS public.attendance_patterns_id_seq;
DROP TABLE IF EXISTS public.attendance_patterns;
DROP SEQUENCE IF EXISTS public.attendance_analytics_cache_id_seq;
DROP TABLE IF EXISTS public.attendance_analytics_cache;
DROP SEQUENCE IF EXISTS public.associate_employee_assignments_id_seq;
DROP TABLE IF EXISTS public.associate_employee_assignments;
DROP TABLE IF EXISTS public.assistant_knowledge_base;
DROP TABLE IF EXISTS public.assistant_conversations;
DROP TABLE IF EXISTS public.assistant_action_handlers;
DROP SEQUENCE IF EXISTS public.asset_contracts_id_seq;
DROP TABLE IF EXISTS public.asset_contracts;
DROP TABLE IF EXISTS public.art_configurations;
DROP SEQUENCE IF EXISTS public.approved_shift_swaps_id_seq;
DROP TABLE IF EXISTS public.approved_shift_swaps;
DROP TABLE IF EXISTS public.aponnt_staff_roles;
DROP TABLE IF EXISTS public.aponnt_staff_companies;
DROP TABLE IF EXISTS public.aponnt_staff;
DROP SEQUENCE IF EXISTS public.aponnt_pre_invoices_id_seq;
DROP TABLE IF EXISTS public.aponnt_pre_invoices;
DROP SEQUENCE IF EXISTS public.aponnt_email_config_id_seq;
DROP TABLE IF EXISTS public.aponnt_email_config;
DROP TABLE IF EXISTS public.aponnt_associates;
DROP SEQUENCE IF EXISTS public.aponnt_admin_tasks_id_seq;
DROP TABLE IF EXISTS public.aponnt_admin_tasks;
DROP SEQUENCE IF EXISTS public.afip_cae_log_id_seq;
DROP TABLE IF EXISTS public.afip_cae_log;
DROP SEQUENCE IF EXISTS public.afip_auth_log_id_seq;
DROP TABLE IF EXISTS public.afip_auth_log;
DROP TABLE IF EXISTS public.administrative_tasks;
DROP TABLE IF EXISTS public.additional_role_types;
DROP SEQUENCE IF EXISTS public.access_notifications_id_seq;
DROP TABLE IF EXISTS public.access_notifications;
DROP SEQUENCE IF EXISTS public.access_audit_log_id_seq;
DROP TABLE IF EXISTS public.access_audit_log;
DROP TABLE IF EXISTS public.absence_cases;
DROP TABLE IF EXISTS public."UserShifts";
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p9;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p8;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p7;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p6;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p5;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p4;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p3;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p2;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p15;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p14;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p13;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p12;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p11;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p10;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p1;
DROP TABLE IF EXISTS biometric_partitions.biometric_scans_p0;
DROP SEQUENCE IF EXISTS public.biometric_scans_scan_id_seq;
DROP TABLE IF EXISTS public.biometric_scans;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p9;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p8;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p7;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p6;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p5;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p4;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p3;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p2;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p15;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p14;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p13;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p12;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p11;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p10;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p1;
DROP TABLE IF EXISTS biometric_partitions.biometric_alerts_p0;
DROP SEQUENCE IF EXISTS public.biometric_alerts_alert_id_seq;
DROP TABLE IF EXISTS public.biometric_alerts;
DROP FUNCTION IF EXISTS public.verify_user_email(p_user_id integer, p_user_type character varying, p_verification_timestamp timestamp without time zone);
DROP FUNCTION IF EXISTS public.verify_staff_bank_data(p_staff_id uuid, p_verified_by uuid);
DROP FUNCTION IF EXISTS public.validate_vacation_balance();
DROP FUNCTION IF EXISTS public.validate_redemption_request(p_company_id integer, p_user_id uuid, p_hours_requested numeric, p_scheduled_date date);
DROP FUNCTION IF EXISTS public.validate_procedure_hierarchy();
DROP FUNCTION IF EXISTS public.validate_notification_recipient();
DROP FUNCTION IF EXISTS public.validate_modules_trial_structure();
DROP FUNCTION IF EXISTS public.validate_module_dependencies(p_company_id uuid, p_module_key character varying);
DROP FUNCTION IF EXISTS public.validate_email_config();
DROP FUNCTION IF EXISTS public.validate_contract_for_activation(p_contract_id uuid);
DROP FUNCTION IF EXISTS public.validate_cbu_checksum(p_cbu character varying);
DROP FUNCTION IF EXISTS public.validate_benefit_documents(p_employee_benefit_id integer);
DROP FUNCTION IF EXISTS public.user_needs_photo_renewal(p_user_id uuid);
DROP FUNCTION IF EXISTS public.upsert_module(p_module_key character varying, p_name character varying, p_description text, p_icon character varying, p_category character varying);
DROP FUNCTION IF EXISTS public.update_vendor_statistics_on_company_change();
DROP FUNCTION IF EXISTS public.update_vacation_timestamp();
DROP FUNCTION IF EXISTS public.update_user_consents_timestamp();
DROP FUNCTION IF EXISTS public.update_user_biometric_stats();
DROP FUNCTION IF EXISTS public.update_updated_at_column();
DROP FUNCTION IF EXISTS public.update_updated_at();
DROP FUNCTION IF EXISTS public.update_thread_unread_count();
DROP FUNCTION IF EXISTS public.update_thread_counters();
DROP FUNCTION IF EXISTS public.update_testing_tickets_timestamp();
DROP FUNCTION IF EXISTS public.update_test_executions_timestamp();
DROP FUNCTION IF EXISTS public.update_tax_updated_at();
DROP FUNCTION IF EXISTS public.update_suspension_blocks_updated_at();
DROP FUNCTION IF EXISTS public.update_staff_companies_updated_at();
DROP FUNCTION IF EXISTS public.update_siac_presupuestos_timestamp();
DROP FUNCTION IF EXISTS public.update_sesiones_updated_at();
DROP FUNCTION IF EXISTS public.update_screening_documents_count();
DROP FUNCTION IF EXISTS public.update_sanction_types_updated_at();
DROP FUNCTION IF EXISTS public.update_response_confidence();
DROP FUNCTION IF EXISTS public.update_procedure_hierarchy_path();
DROP FUNCTION IF EXISTS public.update_payslip_template_timestamp();
DROP FUNCTION IF EXISTS public.update_partners_updated_at();
DROP FUNCTION IF EXISTS public.update_partner_commission_summary(p_partner_id uuid, p_year integer, p_month integer);
DROP FUNCTION IF EXISTS public.update_notification_updated_at();
DROP FUNCTION IF EXISTS public.update_medical_updated_at();
DROP FUNCTION IF EXISTS public.update_medical_timestamp();
DROP FUNCTION IF EXISTS public.update_legal_communications_updated_at();
DROP FUNCTION IF EXISTS public.update_legal_cases_updated_at();
DROP FUNCTION IF EXISTS public.update_legal_auth_updated_at();
DROP FUNCTION IF EXISTS public.update_kiosks_timestamp();
DROP FUNCTION IF EXISTS public.update_job_posting_applications_count();
DROP FUNCTION IF EXISTS public.update_imap_poll_status(p_config_id uuid, p_last_uid integer, p_error text);
DROP FUNCTION IF EXISTS public.update_household_size();
DROP FUNCTION IF EXISTS public.update_group_last_activity();
DROP FUNCTION IF EXISTS public.update_fiscal_config_timestamp();
DROP FUNCTION IF EXISTS public.update_email_timestamp();
DROP FUNCTION IF EXISTS public.update_document_expiration_status();
DROP FUNCTION IF EXISTS public.update_daily_ppe_stats(p_company_id integer, p_branch_id integer, p_zone_name character varying, p_date date);
DROP FUNCTION IF EXISTS public.update_contracts_timestamp();
DROP FUNCTION IF EXISTS public.update_consent_definitions_timestamp();
DROP FUNCTION IF EXISTS public.update_company_comms_timestamp();
DROP FUNCTION IF EXISTS public.update_comm_pay_timestamp();
DROP FUNCTION IF EXISTS public.update_comm_liq_timestamp();
DROP FUNCTION IF EXISTS public.update_claim_documents_count();
DROP FUNCTION IF EXISTS public.update_certification_status();
DROP FUNCTION IF EXISTS public.update_budgets_timestamp();
DROP FUNCTION IF EXISTS public.update_budget_on_accrual();
DROP FUNCTION IF EXISTS public.update_biometric_template_timestamp();
DROP FUNCTION IF EXISTS public.update_biometric_photo(p_user_id uuid, p_photo_url text, p_capture_date timestamp without time zone);
DROP FUNCTION IF EXISTS public.update_benefit_documents_status();
DROP FUNCTION IF EXISTS public.update_assistant_knowledge_base_updated_at();
DROP FUNCTION IF EXISTS public.update_aponnt_tables_timestamp();
DROP FUNCTION IF EXISTS public.update_aponnt_staff_updated_at();
DROP FUNCTION IF EXISTS public.update_allowance_consumption();
DROP FUNCTION IF EXISTS public.update_admin_tasks_timestamp();
DROP FUNCTION IF EXISTS public.unlock_procedure_draft(p_procedure_id uuid, p_user_id uuid, p_reason character varying);
DROP FUNCTION IF EXISTS public.try_lock_procedure_draft(p_procedure_id uuid, p_user_id uuid, p_ttl_days integer);
DROP FUNCTION IF EXISTS public.trigger_update_commission_summary();
DROP FUNCTION IF EXISTS public.trigger_formatear_numero_factura();
DROP FUNCTION IF EXISTS public.trigger_add_initial_owner();
DROP FUNCTION IF EXISTS public.trigger_actualizar_totales_factura();
DROP FUNCTION IF EXISTS public.test_partitioning_simple();
DROP FUNCTION IF EXISTS public.sync_user_position_name();
DROP FUNCTION IF EXISTS public.sync_user_email();
DROP FUNCTION IF EXISTS public.sync_is_active();
DROP FUNCTION IF EXISTS public.sync_active_modules_from_company_modules();
DROP FUNCTION IF EXISTS public.suspend_expired_grace_period_contracts();
DROP FUNCTION IF EXISTS public.suspend_expired_grace_contracts();
DROP FUNCTION IF EXISTS public.staff_can_view_company(p_staff_id uuid, p_staff_role character varying, p_company_id integer);
DROP FUNCTION IF EXISTS public.siac_productos_calcular_precios();
DROP FUNCTION IF EXISTS public.siac_obtener_proximo_numero(p_caja_id integer, p_tipo_comprobante_id integer);
DROP FUNCTION IF EXISTS public.siac_modulo_contratado(p_company_id integer, p_modulo_codigo character varying);
DROP FUNCTION IF EXISTS public.siac_formatear_documento(p_numero character varying, p_tipo character varying);
DROP FUNCTION IF EXISTS public.siac_clientes_before_insert();
DROP FUNCTION IF EXISTS public.siac_calcular_totales_factura(p_factura_id integer);
DROP FUNCTION IF EXISTS public.siac_calcular_precio_venta(p_precio_compra numeric, p_margen_porcentaje numeric);
DROP FUNCTION IF EXISTS public.siac_actualizar_stock(p_producto_id integer, p_cantidad numeric, p_tipo_movimiento character varying, p_precio_unitario numeric, p_motivo character varying, p_usuario_id integer);
DROP FUNCTION IF EXISTS public.set_ticket_sla_deadlines();
DROP FUNCTION IF EXISTS public.set_medical_record_expiration();
DROP FUNCTION IF EXISTS public.set_medical_record_editable_until();
DROP FUNCTION IF EXISTS public.set_document_edit_window();
DROP FUNCTION IF EXISTS public.search_similar_answers(search_question text, search_company_id integer, search_module character varying, limit_results integer);
DROP FUNCTION IF EXISTS public.run_data_integrity_check(p_company_id integer);
DROP FUNCTION IF EXISTS public.reset_email_counters();
DROP FUNCTION IF EXISTS public.remove_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid);
DROP FUNCTION IF EXISTS public.registrar_factura_generada(p_presupuesto_id integer, p_factura_id integer, p_numero_factura character varying, p_period character varying);
DROP FUNCTION IF EXISTS public.refresh_vendor_statistics(p_vendor_id uuid);
DROP FUNCTION IF EXISTS public.refresh_attendance_profiles(p_user_id uuid, p_company_id integer, p_period_days integer);
DROP FUNCTION IF EXISTS public.refresh_all_profiles_batch(p_company_id integer, p_batch_size integer);
DROP FUNCTION IF EXISTS public.puede_facturar_cliente(p_cliente_id integer, p_monto numeric);
DROP FUNCTION IF EXISTS public.process_scheduled_payments();
DROP FUNCTION IF EXISTS public.process_redemption_checkout(p_user_id uuid, p_company_id integer, p_checkout_time time without time zone, p_checkout_date date);
DROP FUNCTION IF EXISTS public.process_loan_repayment(p_company_id integer, p_user_id uuid, p_overtime_hours numeric);
DROP FUNCTION IF EXISTS public.process_inbound_email_to_thread(p_inbound_id uuid, p_group_id uuid, p_from_email character varying, p_from_name character varying, p_subject character varying, p_body_text text, p_company_id integer);
DROP FUNCTION IF EXISTS public.prevent_duplicate_checkin();
DROP FUNCTION IF EXISTS public.prevent_core_user_immutable_changes();
DROP FUNCTION IF EXISTS public.prevent_core_user_deletion();
DROP FUNCTION IF EXISTS public.partner_can_login(p_username character varying);
DROP FUNCTION IF EXISTS public.obtener_proximo_numero_seguro(p_company_id integer, p_tipo_comprobante character varying, p_session_id character varying, p_user_id integer, p_terminal_id character varying);
DROP FUNCTION IF EXISTS public.notify_benefit_approved();
DROP FUNCTION IF EXISTS public.move_procedure_to_parent(p_procedure_id uuid, p_new_parent_id uuid, p_user_id uuid);
DROP FUNCTION IF EXISTS public.log_user_change(p_user_id uuid, p_changed_by_user_id uuid, p_company_id integer, p_action character varying, p_field_name character varying, p_old_value text, p_new_value text, p_description text, p_metadata jsonb, p_ip_address character varying, p_user_agent text);
DROP FUNCTION IF EXISTS public.log_redemption_status_change();
DROP FUNCTION IF EXISTS public.log_legal_stage_change();
DROP FUNCTION IF EXISTS public.log_consent_changes();
DROP FUNCTION IF EXISTS public.log_claim_status_change();
DROP FUNCTION IF EXISTS public.log_application_status_change();
DROP FUNCTION IF EXISTS public.lock_legal_document(doc_id integer, reason character varying);
DROP FUNCTION IF EXISTS public.lock_expired_medical_records();
DROP FUNCTION IF EXISTS public.is_medical_record_editable(p_record_id integer, p_user_id integer);
DROP FUNCTION IF EXISTS public.is_holiday(p_date date, p_country character varying, p_state_province character varying, p_include_national boolean, p_include_provincial boolean);
DROP FUNCTION IF EXISTS public.is_employee_suspended(p_employee_id uuid, p_company_id integer, p_check_date date);
DROP FUNCTION IF EXISTS public.is_employee_eligible_for_benefit(p_user_id uuid, p_benefit_type_id integer, p_company_id integer);
DROP FUNCTION IF EXISTS public.is_consent_valid(p_consent_id uuid);
DROP FUNCTION IF EXISTS public.increment_email_counter(p_company_id integer);
DROP FUNCTION IF EXISTS public.has_pending_required_consents(p_user_id integer, p_user_type character varying);
DROP FUNCTION IF EXISTS public.has_active_ppe_consent(p_employee_id integer);
DROP FUNCTION IF EXISTS public.get_vendor_total_commissions(p_vendor_id uuid, p_start_date date, p_end_date date);
DROP FUNCTION IF EXISTS public.get_vendor_supervisor(p_vendor_id uuid);
DROP FUNCTION IF EXISTS public.get_vendor_pending_tickets(p_vendor_id uuid);
DROP FUNCTION IF EXISTS public.get_vendor_pending_payments_detailed(p_vendor_id uuid);
DROP FUNCTION IF EXISTS public.get_vendor_pending_payments(p_vendor_id uuid);
DROP FUNCTION IF EXISTS public.get_vendor_payment_history(p_vendor_id uuid, p_limit integer);
DROP FUNCTION IF EXISTS public.get_valid_documents_for_dependency(p_user_id uuid, p_dependency_id integer, p_as_of_date date);
DROP FUNCTION IF EXISTS public.get_vacation_balance(p_company_id integer, p_user_id uuid, p_year integer);
DROP FUNCTION IF EXISTS public.get_users_with_expiring_photos(p_days_threshold integer);
DROP FUNCTION IF EXISTS public.get_users_with_expired_photos();
DROP FUNCTION IF EXISTS public.get_user_verification_status(p_user_id integer, p_user_type character varying);
DROP FUNCTION IF EXISTS public.get_user_socioeconomic_data(p_user_id uuid);
DROP FUNCTION IF EXISTS public.get_user_effective_permissions(p_user_id uuid, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_user_audit_stats(p_user_id uuid, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_user_audit_history(p_user_id uuid, p_company_id integer, p_limit integer, p_offset integer);
DROP FUNCTION IF EXISTS public.get_upcoming_legal_deadlines(p_company_id integer, p_days_ahead integer, p_user_id uuid);
DROP FUNCTION IF EXISTS public.get_unread_account_notifications(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_tickets_for_retest();
DROP FUNCTION IF EXISTS public.get_ticket_stats();
DROP FUNCTION IF EXISTS public.get_testing_metrics(p_company_id integer, p_environment character varying, p_module character varying, p_days integer);
DROP FUNCTION IF EXISTS public.get_staff_without_bank_data();
DROP FUNCTION IF EXISTS public.get_staff_with_complete_bank_data();
DROP FUNCTION IF EXISTS public.get_staff_subordinates_recursive(p_staff_id uuid, p_max_depth integer);
DROP FUNCTION IF EXISTS public.get_staff_companies(p_staff_id uuid);
DROP FUNCTION IF EXISTS public.get_staff_commission_summary(p_staff_id uuid, p_month integer, p_year integer);
DROP FUNCTION IF EXISTS public.get_screening_types_for_country(p_country_code character varying);
DROP FUNCTION IF EXISTS public.get_sanction_stats(p_company_id integer, p_period_days integer);
DROP FUNCTION IF EXISTS public.get_procedure_tree(p_company_id integer, p_root_id uuid);
DROP FUNCTION IF EXISTS public.get_procedure_target_users(p_procedure_id uuid);
DROP FUNCTION IF EXISTS public.get_procedure_scope_users(p_procedure_id uuid, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_procedure_children(p_procedure_id uuid, p_recursive boolean);
DROP FUNCTION IF EXISTS public.get_procedure_ancestors(p_procedure_id uuid);
DROP FUNCTION IF EXISTS public.get_procedure_ack_stats(p_procedure_id uuid, p_version_id uuid);
DROP FUNCTION IF EXISTS public.get_presupuestos_para_facturar();
DROP FUNCTION IF EXISTS public.get_pending_tickets_for_claude();
DROP FUNCTION IF EXISTS public.get_pending_tasks_for_admin(p_admin_id uuid, p_limit integer);
DROP FUNCTION IF EXISTS public.get_pending_partners();
DROP FUNCTION IF EXISTS public.get_pending_notifications_for_employee(p_employee_id character varying, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_pending_legal_authorizations(p_company_id integer, p_step integer);
DROP FUNCTION IF EXISTS public.get_pending_consents(p_user_id integer, p_user_type character varying);
DROP FUNCTION IF EXISTS public.get_next_comprobante_number(p_company_id integer, p_punto_venta integer, p_tipo_comprobante integer);
DROP FUNCTION IF EXISTS public.get_module_health(mod_name character varying, days_back integer);
DROP FUNCTION IF EXISTS public.get_medical_records_stats(p_company_id integer, p_employee_id integer);
DROP FUNCTION IF EXISTS public.get_legal_dashboard_stats(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_legal_case_summary(p_case_id integer);
DROP FUNCTION IF EXISTS public.get_immediate_supervisor(p_company_id integer, p_user_id uuid);
DROP FUNCTION IF EXISTS public.get_hse_dashboard_kpis(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_hse_case_stats(p_company_id integer, p_start_date date, p_end_date date);
DROP FUNCTION IF EXISTS public.get_hour_bank_account_statement(p_company_id integer, p_user_id uuid, p_from_date date, p_to_date date);
DROP FUNCTION IF EXISTS public.get_holidays_for_location(p_country character varying, p_state_province character varying, p_start_date date, p_end_date date);
DROP FUNCTION IF EXISTS public.get_expiring_trials(p_days_before integer);
DROP FUNCTION IF EXISTS public.get_expiring_epp(p_company_id integer, p_days_ahead integer);
DROP FUNCTION IF EXISTS public.get_execution_summary(exec_id uuid);
DROP FUNCTION IF EXISTS public.get_escalation_chain(p_current_level integer);
DROP FUNCTION IF EXISTS public.get_employee_sla_score(p_employee_id character varying, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_employee_payslip_template(p_user_id uuid);
DROP FUNCTION IF EXISTS public.get_employee_disciplinary_history(p_employee_id uuid, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_core_user(p_company_id uuid);
DROP FUNCTION IF EXISTS public.get_contracts_needing_renewal_alert();
DROP FUNCTION IF EXISTS public.get_contracts_grace_period_expiring();
DROP FUNCTION IF EXISTS public.get_contract_template(p_contract_type_code character varying, p_country_code character varying);
DROP FUNCTION IF EXISTS public.get_consent_stats_by_role(p_user_type character varying);
DROP FUNCTION IF EXISTS public.get_concept_types_for_country(p_country_id integer, p_locale character varying);
DROP FUNCTION IF EXISTS public.get_concept_help(p_concept_type_id integer, p_country_id integer, p_locale character varying);
DROP FUNCTION IF EXISTS public.get_company_tax_configuration(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_support_vendor(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_support_staff(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_fiscal_config(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_employee_emails(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_email_config(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_commercial_history(p_company_id integer, p_limit integer, p_offset integer);
DROP FUNCTION IF EXISTS public.get_company_certification_stats(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_company_assistant_type(p_company_id integer);
DROP FUNCTION IF EXISTS public.get_companies_needing_poll();
DROP FUNCTION IF EXISTS public.get_certifications_requiring_alert();
DROP FUNCTION IF EXISTS public.get_biometric_stats(company_id_param integer);
DROP FUNCTION IF EXISTS public.get_benefit_documents_expiring_soon(p_employee_benefit_id integer, p_days_ahead integer);
DROP FUNCTION IF EXISTS public.get_available_templates_for_user(p_user_id uuid);
DROP FUNCTION IF EXISTS public.get_available_parents(p_company_id integer, p_document_type character varying, p_exclude_id uuid);
DROP FUNCTION IF EXISTS public.get_available_modules(panel_type character varying);
DROP FUNCTION IF EXISTS public.get_available_entity_categories(p_company_id integer, p_country_id integer);
DROP FUNCTION IF EXISTS public.get_available_entities_for_company(p_company_id integer, p_country_id integer);
DROP FUNCTION IF EXISTS public.get_associate_visible_employees(p_associate_user_id uuid, p_company_id integer);
DROP FUNCTION IF EXISTS public.get_assistant_stats(stats_company_id integer, days_back integer);
DROP FUNCTION IF EXISTS public.get_applicable_hour_bank_template(p_user_id uuid, p_company_id integer, p_branch_id integer);
DROP FUNCTION IF EXISTS public.get_aponnt_master_id();
DROP FUNCTION IF EXISTS public.get_aponnt_email(p_config_type character varying);
DROP FUNCTION IF EXISTS public.get_active_trial_modules(p_company_id uuid);
DROP FUNCTION IF EXISTS public.generate_ticket_number();
DROP FUNCTION IF EXISTS public.generate_temp_password();
DROP FUNCTION IF EXISTS public.generate_signature_hash(p_contract_id uuid, p_signer_name character varying, p_signer_dni character varying, p_signature_ip character varying);
DROP FUNCTION IF EXISTS public.generate_pre_invoice_code();
DROP FUNCTION IF EXISTS public.generate_payment_code();
DROP FUNCTION IF EXISTS public.generate_medical_record_signature(p_record_id integer);
DROP FUNCTION IF EXISTS public.generate_liquidation_code();
DROP FUNCTION IF EXISTS public.generate_legal_case_number();
DROP FUNCTION IF EXISTS public.generate_hse_case_number();
DROP FUNCTION IF EXISTS public.generate_entity_settlement_v2(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid);
DROP FUNCTION IF EXISTS public.generate_entity_settlement(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid);
DROP FUNCTION IF EXISTS public.generate_contract_from_template(p_template_id integer, p_variables jsonb);
DROP FUNCTION IF EXISTS public.generate_contract_code();
DROP FUNCTION IF EXISTS public.generate_consent_signature(p_consent_id uuid, p_secret text);
DROP FUNCTION IF EXISTS public.generate_claim_number();
DROP FUNCTION IF EXISTS public.generate_budget_code();
DROP FUNCTION IF EXISTS public.generate_admin_task_code(p_task_type character varying);
DROP FUNCTION IF EXISTS public.fn_propagate_salary_category_v2_changes();
DROP FUNCTION IF EXISTS public.fn_propagate_salary_category_changes();
DROP FUNCTION IF EXISTS public.fn_propagate_agreement_multipliers();
DROP FUNCTION IF EXISTS public.fn_handle_user_branch_change();
DROP FUNCTION IF EXISTS public.fn_get_user_payroll_template(p_user_id uuid);
DROP FUNCTION IF EXISTS public.fn_get_user_consent_status(p_user_id uuid);
DROP FUNCTION IF EXISTS public.fn_get_branch_country(p_branch_id integer);
DROP FUNCTION IF EXISTS public.fn_flag_payroll_recalculation();
DROP FUNCTION IF EXISTS public.fn_clone_payroll_template_for_branch(p_source_template_id integer, p_target_branch_id integer, p_target_country_id integer);
DROP FUNCTION IF EXISTS public.fn_auto_create_user_salary_config();
DROP FUNCTION IF EXISTS public.find_thread_by_email_reference(p_message_id character varying, p_in_reply_to character varying);
DROP FUNCTION IF EXISTS public.find_similar_responses(p_question text, p_category character varying, p_company_id integer, p_min_confidence numeric, p_limit integer);
DROP FUNCTION IF EXISTS public.expire_temp_password_on_close();
DROP FUNCTION IF EXISTS public.expire_old_budgets();
DROP FUNCTION IF EXISTS public.expire_benefits();
DROP FUNCTION IF EXISTS public.evaluate_employee_dependency(p_user_id uuid, p_company_id integer, p_dependency_id integer, p_as_of_date date);
DROP FUNCTION IF EXISTS public.escalate_overdue_tasks();
DROP FUNCTION IF EXISTS public.duplicate_payroll_template(p_source_template_id integer, p_target_branch_id integer, p_new_code character varying, p_created_by integer);
DROP FUNCTION IF EXISTS public.detect_tolerance_abuser_pattern(p_user_id uuid, p_company_id integer, p_period_days integer);
DROP FUNCTION IF EXISTS public.create_suspension_block_on_activate();
DROP FUNCTION IF EXISTS public.create_scheduled_redemption();
DROP FUNCTION IF EXISTS public.create_pre_invoice_from_contract(p_contract_id uuid);
DROP FUNCTION IF EXISTS public.create_pre_invoice_from_contract(p_contract_id integer);
DROP FUNCTION IF EXISTS public.create_payslip_template_snapshot(p_template_id integer);
DROP FUNCTION IF EXISTS public.create_employee_liquidation_snapshot(p_user_id uuid);
DROP FUNCTION IF EXISTS public.create_default_hour_bank_templates(p_company_id integer);
DROP FUNCTION IF EXISTS public.create_core_user_for_company(p_company_id integer, p_onboarding_trace_id character varying, p_created_by uuid);
DROP FUNCTION IF EXISTS public.create_commercial_notification(p_company_id integer, p_direction character varying, p_origin_type character varying, p_origin_name character varying, p_recipient_type character varying, p_recipient_name character varying, p_title character varying, p_message text, p_notification_type character varying, p_module character varying, p_priority character varying, p_trace_id character varying, p_vendor_id uuid, p_external_email character varying, p_aponnt_department character varying, p_thread_id uuid, p_requires_action boolean, p_action_type character varying, p_response_required_by timestamp without time zone, p_metadata jsonb);
DROP FUNCTION IF EXISTS public.create_account_notification(p_company_id integer, p_type character varying, p_title character varying, p_message text, p_ref_type character varying, p_ref_id character varying, p_priority character varying);
DROP FUNCTION IF EXISTS public.count_procedure_scope_users(p_company_id integer, p_scope_type public.procedure_scope_type, p_scope_entities jsonb);
DROP FUNCTION IF EXISTS public.company_has_email_configured(p_company_id integer);
DROP FUNCTION IF EXISTS public.cleanup_sesiones_inactivas();
DROP FUNCTION IF EXISTS public.cleanup_old_test_executions();
DROP FUNCTION IF EXISTS public.cleanup_old_biometric_scans();
DROP FUNCTION IF EXISTS public.cleanup_old_biometric_data();
DROP FUNCTION IF EXISTS public.cleanup_expired_verification_tokens();
DROP FUNCTION IF EXISTS public.cleanup_expired_emotional_data();
DROP FUNCTION IF EXISTS public.cleanup_expired_drafts();
DROP FUNCTION IF EXISTS public.check_vacation_conflicts(p_company_id integer, p_user_id uuid, p_start_date date, p_end_date date, p_exclude_request_id integer);
DROP FUNCTION IF EXISTS public.check_user_shift_on_activate();
DROP FUNCTION IF EXISTS public.check_user_department_company();
DROP FUNCTION IF EXISTS public.check_user_access(p_user_id uuid, p_company_id integer, p_module_key character varying, p_action character varying);
DROP FUNCTION IF EXISTS public.check_unique_active_template_v2();
DROP FUNCTION IF EXISTS public.check_shift_assignment_company();
DROP FUNCTION IF EXISTS public.check_screening_expiration();
DROP FUNCTION IF EXISTS public.check_module_dependencies(p_module_key character varying, p_company_id integer);
DROP FUNCTION IF EXISTS public.check_missing_acuse();
DROP FUNCTION IF EXISTS public.check_email_limits(p_company_id integer);
DROP FUNCTION IF EXISTS public.check_budget_availability(p_company_id integer, p_branch_id integer, p_hours_requested numeric);
DROP FUNCTION IF EXISTS public.check_attendance_company();
DROP FUNCTION IF EXISTS public.can_user_use_kiosk(p_user_id uuid, p_kiosk_id integer);
DROP FUNCTION IF EXISTS public.can_user_login(p_user_id uuid);
DROP FUNCTION IF EXISTS public.can_partner_login(p_partner_id integer);
DROP FUNCTION IF EXISTS public.can_delete_procedure(p_procedure_id uuid);
DROP FUNCTION IF EXISTS public.calculate_violation_correlation(p_employee_id integer, p_violations text[], p_days_back integer);
DROP FUNCTION IF EXISTS public.calculate_vicious_cycle_risk(p_company_id integer, p_user_id integer, p_months integer);
DROP FUNCTION IF EXISTS public.calculate_vacation_days(p_company_id integer, p_hire_date date);
DROP FUNCTION IF EXISTS public.calculate_suspension_end_date(p_start_date date, p_work_days integer, p_employee_id uuid);
DROP FUNCTION IF EXISTS public.calculate_sla_deadlines(p_company_id integer, p_created_at timestamp with time zone);
DROP FUNCTION IF EXISTS public.calculate_response_confidence(p_times_suggested integer, p_times_accepted integer, p_times_rejected integer, p_is_verified boolean);
DROP FUNCTION IF EXISTS public.calculate_renewal_alert_date();
DROP FUNCTION IF EXISTS public.calculate_redemption_checkout_time(p_user_id uuid, p_scheduled_date date, p_hours_to_redeem numeric);
DROP FUNCTION IF EXISTS public.calculate_pyramid_commissions(p_vendor_id uuid, p_base_amount numeric);
DROP FUNCTION IF EXISTS public.calculate_pyramid_commission(p_staff_id uuid, p_month integer, p_year integer);
DROP FUNCTION IF EXISTS public.calculate_payroll_totals();
DROP FUNCTION IF EXISTS public.calculate_partner_commission(p_partner_id uuid, p_billable_amount numeric);
DROP FUNCTION IF EXISTS public.calculate_hour_bank_balance(p_user_id uuid);
DROP FUNCTION IF EXISTS public.calculate_gps_distance(lat1 numeric, lng1 numeric, lat2 numeric, lng2 numeric);
DROP FUNCTION IF EXISTS public.calculate_epp_replacement_date();
DROP FUNCTION IF EXISTS public.calculate_credito_disponible();
DROP FUNCTION IF EXISTS public.calculate_company_risk_quartiles(p_company_id integer);
DROP FUNCTION IF EXISTS public.calculate_bmi();
DROP FUNCTION IF EXISTS public.calculate_biometric_photo_expiration(p_capture_date timestamp without time zone);
DROP FUNCTION IF EXISTS public.calculate_allowance_consumption(p_allowance_id integer);
DROP FUNCTION IF EXISTS public.avanzar_proximo_periodo(p_presupuesto_id integer);
DROP FUNCTION IF EXISTS public.auto_generate_signature_hash();
DROP FUNCTION IF EXISTS public.auto_escalate_tickets();
DROP FUNCTION IF EXISTS public.auto_assign_task_to_available_admin(p_task_id uuid);
DROP FUNCTION IF EXISTS public.auto_assign_partner_username();
DROP FUNCTION IF EXISTS public.auto_assign_contract_template();
DROP FUNCTION IF EXISTS public.auto_activate_bundled_modules();
DROP FUNCTION IF EXISTS public.audit_medical_record_changes();
DROP FUNCTION IF EXISTS public.assign_doctor_to_case();
DROP FUNCTION IF EXISTS public.apply_contract_auto_extension();
DROP FUNCTION IF EXISTS public.apply_auto_extension(p_contract_id uuid);
DROP FUNCTION IF EXISTS public.analyze_hour_bank_health(p_company_id integer, p_user_id integer);
DROP FUNCTION IF EXISTS public.analyze_deactivation_impact(p_company_id uuid, p_module_key character varying);
DROP FUNCTION IF EXISTS public.analyze_company_biometric_performance(p_company_id integer);
DROP FUNCTION IF EXISTS public.add_procedure_owner(p_procedure_id uuid, p_user_id uuid, p_action character varying);
DROP FUNCTION IF EXISTS public.add_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid);
DROP TYPE IF EXISTS public.user_account_status;
DROP TYPE IF EXISTS public.role_category_enum;
DROP TYPE IF EXISTS public.residence_type_enum;
DROP TYPE IF EXISTS public.procedure_type;
DROP TYPE IF EXISTS public.procedure_status;
DROP TYPE IF EXISTS public.procedure_scope_type;
DROP TYPE IF EXISTS public.procedure_hierarchy_level;
DROP TYPE IF EXISTS public.partner_account_status;
DROP TYPE IF EXISTS public.housing_type_enum;
DROP TYPE IF EXISTS public.household_relationship_enum;
DROP TYPE IF EXISTS public.enum_visitors_authorization_status;
DROP TYPE IF EXISTS public.enum_visitor_gps_tracking_alert_type;
DROP TYPE IF EXISTS public.enum_vendor_referrals_status;
DROP TYPE IF EXISTS public.enum_vacation_requests_status;
DROP TYPE IF EXISTS public.enum_vacation_requests_request_type;
DROP TYPE IF EXISTS public.enum_users_role;
DROP TYPE IF EXISTS public.enum_users_notification_preference_late_arrivals;
DROP TYPE IF EXISTS public.enum_users_account_status;
DROP TYPE IF EXISTS public.enum_user_union_affiliation_dues_payment_method;
DROP TYPE IF EXISTS public.enum_user_salary_config_salary_type;
DROP TYPE IF EXISTS public.enum_user_salary_config_payment_method;
DROP TYPE IF EXISTS public.enum_user_salary_config_payment_frequency;
DROP TYPE IF EXISTS public.enum_user_salary_config_bank_account_type;
DROP TYPE IF EXISTS public.enum_user_permission_requests_status;
DROP TYPE IF EXISTS public.enum_user_permission_requests_request_type;
DROP TYPE IF EXISTS public.enum_user_medications_route;
DROP TYPE IF EXISTS public.enum_user_medical_exams_result;
DROP TYPE IF EXISTS public.enum_user_medical_exams_exam_type;
DROP TYPE IF EXISTS public.enum_user_marital_status_marital_status;
DROP TYPE IF EXISTS public.enum_user_legal_issues_status;
DROP TYPE IF EXISTS public.enum_user_legal_issues_issue_type;
DROP TYPE IF EXISTS public.enum_user_education_education_level;
DROP TYPE IF EXISTS public.enum_user_driver_licenses_license_type;
DROP TYPE IF EXISTS public.enum_user_documents_document_type;
DROP TYPE IF EXISTS public.enum_user_disciplinary_actions_severity;
DROP TYPE IF EXISTS public.enum_user_disciplinary_actions_action_type;
DROP TYPE IF EXISTS public.enum_user_chronic_conditions_severity;
DROP TYPE IF EXISTS public.enum_user_children_gender;
DROP TYPE IF EXISTS public.enum_user_assigned_tasks_status;
DROP TYPE IF EXISTS public.enum_user_assigned_tasks_priority;
DROP TYPE IF EXISTS public.enum_user_allergies_severity;
DROP TYPE IF EXISTS public.enum_user_allergies_allergy_type;
DROP TYPE IF EXISTS public.enum_system_modules_category;
DROP TYPE IF EXISTS public.enum_system_modules_available_in;
DROP TYPE IF EXISTS public."enum_system_config_connectionMode";
DROP TYPE IF EXISTS public.enum_support_tickets_status;
DROP TYPE IF EXISTS public.enum_support_tickets_priority;
DROP TYPE IF EXISTS public.enum_support_package_auctions_status;
DROP TYPE IF EXISTS public."enum_shifts_shiftType";
DROP TYPE IF EXISTS public."enum_shifts_permanentPriority";
DROP TYPE IF EXISTS public."enum_shifts_flashPriority";
DROP TYPE IF EXISTS public.enum_sanctions_status;
DROP TYPE IF EXISTS public.enum_sanctions_severity;
DROP TYPE IF EXISTS public.enum_sanctions_sanction_type;
DROP TYPE IF EXISTS public.enum_permissions_type;
DROP TYPE IF EXISTS public.enum_permissions_status;
DROP TYPE IF EXISTS public.enum_partners_account_status;
DROP TYPE IF EXISTS public.enum_notifications_priority;
DROP TYPE IF EXISTS public.enum_notifications_enterprise_to_role;
DROP TYPE IF EXISTS public.enum_notifications_enterprise_status;
DROP TYPE IF EXISTS public.enum_notifications_enterprise_priority;
DROP TYPE IF EXISTS public.enum_notifications_enterprise_notification_type;
DROP TYPE IF EXISTS public.enum_notifications_enterprise_from_module;
DROP TYPE IF EXISTS public.enum_notification_queue_status;
DROP TYPE IF EXISTS public.enum_notification_queue_channel;
DROP TYPE IF EXISTS public.enum_multiple_art_configurations_priority;
DROP TYPE IF EXISTS public."enum_multiple_art_configurations_preferredChannel";
DROP TYPE IF EXISTS public.enum_messages_type;
DROP TYPE IF EXISTS public.enum_messages_priority;
DROP TYPE IF EXISTS public.enum_medical_study_requests_urgency;
DROP TYPE IF EXISTS public.enum_medical_study_requests_status;
DROP TYPE IF EXISTS public."enum_medical_study_requests_requestType";
DROP TYPE IF EXISTS public."enum_medical_studies_studyType";
DROP TYPE IF EXISTS public.enum_medical_studies_status;
DROP TYPE IF EXISTS public.enum_medical_studies_priority;
DROP TYPE IF EXISTS public."enum_medical_statistics_periodType";
DROP TYPE IF EXISTS public.enum_medical_records_result;
DROP TYPE IF EXISTS public.enum_medical_records_record_type;
DROP TYPE IF EXISTS public.enum_medical_record_audit_log_action;
DROP TYPE IF EXISTS public.enum_medical_prescriptions_status;
DROP TYPE IF EXISTS public.enum_medical_photos_status;
DROP TYPE IF EXISTS public."enum_medical_photos_photoType";
DROP TYPE IF EXISTS public.enum_medical_history_status;
DROP TYPE IF EXISTS public.enum_medical_history_severity;
DROP TYPE IF EXISTS public.enum_medical_history_outcome;
DROP TYPE IF EXISTS public."enum_medical_history_episodeType";
DROP TYPE IF EXISTS public.enum_medical_exam_templates_exam_type;
DROP TYPE IF EXISTS public.enum_medical_edit_authorizations_status;
DROP TYPE IF EXISTS public.enum_medical_edit_authorizations_priority;
DROP TYPE IF EXISTS public.enum_medical_edit_authorizations_action_type;
DROP TYPE IF EXISTS public.enum_medical_certificates_status;
DROP TYPE IF EXISTS public.enum_extraordinary_licenses_day_type;
DROP TYPE IF EXISTS public."enum_employee_medical_records_smokingStatus";
DROP TYPE IF EXISTS public."enum_employee_medical_records_healthStatus";
DROP TYPE IF EXISTS public."enum_employee_medical_records_glassesType";
DROP TYPE IF EXISTS public."enum_employee_medical_records_followUpFrequency";
DROP TYPE IF EXISTS public."enum_employee_medical_records_fitnessForWork";
DROP TYPE IF EXISTS public."enum_employee_medical_records_exerciseFrequency";
DROP TYPE IF EXISTS public."enum_employee_medical_records_bloodType";
DROP TYPE IF EXISTS public."enum_employee_medical_records_alcoholConsumption";
DROP TYPE IF EXISTS public."enum_employee_locations_sharingLevel";
DROP TYPE IF EXISTS public."enum_employee_locations_currentActivity";
DROP TYPE IF EXISTS public."enum_employee_locations_connectionType";
DROP TYPE IF EXISTS public.enum_employee_documents_status;
DROP TYPE IF EXISTS public."enum_employee_documents_documentType";
DROP TYPE IF EXISTS public.enum_employee_dependency_documents_status;
DROP TYPE IF EXISTS public.enum_employee_dependency_documents_family_member_type;
DROP TYPE IF EXISTS public.enum_dependency_evaluations_action_taken;
DROP TYPE IF EXISTS public.enum_concept_dependencies_on_failure;
DROP TYPE IF EXISTS public.enum_concept_dependencies_multiplier_mode;
DROP TYPE IF EXISTS public.enum_company_tasks_priority_default;
DROP TYPE IF EXISTS public.enum_company_support_assignments_support_type;
DROP TYPE IF EXISTS public.enum_companies_subscription_type;
DROP TYPE IF EXISTS public."enum_companies_subscriptionType";
DROP TYPE IF EXISTS public.enum_biometric_data_type;
DROP TYPE IF EXISTS public.enum_audit_test_logs_triggered_by;
DROP TYPE IF EXISTS public.enum_audit_test_logs_test_type;
DROP TYPE IF EXISTS public.enum_audit_test_logs_status;
DROP TYPE IF EXISTS public.enum_audit_test_logs_severity;
DROP TYPE IF EXISTS public.enum_audit_test_logs_http_method;
DROP TYPE IF EXISTS public.enum_audit_test_logs_fix_result;
DROP TYPE IF EXISTS public.enum_audit_test_logs_environment;
DROP TYPE IF EXISTS public.enum_attendances_status;
DROP TYPE IF EXISTS public.enum_attendances_origin_type;
DROP TYPE IF EXISTS public.enum_attendances_clock_out_method;
DROP TYPE IF EXISTS public.enum_attendances_clock_in_method;
DROP TYPE IF EXISTS public."enum_attendances_checkOutMethod";
DROP TYPE IF EXISTS public."enum_attendances_checkInMethod";
DROP TYPE IF EXISTS public.enum_attendances_absence_type;
DROP TYPE IF EXISTS public.enum_additional_role_types_category;
DROP TYPE IF EXISTS public.enum_access_notifications_priority;
DROP TYPE IF EXISTS public.enum_access_notifications_notification_type;
DROP TYPE IF EXISTS public.education_level_enum;
DROP TYPE IF EXISTS public.contract_type;
DROP TYPE IF EXISTS public.contract_status;
DROP TYPE IF EXISTS public.contract_scope;
DROP TYPE IF EXISTS public.associate_category;
DROP EXTENSION IF EXISTS "uuid-ossp";
DROP EXTENSION IF EXISTS unaccent;
DROP EXTENSION IF EXISTS pg_trgm;
DROP SCHEMA IF EXISTS biometric_partitions;
--
-- Name: biometric_partitions; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA biometric_partitions;


--
-- Name: pg_trgm; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS pg_trgm WITH SCHEMA public;


--
-- Name: EXTENSION pg_trgm; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION pg_trgm IS 'text similarity measurement and index searching based on trigrams';


--
-- Name: unaccent; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS unaccent WITH SCHEMA public;


--
-- Name: EXTENSION unaccent; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION unaccent IS 'text search dictionary that removes accents';


--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: associate_category; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.associate_category AS ENUM (
    'medical',
    'legal',
    'safety',
    'audit',
    'training',
    'psychologist',
    'other'
);


--
-- Name: contract_scope; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.contract_scope AS ENUM (
    'all_company',
    'branches',
    'departments',
    'employees'
);


--
-- Name: contract_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.contract_status AS ENUM (
    'pending',
    'active',
    'paused',
    'terminated',
    'expired'
);


--
-- Name: contract_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.contract_type AS ENUM (
    'permanent',
    'eventual'
);


--
-- Name: education_level_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.education_level_enum AS ENUM (
    'none',
    'primary_incomplete',
    'primary_complete',
    'secondary_incomplete',
    'secondary_complete',
    'tertiary_incomplete',
    'tertiary_complete',
    'university_incomplete',
    'university_complete',
    'postgraduate'
);


--
-- Name: enum_access_notifications_notification_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_access_notifications_notification_type AS ENUM (
    'visitor_arrival',
    'visitor_checkout',
    'visitor_authorization',
    'visitor_outside_facility',
    'visitor_overstay',
    'employee_late_arrival',
    'employee_early_departure',
    'employee_break_exceeded',
    'unauthorized_access',
    'kiosk_offline',
    'gps_low_battery',
    'gps_signal_lost',
    'system_alert'
);


--
-- Name: enum_access_notifications_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_access_notifications_priority AS ENUM (
    'low',
    'medium',
    'high',
    'critical'
);


--
-- Name: enum_additional_role_types_category; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_additional_role_types_category AS ENUM (
    'seguridad',
    'salud',
    'capacitacion',
    'auditoria',
    'supervision',
    'representacion',
    'otros'
);


--
-- Name: enum_attendances_absence_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_attendances_absence_type AS ENUM (
    'medical',
    'vacation',
    'suspension',
    'personal',
    'bereavement',
    'maternity',
    'paternity',
    'study',
    'union',
    'other'
);


--
-- Name: enum_attendances_checkInMethod; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_attendances_checkInMethod" AS ENUM (
    'fingerprint',
    'face',
    'pin',
    'manual',
    'mobile'
);


--
-- Name: enum_attendances_checkOutMethod; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_attendances_checkOutMethod" AS ENUM (
    'fingerprint',
    'face',
    'pin',
    'manual',
    'mobile'
);


--
-- Name: enum_attendances_clock_in_method; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_attendances_clock_in_method AS ENUM (
    'fingerprint',
    'facial',
    'manual',
    'gps',
    'app',
    'web'
);


--
-- Name: enum_attendances_clock_out_method; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_attendances_clock_out_method AS ENUM (
    'fingerprint',
    'facial',
    'manual',
    'gps',
    'app',
    'web'
);


--
-- Name: enum_attendances_origin_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_attendances_origin_type AS ENUM (
    'kiosk',
    'mobile_app',
    'web',
    'manual'
);


--
-- Name: enum_attendances_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_attendances_status AS ENUM (
    'present',
    'late',
    'absent'
);


--
-- Name: enum_audit_test_logs_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_environment AS ENUM (
    'local',
    'render',
    'production'
);


--
-- Name: enum_audit_test_logs_fix_result; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_fix_result AS ENUM (
    'success',
    'failed',
    'partial',
    'not-attempted'
);


--
-- Name: enum_audit_test_logs_http_method; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_http_method AS ENUM (
    'GET',
    'POST',
    'PUT',
    'DELETE',
    'PATCH'
);


--
-- Name: enum_audit_test_logs_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_severity AS ENUM (
    'critical',
    'high',
    'medium',
    'low',
    'info'
);


--
-- Name: enum_audit_test_logs_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_status AS ENUM (
    'pass',
    'fail',
    'warning',
    'skipped',
    'in-progress'
);


--
-- Name: enum_audit_test_logs_test_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_test_type AS ENUM (
    'endpoint',
    'database',
    'relation',
    'integration',
    'e2e',
    'performance',
    'security',
    'stress',
    'console-error',
    'render-logs'
);


--
-- Name: enum_audit_test_logs_triggered_by; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_audit_test_logs_triggered_by AS ENUM (
    'manual',
    'scheduled',
    'auto-healing',
    'deploy-hook'
);


--
-- Name: enum_biometric_data_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_biometric_data_type AS ENUM (
    'fingerprint',
    'face',
    'iris'
);


--
-- Name: enum_companies_subscriptionType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_companies_subscriptionType" AS ENUM (
    'free',
    'basic',
    'professional',
    'enterprise'
);


--
-- Name: enum_companies_subscription_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_companies_subscription_type AS ENUM (
    'free',
    'basic',
    'professional',
    'enterprise'
);


--
-- Name: enum_company_support_assignments_support_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_company_support_assignments_support_type AS ENUM (
    'original_vendor',
    'other_vendor',
    'aponnt_support'
);


--
-- Name: enum_company_tasks_priority_default; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_company_tasks_priority_default AS ENUM (
    'baja',
    'media',
    'alta',
    'urgente'
);


--
-- Name: enum_concept_dependencies_multiplier_mode; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_concept_dependencies_multiplier_mode AS ENUM (
    'NONE',
    'PER_VALID',
    'FIXED'
);


--
-- Name: enum_concept_dependencies_on_failure; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_concept_dependencies_on_failure AS ENUM (
    'SKIP',
    'REDUCE_PROPORTIONAL',
    'WARN_ONLY'
);


--
-- Name: enum_dependency_evaluations_action_taken; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_dependency_evaluations_action_taken AS ENUM (
    'APPLIED',
    'SKIPPED',
    'REDUCED',
    'WARNED'
);


--
-- Name: enum_employee_dependency_documents_family_member_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_employee_dependency_documents_family_member_type AS ENUM (
    'SELF',
    'CHILD',
    'SPOUSE',
    'OTHER'
);


--
-- Name: enum_employee_dependency_documents_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_employee_dependency_documents_status AS ENUM (
    'VALID',
    'EXPIRING_SOON',
    'EXPIRED',
    'PENDING_REVIEW'
);


--
-- Name: enum_employee_documents_documentType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_documents_documentType" AS ENUM (
    'dni',
    'passport',
    'work_visa',
    'national_license',
    'international_license',
    'professional_passenger',
    'professional_cargo',
    'professional_heavy'
);


--
-- Name: enum_employee_documents_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_employee_documents_status AS ENUM (
    'valid',
    'expired',
    'about_to_expire',
    'pending_renewal'
);


--
-- Name: enum_employee_locations_connectionType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_locations_connectionType" AS ENUM (
    'wifi',
    '4g',
    '3g',
    '5g',
    'unknown'
);


--
-- Name: enum_employee_locations_currentActivity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_locations_currentActivity" AS ENUM (
    'working',
    'break',
    'lunch',
    'meeting',
    'travel',
    'idle'
);


--
-- Name: enum_employee_locations_sharingLevel; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_locations_sharingLevel" AS ENUM (
    'full',
    'approximate',
    'supervisor_only',
    'emergency_only'
);


--
-- Name: enum_employee_medical_records_alcoholConsumption; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_alcoholConsumption" AS ENUM (
    'none',
    'occasional',
    'moderate',
    'heavy'
);


--
-- Name: enum_employee_medical_records_bloodType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_bloodType" AS ENUM (
    'A+',
    'A-',
    'B+',
    'B-',
    'AB+',
    'AB-',
    'O+',
    'O-'
);


--
-- Name: enum_employee_medical_records_exerciseFrequency; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_exerciseFrequency" AS ENUM (
    'none',
    'rare',
    'weekly',
    'daily'
);


--
-- Name: enum_employee_medical_records_fitnessForWork; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_fitnessForWork" AS ENUM (
    'fit',
    'fit_with_restrictions',
    'temporarily_unfit',
    'permanently_unfit'
);


--
-- Name: enum_employee_medical_records_followUpFrequency; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_followUpFrequency" AS ENUM (
    'weekly',
    'biweekly',
    'monthly',
    'quarterly',
    'biannual',
    'annual'
);


--
-- Name: enum_employee_medical_records_glassesType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_glassesType" AS ENUM (
    'reading',
    'distance',
    'bifocals',
    'progressive',
    'other'
);


--
-- Name: enum_employee_medical_records_healthStatus; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_healthStatus" AS ENUM (
    'excellent',
    'good',
    'fair',
    'poor'
);


--
-- Name: enum_employee_medical_records_smokingStatus; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_employee_medical_records_smokingStatus" AS ENUM (
    'never',
    'former',
    'current'
);


--
-- Name: enum_extraordinary_licenses_day_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_extraordinary_licenses_day_type AS ENUM (
    'habil',
    'corrido'
);


--
-- Name: enum_medical_certificates_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_certificates_status AS ENUM (
    'pending',
    'under_review',
    'approved',
    'rejected',
    'needs_audit'
);


--
-- Name: enum_medical_edit_authorizations_action_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_edit_authorizations_action_type AS ENUM (
    'edit',
    'delete'
);


--
-- Name: enum_medical_edit_authorizations_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_edit_authorizations_priority AS ENUM (
    'low',
    'normal',
    'high',
    'urgent'
);


--
-- Name: enum_medical_edit_authorizations_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_edit_authorizations_status AS ENUM (
    'pending',
    'approved',
    'rejected',
    'expired',
    'cancelled',
    'escalated'
);


--
-- Name: enum_medical_exam_templates_exam_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_exam_templates_exam_type AS ENUM (
    'preocupacional',
    'periodico',
    'reingreso',
    'retiro',
    'especial'
);


--
-- Name: enum_medical_history_episodeType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_medical_history_episodeType" AS ENUM (
    'illness',
    'injury',
    'accident',
    'surgery',
    'hospitalization',
    'emergency_visit',
    'routine_checkup',
    'vaccination',
    'other'
);


--
-- Name: enum_medical_history_outcome; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_history_outcome AS ENUM (
    'full_recovery',
    'partial_recovery',
    'no_change',
    'worsened',
    'chronic'
);


--
-- Name: enum_medical_history_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_history_severity AS ENUM (
    'mild',
    'moderate',
    'severe',
    'critical'
);


--
-- Name: enum_medical_history_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_history_status AS ENUM (
    'active',
    'resolved',
    'chronic',
    'recurring'
);


--
-- Name: enum_medical_photos_photoType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_medical_photos_photoType" AS ENUM (
    'injury',
    'lesion',
    'swelling',
    'rash',
    'wound',
    'other'
);


--
-- Name: enum_medical_photos_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_photos_status AS ENUM (
    'requested',
    'uploaded',
    'reviewed',
    'rejected'
);


--
-- Name: enum_medical_prescriptions_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_prescriptions_status AS ENUM (
    'active',
    'used',
    'expired',
    'cancelled'
);


--
-- Name: enum_medical_record_audit_log_action; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_record_audit_log_action AS ENUM (
    'created',
    'viewed',
    'edited',
    'signed',
    'locked',
    'unlocked_temporary',
    'delete_requested',
    'delete_approved',
    'delete_rejected',
    'deleted',
    'restored',
    'authorization_requested',
    'authorization_approved',
    'authorization_rejected',
    'authorization_expired',
    'window_opened',
    'window_used',
    'window_expired',
    'attachment_added',
    'attachment_removed',
    'exported',
    'printed'
);


--
-- Name: enum_medical_records_record_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_records_record_type AS ENUM (
    'exam',
    'certificate',
    'study',
    'prescription',
    'antecedent',
    'aptitude',
    'disability',
    'accident'
);


--
-- Name: enum_medical_records_result; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_records_result AS ENUM (
    'apto',
    'apto_con_observaciones',
    'no_apto',
    'pendiente',
    'vencido',
    'suspendido'
);


--
-- Name: enum_medical_statistics_periodType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_medical_statistics_periodType" AS ENUM (
    'monthly',
    'quarterly',
    'yearly',
    'all_time'
);


--
-- Name: enum_medical_studies_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_studies_priority AS ENUM (
    'low',
    'normal',
    'high',
    'urgent'
);


--
-- Name: enum_medical_studies_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_studies_status AS ENUM (
    'pending',
    'completed',
    'cancelled',
    'in_progress'
);


--
-- Name: enum_medical_studies_studyType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_medical_studies_studyType" AS ENUM (
    'radiography',
    'ct_scan',
    'mri',
    'ultrasound',
    'blood_test',
    'urine_test',
    'electrocardiogram',
    'endoscopy',
    'biopsy',
    'mammography',
    'bone_scan',
    'pet_scan',
    'other'
);


--
-- Name: enum_medical_study_requests_requestType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_medical_study_requests_requestType" AS ENUM (
    'existing_studies',
    'additional_studies',
    'both'
);


--
-- Name: enum_medical_study_requests_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_study_requests_status AS ENUM (
    'pending',
    'partially_completed',
    'completed',
    'expired'
);


--
-- Name: enum_medical_study_requests_urgency; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_medical_study_requests_urgency AS ENUM (
    'low',
    'normal',
    'high',
    'urgent'
);


--
-- Name: enum_messages_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_messages_priority AS ENUM (
    'low',
    'normal',
    'high',
    'urgent'
);


--
-- Name: enum_messages_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_messages_type AS ENUM (
    'notification',
    'announcement',
    'alert',
    'approval_request'
);


--
-- Name: enum_multiple_art_configurations_preferredChannel; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_multiple_art_configurations_preferredChannel" AS ENUM (
    'email',
    'sms',
    'whatsapp',
    'phone'
);


--
-- Name: enum_multiple_art_configurations_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_multiple_art_configurations_priority AS ENUM (
    'primary',
    'secondary',
    'backup'
);


--
-- Name: enum_notification_queue_channel; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notification_queue_channel AS ENUM (
    'internal',
    'email',
    'whatsapp',
    'sms'
);


--
-- Name: enum_notification_queue_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notification_queue_status AS ENUM (
    'pending',
    'processing',
    'completed',
    'failed'
);


--
-- Name: enum_notifications_enterprise_from_module; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_enterprise_from_module AS ENUM (
    'permissions',
    'medical',
    'training',
    'art',
    'legal',
    'hr',
    'payroll',
    'safety'
);


--
-- Name: enum_notifications_enterprise_notification_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_enterprise_notification_type AS ENUM (
    'permission_change',
    'role_change',
    'permission_reset',
    'medical_alert',
    'medical_request',
    'medical_document',
    'training_assignment',
    'training_reminder',
    'training_completed',
    'art_notification',
    'safety_equipment',
    'safety_training',
    'legal_notification',
    'hr_notification',
    'payroll_receipt',
    'vacation_request',
    'schedule_change',
    'system_announcement',
    'urgent_alert'
);


--
-- Name: enum_notifications_enterprise_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_enterprise_priority AS ENUM (
    'low',
    'medium',
    'high',
    'urgent'
);


--
-- Name: enum_notifications_enterprise_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_enterprise_status AS ENUM (
    'pending',
    'sent',
    'delivered',
    'read',
    'failed'
);


--
-- Name: enum_notifications_enterprise_to_role; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_enterprise_to_role AS ENUM (
    'admin',
    'supervisor',
    'employee',
    'medical',
    'legal'
);


--
-- Name: enum_notifications_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_notifications_priority AS ENUM (
    'low',
    'medium',
    'high',
    'critical',
    'urgent'
);


--
-- Name: enum_partners_account_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_partners_account_status AS ENUM (
    'pending_verification',
    'active',
    'suspended',
    'inactive'
);


--
-- Name: enum_permissions_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_permissions_status AS ENUM (
    'pending',
    'approved',
    'rejected'
);


--
-- Name: enum_permissions_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_permissions_type AS ENUM (
    'vacation',
    'sick_leave',
    'personal_leave',
    'late_arrival',
    'early_departure',
    'other'
);


--
-- Name: enum_sanctions_sanction_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_sanctions_sanction_type AS ENUM (
    'attendance',
    'training',
    'behavior',
    'performance',
    'safety',
    'other'
);


--
-- Name: enum_sanctions_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_sanctions_severity AS ENUM (
    'warning',
    'minor',
    'major',
    'suspension',
    'termination'
);


--
-- Name: enum_sanctions_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_sanctions_status AS ENUM (
    'active',
    'appealed',
    'expired',
    'revoked'
);


--
-- Name: enum_shifts_flashPriority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_shifts_flashPriority" AS ENUM (
    'low',
    'normal',
    'high',
    'urgent'
);


--
-- Name: enum_shifts_permanentPriority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_shifts_permanentPriority" AS ENUM (
    'low',
    'normal',
    'high',
    'critical'
);


--
-- Name: enum_shifts_shiftType; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_shifts_shiftType" AS ENUM (
    'standard',
    'rotative',
    'permanent',
    'flash'
);


--
-- Name: enum_support_package_auctions_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_support_package_auctions_status AS ENUM (
    'pending',
    'in_auction',
    'bidding_closed',
    'assigned',
    'cancelled'
);


--
-- Name: enum_support_tickets_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_support_tickets_priority AS ENUM (
    'low',
    'medium',
    'high',
    'urgent'
);


--
-- Name: enum_support_tickets_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_support_tickets_status AS ENUM (
    'open',
    'in_progress',
    'waiting_customer',
    'resolved',
    'closed'
);


--
-- Name: enum_system_config_connectionMode; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public."enum_system_config_connectionMode" AS ENUM (
    'local',
    'network'
);


--
-- Name: enum_system_modules_available_in; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_system_modules_available_in AS ENUM (
    'admin',
    'company',
    'both'
);


--
-- Name: enum_system_modules_category; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_system_modules_category AS ENUM (
    'core',
    'security',
    'medical',
    'legal',
    'payroll',
    'additional',
    'siac',
    'rrhh',
    'hardware',
    'compliance',
    'scheduling',
    'communication',
    'monitoring',
    'support',
    'reports',
    'analytics',
    'admin',
    'ai',
    'system',
    'integration',
    'testing'
);


--
-- Name: enum_user_allergies_allergy_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_allergies_allergy_type AS ENUM (
    'medicamento',
    'alimento',
    'ambiental',
    'insecto',
    'contacto',
    'otro'
);


--
-- Name: enum_user_allergies_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_allergies_severity AS ENUM (
    'leve',
    'moderada',
    'grave',
    'anafilaxia'
);


--
-- Name: enum_user_assigned_tasks_priority; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_assigned_tasks_priority AS ENUM (
    'baja',
    'media',
    'alta',
    'urgente'
);


--
-- Name: enum_user_assigned_tasks_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_assigned_tasks_status AS ENUM (
    'pendiente',
    'en_progreso',
    'completada',
    'cancelada',
    'pausada'
);


--
-- Name: enum_user_children_gender; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_children_gender AS ENUM (
    'masculino',
    'femenino',
    'otro'
);


--
-- Name: enum_user_chronic_conditions_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_chronic_conditions_severity AS ENUM (
    'leve',
    'moderada',
    'grave'
);


--
-- Name: enum_user_disciplinary_actions_action_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_disciplinary_actions_action_type AS ENUM (
    'advertencia_verbal',
    'advertencia_escrita',
    'suspension',
    'descuento',
    'despido',
    'otro'
);


--
-- Name: enum_user_disciplinary_actions_severity; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_disciplinary_actions_severity AS ENUM (
    'leve',
    'moderada',
    'grave',
    'muy_grave'
);


--
-- Name: enum_user_documents_document_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_documents_document_type AS ENUM (
    'dni',
    'pasaporte',
    'licencia_conducir',
    'visa',
    'certificado_antecedentes',
    'otro'
);


--
-- Name: enum_user_driver_licenses_license_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_driver_licenses_license_type AS ENUM (
    'nacional',
    'internacional',
    'pasajeros'
);


--
-- Name: enum_user_education_education_level; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_education_education_level AS ENUM (
    'primaria',
    'secundaria',
    'terciaria',
    'universitaria',
    'posgrado',
    'doctorado'
);


--
-- Name: enum_user_legal_issues_issue_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_legal_issues_issue_type AS ENUM (
    'penal',
    'civil',
    'laboral',
    'comercial',
    'administrativo',
    'otro'
);


--
-- Name: enum_user_legal_issues_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_legal_issues_status AS ENUM (
    'en_tramite',
    'resuelto',
    'archivado',
    'desestimado',
    'apelacion',
    'ejecutoria'
);


--
-- Name: enum_user_marital_status_marital_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_marital_status_marital_status AS ENUM (
    'soltero',
    'casado',
    'divorciado',
    'viudo',
    'union_libre'
);


--
-- Name: enum_user_medical_exams_exam_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_medical_exams_exam_type AS ENUM (
    'preocupacional',
    'periodico',
    'reingreso',
    'retiro',
    'especial'
);


--
-- Name: enum_user_medical_exams_result; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_medical_exams_result AS ENUM (
    'apto',
    'apto_con_observaciones',
    'no_apto',
    'pendiente'
);


--
-- Name: enum_user_medications_route; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_medications_route AS ENUM (
    'oral',
    'inyectable',
    'topico',
    'inhalado',
    'otro'
);


--
-- Name: enum_user_permission_requests_request_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_permission_requests_request_type AS ENUM (
    'vacaciones',
    'licencia_medica',
    'permiso_personal',
    'estudio',
    'duelo',
    'maternidad',
    'paternidad',
    'otro'
);


--
-- Name: enum_user_permission_requests_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_permission_requests_status AS ENUM (
    'pendiente',
    'aprobado',
    'rechazado',
    'cancelado'
);


--
-- Name: enum_user_salary_config_bank_account_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_salary_config_bank_account_type AS ENUM (
    'caja_ahorro',
    'cuenta_corriente'
);


--
-- Name: enum_user_salary_config_payment_frequency; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_salary_config_payment_frequency AS ENUM (
    'mensual',
    'quincenal',
    'semanal',
    'diario'
);


--
-- Name: enum_user_salary_config_payment_method; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_salary_config_payment_method AS ENUM (
    'transferencia',
    'cheque',
    'efectivo',
    'tarjeta'
);


--
-- Name: enum_user_salary_config_salary_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_salary_config_salary_type AS ENUM (
    'mensual',
    'jornal',
    'por_hora',
    'comision'
);


--
-- Name: enum_user_union_affiliation_dues_payment_method; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_user_union_affiliation_dues_payment_method AS ENUM (
    'descuento_automatico',
    'transferencia',
    'efectivo',
    'debito'
);


--
-- Name: enum_users_account_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_users_account_status AS ENUM (
    'pending_verification',
    'active',
    'suspended',
    'inactive'
);


--
-- Name: enum_users_notification_preference_late_arrivals; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_users_notification_preference_late_arrivals AS ENUM (
    'email',
    'whatsapp',
    'both'
);


--
-- Name: enum_users_role; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_users_role AS ENUM (
    'manager',
    'admin',
    'supervisor',
    'employee',
    'medical',
    'super_admin',
    'vendor'
);


--
-- Name: enum_vacation_requests_request_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_vacation_requests_request_type AS ENUM (
    'vacation',
    'extraordinary'
);


--
-- Name: enum_vacation_requests_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_vacation_requests_status AS ENUM (
    'pending',
    'approved',
    'rejected',
    'cancelled',
    'active',
    'completed'
);


--
-- Name: enum_vendor_referrals_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_vendor_referrals_status AS ENUM (
    'pending',
    'active',
    'inactive',
    'expired'
);


--
-- Name: enum_visitor_gps_tracking_alert_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_visitor_gps_tracking_alert_type AS ENUM (
    'outside_facility',
    'low_battery',
    'signal_lost',
    'unauthorized_area',
    'overstay'
);


--
-- Name: enum_visitors_authorization_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_visitors_authorization_status AS ENUM (
    'pending',
    'authorized',
    'rejected',
    'completed'
);


--
-- Name: household_relationship_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.household_relationship_enum AS ENUM (
    'spouse',
    'child',
    'parent',
    'sibling',
    'grandparent',
    'grandchild',
    'in_law',
    'uncle_aunt',
    'cousin',
    'roommate',
    'friend',
    'caregiver',
    'other_family',
    'other'
);


--
-- Name: housing_type_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.housing_type_enum AS ENUM (
    'house',
    'apartment',
    'duplex',
    'studio',
    'room',
    'farm',
    'mobile',
    'other'
);


--
-- Name: partner_account_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.partner_account_status AS ENUM (
    'pending_verification',
    'active',
    'suspended',
    'inactive'
);


--
-- Name: procedure_hierarchy_level; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.procedure_hierarchy_level AS ENUM (
    'politica',
    'manual',
    'procedimiento',
    'instructivo'
);


--
-- Name: procedure_scope_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.procedure_scope_type AS ENUM (
    'company',
    'branch',
    'department',
    'sector',
    'role',
    'position',
    'users'
);


--
-- Name: procedure_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.procedure_status AS ENUM (
    'borrador',
    'en_revision',
    'aprobado',
    'vigente',
    'obsoleto'
);


--
-- Name: procedure_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.procedure_type AS ENUM (
    'politica',
    'manual',
    'procedimiento',
    'instructivo',
    'formato',
    'registro'
);


--
-- Name: residence_type_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.residence_type_enum AS ENUM (
    'own',
    'rent',
    'family',
    'shared',
    'employer',
    'temporary',
    'other'
);


--
-- Name: role_category_enum; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.role_category_enum AS ENUM (
    'seguridad',
    'salud',
    'capacitacion',
    'auditoria',
    'supervision',
    'representacion',
    'otros'
);


--
-- Name: user_account_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.user_account_status AS ENUM (
    'pending_verification',
    'active',
    'suspended',
    'inactive'
);


--
-- Name: add_pending_consent(integer, character varying, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF p_user_type = 'employee' THEN
        UPDATE users
        SET pending_consents = array_append(pending_consents, p_consent_id)
        WHERE user_id = p_user_id
        AND NOT (p_consent_id = ANY(pending_consents));
    ELSE
        UPDATE partners
        SET pending_consents = array_append(pending_consents, p_consent_id)
        WHERE id = p_user_id
        AND NOT (p_consent_id = ANY(pending_consents));
    END IF;

    RETURN FOUND;
END;
$$;


--
-- Name: FUNCTION add_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.add_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid) IS 'Agrega un consentimiento pendiente al array del usuario';


--
-- Name: add_procedure_owner(uuid, uuid, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.add_procedure_owner(p_procedure_id uuid, p_user_id uuid, p_action character varying DEFAULT 'modified'::character varying) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_user_info RECORD;
    v_new_owner JSONB;
    v_current_owners JSONB;
BEGIN
    -- Obtener informacin del usuario
    SELECT
        u.user_id,
        u."employeeId" as employee_id,
        u."firstName" || ' ' || u."lastName" as name,
        COALESCE(d.name, 'Sin departamento') as department,
        COALESCE(s.name, 'Sin sector') as sector
    INTO v_user_info
    FROM users u
    LEFT JOIN departments d ON u.department_id = d.id
    LEFT JOIN sectors s ON u.sector_id = s.id
    WHERE u.user_id = p_user_id;

    IF NOT FOUND THEN
        RETURN NULL;
    END IF;

    -- Crear objeto del nuevo propietario
    v_new_owner := jsonb_build_object(
        'user_id', v_user_info.user_id,
        'employee_id', v_user_info.employee_id,
        'name', v_user_info.name,
        'department', v_user_info.department,
        'sector', v_user_info.sector,
        'action', p_action,
        'timestamp', NOW()
    );

    -- Obtener owners actuales
    SELECT COALESCE(owners, '[]'::jsonb) INTO v_current_owners
    FROM procedures WHERE id = p_procedure_id;

    -- Verificar si el usuario ya est en la lista (evitar duplicados consecutivos)
    IF v_current_owners IS NOT NULL AND jsonb_array_length(v_current_owners) > 0 THEN
        -- Si el ltimo owner es el mismo usuario, no duplicar
        IF (v_current_owners->-1->>'user_id')::UUID = p_user_id THEN
            RETURN v_current_owners;
        END IF;
    END IF;

    -- Agregar nuevo propietario
    v_current_owners := v_current_owners || jsonb_build_array(v_new_owner);

    -- Actualizar procedimiento
    UPDATE procedures
    SET owners = v_current_owners,
        updated_at = NOW()
    WHERE id = p_procedure_id;

    RETURN v_current_owners;
END;
$$;


--
-- Name: analyze_company_biometric_performance(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.analyze_company_biometric_performance(p_company_id integer) RETURNS TABLE(avg_processing_time_ms numeric, scans_per_hour numeric, quality_average numeric, alert_rate numeric)
    LANGUAGE plpgsql
    AS $$
      BEGIN
          RETURN QUERY
          SELECT
              AVG(bs.processing_time_ms)::DECIMAL as avg_processing_time_ms,
              COUNT(bs.scan_id)::DECIMAL /
                  NULLIF(EXTRACT(EPOCH FROM (MAX(bs.created_at) - MIN(bs.created_at))), 0) * 3600 as scans_per_hour,
              AVG(bs.quality_score)::DECIMAL as quality_average,
              (COUNT(ba.alert_id)::DECIMAL / NULLIF(COUNT(bs.scan_id), 0) * 100) as alert_rate
          FROM biometric_scans bs
          LEFT JOIN biometric_alerts ba ON bs.scan_id = ba.scan_id AND bs.company_id = ba.company_id
          WHERE bs.company_id = p_company_id
          AND bs.created_at >= NOW() - INTERVAL '24 hours';
      END;
      $$;


--
-- Name: analyze_deactivation_impact(uuid, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.analyze_deactivation_impact(p_company_id uuid, p_module_key character varying) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
      DECLARE
        v_affected JSONB;
        v_critical_count INTEGER;
      BEGIN
        WITH dependent_modules AS (
          SELECT
            sm.module_key,
            sm.name,
            CASE
              WHEN sm.requirements @> to_jsonb(p_module_key::text) THEN 'critical'
              ELSE 'degraded'
            END as impact
          FROM company_modules cm
          JOIN system_modules sm ON cm.system_module_id = sm.id
          WHERE cm.company_id = p_company_id
            AND cm.is_active = true
            AND (
              sm.requirements @> to_jsonb(p_module_key::text) OR
              sm.integrates_with @> to_jsonb(p_module_key::text)
            )
        )
        SELECT
          jsonb_agg(jsonb_build_object('module', module_key, 'name', name, 'impact', impact)),
          COUNT(*) FILTER (WHERE impact = 'critical')
        INTO v_affected, v_critical_count
        FROM dependent_modules;

        RETURN jsonb_build_object(
          'safe', COALESCE(v_critical_count, 0) = 0,
          'critical_affected', COALESCE(v_critical_count, 0),
          'affected', COALESCE(v_affected, '[]'::jsonb)
        );
      END;
      $$;


--
-- Name: analyze_hour_bank_health(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.analyze_hour_bank_health(p_company_id integer, p_user_id integer) RETURNS TABLE(current_balance numeric, monthly_avg_usage numeric, monthly_avg_accrual numeric, months_until_zero numeric, burn_rate numeric, health_score integer, status character varying, factors jsonb, recommendations jsonb)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_balance DECIMAL := 0;
    v_avg_usage DECIMAL := 0;
    v_avg_accrual DECIMAL := 0;
    v_months_zero DECIMAL := NULL;
    v_burn_rate DECIMAL := 0;
    v_score INTEGER := 100;
    v_status VARCHAR := 'healthy';
    v_factors JSONB := '[]'::JSONB;
    v_recommendations JSONB := '[]'::JSONB;
    v_vicious_result RECORD;
BEGIN
    -- Obtener saldo actual
    SELECT COALESCE(hbb.current_balance, 0)
    INTO v_balance
    FROM hour_bank_balances hbb
    WHERE hbb.company_id = p_company_id AND hbb.user_id = p_user_id;

    -- Calcular promedio mensual de uso (ultimos 6 meses)
    SELECT COALESCE(AVG(monthly_usage), 0)
    INTO v_avg_usage
    FROM (
        SELECT DATE_TRUNC('month', created_at) as month,
               SUM(ABS(hours_final)) as monthly_usage
        FROM hour_bank_transactions
        WHERE company_id = p_company_id
          AND user_id = p_user_id
          AND transaction_type = 'usage'
          AND created_at >= CURRENT_DATE - INTERVAL '6 months'
        GROUP BY DATE_TRUNC('month', created_at)
    ) monthly;

    -- Calcular promedio mensual de acumulacion
    SELECT COALESCE(AVG(monthly_accrual), 0)
    INTO v_avg_accrual
    FROM (
        SELECT DATE_TRUNC('month', created_at) as month,
               SUM(hours_final) as monthly_accrual
        FROM hour_bank_transactions
        WHERE company_id = p_company_id
          AND user_id = p_user_id
          AND transaction_type = 'accrual'
          AND created_at >= CURRENT_DATE - INTERVAL '6 months'
        GROUP BY DATE_TRUNC('month', created_at)
    ) monthly;

    -- Calcular meses hasta agotar saldo
    IF v_avg_usage > v_avg_accrual AND (v_avg_usage - v_avg_accrual) > 0 THEN
        v_months_zero := v_balance / (v_avg_usage - v_avg_accrual);
    END IF;

    -- Calcular burn rate
    IF v_balance > 0 THEN
        v_burn_rate := (v_avg_usage / v_balance) * 100;
    END IF;

    -- Analizar ciclo vicioso
    SELECT * INTO v_vicious_result FROM calculate_vicious_cycle_risk(p_company_id, p_user_id, 6);

    -- Calcular score y factores
    -- Factor 1: Burn rate alto
    IF v_burn_rate > 50 THEN
        v_score := v_score - 30;
        v_factors := v_factors || '["Burn rate muy alto (>50% mensual)"]'::JSONB;
        v_recommendations := v_recommendations || '["Reducir uso de banco de horas o aumentar acumulacion"]'::JSONB;
    ELSIF v_burn_rate > 25 THEN
        v_score := v_score - 15;
        v_factors := v_factors || '["Burn rate elevado (>25% mensual)"]'::JSONB;
    END IF;

    -- Factor 2: Meses hasta cero
    IF v_months_zero IS NOT NULL AND v_months_zero < 2 THEN
        v_score := v_score - 25;
        v_factors := v_factors || '["Saldo se agotara en menos de 2 meses"]'::JSONB;
        v_recommendations := v_recommendations || '["Urgente: limitar uso de horas del banco"]'::JSONB;
    ELSIF v_months_zero IS NOT NULL AND v_months_zero < 4 THEN
        v_score := v_score - 10;
        v_factors := v_factors || '["Saldo se agotara en menos de 4 meses"]'::JSONB;
    END IF;

    -- Factor 3: Ciclo vicioso
    IF v_vicious_result.is_vicious_cycle THEN
        v_score := v_score - 30;
        v_factors := v_factors || ('["Ciclo vicioso detectado: ratio ' || v_vicious_result.ratio::TEXT || '"]')::JSONB;
        v_recommendations := v_recommendations || ('["' || v_vicious_result.recommendation || '"]')::JSONB;
    END IF;

    -- Factor 4: Saldo negativo
    IF v_balance < 0 THEN
        v_score := v_score - 20;
        v_factors := v_factors || '["Saldo negativo - debe horas"]'::JSONB;
        v_recommendations := v_recommendations || '["Acumular horas extras para compensar deficit"]'::JSONB;
    END IF;

    -- Determinar status
    IF v_score >= 80 THEN v_status := 'healthy';
    ELSIF v_score >= 60 THEN v_status := 'warning';
    ELSIF v_score >= 40 THEN v_status := 'at_risk';
    ELSE v_status := 'critical';
    END IF;

    v_score := GREATEST(0, v_score);

    RETURN QUERY SELECT
        v_balance,
        v_avg_usage,
        v_avg_accrual,
        v_months_zero,
        v_burn_rate,
        v_score,
        v_status,
        v_factors,
        v_recommendations;
END;
$$;


--
-- Name: apply_auto_extension(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.apply_auto_extension(p_contract_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_contract contracts%ROWTYPE;
BEGIN
    SELECT * INTO v_contract FROM contracts WHERE id = p_contract_id;

    IF v_contract IS NULL THEN
        RETURN FALSE;
    END IF;

    -- Solo aplicar si est en ACTIVE o RENEWAL_PENDING y ya venci
    IF v_contract.status NOT IN ('ACTIVE', 'RENEWAL_PENDING') THEN
        RETURN FALSE;
    END IF;

    IF v_contract.end_date > CURRENT_DATE THEN
        RETURN FALSE; -- An no venci
    END IF;

    -- Guardar fecha original si es la primera extensin
    IF v_contract.original_end_date IS NULL THEN
        UPDATE contracts SET original_end_date = end_date WHERE id = p_contract_id;
    END IF;

    -- Aplicar extensin de 60 das
    UPDATE contracts
    SET
        status = 'GRACE_PERIOD',
        grace_period_end = CURRENT_DATE + INTERVAL '60 days',
        is_auto_renewed = true,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = p_contract_id;

    -- Registrar en log
    INSERT INTO contract_renewal_logs (contract_id, event_type, details, days_until_expiry)
    VALUES (
        p_contract_id,
        'AUTO_EXTENSION_APPLIED',
        jsonb_build_object(
            'original_end_date', v_contract.end_date,
            'new_grace_period_end', CURRENT_DATE + INTERVAL '60 days',
            'reason', 'Extensin automtica por falta de renovacin manual'
        ),
        0
    );

    RETURN TRUE;
END;
$$;


--
-- Name: apply_contract_auto_extension(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.apply_contract_auto_extension() RETURNS TABLE(contract_id uuid, company_name character varying, contract_code character varying, old_end_date date, new_end_date date, extension_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    rec RECORD;
BEGIN
    FOR rec IN
        SELECT
            c.id, c.contract_code, c.end_date, c.auto_extension_count,
            co.name as company_name
        FROM contracts c
        JOIN companies co ON c.company_id = co.company_id
        WHERE c.status = 'ACTIVE'
          AND c.end_date <= CURRENT_DATE
    LOOP
        -- Guardar fecha original si es primera extensin
        IF rec.auto_extension_count = 0 THEN
            UPDATE contracts SET original_end_date = rec.end_date WHERE id = rec.id;
        END IF;

        -- Aplicar extensin de 60 das
        UPDATE contracts
        SET
            status = 'GRACE_PERIOD',
            grace_period_end = rec.end_date + INTERVAL '60 days',
            auto_extension_count = rec.auto_extension_count + 1,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = rec.id;

        -- Registrar en logs
        INSERT INTO contract_renewal_logs (
            contract_id, action_type, action_date,
            old_end_date, new_end_date, alert_recipients,
            notes, created_at
        ) VALUES (
            rec.id, 'AUTO_EXTENSION', CURRENT_TIMESTAMP,
            rec.end_date, rec.end_date + INTERVAL '60 days',
            '[]'::jsonb,
            'Extensin automtica aplicada por el sistema (60 das de gracia)',
            CURRENT_TIMESTAMP
        );

        contract_id := rec.id;
        company_name := rec.company_name;
        contract_code := rec.contract_code;
        old_end_date := rec.end_date;
        new_end_date := rec.end_date + INTERVAL '60 days';
        extension_count := rec.auto_extension_count + 1;

        RETURN NEXT;
    END LOOP;
END;
$$;


--
-- Name: assign_doctor_to_case(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.assign_doctor_to_case() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_doctor_id UUID;
BEGIN
    -- Solo asignar si es tipo mdico y no tiene mdico asignado
    IF NEW.absence_type IN ('medical_illness', 'work_accident', 'non_work_accident', 'occupational_disease', 'maternity')
       AND NEW.assigned_doctor_id IS NULL THEN

        -- Buscar mdico activo de la empresa (round-robin bsico)
        SELECT ms.id INTO v_doctor_id
        FROM medical_staff ms
        WHERE ms.company_id = NEW.company_id
          AND ms.is_active = true
        ORDER BY (
            SELECT COUNT(*)
            FROM absence_cases ac
            WHERE ac.assigned_doctor_id = ms.id
              AND ac.case_status NOT IN ('closed', 'justified', 'not_justified')
        ) ASC
        LIMIT 1;

        IF v_doctor_id IS NOT NULL THEN
            NEW.assigned_doctor_id := v_doctor_id;
            NEW.assignment_date := CURRENT_TIMESTAMP;
            NEW.case_status := 'under_review';
        END IF;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION assign_doctor_to_case(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.assign_doctor_to_case() IS 'Asigna automticamente un mdico al crear caso de ausencia mdica';


--
-- Name: audit_medical_record_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.audit_medical_record_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_action VARCHAR(30);
    v_old_values JSONB;
    v_new_values JSONB;
BEGIN
    IF TG_OP = 'INSERT' THEN
        v_action := 'created';
        v_new_values := to_jsonb(NEW);

        INSERT INTO medical_record_audit_log (
            company_id, record_id, record_type, action,
            action_by, new_values
        ) VALUES (
            NEW.company_id, NEW.id, NEW.record_type, v_action,
            NEW.created_by, v_new_values
        );

    ELSIF TG_OP = 'UPDATE' THEN
        -- Determinar tipo de accion
        IF OLD.is_locked = false AND NEW.is_locked = true THEN
            v_action := 'locked';
        ELSIF OLD.is_deleted = false AND NEW.is_deleted = true THEN
            v_action := 'deleted';
        ELSIF OLD.is_deleted = true AND NEW.is_deleted = false THEN
            v_action := 'restored';
        ELSE
            v_action := 'edited';
        END IF;

        v_old_values := to_jsonb(OLD);
        v_new_values := to_jsonb(NEW);

        INSERT INTO medical_record_audit_log (
            company_id, record_id, record_type, action,
            action_by, old_values, new_values
        ) VALUES (
            NEW.company_id, NEW.id, NEW.record_type, v_action,
            COALESCE(NEW.last_edited_by, NEW.created_by), v_old_values, v_new_values
        );
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: auto_activate_bundled_modules(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_activate_bundled_modules() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            BEGIN
                IF (TG_OP = 'INSERT' OR (TG_OP = 'UPDATE' AND NEW.activo = true)) THEN
                    INSERT INTO company_modules (company_id, system_module_id, activo, precio_mensual, fecha_asignacion, is_bundled, bundled_with, auto_activated)
                    SELECT 
                        NEW.company_id,
                        sm.id,
                        true,
                        0,
                        CURRENT_TIMESTAMP,
                        true,
                        NEW.system_module_id,
                        true
                    FROM system_modules sm
                    WHERE sm.module_key = ANY(
                        SELECT jsonb_array_elements_text(modules_bundled)
                        FROM system_modules
                        WHERE id = NEW.system_module_id
                    )
                    AND NOT EXISTS (
                        SELECT 1 FROM company_modules cm2
                        WHERE cm2.company_id = NEW.company_id
                        AND cm2.system_module_id = sm.id
                    );
                END IF;
                RETURN NEW;
            END;
            $$;


--
-- Name: auto_assign_contract_template(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_assign_contract_template() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_employee RECORD;
  v_branch RECORD;
  v_template_type VARCHAR(50);
  v_template RECORD;
BEGIN
  -- Determinar tipo de contrato segn el tipo de activo
  SELECT asset_type INTO v_employee
  FROM employee_assigned_assets
  WHERE id = NEW.asset_assignment_id;

  v_template_type := CASE v_employee.asset_type
    WHEN 'VEHICLE' THEN 'COMODATO_VEHICULO'
    WHEN 'MOBILE_PHONE' THEN 'COMODATO_TECNOLOGIA'
    WHEN 'LAPTOP' THEN 'COMODATO_TECNOLOGIA'
    ELSE NULL
  END;

  IF v_template_type IS NULL THEN
    RETURN NEW;
  END IF;

  -- Obtener pas del empleado (desde su sucursal)
  SELECT e.*, b.country as branch_country
  INTO v_employee
  FROM employee_assigned_assets eaa
  JOIN employees e ON eaa.employee_id = e.id
  JOIN branches b ON e.default_branch_id = b.id
  WHERE eaa.id = NEW.asset_assignment_id;

  -- Obtener template
  SELECT * INTO v_template
  FROM get_contract_template(v_template_type, v_employee.branch_country);

  IF FOUND THEN
    NEW.template_id := v_template.template_id;
    NEW.country_code := v_employee.branch_country;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: auto_assign_partner_username(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_assign_partner_username() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Si se est aprobando y no tiene username, asignar DNI
  IF NEW.approval_status = 'approved' AND OLD.approval_status != 'approved' THEN
    IF NEW.username IS NULL AND NEW.dni IS NOT NULL THEN
      NEW.username := NEW.dni;
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: auto_assign_task_to_available_admin(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_assign_task_to_available_admin(p_task_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_admin_id UUID;
BEGIN
  -- Buscar admin con menos tareas asignadas activas
  SELECT id INTO v_admin_id
  FROM aponnt_staff
  WHERE
    role IN ('admin', 'super_admin')
    AND is_active = true
  ORDER BY (
    SELECT COUNT(*)
    FROM administrative_tasks
    WHERE assigned_to = aponnt_staff.id
      AND status IN ('ASSIGNED', 'IN_PROGRESS')
  ) ASC
  LIMIT 1;

  IF v_admin_id IS NOT NULL THEN
    UPDATE administrative_tasks
    SET
      assigned_to = v_admin_id,
      assigned_at = CURRENT_TIMESTAMP,
      status = 'ASSIGNED',
      updated_at = CURRENT_TIMESTAMP
    WHERE id = p_task_id;

    RETURN TRUE;
  END IF;

  RETURN FALSE;
END;
$$;


--
-- Name: auto_escalate_tickets(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_escalate_tickets() RETURNS TABLE(ticket_id uuid, ticket_number character varying, vendor_id uuid, supervisor_id uuid, escalation_reason character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    st.ticket_id,
    st.ticket_number,
    st.assigned_to_vendor_id as vendor_id,
    get_vendor_supervisor(st.assigned_to_vendor_id) as supervisor_id,
    'sla_timeout'::VARCHAR(100) as escalation_reason
  FROM support_tickets st
  WHERE st.status IN ('open', 'in_progress')
    AND st.sla_escalation_deadline < CURRENT_TIMESTAMP
    AND st.first_response_at IS NULL -- No ha habido respuesta
    AND st.escalated_to_supervisor_id IS NULL -- No escalado previamente
    AND get_vendor_supervisor(st.assigned_to_vendor_id) IS NOT NULL; -- Tiene supervisor
END;
$$;


--
-- Name: FUNCTION auto_escalate_tickets(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.auto_escalate_tickets() IS 'Retorna todos los tickets que deben escalarse automticamente por timeout';


--
-- Name: auto_generate_signature_hash(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.auto_generate_signature_hash() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Solo si se est firmando por primera vez
  IF NEW.signed_at IS NOT NULL AND OLD.signed_at IS NULL THEN
    NEW.signature_hash := generate_signature_hash(
      NEW.id,
      NEW.signer_name,
      NEW.signer_dni,
      NEW.signature_ip
    );
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: avanzar_proximo_periodo(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.avanzar_proximo_periodo(p_presupuesto_id integer) RETURNS date
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_presupuesto RECORD;
    v_nuevo_periodo DATE;
BEGIN
    SELECT * INTO v_presupuesto FROM siac_presupuestos WHERE id = p_presupuesto_id;
    IF NOT FOUND THEN RAISE EXCEPTION 'Presupuesto no encontrado: %', p_presupuesto_id; END IF;
    IF v_presupuesto.tipo_facturacion != 'RECURRENTE' THEN RAISE EXCEPTION 'Solo aplica a presupuestos RECURRENTE'; END IF;

    CASE v_presupuesto.frecuencia_facturacion
        WHEN 'MONTHLY' THEN v_nuevo_periodo := v_presupuesto.proximo_periodo_facturacion + INTERVAL '1 month';
        WHEN 'QUARTERLY' THEN v_nuevo_periodo := v_presupuesto.proximo_periodo_facturacion + INTERVAL '3 months';
        WHEN 'YEARLY' THEN v_nuevo_periodo := v_presupuesto.proximo_periodo_facturacion + INTERVAL '1 year';
        ELSE RAISE EXCEPTION 'Frecuencia no vlida: %', v_presupuesto.frecuencia_facturacion;
    END CASE;

    UPDATE siac_presupuestos
    SET proximo_periodo_facturacion = v_nuevo_periodo,
        cantidad_facturas_generadas = cantidad_facturas_generadas + 1
    WHERE id = p_presupuesto_id;

    RETURN v_nuevo_periodo;
END;
$$;


--
-- Name: calculate_allowance_consumption(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_allowance_consumption(p_allowance_id integer) RETURNS TABLE(consumed_amount numeric, consumed_quantity integer, remaining_amount numeric, remaining_quantity integer, consumption_percentage numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_allowance RECORD;
  v_total_amount DECIMAL(15,2);
  v_total_quantity INTEGER;
BEGIN
  -- Obtener allowance
  SELECT * INTO v_allowance
  FROM benefit_expense_allowances
  WHERE id = p_allowance_id;

  IF NOT FOUND THEN
    RETURN QUERY SELECT 0::DECIMAL(15,2), 0, 0::DECIMAL(15,2), 0, 0::DECIMAL(5,2);
    RETURN;
  END IF;

  -- Calcular consumo de rendiciones aprobadas
  SELECT
    COALESCE(SUM(amount), 0),
    COALESCE(SUM(quantity), 0)
  INTO v_total_amount, v_total_quantity
  FROM benefit_expense_submissions
  WHERE allowance_id = p_allowance_id
    AND verification_status IN ('verified', 'reimbursed');

  -- Retornar clculo
  RETURN QUERY SELECT
    v_total_amount,
    v_total_quantity,
    GREATEST(COALESCE(v_allowance.max_amount, 0) - v_total_amount, 0),
    GREATEST(COALESCE(v_allowance.max_quantity, 0) - v_total_quantity, 0),
    CASE
      WHEN v_allowance.max_amount > 0 THEN (v_total_amount / v_allowance.max_amount * 100)
      WHEN v_allowance.max_quantity > 0 THEN (v_total_quantity::DECIMAL / v_allowance.max_quantity * 100)
      ELSE 0
    END;
END;
$$;


--
-- Name: FUNCTION calculate_allowance_consumption(p_allowance_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_allowance_consumption(p_allowance_id integer) IS 'Calcula consumo y saldo disponible de un expense allowance';


--
-- Name: calculate_biometric_photo_expiration(timestamp without time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_biometric_photo_expiration(p_capture_date timestamp without time zone) RETURNS timestamp without time zone
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Vencimiento: 1 ao (365 das) desde la fecha de captura
    RETURN p_capture_date + INTERVAL '365 days';
END;
$$;


--
-- Name: FUNCTION calculate_biometric_photo_expiration(p_capture_date timestamp without time zone); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_biometric_photo_expiration(p_capture_date timestamp without time zone) IS 'Calcula la fecha de vencimiento de foto biomtrica (1 ao desde captura)';


--
-- Name: calculate_bmi(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_bmi() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF NEW.weight_kg IS NOT NULL AND NEW.height_cm IS NOT NULL AND NEW.height_cm > 0 THEN
        NEW.bmi := ROUND((NEW.weight_kg / POWER(NEW.height_cm / 100, 2))::numeric, 2);
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: calculate_company_risk_quartiles(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_company_risk_quartiles(p_company_id integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_result JSONB;
    v_global JSONB;
    v_by_category JSONB;
BEGIN
    -- Calcular cuartiles globales de fatiga (ejemplo simplificado)
    -- En produccin, esto consultara datos reales de asistencia

    WITH risk_data AS (
        SELECT
            op.work_category,
            -- Aqu iran los clculos reales de ndices
            -- Por ahora usamos datos simulados
            RANDOM() * 100 as fatigue_index,
            RANDOM() * 100 as accident_index,
            RANDOM() * 100 as legal_index,
            RANDOM() * 100 as performance_index,
            RANDOM() * 100 as turnover_index
        FROM users u
        LEFT JOIN organizational_positions op ON u.organizational_position_id = op.id
        WHERE u.company_id = p_company_id AND u.is_active = true
    ),
    global_quartiles AS (
        SELECT
            PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY fatigue_index) as fatigue_q1,
            PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY fatigue_index) as fatigue_q2,
            PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY fatigue_index) as fatigue_q3,
            PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY accident_index) as accident_q1,
            PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY accident_index) as accident_q2,
            PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY accident_index) as accident_q3,
            PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY legal_index) as legal_q1,
            PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY legal_index) as legal_q2,
            PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY legal_index) as legal_q3
        FROM risk_data
    )
    SELECT jsonb_build_object(
        'fatigue', jsonb_build_object('q1', ROUND(fatigue_q1::numeric, 1), 'q2', ROUND(fatigue_q2::numeric, 1), 'q3', ROUND(fatigue_q3::numeric, 1)),
        'accident', jsonb_build_object('q1', ROUND(accident_q1::numeric, 1), 'q2', ROUND(accident_q2::numeric, 1), 'q3', ROUND(accident_q3::numeric, 1)),
        'legal_claim', jsonb_build_object('q1', ROUND(legal_q1::numeric, 1), 'q2', ROUND(legal_q2::numeric, 1), 'q3', ROUND(legal_q3::numeric, 1))
    ) INTO v_global
    FROM global_quartiles;

    -- Resultado final
    v_result := jsonb_build_object(
        'global', COALESCE(v_global, '{}'::jsonb),
        'calculated_at', NOW(),
        'employee_count', (SELECT COUNT(*) FROM users WHERE company_id = p_company_id AND is_active = true)
    );

    -- Actualizar cache en company_risk_config
    UPDATE company_risk_config
    SET calculated_quartiles = v_result,
        last_quartile_calculation = NOW(),
        updated_at = NOW()
    WHERE company_id = p_company_id;

    RETURN v_result;
END;
$$;


--
-- Name: calculate_credito_disponible(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_credito_disponible() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.credito_disponible := NEW.credito_maximo - NEW.credito_utilizado;

    -- Bloquear si excede crdito
    IF NEW.credito_disponible < 0 THEN
        NEW.bloqueo_por_credito := true;
    ELSE
        NEW.bloqueo_por_credito := false;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: calculate_epp_replacement_date(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_epp_replacement_date() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Si no se especifica fecha de reemplazo, calcularla
    IF NEW.calculated_replacement_date IS NULL THEN
        -- Obtener vida util del catalogo o del requirement
        SELECT COALESCE(
            (SELECT custom_lifespan_days FROM epp_role_requirements WHERE id = NEW.requirement_id),
            (SELECT default_lifespan_days FROM epp_catalog WHERE id = NEW.epp_catalog_id),
            365 -- Default 1 year
        ) INTO NEW.calculated_replacement_date;

        NEW.calculated_replacement_date := NEW.delivery_date + NEW.calculated_replacement_date;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: calculate_gps_distance(numeric, numeric, numeric, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_gps_distance(lat1 numeric, lng1 numeric, lat2 numeric, lng2 numeric) RETURNS integer
    LANGUAGE plpgsql IMMUTABLE
    AS $$
DECLARE
    r INTEGER := 6371000; -- Radio de la Tierra en metros
    dlat DECIMAL;
    dlng DECIMAL;
    a DECIMAL;
    c DECIMAL;
    distance INTEGER;
BEGIN
    IF lat1 IS NULL OR lng1 IS NULL OR lat2 IS NULL OR lng2 IS NULL THEN
        RETURN NULL;
    END IF;

    dlat := RADIANS(lat2 - lat1);
    dlng := RADIANS(lng2 - lng1);

    a := SIN(dlat/2) * SIN(dlat/2) +
         COS(RADIANS(lat1)) * COS(RADIANS(lat2)) *
         SIN(dlng/2) * SIN(dlng/2);

    c := 2 * ATAN2(SQRT(a), SQRT(1-a));
    distance := ROUND(r * c);

    RETURN distance;
END;
$$;


--
-- Name: calculate_hour_bank_balance(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_hour_bank_balance(p_user_id uuid) RETURNS TABLE(available_balance numeric, expiring_soon numeric, expiring_date date)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    WITH active_hours AS (
        SELECT
            SUM(CASE WHEN transaction_type IN ('accrual', 'adjustment') AND hours_final > 0 THEN hours_final ELSE 0 END) -
            SUM(CASE WHEN transaction_type IN ('usage', 'expiry', 'payout') OR hours_final < 0 THEN ABS(hours_final) ELSE 0 END) as balance,
            MIN(CASE WHEN expires_at > CURRENT_DATE AND NOT is_expired THEN expires_at END) as next_expiry
        FROM hour_bank_transactions
        WHERE user_id = p_user_id
          AND status = 'completed'
    ),
    expiring AS (
        SELECT COALESCE(SUM(hours_final), 0) as hours
        FROM hour_bank_transactions
        WHERE user_id = p_user_id
          AND status = 'completed'
          AND transaction_type = 'accrual'
          AND expires_at <= CURRENT_DATE + INTERVAL '30 days'
          AND NOT is_expired
    )
    SELECT
        COALESCE(a.balance, 0)::DECIMAL(6,2),
        COALESCE(e.hours, 0)::DECIMAL(5,2),
        a.next_expiry
    FROM active_hours a, expiring e;
END;
$$;


--
-- Name: calculate_partner_commission(uuid, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_partner_commission(p_partner_id uuid, p_billable_amount numeric) RETURNS TABLE(commission_id uuid, commission_type character varying, percentage numeric, fixed_amount numeric, calculated_commission numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_config partner_commissions%ROWTYPE;
BEGIN
    -- Obtener configuracion activa del partner
    SELECT * INTO v_config
    FROM partner_commissions
    WHERE partner_id = p_partner_id
      AND is_active = true
      AND effective_from <= CURRENT_DATE
      AND (effective_until IS NULL OR effective_until >= CURRENT_DATE)
    ORDER BY created_at DESC
    LIMIT 1;

    IF v_config.id IS NULL THEN
        -- Sin configuracion, usar default 15%
        RETURN QUERY SELECT
            NULL::UUID,
            'percentage'::VARCHAR,
            15.00::DECIMAL,
            0::DECIMAL,
            (p_billable_amount * 0.15)::DECIMAL;
    ELSE
        CASE v_config.commission_type
            WHEN 'percentage' THEN
                RETURN QUERY SELECT
                    v_config.id,
                    v_config.commission_type,
                    v_config.percentage,
                    v_config.fixed_amount,
                    (p_billable_amount * v_config.percentage / 100)::DECIMAL;
            WHEN 'fixed_per_case' THEN
                RETURN QUERY SELECT
                    v_config.id,
                    v_config.commission_type,
                    v_config.percentage,
                    v_config.fixed_amount,
                    v_config.fixed_amount;
            ELSE
                -- Default to percentage
                RETURN QUERY SELECT
                    v_config.id,
                    v_config.commission_type,
                    COALESCE(v_config.percentage, 15.00),
                    v_config.fixed_amount,
                    (p_billable_amount * COALESCE(v_config.percentage, 15.00) / 100)::DECIMAL;
        END CASE;
    END IF;
END;
$$;


--
-- Name: calculate_payroll_totals(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_payroll_totals() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Calcular gross total
    NEW.gross_total := COALESCE(NEW.base_salary, 0) +
                       COALESCE(NEW.seniority_bonus, 0) +
                       COALESCE(NEW.presentation_bonus, 0) +
                       COALESCE(NEW.overtime_50_amount, 0) +
                       COALESCE(NEW.overtime_100_amount, 0) +
                       COALESCE(NEW.vacation_amount, 0) +
                       COALESCE(NEW.sac_aguinaldo, 0) +
                       COALESCE(NEW.commissions, 0) +
                       COALESCE(NEW.bonuses, 0) +
                       COALESCE(NEW.other_earnings, 0);

    -- Calcular deductions total
    NEW.deductions_total := COALESCE(NEW.jubilacion, 0) +
                            COALESCE(NEW.obra_social, 0) +
                            COALESCE(NEW.ley_19032, 0) +
                            COALESCE(NEW.sindicato, 0) +
                            COALESCE(NEW.ganancias, 0) +
                            COALESCE(NEW.other_deductions, 0);

    -- Calcular net salary
    NEW.net_salary := NEW.gross_total - NEW.deductions_total;

    -- Calcular total hours
    NEW.total_hours_worked := COALESCE(NEW.regular_hours_worked, 0) +
                              COALESCE(NEW.overtime_50_hours, 0) +
                              COALESCE(NEW.overtime_100_hours, 0);

    RETURN NEW;
END;
$$;


--
-- Name: calculate_pyramid_commission(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_pyramid_commission(p_staff_id uuid, p_month integer DEFAULT NULL::integer, p_year integer DEFAULT NULL::integer) RETURNS numeric
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_pyramid_percentage DECIMAL(5,2);
  v_role_code VARCHAR(10);
  v_total_sales DECIMAL(12,2);
  v_pyramid_commission DECIMAL(12,2);
BEGIN
  -- Obtener % piramidal efectivo y rol
  SELECT effective_pyramid_percentage, role_code
  INTO v_pyramid_percentage, v_role_code
  FROM v_staff_pyramid_percentage
  WHERE staff_id = p_staff_id AND is_active = true;

  -- Si no se encontr el staff o no est activo
  IF NOT FOUND THEN
    RETURN 0;
  END IF;

  -- Si no tiene % piramidal, retornar 0
  IF v_pyramid_percentage IS NULL OR v_pyramid_percentage = 0 THEN
    RETURN 0;
  END IF;

  -- Calcular total de ventas de subordinados segn jerarqua
  -- Usa recursive CTE para obtener TODOS los subordinados en la jerarqua
  WITH RECURSIVE subordinates_hierarchy AS (
    -- Caso base: el staff mismo
    SELECT staff_id, 1 as depth
    FROM aponnt_staff
    WHERE staff_id = p_staff_id

    UNION ALL

    -- Caso recursivo: todos los que reportan a alguien en la jerarqua
    SELECT s.staff_id, sh.depth + 1
    FROM aponnt_staff s
    INNER JOIN subordinates_hierarchy sh ON s.reports_to_staff_id = sh.staff_id
    WHERE s.is_active = true
      AND sh.depth < 10  -- Lmite de profundidad para evitar loops infinitos
  )
  SELECT COALESCE(SUM(c.sales_commission_usd), 0) INTO v_total_sales
  FROM companies c
  WHERE c.assigned_vendor_id IN (SELECT staff_id FROM subordinates_hierarchy WHERE staff_id != p_staff_id)
    AND c.is_active = true
    AND (p_month IS NULL OR EXTRACT(MONTH FROM c.created_at) = p_month)
    AND (p_year IS NULL OR EXTRACT(YEAR FROM c.created_at) = p_year);

  -- Calcular comisin piramidal
  v_pyramid_commission := (v_total_sales * v_pyramid_percentage) / 100;

  RETURN v_pyramid_commission;
END;
$$;


--
-- Name: FUNCTION calculate_pyramid_commission(p_staff_id uuid, p_month integer, p_year integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_pyramid_commission(p_staff_id uuid, p_month integer, p_year integer) IS 'Calcula comisin piramidal de un staff segn su rol y ventas de TODOS sus subordinados (recursivo).
   IMPORTANTE: Solo aplica para roles de VENTAS, NO para soporte.
   Parmetros: staff_id, mes (opcional), ao (opcional)';


--
-- Name: calculate_pyramid_commissions(uuid, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_pyramid_commissions(p_vendor_id uuid, p_base_amount numeric) RETURNS TABLE(vendor_id uuid, vendor_name character varying, level character varying, percentage numeric, amount numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_hierarchy RECORD;
  v_level_name VARCHAR;
  v_percentage DECIMAL;
  v_amount DECIMAL;
BEGIN
  -- Comisin directa (vendedor que cerr la venta)
  SELECT id, name, commission_percentage
  INTO v_hierarchy
  FROM aponnt_staff
  WHERE id = p_vendor_id;

  IF FOUND THEN
    vendor_id := v_hierarchy.id;
    vendor_name := v_hierarchy.name;
    level := 'DIRECT_SALES';
    percentage := v_hierarchy.commission_percentage;
    amount := p_base_amount * (v_hierarchy.commission_percentage / 100.0);
    RETURN NEXT;
  END IF;

  -- Comisiones piramidales (jerarqua ascendente)
  FOR v_hierarchy IN
    SELECT *
    FROM get_vendor_hierarchy(p_vendor_id)
    WHERE hierarchy_level > 0
    ORDER BY hierarchy_level ASC
  LOOP
    -- Calcular porcentaje segn nivel
    v_percentage := CASE v_hierarchy.hierarchy_level
      WHEN 1 THEN 5.0  -- Nivel 1 (supervisor directo): 5%
      WHEN 2 THEN 3.0  -- Nivel 2 (regional): 3%
      WHEN 3 THEN 2.0  -- Nivel 3 (gerente): 2%
      WHEN 4 THEN 1.0  -- Nivel 4 (director): 1%
      ELSE 0.0
    END;

    v_level_name := 'PYRAMID_L' || v_hierarchy.hierarchy_level::TEXT;
    v_amount := p_base_amount * (v_percentage / 100.0);

    vendor_id := v_hierarchy.staff_id;
    vendor_name := v_hierarchy.name;
    level := v_level_name;
    percentage := v_percentage;
    amount := v_amount;
    RETURN NEXT;
  END LOOP;
END;
$$;


--
-- Name: calculate_redemption_checkout_time(uuid, date, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_redemption_checkout_time(p_user_id uuid, p_scheduled_date date, p_hours_to_redeem numeric) RETURNS TABLE(shift_id uuid, shift_name character varying, normal_checkout time without time zone, adjusted_checkout time without time zone, hours_to_work numeric, hours_redeemed numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_shift RECORD;
    v_checkout INTERVAL;
BEGIN
    -- Obtener turno del empleado para ese da (via user_shifts)
    SELECT s.* INTO v_shift
    FROM shifts s
    JOIN user_shifts us ON us.shift_id = s.id
    WHERE us.user_id = p_user_id
    LIMIT 1;

    IF v_shift IS NULL THEN
        -- Sin turno asignado, usar horario default 9-18
        RETURN QUERY SELECT
            NULL::UUID,
            'Sin turno'::VARCHAR,
            '18:00'::TIME,
            ('18:00'::TIME - (p_hours_to_redeem || ' hours')::INTERVAL)::TIME,
            8.0::DECIMAL,
            p_hours_to_redeem;
        RETURN;
    END IF;

    -- Calcular hora de salida ajustada
    v_checkout := v_shift."endTime"::TIME - (p_hours_to_redeem || ' hours')::INTERVAL;

    RETURN QUERY SELECT
        v_shift.id,
        v_shift.name,
        v_shift."endTime"::TIME,
        v_checkout::TIME,
        EXTRACT(EPOCH FROM (v_shift."endTime"::TIME - v_shift."startTime"::TIME))/3600 - p_hours_to_redeem,
        p_hours_to_redeem;
END;
$$;


--
-- Name: calculate_renewal_alert_date(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_renewal_alert_date() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Calcular prxima fecha de alerta (30 das antes del vencimiento)
    IF NEW.end_date IS NOT NULL AND NEW.status IN ('ACTIVE', 'RENEWAL_PENDING') THEN
        NEW.next_renewal_alert_date := NEW.end_date - INTERVAL '30 days';
    END IF;

    -- Calcular grace_period_end si entra en grace period
    IF NEW.status = 'GRACE_PERIOD' AND NEW.grace_period_end IS NULL THEN
        NEW.grace_period_end := COALESCE(NEW.end_date, CURRENT_DATE) + INTERVAL '60 days';
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: calculate_response_confidence(integer, integer, integer, boolean); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_response_confidence(p_times_suggested integer, p_times_accepted integer, p_times_rejected integer, p_is_verified boolean) RETURNS numeric
    LANGUAGE plpgsql
    AS $$
DECLARE
    base_confidence DECIMAL(5,4);
    acceptance_rate DECIMAL(5,4);
    verification_bonus DECIMAL(5,4);
BEGIN
    -- Si no hay sugerencias, confianza base
    IF p_times_suggested = 0 THEN
        RETURN CASE WHEN p_is_verified THEN 0.8000 ELSE 0.5000 END;
    END IF;

    -- Calcular tasa de aceptacin
    acceptance_rate := p_times_accepted::DECIMAL / p_times_suggested::DECIMAL;

    -- Bonus por verificacin
    verification_bonus := CASE WHEN p_is_verified THEN 0.1500 ELSE 0.0000 END;

    -- Calcular confianza final (mximo 0.9999)
    base_confidence := LEAST(acceptance_rate + verification_bonus, 0.9999);

    -- Penalizar si hay muchos rechazos
    IF p_times_rejected > p_times_accepted THEN
        base_confidence := base_confidence * 0.7;
    END IF;

    RETURN GREATEST(base_confidence, 0.1000); -- Mnimo 0.1
END;
$$;


--
-- Name: calculate_sla_deadlines(integer, timestamp with time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_sla_deadlines(p_company_id integer, p_created_at timestamp with time zone) RETURNS TABLE(first_response_deadline timestamp with time zone, resolution_deadline timestamp with time zone, escalation_deadline timestamp with time zone)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_plan support_sla_plans%ROWTYPE;
BEGIN
  -- Obtener plan de SLA de la empresa
  SELECT sp.* INTO v_plan
  FROM companies c
  INNER JOIN support_sla_plans sp ON c.support_sla_plan_id = sp.plan_id
  WHERE c.company_id = p_company_id;

  -- Si no tiene plan, usar standard por defecto
  IF NOT FOUND THEN
    SELECT * INTO v_plan FROM support_sla_plans WHERE plan_name = 'standard';
  END IF;

  -- Calcular deadlines
  RETURN QUERY SELECT
    p_created_at + (v_plan.first_response_hours || ' hours')::INTERVAL,
    p_created_at + (v_plan.resolution_hours || ' hours')::INTERVAL,
    p_created_at + (v_plan.escalation_hours || ' hours')::INTERVAL;
END;
$$;


--
-- Name: FUNCTION calculate_sla_deadlines(p_company_id integer, p_created_at timestamp with time zone); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_sla_deadlines(p_company_id integer, p_created_at timestamp with time zone) IS 'Calcula los 3 deadlines de SLA segn el plan de la empresa';


--
-- Name: calculate_suspension_end_date(date, integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_suspension_end_date(p_start_date date, p_work_days integer, p_employee_id uuid DEFAULT NULL::uuid) RETURNS date
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_current_date DATE := p_start_date;
    v_days_counted INTEGER := 0;
    v_shift_days JSONB;
    v_day_of_week INTEGER;
    v_day_name TEXT;
BEGIN
    IF p_work_days <= 0 THEN
        RETURN p_start_date;
    END IF;

    -- Obtener das laborables del turno asignado al empleado
    IF p_employee_id IS NOT NULL THEN
        SELECT s.days::jsonb INTO v_shift_days
        FROM user_shift_assignments usa
        JOIN shifts s ON s.id = usa.shift_id
        WHERE usa.user_id = p_employee_id
          AND usa.is_active = true
          AND (usa.end_date IS NULL OR usa.end_date >= CURRENT_DATE)
        ORDER BY usa.start_date DESC
        LIMIT 1;
    END IF;

    -- Si no hay turno asignado, asumir L-V como das laborables
    IF v_shift_days IS NULL THEN
        v_shift_days := '{"monday": true, "tuesday": true, "wednesday": true, "thursday": true, "friday": true, "saturday": false, "sunday": false}'::jsonb;
    END IF;

    WHILE v_days_counted < p_work_days LOOP
        v_current_date := v_current_date + INTERVAL '1 day';
        v_day_of_week := EXTRACT(DOW FROM v_current_date)::INTEGER;

        -- Mapear da de semana a nombre (0=Sunday, 1=Monday, etc.)
        v_day_name := CASE v_day_of_week
            WHEN 0 THEN 'sunday'
            WHEN 1 THEN 'monday'
            WHEN 2 THEN 'tuesday'
            WHEN 3 THEN 'wednesday'
            WHEN 4 THEN 'thursday'
            WHEN 5 THEN 'friday'
            WHEN 6 THEN 'saturday'
        END;

        -- Verificar si es da laborable segn el turno
        IF COALESCE((v_shift_days->v_day_name)::boolean, false) THEN
            v_days_counted := v_days_counted + 1;
        END IF;
    END LOOP;

    RETURN v_current_date;
END;
$$;


--
-- Name: FUNCTION calculate_suspension_end_date(p_start_date date, p_work_days integer, p_employee_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_suspension_end_date(p_start_date date, p_work_days integer, p_employee_id uuid) IS 'Calcula fecha fin de suspensin contando solo das laborables segn el turno del empleado';


--
-- Name: calculate_vacation_days(integer, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_vacation_days(p_company_id integer, p_hire_date date) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_years DECIMAL(4,2);
    v_days INTEGER;
BEGIN
    -- Calcular aos de antigedad
    v_years := EXTRACT(YEAR FROM age(CURRENT_DATE, p_hire_date)) +
               (EXTRACT(MONTH FROM age(CURRENT_DATE, p_hire_date)) / 12.0);

    -- Buscar escala correspondiente
    SELECT vacation_days INTO v_days
    FROM vacation_scales
    WHERE company_id = p_company_id
      AND is_active = true
      AND years_from <= v_years
      AND (years_to IS NULL OR years_to > v_years)
    ORDER BY priority DESC
    LIMIT 1;

    RETURN COALESCE(v_days, 14); -- Default: 14 das
END;
$$;


--
-- Name: FUNCTION calculate_vacation_days(p_company_id integer, p_hire_date date); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.calculate_vacation_days(p_company_id integer, p_hire_date date) IS 'Calcula das de vacaciones segn antigedad del empleado';


--
-- Name: calculate_vicious_cycle_risk(integer, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_vicious_cycle_risk(p_company_id integer, p_user_id integer, p_months integer DEFAULT 6) RETURNS TABLE(hours_returned numeric, overtime_generated numeric, ratio numeric, risk_level character varying, is_vicious_cycle boolean, recommendation text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_hours_returned DECIMAL := 0;
    v_overtime_generated DECIMAL := 0;
    v_ratio DECIMAL := 0;
    v_risk_level VARCHAR := 'low';
    v_is_vicious BOOLEAN := false;
    v_recommendation TEXT := '';
BEGIN
    -- Obtener horas devueltas (usos del banco)
    SELECT COALESCE(SUM(ABS(hours_final)), 0)
    INTO v_hours_returned
    FROM hour_bank_transactions
    WHERE company_id = p_company_id
      AND user_id = p_user_id
      AND transaction_type = 'usage'
      AND created_at >= CURRENT_DATE - (p_months || ' months')::INTERVAL;

    -- Obtener horas extras generadas por esas ausencias
    -- (estimacion: si alguien uso banco, otro tuvo que cubrir con HE)
    SELECT COALESCE(SUM(return_impact_hours), 0)
    INTO v_overtime_generated
    FROM hour_bank_transactions
    WHERE company_id = p_company_id
      AND user_id = p_user_id
      AND transaction_type = 'usage'
      AND return_impact_hours > 0
      AND created_at >= CURRENT_DATE - (p_months || ' months')::INTERVAL;

    -- Calcular ratio
    IF v_hours_returned > 0 THEN
        v_ratio := v_overtime_generated / v_hours_returned;
    END IF;

    -- Determinar nivel de riesgo
    IF v_ratio >= 1.0 THEN
        v_risk_level := 'critical';
        v_is_vicious := true;
        v_recommendation := 'ALERTA CRITICA: Cada hora devuelta genera mas de 1 hora extra. Revisar distribucion de carga de trabajo.';
    ELSIF v_ratio >= 0.7 THEN
        v_risk_level := 'high';
        v_is_vicious := true;
        v_recommendation := 'Riesgo alto de ciclo vicioso. Considerar redistribuir turnos o contratar personal temporal.';
    ELSIF v_ratio >= 0.5 THEN
        v_risk_level := 'medium';
        v_recommendation := 'Riesgo moderado. Monitorear patrones de uso y cobertura.';
    ELSE
        v_risk_level := 'low';
        v_recommendation := 'Uso saludable del banco de horas.';
    END IF;

    RETURN QUERY SELECT
        v_hours_returned,
        v_overtime_generated,
        v_ratio,
        v_risk_level,
        v_is_vicious,
        v_recommendation;
END;
$$;


--
-- Name: calculate_violation_correlation(integer, text[], integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.calculate_violation_correlation(p_employee_id integer, p_violations text[], p_days_back integer DEFAULT 30) RETURNS TABLE(total_detections integer, matching_detections integer, correlation_score numeric, detection_ids uuid[])
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    COUNT(*)::INTEGER as total_detections,
    COUNT(*) FILTER (WHERE d.missing_ppe && p_violations)::INTEGER as matching_detections,
    CASE
      WHEN COUNT(*) > 0
      THEN ROUND((COUNT(*) FILTER (WHERE d.missing_ppe && p_violations)::DECIMAL / COUNT(*)::DECIMAL) * 100, 2)
      ELSE 0
    END as correlation_score,
    ARRAY_AGG(d.id) FILTER (WHERE d.missing_ppe && p_violations) as detection_ids
  FROM hse_ppe_detections d
  WHERE d.employee_id = p_employee_id
    AND d.detection_timestamp >= NOW() - (p_days_back || ' days')::INTERVAL;
END;
$$;


--
-- Name: can_delete_procedure(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.can_delete_procedure(p_procedure_id uuid) RETURNS TABLE(can_delete boolean, reason text, children_count bigint, children_preview jsonb)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_children_count BIGINT;
    v_children_preview JSONB;
BEGIN
    -- Contar hijos
    SELECT COUNT(*) INTO v_children_count
    FROM procedures WHERE parent_id = p_procedure_id;

    -- Si tiene hijos, obtener preview
    IF v_children_count > 0 THEN
        SELECT jsonb_agg(jsonb_build_object(
            'id', id,
            'code', code,
            'title', title,
            'type', type
        ))
        INTO v_children_preview
        FROM (
            SELECT id, code, title, type
            FROM procedures
            WHERE parent_id = p_procedure_id
            ORDER BY code
            LIMIT 10
        ) sub;

        RETURN QUERY SELECT
            false,
            format('No se puede eliminar: tiene %s documento(s) hijo(s). Elimine o reasigne los hijos primero.', v_children_count),
            v_children_count,
            v_children_preview;
    ELSE
        RETURN QUERY SELECT
            true,
            'El documento puede ser eliminado.'::TEXT,
            0::BIGINT,
            '[]'::JSONB;
    END IF;
END;
$$;


--
-- Name: can_partner_login(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.can_partner_login(p_partner_id integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_email_verified BOOLEAN;
    v_account_status partner_account_status;
    v_is_active BOOLEAN;
BEGIN
    SELECT email_verified, account_status, is_active
    INTO v_email_verified, v_account_status, v_is_active
    FROM partners
    WHERE partner_id = p_partner_id;

    -- Partner puede loguearse SOLO si:
    -- 1. Email verificado
    -- 2. Account status = 'active'
    -- 3. is_active = true
    RETURN v_email_verified = true
        AND v_account_status = 'active'::partner_account_status
        AND v_is_active = true;
END;
$$;


--
-- Name: FUNCTION can_partner_login(p_partner_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.can_partner_login(p_partner_id integer) IS 'Verifica si un partner puede iniciar sesin (email verificado + cuenta activa)';


--
-- Name: can_user_login(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.can_user_login(p_user_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_email_verified BOOLEAN;
    v_account_status user_account_status;
    v_is_active BOOLEAN;
BEGIN
    SELECT email_verified, account_status, is_active
    INTO v_email_verified, v_account_status, v_is_active
    FROM users
    WHERE user_id = p_user_id;

    -- Usuario puede loguearse SOLO si:
    -- 1. Email verificado
    -- 2. Account status = 'active'
    -- 3. is_active = true
    RETURN v_email_verified = true
        AND v_account_status = 'active'::user_account_status
        AND v_is_active = true;
END;
$$;


--
-- Name: FUNCTION can_user_login(p_user_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.can_user_login(p_user_id uuid) IS 'Verifica si un usuario puede iniciar sesin (email verificado + cuenta activa)';


--
-- Name: can_user_use_kiosk(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.can_user_use_kiosk(p_user_id uuid, p_kiosk_id integer) RETURNS boolean
    LANGUAGE plpgsql STABLE
    AS $$
DECLARE
    v_can_use_kiosk BOOLEAN;
    v_can_use_all_kiosks BOOLEAN;
    v_authorized_kiosks JSONB;
    v_result BOOLEAN := false;
BEGIN
    -- Obtener configuracin del usuario
    SELECT
        can_use_kiosk,
        can_use_all_kiosks,
        authorized_kiosks
    INTO
        v_can_use_kiosk,
        v_can_use_all_kiosks,
        v_authorized_kiosks
    FROM users
    WHERE user_id = p_user_id AND is_active = true;

    -- Si no puede usar kiosks en absoluto
    IF NOT v_can_use_kiosk THEN
        RETURN false;
    END IF;

    -- Si puede usar todos los kiosks
    IF v_can_use_all_kiosks THEN
        RETURN true;
    END IF;

    -- Verificar si est en la lista de kiosks autorizados
    IF v_authorized_kiosks ? p_kiosk_id::text THEN
        RETURN true;
    END IF;

    -- Verificar si el kiosk_id est en el array JSON
    IF v_authorized_kiosks @> to_jsonb(p_kiosk_id) THEN
        RETURN true;
    END IF;

    RETURN false;
END;
$$;


--
-- Name: check_attendance_company(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_attendance_company() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            DECLARE
                user_company_id INTEGER;
            BEGIN
                -- Obtener el company_id del usuario
                SELECT company_id INTO user_company_id
                FROM users
                WHERE user_id = NEW."UserId";

                -- Validar
                IF user_company_id IS NULL THEN
                    RAISE EXCEPTION 'User % does not exist', NEW."UserId";
                END IF;

                IF user_company_id != NEW.company_id THEN
                    RAISE EXCEPTION 'Multi-tenant violation: Attendance company_id (%) does not match user company_id (%)',
                        NEW.company_id, user_company_id;
                END IF;

                RETURN NEW;
            END;
            $$;


--
-- Name: check_budget_availability(integer, integer, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_budget_availability(p_company_id integer, p_branch_id integer DEFAULT NULL::integer, p_hours_requested numeric DEFAULT 0) RETURNS TABLE(budget_exists boolean, total_budget numeric, allocated numeric, used numeric, available numeric, can_allocate boolean, alert_level character varying, message text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_budget RECORD;
    v_new_allocated DECIMAL;
    v_pct_used DECIMAL;
BEGIN
    -- Buscar presupuesto activo
    SELECT * INTO v_budget
    FROM hour_bank_budgets
    WHERE company_id = p_company_id
      AND (branch_id = p_branch_id OR (branch_id IS NULL AND p_branch_id IS NULL))
      AND status = 'active'
      AND CURRENT_DATE BETWEEN period_start AND period_end
    ORDER BY branch_id NULLS LAST
    LIMIT 1;

    IF v_budget IS NULL THEN
        RETURN QUERY SELECT
            false, 0::DECIMAL, 0::DECIMAL, 0::DECIMAL, 0::DECIMAL,
            true, 'none'::VARCHAR, 'No hay presupuesto configurado - sin limites'::TEXT;
        RETURN;
    END IF;

    v_new_allocated := v_budget.allocated_hours + p_hours_requested;
    v_pct_used := (v_new_allocated / v_budget.budget_hours) * 100;

    RETURN QUERY SELECT
        true,
        v_budget.budget_hours,
        v_budget.allocated_hours,
        v_budget.used_hours,
        v_budget.available_hours,
        v_new_allocated <= v_budget.budget_hours,
        CASE
            WHEN v_pct_used >= 95 THEN 'critical'
            WHEN v_pct_used >= 80 THEN 'warning'
            ELSE 'normal'
        END::VARCHAR,
        CASE
            WHEN v_new_allocated > v_budget.budget_hours THEN
                'Presupuesto excedido. Disponible: ' || v_budget.available_hours || 'h'
            WHEN v_pct_used >= 95 THEN
                'Presupuesto al ' || ROUND(v_pct_used) || '%. Quedan ' || v_budget.available_hours || 'h'
            WHEN v_pct_used >= 80 THEN
                'Alerta: Presupuesto al ' || ROUND(v_pct_used) || '%'
            ELSE
                'OK. Presupuesto disponible: ' || v_budget.available_hours || 'h'
        END::TEXT;
END;
$$;


--
-- Name: check_email_limits(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_email_limits(p_company_id integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_config RECORD;
BEGIN
    SELECT
        daily_limit,
        monthly_limit,
        current_daily_count,
        current_monthly_count
    INTO v_config
    FROM email_configurations
    WHERE company_id = p_company_id
    AND is_active = true;

    IF NOT FOUND THEN
        RETURN false;
    END IF;

    -- Verificar lmites
    IF v_config.current_daily_count >= v_config.daily_limit THEN
        RETURN false;
    END IF;

    IF v_config.current_monthly_count >= v_config.monthly_limit THEN
        RETURN false;
    END IF;

    RETURN true;
END;
$$;


--
-- Name: check_missing_acuse(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_missing_acuse() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Si el documento espera respuesta y pas el deadline sin recibirla
    IF NEW.expects_response = true
       AND NEW.response_received = false
       AND NEW.response_deadline < CURRENT_DATE THEN

        INSERT INTO legal_document_alerts (document_id, case_id, company_id, alert_type, message, severity, due_date)
        SELECT NEW.id, NEW.case_id, lc.company_id, 'missing_acuse',
               'Falta acuse de recibo/respuesta para: ' || NEW.title,
               'warning', NEW.response_deadline
        FROM legal_cases lc WHERE lc.id = NEW.case_id
        ON CONFLICT DO NOTHING;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: check_module_dependencies(character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_module_dependencies(p_module_key character varying, p_company_id integer) RETURNS TABLE(is_ready boolean, missing_dependencies jsonb, warnings jsonb)
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_module RECORD;
    v_prereqs JSONB;
    v_missing JSONB := '[]';
    v_warnings JSONB := '[]';
    v_table_name TEXT;
    v_min_records INTEGER;
    v_actual_count INTEGER;
BEGIN
    -- Obtener definicin del mdulo
    SELECT * INTO v_module FROM module_definitions WHERE module_key = p_module_key;

    IF v_module IS NULL THEN
        RETURN QUERY SELECT false, '["Mdulo no encontrado"]'::JSONB, '[]'::JSONB;
        RETURN;
    END IF;

    v_prereqs := v_module.prerequisite_data;

    -- Verificar tablas requeridas con registros mnimos
    IF v_prereqs ? 'required_tables' AND v_prereqs ? 'min_records' THEN
        FOR v_table_name IN SELECT jsonb_array_elements_text(v_prereqs->'required_tables')
        LOOP
            v_min_records := COALESCE((v_prereqs->'min_records'->>v_table_name)::INTEGER, 1);

            -- Contar registros de la tabla
            EXECUTE format('SELECT COUNT(*) FROM %I WHERE company_id = $1', v_table_name)
            INTO v_actual_count
            USING p_company_id;

            IF v_actual_count < v_min_records THEN
                v_missing := v_missing || jsonb_build_object(
                    'table', v_table_name,
                    'required', v_min_records,
                    'actual', v_actual_count,
                    'message', format('Necesitas al menos %s registro(s) en %s', v_min_records, v_table_name)
                );
            END IF;
        END LOOP;
    END IF;

    -- Verificar si requiere asociado de cierta categora
    IF v_prereqs ? 'associate_category' THEN
        SELECT COUNT(*) INTO v_actual_count
        FROM company_associate_contracts cac
        JOIN aponnt_associates aa ON aa.id = cac.associate_id
        WHERE cac.company_id = p_company_id
          AND cac.status = 'active'
          AND aa.category::TEXT = v_prereqs->>'associate_category';

        IF v_actual_count = 0 THEN
            v_warnings := v_warnings || jsonb_build_object(
                'type', 'associate_required',
                'category', v_prereqs->>'associate_category',
                'message', format('Para funcionalidad completa, contrata un %s desde Servicios Profesionales', v_prereqs->>'associate_category')
            );
        END IF;
    END IF;

    RETURN QUERY SELECT
        jsonb_array_length(v_missing) = 0,
        v_missing,
        v_warnings;
END;
$_$;


--
-- Name: check_screening_expiration(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_screening_expiration() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF NEW.valid_until < CURRENT_DATE THEN
        -- Send notification (implementation would go here)
        RAISE NOTICE 'Screening % has expired', NEW.id;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: check_shift_assignment_company(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_shift_assignment_company() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            DECLARE
                user_company_id INTEGER;
                shift_company_id INTEGER;
            BEGIN
                -- Obtener company_id del usuario
                SELECT company_id INTO user_company_id
                FROM users WHERE user_id = NEW.user_id;

                -- Obtener company_id del turno
                SELECT company_id INTO shift_company_id
                FROM shifts WHERE id = NEW.shift_id;

                -- Validar
                IF user_company_id IS NULL OR shift_company_id IS NULL THEN
                    RAISE EXCEPTION 'User or Shift does not exist';
                END IF;

                IF user_company_id != shift_company_id THEN
                    RAISE EXCEPTION 'Multi-tenant violation: User company (%) does not match shift company (%)',
                        user_company_id, shift_company_id;
                END IF;

                RETURN NEW;
            END;
            $$;


--
-- Name: check_unique_active_template_v2(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_unique_active_template_v2() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
      BEGIN
        IF NEW.is_current_version = true AND NEW.is_enabled = true THEN
          IF EXISTS (
            SELECT 1 FROM hour_bank_templates
            WHERE company_id = NEW.company_id
              AND COALESCE(branch_id, -1) = COALESCE(NEW.branch_id, -1)
              AND is_current_version = true
              AND is_enabled = true
              AND id != COALESCE(NEW.id, -1)
          ) THEN
            RAISE EXCEPTION 'Ya existe plantilla activa para esta sucursal';
          END IF;
        END IF;
        RETURN NEW;
      END;
      $$;


--
-- Name: check_user_access(uuid, integer, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_user_access(p_user_id uuid, p_company_id integer, p_module_key character varying, p_action character varying DEFAULT 'read'::character varying) RETURNS TABLE(allowed boolean, scope character varying, reason text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_permissions JSONB;
    v_module_perms JSONB;
    v_user_role VARCHAR;
BEGIN
    -- Obtener rol del usuario de la tabla users
    SELECT role INTO v_user_role FROM users WHERE user_id = p_user_id;

    -- Super admin siempre tiene acceso
    IF v_user_role = 'super_admin' THEN
        RETURN QUERY SELECT true, 'all'::VARCHAR, 'super_admin_access'::TEXT;
        RETURN;
    END IF;

    -- Obtener permisos efectivos
    v_permissions := get_user_effective_permissions(p_user_id, p_company_id);

    -- Verificar permiso wildcard
    IF v_permissions ? '*' THEN
        v_module_perms := v_permissions->'*';
        IF v_module_perms->'actions' ? p_action OR v_module_perms->'actions' ? '*' THEN
            RETURN QUERY SELECT true, (v_module_perms->>'scope')::VARCHAR, 'wildcard_permission'::TEXT;
            RETURN;
        END IF;
    END IF;

    -- Verificar permiso especfico del mdulo
    IF v_permissions ? p_module_key THEN
        v_module_perms := v_permissions->p_module_key;
        IF v_module_perms->'actions' ? p_action THEN
            RETURN QUERY SELECT true, (v_module_perms->>'scope')::VARCHAR, 'module_permission'::TEXT;
            RETURN;
        END IF;
    END IF;

    -- Sin permiso
    RETURN QUERY SELECT false, NULL::VARCHAR, 'no_permission'::TEXT;
END;
$$;


--
-- Name: check_user_department_company(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_user_department_company() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            DECLARE
                dept_company_id INTEGER;
            BEGIN
                -- Si department_id es NULL, permitir
                IF NEW.department_id IS NULL THEN
                    RETURN NEW;
                END IF;

                -- Obtener el company_id del departamento
                SELECT company_id INTO dept_company_id
                FROM departments
                WHERE id = NEW.department_id;

                -- Si el departamento no existe, fallar
                IF dept_company_id IS NULL THEN
                    RAISE EXCEPTION 'Department % does not exist', NEW.department_id;
                END IF;

                -- Validar que el company_id del usuario coincida con el del departamento
                IF dept_company_id != NEW.company_id THEN
                    RAISE EXCEPTION 'Multi-tenant violation: User company_id (%) does not match department company_id (%). Users can only be assigned to departments of their own company.',
                        NEW.company_id, dept_company_id;
                END IF;

                RETURN NEW;
            END;
            $$;


--
-- Name: check_user_shift_on_activate(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_user_shift_on_activate() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    has_shift BOOLEAN;
    company_requires_shift BOOLEAN;
BEGIN
    -- Solo verificar cuando se activa un usuario (role=employee)
    IF NEW."isActive" = true AND NEW.role = 'employee' THEN
        -- Verificar si la empresa requiere turno obligatorio (configurable)
        SELECT COALESCE(
            (SELECT (config->>'require_shift_assignment')::boolean
             FROM companies
             WHERE company_id = NEW.company_id),
            false
        ) INTO company_requires_shift;

        IF company_requires_shift THEN
            -- Verificar si tiene turno asignado
            SELECT EXISTS (
                SELECT 1 FROM user_shifts
                WHERE user_id = NEW.user_id
            ) INTO has_shift;

            IF NOT has_shift THEN
                RAISE WARNING 'Usuario % (%) activado sin turno asignado. Se recomienda asignar turno.',
                    NEW."firstName" || ' ' || NEW."lastName", NEW.user_id;
                -- Por ahora solo WARNING, no bloquear
                -- Si quieres bloquear: RAISE EXCEPTION '...'
            END IF;
        END IF;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: check_vacation_conflicts(integer, uuid, date, date, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.check_vacation_conflicts(p_company_id integer, p_user_id uuid, p_start_date date, p_end_date date, p_exclude_request_id integer DEFAULT NULL::integer) RETURNS TABLE(conflict_id integer, conflict_user_id uuid, conflict_start date, conflict_end date, overlap_days integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        vr.id,
        vr.user_id,
        vr.start_date,
        vr.end_date,
        (LEAST(vr.end_date, p_end_date) - GREATEST(vr.start_date, p_start_date) + 1)::INTEGER
    FROM vacation_requests vr
    WHERE vr.company_id = p_company_id
      AND vr.status IN ('pending', 'approved', 'active')
      AND vr.start_date <= p_end_date
      AND vr.end_date >= p_start_date
      AND (p_exclude_request_id IS NULL OR vr.id != p_exclude_request_id);
END;
$$;


--
-- Name: FUNCTION check_vacation_conflicts(p_company_id integer, p_user_id uuid, p_start_date date, p_end_date date, p_exclude_request_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.check_vacation_conflicts(p_company_id integer, p_user_id uuid, p_start_date date, p_end_date date, p_exclude_request_id integer) IS 'Verifica conflictos de fechas con otras solicitudes de vacaciones';


--
-- Name: cleanup_expired_drafts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_drafts() RETURNS TABLE(deleted_count integer, deleted_procedures jsonb)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_deleted JSONB;
    v_count INTEGER;
BEGIN
    -- Obtener lista de borradores a eliminar
    SELECT jsonb_agg(jsonb_build_object(
        'id', id,
        'code', code,
        'title', title,
        'company_id', company_id,
        'created_by', created_by,
        'draft_expires_at', draft_expires_at
    ))
    INTO v_deleted
    FROM procedures
    WHERE status = 'draft'
      AND draft_expires_at IS NOT NULL
      AND draft_expires_at < NOW();

    -- Eliminar borradores expirados
    DELETE FROM procedures
    WHERE status = 'draft'
      AND draft_expires_at IS NOT NULL
      AND draft_expires_at < NOW();

    GET DIAGNOSTICS v_count = ROW_COUNT;

    RETURN QUERY SELECT v_count, COALESCE(v_deleted, '[]'::jsonb);
END;
$$;


--
-- Name: cleanup_expired_emotional_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_emotional_data() RETURNS integer
    LANGUAGE plpgsql
    AS $$
      DECLARE
          deleted_count INTEGER := 0;
          temp_count INTEGER;
      BEGIN
          -- Eliminar anlisis de usuarios SIN consentimiento activo
          DELETE FROM biometric_emotional_analysis e
          WHERE NOT EXISTS (
              SELECT 1 FROM biometric_consents c
              WHERE c.user_id = e.user_id
                AND c.company_id = e.company_id
                AND c.consent_type = 'emotional_analysis'
                AND c.revoked = FALSE
                AND (c.expires_at IS NULL OR c.expires_at > NOW())
          );

          GET DIAGNOSTICS deleted_count := ROW_COUNT;

          -- Eliminar anlisis > 90 das (retencin mxima)
          DELETE FROM biometric_emotional_analysis
          WHERE scan_timestamp < NOW() - INTERVAL '90 days';

          GET DIAGNOSTICS temp_count := ROW_COUNT;
          deleted_count := deleted_count + temp_count;

          RETURN deleted_count;
      END;
      $$;


--
-- Name: cleanup_expired_verification_tokens(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_expired_verification_tokens() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM email_verification_tokens
    WHERE is_verified = FALSE
      AND expires_at < NOW() - INTERVAL '7 days';

    GET DIAGNOSTICS deleted_count = ROW_COUNT;

    RETURN deleted_count;
END;
$$;


--
-- Name: FUNCTION cleanup_expired_verification_tokens(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.cleanup_expired_verification_tokens() IS 'Limpia tokens expirados no verificados con ms de 7 das de antigedad';


--
-- Name: cleanup_old_biometric_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_biometric_data() RETURNS integer
    LANGUAGE plpgsql
    AS $$
      DECLARE
          deleted_count INTEGER := 0;
          partition_name TEXT;
      BEGIN
          FOR partition_name IN
              SELECT schemaname||'.'||tablename
              FROM pg_tables
              WHERE schemaname = 'biometric_partitions'
              AND tablename LIKE 'biometric_scans_p%'
          LOOP
              EXECUTE format('
                  DELETE FROM %s
                  WHERE created_at < NOW() - INTERVAL ''2 years''',
                  partition_name
              );
              GET DIAGNOSTICS deleted_count = ROW_COUNT;
          END LOOP;

          RETURN deleted_count;
      END;
      $$;


--
-- Name: cleanup_old_biometric_scans(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_biometric_scans() RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Eliminar scans ms antiguos que retention_days segn configuracin de empresa
    DELETE FROM biometric_scans bs
    USING biometric_company_config bcc
    WHERE bs.company_id = bcc.company_id
    AND bs.created_at < NOW() - INTERVAL '1 day' * bcc.retention_days;

    RAISE NOTICE 'Cleanup de scans biomtricos completado';
END;
$$;


--
-- Name: cleanup_old_test_executions(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_old_test_executions() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    deleted_count INTEGER;
BEGIN
    DELETE FROM test_executions
    WHERE created_at < NOW() - INTERVAL '30 days'
    AND status IN ('completed', 'failed', 'killed', 'error');

    GET DIAGNOSTICS deleted_count = ROW_COUNT;

    RETURN deleted_count;
END;
$$;


--
-- Name: cleanup_sesiones_inactivas(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.cleanup_sesiones_inactivas() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    sesiones_cerradas INTEGER := 0;
BEGIN
    -- Cerrar sesiones inactivas (ms de 2 horas sin actividad)
    UPDATE siac_sesiones_locales
    SET
        is_active = false,
        updated_at = CURRENT_TIMESTAMP,
        configuracion_local = configuracion_local || '{"motivo_cierre": "timeout_inactividad", "fecha_cierre": "' || CURRENT_TIMESTAMP || '"}'
    WHERE
        is_active = true
        AND last_activity < (CURRENT_TIMESTAMP - INTERVAL '2 hours');

    GET DIAGNOSTICS sesiones_cerradas = ROW_COUNT;

    RETURN sesiones_cerradas;
END;
$$;


--
-- Name: company_has_email_configured(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.company_has_email_configured(p_company_id integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN EXISTS (
        SELECT 1 FROM email_configurations
        WHERE company_id = p_company_id
        AND is_active = true
        AND is_verified = true
    );
END;
$$;


--
-- Name: count_procedure_scope_users(integer, public.procedure_scope_type, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.count_procedure_scope_users(p_company_id integer, p_scope_type public.procedure_scope_type, p_scope_entities jsonb) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_count INTEGER;
BEGIN
    SELECT COUNT(DISTINCT u.user_id)
    INTO v_count
    FROM users u
    LEFT JOIN departments d ON u.department_id = d.id
    LEFT JOIN organizational_positions op ON u.organizational_position_id = op.id
    LEFT JOIN branches b ON u.branch_id = b.id
    LEFT JOIN sectors s ON u.sector_id = s.id
    WHERE u.company_id = p_company_id
      AND u.is_active = true
      AND (
        (p_scope_type = 'company')
        OR
        (p_scope_type = 'branch' AND u.branch_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(p_scope_entities) AS value
        ))
        OR
        (p_scope_type = 'department' AND u.department_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(p_scope_entities) AS value
        ))
        OR
        (p_scope_type = 'sector' AND u.sector_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(p_scope_entities) AS value
        ))
        OR
        (p_scope_type = 'role' AND u.role IN (
            SELECT value->>'id' FROM jsonb_array_elements(p_scope_entities) AS value
        ))
        OR
        (p_scope_type = 'position' AND u.organizational_position_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(p_scope_entities) AS value
        ))
        OR
        (p_scope_type = 'users' AND u.user_id IN (
            SELECT (value->>'id')::UUID FROM jsonb_array_elements(p_scope_entities) AS value
        ))
      );

    RETURN v_count;
END;
$$;


--
-- Name: create_account_notification(integer, character varying, character varying, text, character varying, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_account_notification(p_company_id integer, p_type character varying, p_title character varying, p_message text DEFAULT NULL::text, p_ref_type character varying DEFAULT NULL::character varying, p_ref_id character varying DEFAULT NULL::character varying, p_priority character varying DEFAULT 'normal'::character varying) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_id INTEGER;
BEGIN
    INSERT INTO company_account_notifications (
        company_id, notification_type, title, message,
        reference_type, reference_id, priority
    ) VALUES (
        p_company_id, p_type, p_title, p_message,
        p_ref_type, p_ref_id, p_priority
    ) RETURNING id INTO v_id;
    RETURN v_id;
END;
$$;


--
-- Name: create_commercial_notification(integer, character varying, character varying, character varying, character varying, character varying, character varying, text, character varying, character varying, character varying, character varying, uuid, character varying, character varying, uuid, boolean, character varying, timestamp without time zone, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_commercial_notification(p_company_id integer, p_direction character varying, p_origin_type character varying, p_origin_name character varying, p_recipient_type character varying, p_recipient_name character varying, p_title character varying, p_message text, p_notification_type character varying, p_module character varying DEFAULT 'onboarding'::character varying, p_priority character varying DEFAULT 'medium'::character varying, p_trace_id character varying DEFAULT NULL::character varying, p_vendor_id uuid DEFAULT NULL::uuid, p_external_email character varying DEFAULT NULL::character varying, p_aponnt_department character varying DEFAULT NULL::character varying, p_thread_id uuid DEFAULT NULL::uuid, p_requires_action boolean DEFAULT false, p_action_type character varying DEFAULT NULL::character varying, p_response_required_by timestamp without time zone DEFAULT NULL::timestamp without time zone, p_metadata jsonb DEFAULT '{}'::jsonb) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_notification_id UUID;
    v_thread_id UUID;
    v_sequence INTEGER;
BEGIN
    -- Determinar thread_id
    IF p_thread_id IS NOT NULL THEN
        v_thread_id := p_thread_id;
        -- Obtener siguiente secuencia
        SELECT COALESCE(MAX(sequence_in_thread), 0) + 1 INTO v_sequence
        FROM unified_notifications WHERE thread_id = v_thread_id;
    ELSE
        v_thread_id := gen_random_uuid();
        v_sequence := 1;
    END IF;

    -- Insertar notificacin
    INSERT INTO unified_notifications (
        company_id,
        thread_id,
        sequence_in_thread,
        direction,
        origin_type,
        origin_name,
        recipient_type,
        recipient_name,
        external_email,
        title,
        message,
        short_message,
        notification_type,
        module,
        category,
        priority,
        trace_id,
        vendor_id,
        aponnt_department,
        is_commercial,
        requires_action,
        action_type,
        action_status,
        response_required_by,
        metadata,
        channels,
        created_at
    ) VALUES (
        p_company_id,
        v_thread_id,
        v_sequence,
        p_direction,
        p_origin_type,
        p_origin_name,
        p_recipient_type,
        p_recipient_name,
        p_external_email,
        p_title,
        p_message,
        LEFT(p_message, 280),
        p_notification_type,
        p_module,
        'commercial',
        p_priority,
        p_trace_id,
        p_vendor_id,
        p_aponnt_department,
        TRUE,
        p_requires_action,
        p_action_type,
        CASE WHEN p_requires_action THEN 'pending' ELSE NULL END,
        p_response_required_by,
        p_metadata,
        '["app", "email"]'::jsonb,
        NOW()
    ) RETURNING id INTO v_notification_id;

    -- Si es nuevo thread, crear entrada en notification_threads
    IF p_thread_id IS NULL THEN
        INSERT INTO notification_threads (
            id,
            company_id,
            subject,
            category,
            module,
            thread_type,
            initiator_type,
            initiator_name,
            status,
            priority,
            message_count,
            commercial_flow,
            trace_id,
            vendor_id,
            external_email,
            created_at,
            last_message_at
        ) VALUES (
            v_thread_id,
            p_company_id,
            p_title,
            'commercial',
            p_module,
            CASE
                WHEN p_notification_type LIKE 'budget%' THEN 'quote'
                WHEN p_notification_type LIKE 'contract%' THEN 'contract'
                WHEN p_notification_type LIKE 'invoice%' THEN 'invoice'
                ELSE 'communication'
            END,
            p_origin_type,
            p_origin_name,
            'open',
            p_priority,
            1,
            'onboarding',
            p_trace_id,
            p_vendor_id,
            p_external_email,
            NOW(),
            NOW()
        );
    ELSE
        -- Actualizar thread existente
        UPDATE notification_threads
        SET message_count = message_count + 1,
            last_message_at = NOW(),
            updated_at = NOW()
        WHERE id = v_thread_id;
    END IF;

    RETURN v_notification_id;
END;
$$;


--
-- Name: FUNCTION create_commercial_notification(p_company_id integer, p_direction character varying, p_origin_type character varying, p_origin_name character varying, p_recipient_type character varying, p_recipient_name character varying, p_title character varying, p_message text, p_notification_type character varying, p_module character varying, p_priority character varying, p_trace_id character varying, p_vendor_id uuid, p_external_email character varying, p_aponnt_department character varying, p_thread_id uuid, p_requires_action boolean, p_action_type character varying, p_response_required_by timestamp without time zone, p_metadata jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.create_commercial_notification(p_company_id integer, p_direction character varying, p_origin_type character varying, p_origin_name character varying, p_recipient_type character varying, p_recipient_name character varying, p_title character varying, p_message text, p_notification_type character varying, p_module character varying, p_priority character varying, p_trace_id character varying, p_vendor_id uuid, p_external_email character varying, p_aponnt_department character varying, p_thread_id uuid, p_requires_action boolean, p_action_type character varying, p_response_required_by timestamp without time zone, p_metadata jsonb) IS 'Crea una notificacin comercial en el SSOT unificado';


--
-- Name: create_core_user_for_company(integer, character varying, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_core_user_for_company(p_company_id integer, p_onboarding_trace_id character varying, p_created_by uuid DEFAULT NULL::uuid) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_user_id UUID;
  v_default_password VARCHAR := 'admin123'; -- Password inicial (debe cambiarse)
  v_password_hash VARCHAR;
BEGIN
  -- Verificar que no exista ya un usuario CORE
  IF EXISTS (SELECT 1 FROM users WHERE company_id = p_company_id AND is_core_user = TRUE) THEN
    RAISE EXCEPTION 'Company already has a CORE user';
  END IF;

  -- Generar hash del password (asumiendo bcrypt con 10 rounds)
  -- En produccin esto debera usar la funcin de hash que uses en el backend
  v_password_hash := crypt(v_default_password, gen_salt('bf', 10));

  -- Crear usuario CORE
  INSERT INTO users (
    company_id,
    usuario,
    password,
    email,
    role,
    is_core_user,
    force_password_change,
    core_user_created_at,
    onboarding_trace_id,
    is_active,
    "createdAt"
  )
  VALUES (
    p_company_id,
    'administrador',
    v_password_hash,
    (SELECT contact_email FROM companies WHERE company_id = p_company_id),
    'admin',
    TRUE,
    TRUE, -- Debe cambiar password en primer login
    CURRENT_TIMESTAMP,
    p_onboarding_trace_id,
    TRUE,
    CURRENT_TIMESTAMP
  )
  RETURNING id INTO v_user_id;

  -- Log de auditora
  INSERT INTO audit_logs (
    trace_id,
    action,
    entity_type,
    entity_id,
    performed_by,
    details,
    created_at
  )
  VALUES (
    p_onboarding_trace_id,
    'CREATE_CORE_USER',
    'user',
    v_user_id,
    p_created_by,
    jsonb_build_object(
      'company_id', p_company_id,
      'usuario', 'administrador',
      'is_core_user', true,
      'force_password_change', true
    ),
    CURRENT_TIMESTAMP
  );

  RETURN v_user_id;
END;
$$;


--
-- Name: create_default_hour_bank_templates(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_default_hour_bank_templates(p_company_id integer) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- ARGENTINA - Basado en LCT y reforma laboral 2024
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, choice_timeout_hours,
        requires_written_agreement, legal_reference
    ) VALUES (
        p_company_id, 'ARG', 'ARG-DEFAULT', 'Argentina - Ley de Contrato de Trabajo',
        'Configuracion basada en LCT Arts. 201-207. Horas extras con recargo 50% dias normales, 100% feriados.',
        1.50, 2.00, 2.00, 1.08,
        200, 30, 12,
        true, 'bank', 24,
        true, 'LCT Arts. 201-207, Reforma 2024'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- BRASIL - Basado en CLT y reforma 2017
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, choice_timeout_hours,
        requires_written_agreement, union_agreement_required, legal_reference
    ) VALUES (
        p_company_id, 'BRA', 'BRA-CLT-INDIVIDUAL', 'Brasil - Acordo Individual Escrito (12 meses)',
        'Banco de horas por acordo individual escrito. Compensacao em ate 12 meses. CLT Art. 59 reformado.',
        1.00, 1.50, 2.00, 1.20,
        120, 44, 12,
        false, 'bank', 0,
        true, false, 'CLT Art. 59, Lei 13.467/2017'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, choice_timeout_hours,
        requires_written_agreement, union_agreement_required, legal_reference
    ) VALUES (
        p_company_id, 'BRA', 'BRA-CLT-VERBAL', 'Brasil - Acordo Verbal (6 meses)',
        'Banco de horas por acordo verbal. Compensacao em ate 6 meses.',
        1.00, 1.50, 2.00, 1.20,
        60, 44, 6,
        false, 'bank', 0,
        false, false, 'CLT Art. 59 par. 5'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- URUGUAY
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, legal_reference
    ) VALUES (
        p_company_id, 'URY', 'URY-DEFAULT', 'Uruguay - Ley 18.441',
        'Jornada laboral 8h/dia, 44-48h/semana. HE con 100% recargo.',
        2.00, 2.00, 2.50, 1.20,
        96, 24, 12,
        true, 'bank', 'Ley 18.441, Decreto 550/989'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- CHILE
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, legal_reference
    ) VALUES (
        p_company_id, 'CHL', 'CHL-DEFAULT', 'Chile - Codigo del Trabajo',
        'HE max 2h/dia con 50% recargo. Descanso compensatorio obligatorio para dominicales.',
        1.50, 1.50, 2.00, 1.30,
        90, 20, 6,
        true, 'bank', 'CT Arts. 30-32'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- MEXICO
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, legal_reference
    ) VALUES (
        p_company_id, 'MEX', 'MEX-LFT', 'Mexico - Ley Federal del Trabajo',
        'HE: 100% primeras 9h/semana, 200% adicionales. Triple en dias de descanso obligatorio.',
        2.00, 2.00, 3.00, 1.35,
        100, 27, 12,
        true, 'bank', 'LFT Arts. 66-68'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- ESPANA
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, legal_reference
    ) VALUES (
        p_company_id, 'ESP', 'ESP-ET', 'Espana - Estatuto de los Trabajadores',
        'Max 80 HE/ano. Compensacion por tiempo libre dentro de 4 meses o segun convenio.',
        1.00, 1.00, 1.75, 1.25,
        80, 10, 4,
        true, 'bank', 'ET Art. 35'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

    -- ALEMANIA
    INSERT INTO hour_bank_templates (
        company_id, country_code, template_code, template_name, description,
        conversion_rate_normal, conversion_rate_weekend, conversion_rate_holiday, conversion_rate_night,
        max_accumulation_hours, max_monthly_accrual, expiration_months,
        employee_choice_enabled, default_action, legal_reference
    ) VALUES (
        p_company_id, 'DEU', 'DEU-ARBZG', 'Alemania - Arbeitszeitgesetz',
        'Cuenta de tiempo flexible. Max +150h/-30h anuales. Compensacion dominical en 8 semanas.',
        1.00, 1.25, 1.50, 1.25,
        150, 20, 12,
        false, 'bank', 'ArbZG, AEntG'
    ) ON CONFLICT (company_id, template_code) WHERE is_current_version = true DO NOTHING;

END;
$$;


--
-- Name: create_employee_liquidation_snapshot(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_employee_liquidation_snapshot(p_user_id uuid) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_snapshot JSONB;
    v_user RECORD;
    v_position RECORD;
    v_department RECORD;
    v_branch RECORD;
    v_assignment RECORD;
    v_template RECORD;
    v_category RECORD;
    v_payslip_template RECORD;
BEGIN
    -- Obtener datos del usuario
    SELECT
        u.user_id,
        u.employee_id AS employee_code,
        CONCAT(u.first_name, ' ', u.last_name) AS full_name,
        u.document_number,
        u.organizational_position_id,
        u.department_id,
        u.branch_id,
        u.hire_date
    INTO v_user
    FROM users u
    WHERE u.user_id = p_user_id;

    IF NOT FOUND THEN
        RETURN '{}'::JSONB;
    END IF;

    -- Obtener posicin/cargo
    IF v_user.organizational_position_id IS NOT NULL THEN
        SELECT
            op.id,
            op.position_code AS code,
            op.position_name AS name,
            op.payslip_template_id,
            op.payroll_template_id
        INTO v_position
        FROM organizational_positions op
        WHERE op.id = v_user.organizational_position_id;
    END IF;

    -- Obtener departamento
    IF v_user.department_id IS NOT NULL THEN
        SELECT
            d.id,
            d.department_name AS name
        INTO v_department
        FROM departments d
        WHERE d.id = v_user.department_id;
    END IF;

    -- Obtener sucursal
    IF v_user.branch_id IS NOT NULL THEN
        SELECT
            b.id,
            b.branch_name AS name
        INTO v_branch
        FROM company_branches b
        WHERE b.id = v_user.branch_id;
    END IF;

    -- Obtener asignacin de payroll activa
    SELECT
        upa.id,
        upa.template_id,
        upa.category_id,
        upa.base_salary,
        upa.hourly_rate
    INTO v_assignment
    FROM user_payroll_assignment upa
    WHERE upa.user_id = p_user_id
    AND upa.is_current = true
    AND (upa.effective_to IS NULL OR upa.effective_to >= CURRENT_DATE)
    ORDER BY upa.effective_from DESC
    LIMIT 1;

    -- Obtener template de liquidacin
    IF v_assignment.template_id IS NOT NULL THEN
        SELECT
            pt.id,
            pt.template_code AS code,
            pt.template_name AS name
        INTO v_template
        FROM payroll_templates pt
        WHERE pt.id = v_assignment.template_id;
    END IF;

    -- Obtener categora salarial
    IF v_assignment.category_id IS NOT NULL THEN
        SELECT
            sc.id,
            sc.category_name AS name,
            sc.level_number AS level
        INTO v_category
        FROM salary_categories_v2 sc
        WHERE sc.id = v_assignment.category_id;
    END IF;

    -- Construir snapshot
    v_snapshot := jsonb_build_object(
        'employee_code', v_user.employee_code,
        'full_name', v_user.full_name,
        'document_number', v_user.document_number,
        'position', CASE WHEN v_position.id IS NOT NULL THEN
            jsonb_build_object(
                'id', v_position.id,
                'code', v_position.code,
                'name', v_position.name
            )
        ELSE NULL END,
        'department', CASE WHEN v_department.id IS NOT NULL THEN
            jsonb_build_object(
                'id', v_department.id,
                'name', v_department.name
            )
        ELSE NULL END,
        'branch', CASE WHEN v_branch.id IS NOT NULL THEN
            jsonb_build_object(
                'id', v_branch.id,
                'name', v_branch.name
            )
        ELSE NULL END,
        'template', CASE WHEN v_template.id IS NOT NULL THEN
            jsonb_build_object(
                'id', v_template.id,
                'code', v_template.code,
                'name', v_template.name
            )
        ELSE NULL END,
        'category', CASE WHEN v_category.id IS NOT NULL THEN
            jsonb_build_object(
                'id', v_category.id,
                'name', v_category.name,
                'level', v_category.level
            )
        ELSE NULL END,
        'base_salary', v_assignment.base_salary,
        'hourly_rate', v_assignment.hourly_rate,
        'hire_date', v_user.hire_date,
        'seniority_years', EXTRACT(YEAR FROM age(CURRENT_DATE, v_user.hire_date))::INTEGER,
        'snapshot_date', CURRENT_TIMESTAMP
    );

    RETURN v_snapshot;
END;
$$;


--
-- Name: create_payslip_template_snapshot(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_payslip_template_snapshot(p_template_id integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_template RECORD;
BEGIN
    IF p_template_id IS NULL THEN
        RETURN '{}'::JSONB;
    END IF;

    SELECT
        ppt.id,
        ppt.template_code,
        ppt.template_name,
        ppt.description,
        ppt.layout_config,
        ppt.header_config,
        ppt.footer_config,
        ppt.paper_size,
        ppt.orientation
    INTO v_template
    FROM payroll_payslip_templates ppt
    WHERE ppt.id = p_template_id;

    IF NOT FOUND THEN
        RETURN '{}'::JSONB;
    END IF;

    RETURN jsonb_build_object(
        'id', v_template.id,
        'code', v_template.template_code,
        'name', v_template.template_name,
        'description', v_template.description,
        'layout_config', v_template.layout_config,
        'header_config', v_template.header_config,
        'footer_config', v_template.footer_config,
        'paper_size', v_template.paper_size,
        'orientation', v_template.orientation,
        'snapshot_date', CURRENT_TIMESTAMP
    );
END;
$$;


--
-- Name: create_pre_invoice_from_contract(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_pre_invoice_from_contract(p_contract_id integer) RETURNS integer
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_contract RECORD;
    v_budget RECORD;
    v_company RECORD;
    v_pre_invoice_id INTEGER;
    v_code VARCHAR;
    v_items JSONB;
    v_subtotal DECIMAL(15,2);
    v_iva DECIMAL(15,2);
    v_total DECIMAL(15,2);
BEGIN
    -- Obtener datos del contrato
    SELECT * INTO v_contract FROM contracts WHERE id = p_contract_id;
    IF NOT FOUND THEN
        RAISE EXCEPTION 'Contrato % no encontrado', p_contract_id;
    END IF;

    -- Obtener datos del presupuesto
    SELECT * INTO v_budget FROM budgets WHERE id = v_contract.budget_id;

    -- Obtener datos de la empresa
    SELECT * INTO v_company FROM companies WHERE company_id = v_contract.company_id;

    -- Generar cdigo
    v_code := generate_pre_invoice_code();

    -- Usar items del presupuesto
    v_items := COALESCE(v_budget.modules_detail, '[]'::jsonb);
    v_subtotal := COALESCE(v_budget.subtotal, 0);
    v_iva := ROUND(v_subtotal * 0.21, 2);  -- 21% IVA
    v_total := v_subtotal + v_iva;

    -- Insertar pre-factura
    INSERT INTO aponnt_pre_invoices (
        contract_id,
        budget_id,
        company_id,
        pre_invoice_code,
        cliente_cuit,
        cliente_razon_social,
        cliente_condicion_iva,
        cliente_domicilio_fiscal,
        cliente_email,
        items,
        periodo_desde,
        periodo_hasta,
        subtotal,
        neto_gravado,
        iva_21,
        total,
        condicion_venta,
        status
    ) VALUES (
        p_contract_id,
        v_contract.budget_id,
        v_contract.company_id,
        v_code,
        COALESCE(v_company.tax_id, v_budget.client_cuit, '00-00000000-0'),
        COALESCE(v_company.legal_name, v_company.name),
        COALESCE(v_budget.client_fiscal_condition, 'RI'),
        v_company.address,
        v_company.contact_email,
        v_items,
        CURRENT_DATE,
        CURRENT_DATE + INTERVAL '1 month' - INTERVAL '1 day',
        v_subtotal,
        v_subtotal,
        v_iva,
        v_total,
        'CTA_CTE',
        'PENDING_REVIEW'
    )
    RETURNING id INTO v_pre_invoice_id;

    -- Crear tarea administrativa
    INSERT INTO aponnt_admin_tasks (
        task_code,
        task_type,
        priority,
        due_date,
        entity_type,
        entity_id,
        company_id,
        title,
        description,
        assigned_role,
        status
    ) VALUES (
        generate_admin_task_code('PRE_INVOICE_PENDING'),
        'PRE_INVOICE_PENDING',
        'HIGH',
        CURRENT_TIMESTAMP + INTERVAL '2 days',
        'pre_invoice',
        v_pre_invoice_id,
        v_contract.company_id,
        'Pre-factura pendiente: ' || v_company.name,
        'Contrato firmado. Pre-factura generada automticamente. Total: $' || v_total::TEXT,
        'finance',
        'PENDING'
    );

    RETURN v_pre_invoice_id;
END;
$_$;


--
-- Name: create_pre_invoice_from_contract(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_pre_invoice_from_contract(p_contract_id uuid) RETURNS integer
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_contract RECORD;
    v_budget RECORD;
    v_company RECORD;
    v_pre_invoice_id INTEGER;
    v_code VARCHAR;
    v_items JSONB;
    v_subtotal DECIMAL(15,2);
    v_iva DECIMAL(15,2);
    v_total DECIMAL(15,2);
BEGIN
    -- Obtener datos del contrato
    SELECT * INTO v_contract FROM contracts WHERE id = p_contract_id;
    IF NOT FOUND THEN
        RAISE EXCEPTION 'Contrato % no encontrado', p_contract_id;
    END IF;

    -- Obtener datos del presupuesto
    SELECT * INTO v_budget FROM budgets WHERE id = v_contract.budget_id;

    -- Obtener datos de la empresa
    SELECT * INTO v_company FROM companies WHERE company_id = v_contract.company_id;

    -- Generar cdigo
    v_code := generate_pre_invoice_code();

    -- Usar items del presupuesto/contrato
    v_items := COALESCE(v_contract.selected_modules, v_budget.modules_detail, '[]'::jsonb);
    v_subtotal := COALESCE(v_contract.total_monthly, v_budget.subtotal, 0);
    v_iva := ROUND(v_subtotal * 0.21, 2);  -- 21% IVA
    v_total := v_subtotal + v_iva;

    -- Insertar pre-factura
    INSERT INTO aponnt_pre_invoices (
        contract_id,
        budget_id,
        company_id,
        pre_invoice_code,
        cliente_cuit,
        cliente_razon_social,
        cliente_condicion_iva,
        cliente_domicilio_fiscal,
        cliente_email,
        items,
        periodo_desde,
        periodo_hasta,
        subtotal,
        neto_gravado,
        iva_21,
        total,
        condicion_venta,
        status
    ) VALUES (
        p_contract_id,
        v_contract.budget_id,
        v_contract.company_id,
        v_code,
        COALESCE(v_company.tax_id, '00-00000000-0'),
        COALESCE(v_company.legal_name, v_company.name),
        COALESCE(v_budget.client_fiscal_condition, 'RI'),
        v_company.address,
        v_company.contact_email,
        v_items,
        CURRENT_DATE,
        CURRENT_DATE + INTERVAL '1 month' - INTERVAL '1 day',
        v_subtotal,
        v_subtotal,
        v_iva,
        v_total,
        'CTA_CTE',
        'PENDING_REVIEW'
    )
    RETURNING id INTO v_pre_invoice_id;

    -- Crear tarea administrativa
    INSERT INTO aponnt_admin_tasks (
        task_code,
        task_type,
        priority,
        due_date,
        entity_type,
        entity_id,
        company_id,
        title,
        description,
        assigned_role,
        status
    ) VALUES (
        generate_admin_task_code('PRE_INVOICE_PENDING'),
        'PRE_INVOICE_PENDING',
        'HIGH',
        CURRENT_TIMESTAMP + INTERVAL '2 days',
        'pre_invoice',
        v_pre_invoice_id,
        v_contract.company_id,
        'Pre-factura pendiente: ' || v_company.name,
        'Contrato firmado. Pre-factura generada automticamente. Total: $' || v_total::TEXT,
        'finance',
        'PENDING'
    );

    RETURN v_pre_invoice_id;
END;
$_$;


--
-- Name: create_scheduled_redemption(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_scheduled_redemption() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_checkout RECORD;
BEGIN
    -- Solo cuando pasa a estado 'approved'
    IF NEW.status = 'approved' AND OLD.status != 'approved' THEN
        -- Calcular horario de salida
        SELECT * INTO v_checkout
        FROM calculate_redemption_checkout_time(NEW.user_id, NEW.scheduled_date, NEW.hours_requested);

        -- Crear registro de canje programado
        INSERT INTO hour_bank_scheduled_redemptions (
            request_id, company_id, user_id, scheduled_date,
            hours_approved, expected_checkout_time, shift_id
        ) VALUES (
            NEW.id, NEW.company_id, NEW.user_id, NEW.scheduled_date,
            NEW.hours_requested, v_checkout.adjusted_checkout, v_checkout.shift_id
        );
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: create_suspension_block_on_activate(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.create_suspension_block_on_activate() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Solo crear bloqueo si:
    -- 1. El workflow_status cambi a 'active'
    -- 2. Hay das de suspensin > 0
    -- 3. Hay fecha de inicio de suspensin
    IF NEW.workflow_status = 'active'
       AND OLD.workflow_status != 'active'
       AND COALESCE(NEW.suspension_days, 0) > 0
       AND NEW.suspension_start_date IS NOT NULL THEN

        -- Calcular fecha fin basada en calendario del empleado
        NEW.suspension_end_date := calculate_suspension_end_date(
            NEW.suspension_start_date,
            NEW.suspension_days,
            NEW.user_id  -- Pasar el empleado para usar su calendario de turno
        );

        -- Crear bloqueo (usar user_id que es el UUID del empleado)
        INSERT INTO suspension_blocks (
            sanction_id,
            employee_id,
            company_id,
            start_date,
            end_date,
            total_work_days,
            is_active,
            notes
        ) VALUES (
            NEW.id,
            NEW.user_id,
            NEW.company_id,
            NEW.suspension_start_date,
            NEW.suspension_end_date,
            NEW.suspension_days,
            true,
            'Bloqueo automtico por activacin de sancin #' || NEW.id
        );

        RAISE NOTICE 'Bloqueo de suspensin creado para empleado % hasta %', NEW.user_id, NEW.suspension_end_date;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: detect_tolerance_abuser_pattern(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.detect_tolerance_abuser_pattern(p_user_id uuid, p_company_id integer, p_period_days integer DEFAULT 30) RETURNS TABLE(detected boolean, severity character varying, occurrences integer, percentage numeric, scoring_impact numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_total_days INTEGER;
    v_tolerance_days INTEGER;
    v_percentage DECIMAL(5,2);
    v_detected BOOLEAN := false;
    v_severity VARCHAR(20) := 'low';
    v_impact DECIMAL(5,2) := 0;
BEGIN
    -- Contar das con uso de tolerancia
    SELECT
        COUNT(DISTINCT work_date),
        COUNT(*) FILTER (WHERE
            EXTRACT(EPOCH FROM (check_in - check_in)) BETWEEN 0 AND 900 -- 15 min tolerance
        )
    INTO v_total_days, v_tolerance_days
    FROM attendances
    WHERE user_id = p_user_id
      AND company_id = p_company_id
      AND work_date >= CURRENT_DATE - (p_period_days || ' days')::INTERVAL;

    -- Calcular porcentaje
    v_percentage := (v_tolerance_days::DECIMAL / NULLIF(v_total_days, 0)) * 100;

    -- Evaluar si se detecta el patrn
    IF v_percentage > 75 THEN
        v_detected := true;
        v_severity := 'high';
        v_impact := -8;
    ELSIF v_percentage > 50 THEN
        v_detected := true;
        v_severity := 'medium';
        v_impact := -5;
    ELSIF v_percentage > 30 THEN
        v_detected := true;
        v_severity := 'low';
        v_impact := -3;
    END IF;

    -- Si se detect, insertar/actualizar en attendance_patterns
    IF v_detected THEN
        INSERT INTO attendance_patterns (
            user_id, company_id, pattern_id, pattern_name, pattern_category,
            detection_date, severity, confidence_score, occurrences_count,
            threshold_value, actual_value, scoring_impact, requires_action, status
        ) VALUES (
            p_user_id, p_company_id, 'tolerance_abuser', 'Abusa de tolerancia constantemente', 'negative',
            CURRENT_DATE, v_severity, 85.00, v_tolerance_days,
            75.00, v_percentage, v_impact, (v_severity = 'high'), 'active'
        )
        ON CONFLICT ON CONSTRAINT attendance_patterns_pkey DO NOTHING;
    END IF;

    RETURN QUERY SELECT v_detected, v_severity, v_tolerance_days, v_percentage, v_impact;
END;
$$;


--
-- Name: FUNCTION detect_tolerance_abuser_pattern(p_user_id uuid, p_company_id integer, p_period_days integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.detect_tolerance_abuser_pattern(p_user_id uuid, p_company_id integer, p_period_days integer) IS 'Detecta si empleado abusa de tolerancia (>75% das)';


--
-- Name: duplicate_payroll_template(integer, integer, character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.duplicate_payroll_template(p_source_template_id integer, p_target_branch_id integer, p_new_code character varying, p_created_by integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_new_template_id INTEGER;
    v_source_template RECORD;
BEGIN
    -- Obtener plantilla origen
    SELECT * INTO v_source_template FROM payroll_templates WHERE id = p_source_template_id;

    -- Crear nueva plantilla
    INSERT INTO payroll_templates (
        company_id, country_id, branch_id, labor_agreement_id,
        template_code, template_name, description,
        pay_frequency, calculation_basis, work_hours_per_day, work_days_per_week, work_hours_per_month,
        overtime_50_after_hours, overtime_100_after_hours, night_shift_start, night_shift_end,
        round_to_cents, round_method, receipt_header, receipt_legal_text, receipt_footer,
        is_active, created_by
    )
    SELECT
        company_id, country_id, p_target_branch_id, labor_agreement_id,
        p_new_code, template_name || ' (Copia)', description,
        pay_frequency, calculation_basis, work_hours_per_day, work_days_per_week, work_hours_per_month,
        overtime_50_after_hours, overtime_100_after_hours, night_shift_start, night_shift_end,
        round_to_cents, round_method, receipt_header, receipt_legal_text, receipt_footer,
        true, p_created_by
    FROM payroll_templates WHERE id = p_source_template_id
    RETURNING id INTO v_new_template_id;

    -- Copiar conceptos
    INSERT INTO payroll_template_concepts (
        template_id, concept_type_id, concept_code, concept_name, short_name, description,
        calculation_type, default_value, percentage_base, formula,
        min_value, max_value, cap_value,
        applies_to_hourly, applies_to_monthly, is_mandatory, is_visible_receipt, is_editable_per_user,
        employee_contribution_rate, employer_contribution_rate,
        legal_reference, display_order, is_active
    )
    SELECT
        v_new_template_id, concept_type_id, concept_code, concept_name, short_name, description,
        calculation_type, default_value, percentage_base, formula,
        min_value, max_value, cap_value,
        applies_to_hourly, applies_to_monthly, is_mandatory, is_visible_receipt, is_editable_per_user,
        employee_contribution_rate, employer_contribution_rate,
        legal_reference, display_order, is_active
    FROM payroll_template_concepts WHERE template_id = p_source_template_id;

    RETURN v_new_template_id;
END;
$$;


--
-- Name: escalate_overdue_tasks(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.escalate_overdue_tasks() RETURNS TABLE(escalated_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_count INTEGER;
BEGIN
  -- Cambiar prioridad a CRITICAL para tareas vencidas
  UPDATE administrative_tasks
  SET
    priority = 'CRITICAL',
    reminder_count = reminder_count + 1,
    last_reminder_at = CURRENT_TIMESTAMP,
    updated_at = CURRENT_TIMESTAMP
  WHERE
    status IN ('PENDING', 'ASSIGNED', 'IN_PROGRESS')
    AND due_date < CURRENT_DATE
    AND priority != 'CRITICAL';

  GET DIAGNOSTICS v_count = ROW_COUNT;
  escalated_count := v_count;
  RETURN NEXT;
END;
$$;


--
-- Name: evaluate_employee_dependency(uuid, integer, integer, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.evaluate_employee_dependency(p_user_id uuid, p_company_id integer, p_dependency_id integer, p_as_of_date date DEFAULT CURRENT_DATE) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_dependency RECORD;
    v_result JSONB;
    v_valid_count INT := 0;
    v_invalid_count INT := 0;
    v_doc RECORD;
BEGIN
    -- Obtener la dependencia
    SELECT cd.*, dt.type_code as dependency_type_code
    INTO v_dependency
    FROM company_dependencies cd
    JOIN dependency_types dt ON dt.id = cd.dependency_type_id
    WHERE cd.id = p_dependency_id AND cd.company_id = p_company_id;

    IF NOT FOUND THEN
        RETURN jsonb_build_object('success', false, 'error', 'Dependency not found');
    END IF;

    -- Evaluar segn tipo
    CASE v_dependency.dependency_type_code
        WHEN 'DOCUMENT_VALID' THEN
            -- Contar documentos vlidos
            SELECT
                COUNT(*) FILTER (WHERE expiration_date IS NULL OR expiration_date >= p_as_of_date),
                COUNT(*) FILTER (WHERE expiration_date IS NOT NULL AND expiration_date < p_as_of_date)
            INTO v_valid_count, v_invalid_count
            FROM employee_dependency_documents
            WHERE user_id = p_user_id
              AND dependency_id = p_dependency_id
              AND is_current = true;

            v_result := jsonb_build_object(
                'success', true,
                'dependency_type', 'DOCUMENT_VALID',
                'dependency_name', v_dependency.dependency_name,
                'is_satisfied', v_valid_count > 0,
                'valid_count', v_valid_count,
                'invalid_count', v_invalid_count,
                'evaluated_at', CURRENT_TIMESTAMP
            );

        WHEN 'ATTENDANCE_RULE' THEN
            -- TODO: Implementar evaluacin de asistencia
            v_result := jsonb_build_object(
                'success', true,
                'dependency_type', 'ATTENDANCE_RULE',
                'dependency_name', v_dependency.dependency_name,
                'is_satisfied', true,  -- Placeholder
                'note', 'Attendance evaluation not yet implemented'
            );

        WHEN 'FAMILY_CONDITION' THEN
            -- TODO: Implementar evaluacin de condicin familiar
            v_result := jsonb_build_object(
                'success', true,
                'dependency_type', 'FAMILY_CONDITION',
                'dependency_name', v_dependency.dependency_name,
                'is_satisfied', true,  -- Placeholder
                'note', 'Family condition evaluation not yet implemented'
            );

        ELSE
            v_result := jsonb_build_object(
                'success', false,
                'error', 'Unknown dependency type'
            );
    END CASE;

    RETURN v_result;
END;
$$;


--
-- Name: expire_benefits(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.expire_benefits() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_count INTEGER;
BEGIN
  UPDATE employee_benefits
  SET
    status = 'expired',
    status_reason = 'Beneficio vencido por fecha de expiracin',
    status_changed_at = CURRENT_TIMESTAMP
  WHERE status = 'active'
    AND effective_until < CURRENT_DATE;

  GET DIAGNOSTICS v_count = ROW_COUNT;
  RETURN v_count;
END;
$$;


--
-- Name: FUNCTION expire_benefits(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.expire_benefits() IS 'Marca como expirados los beneficios que pasaron su fecha de vencimiento (ejecutar diariamente)';


--
-- Name: expire_old_budgets(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.expire_old_budgets() RETURNS TABLE(expired_count integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
  UPDATE budgets
  SET status = 'EXPIRED',
      updated_at = CURRENT_TIMESTAMP
  WHERE status IN ('PENDING', 'SENT', 'VIEWED')
    AND valid_until < CURRENT_DATE;

  GET DIAGNOSTICS expired_count = ROW_COUNT;
  RETURN NEXT;
END;
$$;


--
-- Name: expire_temp_password_on_close(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.expire_temp_password_on_close() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF NEW.status = 'closed' AND OLD.status != 'closed' THEN
    -- Marcar contrasea como expirada
    NEW.temp_password_expires_at = CURRENT_TIMESTAMP;

    -- Deshabilitar usuario temporal si existe
    IF NEW.temp_support_user_id IS NOT NULL THEN
      UPDATE users
      SET is_active = false
      WHERE user_id = NEW.temp_support_user_id;
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: find_similar_responses(text, character varying, integer, numeric, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.find_similar_responses(p_question text, p_category character varying DEFAULT NULL::character varying, p_company_id integer DEFAULT NULL::integer, p_min_confidence numeric DEFAULT 0.4, p_limit integer DEFAULT 5) RETURNS TABLE(response_id integer, question_pattern text, answer_content text, answer_summary character varying, confidence_score numeric, category character varying, times_used integer, is_verified boolean, similarity_score numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        lr.id as response_id,
        lr.question_pattern,
        lr.answer_content,
        lr.answer_summary,
        lr.confidence_score,
        lr.category,
        (lr.times_accepted) as times_used,
        lr.is_verified,
        -- Similarity score bsico basado en palabras clave
        (
            SELECT COUNT(*)::DECIMAL / GREATEST(array_length(lr.question_keywords, 1), 1)
            FROM unnest(lr.question_keywords) kw
            WHERE p_question ILIKE '%' || kw || '%'
        ) as similarity_score
    FROM notification_learned_responses lr
    WHERE lr.is_active = TRUE
      AND lr.confidence_score >= p_min_confidence
      AND (p_category IS NULL OR lr.category = p_category)
      AND (p_company_id IS NULL OR lr.company_id IS NULL OR lr.company_id = p_company_id)
      AND (lr.is_temporal = FALSE OR lr.valid_until IS NULL OR lr.valid_until >= CURRENT_DATE)
    ORDER BY
        -- Priorizar matches de keywords
        (
            SELECT COUNT(*)
            FROM unnest(lr.question_keywords) kw
            WHERE p_question ILIKE '%' || kw || '%'
        ) DESC,
        lr.confidence_score DESC,
        lr.times_accepted DESC
    LIMIT p_limit;
END;
$$;


--
-- Name: find_thread_by_email_reference(character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.find_thread_by_email_reference(p_message_id character varying, p_in_reply_to character varying) RETURNS TABLE(notification_id uuid, thread_id uuid, group_id uuid, company_id integer, entity_type character varying, entity_id character varying, recipient_type character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Primero buscar por In-Reply-To (ms especfico)
    IF p_in_reply_to IS NOT NULL AND p_in_reply_to != '' THEN
        RETURN QUERY
        SELECT
            m.notification_id,
            m.thread_id,
            m.group_id,
            m.company_id,
            m.entity_type,
            m.entity_id,
            m.recipient_type
        FROM email_thread_mapping m
        WHERE m.outbound_message_id = p_in_reply_to
          AND m.is_active = true
        LIMIT 1;

        IF FOUND THEN RETURN; END IF;
    END IF;

    -- Si no se encontr, buscar en email_logs por message_id
    IF p_in_reply_to IS NOT NULL THEN
        RETURN QUERY
        SELECT
            el.notification_id::UUID,
            NULL::UUID as thread_id,
            NULL::UUID as group_id,
            el.company_id,
            el.category as entity_type,
            el.notification_id::VARCHAR as entity_id,
            el.recipient_type
        FROM email_logs el
        WHERE el.message_id = p_in_reply_to
        LIMIT 1;
    END IF;
END;
$$;


--
-- Name: FUNCTION find_thread_by_email_reference(p_message_id character varying, p_in_reply_to character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.find_thread_by_email_reference(p_message_id character varying, p_in_reply_to character varying) IS 'Busca el thread correspondiente a una respuesta de email';


--
-- Name: fn_auto_create_user_salary_config(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_auto_create_user_salary_config() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    default_agreement_id INTEGER;
    default_category_id INTEGER;
    default_salary NUMERIC(15,2);
BEGIN
    -- Solo si no existe config salarial para este usuario
    IF NOT EXISTS (
        SELECT 1 FROM user_salary_config_v2
        WHERE user_id = NEW.user_id AND is_current = true
    ) THEN
        -- Obtener CUALQUIER convenio y categora activos (catlogo global, no tiene company_id)
        SELECT lac.id, sc.id, sc.base_salary_reference
        INTO default_agreement_id, default_category_id, default_salary
        FROM labor_agreements_catalog lac
        LEFT JOIN salary_categories sc ON sc.labor_agreement_id = lac.id AND sc.is_active = true
        WHERE lac.is_active = true
        ORDER BY lac.id
        LIMIT 1;

        -- Si hay convenio por defecto, crear config salarial
        IF default_agreement_id IS NOT NULL THEN
            INSERT INTO user_salary_config_v2 (
                user_id, company_id, labor_agreement_id, salary_category_id,
                payment_type, base_salary, gross_salary, hourly_rate,
                overtime_rate_50, overtime_rate_100, currency,
                effective_from, is_current, notes, created_at, updated_at
            )
            VALUES (
                NEW.user_id, NEW.company_id, default_agreement_id, default_category_id,
                'monthly', COALESCE(default_salary, 0), COALESCE(default_salary, 0),
                COALESCE(default_salary / 200, 0),
                COALESCE(default_salary / 200 * 1.5, 0), COALESCE(default_salary / 200 * 2, 0),
                'ARS', CURRENT_DATE, true, 'Auto-creado al asignar empresa', NOW(), NOW()
            );

            RAISE NOTICE 'Config salarial auto-creada para usuario % en empresa %',
                NEW.user_id, NEW.company_id;
        END IF;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: fn_clone_payroll_template_for_branch(integer, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_clone_payroll_template_for_branch(p_source_template_id integer, p_target_branch_id integer, p_target_country_id integer DEFAULT NULL::integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    new_template_id INTEGER;
    new_country_id INTEGER;
    branch_name_str VARCHAR;
BEGIN
    -- Obtener nombre de sucursal para usar en template
    SELECT cb.name, cb.country_id INTO branch_name_str, new_country_id
    FROM company_branches cb
    WHERE cb.id = p_target_branch_id;

    -- Si se especific pas, usarlo
    IF p_target_country_id IS NOT NULL THEN
        new_country_id := p_target_country_id;
    END IF;

    -- Clonar plantilla
    INSERT INTO payroll_templates (
        company_id, country_id, branch_id, labor_agreement_id,
        template_code, template_name, description, pay_frequency, calculation_basis,
        work_hours_per_day, work_days_per_week, work_hours_per_month,
        overtime_50_after_hours, overtime_100_after_hours,
        night_shift_start, night_shift_end, round_to_cents, round_method,
        receipt_header, receipt_legal_text, receipt_footer,
        version, is_current_version, parent_template_id, is_active,
        created_at, updated_at
    )
    SELECT
        pt.company_id, COALESCE(new_country_id, pt.country_id), p_target_branch_id, pt.labor_agreement_id,
        pt.template_code || '-' || COALESCE(branch_name_str, 'BR'),
        pt.template_name || ' (' || COALESCE(branch_name_str, 'Nueva Sucursal') || ')',
        pt.description, pt.pay_frequency, pt.calculation_basis,
        pt.work_hours_per_day, pt.work_days_per_week, pt.work_hours_per_month,
        pt.overtime_50_after_hours, pt.overtime_100_after_hours,
        pt.night_shift_start, pt.night_shift_end, pt.round_to_cents, pt.round_method,
        pt.receipt_header, pt.receipt_legal_text, pt.receipt_footer,
        1, true, pt.id, true,
        NOW(), NOW()
    FROM payroll_templates pt
    WHERE pt.id = p_source_template_id
    RETURNING id INTO new_template_id;

    -- Clonar conceptos de la plantilla
    INSERT INTO payroll_template_concepts (
        template_id, concept_type_id, concept_code, concept_name, short_name,
        description, calculation_type, default_value, percentage_base, formula,
        min_value, max_value, cap_value,
        applies_to_hourly, applies_to_monthly, is_mandatory, is_visible_receipt,
        is_editable_per_user, employee_contribution_rate, employer_contribution_rate,
        legal_reference, display_order, is_active, created_at, updated_at
    )
    SELECT
        new_template_id, concept_type_id, concept_code, concept_name, short_name,
        description, calculation_type, default_value, percentage_base, formula,
        min_value, max_value, cap_value,
        applies_to_hourly, applies_to_monthly, is_mandatory, is_visible_receipt,
        is_editable_per_user, employee_contribution_rate, employer_contribution_rate,
        legal_reference, display_order, is_active, NOW(), NOW()
    FROM payroll_template_concepts
    WHERE template_id = p_source_template_id;

    RAISE NOTICE 'Plantilla % clonada para sucursal %. Nueva plantilla ID: %',
        p_source_template_id, p_target_branch_id, new_template_id;

    RETURN new_template_id;
END;
$$;


--
-- Name: fn_flag_payroll_recalculation(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_flag_payroll_recalculation() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Marcar las liquidaciones draft/pending para reclculo
    UPDATE payroll_run_details prd
    SET
        status = 'needs_recalculation',
        error_message = 'Configuracin salarial actualizada - requiere reclculo',
        updated_at = NOW()
    FROM payroll_runs pr
    WHERE prd.run_id = pr.id
    AND prd.user_id = NEW.user_id
    AND pr.status IN ('draft', 'pending', 'calculated')
    AND pr.period_start >= NEW.effective_from;

    RETURN NEW;
END;
$$;


--
-- Name: fn_get_branch_country(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_get_branch_country(p_branch_id integer) RETURNS TABLE(country_id integer, country_code character varying, country_name character varying, renewal_months integer)
    LANGUAGE plpgsql
    AS $$
                BEGIN
                    RETURN QUERY
                    SELECT
                        pc.id as country_id,
                        pc.country_code::VARCHAR,
                        pc.country_name::VARCHAR,
                        COALESCE(pc.consent_renewal_months, 24) as renewal_months
                    FROM company_branches cb
                    LEFT JOIN payroll_countries pc ON pc.id = cb.country_id
                    WHERE cb.id = p_branch_id
                    LIMIT 1;
                END;
                $$;


--
-- Name: fn_get_user_consent_status(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_get_user_consent_status(p_user_id uuid) RETURNS TABLE(has_valid_consent boolean, consent_id integer, consent_date timestamp without time zone, expires_at timestamp without time zone, days_until_expiry integer, country_code character varying, country_name character varying, renewal_months integer, needs_renewal boolean, invalidated boolean, invalidated_reason character varying)
    LANGUAGE plpgsql
    AS $$
                BEGIN
                    RETURN QUERY
                    SELECT
                        (bc.id IS NOT NULL AND bc.consent_given = TRUE AND
                         (bc.revoked = FALSE OR bc.revoked IS NULL) AND
                         bc.invalidated_at IS NULL AND
                         (bc.expires_at IS NULL OR bc.expires_at > NOW())) as has_valid_consent,
                        bc.id as consent_id,
                        bc.consent_date,
                        bc.expires_at,
                        EXTRACT(DAY FROM (bc.expires_at - NOW()))::INTEGER as days_until_expiry,
                        pc.country_code::VARCHAR,
                        pc.country_name::VARCHAR,
                        COALESCE(pc.consent_renewal_months, 24) as renewal_months,
                        (bc.expires_at IS NOT NULL AND bc.expires_at <= NOW() + INTERVAL '30 days') as needs_renewal,
                        (bc.invalidated_at IS NOT NULL) as invalidated,
                        bc.invalidated_reason::VARCHAR
                    FROM users u
                    LEFT JOIN biometric_consents bc ON bc.user_id = u.user_id
                        AND bc.company_id = u.company_id
                        AND bc.consent_given = TRUE
                        AND (bc.revoked = FALSE OR bc.revoked IS NULL)
                    LEFT JOIN company_branches cb ON cb.id = u.branch_id::INTEGER
                    LEFT JOIN payroll_countries pc ON pc.id = cb.country_id
                    WHERE u.user_id = p_user_id
                    ORDER BY bc.consent_date DESC NULLS LAST
                    LIMIT 1;
                END;
                $$;


--
-- Name: fn_get_user_payroll_template(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_get_user_payroll_template(p_user_id uuid) RETURNS TABLE(template_id integer, template_code character varying, template_name character varying, country_name character varying, agreement_name character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pt.id,
        pt.template_code,
        pt.template_name,
        pc.country_name,
        lav.name
    FROM users u
    LEFT JOIN payroll_templates pt ON (
        pt.company_id = u.company_id
        AND pt.is_active = true
        AND pt.is_current_version = true
    )
    LEFT JOIN payroll_countries pc ON pc.id = pt.country_id
    LEFT JOIN labor_agreements_v2 lav ON lav.id = pt.labor_agreement_id
    WHERE u.user_id = p_user_id
    ORDER BY
        CASE WHEN pt.branch_id IS NOT NULL THEN 1 ELSE 2 END,
        pt.id DESC
    LIMIT 1;
END;
$$;


--
-- Name: fn_handle_user_branch_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_handle_user_branch_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
                DECLARE
                    v_old_country RECORD;
                    v_new_country RECORD;
                    v_consent RECORD;
                    v_requires_new_consent BOOLEAN := FALSE;
                    v_change_type VARCHAR(50);
                    v_action_taken VARCHAR(50);
                BEGIN
                    -- Solo procesar si cambi branch_id o default_branch_id
                    IF (OLD.branch_id IS DISTINCT FROM NEW.branch_id) OR
                       (OLD.default_branch_id IS DISTINCT FROM NEW.default_branch_id) THEN

                        -- Obtener pas de la sucursal anterior (skip si es UUID)
                        -- NOTA: Este trigger no funcionar hasta que se normalicen los tipos de datos

                        -- Determinar tipo de cambio
                        v_change_type := 'BRANCH_CHANGE';
                        v_requires_new_consent := FALSE;
                        v_action_taken := 'SKIPPED_TYPE_MISMATCH';

                        -- Registrar en log de cambios
                        INSERT INTO consent_change_log (
                            user_id, company_id,
                            old_branch_id, new_branch_id,
                            change_type, action_taken, triggered_by, notes
                        ) VALUES (
                            NEW.user_id, NEW.company_id,
                            NULL, NULL,
                            v_change_type,
                            v_action_taken,
                            'SYSTEM',
                            'Cambio detectado pero requiere normalizacin de tipos branch_id'
                        );
                    END IF;

                    RETURN NEW;
                END;
                $$;


--
-- Name: fn_propagate_agreement_multipliers(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_propagate_agreement_multipliers() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Si cambian los multiplicadores de horas extra
    IF OLD.overtime_50_multiplier IS DISTINCT FROM NEW.overtime_50_multiplier
       OR OLD.overtime_100_multiplier IS DISTINCT FROM NEW.overtime_100_multiplier THEN

        -- Actualizar multiplicadores en user_salary_config_v2
        UPDATE user_salary_config_v2 usc
        SET
            overtime_rate_50 = usc.hourly_rate * NEW.overtime_50_multiplier,
            overtime_rate_100 = usc.hourly_rate * NEW.overtime_100_multiplier,
            updated_at = NOW()
        FROM salary_categories_v2 sc
        WHERE usc.salary_category_id = (
            SELECT scat.id FROM salary_categories scat
            WHERE scat.category_code = sc.category_code
        )
        AND sc.labor_agreement_id = NEW.id
        AND usc.is_current = true;

        RAISE NOTICE 'Multiplicadores de horas extra actualizados para convenio %', NEW.name;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: fn_propagate_salary_category_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_propagate_salary_category_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $_$
DECLARE
    affected_count INTEGER;
BEGIN
    -- Solo propagar si cambi el salario base o valor hora
    IF OLD.base_salary_reference IS DISTINCT FROM NEW.base_salary_reference THEN

        -- Calcular valor hora (200 horas/mes estndar)
        DECLARE
            new_hourly_rate NUMERIC(10,2) := NEW.base_salary_reference / 200;
        BEGIN
            -- Actualizar todos los usuarios con esta categora
            UPDATE user_salary_config_v2
            SET
                base_salary = NEW.base_salary_reference,
                gross_salary = NEW.base_salary_reference,
                hourly_rate = new_hourly_rate,
                overtime_rate_50 = new_hourly_rate * 1.5,
                overtime_rate_100 = new_hourly_rate * 2.0,
                previous_base_salary = OLD.base_salary_reference,
                salary_increase_percentage =
                    CASE WHEN OLD.base_salary_reference > 0
                    THEN ((NEW.base_salary_reference - OLD.base_salary_reference) / OLD.base_salary_reference * 100)
                    ELSE 0 END,
                salary_increase_reason = 'Actualizacin automtica por cambio en categora salarial',
                last_salary_update = CURRENT_DATE,
                updated_at = NOW()
            WHERE salary_category_id = NEW.id
            AND is_current = true;

            GET DIAGNOSTICS affected_count = ROW_COUNT;

            -- Log del cambio
            RAISE NOTICE 'Propagacin automtica: Categora % actualizada de $% a $%. % usuarios afectados.',
                NEW.category_name, OLD.base_salary_reference, NEW.base_salary_reference, affected_count;
        END;
    END IF;

    RETURN NEW;
END;
$_$;


--
-- Name: FUNCTION fn_propagate_salary_category_changes(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.fn_propagate_salary_category_changes() IS 'Propaga automticamente cambios de salario en categoras a todos los usuarios con esa categora';


--
-- Name: fn_propagate_salary_category_v2_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.fn_propagate_salary_category_v2_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    affected_count INTEGER;
BEGIN
    -- Solo propagar si cambi el salario recomendado
    IF OLD.recommended_base_salary IS DISTINCT FROM NEW.recommended_base_salary
       OR OLD.recommended_hourly_rate IS DISTINCT FROM NEW.recommended_hourly_rate THEN

        -- Tambin actualizar la tabla salary_categories si existe el mismo cdigo
        UPDATE salary_categories sc
        SET base_salary_reference = NEW.recommended_base_salary
        WHERE sc.category_code = NEW.category_code
        AND sc.labor_agreement_id = (
            SELECT lac.id FROM labor_agreements_catalog lac
            WHERE lac.code = (SELECT lav.code FROM labor_agreements_v2 lav WHERE lav.id = NEW.labor_agreement_id)
        );

        GET DIAGNOSTICS affected_count = ROW_COUNT;

        RAISE NOTICE 'Sincronizacin V2->V1: Categora % actualizada. % registros en salary_categories.',
            NEW.category_name, affected_count;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: generate_admin_task_code(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_admin_task_code(p_task_type character varying) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_date VARCHAR;
    v_sequence INTEGER;
    v_prefix VARCHAR;
    v_code VARCHAR;
BEGIN
    v_date := TO_CHAR(CURRENT_DATE, 'YYYYMMDD');
    v_prefix := UPPER(LEFT(p_task_type, 3));

    SELECT COALESCE(MAX(
        CAST(SUBSTRING(task_code FROM v_prefix || '-' || v_date || '-(\d+)') AS INTEGER)
    ), 0) + 1
    INTO v_sequence
    FROM aponnt_admin_tasks
    WHERE task_code LIKE v_prefix || '-' || v_date || '-%';

    v_code := v_prefix || '-' || v_date || '-' || LPAD(v_sequence::TEXT, 4, '0');

    RETURN v_code;
END;
$$;


--
-- Name: generate_budget_code(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_budget_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  year VARCHAR(4);
  seq_num INTEGER;
  code VARCHAR(50);
BEGIN
  year := TO_CHAR(CURRENT_DATE, 'YYYY');

  -- Obtener el siguiente nmero de secuencia para el ao actual
  SELECT COALESCE(MAX(
    CAST(SUBSTRING(budget_code FROM 'PPTO-\d{4}-(\d+)') AS INTEGER)
  ), 0) + 1
  INTO seq_num
  FROM budgets
  WHERE budget_code LIKE 'PPTO-' || year || '-%';

  code := 'PPTO-' || year || '-' || LPAD(seq_num::TEXT, 4, '0');

  RETURN code;
END;
$$;


--
-- Name: generate_claim_number(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_claim_number() RETURNS text
    LANGUAGE plpgsql
    AS $$
DECLARE
    next_number INTEGER;
    claim_number TEXT;
BEGIN
    -- Obtener el siguiente nmero secuencial del ao actual
    SELECT COALESCE(MAX(
        CAST(SUBSTRING(claim_number FROM 9 FOR 5) AS INTEGER)
    ), 0) + 1
    INTO next_number
    FROM oh_workers_compensation_claims
    WHERE claim_number LIKE 'WC-' || TO_CHAR(NOW(), 'YYYY') || '-%';

    -- Formatear: WC-2025-00001
    claim_number := 'WC-' || TO_CHAR(NOW(), 'YYYY') || '-' || LPAD(next_number::TEXT, 5, '0');

    RETURN claim_number;
END;
$$;


--
-- Name: FUNCTION generate_claim_number(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_claim_number() IS 'Genera nmero nico de reclamo: WC-YYYY-NNNNN';


--
-- Name: generate_consent_signature(uuid, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_consent_signature(p_consent_id uuid, p_secret text) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_data TEXT;
    v_signature VARCHAR;
BEGIN
    SELECT
        user_id::TEXT || company_id::TEXT || consent_type ||
        consent_given::TEXT || COALESCE(consent_date::TEXT, '') ||
        COALESCE(consent_document_hash, '') || COALESCE(consent_response_hash, '')
    INTO v_data
    FROM biometric_consents
    WHERE id = p_consent_id;

    SELECT encode(hmac(v_data, p_secret, 'sha256'), 'hex') INTO v_signature;
    RETURN v_signature;
END;
$$;


--
-- Name: generate_contract_code(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_contract_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
    year VARCHAR(4);
    seq_num INTEGER;
    code VARCHAR(50);
BEGIN
    year := TO_CHAR(CURRENT_DATE, 'YYYY');

    SELECT COALESCE(MAX(
        CAST(SUBSTRING(contract_code FROM 'CONT-\d{4}-(\d+)') AS INTEGER)
    ), 0) + 1
    INTO seq_num
    FROM contracts
    WHERE contract_code LIKE 'CONT-' || year || '-%';

    code := 'CONT-' || year || '-' || LPAD(seq_num::TEXT, 4, '0');

    RETURN code;
END;
$$;


--
-- Name: generate_contract_from_template(integer, jsonb); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_contract_from_template(p_template_id integer, p_variables jsonb) RETURNS text
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_template RECORD;
  v_html TEXT;
  v_key TEXT;
  v_value TEXT;
BEGIN
  -- Obtener template
  SELECT * INTO v_template
  FROM contract_templates
  WHERE id = p_template_id AND status = 'active';

  IF NOT FOUND THEN
    RAISE EXCEPTION 'Template no encontrado o inactivo';
  END IF;

  -- Copiar HTML del template
  v_html := v_template.template_html;

  -- Reemplazar cada variable
  FOR v_key, v_value IN SELECT * FROM jsonb_each_text(p_variables)
  LOOP
    v_html := REPLACE(v_html, '{{' || v_key || '}}', v_value);
  END LOOP;

  RETURN v_html;
END;
$$;


--
-- Name: FUNCTION generate_contract_from_template(p_template_id integer, p_variables jsonb); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_contract_from_template(p_template_id integer, p_variables jsonb) IS 'Genera contrato reemplazando placeholders con variables';


--
-- Name: generate_entity_settlement(integer, integer, integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_entity_settlement(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_settlement_id INTEGER;
    v_period_year INTEGER;
    v_period_month INTEGER;
    v_period_start DATE;
    v_period_end DATE;
    v_settlement_code VARCHAR(50);
    v_total_employees INTEGER;
    v_total_amount DECIMAL(18,2);
    v_total_employer DECIMAL(18,2);
    v_total_employee DECIMAL(18,2);
BEGIN
    -- Obtener datos del perodo de la corrida
    SELECT period_year, period_month, period_start, period_end
    INTO v_period_year, v_period_month, v_period_start, v_period_end
    FROM payroll_runs
    WHERE id = p_run_id;

    -- Generar cdigo nico
    v_settlement_code := 'SET-' || p_company_id || '-' || p_entity_id || '-' ||
                         v_period_year || LPAD(v_period_month::TEXT, 2, '0');

    -- Calcular totales
    SELECT
        COUNT(DISTINCT prd.user_id),
        COALESCE(SUM(CASE WHEN pct.is_employer_cost THEN prcd.calculated_amount ELSE 0 END), 0),
        COALESCE(SUM(CASE WHEN pct.is_deduction AND NOT pct.is_employer_cost THEN prcd.calculated_amount ELSE 0 END), 0)
    INTO v_total_employees, v_total_employer, v_total_employee
    FROM payroll_run_concept_details prcd
    JOIN payroll_run_details prd ON prcd.run_detail_id = prd.id
    JOIN payroll_template_concepts ptc ON prcd.template_concept_id = ptc.id
    JOIN payroll_concept_types pct ON ptc.concept_type_id = pct.id
    WHERE prd.run_id = p_run_id
    AND ptc.entity_id = p_entity_id;

    v_total_amount := v_total_employer + v_total_employee;

    -- Crear o actualizar liquidacin
    INSERT INTO payroll_entity_settlements (
        company_id, entity_id, run_id,
        period_year, period_month, period_start, period_end,
        settlement_code,
        total_employees, total_amount,
        total_employer_contribution, total_employee_contribution, grand_total,
        status, generated_at, generated_by
    ) VALUES (
        p_company_id, p_entity_id, p_run_id,
        v_period_year, v_period_month, v_period_start, v_period_end,
        v_settlement_code,
        v_total_employees, v_total_amount,
        v_total_employer, v_total_employee, v_total_amount,
        'generated', NOW(), p_user_id
    )
    ON CONFLICT (company_id, entity_id, period_year, period_month)
    DO UPDATE SET
        run_id = EXCLUDED.run_id,
        total_employees = EXCLUDED.total_employees,
        total_amount = EXCLUDED.total_amount,
        total_employer_contribution = EXCLUDED.total_employer_contribution,
        total_employee_contribution = EXCLUDED.total_employee_contribution,
        grand_total = EXCLUDED.grand_total,
        status = 'generated',
        generated_at = NOW(),
        generated_by = p_user_id,
        updated_at = NOW()
    RETURNING settlement_id INTO v_settlement_id;

    -- Eliminar detalles anteriores
    DELETE FROM payroll_entity_settlement_details WHERE settlement_id = v_settlement_id;

    -- Insertar detalles por empleado
    INSERT INTO payroll_entity_settlement_details (
        settlement_id, user_id, run_detail_id,
        employee_name, employee_tax_id, employee_code,
        base_amount, employee_amount, employer_amount, total_amount,
        concepts_breakdown
    )
    SELECT
        v_settlement_id,
        prd.user_id,
        prd.id,
        u."firstName" || ' ' || u."lastName",
        u.dni,
        u.employee_code,
        prd.gross_earnings,
        COALESCE(SUM(CASE WHEN pct.is_deduction AND NOT pct.is_employer_cost THEN prcd.calculated_amount ELSE 0 END), 0),
        COALESCE(SUM(CASE WHEN pct.is_employer_cost THEN prcd.calculated_amount ELSE 0 END), 0),
        COALESCE(SUM(prcd.calculated_amount), 0),
        jsonb_agg(jsonb_build_object(
            'concept_code', prcd.concept_code,
            'concept_name', prcd.concept_name,
            'amount', prcd.calculated_amount,
            'is_employer', pct.is_employer_cost
        ))
    FROM payroll_run_details prd
    JOIN users u ON prd.user_id = u.user_id
    JOIN payroll_run_concept_details prcd ON prd.id = prcd.run_detail_id
    JOIN payroll_template_concepts ptc ON prcd.template_concept_id = ptc.id
    JOIN payroll_concept_types pct ON ptc.concept_type_id = pct.id
    WHERE prd.run_id = p_run_id
    AND ptc.entity_id = p_entity_id
    GROUP BY prd.user_id, prd.id, u."firstName", u."lastName", u.dni, u.employee_code, prd.gross_earnings;

    RETURN v_settlement_id;
END;
$$;


--
-- Name: FUNCTION generate_entity_settlement(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_entity_settlement(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid) IS 'Genera liquidacin consolidada por entidad a partir de una corrida de nmina';


--
-- Name: generate_entity_settlement_v2(integer, integer, integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_entity_settlement_v2(p_company_id integer, p_entity_id integer, p_run_id integer, p_user_id uuid) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_settlement_id INTEGER;
    v_period RECORD;
    v_settlement_code VARCHAR(50);
    v_totals RECORD;
    v_entity RECORD;
BEGIN
    -- Obtener datos del perodo
    SELECT period_year, period_month, period_start, period_end
    INTO v_period
    FROM payroll_runs
    WHERE id = p_run_id;

    IF NOT FOUND THEN
        RAISE EXCEPTION 'Run ID % no encontrado', p_run_id;
    END IF;

    -- Obtener datos de la entidad
    SELECT entity_code, entity_name, category_id
    INTO v_entity
    FROM payroll_entities
    WHERE entity_id = p_entity_id;

    IF NOT FOUND THEN
        RAISE EXCEPTION 'Entidad ID % no encontrada', p_entity_id;
    END IF;

    -- Generar cdigo nico
    v_settlement_code := 'SET-' || p_company_id || '-' || v_entity.entity_code || '-' ||
                         v_period.period_year || LPAD(v_period.period_month::TEXT, 2, '0');

    -- Calcular totales usando la entidad asignada a cada concepto
    SELECT
        COUNT(DISTINCT prd.user_id) as total_employees,
        COALESCE(SUM(CASE
            WHEN pct.is_employer_cost THEN prcd.amount
            ELSE 0
        END), 0) as total_employer,
        COALESCE(SUM(CASE
            WHEN pct.is_deduction AND NOT pct.is_employer_cost THEN prcd.amount
            ELSE 0
        END), 0) as total_employee
    INTO v_totals
    FROM payroll_run_concept_details prcd
    JOIN payroll_run_details prd ON prcd.run_detail_id = prd.id
    LEFT JOIN payroll_template_concepts ptc ON prcd.template_concept_id = ptc.id
    LEFT JOIN payroll_concept_types pct ON prcd.concept_type_id = pct.id
    WHERE prd.run_id = p_run_id
    AND (
        ptc.entity_id = p_entity_id  -- Conceptos con entidad asignada directamente
        OR prcd.entity_id = p_entity_id  -- O en el detalle de la corrida
    );

    -- Crear o actualizar liquidacin
    INSERT INTO payroll_entity_settlements (
        company_id, entity_id, run_id,
        period_year, period_month, period_start, period_end,
        settlement_code,
        total_employees,
        total_employer_contribution,
        total_employee_contribution,
        grand_total,
        status, generated_at, generated_by
    ) VALUES (
        p_company_id, p_entity_id, p_run_id,
        v_period.period_year, v_period.period_month,
        v_period.period_start, v_period.period_end,
        v_settlement_code,
        COALESCE(v_totals.total_employees, 0),
        COALESCE(v_totals.total_employer, 0),
        COALESCE(v_totals.total_employee, 0),
        COALESCE(v_totals.total_employer, 0) + COALESCE(v_totals.total_employee, 0),
        'generated', NOW(), p_user_id
    )
    ON CONFLICT (company_id, entity_id, period_year, period_month)
    DO UPDATE SET
        run_id = EXCLUDED.run_id,
        total_employees = EXCLUDED.total_employees,
        total_employer_contribution = EXCLUDED.total_employer_contribution,
        total_employee_contribution = EXCLUDED.total_employee_contribution,
        grand_total = EXCLUDED.grand_total,
        status = 'generated',
        generated_at = NOW(),
        generated_by = EXCLUDED.generated_by,
        updated_at = NOW()
    RETURNING settlement_id INTO v_settlement_id;

    -- Limpiar detalles anteriores
    DELETE FROM payroll_entity_settlement_details WHERE settlement_id = v_settlement_id;

    -- Insertar detalles por empleado
    INSERT INTO payroll_entity_settlement_details (
        settlement_id, user_id, run_detail_id,
        employee_name, employee_tax_id, employee_code,
        base_amount, employee_amount, employer_amount, total_amount,
        concepts_breakdown
    )
    SELECT
        v_settlement_id,
        prd.user_id,
        prd.id,
        u."firstName" || ' ' || u."lastName",
        u.dni,
        u.employee_code,
        prd.gross_earnings,
        COALESCE(SUM(CASE
            WHEN pct.is_deduction AND NOT pct.is_employer_cost THEN prcd.amount
            ELSE 0
        END), 0),
        COALESCE(SUM(CASE
            WHEN pct.is_employer_cost THEN prcd.amount
            ELSE 0
        END), 0),
        COALESCE(SUM(prcd.amount), 0),
        jsonb_agg(jsonb_build_object(
            'concept_code', prcd.concept_code,
            'concept_name', prcd.concept_name,
            'amount', prcd.amount,
            'is_employer', pct.is_employer_cost,
            'is_deduction', pct.is_deduction
        ))
    FROM payroll_run_details prd
    JOIN users u ON prd.user_id = u.user_id
    JOIN payroll_run_concept_details prcd ON prd.id = prcd.run_detail_id
    LEFT JOIN payroll_template_concepts ptc ON prcd.template_concept_id = ptc.id
    LEFT JOIN payroll_concept_types pct ON prcd.concept_type_id = pct.id
    WHERE prd.run_id = p_run_id
    AND (
        ptc.entity_id = p_entity_id
        OR prcd.entity_id = p_entity_id
    )
    GROUP BY prd.user_id, prd.id, u."firstName", u."lastName", u.dni, u.employee_code, prd.gross_earnings;

    RETURN v_settlement_id;
END;
$$;


--
-- Name: generate_hse_case_number(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_hse_case_number() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.case_number := 'HSE-' || TO_CHAR(NOW(), 'YYYY') || '-' || LPAD(NEXTVAL('hse_case_number_seq')::TEXT, 6, '0');
  RETURN NEW;
END;
$$;


--
-- Name: generate_legal_case_number(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_legal_case_number() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    year_str VARCHAR(4);
    seq_num INTEGER;
BEGIN
    IF NEW.case_number IS NULL OR NEW.case_number = '' THEN
        year_str := TO_CHAR(NOW(), 'YYYY');

        SELECT COALESCE(MAX(
            CAST(SUBSTRING(case_number FROM 'LEG-' || year_str || '-(\d+)') AS INTEGER)
        ), 0) + 1
        INTO seq_num
        FROM legal_cases
        WHERE company_id = NEW.company_id
          AND case_number LIKE 'LEG-' || year_str || '-%';

        NEW.case_number := 'LEG-' || year_str || '-' || LPAD(seq_num::TEXT, 4, '0');
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: generate_liquidation_code(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_liquidation_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  year VARCHAR(4);
  month VARCHAR(2);
  seq_num INTEGER;
  code VARCHAR(50);
BEGIN
  year := TO_CHAR(CURRENT_DATE, 'YYYY');
  month := TO_CHAR(CURRENT_DATE, 'MM');

  SELECT COALESCE(MAX(
    CAST(SUBSTRING(liquidation_code FROM 'LIQ-\d{4}-\d{2}-(\d+)') AS INTEGER)
  ), 0) + 1
  INTO seq_num
  FROM commission_liquidations
  WHERE liquidation_code LIKE 'LIQ-' || year || '-' || month || '-%';

  code := 'LIQ-' || year || '-' || month || '-' || LPAD(seq_num::TEXT, 4, '0');

  RETURN code;
END;
$$;


--
-- Name: generate_medical_record_signature(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_medical_record_signature(p_record_id integer) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_data TEXT;
    v_signature VARCHAR(64);
BEGIN
    -- Construir datos para firmar
    SELECT
        CONCAT(
            id::TEXT, '|',
            company_id::TEXT, '|',
            employee_id::TEXT, '|',
            record_type, '|',
            title, '|',
            COALESCE(description, ''), '|',
            exam_date::TEXT, '|',
            COALESCE(result, ''), '|',
            created_at::TEXT, '|',
            created_by::TEXT
        )
    INTO v_data
    FROM medical_records
    WHERE id = p_record_id;

    -- Generar SHA-256
    v_signature := encode(digest(v_data, 'sha256'), 'hex');

    RETURN v_signature;
END;
$$;


--
-- Name: FUNCTION generate_medical_record_signature(p_record_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_medical_record_signature(p_record_id integer) IS 'Genera firma digital SHA-256 para validez legal del registro';


--
-- Name: generate_payment_code(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_payment_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  year VARCHAR(4);
  month VARCHAR(2);
  seq_num INTEGER;
  code VARCHAR(50);
BEGIN
  year := TO_CHAR(CURRENT_DATE, 'YYYY');
  month := TO_CHAR(CURRENT_DATE, 'MM');

  SELECT COALESCE(MAX(
    CAST(SUBSTRING(payment_code FROM 'PAY-\d{4}-\d{2}-(\d+)') AS INTEGER)
  ), 0) + 1
  INTO seq_num
  FROM commission_payments
  WHERE payment_code LIKE 'PAY-' || year || '-' || month || '-%';

  code := 'PAY-' || year || '-' || month || '-' || LPAD(seq_num::TEXT, 4, '0');

  RETURN code;
END;
$$;


--
-- Name: generate_pre_invoice_code(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_pre_invoice_code() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_year VARCHAR;
    v_sequence INTEGER;
    v_code VARCHAR;
BEGIN
    v_year := TO_CHAR(CURRENT_DATE, 'YYYY');

    SELECT COALESCE(MAX(
        CAST(SUBSTRING(pre_invoice_code FROM 'PRE-' || v_year || '-(\d+)') AS INTEGER)
    ), 0) + 1
    INTO v_sequence
    FROM aponnt_pre_invoices
    WHERE pre_invoice_code LIKE 'PRE-' || v_year || '-%';

    v_code := 'PRE-' || v_year || '-' || LPAD(v_sequence::TEXT, 6, '0');

    RETURN v_code;
END;
$$;


--
-- Name: generate_signature_hash(uuid, character varying, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_signature_hash(p_contract_id uuid, p_signer_name character varying, p_signer_dni character varying, p_signature_ip character varying) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  hash_input TEXT;
  hash_result VARCHAR;
BEGIN
  -- Concatenar datos para generar hash nico
  hash_input := p_contract_id::TEXT ||
                p_signer_name ||
                p_signer_dni ||
                p_signature_ip ||
                EXTRACT(EPOCH FROM CURRENT_TIMESTAMP)::TEXT;

  -- Generar hash SHA-256 (requiere extensin pgcrypto)
  hash_result := encode(digest(hash_input, 'sha256'), 'hex');

  RETURN hash_result;
END;
$$;


--
-- Name: generate_temp_password(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_temp_password() RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  chars VARCHAR := 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
  result VARCHAR := '';
  i INTEGER;
BEGIN
  FOR i IN 1..12 LOOP
    result := result || substr(chars, floor(random() * length(chars) + 1)::integer, 1);
  END LOOP;
  RETURN result;
END;
$$;


--
-- Name: FUNCTION generate_temp_password(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_temp_password() IS 'Genera contrasea temporal aleatoria de 12 caracteres';


--
-- Name: generate_ticket_number(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.generate_ticket_number() RETURNS text
    LANGUAGE plpgsql
    AS $$
DECLARE
  next_number INTEGER;
  ticket_num TEXT;
BEGIN
  -- Obtener el siguiente nmero (basado en el ao actual)
  SELECT COALESCE(MAX(CAST(SUBSTRING(ticket_number FROM 'TICKET-[0-9]{4}-([0-9]+)') AS INTEGER)), 0) + 1
  INTO next_number
  FROM support_tickets
  WHERE ticket_number LIKE 'TICKET-' || EXTRACT(YEAR FROM CURRENT_TIMESTAMP) || '-%';

  -- Formatear como TICKET-2025-000001
  ticket_num := 'TICKET-' || EXTRACT(YEAR FROM CURRENT_TIMESTAMP) || '-' || LPAD(next_number::TEXT, 6, '0');

  RETURN ticket_num;
END;
$$;


--
-- Name: FUNCTION generate_ticket_number(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.generate_ticket_number() IS 'Genera nmero de ticket nico: TICKET-2025-000001';


--
-- Name: get_active_trial_modules(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_active_trial_modules(p_company_id uuid) RETURNS TABLE(module_key character varying, trial_start date, trial_end date, days_remaining integer, status character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    (elem->>'module_key')::VARCHAR,
    (elem->>'trial_start')::DATE,
    (elem->>'trial_end')::DATE,
    ((elem->>'trial_end')::DATE - CURRENT_DATE)::INTEGER AS days_remaining,
    (elem->>'status')::VARCHAR
  FROM companies c
  CROSS JOIN LATERAL jsonb_array_elements(c.modules_trial) AS elem
  WHERE
    c.id = p_company_id
    AND (elem->>'status')::VARCHAR = 'ACTIVE'
    AND (elem->>'trial_end')::DATE >= CURRENT_DATE
  ORDER BY (elem->>'trial_end')::DATE ASC;
END;
$$;


--
-- Name: get_aponnt_email(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_aponnt_email(p_config_type character varying) RETURNS TABLE(email_address character varying, display_name character varying, is_active boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        aec.from_email::VARCHAR AS email_address,
        aec.from_name::VARCHAR AS display_name,
        aec.is_active
    FROM aponnt_email_config aec
    WHERE aec.config_type = p_config_type
      AND aec.is_active = true
    LIMIT 1;
END;
$$;


--
-- Name: get_aponnt_master_id(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_aponnt_master_id() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_company_id INTEGER;
BEGIN
    SELECT company_id INTO v_company_id
    FROM companies
    WHERE is_aponnt_master = true
    LIMIT 1;

    RETURN COALESCE(v_company_id, 1);  -- Default a 1 si no existe
END;
$$;


--
-- Name: get_applicable_hour_bank_template(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_applicable_hour_bank_template(p_user_id uuid, p_company_id integer, p_branch_id integer DEFAULT NULL::integer) RETURNS TABLE(template_id integer, template_code character varying, template_name character varying, is_enabled boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Busca template mas especifico primero (branch > company)
    RETURN QUERY
    SELECT
        t.id,
        t.template_code,
        t.template_name,
        t.is_enabled
    FROM hour_bank_templates t
    WHERE t.company_id = p_company_id
      AND t.is_current_version = true
      AND (t.branch_id = p_branch_id OR (t.branch_id IS NULL AND p_branch_id IS NOT NULL))
    ORDER BY
        CASE WHEN t.branch_id = p_branch_id THEN 0 ELSE 1 END,
        t.created_at DESC
    LIMIT 1;
END;
$$;


--
-- Name: get_assistant_stats(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_assistant_stats(stats_company_id integer, days_back integer DEFAULT 30) RETURNS TABLE(total_questions bigint, helpful_rate numeric, avg_response_time_ms numeric, total_diagnostics bigint, most_asked_module character varying, total_reuses bigint, verified_answers bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    COUNT(*)::BIGINT as total_questions,
    ROUND(
      (COUNT(*) FILTER (WHERE helpful = TRUE)::NUMERIC / NULLIF(COUNT(*) FILTER (WHERE helpful IS NOT NULL), 0)) * 100,
      2
    ) as helpful_rate,
    ROUND(AVG(response_time_ms), 0) as avg_response_time_ms,
    COUNT(*) FILTER (WHERE diagnostic_triggered = TRUE)::BIGINT as total_diagnostics,
    (
      SELECT module_name
      FROM assistant_knowledge_base
      WHERE company_id = stats_company_id
        AND created_at > NOW() - (days_back || ' days')::INTERVAL
      GROUP BY module_name
      ORDER BY COUNT(*) DESC
      LIMIT 1
    ) as most_asked_module,
    SUM(reused_count)::BIGINT as total_reuses,
    COUNT(*) FILTER (WHERE verified_at IS NOT NULL)::BIGINT as verified_answers
  FROM assistant_knowledge_base
  WHERE company_id = stats_company_id
    AND created_at > NOW() - (days_back || ' days')::INTERVAL;
END;
$$;


--
-- Name: FUNCTION get_assistant_stats(stats_company_id integer, days_back integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_assistant_stats(stats_company_id integer, days_back integer) IS 'Obtiene estadsticas de uso del asistente IA por empresa';


--
-- Name: get_associate_visible_employees(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_associate_visible_employees(p_associate_user_id uuid, p_company_id integer) RETURNS TABLE(employee_id uuid)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_contract RECORD;
BEGIN
    -- Buscar contrato activo del asociado en esta empresa
    SELECT cac.* INTO v_contract
    FROM company_associate_contracts cac
    JOIN aponnt_associates aa ON aa.id = cac.associate_id
    WHERE aa.user_id = p_associate_user_id
      AND cac.company_id = p_company_id
      AND cac.status = 'active'
    LIMIT 1;

    IF v_contract IS NULL THEN
        RETURN; -- Sin contrato, sin acceso
    END IF;

    -- Segn el tipo de contrato y alcance
    IF v_contract.contract_type = 'permanent' AND v_contract.scope_type = 'all_company' THEN
        -- Permanente con acceso total: todos los empleados
        RETURN QUERY
            SELECT u.user_id FROM users u
            WHERE u.company_id = p_company_id AND u.is_active = true;

    ELSIF v_contract.scope_type = 'branches' THEN
        -- Filtrar por sucursales asignadas
        RETURN QUERY
            SELECT u.user_id FROM users u
            WHERE u.company_id = p_company_id
              AND u.is_active = true
              AND u.branch_id = ANY(v_contract.assigned_branches);

    ELSIF v_contract.scope_type = 'departments' THEN
        -- Filtrar por departamentos asignados
        RETURN QUERY
            SELECT u.user_id FROM users u
            WHERE u.company_id = p_company_id
              AND u.is_active = true
              AND u.department_id = ANY(v_contract.assigned_departments);

    ELSIF v_contract.scope_type = 'employees' OR v_contract.contract_type = 'eventual' THEN
        -- Solo empleados especficamente asignados
        RETURN QUERY
            SELECT aea.employee_id
            FROM associate_employee_assignments aea
            WHERE aea.contract_id = v_contract.id
              AND aea.is_active = true
              AND (aea.expires_at IS NULL OR aea.expires_at > NOW());
    END IF;
END;
$$;


--
-- Name: get_available_entities_for_company(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_available_entities_for_company(p_company_id integer, p_country_id integer DEFAULT NULL::integer) RETURNS TABLE(entity_id integer, entity_code character varying, entity_name character varying, entity_short_name character varying, category_id integer, category_code character varying, category_name character varying, flow_direction character varying, icon_name character varying, color_hex character varying, is_global boolean, country_code character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pe.entity_id,
        pe.entity_code,
        pe.entity_name,
        pe.entity_short_name,
        pe.category_id,
        pec.category_code,
        pec.category_name,
        pec.flow_direction,
        pec.icon_name,
        pec.color_hex,
        (pe.company_id IS NULL) as is_global,
        pc.country_code
    FROM payroll_entities pe
    LEFT JOIN payroll_entity_categories pec ON pe.category_id = pec.id
    LEFT JOIN payroll_countries pc ON pe.country_id = pc.id
    WHERE pe.is_active = true
    AND (
        pe.company_id IS NULL  -- Entidades globales
        OR pe.company_id = p_company_id  -- Entidades de la empresa
    )
    AND (
        p_country_id IS NULL
        OR pe.country_id IS NULL  -- Sin pas = aplica a todos
        OR pe.country_id = p_country_id
    )
    ORDER BY pec.display_order, pe.entity_name;
END;
$$;


--
-- Name: FUNCTION get_available_entities_for_company(p_company_id integer, p_country_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_available_entities_for_company(p_company_id integer, p_country_id integer) IS 'Retorna entidades disponibles para una empresa (globales + propias)';


--
-- Name: get_available_entity_categories(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_available_entity_categories(p_company_id integer DEFAULT NULL::integer, p_country_id integer DEFAULT NULL::integer) RETURNS TABLE(id integer, category_code character varying, category_name character varying, category_name_short character varying, flow_direction character varying, icon_name character varying, color_hex character varying, consolidation_group character varying, is_global boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pec.id,
        pec.category_code,
        pec.category_name,
        pec.category_name_short,
        pec.flow_direction,
        pec.icon_name,
        pec.color_hex,
        pec.consolidation_group,
        (pec.company_id IS NULL AND pec.country_id IS NULL) as is_global
    FROM payroll_entity_categories pec
    WHERE pec.is_active = true
    AND (
        (pec.company_id IS NULL AND pec.country_id IS NULL)  -- Globales
        OR pec.country_id = p_country_id  -- Del pas
        OR pec.company_id = p_company_id  -- De la empresa
    )
    ORDER BY pec.display_order, pec.category_name;
END;
$$;


--
-- Name: get_available_modules(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_available_modules(panel_type character varying) RETURNS TABLE(id uuid, module_key character varying, name character varying, category character varying, base_price numeric, is_core boolean, requirements jsonb, bundled_modules jsonb, available_in character varying)
    LANGUAGE plpgsql
    AS $$
      BEGIN
        RETURN QUERY
        SELECT
          sm.id,
          sm.module_key,
          sm.name,
          sm.category,
          sm.base_price,
          sm.is_core,
          sm.requirements,
          sm.bundled_modules,
          sm.available_in
        FROM system_modules sm
        WHERE sm.is_active = true
          AND (sm.available_in = panel_type OR sm.available_in = 'both')
        ORDER BY sm.display_order, sm.name;
      END;
      $$;


--
-- Name: get_available_parents(integer, character varying, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_available_parents(p_company_id integer, p_document_type character varying, p_exclude_id uuid DEFAULT NULL::uuid) RETURNS TABLE(id uuid, code character varying, title character varying, type character varying, full_path text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_parent_level INTEGER;
BEGIN
    -- Determinar nivel del padre requerido
    v_parent_level := CASE p_document_type
        WHEN 'manual' THEN 1        -- Padre debe ser politica
        WHEN 'procedimiento' THEN 2 -- Padre debe ser manual
        WHEN 'instructivo' THEN 3   -- Padre debe ser procedimiento
        ELSE NULL                    -- Politica no tiene padre
    END;

    -- Si es politica, no hay padres disponibles
    IF v_parent_level IS NULL THEN
        RETURN;
    END IF;

    RETURN QUERY
    SELECT
        p.id,
        p.code,
        p.title,
        p.type,
        COALESCE(
            (SELECT pp.code || ' > ' || p.code FROM procedures pp WHERE pp.id = p.parent_id),
            p.code::TEXT
        ) as full_path
    FROM procedures p
    WHERE p.company_id = p_company_id
      AND p.hierarchy_level = v_parent_level
      AND p.status IN ('draft', 'pending_review', 'approved', 'published')
      AND (p_exclude_id IS NULL OR p.id != p_exclude_id)
    ORDER BY p.code;
END;
$$;


--
-- Name: get_available_templates_for_user(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_available_templates_for_user(p_user_id uuid) RETURNS TABLE(template_id integer, template_code character varying, template_name character varying, country_name character varying, branch_name character varying, pay_frequency character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pt.id as template_id,
        pt.template_code,
        pt.template_name,
        pc.country_name,
        cb.branch_name,
        pt.pay_frequency
    FROM payroll_templates pt
    LEFT JOIN payroll_countries pc ON pt.country_id = pc.id
    LEFT JOIN company_branches cb ON pt.branch_id = cb.id
    JOIN users u ON u.company_id = pt.company_id
    WHERE u.id = p_user_id
      AND pt.is_active = true
      AND pt.is_current_version = true
      AND (pt.branch_id IS NULL OR pt.branch_id = u.branch_id)
    ORDER BY pt.template_name;
END;
$$;


--
-- Name: get_benefit_documents_expiring_soon(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_benefit_documents_expiring_soon(p_employee_benefit_id integer, p_days_ahead integer DEFAULT 30) RETURNS TABLE(document_id integer, requirement_id integer, document_type_code character varying, expiration_date date, days_to_expiration integer, is_mandatory boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    ebd.id,
    ebd.requirement_id,
    dt.code,
    ebd.expiration_date,
    (ebd.expiration_date - CURRENT_DATE)::INTEGER,
    bdr.is_mandatory
  FROM employee_benefit_documents ebd
  JOIN benefit_document_requirements bdr ON ebd.requirement_id = bdr.id
  JOIN document_types dt ON bdr.document_type_id = dt.id
  WHERE ebd.employee_benefit_id = p_employee_benefit_id
    AND ebd.is_current = true
    AND ebd.verification_status = 'verified'
    AND ebd.expiration_date IS NOT NULL
    AND ebd.expiration_date <= (CURRENT_DATE + p_days_ahead)
  ORDER BY ebd.expiration_date ASC;
END;
$$;


--
-- Name: FUNCTION get_benefit_documents_expiring_soon(p_employee_benefit_id integer, p_days_ahead integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_benefit_documents_expiring_soon(p_employee_benefit_id integer, p_days_ahead integer) IS 'Retorna documentos de un beneficio que vencen prximamente';


--
-- Name: get_biometric_stats(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_biometric_stats(company_id_param integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (
        SELECT jsonb_build_object(
            'total_templates', COUNT(*),
            'active_templates', COUNT(*) FILTER (WHERE is_active = true),
            'avg_quality', AVG(quality_score),
            'unique_employees', COUNT(DISTINCT employee_id),
            'devices_count', COUNT(DISTINCT device_id),
            'recent_verifications', COUNT(*) FILTER (WHERE last_verification_at > NOW() - INTERVAL '7 days')
        )
        FROM biometric_templates
        WHERE company_id = company_id_param
    );
END;
$$;


--
-- Name: get_certifications_requiring_alert(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_certifications_requiring_alert() RETURNS TABLE(cert_id integer, company_id integer, employee_id character varying, employee_name character varying, employee_email character varying, certification_type_code character varying, certification_type_name jsonb, expiration_date date, days_until_expiration integer, alert_days_before integer, last_alert_sent_at timestamp with time zone, config_alerts_enabled boolean, config_alert_days_schedule integer[])
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        ec.id AS cert_id,
        ec.company_id,
        ec.employee_id,
        ec.employee_name,
        ec.employee_email,
        ct.type_code AS certification_type_code,
        ct.name_i18n AS certification_type_name,
        ec.expiration_date,
        (ec.expiration_date - CURRENT_DATE) AS days_until_expiration,
        ec.alert_days_before,
        ec.last_alert_sent_at,
        COALESCE(cfg.alerts_enabled, true) AS config_alerts_enabled,
        COALESCE(cfg.alert_days_schedule, ARRAY[30, 15, 7, 1]) AS config_alert_days_schedule
    FROM oh_employee_certifications ec
    INNER JOIN oh_certification_types ct ON ec.certification_type_id = ct.id
    LEFT JOIN oh_certification_alert_config cfg ON ec.company_id = cfg.company_id
    WHERE
        ec.deleted_at IS NULL
        AND ec.status IN ('active', 'expiring_soon')
        AND ec.expiration_date >= CURRENT_DATE
        AND COALESCE(cfg.alerts_enabled, true) = true
        AND (
            -- Alerta debe enviarse hoy segn configuracin
            (ec.expiration_date - CURRENT_DATE) = ANY(COALESCE(cfg.alert_days_schedule, ARRAY[30, 15, 7, 1]))
            OR
            -- O nunca se ha enviado alerta y ya est dentro del perodo
            (ec.last_alert_sent_at IS NULL AND (ec.expiration_date - CURRENT_DATE) <= ec.alert_days_before)
        )
    ORDER BY ec.company_id, ec.expiration_date;
END;
$$;


--
-- Name: get_companies_needing_poll(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_companies_needing_poll() RETURNS TABLE(config_id uuid, company_id integer, company_name character varying, imap_host character varying, imap_port integer, imap_user character varying, imap_password character varying, imap_secure boolean, imap_folder character varying, imap_last_uid integer, smtp_from_email character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        cec.id as config_id,
        cec.company_id,
        c.name as company_name,
        cec.imap_host,
        cec.imap_port,
        cec.imap_user,
        cec.imap_password,
        cec.imap_secure,
        cec.imap_folder,
        cec.imap_last_uid,
        cec.smtp_from_email
    FROM company_email_config cec
    JOIN companies c ON cec.company_id = c.company_id
    WHERE cec.imap_enabled = true
      AND cec.bidirectional_enabled = true
      AND cec.is_active = true
      AND c.is_active = true
      AND (
          cec.imap_last_poll IS NULL
          OR cec.imap_last_poll < NOW() - (cec.poll_interval_seconds || ' seconds')::INTERVAL
      );
END;
$$;


--
-- Name: get_company_assistant_type(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_assistant_type(p_company_id integer) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_has_ai BOOLEAN;
BEGIN
  SELECT sp.has_ai_assistant INTO v_has_ai
  FROM companies c
  INNER JOIN support_sla_plans sp ON c.support_sla_plan_id = sp.plan_id
  WHERE c.company_id = p_company_id;

  -- Si no tiene plan o no tiene IA, usar fallback
  IF NOT FOUND OR v_has_ai = false THEN
    RETURN 'fallback';
  ELSE
    RETURN 'ai_powered';
  END IF;
END;
$$;


--
-- Name: FUNCTION get_company_assistant_type(p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_company_assistant_type(p_company_id integer) IS 'Retorna fallback o ai_powered segn plan contratado';


--
-- Name: get_company_certification_stats(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_certification_stats(p_company_id integer) RETURNS TABLE(total_certifications integer, active_certifications integer, expiring_soon_certifications integer, expired_certifications integer, renewed_certifications integer, employees_with_certifications integer, certification_types_count integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::INTEGER AS total_certifications,
        COUNT(*) FILTER (WHERE status = 'active')::INTEGER AS active_certifications,
        COUNT(*) FILTER (WHERE status = 'expiring_soon')::INTEGER AS expiring_soon_certifications,
        COUNT(*) FILTER (WHERE status = 'expired')::INTEGER AS expired_certifications,
        COUNT(*) FILTER (WHERE status = 'renewed')::INTEGER AS renewed_certifications,
        COUNT(DISTINCT employee_id)::INTEGER AS employees_with_certifications,
        COUNT(DISTINCT certification_type_id)::INTEGER AS certification_types_count
    FROM oh_employee_certifications
    WHERE company_id = p_company_id
      AND deleted_at IS NULL;
END;
$$;


--
-- Name: get_company_commercial_history(integer, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_commercial_history(p_company_id integer, p_limit integer DEFAULT 50, p_offset integer DEFAULT 0) RETURNS TABLE(notification_id uuid, thread_id uuid, direction character varying, notification_type character varying, title character varying, message text, priority character varying, trace_id character varying, vendor_name character varying, is_read boolean, requires_action boolean, action_status character varying, created_at timestamp without time zone, metadata jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        n.id as notification_id,
        n.thread_id,
        n.direction,
        n.notification_type,
        n.title,
        n.message,
        n.priority,
        n.trace_id,
        CONCAT(s.first_name, ' ', s.last_name)::VARCHAR(255) as vendor_name,
        n.is_read,
        n.requires_action,
        n.action_status,
        n.created_at,
        n.metadata
    FROM unified_notifications n
    LEFT JOIN aponnt_staff s ON n.vendor_id = s.staff_id
    WHERE n.company_id = p_company_id
      AND n.is_commercial = TRUE
      AND n.deleted_at IS NULL
    ORDER BY n.created_at DESC
    LIMIT p_limit
    OFFSET p_offset;
END;
$$;


--
-- Name: get_company_email_config(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_email_config(p_company_id integer) RETURNS TABLE(id integer, institutional_email character varying, smtp_host character varying, smtp_port integer, smtp_user character varying, is_verified boolean, daily_limit integer, current_daily_count integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        ec.id,
        ec.institutional_email,
        ec.smtp_host,
        ec.smtp_port,
        ec.smtp_user,
        ec.is_verified,
        ec.daily_limit,
        ec.current_daily_count
    FROM email_configurations ec
    WHERE ec.company_id = p_company_id
    AND ec.is_active = true
    LIMIT 1;
END;
$$;


--
-- Name: get_company_employee_emails(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_employee_emails(p_company_id integer) RETURNS TABLE(user_id uuid, email character varying, is_verified boolean, receive_notifications boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        ue.user_id,
        ue.email,
        ue.is_verified,
        ue.receive_system_notifications
    FROM user_emails ue
    WHERE ue.company_id = p_company_id
    AND ue.is_active = true
    AND ue.is_primary = true
    ORDER BY ue.email;
END;
$$;


--
-- Name: get_company_fiscal_config(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_fiscal_config(p_company_id integer) RETURNS TABLE(cuit character varying, razon_social character varying, condicion_iva character varying, afip_environment character varying, has_valid_certificate boolean, has_valid_token boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        cfc.cuit,
        cfc.razon_social,
        cfc.condicion_iva,
        cfc.afip_environment,
        (cfc.certificate_pem IS NOT NULL AND cfc.certificate_expiration > CURRENT_TIMESTAMP) as has_valid_certificate,
        (cfc.cached_token IS NOT NULL AND cfc.token_expiration > CURRENT_TIMESTAMP) as has_valid_token
    FROM company_fiscal_config cfc
    WHERE cfc.company_id = p_company_id
      AND cfc.is_active = true;
END;
$$;


--
-- Name: get_company_support_staff(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_support_staff(p_company_id integer) RETURNS TABLE(staff_id uuid, staff_name text, email character varying, level integer, role_code character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Primero buscar staff de soporte asignado especficamente
    RETURN QUERY
    SELECT
        s.staff_id,
        (s.first_name || ' ' || s.last_name)::TEXT as staff_name,
        s.email,
        s.level,
        r.role_code
    FROM aponnt_staff s
    JOIN aponnt_staff_roles r ON s.role_id = r.role_id
    JOIN aponnt_staff_companies sc ON s.staff_id = sc.staff_id
    WHERE sc.company_id = p_company_id
      AND sc.is_active = true
      AND s.is_active = true
      AND r.role_area = 'soporte'
    ORDER BY s.level ASC
    LIMIT 1;

    -- Si no hay soporte especfico, buscar el vendedor asignado
    IF NOT FOUND THEN
        RETURN QUERY
        SELECT
            s.staff_id,
            (s.first_name || ' ' || s.last_name)::TEXT as staff_name,
            s.email,
            s.level,
            r.role_code
        FROM companies c
        JOIN aponnt_staff s ON c.vendor_id = s.staff_id
        JOIN aponnt_staff_roles r ON s.role_id = r.role_id
        WHERE c.company_id = p_company_id
          AND s.is_active = true
        LIMIT 1;
    END IF;
END;
$$;


--
-- Name: FUNCTION get_company_support_staff(p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_company_support_staff(p_company_id integer) IS 'Obtiene el staff de soporte asignado a una empresa';


--
-- Name: get_company_support_vendor(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_support_vendor(p_company_id integer) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
  vendor_id UUID;
BEGIN
  SELECT
    CASE
      WHEN support_type = 'aponnt_support' THEN NULL -- Aponnt maneja directamente
      WHEN support_type = 'other_vendor' THEN assigned_vendor_id
      ELSE original_vendor_id -- 'original_vendor'
    END
  INTO vendor_id
  FROM company_support_assignments
  WHERE company_id = p_company_id
    AND is_active = true
  ORDER BY assigned_at DESC
  LIMIT 1;

  RETURN vendor_id;
END;
$$;


--
-- Name: FUNCTION get_company_support_vendor(p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_company_support_vendor(p_company_id integer) IS 'Obtiene el vendedor asignado para dar soporte a una empresa';


--
-- Name: get_company_tax_configuration(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_company_tax_configuration(p_company_id integer) RETURNS TABLE(template_country character varying, template_name character varying, tax_id_format character varying, tax_id_field_name character varying, currencies jsonb, conditions jsonb, concepts jsonb, company_config jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        tt.country,
        tt.template_name,
        tt.tax_id_format,
        tt.tax_id_field_name,
        tt.currencies,

        -- Condiciones disponibles
        (SELECT json_agg(
            json_build_object(
                'code', tc.condition_code,
                'name', tc.condition_name,
                'description', tc.description
            ) ORDER BY tc.display_order
        ) FROM tax_conditions tc WHERE tc.tax_template_id = tt.id AND tc.is_active = true),

        -- Conceptos con alcuotas
        (SELECT json_agg(
            json_build_object(
                'code', tcon.concept_code,
                'name', tcon.concept_name,
                'order', tcon.calculation_order,
                'base_amount', tcon.base_amount,
                'type', tcon.concept_type,
                'rates', (
                    SELECT json_agg(
                        json_build_object(
                            'code', tr.rate_code,
                            'name', tr.rate_name,
                            'percentage', tr.rate_percentage,
                            'is_default', tr.is_default
                        ) ORDER BY tr.rate_percentage
                    ) FROM tax_rates tr
                    WHERE tr.tax_concept_id = tcon.id AND tr.is_active = true
                )
            ) ORDER BY tcon.calculation_order
        ) FROM tax_concepts tcon WHERE tcon.tax_template_id = tt.id AND tcon.is_active = true),

        -- Configuracin especfica de la empresa
        (SELECT json_build_object(
            'custom_tax_id', ctc.custom_tax_id,
            'custom_condition', ctc.custom_condition_code,
            'factura_a_numero', ctc.factura_a_numero,
            'factura_b_numero', ctc.factura_b_numero,
            'factura_c_numero', ctc.factura_c_numero,
            'remito_numero', ctc.remito_numero,
            'recibo_numero', ctc.recibo_numero,
            'punto_venta', ctc.punto_venta,
            'actividad_principal', ctc.actividad_principal,
            'descuento_maximo', ctc.descuento_maximo,
            'recargo_maximo', ctc.recargo_maximo,
            'concept_overrides', ctc.concept_overrides
        ) FROM company_tax_config ctc WHERE ctc.company_id = p_company_id)

    FROM tax_templates tt
    JOIN company_tax_config ctc ON ctc.tax_template_id = tt.id
    WHERE ctc.company_id = p_company_id AND tt.is_active = true;
END;
$$;


--
-- Name: get_concept_help(integer, integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_concept_help(p_concept_type_id integer, p_country_id integer DEFAULT NULL::integer, p_locale character varying DEFAULT 'es'::character varying) RETURNS TABLE(type_code character varying, display_name character varying, tooltip character varying, detailed_help text, legal_ref text, employee_rate numeric, employer_rate numeric, rate_ceiling numeric, calculation_base character varying, country_specific_help text, example text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pct.type_code,
        COALESCE(
            pct.names_by_locale->>p_locale,
            pct.type_name
        )::VARCHAR(100) as display_name,
        pct.help_tooltip,
        pct.help_detailed,
        COALESCE(pctr.legal_reference, pct.legal_reference),
        COALESCE(pctr.employee_rate, pct.default_employee_rate),
        COALESCE(pctr.employer_rate, pct.default_employer_rate),
        COALESCE(pctr.rate_ceiling, pct.rate_ceiling),
        COALESCE(pctr.calculation_base, pct.calculation_base_type),
        pctr.help_text,
        pct.examples_by_country->>(SELECT country_code FROM payroll_countries WHERE id = p_country_id)
    FROM payroll_concept_types pct
    LEFT JOIN payroll_concept_type_rates pctr ON (
        pct.id = pctr.concept_type_id
        AND pctr.country_id = p_country_id
        AND pctr.is_active = true
        AND CURRENT_DATE BETWEEN pctr.effective_from AND COALESCE(pctr.effective_to, '9999-12-31')
    )
    WHERE pct.id = p_concept_type_id;
END;
$$;


--
-- Name: get_concept_types_for_country(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_concept_types_for_country(p_country_id integer, p_locale character varying DEFAULT 'es'::character varying) RETURNS TABLE(id integer, type_code character varying, display_name text, classification_code character varying, is_earning boolean, is_deduction boolean, is_employer_contribution boolean, is_remunerative boolean, is_mandatory boolean, employee_rate numeric, employer_rate numeric, rate_ceiling numeric, icon_name character varying, color_hex character varying, tooltip character varying, detailed_help text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        pct.id,
        pct.type_code,
        COALESCE(pct.names_by_locale->>p_locale, pct.type_name)::TEXT,
        pcc.classification_code,
        (pcc.classification_code = 'GROSS_EARNING'),
        (pcc.classification_code = 'EMPLOYEE_DEDUCTION'),
        (pcc.classification_code = 'EMPLOYER_CONTRIBUTION'),
        pct.is_remunerative,
        pct.is_mandatory,
        COALESCE(pctr.employee_rate, pct.default_employee_rate),
        COALESCE(pctr.employer_rate, pct.default_employer_rate),
        COALESCE(pctr.rate_ceiling, pct.rate_ceiling),
        pct.icon_name,
        pct.color_hex,
        pct.help_tooltip,
        COALESCE(pctr.help_text, pct.help_detailed)
    FROM payroll_concept_types pct
    LEFT JOIN payroll_concept_classifications pcc ON pct.classification_id = pcc.id
    LEFT JOIN payroll_concept_type_rates pctr ON (
        pct.id = pctr.concept_type_id
        AND pctr.country_id = p_country_id
        AND pctr.is_active = true
        AND CURRENT_DATE BETWEEN pctr.effective_from AND COALESCE(pctr.effective_to, '9999-12-31')
    )
    WHERE pct.is_active = true
    AND (pct.country_id IS NULL OR pct.country_id = p_country_id)
    ORDER BY pcc.calculation_order, pct.display_order;
END;
$$;


--
-- Name: get_consent_stats_by_role(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_consent_stats_by_role(p_user_type character varying) RETURNS TABLE(consent_key character varying, title character varying, total_applicable integer, total_accepted integer, total_rejected integer, total_pending integer, acceptance_rate numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        cd.consent_key,
        cd.title,
        COUNT(DISTINCT CASE WHEN p_user_type = ANY(cd.applicable_roles) THEN cd.consent_id END)::INTEGER as total_applicable,
        COUNT(DISTINCT CASE WHEN uc.status = 'accepted' THEN uc.user_consent_id END)::INTEGER as total_accepted,
        COUNT(DISTINCT CASE WHEN uc.status = 'rejected' THEN uc.user_consent_id END)::INTEGER as total_rejected,
        COUNT(DISTINCT CASE WHEN uc.status = 'pending' THEN uc.user_consent_id END)::INTEGER as total_pending,
        ROUND(
            CASE
                WHEN COUNT(DISTINCT uc.user_consent_id) > 0
                THEN (COUNT(DISTINCT CASE WHEN uc.status = 'accepted' THEN uc.user_consent_id END)::NUMERIC /
                      COUNT(DISTINCT uc.user_consent_id)::NUMERIC) * 100
                ELSE 0
            END, 2
        ) as acceptance_rate
    FROM consent_definitions cd
    LEFT JOIN user_consents uc ON uc.consent_id = cd.consent_id AND uc.user_type = p_user_type
    WHERE cd.is_active = true
    AND p_user_type = ANY(cd.applicable_roles)
    GROUP BY cd.consent_key, cd.title
    ORDER BY cd.consent_key;
END;
$$;


--
-- Name: FUNCTION get_consent_stats_by_role(p_user_type character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_consent_stats_by_role(p_user_type character varying) IS 'Estadsticas de aceptacin de consentimientos por rol';


--
-- Name: get_contract_template(character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_contract_template(p_contract_type_code character varying, p_country_code character varying) RETURNS TABLE(template_id integer, template_html text, required_variables jsonb, country_requirements jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    ct.id,
    ct.template_html,
    ct.required_variables,
    ct.country_specific_requirements
  FROM contract_templates ct
  JOIN contract_template_types ctt ON ct.template_type_id = ctt.id
  WHERE ctt.code = p_contract_type_code
    AND ct.country_code = p_country_code
    AND ct.status = 'active'
    AND ct.is_default = true
  LIMIT 1;
END;
$$;


--
-- Name: FUNCTION get_contract_template(p_contract_type_code character varying, p_country_code character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_contract_template(p_contract_type_code character varying, p_country_code character varying) IS 'Obtiene template por defecto segn tipo y pas';


--
-- Name: get_contracts_grace_period_expiring(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_contracts_grace_period_expiring() RETURNS TABLE(contract_id uuid, company_id integer, company_name character varying, grace_period_end date, days_until_suspension integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        c.id as contract_id,
        c.company_id,
        co.name as company_name,
        c.grace_period_end,
        (c.grace_period_end - CURRENT_DATE)::INTEGER as days_until_suspension
    FROM contracts c
    JOIN companies co ON c.company_id = co.company_id
    WHERE c.status = 'GRACE_PERIOD'
      AND c.grace_period_end <= CURRENT_DATE + INTERVAL '7 days'
    ORDER BY c.grace_period_end ASC;
END;
$$;


--
-- Name: get_contracts_needing_renewal_alert(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_contracts_needing_renewal_alert() RETURNS TABLE(contract_id uuid, contract_code character varying, company_id integer, company_name character varying, company_email character varying, vendor_id uuid, vendor_email character varying, end_date date, days_until_expiry integer, status character varying, is_grace_period boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        c.id as contract_id,
        c.contract_code,
        c.company_id,
        co.name as company_name,
        COALESCE(co.contact_email, b.email) as company_email,
        c.vendor_id,
        s.email as vendor_email,
        COALESCE(c.grace_period_end, c.end_date::DATE) as end_date,
        (COALESCE(c.grace_period_end, c.end_date::DATE) - CURRENT_DATE)::INTEGER as days_until_expiry,
        c.status,
        (c.status = 'GRACE_PERIOD') as is_grace_period
    FROM contracts c
    JOIN companies co ON c.company_id = co.company_id
    LEFT JOIN branches b ON b.company_id = co.company_id AND b.is_main = true
    LEFT JOIN aponnt_staff s ON c.vendor_id = s.staff_id
    WHERE c.status IN ('ACTIVE', 'RENEWAL_PENDING', 'GRACE_PERIOD')
      AND (
        (c.status = 'ACTIVE' AND c.end_date::DATE - INTERVAL '30 days' <= CURRENT_DATE)
        OR (c.status = 'GRACE_PERIOD' AND c.grace_period_end >= CURRENT_DATE)
        OR (c.status = 'RENEWAL_PENDING')
      )
      AND (
        c.renewal_alert_sent_at IS NULL
        OR c.renewal_alert_sent_at < CURRENT_DATE - INTERVAL '3 days'
      )
    ORDER BY end_date ASC;
END;
$$;


--
-- Name: get_core_user(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_core_user(p_company_id uuid) RETURNS TABLE(user_id uuid, usuario character varying, email character varying, "createdAt" timestamp without time zone, force_password_change boolean, password_changed_at timestamp without time zone, onboarding_trace_id character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    id,
    users.usuario,
    users.email,
    users."createdAt",
    users.force_password_change,
    users.password_changed_at,
    users.onboarding_trace_id
  FROM users
  WHERE
    users.company_id = p_company_id
    AND is_core_user = TRUE
  LIMIT 1;
END;
$$;


--
-- Name: get_employee_disciplinary_history(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_employee_disciplinary_history(p_employee_id uuid, p_company_id integer) RETURNS TABLE(sanction_id integer, sanction_type_name character varying, severity character varying, status character varying, workflow_status character varying, created_at timestamp without time zone, description text, suspension_days integer, points_deducted integer, is_active boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        s.id AS sanction_id,
        COALESCE(st.name, s.sanction_type)::VARCHAR AS sanction_type_name,
        s.severity::VARCHAR,
        s.status::VARCHAR,
        s.workflow_status::VARCHAR,
        s.created_at::TIMESTAMP,
        s.description::TEXT,
        COALESCE(s.suspension_days, 0)::INTEGER AS suspension_days,
        COALESCE(s.points_deducted, 0)::INTEGER AS points_deducted,
        CASE WHEN s.status = 'active' AND s.workflow_status = 'active' THEN true ELSE false END AS is_active
    FROM sanctions s
    LEFT JOIN sanction_types st ON st.id = s.sanction_type_id
    WHERE s.user_id = p_employee_id
      AND s.company_id = p_company_id
    ORDER BY s.created_at DESC;
END;
$$;


--
-- Name: FUNCTION get_employee_disciplinary_history(p_employee_id uuid, p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_employee_disciplinary_history(p_employee_id uuid, p_company_id integer) IS 'Obtiene historial disciplinario completo de un empleado';


--
-- Name: get_employee_payslip_template(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_employee_payslip_template(p_user_id uuid) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_template_id INTEGER;
BEGIN
    -- Buscar template por posicin del empleado
    SELECT op.payslip_template_id INTO v_template_id
    FROM users u
    JOIN organizational_positions op ON u.organizational_position_id = op.id
    WHERE u.user_id = p_user_id AND op.is_active = true;

    -- Si no tiene posicin o la posicin no tiene template, usar el default de la empresa
    IF v_template_id IS NULL THEN
        SELECT ppt.id INTO v_template_id
        FROM users u
        JOIN payroll_payslip_templates ppt ON ppt.company_id = u.company_id
        WHERE u.user_id = p_user_id AND ppt.is_default = true AND ppt.is_active = true
        LIMIT 1;
    END IF;

    -- Si an no hay template, usar el default global del pas
    IF v_template_id IS NULL THEN
        SELECT ppt.id INTO v_template_id
        FROM payroll_payslip_templates ppt
        WHERE ppt.company_id IS NULL AND ppt.is_default = true AND ppt.is_active = true
        LIMIT 1;
    END IF;

    RETURN v_template_id;
END;
$$;


--
-- Name: get_employee_sla_score(character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_employee_sla_score(p_employee_id character varying, p_company_id integer) RETURNS TABLE(total_sla_records integer, sla_met_count integer, sla_breach_count integer, compliance_rate numeric, total_breach_minutes integer, avg_response_minutes numeric, total_evaluation_impact numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::INTEGER as total_sla_records,
        COUNT(*) FILTER (WHERE r.sla_met = TRUE)::INTEGER as sla_met_count,
        COUNT(*) FILTER (WHERE r.sla_met = FALSE)::INTEGER as sla_breach_count,
        ROUND(
            (COUNT(*) FILTER (WHERE r.sla_met = TRUE)::DECIMAL / NULLIF(COUNT(*), 0) * 100), 2
        ) as compliance_rate,
        COALESCE(SUM(r.breach_minutes) FILTER (WHERE r.sla_met = FALSE), 0)::INTEGER as total_breach_minutes,
        ROUND(AVG(
            EXTRACT(EPOCH FROM (r.actual_response_at - r.created_at)) / 60
        ) FILTER (WHERE r.actual_response_at IS NOT NULL), 2) as avg_response_minutes,
        COALESCE(SUM(r.evaluation_impact), 0)::DECIMAL(5,2) as total_evaluation_impact
    FROM notification_sla_records r
    WHERE r.employee_id = p_employee_id
      AND r.company_id = p_company_id;
END;
$$;


--
-- Name: get_escalation_chain(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_escalation_chain(p_current_level integer DEFAULT 1) RETURNS TABLE(staff_id uuid, staff_name text, email character varying, escalation_level integer, role_code character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        s.staff_id,
        (s.first_name || ' ' || s.last_name)::TEXT as staff_name,
        s.email,
        CASE
            WHEN r.role_code = 'CSUP' THEN 2
            WHEN r.role_code = 'DIR' THEN 3
            ELSE 1
        END as escalation_level,
        r.role_code
    FROM aponnt_staff s
    JOIN aponnt_staff_roles r ON s.role_id = r.role_id
    WHERE r.role_code IN ('CSUP', 'DIR')
      AND s.is_active = true
      AND CASE
            WHEN r.role_code = 'CSUP' THEN 2
            WHEN r.role_code = 'DIR' THEN 3
          END > p_current_level
    ORDER BY escalation_level ASC;
END;
$$;


--
-- Name: FUNCTION get_escalation_chain(p_current_level integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_escalation_chain(p_current_level integer) IS 'Obtiene la cadena de escalamiento desde un nivel dado';


--
-- Name: get_execution_summary(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_execution_summary(exec_id uuid) RETURNS TABLE(total_tests bigint, tests_passed bigint, tests_failed bigint, tests_warning bigint, avg_duration_ms numeric, execution_duration_seconds numeric, modules_tested text[])
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::BIGINT as total_tests,
        COUNT(*) FILTER (WHERE status IN ('passed', 'pass'))::BIGINT as tests_passed,
        COUNT(*) FILTER (WHERE status IN ('failed', 'fail'))::BIGINT as tests_failed,
        COUNT(*) FILTER (WHERE status = 'warning')::BIGINT as tests_warning,
        ROUND(AVG(duration_ms)::NUMERIC, 2) as avg_duration_ms,
        ROUND(EXTRACT(EPOCH FROM (MAX(completed_at) - MIN(started_at)))::NUMERIC, 2) as execution_duration_seconds,
        ARRAY_AGG(DISTINCT module_name ORDER BY module_name) as modules_tested
    FROM audit_test_logs
    WHERE execution_id = exec_id;
END;
$$;


--
-- Name: get_expiring_epp(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_expiring_epp(p_company_id integer, p_days_ahead integer DEFAULT 30) RETURNS TABLE(delivery_id integer, employee_id uuid, employee_name text, epp_name character varying, category_name character varying, delivery_date date, replacement_date date, days_remaining integer, status character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        d.id as delivery_id,
        d.employee_id,
        COALESCE(u.first_name || ' ' || u.last_name, 'N/A') as employee_name,
        c.name as epp_name,
        cat.name_es as category_name,
        d.delivery_date,
        d.calculated_replacement_date as replacement_date,
        (d.calculated_replacement_date - CURRENT_DATE)::INTEGER as days_remaining,
        d.status
    FROM epp_deliveries d
    JOIN epp_catalog c ON d.epp_catalog_id = c.id
    JOIN epp_categories cat ON c.category_id = cat.id
    LEFT JOIN users u ON d.employee_id = u.user_id
    WHERE d.company_id = p_company_id
      AND d.status = 'active'
      AND d.calculated_replacement_date <= (CURRENT_DATE + p_days_ahead)
    ORDER BY d.calculated_replacement_date ASC;
END;
$$;


--
-- Name: get_expiring_trials(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_expiring_trials(p_days_before integer DEFAULT 3) RETURNS TABLE(company_id integer, company_name character varying, module_key character varying, trial_end date, days_remaining integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    c.id,
    c.name,
    (elem->>'module_key')::VARCHAR,
    (elem->>'trial_end')::DATE,
    ((elem->>'trial_end')::DATE - CURRENT_DATE)::INTEGER AS days_remaining
  FROM companies c
  CROSS JOIN LATERAL jsonb_array_elements(c.modules_trial) AS elem
  WHERE
    (elem->>'status')::VARCHAR = 'ACTIVE'
    AND (elem->>'trial_end')::DATE >= CURRENT_DATE
    AND (elem->>'trial_end')::DATE <= (CURRENT_DATE + p_days_before)
  ORDER BY (elem->>'trial_end')::DATE ASC;
END;
$$;


--
-- Name: get_holidays_for_location(character varying, character varying, date, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_holidays_for_location(p_country character varying, p_state_province character varying DEFAULT NULL::character varying, p_start_date date DEFAULT NULL::date, p_end_date date DEFAULT NULL::date) RETURNS TABLE(holiday_date date, holiday_name character varying, is_national boolean, is_provincial boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        h.date,
        h.name,
        h.is_national,
        h.is_provincial
    FROM holidays h
    WHERE h.country = p_country
      AND (p_state_province IS NULL OR h.state_province IS NULL OR h.state_province = p_state_province)
      AND (p_start_date IS NULL OR h.date >= p_start_date)
      AND (p_end_date IS NULL OR h.date <= p_end_date)
    ORDER BY h.date;
END;
$$;


--
-- Name: get_hour_bank_account_statement(integer, uuid, date, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_hour_bank_account_statement(p_company_id integer, p_user_id uuid, p_from_date date DEFAULT NULL::date, p_to_date date DEFAULT NULL::date) RETURNS TABLE(transaction_date date, transaction_type character varying, description text, hours_debit numeric, hours_credit numeric, balance_after numeric, status character varying, reference_type character varying, reference_id uuid)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_running_balance DECIMAL := 0;
BEGIN
    RETURN QUERY
    WITH movements AS (
        -- Transacciones normales
        SELECT
            t.created_at::DATE as tx_date,
            t.transaction_type as tx_type,
            t.description as tx_desc,
            CASE WHEN t.transaction_type IN ('usage', 'redemption', 'adjustment') AND t.hours_final < 0
                 THEN ABS(t.hours_final) ELSE 0 END as debit,
            CASE WHEN t.transaction_type = 'accrual' OR t.hours_final > 0
                 THEN t.hours_final ELSE 0 END as credit,
            t.status as tx_status,
            t.source_type as ref_type,
            t.source_request_id as ref_id,
            t.created_at as order_date
        FROM hour_bank_transactions t
        WHERE t.company_id = p_company_id
        AND t.user_id = p_user_id
        AND t.status = 'completed'
        AND (p_from_date IS NULL OR t.created_at::DATE >= p_from_date)
        AND (p_to_date IS NULL OR t.created_at::DATE <= p_to_date)

        UNION ALL

        -- Solicitudes de canje pendientes (reservadas)
        SELECT
            r.created_at::DATE,
            'reserved'::VARCHAR,
            format('Canje solicitado para %s - %s', r.scheduled_date, r.status),
            r.hours_requested,
            0,
            r.status,
            'redemption_request',
            r.id,
            r.created_at
        FROM hour_bank_redemption_requests r
        WHERE r.company_id = p_company_id
        AND r.user_id = p_user_id
        AND r.status IN ('pending_supervisor', 'approved_supervisor', 'pending_hr', 'approved')
        AND (p_from_date IS NULL OR r.created_at::DATE >= p_from_date)
        AND (p_to_date IS NULL OR r.created_at::DATE <= p_to_date)
    )
    SELECT
        m.tx_date,
        m.tx_type,
        m.tx_desc,
        m.debit,
        m.credit,
        SUM(m.credit - m.debit) OVER (ORDER BY m.order_date, m.ref_id) as running_balance,
        m.tx_status,
        m.ref_type,
        m.ref_id
    FROM movements m
    ORDER BY m.order_date DESC, m.ref_id DESC;
END;
$$;


--
-- Name: get_hse_case_stats(integer, date, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_hse_case_stats(p_company_id integer, p_start_date date DEFAULT NULL::date, p_end_date date DEFAULT NULL::date) RETURNS TABLE(total_cases integer, pending_cases integer, in_progress_cases integer, closed_cases integer, cases_by_type jsonb, cases_by_severity jsonb, avg_resolution_days numeric, correlation_rate numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    COUNT(*)::INTEGER,
    COUNT(*) FILTER (WHERE investigation_status = 'PENDING')::INTEGER,
    COUNT(*) FILTER (WHERE investigation_status IN ('ASSIGNED', 'IN_PROGRESS', 'AWAITING_INFO'))::INTEGER,
    COUNT(*) FILTER (WHERE investigation_status = 'CLOSED')::INTEGER,
    JSONB_OBJECT_AGG(COALESCE(case_type, 'UNKNOWN'), type_count) as cases_by_type,
    JSONB_OBJECT_AGG(COALESCE(severity, 'UNKNOWN'), sev_count) as cases_by_severity,
    AVG(EXTRACT(DAY FROM (closed_at - created_at)))::DECIMAL(10,2),
    AVG(correlation_score)::DECIMAL(5,2)
  FROM hse_cases c
  LEFT JOIN LATERAL (
    SELECT case_type, COUNT(*) as type_count FROM hse_cases
    WHERE company_id = p_company_id GROUP BY case_type
  ) type_stats ON true
  LEFT JOIN LATERAL (
    SELECT severity, COUNT(*) as sev_count FROM hse_cases
    WHERE company_id = p_company_id GROUP BY severity
  ) sev_stats ON true
  WHERE c.company_id = p_company_id
    AND (p_start_date IS NULL OR c.created_at >= p_start_date)
    AND (p_end_date IS NULL OR c.created_at <= p_end_date)
  GROUP BY type_stats.case_type, type_stats.type_count, sev_stats.severity, sev_stats.sev_count
  LIMIT 1;
END;
$$;


--
-- Name: get_hse_dashboard_kpis(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_hse_dashboard_kpis(p_company_id integer) RETURNS TABLE(total_active_deliveries bigint, expiring_30_days bigint, expiring_7_days bigint, expired bigint, compliance_rate numeric, total_inspections_pending bigint, total_epp_in_catalog bigint, total_positions_with_epp bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        (SELECT COUNT(*) FROM epp_deliveries WHERE company_id = p_company_id AND status = 'active')::BIGINT,
        (SELECT COUNT(*) FROM epp_deliveries WHERE company_id = p_company_id AND status = 'active'
            AND calculated_replacement_date <= CURRENT_DATE + 30
            AND calculated_replacement_date > CURRENT_DATE)::BIGINT,
        (SELECT COUNT(*) FROM epp_deliveries WHERE company_id = p_company_id AND status = 'active'
            AND calculated_replacement_date <= CURRENT_DATE + 7
            AND calculated_replacement_date > CURRENT_DATE)::BIGINT,
        (SELECT COUNT(*) FROM epp_deliveries WHERE company_id = p_company_id AND status = 'active'
            AND calculated_replacement_date < CURRENT_DATE)::BIGINT,
        COALESCE(
            (SELECT
                ROUND(
                    (COUNT(*) FILTER (WHERE calculated_replacement_date >= CURRENT_DATE)::NUMERIC /
                    NULLIF(COUNT(*)::NUMERIC, 0)) * 100, 2
                )
            FROM epp_deliveries
            WHERE company_id = p_company_id AND status = 'active'
            ), 100.00
        ),
        (SELECT COUNT(*) FROM epp_inspections i
            JOIN epp_deliveries d ON i.delivery_id = d.id
            WHERE d.company_id = p_company_id
            AND i.action_required IS NOT NULL
            AND i.action_completed = false)::BIGINT,
        (SELECT COUNT(*) FROM epp_catalog WHERE company_id = p_company_id AND is_active = true)::BIGINT,
        (SELECT COUNT(DISTINCT position_id) FROM epp_role_requirements WHERE company_id = p_company_id)::BIGINT;
END;
$$;


--
-- Name: get_immediate_supervisor(integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_immediate_supervisor(p_company_id integer, p_user_id uuid) RETURNS TABLE(supervisor_id uuid, supervisor_name text, supervisor_email character varying)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_supervisor RECORD;
BEGIN
    -- Buscar supervisor/admin de la empresa
    SELECT
        u.user_id,
        u."firstName" || ' ' || u."lastName" as sup_name,
        u.email as sup_email
    INTO v_supervisor
    FROM users u
    WHERE u.company_id = p_company_id
    AND u.role IN ('admin', 'supervisor', 'rrhh')
    AND u.user_id != p_user_id
    AND (u."isActive" = true)
    ORDER BY
        CASE u.role
            WHEN 'supervisor' THEN 1
            WHEN 'rrhh' THEN 2
            WHEN 'admin' THEN 3
        END
    LIMIT 1;

    IF v_supervisor IS NOT NULL THEN
        RETURN QUERY SELECT v_supervisor.user_id, v_supervisor.sup_name, v_supervisor.sup_email;
    END IF;
END;
$$;


--
-- Name: get_legal_case_summary(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_legal_case_summary(p_case_id integer) RETURNS TABLE(case_id integer, case_number character varying, case_type character varying, current_stage character varying, employee_name character varying, claimed_amount numeric, days_open integer, pending_deadlines bigint, total_documents bigint, last_event_date timestamp without time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        lc.id,
        lc.case_number,
        lc.case_type,
        lc.current_stage,
        lc.employee_name,
        lc.claimed_amount,
        EXTRACT(DAY FROM NOW() - lc.created_at)::INTEGER as days_open,
        (SELECT COUNT(*) FROM legal_deadlines ld WHERE ld.case_id = lc.id AND ld.status = 'pending'),
        (SELECT COUNT(*) FROM legal_case_documents lcd WHERE lcd.case_id = lc.id),
        (SELECT MAX(event_date) FROM legal_case_timeline_events lte WHERE lte.case_id = lc.id)
    FROM legal_cases lc
    WHERE lc.id = p_case_id;
END;
$$;


--
-- Name: get_legal_dashboard_stats(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_legal_dashboard_stats(p_company_id integer) RETURNS TABLE(total_cases bigint, active_cases bigint, cases_by_stage jsonb, cases_by_type jsonb, pending_deadlines bigint, overdue_deadlines bigint, total_exposure numeric, avg_case_duration_days numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        (SELECT COUNT(*) FROM legal_cases WHERE company_id = p_company_id),
        (SELECT COUNT(*) FROM legal_cases WHERE company_id = p_company_id AND is_active = TRUE),
        (SELECT jsonb_object_agg(current_stage, cnt) FROM (
            SELECT current_stage, COUNT(*) as cnt
            FROM legal_cases WHERE company_id = p_company_id AND is_active = TRUE
            GROUP BY current_stage
        ) s),
        (SELECT jsonb_object_agg(case_type, cnt) FROM (
            SELECT case_type, COUNT(*) as cnt
            FROM legal_cases WHERE company_id = p_company_id
            GROUP BY case_type
        ) t),
        (SELECT COUNT(*) FROM legal_deadlines WHERE company_id = p_company_id AND status = 'pending'),
        (SELECT COUNT(*) FROM legal_deadlines WHERE company_id = p_company_id AND status = 'pending' AND due_date < NOW()),
        (SELECT COALESCE(SUM(estimated_exposure), 0) FROM legal_cases WHERE company_id = p_company_id AND is_active = TRUE),
        (SELECT AVG(EXTRACT(DAY FROM COALESCE(closed_at, NOW()) - created_at))
         FROM legal_cases WHERE company_id = p_company_id);
END;
$$;


--
-- Name: get_medical_records_stats(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_medical_records_stats(p_company_id integer, p_employee_id integer DEFAULT NULL::integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_stats JSONB;
BEGIN
    SELECT jsonb_build_object(
        'total_records', COUNT(*),
        'by_type', jsonb_object_agg(
            COALESCE(record_type, 'unknown'),
            type_count
        ),
        'by_result', jsonb_object_agg(
            COALESCE(result, 'sin_resultado'),
            result_count
        ),
        'locked_records', SUM(CASE WHEN is_locked THEN 1 ELSE 0 END),
        'pending_authorizations', (
            SELECT COUNT(*) FROM medical_edit_authorizations
            WHERE company_id = p_company_id AND status = 'pending'
        ),
        'expiring_soon', SUM(
            CASE WHEN expiration_date BETWEEN CURRENT_DATE AND CURRENT_DATE + 30
            THEN 1 ELSE 0 END
        )
    )
    INTO v_stats
    FROM (
        SELECT
            record_type,
            result,
            is_locked,
            expiration_date,
            COUNT(*) OVER (PARTITION BY record_type) as type_count,
            COUNT(*) OVER (PARTITION BY result) as result_count
        FROM medical_records
        WHERE
            company_id = p_company_id
            AND is_deleted = false
            AND (p_employee_id IS NULL OR employee_id = p_employee_id)
    ) subq;

    RETURN COALESCE(v_stats, '{}'::JSONB);
END;
$$;


--
-- Name: FUNCTION get_medical_records_stats(p_company_id integer, p_employee_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_medical_records_stats(p_company_id integer, p_employee_id integer) IS 'Obtiene estadisticas de registros medicos por empresa/empleado';


--
-- Name: get_module_health(character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_module_health(mod_name character varying, days_back integer DEFAULT 7) RETURNS TABLE(module_name character varying, health_score numeric, total_tests bigint, success_rate numeric, avg_duration_ms numeric, last_test_at timestamp with time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        mod_name as module_name,
        CASE
            WHEN COUNT(*) = 0 THEN 0
            ELSE ROUND((COUNT(*) FILTER (WHERE status IN ('passed', 'pass'))::NUMERIC / COUNT(*)::NUMERIC * 100), 2)
        END as health_score,
        COUNT(*)::BIGINT as total_tests,
        CASE
            WHEN COUNT(*) = 0 THEN 0
            ELSE ROUND((COUNT(*) FILTER (WHERE status IN ('passed', 'pass'))::NUMERIC / COUNT(*)::NUMERIC * 100), 2)
        END as success_rate,
        ROUND(AVG(duration_ms)::NUMERIC, 2) as avg_duration_ms,
        MAX(started_at) as last_test_at
    FROM audit_test_logs
    WHERE module_name = mod_name
      AND created_at >= NOW() - INTERVAL '1 day' * days_back;
END;
$$;


--
-- Name: get_next_comprobante_number(integer, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_next_comprobante_number(p_company_id integer, p_punto_venta integer, p_tipo_comprobante integer) RETURNS integer
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_next_number INTEGER;
    v_column_name VARCHAR;
BEGIN
    -- Determinar qu columna actualizar segn tipo de comprobante
    v_column_name := CASE p_tipo_comprobante
        WHEN 1 THEN 'ultimo_numero_factura_a'
        WHEN 6 THEN 'ultimo_numero_factura_b'
        WHEN 11 THEN 'ultimo_numero_factura_c'
        WHEN 3 THEN 'ultimo_numero_nc_a'
        WHEN 8 THEN 'ultimo_numero_nc_b'
        WHEN 13 THEN 'ultimo_numero_nc_c'
        WHEN 2 THEN 'ultimo_numero_nd_a'
        WHEN 7 THEN 'ultimo_numero_nd_b'
        WHEN 12 THEN 'ultimo_numero_nd_c'
        ELSE NULL
    END;

    IF v_column_name IS NULL THEN
        RAISE EXCEPTION 'Tipo de comprobante % no soportado', p_tipo_comprobante;
    END IF;

    -- Obtener y actualizar el prximo nmero (atomic)
    EXECUTE format('
        UPDATE branch_offices_fiscal
        SET %I = %I + 1
        WHERE company_id = $1 AND punto_venta = $2
        RETURNING %I
    ', v_column_name, v_column_name, v_column_name)
    INTO v_next_number
    USING p_company_id, p_punto_venta;

    RETURN v_next_number;
END;
$_$;


--
-- Name: get_pending_consents(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_consents(p_user_id integer, p_user_type character varying) RETURNS TABLE(consent_id uuid, consent_key character varying, title character varying, description text, is_required boolean, category character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        cd.consent_id,
        cd.consent_key,
        cd.title,
        cd.description,
        cd.is_required,
        cd.category
    FROM consent_definitions cd
    WHERE cd.is_active = true
    AND p_user_type = ANY(cd.applicable_roles)
    AND NOT EXISTS (
        SELECT 1 FROM user_consents uc
        WHERE uc.user_id = p_user_id
        AND uc.user_type = p_user_type
        AND uc.consent_id = cd.consent_id
        AND uc.status IN ('accepted', 'pending')
    )
    ORDER BY cd.is_required DESC, cd.created_at ASC;
END;
$$;


--
-- Name: FUNCTION get_pending_consents(p_user_id integer, p_user_type character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_pending_consents(p_user_id integer, p_user_type character varying) IS 'Obtiene consentimientos pendientes de un usuario segn su tipo';


--
-- Name: get_pending_legal_authorizations(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_legal_authorizations(p_company_id integer, p_step integer DEFAULT NULL::integer) RETURNS TABLE(auth_id integer, record_id integer, record_table character varying, record_type character varying, requested_by uuid, requestor_name character varying, request_reason text, action_type character varying, priority character varying, status character varying, current_step integer, created_at timestamp without time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        la.id as auth_id,
        la.record_id,
        la.record_table,
        la.record_type,
        la.requested_by,
        u.name as requestor_name,
        la.request_reason,
        la.action_type::VARCHAR,
        la.priority::VARCHAR,
        la.status::VARCHAR,
        la.current_step,
        la.created_at
    FROM legal_edit_authorizations la
    JOIN users u ON la.requested_by = u.user_id
    WHERE la.company_id = p_company_id
      AND la.status IN ('pending', 'escalated')
      AND (p_step IS NULL OR la.current_step = p_step)
    ORDER BY
        CASE la.priority
            WHEN 'urgent' THEN 1
            WHEN 'high' THEN 2
            WHEN 'normal' THEN 3
            WHEN 'low' THEN 4
        END,
        la.requested_at ASC;
END;
$$;


--
-- Name: get_pending_notifications_for_employee(character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_notifications_for_employee(p_employee_id character varying, p_company_id integer) RETURNS TABLE(message_id uuid, group_id uuid, subject character varying, content text, sender_name character varying, deadline_at timestamp without time zone, hours_remaining integer, is_overdue boolean, escalation_status character varying, requires_response boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        m.id as message_id,
        m.group_id,
        g.subject,
        m.content,
        m.sender_name,
        m.deadline_at,
        EXTRACT(EPOCH FROM (m.deadline_at - NOW()) / 3600)::INTEGER as hours_remaining,
        (m.deadline_at < NOW()) as is_overdue,
        m.escalation_status,
        m.requires_response
    FROM notification_messages m
    JOIN notification_groups g ON g.id = m.group_id
    WHERE m.recipient_id = p_employee_id
      AND m.company_id = p_company_id
      AND m.requires_response = TRUE
      AND m.responded_at IS NULL
      AND m.is_deleted = FALSE
    ORDER BY
        (m.deadline_at < NOW()) DESC,
        m.deadline_at ASC;
END;
$$;


--
-- Name: get_pending_partners(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_partners() RETURNS TABLE(id uuid, first_name character varying, last_name character varying, dni character varying, email character varying, phone character varying, partner_role_id uuid, role_name character varying, created_at timestamp without time zone, documents_count bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    p.id,
    p.first_name,
    p.last_name,
    p.dni,
    p.email,
    p.phone,
    p.partner_role_id,
    pr.name AS role_name,
    p.created_at,
    COUNT(pd.id) AS documents_count
  FROM partners p
  LEFT JOIN partner_roles pr ON p.partner_role_id = pr.id
  LEFT JOIN partner_documents pd ON p.id = pd.partner_id
  WHERE p.approval_status = 'pending'
    AND p.is_active = true
  GROUP BY p.id, pr.name
  ORDER BY p.created_at DESC;
END;
$$;


--
-- Name: FUNCTION get_pending_partners(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_pending_partners() IS 'Retorna lista de partners pendientes de aprobacin con metadata';


--
-- Name: get_pending_tasks_for_admin(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_tasks_for_admin(p_admin_id uuid DEFAULT NULL::uuid, p_limit integer DEFAULT 50) RETURNS TABLE(task_id uuid, task_type character varying, title character varying, priority character varying, due_date date, created_at timestamp without time zone, days_pending integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    id,
    administrative_tasks.task_type,
    administrative_tasks.title,
    administrative_tasks.priority,
    administrative_tasks.due_date,
    administrative_tasks.created_at,
    EXTRACT(DAY FROM (CURRENT_TIMESTAMP - administrative_tasks.created_at))::INTEGER AS days_pending
  FROM administrative_tasks
  WHERE
    status IN ('PENDING', 'ASSIGNED', 'IN_PROGRESS')
    AND (p_admin_id IS NULL OR assigned_to = p_admin_id OR assigned_to IS NULL)
  ORDER BY
    CASE administrative_tasks.priority
      WHEN 'CRITICAL' THEN 1
      WHEN 'HIGH' THEN 2
      WHEN 'NORMAL' THEN 3
      WHEN 'LOW' THEN 4
    END,
    administrative_tasks.created_at ASC
  LIMIT p_limit;
END;
$$;


--
-- Name: get_pending_tickets_for_claude(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_pending_tickets_for_claude() RETURNS TABLE(ticket_number character varying, priority character varying, module_name character varying, error_message text, file_path character varying, line_number integer, created_at timestamp with time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    t.ticket_number,
    t.priority,
    t.module_name,
    t.error_message,
    t.file_path,
    t.line_number,
    t.created_at
  FROM testing_tickets t
  WHERE t.status IN ('PENDING_REPAIR', 'REOPENED')
    AND t.assigned_to = 'claude-code'
  ORDER BY
    CASE t.priority
      WHEN 'critical' THEN 1
      WHEN 'high' THEN 2
      WHEN 'medium' THEN 3
      WHEN 'low' THEN 4
    END,
    t.created_at ASC;
END;
$$;


--
-- Name: FUNCTION get_pending_tickets_for_claude(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_pending_tickets_for_claude() IS 'Tickets que Claude Code debe reparar al abrir sesin';


--
-- Name: get_presupuestos_para_facturar(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_presupuestos_para_facturar() RETURNS TABLE(presupuesto_id integer, company_id integer, numero_presupuesto character varying, cliente_razon_social character varying, proximo_periodo date, frecuencia character varying, total_presupuesto numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT p.id, p.company_id, p.numero_presupuesto, p.cliente_razon_social,
           p.proximo_periodo_facturacion, p.frecuencia_facturacion, p.total_presupuesto
    FROM siac_presupuestos p
    WHERE p.tipo_facturacion = 'RECURRENTE'
      AND p.estado = 'ACTIVO'
      AND p.proximo_periodo_facturacion <= CURRENT_DATE
      AND (p.fecha_fin_facturacion IS NULL OR p.fecha_fin_facturacion >= CURRENT_DATE)
    ORDER BY p.proximo_periodo_facturacion ASC;
END;
$$;


--
-- Name: get_procedure_ack_stats(uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_ack_stats(p_procedure_id uuid, p_version_id uuid DEFAULT NULL::uuid) RETURNS TABLE(total_users integer, acknowledged integer, pending integer, expired integer, ack_percentage numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::INTEGER as total_users,
        COUNT(CASE WHEN pa.status = 'acknowledged' THEN 1 END)::INTEGER as acknowledged,
        COUNT(CASE WHEN pa.status = 'pending' THEN 1 END)::INTEGER as pending,
        COUNT(CASE WHEN pa.status = 'expired' THEN 1 END)::INTEGER as expired,
        ROUND(
            COUNT(CASE WHEN pa.status = 'acknowledged' THEN 1 END)::NUMERIC /
            NULLIF(COUNT(*)::NUMERIC, 0) * 100, 2
        ) as ack_percentage
    FROM procedure_acknowledgements pa
    WHERE pa.procedure_id = p_procedure_id
      AND (p_version_id IS NULL OR pa.procedure_version_id = p_version_id);
END;
$$;


--
-- Name: get_procedure_ancestors(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_ancestors(p_procedure_id uuid) RETURNS TABLE(id uuid, code character varying, title character varying, type character varying, hierarchy_level integer, depth integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    WITH RECURSIVE tree AS (
        -- Base: el documento actual
        SELECT
            p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id,
            0 as depth
        FROM procedures p
        WHERE p.id = p_procedure_id

        UNION ALL

        -- Recursivo: padres
        SELECT
            p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id,
            t.depth - 1
        FROM procedures p
        INNER JOIN tree t ON p.id = t.parent_id
    )
    SELECT tree.id, tree.code, tree.title, tree.type, tree.hierarchy_level, tree.depth
    FROM tree
    WHERE tree.depth < 0  -- Excluir el documento actual
    ORDER BY tree.depth;  -- Ms ancestral primero
END;
$$;


--
-- Name: get_procedure_children(uuid, boolean); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_children(p_procedure_id uuid, p_recursive boolean DEFAULT false) RETURNS TABLE(id uuid, code character varying, title character varying, type character varying, hierarchy_level integer, parent_id uuid, status character varying, depth integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF p_recursive THEN
        -- Recursivo: todos los descendientes
        RETURN QUERY
        WITH RECURSIVE tree AS (
            -- Base: hijos directos
            SELECT
                p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id, p.status,
                1 as depth
            FROM procedures p
            WHERE p.parent_id = p_procedure_id

            UNION ALL

            -- Recursivo: hijos de hijos
            SELECT
                p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id, p.status,
                t.depth + 1
            FROM procedures p
            INNER JOIN tree t ON p.parent_id = t.id
        )
        SELECT * FROM tree ORDER BY depth, code;
    ELSE
        -- Solo hijos directos
        RETURN QUERY
        SELECT
            p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id, p.status,
            1 as depth
        FROM procedures p
        WHERE p.parent_id = p_procedure_id
        ORDER BY p.code;
    END IF;
END;
$$;


--
-- Name: get_procedure_scope_users(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_scope_users(p_procedure_id uuid, p_company_id integer) RETURNS TABLE(user_id uuid, employee_id character varying, full_name character varying, email character varying, department_name character varying, position_name character varying, branch_name character varying)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_scope_type procedure_scope_type;
    v_scope_entities JSONB;
BEGIN
    -- Obtener tipo de alcance y entidades del procedimiento
    SELECT p.scope_type, COALESCE(p.scope_entities, '[]'::jsonb)
    INTO v_scope_type, v_scope_entities
    FROM procedures p
    WHERE p.id = p_procedure_id;

    RETURN QUERY
    SELECT DISTINCT
        u.user_id,
        u."employeeId" as employee_id,
        u."firstName" || ' ' || u."lastName" as full_name,
        u.email,
        COALESCE(d.name, 'Sin departamento') as department_name,
        COALESCE(op.position_name, 'Sin cargo') as position_name,
        COALESCE(b.name, 'Sin sucursal') as branch_name
    FROM users u
    LEFT JOIN departments d ON u.department_id = d.id
    LEFT JOIN organizational_positions op ON u.organizational_position_id = op.id
    LEFT JOIN branches b ON u.branch_id = b.id
    LEFT JOIN sectors s ON u.sector_id = s.id
    WHERE u.company_id = p_company_id
      AND u.is_active = true
      AND (
        -- Toda la empresa
        (v_scope_type = 'company')
        OR
        -- Sucursales especficas
        (v_scope_type = 'branch' AND u.branch_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(v_scope_entities) AS value
        ))
        OR
        -- Departamentos especficos
        (v_scope_type = 'department' AND u.department_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(v_scope_entities) AS value
        ))
        OR
        -- Sectores especficos
        (v_scope_type = 'sector' AND u.sector_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(v_scope_entities) AS value
        ))
        OR
        -- Roles especficos
        (v_scope_type = 'role' AND u.role IN (
            SELECT value->>'id' FROM jsonb_array_elements(v_scope_entities) AS value
        ))
        OR
        -- Cargos organizacionales especficos
        (v_scope_type = 'position' AND u.organizational_position_id IN (
            SELECT (value->>'id')::INTEGER FROM jsonb_array_elements(v_scope_entities) AS value
        ))
        OR
        -- Usuarios especficos
        (v_scope_type = 'users' AND u.user_id IN (
            SELECT (value->>'id')::UUID FROM jsonb_array_elements(v_scope_entities) AS value
        ))
      );
END;
$$;


--
-- Name: get_procedure_target_users(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_target_users(p_procedure_id uuid) RETURNS TABLE(user_id uuid, employee_id character varying, full_name character varying, position_name character varying, department_name character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT DISTINCT
        u.user_id,
        u."employeeId" as employee_id,
        u."firstName" || ' ' || u."lastName" as full_name,
        op.position_name,
        d.name as department_name
    FROM users u
    LEFT JOIN organizational_positions op ON u.organizational_position_id = op.id
    LEFT JOIN departments d ON u.department_id = d.id
    INNER JOIN procedure_roles pr ON pr.organizational_position_id = op.id
    WHERE pr.procedure_id = p_procedure_id
      AND u.is_active = true
      AND u.company_id = (SELECT company_id FROM procedures WHERE id = p_procedure_id);
END;
$$;


--
-- Name: get_procedure_tree(integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_procedure_tree(p_company_id integer, p_root_id uuid DEFAULT NULL::uuid) RETURNS TABLE(id uuid, code character varying, title character varying, type character varying, hierarchy_level integer, parent_id uuid, status character varying, children_count bigint, has_children boolean, tree_path text, indent_level integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    WITH RECURSIVE tree AS (
        -- Base: polticas (races) o documento especfico
        SELECT
            p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id, p.status,
            p.code::TEXT as tree_path,
            0 as indent_level
        FROM procedures p
        WHERE p.company_id = p_company_id
          AND (
            (p_root_id IS NULL AND p.hierarchy_level = 1)
            OR p.id = p_root_id
          )

        UNION ALL

        -- Recursivo: hijos
        SELECT
            p.id, p.code, p.title, p.type, p.hierarchy_level, p.parent_id, p.status,
            t.tree_path || ' > ' || p.code,
            t.indent_level + 1
        FROM procedures p
        INNER JOIN tree t ON p.parent_id = t.id
        WHERE p.company_id = p_company_id
    )
    SELECT
        tree.id, tree.code, tree.title, tree.type, tree.hierarchy_level, tree.parent_id, tree.status,
        (SELECT COUNT(*) FROM procedures c WHERE c.parent_id = tree.id) as children_count,
        EXISTS(SELECT 1 FROM procedures c WHERE c.parent_id = tree.id) as has_children,
        tree.tree_path,
        tree.indent_level
    FROM tree
    ORDER BY tree.tree_path;
END;
$$;


--
-- Name: get_sanction_stats(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_sanction_stats(p_company_id integer, p_period_days integer DEFAULT 30) RETURNS TABLE(total_sanctions bigint, pending_lawyer bigint, pending_hr bigint, active bigint, rejected bigint, appealed bigint, by_severity jsonb, by_category jsonb, total_suspension_days bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::BIGINT AS total_sanctions,
        COUNT(*) FILTER (WHERE workflow_status = 'pending_lawyer')::BIGINT AS pending_lawyer,
        COUNT(*) FILTER (WHERE workflow_status = 'pending_hr')::BIGINT AS pending_hr,
        COUNT(*) FILTER (WHERE workflow_status = 'active')::BIGINT AS active,
        COUNT(*) FILTER (WHERE workflow_status = 'rejected')::BIGINT AS rejected,
        COUNT(*) FILTER (WHERE workflow_status = 'appealed')::BIGINT AS appealed,
        jsonb_build_object(
            'warning', COUNT(*) FILTER (WHERE severity = 'warning'),
            'minor', COUNT(*) FILTER (WHERE severity = 'minor'),
            'major', COUNT(*) FILTER (WHERE severity = 'major'),
            'severe', COUNT(*) FILTER (WHERE severity = 'severe'),
            'termination', COUNT(*) FILTER (WHERE severity = 'termination')
        ) AS by_severity,
        jsonb_build_object(
            'attendance', COUNT(*) FILTER (WHERE st.category = 'attendance'),
            'behavior', COUNT(*) FILTER (WHERE st.category = 'behavior'),
            'performance', COUNT(*) FILTER (WHERE st.category = 'performance'),
            'safety', COUNT(*) FILTER (WHERE st.category = 'safety'),
            'training', COUNT(*) FILTER (WHERE st.category = 'training'),
            'other', COUNT(*) FILTER (WHERE st.category = 'other' OR st.category IS NULL)
        ) AS by_category,
        COALESCE(SUM(COALESCE(s.suspension_days, 0)), 0)::BIGINT AS total_suspension_days
    FROM sanctions s
    LEFT JOIN sanction_types st ON st.id = s.sanction_type_id
    WHERE s.company_id = p_company_id
      AND s.created_at >= NOW() - (p_period_days || ' days')::INTERVAL;
END;
$$;


--
-- Name: FUNCTION get_sanction_stats(p_company_id integer, p_period_days integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_sanction_stats(p_company_id integer, p_period_days integer) IS 'Estadsticas de sanciones por empresa en un perodo';


--
-- Name: get_screening_types_for_country(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_screening_types_for_country(p_country_code character varying) RETURNS TABLE(id integer, code character varying, name_i18n jsonb, category character varying, is_mandatory boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        st.id,
        st.code,
        st.name_i18n,
        st.category,
        st.is_mandatory
    FROM oh_screening_types st
    WHERE st.is_active = true
      AND st.deleted_at IS NULL
      AND (
          '*' = ANY(st.country_codes)
          OR p_country_code = ANY(st.country_codes)
      )
    ORDER BY st.display_order, st.code;
END;
$$;


--
-- Name: get_staff_commission_summary(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_staff_commission_summary(p_staff_id uuid, p_month integer DEFAULT NULL::integer, p_year integer DEFAULT NULL::integer) RETURNS TABLE(staff_id uuid, staff_name character varying, role_code character varying, role_name character varying, direct_sales_commission numeric, direct_support_commission numeric, pyramid_commission numeric, total_commission numeric, companies_count integer, subordinates_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_direct_sales DECIMAL(12,2);
  v_direct_support DECIMAL(12,2);
  v_pyramid DECIMAL(12,2);
  v_staff_name VARCHAR;
  v_role_code VARCHAR;
  v_role_name VARCHAR;
  v_companies_count INTEGER;
  v_subordinates_count INTEGER;
BEGIN
  -- Obtener datos bsicos del staff
  SELECT s.first_name || ' ' || s.last_name, r.role_code, r.role_name
  INTO v_staff_name, v_role_code, v_role_name
  FROM aponnt_staff s
  INNER JOIN aponnt_staff_roles r ON s.role_id = r.role_id
  WHERE s.staff_id = p_staff_id;

  -- Si no se encontr el staff
  IF NOT FOUND THEN
    RETURN;
  END IF;

  -- Calcular comisiones directas de ventas
  SELECT COALESCE(SUM(sales_commission_usd), 0) INTO v_direct_sales
  FROM companies
  WHERE assigned_vendor_id = p_staff_id
    AND is_active = true
    AND (p_month IS NULL OR EXTRACT(MONTH FROM created_at) = p_month)
    AND (p_year IS NULL OR EXTRACT(YEAR FROM created_at) = p_year);

  -- Calcular comisiones directas de soporte
  SELECT COALESCE(SUM(support_commission_usd), 0) INTO v_direct_support
  FROM companies
  WHERE support_vendor_id = p_staff_id
    AND is_active = true
    AND (p_month IS NULL OR EXTRACT(MONTH FROM created_at) = p_month)
    AND (p_year IS NULL OR EXTRACT(YEAR FROM created_at) = p_year);

  -- Calcular comisin piramidal
  v_pyramid := calculate_pyramid_commission(p_staff_id, p_month, p_year);

  -- Contar empresas asignadas
  SELECT COUNT(*) INTO v_companies_count
  FROM companies
  WHERE (assigned_vendor_id = p_staff_id OR support_vendor_id = p_staff_id)
    AND is_active = true;

  -- Contar subordinados directos
  SELECT COUNT(*) INTO v_subordinates_count
  FROM aponnt_staff
  WHERE reports_to_staff_id = p_staff_id
    AND is_active = true;

  -- Retornar fila con resumen
  RETURN QUERY SELECT
    p_staff_id,
    v_staff_name,
    v_role_code,
    v_role_name,
    v_direct_sales,
    v_direct_support,
    v_pyramid,
    v_direct_sales + v_direct_support + v_pyramid AS total,
    v_companies_count,
    v_subordinates_count;
END;
$$;


--
-- Name: FUNCTION get_staff_commission_summary(p_staff_id uuid, p_month integer, p_year integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_staff_commission_summary(p_staff_id uuid, p_month integer, p_year integer) IS 'Retorna resumen completo de comisiones de un staff (ventas + soporte + piramidal).
   Incluye conteo de empresas y subordinados directos.';


--
-- Name: get_staff_companies(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_staff_companies(p_staff_id uuid) RETURNS TABLE(company_id integer, company_name character varying, company_slug character varying, assigned_at timestamp without time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    c.company_id,
    c.name,
    c.slug,
    sc.assigned_at
  FROM aponnt_staff_companies sc
  JOIN companies c ON sc.company_id = c.company_id
  WHERE sc.staff_id = p_staff_id
    AND sc.is_active = true
    AND c.is_active = true
  ORDER BY c.name;
END;
$$;


--
-- Name: FUNCTION get_staff_companies(p_staff_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_staff_companies(p_staff_id uuid) IS 'Retorna lista de empresas asignadas a un staff';


--
-- Name: get_staff_subordinates_recursive(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_staff_subordinates_recursive(p_staff_id uuid, p_max_depth integer DEFAULT 10) RETURNS TABLE(staff_id uuid, staff_name character varying, role_code character varying, level integer, depth integer, path text[])
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  WITH RECURSIVE subordinates_hierarchy AS (
    -- Caso base: el staff mismo (depth = 0)
    SELECT
      s.staff_id,
      s.first_name || ' ' || s.last_name AS staff_name,
      r.role_code,
      s.level,
      0 AS depth,
      ARRAY[s.staff_id] AS path
    FROM aponnt_staff s
    INNER JOIN aponnt_staff_roles r ON s.role_id = r.role_id
    WHERE s.staff_id = p_staff_id

    UNION ALL

    -- Caso recursivo: todos los que reportan directamente
    SELECT
      s.staff_id,
      s.first_name || ' ' || s.last_name AS staff_name,
      r.role_code,
      s.level,
      sh.depth + 1,
      sh.path || s.staff_id
    FROM aponnt_staff s
    INNER JOIN aponnt_staff_roles r ON s.role_id = r.role_id
    INNER JOIN subordinates_hierarchy sh ON s.reports_to_staff_id = sh.staff_id
    WHERE s.is_active = true
      AND sh.depth < p_max_depth
      AND NOT (s.staff_id = ANY(sh.path))  -- Evitar loops
  )
  SELECT * FROM subordinates_hierarchy
  WHERE depth > 0  -- Excluir al staff mismo
  ORDER BY depth, staff_name;
END;
$$;


--
-- Name: FUNCTION get_staff_subordinates_recursive(p_staff_id uuid, p_max_depth integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_staff_subordinates_recursive(p_staff_id uuid, p_max_depth integer) IS 'Retorna TODOS los subordinados de un staff de forma recursiva (jerarqua completa).
   Incluye depth (profundidad) y path (ruta jerrquica) para evitar loops infinitos.';


--
-- Name: get_staff_with_complete_bank_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_staff_with_complete_bank_data() RETURNS TABLE(staff_id uuid, staff_name character varying, email character varying, payment_method character varying, cbu character varying, bank_name character varying, bank_data_verified boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    id,
    name,
    aponnt_staff.email,
    payment_method_preference,
    aponnt_staff.cbu,
    aponnt_staff.bank_name,
    aponnt_staff.bank_data_verified
  FROM aponnt_staff
  WHERE
    is_active = TRUE
    AND (
      (payment_method_preference = 'TRANSFERENCIA' AND aponnt_staff.cbu IS NOT NULL) OR
      (payment_method_preference = 'VIRTUAL_WALLET' AND virtual_wallet_provider IS NOT NULL) OR
      payment_method_preference IN ('CHEQUE', 'EFECTIVO')
    )
  ORDER BY name;
END;
$$;


--
-- Name: get_staff_without_bank_data(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_staff_without_bank_data() RETURNS TABLE(staff_id uuid, staff_name character varying, email character varying, role character varying, payment_method character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    id,
    name,
    aponnt_staff.email,
    aponnt_staff.role,
    payment_method_preference
  FROM aponnt_staff
  WHERE
    is_active = TRUE
    AND (
      (payment_method_preference = 'TRANSFERENCIA' AND aponnt_staff.cbu IS NULL AND account_number IS NULL) OR
      (payment_method_preference = 'VIRTUAL_WALLET' AND (virtual_wallet_provider IS NULL OR virtual_wallet_account IS NULL))
    )
  ORDER BY name;
END;
$$;


--
-- Name: get_testing_metrics(integer, character varying, character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_testing_metrics(p_company_id integer DEFAULT NULL::integer, p_environment character varying DEFAULT NULL::character varying, p_module character varying DEFAULT NULL::character varying, p_days integer DEFAULT 30) RETURNS TABLE(total_executions bigint, successful_executions bigint, failed_executions bigint, avg_success_rate numeric, avg_duration numeric, total_tests bigint, total_errors bigint, total_tickets bigint)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::BIGINT as total_executions,
        COUNT(*) FILTER (WHERE status = 'completed' AND success_rate >= 80)::BIGINT as successful_executions,
        COUNT(*) FILTER (WHERE status IN ('failed', 'error') OR success_rate < 80)::BIGINT as failed_executions,
        ROUND(AVG(success_rate), 2) as avg_success_rate,
        ROUND(AVG(duration_seconds), 2) as avg_duration,
        SUM(total_tests)::BIGINT as total_tests,
        SUM(jsonb_array_length(COALESCE(errors, '[]'::jsonb)))::BIGINT as total_errors,
        SUM(jsonb_array_length(COALESCE(tickets, '[]'::jsonb)))::BIGINT as total_tickets
    FROM test_executions
    WHERE created_at >= NOW() - (p_days || ' days')::INTERVAL
    AND (p_company_id IS NULL OR company_id = p_company_id)
    AND (p_environment IS NULL OR environment = p_environment)
    AND (p_module IS NULL OR module = p_module);
END;
$$;


--
-- Name: get_ticket_stats(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_ticket_stats() RETURNS TABLE(total_tickets integer, pending_repair integer, in_repair integer, fixed_pending_retest integer, closed integer, blocked integer, avg_time_to_fix_minutes numeric, avg_time_to_close_minutes numeric, success_rate numeric)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    COUNT(*)::INTEGER AS total_tickets,
    COUNT(*) FILTER (WHERE status = 'PENDING_REPAIR')::INTEGER,
    COUNT(*) FILTER (WHERE status = 'IN_REPAIR')::INTEGER,
    COUNT(*) FILTER (WHERE status = 'FIXED')::INTEGER,
    COUNT(*) FILTER (WHERE status = 'CLOSED')::INTEGER,
    COUNT(*) FILTER (WHERE status = 'BLOCKED')::INTEGER,
    ROUND(AVG(time_to_fix_minutes), 2) AS avg_time_to_fix,
    ROUND(AVG(time_to_close_minutes), 2) AS avg_time_to_close,
    ROUND(
      (COUNT(*) FILTER (WHERE status = 'CLOSED')::NUMERIC / NULLIF(COUNT(*), 0)) * 100,
      2
    ) AS success_rate
  FROM testing_tickets;
END;
$$;


--
-- Name: FUNCTION get_ticket_stats(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_ticket_stats() IS 'Estadsticas del sistema de tickets';


--
-- Name: get_tickets_for_retest(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_tickets_for_retest() RETURNS TABLE(ticket_number character varying, module_name character varying, test_name character varying, test_type character varying, test_context jsonb, fix_description text)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    t.ticket_number,
    t.module_name,
    t.test_name,
    t.test_type,
    t.test_context,
    t.fix_description
  FROM testing_tickets t
  WHERE t.status = 'FIXED'
    AND t.retest_count < 3  -- Mximo 3 intentos de re-test
  ORDER BY t.priority DESC, t.updated_at ASC;
END;
$$;


--
-- Name: FUNCTION get_tickets_for_retest(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_tickets_for_retest() IS 'Tickets que Ollama debe re-testear despus de fix';


--
-- Name: get_unread_account_notifications(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_unread_account_notifications(p_company_id integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (
        SELECT COUNT(*)
        FROM company_account_notifications
        WHERE company_id = p_company_id
          AND is_read = false
          AND dismissed_at IS NULL
    );
END;
$$;


--
-- Name: get_upcoming_legal_deadlines(integer, integer, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_upcoming_legal_deadlines(p_company_id integer, p_days_ahead integer DEFAULT 7, p_user_id uuid DEFAULT NULL::uuid) RETURNS TABLE(deadline_id integer, case_id integer, case_number character varying, deadline_type character varying, title character varying, due_date timestamp without time zone, days_remaining integer, priority character varying, assigned_to uuid)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        ld.id,
        ld.case_id,
        lc.case_number,
        ld.deadline_type,
        ld.title,
        ld.due_date,
        EXTRACT(DAY FROM ld.due_date - NOW())::INTEGER as days_remaining,
        ld.priority,
        ld.assigned_to
    FROM legal_deadlines ld
    JOIN legal_cases lc ON ld.case_id = lc.id
    WHERE ld.company_id = p_company_id
      AND ld.status = 'pending'
      AND ld.due_date <= NOW() + (p_days_ahead || ' days')::INTERVAL
      AND (p_user_id IS NULL OR ld.assigned_to = p_user_id OR p_user_id = ANY(ld.notify_users))
    ORDER BY ld.due_date ASC;
END;
$$;


--
-- Name: get_user_audit_history(uuid, integer, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_audit_history(p_user_id uuid, p_company_id integer, p_limit integer DEFAULT 100, p_offset integer DEFAULT 0) RETURNS TABLE(log_id integer, action character varying, field_name character varying, old_value text, new_value text, description text, changed_by_name text, changed_by_id uuid, ip_address character varying, created_at timestamp with time zone)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        ual.id AS log_id,
        ual.action,
        ual.field_name,
        ual.old_value,
        ual.new_value,
        ual.description,
        CASE
            WHEN u.user_id IS NOT NULL THEN u."firstName" || ' ' || u."lastName"
            ELSE 'Sistema'
        END AS changed_by_name,
        ual.changed_by_user_id AS changed_by_id,
        ual.ip_address,
        ual.created_at
    FROM user_audit_logs ual
    LEFT JOIN users u ON u.user_id = ual.changed_by_user_id
    WHERE ual.user_id = p_user_id
      AND ual.company_id = p_company_id
    ORDER BY ual.created_at DESC
    LIMIT p_limit
    OFFSET p_offset;
END;
$$;


--
-- Name: get_user_audit_stats(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_audit_stats(p_user_id uuid, p_company_id integer) RETURNS TABLE(total_changes bigint, first_change timestamp with time zone, last_change timestamp with time zone, changes_by_action jsonb, most_changed_fields jsonb)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*)::BIGINT AS total_changes,
        MIN(ual.created_at) AS first_change,
        MAX(ual.created_at) AS last_change,
        (
            SELECT jsonb_object_agg(sub.action, sub.cnt)
            FROM (
                SELECT ual2.action, COUNT(*) AS cnt
                FROM user_audit_logs ual2
                WHERE ual2.user_id = p_user_id AND ual2.company_id = p_company_id
                GROUP BY ual2.action
            ) sub
        ) AS changes_by_action,
        (
            SELECT jsonb_object_agg(sub2.field_name, sub2.cnt)
            FROM (
                SELECT ual3.field_name, COUNT(*) AS cnt
                FROM user_audit_logs ual3
                WHERE ual3.user_id = p_user_id
                  AND ual3.company_id = p_company_id
                  AND ual3.field_name IS NOT NULL
                GROUP BY ual3.field_name
                ORDER BY cnt DESC
                LIMIT 10
            ) sub2
        ) AS most_changed_fields
    FROM user_audit_logs ual
    WHERE ual.user_id = p_user_id AND ual.company_id = p_company_id;
END;
$$;


--
-- Name: get_user_effective_permissions(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_effective_permissions(p_user_id uuid, p_company_id integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_permissions JSONB := '{}';
    v_role RECORD;
    v_contract RECORD;
BEGIN
    -- 1. Obtener permisos de roles asignados
    FOR v_role IN (
        SELECT rd.module_permissions, rd.special_permissions, rd.priority
        FROM user_role_assignments ura
        JOIN role_definitions rd ON rd.id = ura.role_id
        WHERE ura.user_id = p_user_id
          AND ura.is_active = true
          AND (ura.valid_from IS NULL OR ura.valid_from <= CURRENT_DATE)
          AND (ura.valid_until IS NULL OR ura.valid_until >= CURRENT_DATE)
        ORDER BY rd.priority DESC
    )
    LOOP
        -- Merge permisos (prioridad mayor gana)
        v_permissions := v_permissions || v_role.module_permissions;
    END LOOP;

    -- 2. Si es asociado, agregar permisos del contrato
    FOR v_contract IN (
        SELECT cac.custom_permissions, rd.module_permissions
        FROM company_associate_contracts cac
        LEFT JOIN role_definitions rd ON rd.id = cac.role_id
        JOIN aponnt_associates aa ON aa.id = cac.associate_id
        WHERE aa.user_id = p_user_id
          AND cac.company_id = p_company_id
          AND cac.status = 'active'
    )
    LOOP
        IF v_contract.custom_permissions IS NOT NULL THEN
            v_permissions := v_permissions || v_contract.custom_permissions;
        ELSIF v_contract.module_permissions IS NOT NULL THEN
            v_permissions := v_permissions || v_contract.module_permissions;
        END IF;
    END LOOP;

    RETURN v_permissions;
END;
$$;


--
-- Name: get_user_socioeconomic_data(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_socioeconomic_data(p_user_id uuid) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    result JSONB;
BEGIN
    SELECT jsonb_build_object(
        'address', jsonb_build_object(
            'street_address', u.street_address,
            'floor_apt', u.floor_apt,
            'neighborhood', u.neighborhood,
            'city', u.city,
            'province', u.province,
            'country', u.country,
            'postal_code', u.postal_code,
            'latitude', u.address_latitude,
            'longitude', u.address_longitude
        ),
        'housing', jsonb_build_object(
            'residence_type', u.residence_type,
            'housing_type', u.housing_type,
            'residence_since', u.residence_since,
            'previous_moves_5years', u.previous_moves_5years
        ),
        'household', jsonb_build_object(
            'size', u.household_size,
            'dependents_count', u.dependents_count,
            'lives_alone', u.lives_alone,
            'members', (
                SELECT COALESCE(jsonb_agg(jsonb_build_object(
                    'id', m.id,
                    'full_name', m.full_name,
                    'relationship', m.relationship,
                    'birth_date', m.birth_date,
                    'is_dependent', m.is_dependent,
                    'is_cohabitant', m.is_cohabitant,
                    'has_disability', m.has_disability,
                    'education_level', m.education_level,
                    'works_externally', m.works_externally,
                    'is_covered_by_employee', m.is_covered_by_employee
                ) ORDER BY
                    CASE m.relationship
                        WHEN 'spouse' THEN 1
                        WHEN 'child' THEN 2
                        WHEN 'parent' THEN 3
                        ELSE 4
                    END
                ), '[]'::jsonb)
                FROM user_household_members m
                WHERE m.user_id = p_user_id AND m.is_active = TRUE
            )
        ),
        'commute', jsonb_build_object(
            'has_vehicle', u.has_vehicle,
            'vehicle_type', u.vehicle_type,
            'method', u.commute_method,
            'time_minutes', u.commute_time_minutes
        ),
        'emergency_contacts', (
            SELECT COALESCE(jsonb_agg(jsonb_build_object(
                'id', e.id,
                'priority', e.priority,
                'full_name', e.full_name,
                'relationship', e.relationship,
                'phone_primary', e.phone_primary,
                'phone_secondary', e.phone_secondary,
                'email', e.email,
                'can_make_medical_decisions', e.can_make_medical_decisions,
                'special_instructions', e.special_instructions
            ) ORDER BY e.priority), '[]'::jsonb)
            FROM user_emergency_contacts e
            WHERE e.user_id = p_user_id AND e.is_active = TRUE
        )
    ) INTO result
    FROM users u
    WHERE u.user_id = p_user_id;

    RETURN result;
END;
$$;


--
-- Name: FUNCTION get_user_socioeconomic_data(p_user_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_user_socioeconomic_data(p_user_id uuid) IS 'Obtiene todos los datos sociodemogrficos de un usuario en formato JSON';


--
-- Name: get_user_verification_status(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_user_verification_status(p_user_id integer, p_user_type character varying) RETURNS TABLE(user_id integer, email character varying, email_verified boolean, email_verified_at timestamp without time zone, pending_consents_count integer, has_required_pending boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF p_user_type = 'employee' THEN
        RETURN QUERY
        SELECT
            u.user_id,
            u.email,
            u.email_verified,
            u.email_verified_at,
            COALESCE(array_length(u.pending_consents, 1), 0) as pending_consents_count,
            COALESCE(has_pending_required_consents(u.user_id, 'employee'), false) as has_required_pending
        FROM users u
        WHERE u.user_id = p_user_id;
    ELSE
        RETURN QUERY
        SELECT
            p.id as user_id,
            p.email,
            p.email_verified,
            p.email_verified_at,
            COALESCE(array_length(p.pending_consents, 1), 0) as pending_consents_count,
            COALESCE(has_pending_required_consents(p.id, p_user_type), false) as has_required_pending
        FROM partners p
        WHERE p.id = p_user_id;
    END IF;
END;
$$;


--
-- Name: FUNCTION get_user_verification_status(p_user_id integer, p_user_type character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_user_verification_status(p_user_id integer, p_user_type character varying) IS 'Obtiene el estado de verificacin completo de un usuario';


--
-- Name: get_users_with_expired_photos(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_with_expired_photos() RETURNS TABLE(user_id uuid, usuario character varying, "firstName" character varying, "lastName" character varying, email character varying, company_id integer, biometric_photo_url text, biometric_photo_date timestamp without time zone, biometric_photo_expiration timestamp without time zone, days_since_expiration integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        u.user_id,
        u.usuario,
        u."firstName",
        u."lastName",
        u.email,
        u.company_id,
        u.biometric_photo_url,
        u.biometric_photo_date,
        u.biometric_photo_expiration,
        EXTRACT(DAY FROM (NOW() - u.biometric_photo_expiration))::INTEGER as days_since_expiration
    FROM users u
    WHERE u.biometric_photo_expiration IS NOT NULL
        AND u.biometric_photo_expiration < NOW()
        AND u."isActive" = true
    ORDER BY u.biometric_photo_expiration ASC;
END;
$$;


--
-- Name: FUNCTION get_users_with_expired_photos(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_users_with_expired_photos() IS 'Obtiene usuarios con fotos biomtricas ya vencidas';


--
-- Name: get_users_with_expiring_photos(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_users_with_expiring_photos(p_days_threshold integer DEFAULT 30) RETURNS TABLE(user_id uuid, usuario character varying, "firstName" character varying, "lastName" character varying, email character varying, company_id integer, biometric_photo_url text, biometric_photo_date timestamp without time zone, biometric_photo_expiration timestamp without time zone, days_until_expiration integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        u.user_id,
        u.usuario,
        u."firstName",
        u."lastName",
        u.email,
        u.company_id,
        u.biometric_photo_url,
        u.biometric_photo_date,
        u.biometric_photo_expiration,
        EXTRACT(DAY FROM (u.biometric_photo_expiration - NOW()))::INTEGER as days_until_expiration
    FROM users u
    WHERE u.biometric_photo_expiration IS NOT NULL
        AND u.biometric_photo_expiration <= (NOW() + (p_days_threshold || ' days')::INTERVAL)
        AND u.biometric_photo_expiration > NOW()
        AND u."isActive" = true
    ORDER BY u.biometric_photo_expiration ASC;
END;
$$;


--
-- Name: FUNCTION get_users_with_expiring_photos(p_days_threshold integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_users_with_expiring_photos(p_days_threshold integer) IS 'Obtiene usuarios con fotos biomtricas prximas a vencer (por defecto 30 das)';


--
-- Name: get_vacation_balance(integer, uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vacation_balance(p_company_id integer, p_user_id uuid, p_year integer DEFAULT (EXTRACT(year FROM CURRENT_DATE))::integer) RETURNS TABLE(total_days integer, used_days integer, pending_days integer, available_days integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_hire_date DATE;
    v_total INTEGER;
    v_used INTEGER;
    v_pending INTEGER;
BEGIN
    -- Obtener fecha de ingreso
    SELECT hire_date INTO v_hire_date
    FROM users
    WHERE user_id = p_user_id AND company_id = p_company_id;

    -- Calcular das totales segn antigedad
    v_total := calculate_vacation_days(p_company_id, v_hire_date);

    -- Das usados (aprobados y completados)
    SELECT COALESCE(SUM(total_days), 0) INTO v_used
    FROM vacation_requests
    WHERE company_id = p_company_id
      AND user_id = p_user_id
      AND request_type = 'vacation'
      AND status IN ('approved', 'active', 'completed')
      AND EXTRACT(YEAR FROM start_date) = p_year;

    -- Das pendientes de aprobacin
    SELECT COALESCE(SUM(total_days), 0) INTO v_pending
    FROM vacation_requests
    WHERE company_id = p_company_id
      AND user_id = p_user_id
      AND request_type = 'vacation'
      AND status = 'pending'
      AND EXTRACT(YEAR FROM start_date) = p_year;

    RETURN QUERY SELECT v_total, v_used, v_pending, (v_total - v_used - v_pending);
END;
$$;


--
-- Name: FUNCTION get_vacation_balance(p_company_id integer, p_user_id uuid, p_year integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_vacation_balance(p_company_id integer, p_user_id uuid, p_year integer) IS 'Obtiene el balance de das de vacaciones de un empleado';


--
-- Name: get_valid_documents_for_dependency(uuid, integer, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_valid_documents_for_dependency(p_user_id uuid, p_dependency_id integer, p_as_of_date date DEFAULT CURRENT_DATE) RETURNS TABLE(document_id integer, family_member_type character varying, family_member_id integer, family_member_name character varying, issue_date date, expiration_date date, status character varying, is_valid boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        edd.id as document_id,
        edd.family_member_type,
        edd.family_member_id,
        edd.family_member_name,
        edd.issue_date,
        edd.expiration_date,
        edd.status,
        (edd.expiration_date IS NULL OR edd.expiration_date >= p_as_of_date) as is_valid
    FROM employee_dependency_documents edd
    WHERE edd.user_id = p_user_id
      AND edd.dependency_id = p_dependency_id
      AND edd.is_current = true
    ORDER BY edd.family_member_name;
END;
$$;


--
-- Name: get_vendor_payment_history(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_payment_history(p_vendor_id uuid, p_limit integer DEFAULT 50) RETURNS TABLE(payment_id uuid, payment_code character varying, payment_date date, company_name character varying, commission_type character varying, net_amount numeric, status character varying, payment_method character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    cp.id,
    cp.payment_code,
    cp.payment_date,
    c.name,
    cp.commission_type,
    cp.net_amount,
    cp.status,
    cp.payment_method
  FROM commission_payments cp
  JOIN companies c ON cp.company_id = c.id
  WHERE
    cp.vendor_id = p_vendor_id
    AND cp.status IN ('COMPLETED', 'REFUNDED')
  ORDER BY cp.payment_date DESC
  LIMIT p_limit;
END;
$$;


--
-- Name: get_vendor_pending_payments(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_pending_payments(p_vendor_id uuid) RETURNS TABLE(liquidation_id uuid, liquidation_code character varying, liquidation_date date, company_name character varying, commission_amount numeric, payment_status character varying, payment_scheduled_date date)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    cl.id,
    cl.liquidation_code,
    cl.liquidation_date,
    c.name,
    (breakdown->>'amount')::DECIMAL AS commission_amount,
    (breakdown->>'payment_status')::VARCHAR AS payment_status,
    cl.payment_scheduled_date
  FROM commission_liquidations cl
  CROSS JOIN LATERAL jsonb_array_elements(cl.commission_breakdown) AS breakdown
  JOIN companies c ON cl.company_id = c.id
  WHERE
    (breakdown->>'vendor_id')::UUID = p_vendor_id
    AND cl.status IN ('PAYMENT_PENDING', 'PAYMENT_IN_PROGRESS', 'APPROVED')
  ORDER BY cl.liquidation_date DESC;
END;
$$;


--
-- Name: get_vendor_pending_payments_detailed(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_pending_payments_detailed(p_vendor_id uuid) RETURNS TABLE(payment_id uuid, payment_code character varying, liquidation_code character varying, company_name character varying, commission_type character varying, commission_amount numeric, net_amount numeric, status character varying, scheduled_date date, payment_method character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    cp.id,
    cp.payment_code,
    cl.liquidation_code,
    c.name,
    cp.commission_type,
    cp.commission_amount,
    cp.net_amount,
    cp.status,
    cp.scheduled_date,
    cp.payment_method
  FROM commission_payments cp
  JOIN commission_liquidations cl ON cp.liquidation_id = cl.id
  JOIN companies c ON cp.company_id = c.id
  WHERE
    cp.vendor_id = p_vendor_id
    AND cp.status IN ('PENDING', 'SCHEDULED', 'IN_PROCESS')
  ORDER BY cp.scheduled_date ASC NULLS FIRST, cp.created_at ASC;
END;
$$;


--
-- Name: get_vendor_pending_tickets(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_pending_tickets(p_vendor_id uuid) RETURNS TABLE(ticket_id uuid, ticket_number character varying, company_name character varying, subject character varying, priority character varying, status character varying, created_at timestamp with time zone, days_open integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    st.ticket_id,
    st.ticket_number,
    c.name as company_name,
    st.subject,
    st.priority,
    st.status,
    st.created_at,
    EXTRACT(DAY FROM CURRENT_TIMESTAMP - st.created_at)::INTEGER as days_open
  FROM support_tickets st
  INNER JOIN companies c ON st.company_id = c.company_id
  WHERE st.assigned_to_vendor_id = p_vendor_id
    AND st.status IN ('open', 'in_progress', 'waiting_customer')
  ORDER BY
    CASE st.priority
      WHEN 'urgent' THEN 1
      WHEN 'high' THEN 2
      WHEN 'medium' THEN 3
      WHEN 'low' THEN 4
    END,
    st.created_at ASC;
END;
$$;


--
-- Name: FUNCTION get_vendor_pending_tickets(p_vendor_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_vendor_pending_tickets(p_vendor_id uuid) IS 'Lista todos los tickets pendientes de un vendedor con prioridad';


--
-- Name: get_vendor_supervisor(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_supervisor(p_vendor_id uuid) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_supervisor_id UUID;
BEGIN
  SELECT supervisor_id INTO v_supervisor_id
  FROM support_vendor_supervisors
  WHERE vendor_id = p_vendor_id
    AND is_active = true
  ORDER BY assigned_at DESC
  LIMIT 1;

  RETURN v_supervisor_id;
END;
$$;


--
-- Name: FUNCTION get_vendor_supervisor(p_vendor_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.get_vendor_supervisor(p_vendor_id uuid) IS 'Obtiene el supervisor asignado de un vendedor';


--
-- Name: get_vendor_total_commissions(uuid, date, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.get_vendor_total_commissions(p_vendor_id uuid, p_start_date date DEFAULT NULL::date, p_end_date date DEFAULT NULL::date) RETURNS TABLE(total_gross numeric, total_net numeric, total_tax_withheld numeric, payment_count integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    COALESCE(SUM(commission_amount), 0.00) AS total_gross,
    COALESCE(SUM(net_amount), 0.00) AS total_net,
    COALESCE(SUM(tax_withholding), 0.00) AS total_tax_withheld,
    COUNT(*)::INTEGER AS payment_count
  FROM commission_payments
  WHERE
    vendor_id = p_vendor_id
    AND status = 'COMPLETED'
    AND (p_start_date IS NULL OR payment_date >= p_start_date)
    AND (p_end_date IS NULL OR payment_date <= p_end_date);
END;
$$;


--
-- Name: has_active_ppe_consent(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.has_active_ppe_consent(p_employee_id integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM employee_ppe_consents
    WHERE employee_id = p_employee_id
      AND consent_type = 'PPE_MONITORING'
      AND consent_given = true
      AND revoked = false
      AND (consent_expires IS NULL OR consent_expires > NOW())
  );
END;
$$;


--
-- Name: has_pending_required_consents(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.has_pending_required_consents(p_user_id integer, p_user_type character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    pending_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO pending_count
    FROM consent_definitions cd
    WHERE cd.is_active = true
    AND cd.is_required = true
    AND p_user_type = ANY(cd.applicable_roles)
    AND NOT EXISTS (
        SELECT 1 FROM user_consents uc
        WHERE uc.user_id = p_user_id
        AND uc.user_type = p_user_type
        AND uc.consent_id = cd.consent_id
        AND uc.status = 'accepted'
    );

    RETURN pending_count > 0;
END;
$$;


--
-- Name: FUNCTION has_pending_required_consents(p_user_id integer, p_user_type character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.has_pending_required_consents(p_user_id integer, p_user_type character varying) IS 'Verifica si un usuario tiene consentimientos obligatorios sin aceptar';


--
-- Name: increment_email_counter(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.increment_email_counter(p_company_id integer) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE email_configurations
    SET
        current_daily_count = current_daily_count + 1,
        current_monthly_count = current_monthly_count + 1,
        updated_at = CURRENT_TIMESTAMP
    WHERE company_id = p_company_id;
END;
$$;


--
-- Name: is_consent_valid(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_consent_valid(p_consent_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_valid BOOLEAN;
BEGIN
    SELECT
        consent_given = true AND
        revoked = false AND
        (expires_at IS NULL OR expires_at > CURRENT_TIMESTAMP)
    INTO v_valid
    FROM biometric_consents
    WHERE id = p_consent_id;

    RETURN COALESCE(v_valid, false);
END;
$$;


--
-- Name: is_employee_eligible_for_benefit(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_employee_eligible_for_benefit(p_user_id uuid, p_benefit_type_id integer, p_company_id integer) RETURNS TABLE(is_eligible boolean, reason character varying, policy_id integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_policy RECORD;
  v_user RECORD;
  v_seniority_months INTEGER;
BEGIN
  -- Obtener poltica del beneficio para la empresa
  SELECT * INTO v_policy
  FROM company_benefit_policies
  WHERE company_id = p_company_id
    AND benefit_type_id = p_benefit_type_id
    AND is_enabled = true
    AND is_active = true;

  IF NOT FOUND THEN
    RETURN QUERY SELECT false, 'La empresa no ofrece este beneficio'::VARCHAR(500), NULL::INTEGER;
    RETURN;
  END IF;

  -- Obtener datos del usuario/empleado
  SELECT *
  INTO v_user
  FROM users e
  WHERE e.user_id = p_user_id AND e.company_id = p_company_id;

  IF NOT FOUND THEN
    RETURN QUERY SELECT false, 'Empleado no encontrado o no pertenece a la empresa'::VARCHAR(500), NULL::INTEGER;
    RETURN;
  END IF;

  -- Verificar rol elegible
  IF v_policy.eligible_roles IS NOT NULL AND array_length(v_policy.eligible_roles, 1) > 0 THEN
    IF NOT (v_user.role_id = ANY(v_policy.eligible_roles)) THEN
      RETURN QUERY SELECT false, 'El rol del empleado no es elegible para este beneficio'::VARCHAR(500), v_policy.id;
      RETURN;
    END IF;
  END IF;

  -- Verificar departamento elegible
  IF v_policy.eligible_departments IS NOT NULL AND array_length(v_policy.eligible_departments, 1) > 0 THEN
    IF NOT (v_user.department_id = ANY(v_policy.eligible_departments)) THEN
      RETURN QUERY SELECT false, 'El departamento del empleado no es elegible para este beneficio'::VARCHAR(500), v_policy.id;
      RETURN;
    END IF;
  END IF;

  -- Verificar antigedad mnima
  IF v_policy.min_seniority_months IS NOT NULL THEN
    SELECT EXTRACT(YEAR FROM AGE(CURRENT_DATE, v_user.hire_date)) * 12 +
           EXTRACT(MONTH FROM AGE(CURRENT_DATE, v_user.hire_date))
    INTO v_seniority_months;

    IF v_seniority_months < v_policy.min_seniority_months THEN
      RETURN QUERY SELECT false,
        format('Requiere al menos %s meses de antigedad (tienes %s meses)', v_policy.min_seniority_months, v_seniority_months)::VARCHAR(500),
        v_policy.id;
      RETURN;
    END IF;
  END IF;

  -- Empleado es elegible
  RETURN QUERY SELECT true, 'Empleado elegible para este beneficio'::VARCHAR(500), v_policy.id;
END;
$$;


--
-- Name: FUNCTION is_employee_eligible_for_benefit(p_user_id uuid, p_benefit_type_id integer, p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.is_employee_eligible_for_benefit(p_user_id uuid, p_benefit_type_id integer, p_company_id integer) IS 'Verifica si un empleado cumple los requisitos de elegibilidad para un beneficio';


--
-- Name: is_employee_suspended(uuid, integer, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_employee_suspended(p_employee_id uuid, p_company_id integer, p_check_date date DEFAULT CURRENT_DATE) RETURNS TABLE(is_blocked boolean, block_id integer, sanction_id integer, start_date date, end_date date, days_remaining integer, block_reason text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT
        true AS is_blocked,
        sb.id AS block_id,
        sb.sanction_id,
        sb.start_date,
        sb.end_date,
        (sb.end_date - p_check_date)::INTEGER AS days_remaining,
        COALESCE(s.description, 'Suspensin disciplinaria') AS block_reason
    FROM suspension_blocks sb
    LEFT JOIN sanctions s ON s.id = sb.sanction_id
    WHERE sb.employee_id = p_employee_id
      AND sb.company_id = p_company_id
      AND sb.is_active = true
      AND p_check_date BETWEEN sb.start_date AND sb.end_date
    ORDER BY sb.end_date DESC
    LIMIT 1;

    -- Si no hay bloqueo, retornar registro vaco con is_blocked = false
    IF NOT FOUND THEN
        RETURN QUERY SELECT
            false AS is_blocked,
            NULL::INTEGER AS block_id,
            NULL::INTEGER AS sanction_id,
            NULL::DATE AS start_date,
            NULL::DATE AS end_date,
            NULL::INTEGER AS days_remaining,
            NULL::TEXT AS block_reason;
    END IF;
END;
$$;


--
-- Name: FUNCTION is_employee_suspended(p_employee_id uuid, p_company_id integer, p_check_date date); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.is_employee_suspended(p_employee_id uuid, p_company_id integer, p_check_date date) IS 'Verifica si un empleado tiene suspensin activa en una fecha dada';


--
-- Name: is_holiday(date, character varying, character varying, boolean, boolean); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_holiday(p_date date, p_country character varying, p_state_province character varying DEFAULT NULL::character varying, p_include_national boolean DEFAULT true, p_include_provincial boolean DEFAULT false) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO v_count
    FROM holidays h
    WHERE h.date = p_date
      AND h.country = p_country
      AND (
          (p_include_national AND h.is_national)
          OR
          (p_include_provincial AND h.is_provincial AND (h.state_province IS NULL OR h.state_province = p_state_province))
      );

    RETURN v_count > 0;
END;
$$;


--
-- Name: is_medical_record_editable(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.is_medical_record_editable(p_record_id integer, p_user_id integer DEFAULT NULL::integer) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_record RECORD;
    v_authorization RECORD;
    v_result JSONB;
BEGIN
    -- Obtener registro
    SELECT * INTO v_record FROM medical_records WHERE id = p_record_id;

    IF NOT FOUND THEN
        RETURN jsonb_build_object('editable', false, 'reason', 'Registro no encontrado');
    END IF;

    -- Verificar si esta eliminado
    IF v_record.is_deleted THEN
        RETURN jsonb_build_object('editable', false, 'reason', 'Registro eliminado');
    END IF;

    -- Verificar ventana de edicion normal
    IF NOT v_record.is_locked AND v_record.editable_until > NOW() THEN
        RETURN jsonb_build_object(
            'editable', true,
            'reason', 'Dentro de ventana de edicion',
            'editable_until', v_record.editable_until,
            'requires_authorization', false
        );
    END IF;

    -- Verificar si hay autorizacion activa
    SELECT * INTO v_authorization
    FROM medical_edit_authorizations
    WHERE
        record_id = p_record_id
        AND status = 'approved'
        AND window_used = false
        AND authorization_window_end > NOW()
        AND (p_user_id IS NULL OR requested_by = p_user_id)
    ORDER BY authorized_at DESC
    LIMIT 1;

    IF FOUND THEN
        RETURN jsonb_build_object(
            'editable', true,
            'reason', 'Autorizacion activa',
            'authorization_id', v_authorization.id,
            'window_end', v_authorization.authorization_window_end,
            'requires_authorization', false
        );
    END IF;

    -- No editable
    RETURN jsonb_build_object(
        'editable', false,
        'reason', 'Registro bloqueado - requiere autorizacion',
        'locked_at', v_record.locked_at,
        'requires_authorization', true
    );
END;
$$;


--
-- Name: FUNCTION is_medical_record_editable(p_record_id integer, p_user_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.is_medical_record_editable(p_record_id integer, p_user_id integer) IS 'Verifica si un registro es editable (ventana o autorizacion)';


--
-- Name: lock_expired_medical_records(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.lock_expired_medical_records() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_locked_count INTEGER;
BEGIN
    UPDATE medical_records
    SET
        is_locked = true,
        locked_at = NOW(),
        locked_reason = 'Ventana de edicion expirada (automatico)',
        updated_at = NOW()
    WHERE
        is_locked = false
        AND is_deleted = false
        AND editable_until IS NOT NULL
        AND editable_until < NOW();

    GET DIAGNOSTICS v_locked_count = ROW_COUNT;

    -- Registrar en audit log
    INSERT INTO medical_record_audit_log (
        company_id, record_id, record_type, action,
        action_by, action_by_name, action_by_role,
        notes, metadata
    )
    SELECT
        company_id, id, record_type, 'locked',
        0, 'SYSTEM', 'system',
        'Bloqueo automatico por expiracion de ventana de edicion',
        jsonb_build_object('locked_count', v_locked_count, 'batch_lock', true)
    FROM medical_records
    WHERE
        is_locked = true
        AND locked_at >= NOW() - INTERVAL '1 minute'
        AND locked_reason LIKE '%automatico%';

    RETURN v_locked_count;
END;
$$;


--
-- Name: FUNCTION lock_expired_medical_records(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.lock_expired_medical_records() IS 'Bloquea automaticamente registros cuya ventana de edicion expiro';


--
-- Name: lock_legal_document(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.lock_legal_document(doc_id integer, reason character varying DEFAULT 'Perodo de edicin expirado'::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE legal_case_documents
    SET is_locked = true,
        locked_at = NOW(),
        lock_reason = reason
    WHERE id = doc_id AND is_locked = false;

    RETURN FOUND;
END;
$$;


--
-- Name: log_application_status_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_application_status_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF OLD.status IS DISTINCT FROM NEW.status THEN
        NEW.status_history = COALESCE(NEW.status_history, '[]'::JSONB) ||
            jsonb_build_object(
                'from_status', OLD.status,
                'to_status', NEW.status,
                'changed_at', NOW(),
                'changed_by', COALESCE(NEW.reviewed_by, NEW.admin_approved_by, NEW.medical_approved_by, NEW.hired_by)
            );
        NEW.updated_at = NOW();
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: log_claim_status_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_claim_status_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF OLD.status IS DISTINCT FROM NEW.status THEN
        INSERT INTO oh_claim_status_history (
            claim_id,
            previous_status,
            new_status,
            changed_by,
            notes
        ) VALUES (
            NEW.id,
            OLD.status,
            NEW.status,
            NEW.last_updated_by,
            'Status changed via claim update'
        );
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION log_claim_status_change(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.log_claim_status_change() IS 'Registra automticamente cambios de estado en historial';


--
-- Name: log_consent_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_consent_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO consent_audit_log (user_consent_id, action, new_status, ip_address, changed_by)
        VALUES (NEW.user_consent_id, 'created', NEW.status, NEW.ip_address, NEW.user_id);
    ELSIF TG_OP = 'UPDATE' AND OLD.status != NEW.status THEN
        INSERT INTO consent_audit_log (user_consent_id, action, old_status, new_status, ip_address, changed_by)
        VALUES (NEW.user_consent_id,
                CASE NEW.status
                    WHEN 'accepted' THEN 'accepted'
                    WHEN 'rejected' THEN 'rejected'
                    WHEN 'revoked' THEN 'revoked'
                    ELSE 'updated'
                END,
                OLD.status, NEW.status, NEW.ip_address, NEW.user_id);
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: log_legal_stage_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_legal_stage_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF OLD.current_stage IS DISTINCT FROM NEW.current_stage THEN
        INSERT INTO legal_case_timeline_events (
            case_id, event_type, title, description, event_date,
            importance, is_milestone, created_by
        ) VALUES (
            NEW.id,
            'stage_change',
            'Cambio de etapa: ' || OLD.current_stage || ' -> ' || NEW.current_stage,
            'El caso paso de la etapa ' || OLD.current_stage || ' a ' || NEW.current_stage,
            NOW(),
            'high',
            TRUE,
            NEW.assigned_to
        );
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: log_redemption_status_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_redemption_status_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF OLD.status IS DISTINCT FROM NEW.status THEN
        INSERT INTO hour_bank_redemption_history (
            request_id, previous_status, new_status,
            changed_by, changed_by_role, comments
        ) VALUES (
            NEW.id, OLD.status, NEW.status,
            COALESCE(NEW.hr_approver_id, NEW.supervisor_id, NEW.user_id),
            CASE
                WHEN NEW.status LIKE '%hr%' THEN 'hr'
                WHEN NEW.status LIKE '%supervisor%' THEN 'supervisor'
                WHEN NEW.status = 'cancelled' THEN 'employee'
                ELSE 'system'
            END,
            COALESCE(NEW.hr_comments, NEW.supervisor_comments)
        );
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: log_user_change(uuid, uuid, integer, character varying, character varying, text, text, text, jsonb, character varying, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.log_user_change(p_user_id uuid, p_changed_by_user_id uuid, p_company_id integer, p_action character varying, p_field_name character varying DEFAULT NULL::character varying, p_old_value text DEFAULT NULL::text, p_new_value text DEFAULT NULL::text, p_description text DEFAULT NULL::text, p_metadata jsonb DEFAULT '{}'::jsonb, p_ip_address character varying DEFAULT NULL::character varying, p_user_agent text DEFAULT NULL::text) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_log_id INTEGER;
BEGIN
    INSERT INTO user_audit_logs (
        user_id, changed_by_user_id, company_id, action,
        field_name, old_value, new_value, description,
        metadata, ip_address, user_agent
    ) VALUES (
        p_user_id, p_changed_by_user_id, p_company_id, p_action,
        p_field_name, p_old_value, p_new_value, p_description,
        p_metadata, p_ip_address, p_user_agent
    ) RETURNING id INTO v_log_id;

    RETURN v_log_id;
END;
$$;


--
-- Name: move_procedure_to_parent(uuid, uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.move_procedure_to_parent(p_procedure_id uuid, p_new_parent_id uuid, p_user_id uuid DEFAULT NULL::uuid) RETURNS TABLE(success boolean, message text, old_path text, new_path text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_old_path TEXT;
    v_new_path TEXT;
    v_doc_type VARCHAR(20);
    v_doc_level INTEGER;
    v_parent_level INTEGER;
    v_expected_parent_level INTEGER;
BEGIN
    -- Obtener info del documento
    SELECT hierarchy_path, type, hierarchy_level
    INTO v_old_path, v_doc_type, v_doc_level
    FROM procedures WHERE id = p_procedure_id;

    IF NOT FOUND THEN
        RETURN QUERY SELECT false, 'Documento no encontrado'::TEXT, NULL::TEXT, NULL::TEXT;
        RETURN;
    END IF;

    -- Validar que el nuevo padre sea del nivel correcto
    v_expected_parent_level := v_doc_level - 1;

    IF v_expected_parent_level < 1 THEN
        RETURN QUERY SELECT false, 'Las polticas no pueden tener padre'::TEXT, NULL::TEXT, NULL::TEXT;
        RETURN;
    END IF;

    SELECT hierarchy_level INTO v_parent_level
    FROM procedures WHERE id = p_new_parent_id;

    IF v_parent_level != v_expected_parent_level THEN
        RETURN QUERY SELECT false,
            format('El nuevo padre debe ser de nivel %s (%s)',
                v_expected_parent_level,
                CASE v_expected_parent_level
                    WHEN 1 THEN 'poltica'
                    WHEN 2 THEN 'manual'
                    WHEN 3 THEN 'procedimiento'
                END
            )::TEXT,
            NULL::TEXT, NULL::TEXT;
        RETURN;
    END IF;

    -- Actualizar (el trigger validar y actualizar el path)
    UPDATE procedures
    SET parent_id = p_new_parent_id,
        updated_at = NOW()
    WHERE id = p_procedure_id;

    -- Obtener nuevo path
    SELECT hierarchy_path INTO v_new_path
    FROM procedures WHERE id = p_procedure_id;

    RETURN QUERY SELECT true, 'Documento movido exitosamente'::TEXT, v_old_path, v_new_path;
END;
$$;


--
-- Name: notify_benefit_approved(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.notify_benefit_approved() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF NEW.status = 'approved' AND OLD.status != 'approved' THEN
    -- Aqu se insertara en la tabla de notificaciones del sistema central
    -- Por ahora, solo registramos en logs
    RAISE NOTICE 'NOTIFICACIN: Beneficio ID % aprobado para empleado ID %', NEW.id, NEW.user_id;

    -- TODO: INSERT INTO notifications (user_id, type, title, message, ...)
    -- VALUES (NEW.user_id, 'benefit_approved', 'Beneficio Aprobado', '...', ...)
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: obtener_proximo_numero_seguro(integer, character varying, character varying, integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.obtener_proximo_numero_seguro(p_company_id integer, p_tipo_comprobante character varying, p_session_id character varying, p_user_id integer, p_terminal_id character varying) RETURNS TABLE(numero_asignado integer, siguiente_numero integer)
    LANGUAGE plpgsql
    AS $_$
DECLARE
    v_numero_actual INTEGER;
    v_siguiente_numero INTEGER;
    v_campo_numeracion VARCHAR(50);
BEGIN
    -- Determinar el campo de numeracin segn el tipo
    CASE p_tipo_comprobante
        WHEN 'facturaA' THEN v_campo_numeracion := 'factura_a_numero';
        WHEN 'facturaB' THEN v_campo_numeracion := 'factura_b_numero';
        WHEN 'facturaC' THEN v_campo_numeracion := 'factura_c_numero';
        WHEN 'recibo' THEN v_campo_numeracion := 'recibo_numero';
        WHEN 'remito' THEN v_campo_numeracion := 'remito_numero';
        ELSE RAISE EXCEPTION 'Tipo de comprobante no vlido: %', p_tipo_comprobante;
    END CASE;

    -- Obtener y actualizar nmero de forma atmica
    EXECUTE format('
        UPDATE siac_configuracion_empresa
        SET %I = %I + 1, updated_at = CURRENT_TIMESTAMP
        WHERE company_id = $1
        RETURNING %I - 1, %I
    ', v_campo_numeracion, v_campo_numeracion, v_campo_numeracion, v_campo_numeracion)
    USING p_company_id
    INTO v_numero_actual, v_siguiente_numero;

    -- Si no se encontr la empresa, error
    IF NOT FOUND THEN
        RAISE EXCEPTION 'Configuracin de empresa no encontrada: %', p_company_id;
    END IF;

    -- Registrar en log de auditora
    INSERT INTO siac_numeracion_log (
        company_id, tipo_comprobante, numero_asignado, numero_anterior,
        session_id, user_id, terminal_id
    ) VALUES (
        p_company_id, p_tipo_comprobante, v_numero_actual, v_numero_actual - 1,
        p_session_id, p_user_id, p_terminal_id
    );

    -- Retornar resultado
    RETURN QUERY SELECT v_numero_actual, v_siguiente_numero;
END;
$_$;


--
-- Name: partner_can_login(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.partner_can_login(p_username character varying) RETURNS TABLE(id uuid, username character varying, password character varying, first_name character varying, last_name character varying, email character varying, partner_role_id uuid, approval_status character varying, first_login boolean, is_active boolean)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    p.id,
    p.username,
    p.password,
    p.first_name,
    p.last_name,
    p.email,
    p.partner_role_id,
    p.approval_status::VARCHAR,
    p.first_login,
    p.is_active
  FROM partners p
  WHERE (p.username = p_username OR p.dni = p_username)
    AND p.approval_status = 'approved'
    AND p.is_active = true
    AND p.password IS NOT NULL;
END;
$$;


--
-- Name: FUNCTION partner_can_login(p_username character varying); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.partner_can_login(p_username character varying) IS 'Verifica credenciales y estado de aprobacin de partner';


--
-- Name: prevent_core_user_deletion(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.prevent_core_user_deletion() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF OLD.is_core_user = TRUE THEN
    RAISE EXCEPTION 'Cannot delete CORE user. CORE users are immutable.';
  END IF;
  RETURN OLD;
END;
$$;


--
-- Name: prevent_core_user_immutable_changes(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.prevent_core_user_immutable_changes() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Si es usuario CORE, validar campos inmutables
  IF NEW.is_core_user = TRUE THEN
    -- Username NO puede cambiar
    IF NEW.usuario != OLD.usuario THEN
      RAISE EXCEPTION 'Cannot change usuario of CORE user. Username must remain "administrador".';
    END IF;

    -- Role NO puede cambiar (debe ser siempre admin)
    IF NEW.role != 'admin' THEN
      RAISE EXCEPTION 'Cannot change role of CORE user. Role must remain "admin".';
    END IF;

    -- is_core_user NO puede cambiar
    IF NEW.is_core_user != OLD.is_core_user THEN
      RAISE EXCEPTION 'Cannot change is_core_user flag.';
    END IF;

    -- company_id NO puede cambiar
    IF NEW.company_id != OLD.company_id THEN
      RAISE EXCEPTION 'Cannot change company_id of CORE user.';
    END IF;
  END IF;

  -- Actualizar password_changed_at si cambi el password
  IF NEW.password != OLD.password THEN
    NEW.password_changed_at := CURRENT_TIMESTAMP;

    -- Si estaba forzado a cambiar password, quitar el flag
    IF OLD.force_password_change = TRUE THEN
      NEW.force_password_change := FALSE;
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: prevent_duplicate_checkin(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.prevent_duplicate_checkin() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
        BEGIN
            -- Verificar si ya existe un check-in sin check-out para hoy
            IF NEW."checkOutTime" IS NULL THEN
                IF EXISTS (
                    SELECT 1 FROM attendances
                    WHERE "UserId" = NEW."UserId"
                    AND DATE(date) = DATE(NEW.date)
                    AND "checkOutTime" IS NULL
                    AND (NEW.id IS NULL OR id != NEW.id)
                ) THEN
                    RAISE EXCEPTION 'El usuario ya tiene un check-in abierto para hoy. Debe registrar check-out primero.';
                END IF;
            END IF;
            RETURN NEW;
        END;
        $$;


--
-- Name: FUNCTION prevent_duplicate_checkin(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.prevent_duplicate_checkin() IS 'Trigger que previene check-ins duplicados y valida coherencia de horarios';


--
-- Name: process_inbound_email_to_thread(uuid, uuid, character varying, character varying, character varying, text, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.process_inbound_email_to_thread(p_inbound_id uuid, p_group_id uuid, p_from_email character varying, p_from_name character varying, p_subject character varying, p_body_text text, p_company_id integer) RETURNS uuid
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_message_id UUID;
    v_sequence INTEGER;
    v_sender_type VARCHAR := 'external';
    v_sender_id INTEGER;
    v_sender_name VARCHAR;
BEGIN
    -- Intentar identificar si el remitente es un usuario del sistema
    SELECT user_id, COALESCE(first_name || ' ' || last_name, username) INTO v_sender_id, v_sender_name
    FROM users
    WHERE email = p_from_email AND company_id = p_company_id
    LIMIT 1;

    IF v_sender_id IS NOT NULL THEN
        v_sender_type := 'employee';
    ELSE
        v_sender_name := COALESCE(p_from_name, p_from_email);
    END IF;

    -- Obtener siguiente nmero de secuencia
    SELECT COALESCE(MAX(sequence_number), 0) + 1 INTO v_sequence
    FROM notification_messages
    WHERE group_id = p_group_id;

    -- Crear mensaje en el thread
    INSERT INTO notification_messages (
        id,
        group_id,
        sequence_number,
        sender_type,
        sender_id,
        sender_name,
        recipient_type,
        recipient_id,
        recipient_name,
        message_type,
        subject,
        content,
        source_channel,
        created_at
    ) VALUES (
        gen_random_uuid(),
        p_group_id,
        v_sequence,
        v_sender_type,
        v_sender_id,
        v_sender_name,
        'system',
        NULL,
        'Sistema',
        'reply',
        p_subject,
        p_body_text,
        'email_inbound',
        CURRENT_TIMESTAMP
    )
    RETURNING id INTO v_message_id;

    -- Actualizar grupo con ltima actividad
    UPDATE notification_groups
    SET updated_at = CURRENT_TIMESTAMP,
        status = CASE WHEN status = 'closed' THEN 'reopened' ELSE status END
    WHERE id = p_group_id;

    -- Actualizar el log de inbound
    UPDATE email_inbound_log
    SET processing_status = 'LINKED',
        created_message_id = v_message_id,
        processed_at = CURRENT_TIMESTAMP
    WHERE id = p_inbound_id;

    RETURN v_message_id;
END;
$$;


--
-- Name: FUNCTION process_inbound_email_to_thread(p_inbound_id uuid, p_group_id uuid, p_from_email character varying, p_from_name character varying, p_subject character varying, p_body_text text, p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.process_inbound_email_to_thread(p_inbound_id uuid, p_group_id uuid, p_from_email character varying, p_from_name character varying, p_subject character varying, p_body_text text, p_company_id integer) IS 'Procesa un email entrante y crea mensaje en el thread';


--
-- Name: process_loan_repayment(integer, uuid, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.process_loan_repayment(p_company_id integer, p_user_id uuid, p_overtime_hours numeric) RETURNS TABLE(hours_to_bank numeric, hours_to_repay numeric, loans_affected integer, remaining_debt numeric, message text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_template RECORD;
    v_hours_for_repayment DECIMAL;
    v_hours_for_bank DECIMAL;
    v_loan RECORD;
    v_repaid_count INTEGER := 0;
    v_remaining DECIMAL;
    v_total_remaining_debt DECIMAL;
BEGIN
    -- Obtener plantilla
    SELECT * INTO v_template
    FROM hour_bank_templates
    WHERE company_id = p_company_id AND is_enabled = true
    LIMIT 1;

    -- Calcular distribucin segn poltica
    IF v_template.loan_repayment_priority = 'mandatory' THEN
        v_hours_for_repayment := p_overtime_hours; -- 100% para pagar deuda
    ELSIF v_template.loan_repayment_priority = 'partial' THEN
        v_hours_for_repayment := p_overtime_hours * 0.5; -- 50% para deuda
    ELSE
        v_hours_for_repayment := p_overtime_hours * 0.25; -- 25% mnimo
    END IF;

    v_remaining := v_hours_for_repayment;

    -- Procesar prstamos activos (FIFO - primero los ms antiguos)
    FOR v_loan IN
        SELECT * FROM hour_bank_loans
        WHERE company_id = p_company_id
        AND user_id = p_user_id
        AND status IN ('active', 'partial')
        ORDER BY borrowed_at
    LOOP
        IF v_remaining <= 0 THEN
            EXIT;
        END IF;

        -- Calcular cunto podemos pagar de este prstamo
        DECLARE
            v_payment DECIMAL;
        BEGIN
            v_payment := LEAST(v_remaining, v_loan.balance_remaining);

            -- Actualizar prstamo
            UPDATE hour_bank_loans
            SET
                hours_repaid = hours_repaid + v_payment,
                balance_remaining = balance_remaining - v_payment,
                status = CASE
                    WHEN balance_remaining - v_payment <= 0 THEN 'repaid'
                    ELSE 'partial'
                END,
                fully_repaid_at = CASE
                    WHEN balance_remaining - v_payment <= 0 THEN CURRENT_TIMESTAMP
                    ELSE NULL
                END,
                updated_at = CURRENT_TIMESTAMP
            WHERE id = v_loan.id;

            v_remaining := v_remaining - v_payment;
            v_repaid_count := v_repaid_count + 1;
        END;
    END LOOP;

    -- Calcular horas que van al banco (despus de pagar deuda)
    v_hours_for_bank := p_overtime_hours - (v_hours_for_repayment - v_remaining);

    -- Obtener deuda total restante
    SELECT COALESCE(SUM(balance_remaining), 0) INTO v_total_remaining_debt
    FROM hour_bank_loans
    WHERE company_id = p_company_id
    AND user_id = p_user_id
    AND status IN ('active', 'partial');

    RETURN QUERY SELECT
        v_hours_for_bank,
        v_hours_for_repayment - v_remaining,
        v_repaid_count,
        v_total_remaining_debt,
        CASE
            WHEN v_total_remaining_debt = 0 THEN 'Deuda saldada completamente'
            WHEN v_repaid_count > 0 THEN format('Pagados %s prstamos. Deuda restante: %s horas', v_repaid_count, v_total_remaining_debt)
            ELSE 'Sin prstamos pendientes'
        END::TEXT;
END;
$$;


--
-- Name: process_redemption_checkout(uuid, integer, time without time zone, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.process_redemption_checkout(p_user_id uuid, p_company_id integer, p_checkout_time time without time zone, p_checkout_date date DEFAULT CURRENT_DATE) RETURNS TABLE(has_redemption boolean, request_id uuid, hours_approved numeric, expected_checkout time without time zone, actual_checkout time without time zone, deviation_minutes integer, compliance_status character varying, message text)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_scheduled RECORD;
    v_deviation INTEGER;
    v_status VARCHAR;
    v_msg TEXT;
BEGIN
    -- Buscar si tiene canje programado para hoy
    SELECT sr.*, rr.hours_requested
    INTO v_scheduled
    FROM hour_bank_scheduled_redemptions sr
    JOIN hour_bank_redemption_requests rr ON rr.id = sr.request_id
    WHERE sr.user_id = p_user_id
    AND sr.company_id = p_company_id
    AND sr.scheduled_date = p_checkout_date
    AND sr.is_executed = false
    AND rr.status = 'approved';

    IF v_scheduled IS NULL THEN
        -- No tiene canje programado
        RETURN QUERY SELECT
            false,
            NULL::UUID,
            NULL::DECIMAL,
            NULL::TIME,
            p_checkout_time,
            NULL::INTEGER,
            NULL::VARCHAR,
            'Sin canje programado para hoy'::TEXT;
        RETURN;
    END IF;

    -- Calcular desviacin en minutos
    v_deviation := EXTRACT(EPOCH FROM (p_checkout_time - v_scheduled.expected_checkout_time))/60;

    -- Determinar estado de cumplimiento
    IF ABS(v_deviation) <= 5 THEN
        v_status := 'compliant';
        v_msg := 'Salida en horario correcto segn canje autorizado';
    ELSIF v_deviation < -5 THEN
        v_status := 'early';
        v_msg := format('Salida %d minutos antes de lo autorizado', ABS(v_deviation));
    ELSE
        v_status := 'late';
        v_msg := format('Salida %d minutos despus de lo esperado', v_deviation);
    END IF;

    -- Actualizar registro de canje programado
    UPDATE hour_bank_scheduled_redemptions
    SET
        is_executed = true,
        executed_at = CURRENT_TIMESTAMP,
        actual_checkout_time = p_checkout_time,
        compliance_status = v_status,
        deviation_minutes = v_deviation,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = v_scheduled.id;

    -- Si cumpli correctamente, marcar solicitud como ejecutada
    IF v_status = 'compliant' THEN
        UPDATE hour_bank_redemption_requests
        SET
            status = 'executed',
            executed_at = CURRENT_TIMESTAMP,
            actual_hours_used = v_scheduled.hours_approved,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = v_scheduled.request_id;

        -- Registrar transaccin de uso
        INSERT INTO hour_bank_transactions (
            company_id, user_id, transaction_type, hours_final, hours_raw, conversion_rate,
            description, status, source_type, source_request_id
        ) VALUES (
            p_company_id, p_user_id, 'redemption', v_scheduled.hours_approved, v_scheduled.hours_approved, 1.0,
            format('Canje ejecutado - Solicitud #%s', v_scheduled.request_id),
            'completed', 'redemption', v_scheduled.request_id
        );
    END IF;

    RETURN QUERY SELECT
        true,
        v_scheduled.request_id,
        v_scheduled.hours_approved,
        v_scheduled.expected_checkout_time,
        p_checkout_time,
        v_deviation,
        v_status,
        v_msg;
END;
$$;


--
-- Name: process_scheduled_payments(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.process_scheduled_payments() RETURNS TABLE(processed_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_count INTEGER;
BEGIN
  UPDATE commission_payments
  SET
    status = 'IN_PROCESS',
    updated_at = CURRENT_TIMESTAMP
  WHERE
    status = 'SCHEDULED'
    AND scheduled_date <= CURRENT_DATE;

  GET DIAGNOSTICS v_count = ROW_COUNT;
  processed_count := v_count;
  RETURN NEXT;
END;
$$;


--
-- Name: puede_facturar_cliente(integer, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.puede_facturar_cliente(p_cliente_id integer, p_monto numeric) RETURNS TABLE(puede_facturar boolean, motivo_bloqueo text, credito_disponible numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_cliente RECORD;
BEGIN
    SELECT * INTO v_cliente
    FROM siac_clientes
    WHERE id = p_cliente_id;

    IF NOT FOUND THEN
        RETURN QUERY SELECT false, 'Cliente no encontrado'::TEXT, 0::NUMERIC;
        RETURN;
    END IF;

    -- Verificar bloqueo por vencimiento
    IF v_cliente.bloqueo_por_vencimiento THEN
        RETURN QUERY SELECT false, 'Cliente bloqueado por vencimiento de plazo'::TEXT, v_cliente.credito_disponible;
        RETURN;
    END IF;

    -- Verificar bloqueo por crdito
    IF v_cliente.bloqueo_por_credito THEN
        RETURN QUERY SELECT false, 'Cliente bloqueado por exceso de crdito'::TEXT, v_cliente.credito_disponible;
        RETURN;
    END IF;

    -- Verificar si tiene cuenta corriente habilitada
    IF v_cliente.cuenta_corriente_habilitada THEN
        -- Verificar si el monto excede crdito disponible
        IF (v_cliente.credito_disponible - p_monto) < 0 THEN
            RETURN QUERY SELECT false, 'Monto excede crdito disponible'::TEXT, v_cliente.credito_disponible;
            RETURN;
        END IF;
    END IF;

    -- Todo OK
    RETURN QUERY SELECT true, NULL::TEXT, v_cliente.credito_disponible;
END;
$$;


--
-- Name: refresh_all_profiles_batch(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.refresh_all_profiles_batch(p_company_id integer DEFAULT NULL::integer, p_batch_size integer DEFAULT 100) RETURNS TABLE(processed_count integer, errors_count integer, duration_seconds integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_start_time TIMESTAMP;
    v_end_time TIMESTAMP;
    v_processed INTEGER := 0;
    v_errors INTEGER := 0;
    v_user RECORD;
BEGIN
    v_start_time := clock_timestamp();

    -- Iterar sobre usuarios activos
    FOR v_user IN (
        SELECT DISTINCT u.user_id, u.company_id
        FROM users u
        WHERE (p_company_id IS NULL OR u.company_id = p_company_id)
          AND u.is_active = true
        LIMIT p_batch_size
    ) LOOP
        BEGIN
            PERFORM refresh_attendance_profiles(v_user.user_id, v_user.company_id, 90);
            v_processed := v_processed + 1;
        EXCEPTION WHEN OTHERS THEN
            v_errors := v_errors + 1;
            RAISE NOTICE 'Error processing user % (company %): %', v_user.user_id, v_user.company_id, SQLERRM;
        END;
    END LOOP;

    v_end_time := clock_timestamp();

    RETURN QUERY SELECT
        v_processed,
        v_errors,
        EXTRACT(EPOCH FROM (v_end_time - v_start_time))::INTEGER;
END;
$$;


--
-- Name: FUNCTION refresh_all_profiles_batch(p_company_id integer, p_batch_size integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.refresh_all_profiles_batch(p_company_id integer, p_batch_size integer) IS 'Recalcula scoring en lote (usado por cron job diario)';


--
-- Name: refresh_attendance_profiles(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.refresh_attendance_profiles(p_user_id uuid, p_company_id integer, p_period_days integer DEFAULT 90) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_total_days INTEGER;
    v_present_days INTEGER;
    v_absent_days INTEGER;
    v_late_count INTEGER;
    v_early_depart_count INTEGER;
    v_tolerance_usage_count INTEGER;
    v_avg_late_min INTEGER;
    v_overtime_total DECIMAL(10,2);
    v_scoring_punctuality DECIMAL(5,2);
    v_scoring_absence DECIMAL(5,2);
    v_scoring_late DECIMAL(5,2);
    v_scoring_early DECIMAL(5,2);
    v_scoring_total DECIMAL(5,2);
    v_period_start DATE;
    v_period_end DATE;
    v_profile_category VARCHAR(50);
BEGIN
    -- Calcular fechas del perodo
    v_period_end := CURRENT_DATE;
    v_period_start := CURRENT_DATE - (p_period_days || ' days')::INTERVAL;

    -- Calcular mtricas desde attendances
    SELECT
        COUNT(DISTINCT work_date),
        COUNT(*) FILTER (WHERE status != 'absent'),
        COUNT(*) FILTER (WHERE status = 'absent'),
        COUNT(*) FILTER (WHERE status = 'late'),
        COUNT(*) FILTER (WHERE check_out < check_in + (working_hours || ' hours')::INTERVAL),
        0, -- tolerance usage (requiere lgica adicional con shifts)
        COALESCE(AVG(EXTRACT(EPOCH FROM (check_in - check_in))::INTEGER / 60) FILTER (WHERE status = 'late'), 0),
        COALESCE(SUM(overtime_hours), 0)
    INTO
        v_total_days,
        v_present_days,
        v_absent_days,
        v_late_count,
        v_early_depart_count,
        v_tolerance_usage_count,
        v_avg_late_min,
        v_overtime_total
    FROM attendances
    WHERE user_id = p_user_id
      AND company_id = p_company_id
      AND work_date BETWEEN v_period_start AND v_period_end;

    -- Calcular scoring components
    v_scoring_punctuality := GREATEST(0, 100 - (v_late_count::DECIMAL / NULLIF(v_total_days, 0) * 100));
    v_scoring_absence := GREATEST(0, 100 - (v_absent_days::DECIMAL / NULLIF(v_total_days, 0) * 100));
    v_scoring_late := GREATEST(0, 100 - (v_late_count * 0.5));
    v_scoring_early := GREATEST(0, 100 - (v_early_depart_count * 0.3));

    -- Scoring total ponderado
    v_scoring_total := (v_scoring_punctuality * 0.40) +
                       (v_scoring_absence * 0.30) +
                       (v_scoring_late * 0.20) +
                       (v_scoring_early * 0.10);

    -- Determinar categora de perfil
    IF v_scoring_total >= 90 THEN
        v_profile_category := 'Ejemplar';
    ELSIF v_scoring_total >= 75 THEN
        v_profile_category := 'Promedio Alto';
    ELSIF v_scoring_total >= 60 THEN
        v_profile_category := 'Promedio';
    ELSIF v_scoring_total >= 40 THEN
        v_profile_category := 'Necesita Mejora';
    ELSE
        v_profile_category := 'Problemtico';
    END IF;

    -- UPSERT en attendance_profiles
    INSERT INTO attendance_profiles (
        user_id, company_id, scoring_total, scoring_punctuality, scoring_absence,
        scoring_late_arrival, scoring_early_departure, total_days, present_days,
        absent_days, late_arrivals_count, early_departures_count, avg_late_minutes,
        overtime_hours_total, calculation_period_start, calculation_period_end,
        profile_category, last_calculated_at, updated_at
    ) VALUES (
        p_user_id, p_company_id, v_scoring_total, v_scoring_punctuality, v_scoring_absence,
        v_scoring_late, v_scoring_early, v_total_days, v_present_days,
        v_absent_days, v_late_count, v_early_depart_count, v_avg_late_min,
        v_overtime_total, v_period_start, v_period_end,
        v_profile_category, NOW(), NOW()
    )
    ON CONFLICT (user_id, company_id)
    DO UPDATE SET
        scoring_total = EXCLUDED.scoring_total,
        scoring_punctuality = EXCLUDED.scoring_punctuality,
        scoring_absence = EXCLUDED.scoring_absence,
        scoring_late_arrival = EXCLUDED.scoring_late_arrival,
        scoring_early_departure = EXCLUDED.scoring_early_departure,
        total_days = EXCLUDED.total_days,
        present_days = EXCLUDED.present_days,
        absent_days = EXCLUDED.absent_days,
        late_arrivals_count = EXCLUDED.late_arrivals_count,
        early_departures_count = EXCLUDED.early_departures_count,
        avg_late_minutes = EXCLUDED.avg_late_minutes,
        overtime_hours_total = EXCLUDED.overtime_hours_total,
        calculation_period_start = EXCLUDED.calculation_period_start,
        calculation_period_end = EXCLUDED.calculation_period_end,
        profile_category = EXCLUDED.profile_category,
        last_calculated_at = NOW(),
        updated_at = NOW();
END;
$$;


--
-- Name: FUNCTION refresh_attendance_profiles(p_user_id uuid, p_company_id integer, p_period_days integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.refresh_attendance_profiles(p_user_id uuid, p_company_id integer, p_period_days integer) IS 'Recalcula scoring y mtricas de asistencia para un empleado';


--
-- Name: refresh_vendor_statistics(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.refresh_vendor_statistics(p_vendor_id uuid) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_sales_companies INTEGER;
    v_support_companies INTEGER;
    v_sales_users INTEGER;
    v_support_users INTEGER;
    v_total_sales_usd DECIMAL(12,2);
    v_total_support_usd DECIMAL(12,2);
    v_total_modules_value DECIMAL(12,2);
BEGIN
    -- Contar empresas de venta
    SELECT COUNT(*) INTO v_sales_companies
    FROM companies
    WHERE assigned_vendor_id = p_vendor_id AND is_active = true;

    -- Contar empresas de soporte
    SELECT COUNT(*) INTO v_support_companies
    FROM companies
    WHERE support_vendor_id = p_vendor_id AND is_active = true;

    -- Contar usuarios de ventas
    SELECT COALESCE(SUM(u.total_users), 0) INTO v_sales_users
    FROM companies c
    LEFT JOIN (
        SELECT company_id, COUNT(*) as total_users
        FROM users
        GROUP BY company_id
    ) u ON c.company_id = u.company_id
    WHERE c.assigned_vendor_id = p_vendor_id AND c.is_active = true;

    -- Contar usuarios de soporte
    SELECT COALESCE(SUM(u.total_users), 0) INTO v_support_users
    FROM companies c
    LEFT JOIN (
        SELECT company_id, COUNT(*) as total_users
        FROM users
        GROUP BY company_id
    ) u ON c.company_id = u.company_id
    WHERE c.support_vendor_id = p_vendor_id AND c.is_active = true;

    -- Calcular comisiones de venta (suma de sales_commission_usd de todas las empresas)
    SELECT COALESCE(SUM(sales_commission_usd), 0) INTO v_total_sales_usd
    FROM companies
    WHERE assigned_vendor_id = p_vendor_id AND is_active = true;

    -- Calcular comisiones de soporte
    SELECT COALESCE(SUM(support_commission_usd), 0) INTO v_total_support_usd
    FROM companies
    WHERE support_vendor_id = p_vendor_id AND is_active = true;

    -- Calcular valor total de mdulos (suma de monthly_total)
    SELECT COALESCE(SUM(monthly_total), 0) INTO v_total_modules_value
    FROM companies
    WHERE (assigned_vendor_id = p_vendor_id OR support_vendor_id = p_vendor_id)
    AND is_active = true;

    -- Actualizar o insertar en vendor_statistics
    INSERT INTO vendor_statistics (
        vendor_id,
        sales_companies,
        support_companies,
        total_companies,
        sales_users,
        support_users,
        total_users,
        total_sales_commission_usd,
        monthly_sales_commission_usd,
        total_support_commission_usd,
        monthly_support_commission_usd,
        grand_total_commission_usd,
        total_modules_value_usd,
        last_updated_at
    ) VALUES (
        p_vendor_id,
        v_sales_companies,
        v_support_companies,
        v_sales_companies + v_support_companies,
        v_sales_users,
        v_support_users,
        v_sales_users + v_support_users,
        v_total_sales_usd,
        v_total_sales_usd,  -- Por ahora igual, despus se puede filtrar por mes
        v_total_support_usd,
        v_total_support_usd,
        v_total_sales_usd + v_total_support_usd,
        v_total_modules_value,
        NOW()
    )
    ON CONFLICT (vendor_id) DO UPDATE SET
        sales_companies = EXCLUDED.sales_companies,
        support_companies = EXCLUDED.support_companies,
        total_companies = EXCLUDED.total_companies,
        sales_users = EXCLUDED.sales_users,
        support_users = EXCLUDED.support_users,
        total_users = EXCLUDED.total_users,
        total_sales_commission_usd = EXCLUDED.total_sales_commission_usd,
        monthly_sales_commission_usd = EXCLUDED.monthly_sales_commission_usd,
        total_support_commission_usd = EXCLUDED.total_support_commission_usd,
        monthly_support_commission_usd = EXCLUDED.monthly_support_commission_usd,
        grand_total_commission_usd = EXCLUDED.grand_total_commission_usd,
        total_modules_value_usd = EXCLUDED.total_modules_value_usd,
        last_updated_at = NOW();
END;
$$;


--
-- Name: registrar_factura_generada(integer, integer, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.registrar_factura_generada(p_presupuesto_id integer, p_factura_id integer, p_numero_factura character varying, p_period character varying) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_nuevo_registro JSONB;
BEGIN
    v_nuevo_registro := jsonb_build_object(
        'factura_id', p_factura_id,
        'numero_factura', p_numero_factura,
        'period', p_period,
        'generated_at', CURRENT_TIMESTAMP
    );
    UPDATE siac_presupuestos SET facturas_generadas = facturas_generadas || v_nuevo_registro WHERE id = p_presupuesto_id;
END;
$$;


--
-- Name: remove_pending_consent(integer, character varying, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.remove_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF p_user_type = 'employee' THEN
        UPDATE users
        SET pending_consents = array_remove(pending_consents, p_consent_id)
        WHERE user_id = p_user_id;
    ELSE
        UPDATE partners
        SET pending_consents = array_remove(pending_consents, p_consent_id)
        WHERE id = p_user_id;
    END IF;

    RETURN FOUND;
END;
$$;


--
-- Name: FUNCTION remove_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.remove_pending_consent(p_user_id integer, p_user_type character varying, p_consent_id uuid) IS 'Remueve un consentimiento pendiente del array del usuario';


--
-- Name: reset_email_counters(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.reset_email_counters() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Reset contador diario
    IF NEW.last_reset_daily < CURRENT_DATE THEN
        NEW.current_daily_count = 0;
        NEW.last_reset_daily = CURRENT_TIMESTAMP;
    END IF;

    -- Reset contador mensual
    IF EXTRACT(MONTH FROM NEW.last_reset_monthly) < EXTRACT(MONTH FROM CURRENT_TIMESTAMP)
       OR EXTRACT(YEAR FROM NEW.last_reset_monthly) < EXTRACT(YEAR FROM CURRENT_TIMESTAMP) THEN
        NEW.current_monthly_count = 0;
        NEW.last_reset_monthly = CURRENT_TIMESTAMP;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: run_data_integrity_check(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.run_data_integrity_check(p_company_id integer DEFAULT NULL::integer) RETURNS TABLE(check_name text, issues_found integer, auto_fixed integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_orphan_notifs INTEGER;
    v_users_no_shift INTEGER;
    v_duplicate_checkins INTEGER;
BEGIN
    -- 1. Notificaciones hurfanas
    SELECT COUNT(*) INTO v_orphan_notifs
    FROM notifications n
    LEFT JOIN users u ON n.recipient_user_id = u.user_id
    WHERE n.recipient_user_id IS NOT NULL
    AND u.user_id IS NULL
    AND (p_company_id IS NULL OR n.company_id = p_company_id);

    IF v_orphan_notifs > 0 THEN
        INSERT INTO data_integrity_log (check_type, table_name, company_id, issue_description, auto_fixed, fix_description)
        VALUES ('orphan_reference', 'notifications', p_company_id,
                v_orphan_notifs || ' notificaciones con recipient inexistente',
                true, 'Eliminadas automticamente');

        DELETE FROM notifications n
        WHERE n.recipient_user_id IS NOT NULL
        AND NOT EXISTS (SELECT 1 FROM users u WHERE u.user_id = n.recipient_user_id)
        AND (p_company_id IS NULL OR n.company_id = p_company_id);
    END IF;

    RETURN QUERY SELECT 'Orphan Notifications'::TEXT, v_orphan_notifs, v_orphan_notifs;

    -- 2. Usuarios sin turno (solo advertencia)
    SELECT COUNT(*) INTO v_users_no_shift
    FROM users u
    LEFT JOIN user_shifts us ON u.user_id = us.user_id
    WHERE u."isActive" = true
    AND u.role = 'employee'
    AND us.user_id IS NULL
    AND (p_company_id IS NULL OR u.company_id = p_company_id);

    IF v_users_no_shift > 0 THEN
        INSERT INTO data_integrity_log (check_type, table_name, company_id, issue_description, auto_fixed)
        VALUES ('missing_relation', 'users', p_company_id,
                v_users_no_shift || ' empleados activos sin turno asignado',
                false);
    END IF;

    RETURN QUERY SELECT 'Employees Without Shift'::TEXT, v_users_no_shift, 0;

    -- 3. Check-ins duplicados
    SELECT COUNT(*) INTO v_duplicate_checkins
    FROM (
        SELECT "UserId", date, COUNT(*) as cnt
        FROM attendances
        WHERE "checkOutTime" IS NULL
        AND (p_company_id IS NULL OR company_id = p_company_id)
        GROUP BY "UserId", date
        HAVING COUNT(*) > 1
    ) dups;

    RETURN QUERY SELECT 'Duplicate Open Check-ins'::TEXT, v_duplicate_checkins, 0;

END;
$$;


--
-- Name: FUNCTION run_data_integrity_check(p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.run_data_integrity_check(p_company_id integer) IS 'Funcin de auditora ejecutable por cron para detectar y corregir problemas de integridad';


--
-- Name: search_similar_answers(text, integer, character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.search_similar_answers(search_question text, search_company_id integer DEFAULT NULL::integer, search_module character varying DEFAULT NULL::character varying, limit_results integer DEFAULT 5) RETURNS TABLE(id uuid, question text, answer text, helpful boolean, reused_count integer, similarity real)
    LANGUAGE plpgsql
    AS $$
BEGIN
  RETURN QUERY
  SELECT
    kb.id,
    kb.question,
    COALESCE(kb.improved_answer, kb.answer) as answer,
    kb.helpful,
    kb.reused_count,
    similarity(kb.question_normalized, lower(unaccent(search_question))) as similarity
  FROM assistant_knowledge_base kb
  WHERE
    (search_company_id IS NULL OR kb.company_id = search_company_id)
    AND (search_module IS NULL OR kb.module_name = search_module)
    AND kb.helpful = TRUE
    AND similarity(kb.question_normalized, lower(unaccent(search_question))) > 0.3
  ORDER BY similarity DESC, kb.reused_count DESC
  LIMIT limit_results;
END;
$$;


--
-- Name: FUNCTION search_similar_answers(search_question text, search_company_id integer, search_module character varying, limit_results integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.search_similar_answers(search_question text, search_company_id integer, search_module character varying, limit_results integer) IS 'Busca respuestas similares en la knowledge base usando similitud de texto';


--
-- Name: set_document_edit_window(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_document_edit_window() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Por defecto 72 horas para editar despus de creacin
    IF NEW.can_edit_until IS NULL THEN
        NEW.can_edit_until := NEW.created_at + (COALESCE(NEW.edit_window_hours, 72) || ' hours')::INTERVAL;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: set_medical_record_editable_until(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_medical_record_editable_until() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Ventana de 48 horas desde creacion
    NEW.editable_until = NEW.created_at + INTERVAL '48 hours';
    RETURN NEW;
END;
$$;


--
-- Name: set_medical_record_expiration(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_medical_record_expiration() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_validity_days INTEGER;
BEGIN
    IF NEW.template_id IS NOT NULL AND NEW.expiration_date IS NULL THEN
        SELECT validity_days INTO v_validity_days
        FROM medical_exam_templates
        WHERE id = NEW.template_id;

        IF v_validity_days IS NOT NULL THEN
            NEW.expiration_date = NEW.exam_date + (v_validity_days || ' days')::INTERVAL;
        END IF;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: set_ticket_sla_deadlines(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.set_ticket_sla_deadlines() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_deadlines RECORD;
BEGIN
  -- Calcular deadlines segn plan de SLA
  SELECT * INTO v_deadlines
  FROM calculate_sla_deadlines(NEW.company_id, NEW.created_at);

  NEW.sla_first_response_deadline := v_deadlines.first_response_deadline;
  NEW.sla_resolution_deadline := v_deadlines.resolution_deadline;
  NEW.sla_escalation_deadline := v_deadlines.escalation_deadline;

  RETURN NEW;
END;
$$;


--
-- Name: siac_actualizar_stock(integer, numeric, character varying, numeric, character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_actualizar_stock(p_producto_id integer, p_cantidad numeric, p_tipo_movimiento character varying, p_precio_unitario numeric DEFAULT 0, p_motivo character varying DEFAULT NULL::character varying, p_usuario_id integer DEFAULT NULL::integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
    DECLARE
        v_stock_actual DECIMAL;
        v_company_id INTEGER;
        v_nuevo_stock DECIMAL;
    BEGIN
        -- Obtener stock actual y company_id
        SELECT stock_actual, company_id
        INTO v_stock_actual, v_company_id
        FROM siac_productos
        WHERE id = p_producto_id;

        -- Calcular nuevo stock segn tipo de movimiento
        CASE p_tipo_movimiento
            WHEN 'INGRESO' THEN
                v_nuevo_stock := v_stock_actual + p_cantidad;
            WHEN 'EGRESO' THEN
                v_nuevo_stock := v_stock_actual - p_cantidad;
            WHEN 'AJUSTE' THEN
                v_nuevo_stock := p_cantidad; -- p_cantidad es el stock final
            ELSE
                RAISE EXCEPTION 'Tipo de movimiento no vlido: %', p_tipo_movimiento;
        END CASE;

        -- Validar que el stock no sea negativo (excepto en ajustes)
        IF v_nuevo_stock < 0 AND p_tipo_movimiento != 'AJUSTE' THEN
            RAISE EXCEPTION 'Stock insuficiente. Stock actual: %, Cantidad solicitada: %', v_stock_actual, p_cantidad;
        END IF;

        -- Actualizar stock en producto
        UPDATE siac_productos
        SET stock_actual = v_nuevo_stock,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = p_producto_id;

        -- Registrar movimiento
        INSERT INTO siac_stock_movimientos (
            company_id,
            producto_id,
            tipo_movimiento,
            cantidad,
            precio_unitario,
            stock_anterior,
            stock_resultante,
            motivo,
            usuario_id
        ) VALUES (
            v_company_id,
            p_producto_id,
            p_tipo_movimiento,
            CASE WHEN p_tipo_movimiento = 'AJUSTE' THEN p_cantidad - v_stock_actual ELSE p_cantidad END,
            p_precio_unitario,
            v_stock_actual,
            v_nuevo_stock,
            p_motivo,
            p_usuario_id
        );

        RETURN TRUE;
    END;
    $$;


--
-- Name: siac_calcular_precio_venta(numeric, numeric); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_calcular_precio_venta(p_precio_compra numeric, p_margen_porcentaje numeric) RETURNS numeric
    LANGUAGE plpgsql
    AS $$
    BEGIN
        IF p_precio_compra IS NULL OR p_precio_compra = 0 THEN
            RETURN 0;
        END IF;

        RETURN ROUND(p_precio_compra * (1 + (p_margen_porcentaje / 100)), 2);
    END;
    $$;


--
-- Name: siac_calcular_totales_factura(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_calcular_totales_factura(p_factura_id integer) RETURNS void
    LANGUAGE plpgsql
    AS $$
            DECLARE
                v_subtotal DECIMAL(12,2) := 0;
                v_total_impuestos DECIMAL(12,2) := 0;
                v_total_factura DECIMAL(12,2) := 0;
                v_descuento_factura DECIMAL(12,2) := 0;
            BEGIN
                -- Calcular subtotal de items
                SELECT COALESCE(SUM(subtotal_con_descuento), 0)
                INTO v_subtotal
                FROM siac_facturas_items
                WHERE factura_id = p_factura_id;

                -- Calcular total de impuestos
                SELECT COALESCE(SUM(importe_impuesto), 0)
                INTO v_total_impuestos
                FROM siac_facturas_impuestos
                WHERE factura_id = p_factura_id;

                -- Obtener descuento general de factura
                SELECT COALESCE(descuento_importe, 0)
                INTO v_descuento_factura
                FROM siac_facturas
                WHERE id = p_factura_id;

                -- Calcular total final
                v_total_factura := (v_subtotal - v_descuento_factura) + v_total_impuestos;

                -- Actualizar factura
                UPDATE siac_facturas
                SET subtotal = v_subtotal,
                    total_impuestos = v_total_impuestos,
                    total_neto = v_subtotal - v_descuento_factura,
                    total_factura = v_total_factura,
                    updated_at = CURRENT_TIMESTAMP
                WHERE id = p_factura_id;
            END;
            $$;


--
-- Name: siac_clientes_before_insert(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_clientes_before_insert() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
    BEGIN
        IF NEW.documento_numero IS NOT NULL THEN
            NEW.documento_formateado := siac_formatear_documento(NEW.documento_numero, NEW.documento_tipo);
        END IF;

        NEW.domicilio_completo := TRIM(
            COALESCE(NEW.domicilio_calle, '') || ' ' ||
            COALESCE(NEW.domicilio_numero, '') ||
            CASE WHEN NEW.domicilio_piso IS NOT NULL THEN ' Piso ' || NEW.domicilio_piso ELSE '' END ||
            CASE WHEN NEW.domicilio_depto IS NOT NULL THEN ' Depto ' || NEW.domicilio_depto ELSE '' END
        );

        IF NEW.credito_disponible IS NULL THEN
            NEW.credito_disponible := NEW.limite_credito;
        END IF;

        RETURN NEW;
    END;
    $$;


--
-- Name: siac_formatear_documento(character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_formatear_documento(p_numero character varying, p_tipo character varying) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
    BEGIN
        CASE p_tipo
            WHEN 'CUIT' THEN
                IF LENGTH(p_numero) = 11 THEN
                    RETURN SUBSTR(p_numero, 1, 2) || '-' || SUBSTR(p_numero, 3, 8) || '-' || SUBSTR(p_numero, 11, 1);
                END IF;
            WHEN 'RUT' THEN
                RETURN p_numero;
            WHEN 'CNPJ' THEN
                IF LENGTH(p_numero) = 14 THEN
                    RETURN SUBSTR(p_numero, 1, 2) || '.' || SUBSTR(p_numero, 3, 3) || '.' ||
                           SUBSTR(p_numero, 6, 3) || '/' || SUBSTR(p_numero, 9, 4) || '-' || SUBSTR(p_numero, 13, 2);
                END IF;
        END CASE;
        RETURN p_numero;
    END;
    $$;


--
-- Name: siac_modulo_contratado(integer, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_modulo_contratado(p_company_id integer, p_modulo_codigo character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
    BEGIN
        RETURN EXISTS (
            SELECT 1 FROM siac_modulos_empresa
            WHERE company_id = p_company_id
            AND modulo_codigo = p_modulo_codigo
            AND activo = true
            AND (fecha_vencimiento IS NULL OR fecha_vencimiento > CURRENT_DATE)
        );
    END;
    $$;


--
-- Name: siac_obtener_proximo_numero(integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_obtener_proximo_numero(p_caja_id integer, p_tipo_comprobante_id integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
            DECLARE
                v_numero_actual INTEGER;
            BEGIN
                -- Obtener y actualizar nmero actual
                UPDATE siac_numeracion_comprobantes
                SET numero_actual = numero_actual + 1,
                    updated_at = CURRENT_TIMESTAMP
                WHERE caja_id = p_caja_id
                  AND tipo_comprobante_id = p_tipo_comprobante_id
                  AND activo = true
                RETURNING numero_actual INTO v_numero_actual;

                -- Si no existe numeracin, crearla
                IF v_numero_actual IS NULL THEN
                    INSERT INTO siac_numeracion_comprobantes (caja_id, tipo_comprobante_id, numero_actual)
                    VALUES (p_caja_id, p_tipo_comprobante_id, 1)
                    RETURNING numero_actual INTO v_numero_actual;
                END IF;

                RETURN v_numero_actual;
            END;
            $$;


--
-- Name: siac_productos_calcular_precios(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.siac_productos_calcular_precios() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
    BEGIN
        -- Calcular precio de venta si hay precio de compra y margen
        IF NEW.precio_compra > 0 AND NEW.margen_porcentaje > 0 THEN
            NEW.precio_venta := siac_calcular_precio_venta(NEW.precio_compra, NEW.margen_porcentaje);
            NEW.margen_absoluto := NEW.precio_venta - NEW.precio_compra;
        END IF;

        -- Generar slug si no existe
        IF NEW.slug IS NULL OR NEW.slug = '' THEN
            NEW.slug := LOWER(REGEXP_REPLACE(NEW.nombre_producto, '[^a-zA-Z0-9]+', '-', 'g'));
        END IF;

        -- Timestamp de actualizacin
        NEW.updated_at := CURRENT_TIMESTAMP;

        RETURN NEW;
    END;
    $$;


--
-- Name: staff_can_view_company(uuid, character varying, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.staff_can_view_company(p_staff_id uuid, p_staff_role character varying, p_company_id integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_can_view BOOLEAN;
BEGIN
  -- Admins y supervisores pueden ver todas las empresas
  IF p_staff_role IN ('admin', 'supervisor') THEN
    RETURN true;
  END IF;

  -- Lderes pueden ver empresas de su equipo
  IF p_staff_role = 'leader' THEN
    SELECT EXISTS (
      SELECT 1
      FROM aponnt_staff_companies sc
      JOIN aponnt_staff s ON sc.staff_id = s.id
      WHERE sc.company_id = p_company_id
        AND sc.is_active = true
        AND (
          s.id = p_staff_id OR
          s.leader_id = p_staff_id
        )
    ) INTO v_can_view;
    RETURN v_can_view;
  END IF;

  -- Vendedores, soporte, etc: Solo sus empresas asignadas
  SELECT EXISTS (
    SELECT 1
    FROM aponnt_staff_companies
    WHERE staff_id = p_staff_id
      AND company_id = p_company_id
      AND is_active = true
  ) INTO v_can_view;

  RETURN v_can_view;
END;
$$;


--
-- Name: FUNCTION staff_can_view_company(p_staff_id uuid, p_staff_role character varying, p_company_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.staff_can_view_company(p_staff_id uuid, p_staff_role character varying, p_company_id integer) IS 'Verifica permisos multi-tenant para ver una empresa';


--
-- Name: suspend_expired_grace_contracts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.suspend_expired_grace_contracts() RETURNS TABLE(contract_id uuid, contract_code character varying, company_name character varying, grace_period_end date)
    LANGUAGE plpgsql
    AS $$
DECLARE
    rec RECORD;
BEGIN
    FOR rec IN
        SELECT
            c.id, c.contract_code, c.grace_period_end,
            co.name as company_name
        FROM contracts c
        JOIN companies co ON c.company_id = co.company_id
        WHERE c.status = 'GRACE_PERIOD'
          AND c.grace_period_end < CURRENT_DATE
    LOOP
        UPDATE contracts
        SET status = 'SUSPENDED', updated_at = CURRENT_TIMESTAMP
        WHERE id = rec.id;

        INSERT INTO contract_renewal_logs (
            contract_id, action_type, action_date, notes, created_at
        ) VALUES (
            rec.id, 'SUSPENSION', CURRENT_TIMESTAMP,
            'Contrato suspendido por vencimiento del perodo de gracia',
            CURRENT_TIMESTAMP
        );

        contract_id := rec.id;
        contract_code := rec.contract_code;
        company_name := rec.company_name;
        grace_period_end := rec.grace_period_end;
        RETURN NEXT;
    END LOOP;
END;
$$;


--
-- Name: suspend_expired_grace_period_contracts(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.suspend_expired_grace_period_contracts() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_count INTEGER := 0;
    v_contract RECORD;
BEGIN
    FOR v_contract IN
        SELECT id, company_id
        FROM contracts
        WHERE status = 'GRACE_PERIOD'
          AND grace_period_end < CURRENT_DATE
    LOOP
        UPDATE contracts
        SET status = 'SUSPENDED',
            updated_at = CURRENT_TIMESTAMP
        WHERE id = v_contract.id;

        -- Registrar en log
        INSERT INTO contract_renewal_logs (contract_id, event_type, details)
        VALUES (
            v_contract.id,
            'SUSPENSION_APPLIED',
            jsonb_build_object(
                'reason', 'Perodo de gracia expirado sin renovacin',
                'suspended_at', CURRENT_TIMESTAMP
            )
        );

        v_count := v_count + 1;
    END LOOP;

    RETURN v_count;
END;
$$;


--
-- Name: sync_active_modules_from_company_modules(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_active_modules_from_company_modules() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Actualizar active_modules de la empresa afectada
    UPDATE companies
    SET active_modules = (
        SELECT COALESCE(jsonb_agg(sm.module_key), '[]'::jsonb)
        FROM company_modules cm
        INNER JOIN system_modules sm ON cm.system_module_id = sm.id
        WHERE cm.company_id = COALESCE(NEW.company_id, OLD.company_id)
          AND cm.activo = true
    )
    WHERE company_id = COALESCE(NEW.company_id, OLD.company_id);

    RETURN COALESCE(NEW, OLD);
END;
$$;


--
-- Name: sync_is_active(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_is_active() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
      BEGIN
        IF NEW."isActive" IS DISTINCT FROM NEW.is_active THEN
          NEW.is_active = NEW."isActive";
        END IF;
        IF NEW.is_active IS DISTINCT FROM NEW."isActive" THEN
          NEW."isActive" = NEW.is_active;
        END IF;
        RETURN NEW;
      END;
      $$;


--
-- Name: sync_user_email(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_user_email() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Si se actualiza el email en users, sincronizar con user_emails
    IF TG_OP = 'UPDATE' AND OLD.email IS DISTINCT FROM NEW.email THEN
        -- Marcar el email anterior como inactivo
        UPDATE user_emails
        SET is_active = false,
            updated_at = CURRENT_TIMESTAMP
        WHERE user_id = NEW.user_id AND email = OLD.email;

        -- Insertar o activar el nuevo email
        INSERT INTO user_emails (user_id, company_id, email, is_primary, is_active)
        VALUES (NEW.user_id, NEW.company_id, NEW.email, true, true)
        ON CONFLICT (user_id, email)
        DO UPDATE SET
            is_active = true,
            is_primary = true,
            updated_at = CURRENT_TIMESTAMP;
    END IF;

    -- Si es un nuevo usuario, crear registro en user_emails
    IF TG_OP = 'INSERT' AND NEW.email IS NOT NULL THEN
        INSERT INTO user_emails (user_id, company_id, email, is_primary, is_active)
        VALUES (NEW.user_id, NEW.company_id, NEW.email, true, true)
        ON CONFLICT (user_id, email) DO NOTHING;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: sync_user_position_name(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.sync_user_position_name() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF NEW.organizational_position_id IS NOT NULL AND NEW.organizational_position_id != OLD.organizational_position_id THEN
        UPDATE users
        SET position = (SELECT position_name FROM organizational_positions WHERE id = NEW.organizational_position_id)
        WHERE user_id = NEW.user_id;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: test_partitioning_simple(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.test_partitioning_simple() RETURNS TABLE(test_name text, status text, execution_time_ms bigint)
    LANGUAGE plpgsql
    AS $$
      DECLARE
        start_time TIMESTAMP;
        end_time TIMESTAMP;
      BEGIN
        start_time := clock_timestamp();

        -- Test insert simple
        INSERT INTO biometric_scans (
          tenant_id, company_id, user_id, scan_data, template_hash,
          template_vector, quality_score, anti_spoofing_score, source
        ) VALUES (
          1, 999, 12345, '{"test": true}', 'test_hash_simple',
          ARRAY(SELECT random() FROM generate_series(1, 512)),
          0.95, 0.90, 'test_simple'
        );

        end_time := clock_timestamp();

        RETURN QUERY SELECT
          'Insert Test'::TEXT,
          'PASS'::TEXT,
          EXTRACT(MILLISECONDS FROM end_time - start_time)::BIGINT;

        -- Test select
        start_time := clock_timestamp();

        PERFORM COUNT(*) FROM biometric_scans WHERE company_id = 999;

        end_time := clock_timestamp();

        RETURN QUERY SELECT
          'Select Test'::TEXT,
          'PASS'::TEXT,
          EXTRACT(MILLISECONDS FROM end_time - start_time)::BIGINT;

        -- Cleanup
        DELETE FROM biometric_scans WHERE company_id = 999;
      END;
      $$;


--
-- Name: trigger_actualizar_totales_factura(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_actualizar_totales_factura() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            BEGIN
                -- Actualizar totales de la factura
                PERFORM siac_calcular_totales_factura(COALESCE(NEW.factura_id, OLD.factura_id));
                RETURN COALESCE(NEW, OLD);
            END;
            $$;


--
-- Name: trigger_add_initial_owner(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_add_initial_owner() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Solo si es nuevo registro y tiene created_by
    IF TG_OP = 'INSERT' AND NEW.created_by IS NOT NULL THEN
        PERFORM add_procedure_owner(NEW.id, NEW.created_by, 'created');
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: trigger_formatear_numero_factura(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_formatear_numero_factura() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
            BEGIN
                -- Formatear nmero completo segn configuracin
                NEW.numero_completo := COALESCE(NEW.prefijo, '') ||
                                      LPAD(NEW.numero::TEXT, 8, '0');
                RETURN NEW;
            END;
            $$;


--
-- Name: trigger_update_commission_summary(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.trigger_update_commission_summary() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'DELETE' THEN
        PERFORM update_partner_commission_summary(
            OLD.partner_id,
            EXTRACT(YEAR FROM OLD.transaction_date)::INTEGER,
            EXTRACT(MONTH FROM OLD.transaction_date)::INTEGER
        );
        RETURN OLD;
    ELSE
        PERFORM update_partner_commission_summary(
            NEW.partner_id,
            EXTRACT(YEAR FROM NEW.transaction_date)::INTEGER,
            EXTRACT(MONTH FROM NEW.transaction_date)::INTEGER
        );
        RETURN NEW;
    END IF;
END;
$$;


--
-- Name: try_lock_procedure_draft(uuid, uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.try_lock_procedure_draft(p_procedure_id uuid, p_user_id uuid, p_ttl_days integer DEFAULT 7) RETURNS TABLE(success boolean, message text, locked_by uuid, locked_by_name text, locked_at timestamp without time zone, expires_at timestamp without time zone)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_current_lock RECORD;
    v_user_name TEXT;
    v_expires TIMESTAMP;
BEGIN
    -- Verificar estado actual del procedimiento
    SELECT
        p.draft_locked_by,
        p.draft_locked_at,
        p.draft_expires_at,
        p.status,
        u."firstName" || ' ' || u."lastName" as locked_by_name
    INTO v_current_lock
    FROM procedures p
    LEFT JOIN users u ON p.draft_locked_by = u.user_id
    WHERE p.id = p_procedure_id;

    IF NOT FOUND THEN
        RETURN QUERY SELECT false, 'Procedimiento no encontrado'::TEXT, NULL::UUID, NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP;
        RETURN;
    END IF;

    -- Si no est en borrador, no se puede bloquear
    IF v_current_lock.status != 'draft' THEN
        RETURN QUERY SELECT false, 'Solo se pueden bloquear procedimientos en borrador'::TEXT, NULL::UUID, NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP;
        RETURN;
    END IF;

    -- Si ya est bloqueado por otro usuario y no ha expirado
    IF v_current_lock.draft_locked_by IS NOT NULL
       AND v_current_lock.draft_locked_by != p_user_id
       AND v_current_lock.draft_expires_at > NOW() THEN
        RETURN QUERY SELECT
            false,
            format('Borrador bloqueado por %s hasta %s', v_current_lock.locked_by_name, v_current_lock.draft_expires_at)::TEXT,
            v_current_lock.draft_locked_by,
            v_current_lock.locked_by_name,
            v_current_lock.draft_locked_at,
            v_current_lock.draft_expires_at;
        RETURN;
    END IF;

    -- Si estaba bloqueado pero expir, registrar desbloqueo
    IF v_current_lock.draft_locked_by IS NOT NULL AND v_current_lock.draft_expires_at <= NOW() THEN
        UPDATE procedure_draft_locks
        SET unlocked_at = NOW(), unlock_reason = 'expired'
        WHERE procedure_id = p_procedure_id AND unlocked_at IS NULL;
    END IF;

    -- Calcular expiracin
    v_expires := NOW() + (p_ttl_days || ' days')::INTERVAL;

    -- Obtener nombre del usuario que bloquea
    SELECT u."firstName" || ' ' || u."lastName" INTO v_user_name
    FROM users u WHERE u.user_id = p_user_id;

    -- Bloquear el borrador
    UPDATE procedures
    SET draft_locked_by = p_user_id,
        draft_locked_at = NOW(),
        draft_expires_at = v_expires,
        updated_at = NOW()
    WHERE id = p_procedure_id;

    -- Registrar en historial
    INSERT INTO procedure_draft_locks (procedure_id, locked_by, locked_at, expires_at)
    VALUES (p_procedure_id, p_user_id, NOW(), v_expires);

    RETURN QUERY SELECT
        true,
        'Borrador bloqueado exitosamente'::TEXT,
        p_user_id,
        v_user_name,
        NOW()::TIMESTAMP,
        v_expires;
END;
$$;


--
-- Name: unlock_procedure_draft(uuid, uuid, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.unlock_procedure_draft(p_procedure_id uuid, p_user_id uuid, p_reason character varying DEFAULT 'manual'::character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_current_lock UUID;
BEGIN
    SELECT draft_locked_by INTO v_current_lock
    FROM procedures WHERE id = p_procedure_id;

    -- Solo el que tiene el bloqueo puede liberarlo (o si expir)
    IF v_current_lock IS NULL THEN
        RETURN true; -- Ya est desbloqueado
    END IF;

    IF v_current_lock != p_user_id THEN
        -- Verificar si expir
        IF (SELECT draft_expires_at FROM procedures WHERE id = p_procedure_id) > NOW() THEN
            RETURN false; -- No puede liberar el bloqueo de otro
        END IF;
    END IF;

    -- Liberar bloqueo
    UPDATE procedures
    SET draft_locked_by = NULL,
        draft_locked_at = NULL,
        draft_expires_at = NULL,
        updated_at = NOW()
    WHERE id = p_procedure_id;

    -- Registrar en historial
    UPDATE procedure_draft_locks
    SET unlocked_at = NOW(), unlock_reason = p_reason
    WHERE procedure_id = p_procedure_id AND unlocked_at IS NULL;

    RETURN true;
END;
$$;


--
-- Name: update_admin_tasks_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_admin_tasks_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$;


--
-- Name: update_allowance_consumption(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_allowance_consumption() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF NEW.verification_status = 'verified' AND (OLD.verification_status IS NULL OR OLD.verification_status != 'verified') THEN
    UPDATE benefit_expense_allowances
    SET
      consumed_amount = consumed_amount + NEW.amount,
      consumed_quantity = consumed_quantity + NEW.quantity,
      updated_at = CURRENT_TIMESTAMP
    WHERE id = NEW.allowance_id;

    -- Verificar si se agot el lmite
    UPDATE benefit_expense_allowances
    SET status = 'exhausted'
    WHERE id = NEW.allowance_id
      AND (
        (max_amount IS NOT NULL AND consumed_amount >= max_amount) OR
        (max_quantity IS NOT NULL AND consumed_quantity >= max_quantity)
      );
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: update_aponnt_staff_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_aponnt_staff_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_aponnt_tables_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_aponnt_tables_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_assistant_knowledge_base_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_assistant_knowledge_base_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_benefit_documents_status(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_benefit_documents_status() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_validation RECORD;
BEGIN
  -- Validar documentos del beneficio
  SELECT * INTO v_validation
  FROM validate_benefit_documents(NEW.employee_benefit_id);

  -- Actualizar campo has_required_documents en employee_benefits
  UPDATE employee_benefits
  SET
    has_required_documents = v_validation.all_valid,
    documents_last_verified_at = CURRENT_TIMESTAMP
  WHERE id = NEW.employee_benefit_id;

  RETURN NEW;
END;
$$;


--
-- Name: update_biometric_photo(uuid, text, timestamp without time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_biometric_photo(p_user_id uuid, p_photo_url text, p_capture_date timestamp without time zone DEFAULT now()) RETURNS TABLE(success boolean, photo_url text, capture_date timestamp without time zone, expiration_date timestamp without time zone)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_expiration TIMESTAMP;
BEGIN
    -- Calcular fecha de vencimiento
    v_expiration := calculate_biometric_photo_expiration(p_capture_date);

    -- Actualizar usuario
    UPDATE users
    SET
        biometric_photo_url = p_photo_url,
        biometric_photo_date = p_capture_date,
        biometric_photo_expiration = v_expiration,
        "updatedAt" = NOW()
    WHERE user_id = p_user_id;

    -- Retornar resultado
    RETURN QUERY
    SELECT
        true as success,
        p_photo_url as photo_url,
        p_capture_date as capture_date,
        v_expiration as expiration_date;
END;
$$;


--
-- Name: FUNCTION update_biometric_photo(p_user_id uuid, p_photo_url text, p_capture_date timestamp without time zone); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.update_biometric_photo(p_user_id uuid, p_photo_url text, p_capture_date timestamp without time zone) IS 'Actualiza la foto biomtrica de un usuario y calcula automticamente la fecha de vencimiento';


--
-- Name: update_biometric_template_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_biometric_template_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_budget_on_accrual(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_budget_on_accrual() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF NEW.transaction_type = 'accrual' THEN
        UPDATE hour_bank_budgets
        SET allocated_hours = allocated_hours + NEW.hours_final,
            updated_at = CURRENT_TIMESTAMP,
            alert_level = CASE
                WHEN (allocated_hours + NEW.hours_final) / budget_hours >= 0.95 THEN 'critical'
                WHEN (allocated_hours + NEW.hours_final) / budget_hours >= 0.80 THEN 'warning'
                ELSE 'normal'
            END
        WHERE company_id = NEW.company_id
          AND status = 'active'
          AND CURRENT_DATE BETWEEN period_start AND period_end;

    ELSIF NEW.transaction_type = 'usage' THEN
        UPDATE hour_bank_budgets
        SET used_hours = used_hours + ABS(NEW.hours_final),
            updated_at = CURRENT_TIMESTAMP
        WHERE company_id = NEW.company_id
          AND status = 'active'
          AND CURRENT_DATE BETWEEN period_start AND period_end;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: update_budgets_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_budgets_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$;


--
-- Name: update_certification_status(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_certification_status() RETURNS TABLE(updated_count integer, expired_count integer, expiring_soon_count integer)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_updated_count INTEGER := 0;
    v_expired_count INTEGER := 0;
    v_expiring_soon_count INTEGER := 0;
BEGIN
    -- Marcar como EXPIRED (vencidas)
    UPDATE oh_employee_certifications
    SET
        status = 'expired',
        last_updated_at = NOW()
    WHERE
        deleted_at IS NULL
        AND status != 'expired'
        AND expiration_date < CURRENT_DATE;

    GET DIAGNOSTICS v_expired_count = ROW_COUNT;

    -- Marcar como EXPIRING_SOON (prximas a vencer)
    UPDATE oh_employee_certifications
    SET
        status = 'expiring_soon',
        last_updated_at = NOW()
    WHERE
        deleted_at IS NULL
        AND status = 'active'
        AND expiration_date >= CURRENT_DATE
        AND (expiration_date - CURRENT_DATE) <= alert_days_before;

    GET DIAGNOSTICS v_expiring_soon_count = ROW_COUNT;

    v_updated_count := v_expired_count + v_expiring_soon_count;

    RETURN QUERY SELECT v_updated_count, v_expired_count, v_expiring_soon_count;
END;
$$;


--
-- Name: update_claim_documents_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_claim_documents_count() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE oh_workers_compensation_claims
        SET documents_count = documents_count + 1
        WHERE id = NEW.claim_id;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE oh_workers_compensation_claims
        SET documents_count = GREATEST(documents_count - 1, 0)
        WHERE id = OLD.claim_id;
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$;


--
-- Name: FUNCTION update_claim_documents_count(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.update_claim_documents_count() IS 'Actualiza contador de documentos en reclamo';


--
-- Name: update_comm_liq_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_comm_liq_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$;


--
-- Name: update_comm_pay_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_comm_pay_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$;


--
-- Name: update_company_comms_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_company_comms_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_consent_definitions_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_consent_definitions_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_contracts_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_contracts_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_daily_ppe_stats(integer, integer, character varying, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_daily_ppe_stats(p_company_id integer, p_branch_id integer, p_zone_name character varying, p_date date) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_total INTEGER;
  v_violations INTEGER;
  v_by_ppe JSONB;
BEGIN
  -- Calcular totales
  SELECT
    COUNT(*),
    COUNT(*) FILTER (WHERE array_length(missing_ppe, 1) > 0)
  INTO v_total, v_violations
  FROM hse_ppe_detections
  WHERE company_id = p_company_id
    AND (branch_id = p_branch_id OR p_branch_id IS NULL)
    AND (zone_name = p_zone_name OR p_zone_name IS NULL)
    AND DATE(detection_timestamp) = p_date;

  -- Calcular por EPP
  SELECT JSONB_OBJECT_AGG(epp, cnt)
  INTO v_by_ppe
  FROM (
    SELECT UNNEST(missing_ppe) as epp, COUNT(*) as cnt
    FROM hse_ppe_detections
    WHERE company_id = p_company_id
      AND (branch_id = p_branch_id OR p_branch_id IS NULL)
      AND (zone_name = p_zone_name OR p_zone_name IS NULL)
      AND DATE(detection_timestamp) = p_date
    GROUP BY UNNEST(missing_ppe)
  ) sub;

  -- Upsert estadsticas
  INSERT INTO hse_ppe_stats (company_id, branch_id, zone_name, stat_date, total_checks, compliant_count, violation_count, compliance_rate, violations_by_ppe)
  VALUES (
    p_company_id,
    p_branch_id,
    p_zone_name,
    p_date,
    v_total,
    v_total - v_violations,
    v_violations,
    CASE WHEN v_total > 0 THEN ROUND(((v_total - v_violations)::DECIMAL / v_total) * 100, 2) ELSE 100 END,
    v_by_ppe
  )
  ON CONFLICT (company_id, branch_id, zone_name, stat_date)
  DO UPDATE SET
    total_checks = EXCLUDED.total_checks,
    compliant_count = EXCLUDED.compliant_count,
    violation_count = EXCLUDED.violation_count,
    compliance_rate = EXCLUDED.compliance_rate,
    violations_by_ppe = EXCLUDED.violations_by_ppe,
    updated_at = NOW();
END;
$$;


--
-- Name: update_document_expiration_status(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_document_expiration_status() RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    updated_count INTEGER;
BEGIN
    -- Actualizar documentos que vencieron
    UPDATE employee_dependency_documents
    SET
        status = 'EXPIRED',
        days_until_expiration = DATE_PART('day', expiration_date - CURRENT_DATE)::INT,
        updated_at = CURRENT_TIMESTAMP
    WHERE expiration_date IS NOT NULL
      AND expiration_date < CURRENT_DATE
      AND status != 'EXPIRED'
      AND is_current = true;

    GET DIAGNOSTICS updated_count = ROW_COUNT;

    -- Actualizar documentos prximos a vencer (30 das)
    UPDATE employee_dependency_documents
    SET
        status = 'EXPIRING_SOON',
        days_until_expiration = DATE_PART('day', expiration_date - CURRENT_DATE)::INT,
        updated_at = CURRENT_TIMESTAMP
    WHERE expiration_date IS NOT NULL
      AND expiration_date >= CURRENT_DATE
      AND expiration_date <= CURRENT_DATE + INTERVAL '30 days'
      AND status NOT IN ('EXPIRED', 'EXPIRING_SOON')
      AND is_current = true;

    -- Actualizar das hasta vencimiento para todos
    UPDATE employee_dependency_documents
    SET days_until_expiration = DATE_PART('day', expiration_date - CURRENT_DATE)::INT
    WHERE expiration_date IS NOT NULL
      AND is_current = true;

    RETURN updated_count;
END;
$$;


--
-- Name: update_email_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_email_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_fiscal_config_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_fiscal_config_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_group_last_activity(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_group_last_activity() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE notification_groups
    SET last_activity_at = NOW()
    WHERE id = NEW.group_id;
    RETURN NEW;
END;
$$;


--
-- Name: update_household_size(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_household_size() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Actualizar el contador en users
    UPDATE users
    SET household_size = (
        SELECT COUNT(*) + 1  -- +1 por el propio empleado
        FROM user_household_members
        WHERE user_id = COALESCE(NEW.user_id, OLD.user_id)
        AND is_cohabitant = TRUE
        AND is_active = TRUE
    ),
    dependents_count = (
        SELECT COUNT(*)
        FROM user_household_members
        WHERE user_id = COALESCE(NEW.user_id, OLD.user_id)
        AND is_dependent = TRUE
        AND is_active = TRUE
    )
    WHERE user_id = COALESCE(NEW.user_id, OLD.user_id);

    RETURN NEW;
END;
$$;


--
-- Name: update_imap_poll_status(uuid, integer, text); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_imap_poll_status(p_config_id uuid, p_last_uid integer, p_error text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE company_email_config
    SET
        imap_last_poll = CURRENT_TIMESTAMP,
        imap_last_uid = COALESCE(p_last_uid, imap_last_uid),
        last_error = p_error,
        error_count = CASE WHEN p_error IS NOT NULL THEN error_count + 1 ELSE 0 END,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = p_config_id;
END;
$$;


--
-- Name: update_job_posting_applications_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_job_posting_applications_count() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE job_postings
        SET applications_count = applications_count + 1,
            updated_at = NOW()
        WHERE id = NEW.job_posting_id;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE job_postings
        SET applications_count = applications_count - 1,
            updated_at = NOW()
        WHERE id = OLD.job_posting_id;
    END IF;
    RETURN NULL;
END;
$$;


--
-- Name: update_kiosks_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_kiosks_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;

    -- Auto-marcar como configurado si tiene nombre y GPS
    IF NEW.name IS NOT NULL AND NEW.gps_lat IS NOT NULL AND NEW.gps_lng IS NOT NULL THEN
        NEW.is_configured = true;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: update_legal_auth_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_legal_auth_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_legal_cases_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_legal_cases_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_legal_communications_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_legal_communications_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_medical_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_medical_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_medical_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_medical_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_notification_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_notification_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_partner_commission_summary(uuid, integer, integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_partner_commission_summary(p_partner_id uuid, p_year integer, p_month integer) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO partner_commission_summaries (
        partner_id, year, month,
        total_cases, total_billable, total_commission, total_net,
        pending_amount, invoiced_amount, paid_amount
    )
    SELECT
        p_partner_id,
        p_year,
        p_month,
        COUNT(*)::INTEGER,
        COALESCE(SUM(billable_amount), 0),
        COALESCE(SUM(commission_amount), 0),
        COALESCE(SUM(net_amount), 0),
        COALESCE(SUM(CASE WHEN status = 'pending' THEN commission_amount ELSE 0 END), 0),
        COALESCE(SUM(CASE WHEN status = 'invoiced' THEN commission_amount ELSE 0 END), 0),
        COALESCE(SUM(CASE WHEN status = 'paid' THEN commission_amount ELSE 0 END), 0)
    FROM partner_commission_transactions
    WHERE partner_id = p_partner_id
      AND EXTRACT(YEAR FROM transaction_date) = p_year
      AND EXTRACT(MONTH FROM transaction_date) = p_month
      AND status != 'cancelled'
    ON CONFLICT (partner_id, year, month)
    DO UPDATE SET
        total_cases = EXCLUDED.total_cases,
        total_billable = EXCLUDED.total_billable,
        total_commission = EXCLUDED.total_commission,
        total_net = EXCLUDED.total_net,
        pending_amount = EXCLUDED.pending_amount,
        invoiced_amount = EXCLUDED.invoiced_amount,
        paid_amount = EXCLUDED.paid_amount,
        updated_at = NOW();
END;
$$;


--
-- Name: update_partners_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_partners_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_payslip_template_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_payslip_template_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_procedure_hierarchy_path(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_procedure_hierarchy_path() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Agregar el propio ID al path
    UPDATE procedures
    SET hierarchy_path = COALESCE(hierarchy_path, '') || '/' || NEW.id::TEXT
    WHERE id = NEW.id;

    RETURN NEW;
END;
$$;


--
-- Name: update_response_confidence(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_response_confidence() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.confidence_score := calculate_response_confidence(
        NEW.times_suggested,
        NEW.times_accepted,
        NEW.times_rejected,
        NEW.is_verified
    );
    NEW.updated_at := NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_sanction_types_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_sanction_types_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_screening_documents_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_screening_documents_count() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN
        UPDATE oh_pre_employment_screenings
        SET
            documents_count = (
                SELECT COUNT(*)
                FROM oh_screening_documents
                WHERE screening_id = NEW.screening_id
                  AND deleted_at IS NULL
            ),
            has_documents = true,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = NEW.screening_id;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE oh_pre_employment_screenings
        SET
            documents_count = (
                SELECT COUNT(*)
                FROM oh_screening_documents
                WHERE screening_id = OLD.screening_id
                  AND deleted_at IS NULL
            ),
            has_documents = (
                SELECT COUNT(*) > 0
                FROM oh_screening_documents
                WHERE screening_id = OLD.screening_id
                  AND deleted_at IS NULL
            ),
            updated_at = CURRENT_TIMESTAMP
        WHERE id = OLD.screening_id;
    END IF;

    RETURN COALESCE(NEW, OLD);
END;
$$;


--
-- Name: update_sesiones_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_sesiones_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_siac_presupuestos_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_siac_presupuestos_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_staff_companies_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_staff_companies_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


--
-- Name: update_suspension_blocks_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_suspension_blocks_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_tax_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_tax_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_test_executions_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_test_executions_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();

    -- Calcular duracin si end_time se est seteando
    IF NEW.end_time IS NOT NULL AND OLD.end_time IS NULL THEN
        NEW.duration_seconds = EXTRACT(EPOCH FROM (NEW.end_time - NEW.start_time));
    END IF;

    -- Calcular success rate automticamente
    IF NEW.total_tests > 0 THEN
        NEW.success_rate = ROUND(
            ((NEW.ui_tests_passed + NEW.db_tests_passed)::DECIMAL / NEW.total_tests::DECIMAL) * 100,
            2
        );
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: update_testing_tickets_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_testing_tickets_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();

  -- Calcular mtricas si el ticket se cierra
  IF NEW.status = 'CLOSED' AND OLD.status != 'CLOSED' THEN
    NEW.closed_at = NOW();
    NEW.time_to_close_minutes = EXTRACT(EPOCH FROM (NOW() - NEW.created_at)) / 60;

    -- Si ya se aplic fix, calcular tiempo de fix
    IF NEW.fix_applied_at IS NOT NULL THEN
      NEW.time_to_fix_minutes = EXTRACT(EPOCH FROM (NEW.fix_applied_at - NEW.created_at)) / 60;
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: update_thread_counters(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_thread_counters() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE notification_threads
        SET message_count = message_count + 1,
            last_message_at = NOW(),
            unread_count = unread_count + 1
        WHERE id = NEW.thread_id;
    ELSIF TG_OP = 'UPDATE' AND OLD.is_read = FALSE AND NEW.is_read = TRUE THEN
        UPDATE notification_threads
        SET unread_count = GREATEST(unread_count - 1, 0)
        WHERE id = NEW.thread_id;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: update_thread_unread_count(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_thread_unread_count() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF TG_OP = 'UPDATE' AND OLD.is_read = FALSE AND NEW.is_read = TRUE THEN
        UPDATE notification_threads
        SET unread_count = GREATEST(0, unread_count - 1),
            updated_at = NOW()
        WHERE id = NEW.thread_id;
    ELSIF TG_OP = 'INSERT' AND NEW.is_read = FALSE THEN
        UPDATE notification_threads
        SET unread_count = unread_count + 1,
            updated_at = NOW()
        WHERE id = NEW.thread_id;
    END IF;
    RETURN NEW;
END;
$$;


--
-- Name: update_updated_at(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_user_biometric_stats(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_biometric_stats() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Actualizar estadsticas del usuario cuando se inserta un nuevo scan
    IF TG_OP = 'INSERT' THEN
        UPDATE users SET
            last_biometric_scan = NEW.server_timestamp,
            biometric_enrolled = true
        WHERE id = NEW.user_id;

        -- Actualizar contador de templates si es un scan de registro
        IF NEW.scan_type = 'registration' THEN
            UPDATE users SET
                biometric_templates_count = biometric_templates_count + 1
            WHERE id = NEW.user_id;
        END IF;
    END IF;

    RETURN COALESCE(NEW, OLD);
END;
$$;


--
-- Name: update_user_consents_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_user_consents_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$;


--
-- Name: update_vacation_timestamp(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_vacation_timestamp() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;


--
-- Name: update_vendor_statistics_on_company_change(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_vendor_statistics_on_company_change() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Recalcular estadsticas del vendedor de venta
    IF NEW.assigned_vendor_id IS NOT NULL THEN
        PERFORM refresh_vendor_statistics(NEW.assigned_vendor_id);
    END IF;

    -- Recalcular estadsticas del vendedor de soporte
    IF NEW.support_vendor_id IS NOT NULL THEN
        PERFORM refresh_vendor_statistics(NEW.support_vendor_id);
    END IF;

    -- Si cambi el vendedor, recalcular para el vendedor anterior tambin
    IF TG_OP = 'UPDATE' THEN
        IF OLD.assigned_vendor_id IS NOT NULL AND OLD.assigned_vendor_id != NEW.assigned_vendor_id THEN
            PERFORM refresh_vendor_statistics(OLD.assigned_vendor_id);
        END IF;
        IF OLD.support_vendor_id IS NOT NULL AND OLD.support_vendor_id != NEW.support_vendor_id THEN
            PERFORM refresh_vendor_statistics(OLD.support_vendor_id);
        END IF;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: upsert_module(character varying, character varying, text, character varying, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.upsert_module(p_module_key character varying, p_name character varying, p_description text, p_icon character varying, p_category character varying) RETURNS void
    LANGUAGE plpgsql
    AS $$
            BEGIN
                INSERT INTO system_modules (id, module_key, name, description, icon, category, is_active, created_at, updated_at)
                VALUES (
                    gen_random_uuid(),
                    p_module_key,
                    p_name,
                    p_description,
                    p_icon,
                    p_category::enum_system_modules_category,
                    true,
                    NOW(),
                    NOW()
                )
                ON CONFLICT (module_key) DO UPDATE SET
                    name = EXCLUDED.name,
                    icon = EXCLUDED.icon,
                    description = EXCLUDED.description,
                    category = EXCLUDED.category,
                    updated_at = NOW();
            END;
            $$;


--
-- Name: user_needs_photo_renewal(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.user_needs_photo_renewal(p_user_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_expiration TIMESTAMP;
    v_needs_renewal BOOLEAN;
BEGIN
    SELECT biometric_photo_expiration
    INTO v_expiration
    FROM users
    WHERE user_id = p_user_id;

    -- Si no tiene foto o ya venci, necesita renovacin
    IF v_expiration IS NULL OR v_expiration < NOW() THEN
        v_needs_renewal := true;
    -- Si est dentro de los 30 das previos al vencimiento
    ELSIF v_expiration <= (NOW() + INTERVAL '30 days') THEN
        v_needs_renewal := true;
    ELSE
        v_needs_renewal := false;
    END IF;

    RETURN v_needs_renewal;
END;
$$;


--
-- Name: FUNCTION user_needs_photo_renewal(p_user_id uuid); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.user_needs_photo_renewal(p_user_id uuid) IS 'Determina si un usuario necesita renovar su foto biomtrica (sin foto, vencida, o dentro de 30 das del vencimiento)';


--
-- Name: validate_benefit_documents(integer); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_benefit_documents(p_employee_benefit_id integer) RETURNS TABLE(all_valid boolean, missing_documents integer, expired_documents integer, pending_verification integer, details jsonb)
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_benefit RECORD;
  v_missing INTEGER := 0;
  v_expired INTEGER := 0;
  v_pending INTEGER := 0;
  v_details JSONB := '[]'::jsonb;
  v_req RECORD;
BEGIN
  -- Obtener el beneficio
  SELECT * INTO v_benefit
  FROM employee_benefits
  WHERE id = p_employee_benefit_id;

  IF NOT FOUND THEN
    RETURN QUERY SELECT false, 0, 0, 0, '[]'::jsonb;
    RETURN;
  END IF;

  -- Iterar sobre requisitos obligatorios
  FOR v_req IN
    SELECT bdr.*, dt.code as doc_type_code, dt.name as doc_type_name
    FROM benefit_document_requirements bdr
    JOIN company_benefit_policies cbp ON bdr.benefit_type_id = cbp.benefit_type_id
    JOIN document_types dt ON bdr.document_type_id = dt.id
    WHERE cbp.id = v_benefit.company_benefit_policy_id
      AND bdr.is_mandatory = true
      AND bdr.is_active = true
  LOOP
    -- Buscar documento actual del empleado
    DECLARE
      v_doc RECORD;
    BEGIN
      SELECT * INTO v_doc
      FROM employee_benefit_documents
      WHERE employee_benefit_id = p_employee_benefit_id
        AND requirement_id = v_req.id
        AND is_current = true
      ORDER BY created_at DESC
      LIMIT 1;

      IF NOT FOUND THEN
        -- Documento faltante
        v_missing := v_missing + 1;
        v_details := v_details || jsonb_build_object(
          'type', 'missing',
          'requirement_id', v_req.id,
          'document_type', v_req.doc_type_code,
          'document_name', v_req.doc_type_name
        );
      ELSIF v_doc.expiration_date IS NOT NULL AND v_doc.expiration_date < CURRENT_DATE THEN
        -- Documento vencido
        v_expired := v_expired + 1;
        v_details := v_details || jsonb_build_object(
          'type', 'expired',
          'requirement_id', v_req.id,
          'document_type', v_req.doc_type_code,
          'document_name', v_req.doc_type_name,
          'expiration_date', v_doc.expiration_date
        );
      ELSIF v_doc.verification_status = 'pending' THEN
        -- Documento pendiente de verificacin
        v_pending := v_pending + 1;
        v_details := v_details || jsonb_build_object(
          'type', 'pending_verification',
          'requirement_id', v_req.id,
          'document_type', v_req.doc_type_code,
          'document_name', v_req.doc_type_name
        );
      END IF;
    END;
  END LOOP;

  -- Retornar resultado
  RETURN QUERY SELECT
    (v_missing = 0 AND v_expired = 0)::BOOLEAN,
    v_missing,
    v_expired,
    v_pending,
    v_details;
END;
$$;


--
-- Name: FUNCTION validate_benefit_documents(p_employee_benefit_id integer); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_benefit_documents(p_employee_benefit_id integer) IS 'Valida que todos los documentos obligatorios de un beneficio estn presentes y vigentes';


--
-- Name: validate_cbu_checksum(character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_cbu_checksum(p_cbu character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $_$
DECLARE
  v_bank_code VARCHAR(8);
  v_account_code VARCHAR(14);
  v_bank_verifier INTEGER;
  v_account_verifier INTEGER;
  v_calc_bank_verifier INTEGER;
  v_calc_account_verifier INTEGER;
  v_weights INTEGER[] := ARRAY[3, 1, 7, 9];
  v_sum INTEGER;
  v_i INTEGER;
BEGIN
  -- Validar longitud
  IF LENGTH(p_cbu) != 22 THEN
    RETURN FALSE;
  END IF;

  -- Validar que sea numrico
  IF p_cbu !~ '^[0-9]{22}$' THEN
    RETURN FALSE;
  END IF;

  -- Extraer partes
  v_bank_code := SUBSTRING(p_cbu FROM 1 FOR 7);
  v_bank_verifier := CAST(SUBSTRING(p_cbu FROM 8 FOR 1) AS INTEGER);
  v_account_code := SUBSTRING(p_cbu FROM 9 FOR 13);
  v_account_verifier := CAST(SUBSTRING(p_cbu FROM 22 FOR 1) AS INTEGER);

  -- Calcular dgito verificador del banco (primeros 7 dgitos)
  v_sum := 0;
  FOR v_i IN 1..7 LOOP
    v_sum := v_sum + (CAST(SUBSTRING(v_bank_code FROM v_i FOR 1) AS INTEGER) * v_weights[((v_i - 1) % 4) + 1]);
  END LOOP;
  v_calc_bank_verifier := (10 - (v_sum % 10)) % 10;

  -- Calcular dgito verificador de la cuenta (13 dgitos)
  v_sum := 0;
  FOR v_i IN 1..13 LOOP
    v_sum := v_sum + (CAST(SUBSTRING(v_account_code FROM v_i FOR 1) AS INTEGER) * v_weights[((v_i - 1) % 4) + 1]);
  END LOOP;
  v_calc_account_verifier := (10 - (v_sum % 10)) % 10;

  -- Validar ambos dgitos verificadores
  RETURN (v_calc_bank_verifier = v_bank_verifier) AND (v_calc_account_verifier = v_account_verifier);
END;
$_$;


--
-- Name: validate_contract_for_activation(uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_contract_for_activation(p_contract_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  contract_record RECORD;
BEGIN
  SELECT * INTO contract_record FROM contracts WHERE id = p_contract_id;

  -- Validaciones
  IF contract_record.status != 'SIGNED' THEN
    RAISE EXCEPTION 'Contract must be SIGNED before activation';
  END IF;

  IF contract_record.signed_at IS NULL THEN
    RAISE EXCEPTION 'Contract must have signature timestamp';
  END IF;

  IF contract_record.signature_hash IS NULL THEN
    RAISE EXCEPTION 'Contract must have signature hash';
  END IF;

  RETURN TRUE;
END;
$$;


--
-- Name: validate_email_config(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_email_config() RETURNS trigger
    LANGUAGE plpgsql
    AS $_$
BEGIN
    -- Validar que todos los campos SMTP estn completos
    IF NEW.smtp_host IS NULL OR NEW.smtp_host = '' THEN
        RAISE EXCEPTION 'SMTP Host es obligatorio para configurar el email institucional';
    END IF;

    IF NEW.smtp_port IS NULL THEN
        RAISE EXCEPTION 'SMTP Port es obligatorio';
    END IF;

    IF NEW.smtp_user IS NULL OR NEW.smtp_user = '' THEN
        RAISE EXCEPTION 'SMTP User es obligatorio';
    END IF;

    IF NEW.smtp_password IS NULL OR NEW.smtp_password = '' THEN
        RAISE EXCEPTION 'SMTP Password es obligatoria';
    END IF;

    IF NEW.institutional_email IS NULL OR NEW.institutional_email = '' THEN
        RAISE EXCEPTION 'Email institucional es obligatorio';
    END IF;

    -- Validar formato de email
    IF NEW.institutional_email !~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$' THEN
        RAISE EXCEPTION 'Formato de email institucional invlido';
    END IF;

    RETURN NEW;
END;
$_$;


--
-- Name: validate_module_dependencies(uuid, character varying); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_module_dependencies(p_company_id uuid, p_module_key character varying) RETURNS jsonb
    LANGUAGE plpgsql
    AS $$
      DECLARE
        v_module system_modules%ROWTYPE;
        v_active_modules TEXT[];
        v_missing_required TEXT[];
      BEGIN
        SELECT * INTO v_module FROM system_modules WHERE module_key = p_module_key;

        IF NOT FOUND THEN
          RETURN jsonb_build_object('valid', false, 'error', 'Module not found');
        END IF;

        SELECT ARRAY_AGG(sm.module_key) INTO v_active_modules
        FROM company_modules cm
        JOIN system_modules sm ON cm.system_module_id = sm.id
        WHERE cm.company_id = p_company_id AND cm.is_active = true;

        SELECT ARRAY_AGG(req) INTO v_missing_required
        FROM jsonb_array_elements_text(v_module.requirements) req
        WHERE req != ALL(COALESCE(v_active_modules, ARRAY[]::TEXT[]));

        RETURN jsonb_build_object(
          'valid', COALESCE(array_length(v_missing_required, 1), 0) = 0,
          'module_key', p_module_key,
          'missing_required', COALESCE(v_missing_required, ARRAY[]::TEXT[]),
          'bundled_modules', v_module.bundled_modules
        );
      END;
      $$;


--
-- Name: validate_modules_trial_structure(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_modules_trial_structure() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  -- Validar que modules_trial sea un array
  IF NEW.modules_trial IS NOT NULL THEN
    IF jsonb_typeof(NEW.modules_trial) != 'array' THEN
      RAISE EXCEPTION 'modules_trial must be a JSON array';
    END IF;

    -- Validar estructura de cada elemento
    -- Cada elemento debe tener: module_key, trial_start, trial_end, status
    IF EXISTS (
      SELECT 1
      FROM jsonb_array_elements(NEW.modules_trial) AS elem
      WHERE NOT (
        elem ? 'module_key' AND
        elem ? 'trial_start' AND
        elem ? 'trial_end' AND
        elem ? 'status'
      )
    ) THEN
      RAISE EXCEPTION 'Each module in modules_trial must have: module_key, trial_start, trial_end, status';
    END IF;
  END IF;

  RETURN NEW;
END;
$$;


--
-- Name: validate_notification_recipient(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_notification_recipient() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Las notificaciones tipo 'broadcast' o 'system' pueden no tener recipient
    IF NEW.notification_type NOT IN ('broadcast', 'system_alert', 'company_announcement') THEN
        IF NEW.recipient_user_id IS NULL THEN
            RAISE EXCEPTION 'Las notificaciones de tipo % requieren un recipient_user_id vlido', NEW.notification_type;
        END IF;

        -- Verificar que el usuario existe y est activo
        IF NOT EXISTS (
            SELECT 1 FROM users
            WHERE user_id = NEW.recipient_user_id
            AND "isActive" = true
        ) THEN
            RAISE EXCEPTION 'El recipient_user_id % no existe o est inactivo', NEW.recipient_user_id;
        END IF;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION validate_notification_recipient(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_notification_recipient() IS 'Trigger que valida que notificaciones no-broadcast tengan recipient vlido';


--
-- Name: validate_procedure_hierarchy(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_procedure_hierarchy() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_parent_type VARCHAR(20);
    v_parent_level INTEGER;
    v_parent_company INTEGER;
    v_expected_parent_level INTEGER;
    v_new_level INTEGER;
BEGIN
    -- Determinar nivel segn tipo
    v_new_level := CASE NEW.type
        WHEN 'politica' THEN 1
        WHEN 'manual' THEN 2
        WHEN 'procedimiento' THEN 3
        WHEN 'instructivo' THEN 4
        ELSE 4
    END;

    -- Sincronizar hierarchy_level con type
    NEW.hierarchy_level := v_new_level;

    -- REGLA 1: Solo las POLTICAS pueden no tener padre
    IF v_new_level > 1 AND NEW.parent_id IS NULL THEN
        RAISE EXCEPTION 'Los documentos de tipo "%" DEBEN tener un documento padre. Solo las polticas pueden existir sin padre.', NEW.type
            USING HINT = 'Seleccione un documento padre del nivel superior.',
                  ERRCODE = 'check_violation';
    END IF;

    -- REGLA 2: Las POLTICAS NO pueden tener padre
    IF v_new_level = 1 AND NEW.parent_id IS NOT NULL THEN
        RAISE EXCEPTION 'Las polticas son el nivel raz y NO pueden tener documento padre.'
            USING HINT = 'Elimine la referencia al documento padre.',
                  ERRCODE = 'check_violation';
    END IF;

    -- Si tiene padre, validar jerarqua
    IF NEW.parent_id IS NOT NULL THEN
        -- Obtener info del padre
        SELECT type, hierarchy_level, company_id
        INTO v_parent_type, v_parent_level, v_parent_company
        FROM procedures
        WHERE id = NEW.parent_id;

        IF NOT FOUND THEN
            RAISE EXCEPTION 'El documento padre con ID "%" no existe.', NEW.parent_id
                USING ERRCODE = 'foreign_key_violation';
        END IF;

        -- REGLA 3: El padre debe ser del nivel inmediatamente superior
        v_expected_parent_level := v_new_level - 1;
        IF v_parent_level != v_expected_parent_level THEN
            RAISE EXCEPTION 'Jerarqua invlida: Un "%" (nivel %) debe pertenecer a un documento de nivel % (%), pero el padre seleccionado es nivel %.',
                NEW.type, v_new_level, v_expected_parent_level,
                CASE v_expected_parent_level
                    WHEN 1 THEN 'poltica'
                    WHEN 2 THEN 'manual'
                    WHEN 3 THEN 'procedimiento'
                    ELSE 'desconocido'
                END,
                v_parent_level
                USING HINT = format('Seleccione un documento de tipo "%s" como padre.',
                    CASE v_expected_parent_level
                        WHEN 1 THEN 'poltica'
                        WHEN 2 THEN 'manual'
                        WHEN 3 THEN 'procedimiento'
                        ELSE 'desconocido'
                    END),
                    ERRCODE = 'check_violation';
        END IF;

        -- REGLA 4: Padre debe ser de la misma empresa
        IF v_parent_company != NEW.company_id THEN
            RAISE EXCEPTION 'El documento padre debe pertenecer a la misma empresa.'
                USING ERRCODE = 'check_violation';
        END IF;

        -- Construir hierarchy_path
        SELECT COALESCE(hierarchy_path, '') || '/' || NEW.parent_id::TEXT
        INTO NEW.hierarchy_path
        FROM procedures
        WHERE id = NEW.parent_id;
    ELSE
        -- Es una poltica (raz)
        NEW.hierarchy_path := '';
    END IF;

    -- Agregar el ID propio al path (se har en otro trigger despus del INSERT)

    RETURN NEW;
END;
$$;


--
-- Name: validate_redemption_request(integer, uuid, numeric, date); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_redemption_request(p_company_id integer, p_user_id uuid, p_hours_requested numeric, p_scheduled_date date) RETURNS TABLE(is_valid boolean, error_code character varying, error_message text, current_balance numeric, available_for_redemption numeric, pending_requests numeric, max_per_event numeric, is_loan boolean, loan_amount numeric, total_debt_after numeric)
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_template RECORD;
    v_balance DECIMAL;
    v_pending DECIMAL;
    v_available DECIMAL;
    v_is_loan BOOLEAN := false;
    v_loan_amount DECIMAL := 0;
    v_current_debt DECIMAL := 0;
    v_total_debt DECIMAL := 0;
BEGIN
    -- Obtener plantilla aplicable
    SELECT * INTO v_template
    FROM hour_bank_templates
    WHERE company_id = p_company_id
    AND is_enabled = true
    ORDER BY branch_id NULLS LAST
    LIMIT 1;

    IF v_template IS NULL THEN
        RETURN QUERY SELECT
            false, 'NO_TEMPLATE'::VARCHAR,
            'No hay plantilla de banco de horas configurada'::TEXT,
            0::DECIMAL, 0::DECIMAL, 0::DECIMAL, 8::DECIMAL,
            false, 0::DECIMAL, 0::DECIMAL;
        RETURN;
    END IF;

    -- Obtener balance actual (puede ser negativo si hay prstamos)
    SELECT COALESCE(SUM(
        CASE WHEN transaction_type = 'accrual' THEN hours_final
             WHEN transaction_type IN ('usage', 'redemption') THEN -hours_final
             ELSE 0
        END
    ), 0) INTO v_balance
    FROM hour_bank_transactions
    WHERE company_id = p_company_id AND user_id = p_user_id
    AND status = 'completed';

    -- Obtener solicitudes pendientes
    SELECT COALESCE(SUM(hours_requested), 0) INTO v_pending
    FROM hour_bank_redemption_requests
    WHERE company_id = p_company_id
    AND user_id = p_user_id
    AND status IN ('pending_supervisor', 'approved_supervisor', 'approved');

    -- Calcular disponible (balance - pendientes)
    v_available := v_balance - v_pending;

    -- Validar fecha futura
    IF p_scheduled_date <= CURRENT_DATE THEN
        RETURN QUERY SELECT
            false, 'INVALID_DATE'::VARCHAR,
            'La fecha debe ser futura'::TEXT,
            v_balance, v_available, v_pending,
            COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
            false, 0::DECIMAL, 0::DECIMAL;
        RETURN;
    END IF;

    -- Para validacin (p_hours_requested = 0), retornar info
    IF p_hours_requested = 0 THEN
        RETURN QUERY SELECT
            true, NULL::VARCHAR, NULL::TEXT,
            v_balance, v_available, v_pending,
            COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
            false, 0::DECIMAL, v_balance;
        RETURN;
    END IF;

    -- Validar mximo por evento
    IF p_hours_requested > COALESCE(v_template.max_hours_per_redemption, 8) THEN
        RETURN QUERY SELECT
            false, 'EXCEEDS_MAX_PER_EVENT'::VARCHAR,
            format('Mximo %s horas por solicitud', v_template.max_hours_per_redemption)::TEXT,
            v_balance, v_available, v_pending,
            COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
            false, 0::DECIMAL, 0::DECIMAL;
        RETURN;
    END IF;

    -- Verificar si es prstamo (solicita ms de lo disponible)
    IF p_hours_requested > v_available THEN
        -- Estn habilitados los prstamos?
        IF NOT COALESCE(v_template.allow_hour_loans, false) THEN
            RETURN QUERY SELECT
                false, 'INSUFFICIENT_BALANCE'::VARCHAR,
                format('Saldo insuficiente. Disponible: %s horas', v_available)::TEXT,
                v_balance, v_available, v_pending,
                COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
                false, 0::DECIMAL, 0::DECIMAL;
            RETURN;
        END IF;

        -- Calcular prstamo necesario
        v_loan_amount := p_hours_requested - GREATEST(v_available, 0);
        v_is_loan := true;

        -- Verificar lmite de prstamo por evento
        IF v_loan_amount > COALESCE(v_template.max_loan_hours, 8) THEN
            RETURN QUERY SELECT
                false, 'EXCEEDS_LOAN_LIMIT'::VARCHAR,
                format('Prstamo mximo: %s horas. Solicitando: %s',
                    v_template.max_loan_hours, v_loan_amount)::TEXT,
                v_balance, v_available, v_pending,
                COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
                true, v_loan_amount, 0::DECIMAL;
            RETURN;
        END IF;

        -- Calcular deuda total despus del prstamo
        v_current_debt := CASE WHEN v_balance < 0 THEN ABS(v_balance) ELSE 0 END;
        v_total_debt := v_current_debt + v_loan_amount + v_pending;

        -- Verificar lmite de saldo negativo total
        IF (v_balance - p_hours_requested) < COALESCE(v_template.max_negative_balance, -16) THEN
            RETURN QUERY SELECT
                false, 'EXCEEDS_NEGATIVE_LIMIT'::VARCHAR,
                format('Lmite de deuda alcanzado. Mximo: %s horas. Deuda actual: %s',
                    ABS(v_template.max_negative_balance), v_current_debt)::TEXT,
                v_balance, v_available, v_pending,
                COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
                true, v_loan_amount, v_total_debt;
            RETURN;
        END IF;

        -- Prstamo vlido
        RETURN QUERY SELECT
            true, 'LOAN_APPROVED'::VARCHAR,
            format('Prstamo de %s horas aprobado. Deuda total: %s', v_loan_amount, v_total_debt)::TEXT,
            v_balance, v_available, v_pending,
            COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
            true, v_loan_amount, v_total_debt;
        RETURN;
    END IF;

    -- Canje normal (sin prstamo)
    RETURN QUERY SELECT
        true, NULL::VARCHAR, NULL::TEXT,
        v_balance, v_available, v_pending,
        COALESCE(v_template.max_hours_per_redemption, 8)::DECIMAL,
        false, 0::DECIMAL, CASE WHEN v_balance < 0 THEN ABS(v_balance) ELSE 0 END;
END;
$$;


--
-- Name: validate_vacation_balance(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.validate_vacation_balance() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    available_days INTEGER;
    used_days INTEGER;
    annual_days INTEGER := 14; -- Default 14 das
BEGIN
    -- Obtener das usados este ao
    SELECT COALESCE(SUM(total_days), 0) INTO used_days
    FROM vacation_requests
    WHERE user_id = NEW.user_id
    AND EXTRACT(YEAR FROM start_date) = EXTRACT(YEAR FROM NEW.start_date)
    AND status IN ('approved', 'pending')
    AND id != COALESCE(NEW.id, -1);

    -- Calcular disponibles
    available_days := annual_days - used_days;

    -- Validar
    IF NEW.total_days > available_days AND NEW.status IN ('pending', 'approved') THEN
        RAISE EXCEPTION 'Solicitud de % das excede el balance disponible de % das',
            NEW.total_days, available_days;
    END IF;

    RETURN NEW;
END;
$$;


--
-- Name: FUNCTION validate_vacation_balance(); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.validate_vacation_balance() IS 'Trigger que valida que solicitudes de vacaciones no excedan balance disponible';


--
-- Name: verify_staff_bank_data(uuid, uuid); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.verify_staff_bank_data(p_staff_id uuid, p_verified_by uuid) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
DECLARE
  v_cbu VARCHAR;
BEGIN
  -- Obtener CBU
  SELECT cbu INTO v_cbu
  FROM aponnt_staff
  WHERE id = p_staff_id;

  -- Si tiene CBU, validar checksum
  IF v_cbu IS NOT NULL THEN
    IF NOT validate_cbu_checksum(v_cbu) THEN
      RAISE EXCEPTION 'Invalid CBU checksum for staff %', p_staff_id;
    END IF;
  END IF;

  -- Marcar como verificado
  UPDATE aponnt_staff
  SET
    bank_data_verified = TRUE,
    bank_data_verified_at = CURRENT_TIMESTAMP,
    bank_data_verified_by = p_verified_by
  WHERE id = p_staff_id;

  RETURN TRUE;
END;
$$;


--
-- Name: verify_user_email(integer, character varying, timestamp without time zone); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.verify_user_email(p_user_id integer, p_user_type character varying, p_verification_timestamp timestamp without time zone DEFAULT now()) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    IF p_user_type = 'employee' THEN
        UPDATE users
        SET email_verified = TRUE,
            email_verified_at = p_verification_timestamp
        WHERE user_id = p_user_id;
    ELSE
        UPDATE partners
        SET email_verified = TRUE,
            email_verified_at = p_verification_timestamp
        WHERE id = p_user_id;
    END IF;

    RETURN FOUND;
END;
$$;


--
-- Name: FUNCTION verify_user_email(p_user_id integer, p_user_type character varying, p_verification_timestamp timestamp without time zone); Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON FUNCTION public.verify_user_email(p_user_id integer, p_user_type character varying, p_verification_timestamp timestamp without time zone) IS 'Marca el email de un usuario como verificado';


SET default_tablespace = '';

--
-- Name: biometric_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_alerts (
    alert_id bigint NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
)
PARTITION BY HASH (company_id);


--
-- Name: biometric_alerts_alert_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_alerts_alert_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_alerts_alert_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_alerts_alert_id_seq OWNED BY public.biometric_alerts.alert_id;


SET default_table_access_method = heap;

--
-- Name: biometric_alerts_p0; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p0 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p1; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p1 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p10; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p10 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p11; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p11 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p12; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p12 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p13; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p13 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p14; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p14 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p15; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p15 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p2; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p2 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p3; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p3 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p4; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p4 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p5; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p5 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p6; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p6 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p7; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p7 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p8; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p8 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_alerts_p9; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_alerts_p9 (
    alert_id bigint DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_id bigint NOT NULL,
    alert_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    message text NOT NULL,
    recommendations jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    acknowledged_by character varying(100),
    acknowledged_at timestamp with time zone,
    resolved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT biometric_alerts_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying])::text[])))
);


--
-- Name: biometric_scans; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_scans (
    scan_id bigint NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
)
PARTITION BY HASH (company_id);


--
-- Name: biometric_scans_scan_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_scans_scan_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_scans_scan_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_scans_scan_id_seq OWNED BY public.biometric_scans.scan_id;


--
-- Name: biometric_scans_p0; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p0 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p1; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p1 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p10; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p10 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p11; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p11 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p12; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p12 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p13; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p13 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p14; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p14 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p15; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p15 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p2; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p2 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p3; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p3 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p4; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p4 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p5; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p5 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p6; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p6 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p7; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p7 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p8; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p8 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_scans_p9; Type: TABLE; Schema: biometric_partitions; Owner: -
--

CREATE TABLE biometric_partitions.biometric_scans_p9 (
    scan_id bigint DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass) NOT NULL,
    tenant_id integer NOT NULL,
    company_id integer NOT NULL,
    user_id bigint NOT NULL,
    scan_data jsonb NOT NULL,
    template_hash character varying(128) NOT NULL,
    template_vector real[] NOT NULL,
    quality_score numeric(5,4) NOT NULL,
    anti_spoofing_score numeric(5,4) NOT NULL,
    ai_analysis jsonb,
    wellness_score integer,
    alert_count integer DEFAULT 0,
    source character varying(50) NOT NULL,
    source_device_id character varying(100),
    processing_time_ms integer,
    processing_id uuid DEFAULT gen_random_uuid(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_scans_anti_spoofing_score_check CHECK (((anti_spoofing_score >= (0)::numeric) AND (anti_spoofing_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_quality_score_check CHECK (((quality_score >= (0)::numeric) AND (quality_score <= (1)::numeric))),
    CONSTRAINT biometric_scans_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: UserShifts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public."UserShifts" (
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    "UserUserId" uuid NOT NULL,
    "ShiftId" uuid NOT NULL
);


--
-- Name: absence_cases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.absence_cases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    absence_type character varying(50) NOT NULL,
    start_date date NOT NULL,
    end_date date,
    requested_days integer NOT NULL,
    approved_days integer,
    assigned_doctor_id uuid,
    assignment_date timestamp without time zone,
    case_status character varying(50) DEFAULT 'pending'::character varying NOT NULL,
    certificate_id integer,
    employee_description text,
    employee_attachments jsonb DEFAULT '[]'::jsonb,
    medical_conclusion text,
    final_diagnosis text,
    is_justified boolean,
    justification_reason text,
    doctor_response_date timestamp without time zone,
    case_closed_date timestamp without time zone,
    closed_by uuid,
    notify_art boolean DEFAULT false,
    art_notified boolean DEFAULT false,
    art_notification_date timestamp without time zone,
    art_case_number character varying(100),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid NOT NULL,
    last_modified_by uuid,
    notification_group_id uuid,
    CONSTRAINT absence_cases_absence_type_check CHECK (((absence_type)::text = ANY ((ARRAY['medical_illness'::character varying, 'work_accident'::character varying, 'non_work_accident'::character varying, 'occupational_disease'::character varying, 'maternity'::character varying, 'family_care'::character varying, 'authorized_leave'::character varying, 'unauthorized'::character varying])::text[]))),
    CONSTRAINT absence_cases_case_status_check CHECK (((case_status)::text = ANY ((ARRAY['pending'::character varying, 'under_review'::character varying, 'awaiting_docs'::character varying, 'needs_follow_up'::character varying, 'justified'::character varying, 'not_justified'::character varying, 'closed'::character varying])::text[])))
);


--
-- Name: TABLE absence_cases; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.absence_cases IS 'Expedientes de inasistencias/ausencias con seguimiento mdico';


--
-- Name: COLUMN absence_cases.absence_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.absence_cases.absence_type IS 'Tipo de ausencia (mdica, accidente laboral, etc.)';


--
-- Name: COLUMN absence_cases.case_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.absence_cases.case_status IS 'Estado del expediente mdico';


--
-- Name: access_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.access_audit_log (
    id bigint NOT NULL,
    user_id uuid,
    company_id integer,
    action character varying(50) NOT NULL,
    module_key character varying(100),
    requested_action character varying(20),
    was_allowed boolean NOT NULL,
    denial_reason text,
    resource_type character varying(50),
    resource_id character varying(100),
    ip_address inet,
    user_agent text,
    request_path text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: access_audit_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.access_audit_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: access_audit_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.access_audit_log_id_seq OWNED BY public.access_audit_log.id;


--
-- Name: access_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.access_notifications (
    id integer NOT NULL,
    notification_type character varying(50) NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying NOT NULL,
    recipient_user_id uuid,
    title character varying(255) NOT NULL,
    message text NOT NULL,
    related_visitor_id integer,
    related_user_id uuid,
    related_kiosk_id integer,
    related_attendance_id uuid,
    is_read boolean DEFAULT false NOT NULL,
    read_at timestamp with time zone,
    action_taken boolean DEFAULT false NOT NULL,
    action_type character varying(100),
    action_notes text,
    action_taken_by uuid,
    action_taken_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    expires_at timestamp with time zone,
    company_id integer NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT access_notifications_notification_type_check CHECK (((notification_type)::text = ANY ((ARRAY['visitor_arrival'::character varying, 'visitor_checkout'::character varying, 'visitor_authorization'::character varying, 'visitor_outside_facility'::character varying, 'visitor_overstay'::character varying, 'employee_late_arrival'::character varying, 'employee_early_departure'::character varying, 'employee_break_exceeded'::character varying, 'unauthorized_access'::character varying, 'kiosk_offline'::character varying, 'gps_low_battery'::character varying, 'gps_signal_lost'::character varying, 'system_alert'::character varying])::text[]))),
    CONSTRAINT access_notifications_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[])))
);


--
-- Name: access_notifications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.access_notifications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: access_notifications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.access_notifications_id_seq OWNED BY public.access_notifications.id;


--
-- Name: additional_role_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.additional_role_types (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    role_key character varying(50) NOT NULL,
    role_name character varying(100) NOT NULL,
    description text,
    category public.role_category_enum DEFAULT 'otros'::public.role_category_enum NOT NULL,
    icon character varying(10) DEFAULT ''::character varying,
    color character varying(20) DEFAULT '#6c757d'::character varying,
    requires_certification boolean DEFAULT false,
    certification_validity_months integer DEFAULT 12,
    scoring_bonus numeric(3,2) DEFAULT 0.05,
    required_training jsonb DEFAULT '[]'::jsonb,
    responsibilities jsonb DEFAULT '[]'::jsonb,
    company_id integer,
    is_active boolean DEFAULT true,
    created_by uuid,
    "createdAt" timestamp with time zone DEFAULT now(),
    "updatedAt" timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE additional_role_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.additional_role_types IS 'Tipos de roles adicionales para estructura organizacional (delegados, brigadistas, etc.)';


--
-- Name: COLUMN additional_role_types.role_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.additional_role_types.role_key IS 'Identificador nico del tipo de rol (ej: delegado_gremial)';


--
-- Name: COLUMN additional_role_types.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.additional_role_types.category IS 'Categora del rol: seguridad, salud, capacitacion, auditoria, supervision, representacion, otros';


--
-- Name: COLUMN additional_role_types.scoring_bonus; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.additional_role_types.scoring_bonus IS 'Bonus de scoring para gamificacin (ej: 0.05 = 5%)';


--
-- Name: COLUMN additional_role_types.required_training; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.additional_role_types.required_training IS 'Array JSON de capacitaciones requeridas';


--
-- Name: COLUMN additional_role_types.responsibilities; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.additional_role_types.responsibilities IS 'Array JSON de responsabilidades del rol';


--
-- Name: administrative_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.administrative_tasks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trace_id character varying(100),
    task_type character varying(100) NOT NULL,
    task_category character varying(50) DEFAULT 'ONBOARDING'::character varying NOT NULL,
    priority character varying(20) DEFAULT 'NORMAL'::character varying NOT NULL,
    company_id integer,
    related_entity_type character varying(50),
    related_entity_id uuid,
    title character varying(255) NOT NULL,
    description text NOT NULL,
    instructions text,
    context_data jsonb,
    attachments jsonb,
    assigned_to uuid,
    assigned_at timestamp without time zone,
    assigned_by uuid,
    due_date date,
    escalation_date date,
    status character varying(50) DEFAULT 'PENDING'::character varying NOT NULL,
    resolution character varying(50),
    resolution_notes text,
    resolved_by uuid,
    resolved_at timestamp without time zone,
    notification_sent boolean DEFAULT false,
    notification_sent_at timestamp without time zone,
    reminder_count integer DEFAULT 0,
    last_reminder_at timestamp without time zone,
    source character varying(50) DEFAULT 'SYSTEM'::character varying,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT valid_priority CHECK (((priority)::text = ANY ((ARRAY['CRITICAL'::character varying, 'HIGH'::character varying, 'NORMAL'::character varying, 'LOW'::character varying])::text[]))),
    CONSTRAINT valid_resolution CHECK ((((resolution IS NULL) AND (resolved_at IS NULL)) OR (((resolution)::text = ANY ((ARRAY['APPROVED'::character varying, 'REJECTED'::character varying, 'CANCELLED'::character varying, 'INFO_PROVIDED'::character varying])::text[])) AND (resolved_at IS NOT NULL)))),
    CONSTRAINT valid_task_status CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'ASSIGNED'::character varying, 'IN_PROGRESS'::character varying, 'WAITING_INFO'::character varying, 'APPROVED'::character varying, 'REJECTED'::character varying, 'CANCELLED'::character varying, 'COMPLETED'::character varying])::text[])))
);


--
-- Name: TABLE administrative_tasks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.administrative_tasks IS 'Queue de tareas administrativas para supervisin (Workflow altaEmpresa - FASE 3)';


--
-- Name: COLUMN administrative_tasks.task_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.administrative_tasks.task_type IS 'Tipo: FACTURA_SUPERVISION, CONTRACT_REVIEW, PAYMENT_VERIFICATION, etc.';


--
-- Name: COLUMN administrative_tasks.priority; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.administrative_tasks.priority IS 'Prioridad: CRITICAL, HIGH, NORMAL, LOW';


--
-- Name: COLUMN administrative_tasks.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.administrative_tasks.status IS 'Estado: PENDING, ASSIGNED, IN_PROGRESS, APPROVED, REJECTED, COMPLETED';


--
-- Name: COLUMN administrative_tasks.resolution; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.administrative_tasks.resolution IS 'Resolucin: APPROVED, REJECTED, CANCELLED, INFO_PROVIDED';


--
-- Name: afip_auth_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.afip_auth_log (
    id integer NOT NULL,
    company_id integer NOT NULL,
    service character varying(50) NOT NULL,
    token_hash character varying(64),
    sign_hash character varying(64),
    generation_time timestamp without time zone NOT NULL,
    expiration_time timestamp without time zone NOT NULL,
    tra_xml text,
    response_xml text,
    success boolean DEFAULT false,
    error_message text,
    environment character varying(20),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: afip_auth_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.afip_auth_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: afip_auth_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.afip_auth_log_id_seq OWNED BY public.afip_auth_log.id;


--
-- Name: afip_cae_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.afip_cae_log (
    id integer NOT NULL,
    company_id integer NOT NULL,
    factura_id integer,
    punto_venta integer NOT NULL,
    tipo_comprobante integer NOT NULL,
    numero_comprobante bigint NOT NULL,
    cae character varying(14) NOT NULL,
    cae_vencimiento date NOT NULL,
    request_xml text,
    response_xml text,
    resultado character varying(1),
    fecha_proceso date,
    observaciones text,
    errores text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: afip_cae_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.afip_cae_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: afip_cae_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.afip_cae_log_id_seq OWNED BY public.afip_cae_log.id;


--
-- Name: aponnt_admin_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_admin_tasks (
    id integer NOT NULL,
    task_code character varying(50) NOT NULL,
    task_type character varying(50) NOT NULL,
    priority character varying(20) DEFAULT 'MEDIUM'::character varying,
    due_date timestamp without time zone,
    entity_type character varying(50),
    entity_id integer,
    company_id integer,
    title character varying(255) NOT NULL,
    description text,
    metadata jsonb DEFAULT '{}'::jsonb,
    assigned_to integer,
    assigned_role character varying(50),
    status character varying(50) DEFAULT 'PENDING'::character varying,
    completed_at timestamp without time zone,
    completed_by integer,
    completion_notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT valid_priority CHECK (((priority)::text = ANY ((ARRAY['LOW'::character varying, 'MEDIUM'::character varying, 'HIGH'::character varying, 'URGENT'::character varying])::text[]))),
    CONSTRAINT valid_task_status CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'IN_PROGRESS'::character varying, 'COMPLETED'::character varying, 'CANCELLED'::character varying])::text[])))
);


--
-- Name: aponnt_admin_tasks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.aponnt_admin_tasks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: aponnt_admin_tasks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.aponnt_admin_tasks_id_seq OWNED BY public.aponnt_admin_tasks.id;


--
-- Name: aponnt_associates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_associates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    email character varying(255) NOT NULL,
    phone character varying(50),
    secondary_phone character varying(50),
    dni character varying(20),
    photo_url text,
    bio text,
    linkedin_url character varying(255),
    category public.associate_category NOT NULL,
    specialty character varying(200),
    sub_specialties text[],
    license_number character varying(100),
    license_issuer character varying(100),
    license_expiry date,
    certifications jsonb DEFAULT '[]'::jsonb,
    user_id uuid,
    availability jsonb DEFAULT '{}'::jsonb,
    service_regions text[] DEFAULT '{}'::text[],
    remote_available boolean DEFAULT false,
    hourly_rate numeric(10,2),
    currency character varying(3) DEFAULT 'ARS'::character varying,
    payment_terms text,
    rating_average numeric(3,2) DEFAULT 0,
    rating_count integer DEFAULT 0,
    contracts_completed integer DEFAULT 0,
    active_contracts integer DEFAULT 0,
    is_verified boolean DEFAULT false,
    verified_at timestamp without time zone,
    verified_by uuid,
    verification_notes text,
    is_active boolean DEFAULT true,
    is_featured boolean DEFAULT false,
    tags text[] DEFAULT '{}'::text[],
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: aponnt_email_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_email_config (
    id integer NOT NULL,
    config_type character varying(50) NOT NULL,
    from_email character varying(255) NOT NULL,
    from_name character varying(255) NOT NULL,
    reply_to character varying(255),
    smtp_host character varying(255) NOT NULL,
    smtp_port integer NOT NULL,
    smtp_user character varying(255) NOT NULL,
    smtp_password text NOT NULL,
    smtp_secure boolean DEFAULT true,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_aponnt_config_type CHECK (((config_type)::text = ANY ((ARRAY['transactional'::character varying, 'marketing'::character varying, 'support'::character varying, 'billing'::character varying, 'institutional'::character varying, 'support_coordinator'::character varying, 'commercial'::character varying, 'engineering'::character varying, 'associates'::character varying])::text[])))
);


--
-- Name: TABLE aponnt_email_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.aponnt_email_config IS 'Configuraciones de email de la plataforma Aponnt';


--
-- Name: aponnt_email_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.aponnt_email_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: aponnt_email_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.aponnt_email_config_id_seq OWNED BY public.aponnt_email_config.id;


--
-- Name: aponnt_pre_invoices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_pre_invoices (
    id integer NOT NULL,
    contract_id uuid,
    budget_id uuid,
    company_id integer,
    pre_invoice_code character varying(50) NOT NULL,
    cliente_cuit character varying(15) NOT NULL,
    cliente_razon_social character varying(255) NOT NULL,
    cliente_condicion_iva character varying(50) DEFAULT 'RI'::character varying NOT NULL,
    cliente_domicilio_fiscal text,
    cliente_email character varying(255),
    items jsonb DEFAULT '[]'::jsonb NOT NULL,
    periodo_desde date NOT NULL,
    periodo_hasta date NOT NULL,
    subtotal numeric(15,2) DEFAULT 0 NOT NULL,
    descuento_porcentaje numeric(5,2) DEFAULT 0,
    descuento_importe numeric(15,2) DEFAULT 0,
    neto_gravado numeric(15,2) DEFAULT 0 NOT NULL,
    iva_21 numeric(15,2) DEFAULT 0,
    iva_10_5 numeric(15,2) DEFAULT 0,
    iva_27 numeric(15,2) DEFAULT 0,
    otros_impuestos numeric(15,2) DEFAULT 0,
    total numeric(15,2) DEFAULT 0 NOT NULL,
    condicion_venta character varying(50) DEFAULT 'CTA_CTE'::character varying,
    status character varying(50) DEFAULT 'PENDING_REVIEW'::character varying,
    invoice_id integer,
    invoiced_at timestamp without time zone,
    invoiced_by integer,
    rejection_reason text,
    rejected_at timestamp without time zone,
    rejected_by integer,
    observations text,
    admin_notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by character varying(100) DEFAULT 'SYSTEM'::character varying,
    CONSTRAINT valid_periodo CHECK ((periodo_hasta >= periodo_desde)),
    CONSTRAINT valid_pre_invoice_status CHECK (((status)::text = ANY ((ARRAY['PENDING_REVIEW'::character varying, 'APPROVED'::character varying, 'INVOICED'::character varying, 'REJECTED'::character varying, 'CANCELLED'::character varying])::text[])))
);


--
-- Name: aponnt_pre_invoices_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.aponnt_pre_invoices_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: aponnt_pre_invoices_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.aponnt_pre_invoices_id_seq OWNED BY public.aponnt_pre_invoices.id;


--
-- Name: aponnt_staff; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_staff (
    staff_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    email character varying(255) NOT NULL,
    phone character varying(50),
    document_type character varying(20),
    document_number character varying(50),
    role_id uuid NOT NULL,
    reports_to_staff_id uuid,
    country character varying(2) NOT NULL,
    nationality character varying(2),
    level integer NOT NULL,
    area character varying(50) NOT NULL,
    language_preference character varying(2) DEFAULT 'es'::character varying,
    contract_type character varying(20),
    hire_date date,
    termination_date date,
    cbu character varying(50),
    bank_name character varying(100),
    bank_account_type character varying(20),
    accepts_support_packages boolean DEFAULT false,
    accepts_auctions boolean DEFAULT false,
    whatsapp_number character varying(50),
    global_rating numeric(3,2) DEFAULT 0.00,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    created_by uuid,
    updated_by uuid,
    pyramid_commission_percentage_override numeric(5,2) DEFAULT NULL::numeric,
    alias_cbu character varying(100),
    account_type character varying(50),
    account_number character varying(100),
    payment_method_preference character varying(50) DEFAULT 'TRANSFERENCIA'::character varying,
    virtual_wallet_provider character varying(100),
    virtual_wallet_account character varying(255),
    tax_id character varying(50),
    tax_condition character varying(100),
    accepts_electronic_payment boolean DEFAULT true,
    bank_data_verified boolean DEFAULT false,
    bank_data_verified_at timestamp without time zone,
    bank_data_verified_by uuid,
    CONSTRAINT aponnt_staff_pyramid_commission_percentage_override_check CHECK (((pyramid_commission_percentage_override IS NULL) OR ((pyramid_commission_percentage_override >= (0)::numeric) AND (pyramid_commission_percentage_override <= (100)::numeric)))),
    CONSTRAINT valid_account_type CHECK (((account_type IS NULL) OR ((account_type)::text = ANY ((ARRAY['CUENTA_CORRIENTE'::character varying, 'CAJA_AHORRO'::character varying, 'CVU'::character varying])::text[])))),
    CONSTRAINT valid_cbu_format CHECK (((cbu IS NULL) OR ((length((cbu)::text) = 22) AND ((cbu)::text ~ '^[0-9]{22}$'::text)))),
    CONSTRAINT valid_payment_method CHECK (((payment_method_preference)::text = ANY ((ARRAY['TRANSFERENCIA'::character varying, 'VIRTUAL_WALLET'::character varying, 'CHEQUE'::character varying, 'EFECTIVO'::character varying])::text[])))
);


--
-- Name: TABLE aponnt_staff; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.aponnt_staff IS 'Staff de Aponnt (vendedores, gerentes, desarrollo, etc.). SEPARADO de users de empresas.';


--
-- Name: COLUMN aponnt_staff.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.user_id IS 'FK a users (OPCIONAL). Solo si el staff tiene acceso al sistema. NULL = sin acceso.';


--
-- Name: COLUMN aponnt_staff.role_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.role_id IS 'FK a aponnt_staff_roles. Define el rol organizacional (GG, GR, VEND, etc.)';


--
-- Name: COLUMN aponnt_staff.reports_to_staff_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.reports_to_staff_id IS 'FK a aponnt_staff (auto-referencia). Define la jerarqua organizacional.';


--
-- Name: COLUMN aponnt_staff.country; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.country IS 'Pas asignado (ISO-2). Para ventas, define regin. Para otros, ubicacin fsica.';


--
-- Name: COLUMN aponnt_staff.level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.level IS 'Nivel jerrquico: 0=CEO, 1=Gerentes, 2=Jefes, 3=Coordinadores, 4=Operativos';


--
-- Name: COLUMN aponnt_staff.area; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.area IS 'rea organizacional: ventas, admin, desarrollo, externo, direccion';


--
-- Name: COLUMN aponnt_staff.cbu; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.cbu IS 'CBU de Argentina (22 dgitos numricos con dgitos verificadores)';


--
-- Name: COLUMN aponnt_staff.bank_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.bank_name IS 'Nombre del banco donde tiene la cuenta';


--
-- Name: COLUMN aponnt_staff.pyramid_commission_percentage_override; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.pyramid_commission_percentage_override IS 'Override opcional del % piramidal del rol. Si es NULL, usa el % del rol. Si tiene valor, override del rol.';


--
-- Name: COLUMN aponnt_staff.alias_cbu; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.alias_cbu IS 'Alias del CBU para transferencias simplificadas';


--
-- Name: COLUMN aponnt_staff.account_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.account_type IS 'Tipo de cuenta: CUENTA_CORRIENTE, CAJA_AHORRO, CVU';


--
-- Name: COLUMN aponnt_staff.payment_method_preference; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.payment_method_preference IS 'Mtodo de pago preferido: TRANSFERENCIA, VIRTUAL_WALLET, CHEQUE, EFECTIVO';


--
-- Name: COLUMN aponnt_staff.virtual_wallet_provider; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.virtual_wallet_provider IS 'Proveedor de billetera virtual: MercadoPago, Ual, etc.';


--
-- Name: COLUMN aponnt_staff.tax_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.tax_id IS 'CUIT/CUIL para retenciones fiscales';


--
-- Name: COLUMN aponnt_staff.bank_data_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff.bank_data_verified IS 'TRUE si los datos bancarios fueron verificados por admin';


--
-- Name: aponnt_staff_companies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_staff_companies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    staff_id uuid NOT NULL,
    company_id integer NOT NULL,
    assigned_at timestamp without time zone DEFAULT now(),
    assigned_by uuid,
    assignment_note text,
    is_active boolean DEFAULT true,
    deactivated_at timestamp without time zone,
    deactivated_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE aponnt_staff_companies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.aponnt_staff_companies IS 'Relacin many-to-many: Staff de Aponnt  Empresas cliente';


--
-- Name: COLUMN aponnt_staff_companies.staff_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff_companies.staff_id IS 'ID del staff (vendedor, soporte, etc.)';


--
-- Name: COLUMN aponnt_staff_companies.company_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff_companies.company_id IS 'ID de la empresa cliente';


--
-- Name: COLUMN aponnt_staff_companies.assigned_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff_companies.assigned_by IS 'Quin realiz la asignacin (supervisor/admin)';


--
-- Name: aponnt_staff_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.aponnt_staff_roles (
    role_id uuid DEFAULT gen_random_uuid() NOT NULL,
    role_code character varying(10) NOT NULL,
    role_name character varying(100) NOT NULL,
    role_name_i18n jsonb DEFAULT '{}'::jsonb,
    role_area character varying(50),
    level integer NOT NULL,
    is_sales_role boolean DEFAULT false,
    is_country_specific boolean DEFAULT false,
    reports_to_role_code character varying(10),
    description text,
    responsibilities jsonb DEFAULT '[]'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    pyramid_commission_percentage numeric(5,2) DEFAULT 0.00,
    CONSTRAINT aponnt_staff_roles_pyramid_commission_percentage_check CHECK (((pyramid_commission_percentage >= (0)::numeric) AND (pyramid_commission_percentage <= (100)::numeric)))
);


--
-- Name: COLUMN aponnt_staff_roles.pyramid_commission_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.aponnt_staff_roles.pyramid_commission_percentage IS 'Porcentaje de comisin piramidal por defecto para este rol (0-100%). Ej: Leader=2%, Supervisor=1.5%, Regional=1%, CEO=0.5%';


--
-- Name: approved_shift_swaps; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.approved_shift_swaps (
    id integer NOT NULL,
    notification_group_id uuid NOT NULL,
    company_id integer NOT NULL,
    employee_1_id character varying(100) NOT NULL,
    employee_2_id character varying(100) NOT NULL,
    swap_date date NOT NULL,
    original_shift_id integer,
    replacement_shift_id integer,
    status character varying(20) DEFAULT 'approved'::character varying,
    employee_1_can_clock boolean DEFAULT false,
    employee_2_can_clock boolean DEFAULT true,
    generates_overtime boolean DEFAULT false,
    overtime_hours numeric(5,2),
    violates_rest_period boolean DEFAULT false,
    art_notified boolean DEFAULT false,
    art_notified_at timestamp without time zone,
    art_reference character varying(100),
    approved_at timestamp without time zone DEFAULT now(),
    executed_at timestamp without time zone
);


--
-- Name: TABLE approved_shift_swaps; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.approved_shift_swaps IS 'Cambios de turno aprobados - Controla qu empleado puede fichar en kiosco';


--
-- Name: approved_shift_swaps_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.approved_shift_swaps_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: approved_shift_swaps_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.approved_shift_swaps_id_seq OWNED BY public.approved_shift_swaps.id;


--
-- Name: art_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.art_configurations (
    id uuid NOT NULL,
    "artName" character varying(255) NOT NULL,
    "artCode" character varying(255),
    "primaryContactName" character varying(255),
    "primaryContactRole" character varying(255),
    phone character varying(255),
    "whatsappNumber" character varying(255),
    email character varying(255),
    "emergencyPhone" character varying(255),
    "notificationPreferences" json DEFAULT '{"whatsapp":true,"sms":false,"email":true}'::json,
    "notificationTriggers" json DEFAULT '{"accidents":true,"occupational_diseases":true,"work_related_injuries":true,"long_absences":true,"recurring_cases":true}'::json,
    thresholds json DEFAULT '{"long_absence_days":15,"recurring_case_count":3,"recurring_case_period_months":6}'::json,
    "businessHours" json DEFAULT '{"start":"08:00","end":"18:00","timezone":"America/Argentina/Buenos_Aires"}'::json,
    "companyId" uuid,
    "isActive" boolean DEFAULT true,
    "lastNotificationSent" timestamp with time zone,
    "totalNotificationsSent" integer DEFAULT 0,
    "customFields" json,
    notes text,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: COLUMN art_configurations."artName"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."artName" IS 'Nombre de la Aseguradora de Riesgo de Trabajo';


--
-- Name: COLUMN art_configurations."artCode"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."artCode" IS 'Cdigo identificador de la ART';


--
-- Name: COLUMN art_configurations."primaryContactName"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."primaryContactName" IS 'Nombre del contacto principal en la ART';


--
-- Name: COLUMN art_configurations."primaryContactRole"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."primaryContactRole" IS 'Cargo del contacto principal';


--
-- Name: COLUMN art_configurations.phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations.phone IS 'Telfono de contacto';


--
-- Name: COLUMN art_configurations."whatsappNumber"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."whatsappNumber" IS 'Nmero de WhatsApp para notificaciones';


--
-- Name: COLUMN art_configurations.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations.email IS 'Email para notificaciones';


--
-- Name: COLUMN art_configurations."emergencyPhone"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."emergencyPhone" IS 'Telfono de emergencia';


--
-- Name: COLUMN art_configurations."notificationPreferences"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."notificationPreferences" IS 'Preferencias de notificacin';


--
-- Name: COLUMN art_configurations."notificationTriggers"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."notificationTriggers" IS 'Tipos de casos que activan notificacin a ART';


--
-- Name: COLUMN art_configurations.thresholds; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations.thresholds IS 'Umbrales para activar notificaciones automticas';


--
-- Name: COLUMN art_configurations."businessHours"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."businessHours" IS 'Horarios comerciales para notificaciones';


--
-- Name: COLUMN art_configurations."companyId"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."companyId" IS 'ID de la empresa (null = configuracin global)';


--
-- Name: COLUMN art_configurations."isActive"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."isActive" IS 'Si la configuracin est activa';


--
-- Name: COLUMN art_configurations."lastNotificationSent"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."lastNotificationSent" IS 'Fecha de la ltima notificacin enviada';


--
-- Name: COLUMN art_configurations."totalNotificationsSent"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."totalNotificationsSent" IS 'Total de notificaciones enviadas';


--
-- Name: COLUMN art_configurations."customFields"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations."customFields" IS 'Campos personalizados adicionales';


--
-- Name: COLUMN art_configurations.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.art_configurations.notes IS 'Notas adicionales sobre la configuracin';


--
-- Name: asset_contracts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.asset_contracts (
    id integer NOT NULL,
    asset_assignment_id integer NOT NULL,
    contract_type character varying(30) NOT NULL,
    contract_number character varying(100),
    contract_start_date date NOT NULL,
    contract_end_date date,
    dms_contract_document_id integer,
    contract_file_path character varying(500),
    terms_and_conditions text,
    employee_signature_date date,
    company_signature_date date,
    employee_signed_by uuid,
    company_signed_by uuid,
    status character varying(30) DEFAULT 'draft'::character varying,
    termination_date date,
    termination_reason text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid,
    template_id integer,
    country_code character varying(3),
    generated_html text,
    generated_variables jsonb DEFAULT '{}'::jsonb
);


--
-- Name: TABLE asset_contracts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.asset_contracts IS 'Contratos y comodatos de activos asignados (SSOT: DMS para PDFs generados)';


--
-- Name: COLUMN asset_contracts.asset_assignment_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.asset_assignment_id IS 'SSOT: employee_assigned_assets.id';


--
-- Name: COLUMN asset_contracts.contract_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.contract_type IS 'COMODATO, LEASE, LOAN, OTHER';


--
-- Name: COLUMN asset_contracts.dms_contract_document_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.dms_contract_document_id IS 'SSOT: DMS documents table';


--
-- Name: COLUMN asset_contracts.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.status IS 'draft, pending_signature, signed, active, completed, terminated';


--
-- Name: COLUMN asset_contracts.template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.template_id IS 'SSOT: contract_templates.id (template usado)';


--
-- Name: COLUMN asset_contracts.country_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.country_code IS 'Pas del empleado (determina template)';


--
-- Name: COLUMN asset_contracts.generated_html; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.asset_contracts.generated_html IS 'HTML final del contrato generado con variables reemplazadas';


--
-- Name: asset_contracts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.asset_contracts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: asset_contracts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.asset_contracts_id_seq OWNED BY public.asset_contracts.id;


--
-- Name: assistant_action_handlers; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.assistant_action_handlers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    action_pattern text NOT NULL,
    action_type character varying(100) NOT NULL,
    handler_service character varying(100) NOT NULL,
    handler_method character varying(100) NOT NULL,
    required_params jsonb DEFAULT '[]'::jsonb,
    required_role text[] DEFAULT '{}'::text[],
    description text,
    examples jsonb DEFAULT '[]'::jsonb,
    is_active boolean DEFAULT true,
    execution_count integer DEFAULT 0,
    last_executed_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: assistant_conversations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.assistant_conversations (
    id uuid NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    question text NOT NULL,
    answer text NOT NULL,
    knowledge_entry_id uuid,
    context jsonb DEFAULT '{}'::jsonb,
    module_name character varying(100),
    screen_name character varying(100),
    answer_source character varying(50) DEFAULT 'ollama'::character varying,
    confidence numeric(3,2) DEFAULT 0,
    response_time_ms integer,
    helpful boolean,
    feedback_comment text,
    feedback_at timestamp with time zone,
    diagnostic_triggered boolean DEFAULT false,
    created_at timestamp with time zone
);


--
-- Name: COLUMN assistant_conversations.company_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_conversations.company_id IS 'OBLIGATORIO - Historial es PRIVADO por empresa';


--
-- Name: COLUMN assistant_conversations.knowledge_entry_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_conversations.knowledge_entry_id IS 'Si la respuesta vino del knowledge base global';


--
-- Name: COLUMN assistant_conversations.answer_source; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_conversations.answer_source IS 'Origen de la respuesta';


--
-- Name: COLUMN assistant_conversations.helpful; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_conversations.helpful IS 'NULL = sin feedback an';


--
-- Name: assistant_knowledge_base; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.assistant_knowledge_base (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer,
    user_id uuid,
    user_role character varying(50),
    question text NOT NULL,
    question_normalized text,
    context jsonb,
    module_name character varying(100),
    answer text NOT NULL,
    answer_source character varying(50) DEFAULT 'ollama'::character varying,
    model_used character varying(100) DEFAULT 'llama3.1:8b'::character varying,
    tokens_used integer,
    response_time_ms integer,
    confidence_score numeric(3,2),
    diagnostic_triggered boolean DEFAULT false,
    diagnostic_execution_id uuid,
    diagnostic_results jsonb,
    suggested_actions jsonb,
    quick_replies jsonb,
    helpful boolean,
    feedback_comment text,
    feedback_at timestamp without time zone,
    reused_count integer DEFAULT 0,
    improved_answer text,
    verified_by_admin uuid,
    verified_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    feedback_text text
);


--
-- Name: TABLE assistant_knowledge_base; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.assistant_knowledge_base IS 'Knowledge base del asistente IA con Ollama + Llama 3.1 - Aprende de interacciones';


--
-- Name: COLUMN assistant_knowledge_base.question_normalized; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.question_normalized IS 'Pregunta normalizada (lowercase, sin acentos) para bsqueda';


--
-- Name: COLUMN assistant_knowledge_base.context; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.context IS 'JSONB con contexto: mdulo, pantalla, accin del usuario';


--
-- Name: COLUMN assistant_knowledge_base.answer_source; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.answer_source IS 'Origen de respuesta: ollama (generada), cache (reusada), diagnostic (de auditor)';


--
-- Name: COLUMN assistant_knowledge_base.confidence_score; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.confidence_score IS 'Confianza de la IA en la respuesta (0.00-1.00)';


--
-- Name: COLUMN assistant_knowledge_base.diagnostic_triggered; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.diagnostic_triggered IS 'Si se dispar diagnstico tcnico del auditor';


--
-- Name: COLUMN assistant_knowledge_base.suggested_actions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.suggested_actions IS 'Acciones sugeridas: botones/links para ejecutar acciones';


--
-- Name: COLUMN assistant_knowledge_base.reused_count; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.reused_count IS 'Cuntas veces se reus esta respuesta (popularidad)';


--
-- Name: COLUMN assistant_knowledge_base.improved_answer; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.assistant_knowledge_base.improved_answer IS 'Respuesta mejorada manualmente por admin';


--
-- Name: associate_employee_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.associate_employee_assignments (
    id integer NOT NULL,
    contract_id integer NOT NULL,
    employee_id uuid NOT NULL,
    assignment_reason text,
    assignment_type character varying(50) DEFAULT 'manual'::character varying,
    assigned_at timestamp without time zone DEFAULT now(),
    assigned_by uuid,
    expires_at timestamp without time zone,
    is_active boolean DEFAULT true,
    deactivated_at timestamp without time zone,
    deactivated_by uuid,
    deactivation_reason text
);


--
-- Name: associate_employee_assignments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.associate_employee_assignments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: associate_employee_assignments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.associate_employee_assignments_id_seq OWNED BY public.associate_employee_assignments.id;


--
-- Name: attendance_analytics_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.attendance_analytics_cache (
    id bigint NOT NULL,
    company_id integer NOT NULL,
    cache_key character varying(255) NOT NULL,
    cache_type character varying(50),
    dimension_1 character varying(50),
    dimension_1_value character varying(255),
    dimension_2 character varying(50),
    dimension_2_value character varying(255),
    period_start date,
    period_end date,
    cached_data jsonb NOT NULL,
    calculated_at timestamp without time zone DEFAULT now(),
    expires_at timestamp without time zone,
    hit_count integer DEFAULT 0,
    last_hit_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE attendance_analytics_cache; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.attendance_analytics_cache IS 'Cache de mtricas agregadas pre-calculadas (TTL configurable)';


--
-- Name: attendance_analytics_cache_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.attendance_analytics_cache_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: attendance_analytics_cache_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.attendance_analytics_cache_id_seq OWNED BY public.attendance_analytics_cache.id;


--
-- Name: attendance_patterns; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.attendance_patterns (
    id bigint NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    pattern_id character varying(50) NOT NULL,
    pattern_name character varying(255),
    pattern_category character varying(50),
    detection_date date NOT NULL,
    severity character varying(20),
    confidence_score numeric(5,2) DEFAULT 0.00,
    occurrences_count integer DEFAULT 1,
    detection_period_start date,
    detection_period_end date,
    threshold_value numeric(10,2),
    actual_value numeric(10,2),
    scoring_impact numeric(5,2) DEFAULT 0.00,
    requires_action boolean DEFAULT false,
    action_taken text,
    action_taken_at timestamp without time zone,
    action_taken_by uuid,
    status character varying(20) DEFAULT 'active'::character varying,
    resolved_at timestamp without time zone,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT chk_pattern_category CHECK (((pattern_category)::text = ANY ((ARRAY['negative'::character varying, 'positive'::character varying, 'neutral'::character varying])::text[]))),
    CONSTRAINT chk_pattern_severity CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT chk_pattern_status CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'resolved'::character varying, 'ignored'::character varying])::text[])))
);


--
-- Name: TABLE attendance_patterns; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.attendance_patterns IS 'Patrones de comportamiento detectados automticamente';


--
-- Name: attendance_patterns_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.attendance_patterns_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: attendance_patterns_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.attendance_patterns_id_seq OWNED BY public.attendance_patterns.id;


--
-- Name: attendance_profiles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.attendance_profiles (
    id bigint NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    employee_id character varying(50),
    department_id bigint,
    shift_id bigint,
    branch_id bigint,
    scoring_total numeric(5,2) DEFAULT 100.00,
    scoring_punctuality numeric(5,2) DEFAULT 100.00,
    scoring_absence numeric(5,2) DEFAULT 100.00,
    scoring_late_arrival numeric(5,2) DEFAULT 100.00,
    scoring_early_departure numeric(5,2) DEFAULT 100.00,
    total_days integer DEFAULT 0,
    present_days integer DEFAULT 0,
    absent_days integer DEFAULT 0,
    late_arrivals_count integer DEFAULT 0,
    early_departures_count integer DEFAULT 0,
    tolerance_usage_rate numeric(5,2) DEFAULT 0.00,
    avg_late_minutes integer DEFAULT 0,
    overtime_hours_total numeric(10,2) DEFAULT 0.00,
    active_patterns text[],
    positive_patterns text[],
    negative_patterns text[],
    last_calculated_at timestamp without time zone DEFAULT now(),
    calculation_period_start date,
    calculation_period_end date,
    profile_category character varying(50),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT chk_scoring_absence CHECK (((scoring_absence >= (0)::numeric) AND (scoring_absence <= (100)::numeric))),
    CONSTRAINT chk_scoring_early CHECK (((scoring_early_departure >= (0)::numeric) AND (scoring_early_departure <= (100)::numeric))),
    CONSTRAINT chk_scoring_late CHECK (((scoring_late_arrival >= (0)::numeric) AND (scoring_late_arrival <= (100)::numeric))),
    CONSTRAINT chk_scoring_punctuality CHECK (((scoring_punctuality >= (0)::numeric) AND (scoring_punctuality <= (100)::numeric))),
    CONSTRAINT chk_scoring_total CHECK (((scoring_total >= (0)::numeric) AND (scoring_total <= (100)::numeric))),
    CONSTRAINT chk_tolerance_usage CHECK (((tolerance_usage_rate >= (0)::numeric) AND (tolerance_usage_rate <= (100)::numeric)))
);


--
-- Name: TABLE attendance_profiles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.attendance_profiles IS 'Perfiles de asistencia y scoring por empleado (actualizado diariamente)';


--
-- Name: attendance_profiles_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.attendance_profiles_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: attendance_profiles_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.attendance_profiles_id_seq OWNED BY public.attendance_profiles.id;


--
-- Name: attendance_rankings; Type: MATERIALIZED VIEW; Schema: public; Owner: -
--

CREATE MATERIALIZED VIEW public.attendance_rankings AS
 SELECT company_id,
    user_id,
    employee_id,
    department_id,
    shift_id,
    scoring_total,
    rank() OVER (PARTITION BY company_id ORDER BY scoring_total DESC) AS rank_global,
    rank() OVER (PARTITION BY company_id, department_id ORDER BY scoring_total DESC) AS rank_department,
    rank() OVER (PARTITION BY company_id, shift_id ORDER BY scoring_total DESC) AS rank_shift,
    profile_category,
    last_calculated_at
   FROM public.attendance_profiles
  WHERE (scoring_total IS NOT NULL)
  ORDER BY company_id, scoring_total DESC
  WITH NO DATA;


--
-- Name: MATERIALIZED VIEW attendance_rankings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON MATERIALIZED VIEW public.attendance_rankings IS 'Rankings pre-calculados (refresh diario 02:00 AM)';


--
-- Name: attendances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.attendances (
    id uuid NOT NULL,
    date date NOT NULL,
    "checkInTime" timestamp with time zone,
    "checkOutTime" timestamp with time zone,
    "checkInMethod" public."enum_attendances_checkInMethod",
    "checkOutMethod" public."enum_attendances_checkOutMethod",
    "workingHours" numeric(4,2) DEFAULT 0,
    status public.enum_attendances_status DEFAULT 'present'::public.enum_attendances_status,
    notes text,
    "BranchId" uuid,
    "UserId" uuid NOT NULL,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    authorization_status character varying(20),
    authorization_token character varying(255),
    authorized_by_user_id uuid,
    authorized_at timestamp without time zone,
    authorization_notes text,
    notified_authorizers jsonb DEFAULT '[]'::jsonb,
    authorization_requested_at timestamp without time zone,
    kiosk_id integer,
    origin_type character varying(20) DEFAULT 'kiosk'::character varying,
    break_out timestamp without time zone,
    break_in timestamp without time zone,
    company_id integer,
    is_justified boolean DEFAULT false,
    absence_type character varying(50),
    absence_reason text,
    justified_by uuid,
    justified_at timestamp with time zone,
    medical_certificate_id integer,
    check_in_latitude numeric(10,8),
    check_in_longitude numeric(11,8),
    check_in_accuracy numeric(6,2),
    check_out_latitude numeric(10,8),
    check_out_longitude numeric(11,8),
    check_out_accuracy numeric(6,2),
    employee_id character varying(50),
    "checkInLocation" character varying(255),
    "checkOutLocation" character varying(255),
    clock_in_location text,
    clock_out_location text,
    clock_in_ip character varying(45),
    clock_out_ip character varying(45),
    break_time integer DEFAULT 0,
    overtime_hours numeric(5,2) DEFAULT 0,
    approved_by bigint,
    approved_at timestamp without time zone,
    is_processed boolean DEFAULT false,
    batch_id uuid,
    processing_queue integer,
    work_date date,
    department_id bigint,
    shift_id bigint,
    version integer DEFAULT 1,
    is_late boolean DEFAULT false,
    minutes_late integer DEFAULT 0,
    authorization_id uuid,
    weather_pattern character varying(20) DEFAULT 'UNKNOWN'::character varying,
    weather_temperature numeric(5,2) DEFAULT NULL::numeric,
    weather_condition character varying(30) DEFAULT NULL::character varying,
    weather_is_night boolean DEFAULT false,
    weather_captured_at timestamp with time zone,
    overtime_destination character varying(20),
    hour_bank_transaction_id integer,
    CONSTRAINT attendances_authorization_status_check CHECK (((authorization_status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying])::text[]))),
    CONSTRAINT attendances_origin_type_check CHECK (((origin_type)::text = ANY ((ARRAY['kiosk'::character varying, 'mobile_app'::character varying, 'web'::character varying, 'manual'::character varying])::text[])))
);


--
-- Name: COLUMN attendances.authorization_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorization_status IS 'Estado de autorizacin: pending, approved, rejected';


--
-- Name: COLUMN attendances.authorization_token; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorization_token IS 'Token nico para autorizar/rechazar va link';


--
-- Name: COLUMN attendances.authorized_by_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorized_by_user_id IS 'User ID de quien autoriz (FK a users.user_id)';


--
-- Name: COLUMN attendances.authorized_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorized_at IS 'Timestamp de cundo se autoriz/rechaz';


--
-- Name: COLUMN attendances.authorization_notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorization_notes IS 'Notas/comentarios del autorizador';


--
-- Name: COLUMN attendances.notified_authorizers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.notified_authorizers IS 'Array de user_ids que fueron notificados para autorizar';


--
-- Name: COLUMN attendances.authorization_requested_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.authorization_requested_at IS 'Timestamp de cundo se solicit autorizacin';


--
-- Name: COLUMN attendances.kiosk_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.kiosk_id IS 'Kiosko usado para el registro (NULL si es app mvil)';


--
-- Name: COLUMN attendances.origin_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.origin_type IS 'Origen del registro: kiosk, mobile_app, web, manual';


--
-- Name: COLUMN attendances.break_out; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.break_out IS 'Timestamp de inicio de break/descanso';


--
-- Name: COLUMN attendances.break_in; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.break_in IS 'Timestamp de retorno de break/descanso';


--
-- Name: COLUMN attendances.check_in_latitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_in_latitude IS 'Latitud GPS al momento del fichaje de entrada';


--
-- Name: COLUMN attendances.check_in_longitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_in_longitude IS 'Longitud GPS al momento del fichaje de entrada';


--
-- Name: COLUMN attendances.check_in_accuracy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_in_accuracy IS 'Precisin del GPS en metros al fichar entrada';


--
-- Name: COLUMN attendances.check_out_latitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_out_latitude IS 'Latitud GPS al momento del fichaje de salida';


--
-- Name: COLUMN attendances.check_out_longitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_out_longitude IS 'Longitud GPS al momento del fichaje de salida';


--
-- Name: COLUMN attendances.check_out_accuracy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.check_out_accuracy IS 'Precisin del GPS en metros al fichar salida';


--
-- Name: COLUMN attendances.overtime_destination; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.overtime_destination IS 'Destino de las HE de este fichaje: bank/pay/pending';


--
-- Name: COLUMN attendances.hour_bank_transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.attendances.hour_bank_transaction_id IS 'ID de transaccion en hour_bank_transactions';


--
-- Name: audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audit_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    company_id integer,
    action character varying(100) NOT NULL,
    module_id character varying(50),
    entity_type character varying(50),
    entity_id character varying(100),
    old_values jsonb,
    new_values jsonb,
    ip_address inet,
    user_agent text,
    session_id character varying(100),
    success boolean DEFAULT true,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    test_description text
);


--
-- Name: audit_reports; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audit_reports (
    id integer NOT NULL,
    company_id integer NOT NULL,
    report_type character varying(50) NOT NULL,
    generated_at timestamp without time zone DEFAULT now() NOT NULL,
    generated_by character varying(100) NOT NULL,
    parameters jsonb NOT NULL,
    digital_signature character varying(64) NOT NULL,
    verification_code character varying(32) NOT NULL,
    file_path character varying(255),
    file_size_bytes integer,
    status character varying(20) DEFAULT 'generated'::character varying,
    is_deleted boolean DEFAULT false
);


--
-- Name: TABLE audit_reports; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.audit_reports IS 'Reportes de auditora con validez legal - Incluyen firma digital y cdigo QR';


--
-- Name: audit_reports_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.audit_reports_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: audit_reports_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.audit_reports_id_seq OWNED BY public.audit_reports.id;


--
-- Name: audit_test_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audit_test_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    execution_id uuid NOT NULL,
    company_id integer NOT NULL,
    module_name character varying(100) NOT NULL,
    test_name character varying(200) NOT NULL,
    test_type character varying(50) DEFAULT 'e2e'::character varying,
    test_category character varying(100),
    status character varying(50) NOT NULL,
    started_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    duration_ms integer,
    error_type character varying(100),
    error_message text,
    error_stack text,
    screenshot_path character varying(500),
    fix_attempted boolean DEFAULT false,
    fix_strategy character varying(100),
    fix_code text,
    fix_applied boolean DEFAULT false,
    fix_successful boolean,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    environment character varying(50) DEFAULT 'local'::character varying,
    triggered_by character varying(50) DEFAULT 'manual'::character varying,
    severity character varying(20),
    test_description text,
    error_file character varying(500),
    error_line integer,
    error_context jsonb,
    endpoint character varying(500),
    http_method character varying(10),
    request_body jsonb,
    request_headers jsonb,
    response_status integer,
    response_body jsonb,
    response_time_ms integer,
    metrics jsonb,
    fix_result character varying(50),
    suggestions jsonb,
    notes text,
    test_data jsonb,
    tags character varying(100)[]
);


--
-- Name: TABLE audit_test_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.audit_test_logs IS 'Logs de tests automatizados del sistema de auditora';


--
-- Name: COLUMN audit_test_logs.execution_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.execution_id IS 'UUID que agrupa todos los tests de una misma ejecucin';


--
-- Name: COLUMN audit_test_logs.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.status IS 'Estado del test: pending, running, passed, failed, warning, fixed';


--
-- Name: COLUMN audit_test_logs.fix_attempted; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.fix_attempted IS 'Si se intent una reparacin automtica';


--
-- Name: COLUMN audit_test_logs.fix_strategy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.fix_strategy IS 'Estrategia usada: auto_fix, suggest_only, manual';


--
-- Name: COLUMN audit_test_logs.environment; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.environment IS 'local, render, production';


--
-- Name: COLUMN audit_test_logs.triggered_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.triggered_by IS 'manual, scheduled, auto-healing, deploy-hook';


--
-- Name: COLUMN audit_test_logs.severity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.severity IS 'critical, high, medium, low, info';


--
-- Name: COLUMN audit_test_logs.tags; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audit_test_logs.tags IS 'Tags para filtros: critical, auth, biometric, etc.';


--
-- Name: benefit_approval_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_approval_history (
    id integer NOT NULL,
    employee_benefit_id integer NOT NULL,
    workflow_id integer NOT NULL,
    approval_level integer NOT NULL,
    approver_user_id uuid NOT NULL,
    decision character varying(30) NOT NULL,
    decision_date timestamp without time zone,
    decision_notes text,
    notification_sent boolean DEFAULT false,
    notification_sent_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_approval_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_approval_history IS 'Historial de aprobaciones de beneficios';


--
-- Name: COLUMN benefit_approval_history.employee_benefit_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_approval_history.employee_benefit_id IS 'SSOT: employee_benefits.id';


--
-- Name: COLUMN benefit_approval_history.approver_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_approval_history.approver_user_id IS 'SSOT: users.id';


--
-- Name: COLUMN benefit_approval_history.decision; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_approval_history.decision IS 'approved, rejected, pending, timed_out';


--
-- Name: benefit_approval_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_approval_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_approval_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_approval_history_id_seq OWNED BY public.benefit_approval_history.id;


--
-- Name: benefit_approval_workflows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_approval_workflows (
    id integer NOT NULL,
    benefit_type_id integer NOT NULL,
    company_id integer NOT NULL,
    approval_level integer NOT NULL,
    approver_type character varying(30) NOT NULL,
    approver_role_id integer,
    approver_user_id uuid,
    approval_logic character varying(10) DEFAULT 'ALL'::character varying,
    sequence_order integer NOT NULL,
    timeout_days integer DEFAULT 7,
    auto_approve_on_timeout boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_approval_workflows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_approval_workflows IS 'Configuracin de workflows de aprobacin por beneficio y empresa';


--
-- Name: COLUMN benefit_approval_workflows.approver_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_approval_workflows.approver_type IS 'DIRECT_SUPERVISOR, ROLE, SPECIFIC_USER, DEPARTMENT_HEAD, HR_MANAGER';


--
-- Name: COLUMN benefit_approval_workflows.approver_role_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_approval_workflows.approver_role_id IS 'SSOT: roles.id';


--
-- Name: benefit_approval_workflows_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_approval_workflows_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_approval_workflows_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_approval_workflows_id_seq OWNED BY public.benefit_approval_workflows.id;


--
-- Name: benefit_document_requirements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_document_requirements (
    id integer NOT NULL,
    benefit_type_id integer NOT NULL,
    document_type_id integer NOT NULL,
    is_mandatory boolean DEFAULT true,
    requires_renewal boolean DEFAULT false,
    renewal_frequency_months integer,
    validate_on_assignment boolean DEFAULT true,
    validate_on_renewal boolean DEFAULT true,
    alert_days_before_expiration integer DEFAULT 30,
    requirements_description text,
    display_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_document_requirements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_document_requirements IS 'Qu documentos requiere cada tipo de beneficio (SSOT: DMS document_types)';


--
-- Name: COLUMN benefit_document_requirements.benefit_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_document_requirements.benefit_type_id IS 'SSOT: benefit_types.id';


--
-- Name: COLUMN benefit_document_requirements.document_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_document_requirements.document_type_id IS 'SSOT: document_types.id (DMS)';


--
-- Name: benefit_document_requirements_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_document_requirements_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_document_requirements_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_document_requirements_id_seq OWNED BY public.benefit_document_requirements.id;


--
-- Name: benefit_expense_allowances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_expense_allowances (
    id integer NOT NULL,
    employee_benefit_id integer NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    allowance_type character varying(30) NOT NULL,
    max_amount numeric(15,2),
    max_quantity integer,
    consumed_amount numeric(15,2) DEFAULT 0,
    consumed_quantity integer DEFAULT 0,
    auto_renew boolean DEFAULT false,
    status character varying(30) DEFAULT 'active'::character varying,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_expense_allowances; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_expense_allowances IS 'Lmites de gastos para beneficios tipo EXPENSE_ALLOWANCE (pasajes, viticos)';


--
-- Name: COLUMN benefit_expense_allowances.employee_benefit_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_allowances.employee_benefit_id IS 'SSOT: employee_benefits.id';


--
-- Name: COLUMN benefit_expense_allowances.allowance_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_allowances.allowance_type IS 'AMOUNT_BASED, QUANTITY_BASED';


--
-- Name: COLUMN benefit_expense_allowances.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_allowances.status IS 'active, expired, exhausted, cancelled';


--
-- Name: benefit_expense_allowances_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_expense_allowances_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_expense_allowances_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_expense_allowances_id_seq OWNED BY public.benefit_expense_allowances.id;


--
-- Name: benefit_expense_submissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_expense_submissions (
    id integer NOT NULL,
    allowance_id integer NOT NULL,
    user_id uuid NOT NULL,
    expense_type character varying(50),
    description text NOT NULL,
    expense_date date NOT NULL,
    amount numeric(15,2) NOT NULL,
    currency character varying(3) DEFAULT 'ARS'::character varying,
    quantity integer DEFAULT 1,
    supporting_documents jsonb DEFAULT '[]'::jsonb,
    verification_status character varying(30) DEFAULT 'pending'::character varying,
    verified_at timestamp without time zone,
    verified_by uuid,
    verification_notes text,
    reimbursement_status character varying(30) DEFAULT 'pending'::character varying,
    reimbursement_date date,
    reimbursement_amount numeric(15,2),
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    submitted_by uuid
);


--
-- Name: TABLE benefit_expense_submissions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_expense_submissions IS 'Rendiciones de gastos de empleados contra allowances asignados';


--
-- Name: COLUMN benefit_expense_submissions.allowance_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_submissions.allowance_id IS 'SSOT: benefit_expense_allowances.id';


--
-- Name: COLUMN benefit_expense_submissions.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_submissions.user_id IS 'SSOT: users.user_id';


--
-- Name: COLUMN benefit_expense_submissions.supporting_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_submissions.supporting_documents IS 'SSOT: Array de DMS document IDs';


--
-- Name: COLUMN benefit_expense_submissions.verification_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_submissions.verification_status IS 'pending, verified, rejected, reimbursed';


--
-- Name: COLUMN benefit_expense_submissions.reimbursement_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_expense_submissions.reimbursement_status IS 'pending, approved, paid, rejected';


--
-- Name: benefit_expense_submissions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_expense_submissions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_expense_submissions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_expense_submissions_id_seq OWNED BY public.benefit_expense_submissions.id;


--
-- Name: benefit_payroll_concepts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_payroll_concepts (
    id integer NOT NULL,
    benefit_type_id integer NOT NULL,
    payroll_concept_type_id integer NOT NULL,
    company_id integer NOT NULL,
    application_condition character varying(50) NOT NULL,
    fixed_amount numeric(15,2),
    percentage_of_benefit numeric(5,2),
    min_amount numeric(15,2),
    max_amount numeric(15,2),
    auto_apply_in_payroll boolean DEFAULT true,
    require_valid_documents boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_payroll_concepts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_payroll_concepts IS 'Vincula beneficios con conceptos de liquidacin de sueldos';


--
-- Name: COLUMN benefit_payroll_concepts.benefit_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_payroll_concepts.benefit_type_id IS 'SSOT: benefit_types.id';


--
-- Name: COLUMN benefit_payroll_concepts.payroll_concept_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_payroll_concepts.payroll_concept_type_id IS 'SSOT: payroll_concept_types.id (Mdulo Payroll)';


--
-- Name: COLUMN benefit_payroll_concepts.application_condition; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_payroll_concepts.application_condition IS 'BENEFIT_ACTIVE, BENEFIT_ACTIVE_WITH_DOCS, BENEFIT_AMOUNT_BASED, FIXED_AMOUNT';


--
-- Name: benefit_payroll_concepts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_payroll_concepts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_payroll_concepts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_payroll_concepts_id_seq OWNED BY public.benefit_payroll_concepts.id;


--
-- Name: benefit_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.benefit_types (
    id integer NOT NULL,
    code character varying(50) NOT NULL,
    name character varying(150) NOT NULL,
    name_en character varying(150),
    description text,
    category character varying(50) NOT NULL,
    benefit_nature character varying(30) NOT NULL,
    recurrence_period character varying(20),
    requires_approval boolean DEFAULT true,
    approval_levels integer DEFAULT 1,
    requires_documentation boolean DEFAULT false,
    is_taxable boolean DEFAULT true,
    affects_salary_base boolean DEFAULT false,
    has_max_limit boolean DEFAULT false,
    default_max_amount numeric(15,2),
    default_max_quantity integer,
    has_expiration boolean DEFAULT false,
    default_duration_months integer,
    requires_renewal boolean DEFAULT false,
    renewal_advance_days integer DEFAULT 30,
    alert_days_before_expiration integer[] DEFAULT ARRAY[30, 15, 7, 1],
    integrates_with_payroll boolean DEFAULT false,
    payroll_concept_type_id integer,
    icon character varying(50),
    color_hex character varying(7),
    display_order integer DEFAULT 0,
    metadata jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE benefit_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.benefit_types IS 'SSOT: Catlogo de tipos de beneficios y amenities laborales';


--
-- Name: COLUMN benefit_types.benefit_nature; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_types.benefit_nature IS 'RECURRING, ONE_TIME, ASSET_LOAN, EXPENSE_ALLOWANCE';


--
-- Name: COLUMN benefit_types.payroll_concept_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.benefit_types.payroll_concept_type_id IS 'FK a payroll_concept_types (SSOT Payroll)';


--
-- Name: benefit_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.benefit_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: benefit_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.benefit_types_id_seq OWNED BY public.benefit_types.id;


--
-- Name: biometric_ai_analysis; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_ai_analysis (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    template_id uuid,
    emotion_analysis jsonb,
    emotion_confidence numeric(5,4),
    behavior_patterns jsonb,
    behavior_confidence numeric(5,4),
    facial_features jsonb,
    facial_landmarks jsonb,
    health_indicators jsonb,
    fatigue_score numeric(5,4),
    stress_score numeric(5,4),
    processed_at timestamp with time zone DEFAULT now(),
    processing_time_ms integer,
    analysis_version character varying(20) DEFAULT '1.0.0'::character varying,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: biometric_analytics_aggregated; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_analytics_aggregated (
    id integer NOT NULL,
    company_id integer NOT NULL,
    measurement_date date NOT NULL,
    department_id text,
    shift_id text,
    aggregation_level character varying(50) DEFAULT 'department_shift'::character varying,
    sample_size integer DEFAULT 0,
    confidence_score numeric(3,2) DEFAULT 0.80,
    fatigue_level numeric(5,2) DEFAULT 0,
    stress_level numeric(5,2) DEFAULT 0,
    wellbeing_index numeric(5,2) DEFAULT 0,
    emotion_neutral numeric(5,2) DEFAULT 0,
    emotion_happy numeric(5,2) DEFAULT 0,
    emotion_sad numeric(5,2) DEFAULT 0,
    emotion_angry numeric(5,2) DEFAULT 0,
    emotion_surprised numeric(5,2) DEFAULT 0,
    emotion_fearful numeric(5,2) DEFAULT 0,
    emotion_disgusted numeric(5,2) DEFAULT 0,
    emotion_contempt numeric(5,2) DEFAULT 0,
    weather_impact boolean DEFAULT false,
    day_impact boolean DEFAULT false,
    seasonal_impact boolean DEFAULT false,
    holiday_impact boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: biometric_analytics_aggregated_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_analytics_aggregated_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_analytics_aggregated_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_analytics_aggregated_id_seq OWNED BY public.biometric_analytics_aggregated.id;


--
-- Name: biometric_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_audit_log (
    id integer NOT NULL,
    company_id integer NOT NULL,
    template_id integer,
    employee_id text,
    action character varying(50) NOT NULL,
    reason text,
    performed_by text,
    user_name text,
    old_employee_id text,
    new_employee_id text,
    "timestamp" timestamp without time zone DEFAULT now()
);


--
-- Name: biometric_audit_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_audit_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_audit_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_audit_log_id_seq OWNED BY public.biometric_audit_log.id;


--
-- Name: biometric_capture_attempts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_capture_attempts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    kiosk_id integer,
    attempt_number integer NOT NULL,
    "timestamp" timestamp without time zone NOT NULL,
    success boolean DEFAULT false NOT NULL,
    failure_reason character varying(100),
    quality_score integer,
    processing_time_ms integer,
    attendance_id uuid,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: biometric_company_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_company_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    confidence_threshold numeric(4,2) DEFAULT 0.85,
    quality_threshold numeric(4,2) DEFAULT 70.0,
    ai_analysis_enabled boolean DEFAULT true,
    emotion_analysis_enabled boolean DEFAULT true,
    fatigue_detection_enabled boolean DEFAULT true,
    behavior_analysis_enabled boolean DEFAULT false,
    realtime_alerts_enabled boolean DEFAULT true,
    email_reports_enabled boolean DEFAULT false,
    alert_email character varying(255),
    batch_processing_enabled boolean DEFAULT true,
    cache_templates boolean DEFAULT true,
    retention_days integer DEFAULT 90,
    max_devices_per_user integer DEFAULT 3,
    device_registration_required boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE biometric_company_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.biometric_company_config IS 'Configuracin biomtrica especfica por empresa';


--
-- Name: biometric_company_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_company_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_company_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_company_config_id_seq OWNED BY public.biometric_company_config.id;


--
-- Name: biometric_consents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_consents (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    consent_type character varying(50) NOT NULL,
    consent_given boolean NOT NULL,
    consent_date timestamp with time zone DEFAULT now(),
    consent_text text NOT NULL,
    consent_version character varying(20) DEFAULT '1.0'::character varying,
    ip_address character varying(45),
    user_agent text,
    acceptance_method character varying(50),
    revoked boolean DEFAULT false,
    revoked_date timestamp with time zone,
    revoked_reason text,
    revoked_ip_address character varying(45),
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    consent_document_hash character varying(64),
    consent_document_url text,
    consent_token uuid,
    consent_token_expires_at timestamp without time zone,
    consent_email_sent_at timestamp without time zone,
    consent_link_accessed_at timestamp without time zone,
    consent_link_access_count integer DEFAULT 0,
    consent_response_timestamp timestamp without time zone,
    consent_response_hash character varying(64),
    consent_geolocation jsonb,
    device_fingerprint text,
    biometric_validation_hash character varying(64),
    biometric_validation_image_url text,
    biometric_validation_confidence numeric(5,2),
    email_thread jsonb,
    immutable_signature character varying(128),
    signature_algorithm character varying(20) DEFAULT 'HMAC-SHA256'::character varying,
    branch_id integer,
    country_id integer,
    country_code character varying(3),
    invalidated_reason character varying(255),
    invalidated_at timestamp without time zone,
    previous_consent_id integer
);


--
-- Name: biometric_consents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_consents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_consents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_consents_id_seq OWNED BY public.biometric_consents.id;


--
-- Name: biometric_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_data (
    id uuid NOT NULL,
    type public.enum_biometric_data_type NOT NULL,
    "fingerIndex" integer,
    template text NOT NULL,
    quality integer DEFAULT 0,
    algorithm character varying(255) DEFAULT 'default'::character varying,
    "isActive" boolean DEFAULT true,
    "createdBy" uuid,
    "lastUsed" timestamp with time zone,
    "usageCount" integer DEFAULT 0,
    "deviceId" character varying(255),
    notes text,
    "UserId" uuid NOT NULL,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    user_id uuid
);


--
-- Name: biometric_detections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_detections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    employee_name character varying(255) NOT NULL,
    similarity numeric(5,3) NOT NULL,
    quality_score numeric(5,3),
    was_registered boolean DEFAULT false NOT NULL,
    attendance_id uuid,
    operation_type character varying(20),
    skip_reason character varying(100),
    detection_timestamp timestamp with time zone DEFAULT now() NOT NULL,
    processing_time_ms integer,
    kiosk_mode boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: biometric_devices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_devices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    device_id character varying(255) NOT NULL,
    device_name character varying(255),
    device_type character varying(50) DEFAULT 'mobile'::character varying,
    os_info character varying(255),
    app_version character varying(50),
    hardware_info jsonb,
    is_active boolean DEFAULT true,
    last_seen timestamp without time zone,
    registration_date timestamp without time zone DEFAULT now(),
    allow_registration boolean DEFAULT true,
    allow_verification boolean DEFAULT true,
    allow_monitoring boolean DEFAULT false,
    location_name character varying(255),
    location_coordinates jsonb,
    registered_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE biometric_devices; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.biometric_devices IS 'Dispositivos registrados para captura biomtrica';


--
-- Name: biometric_emotional_analysis; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_emotional_analysis (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    scan_timestamp timestamp with time zone DEFAULT now(),
    emotion_anger numeric(5,4),
    emotion_contempt numeric(5,4),
    emotion_disgust numeric(5,4),
    emotion_fear numeric(5,4),
    emotion_happiness numeric(5,4),
    emotion_neutral numeric(5,4),
    emotion_sadness numeric(5,4),
    emotion_surprise numeric(5,4),
    dominant_emotion character varying(20),
    emotional_valence numeric(5,4),
    emotional_arousal numeric(5,4),
    eye_occlusion_left numeric(5,4),
    eye_occlusion_right numeric(5,4),
    head_pose_pitch numeric(6,2),
    head_pose_roll numeric(6,2),
    head_pose_yaw numeric(6,2),
    smile_intensity numeric(5,4),
    fatigue_score numeric(5,4),
    has_glasses boolean,
    glasses_type character varying(20),
    facial_hair_moustache numeric(5,4),
    facial_hair_beard numeric(5,4),
    facial_hair_sideburns numeric(5,4),
    estimated_age integer,
    time_of_day character varying(20),
    day_of_week integer,
    stress_score numeric(5,4),
    wellness_score integer,
    processing_time_ms integer,
    data_source character varying(50) DEFAULT 'azure-face-api'::character varying,
    azure_face_id character varying(255),
    quality_score numeric(5,4),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT biometric_emotional_analysis_day_of_week_check CHECK (((day_of_week >= 0) AND (day_of_week <= 6))),
    CONSTRAINT biometric_emotional_analysis_emotion_anger_check CHECK (((emotion_anger >= (0)::numeric) AND (emotion_anger <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_contempt_check CHECK (((emotion_contempt >= (0)::numeric) AND (emotion_contempt <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_disgust_check CHECK (((emotion_disgust >= (0)::numeric) AND (emotion_disgust <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_fear_check CHECK (((emotion_fear >= (0)::numeric) AND (emotion_fear <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_happiness_check CHECK (((emotion_happiness >= (0)::numeric) AND (emotion_happiness <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_neutral_check CHECK (((emotion_neutral >= (0)::numeric) AND (emotion_neutral <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_sadness_check CHECK (((emotion_sadness >= (0)::numeric) AND (emotion_sadness <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_emotion_surprise_check CHECK (((emotion_surprise >= (0)::numeric) AND (emotion_surprise <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_estimated_age_check CHECK (((estimated_age >= 0) AND (estimated_age <= 120))),
    CONSTRAINT biometric_emotional_analysis_eye_occlusion_left_check CHECK (((eye_occlusion_left >= (0)::numeric) AND (eye_occlusion_left <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_eye_occlusion_right_check CHECK (((eye_occlusion_right >= (0)::numeric) AND (eye_occlusion_right <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_fatigue_score_check CHECK (((fatigue_score >= (0)::numeric) AND (fatigue_score <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_smile_intensity_check CHECK (((smile_intensity >= (0)::numeric) AND (smile_intensity <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_stress_score_check CHECK (((stress_score >= (0)::numeric) AND (stress_score <= (1)::numeric))),
    CONSTRAINT biometric_emotional_analysis_wellness_score_check CHECK (((wellness_score >= 0) AND (wellness_score <= 100)))
);


--
-- Name: biometric_emotional_analysis_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_emotional_analysis_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_emotional_analysis_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_emotional_analysis_id_seq OWNED BY public.biometric_emotional_analysis.id;


--
-- Name: biometric_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_events (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    company_id integer NOT NULL,
    event_type character varying(50) NOT NULL,
    biometric_type character varying(20) NOT NULL,
    success boolean NOT NULL,
    confidence_score numeric(5,2),
    device_id character varying(255),
    device_location character varying(255),
    "timestamp" timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    metadata jsonb
);


--
-- Name: users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.users (
    user_id uuid NOT NULL,
    "employeeId" character varying(255) NOT NULL,
    "firstName" character varying(255) NOT NULL,
    "lastName" character varying(255) NOT NULL,
    email character varying(255) NOT NULL,
    dni character varying(20) NOT NULL,
    phone character varying(255),
    password character varying(255) NOT NULL,
    role public.enum_users_role DEFAULT 'employee'::public.enum_users_role,
    "position" character varying(255),
    salary numeric(10,2),
    "hireDate" date,
    "birthDate" date,
    address text,
    "emergencyContact" character varying(255),
    "emergencyPhone" character varying(255),
    "allowOutsideRadius" boolean DEFAULT false NOT NULL,
    "convenioColectivo" character varying(200),
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    company_id integer,
    is_active boolean DEFAULT true,
    whatsapp_number character varying(20),
    accepts_support_packages boolean DEFAULT true,
    accepts_auctions boolean DEFAULT true,
    accepts_email_notifications boolean DEFAULT true,
    accepts_whatsapp_notifications boolean DEFAULT true,
    accepts_sms_notifications boolean DEFAULT true,
    communication_consent_date timestamp with time zone,
    global_rating numeric(3,2),
    cbu character varying(22),
    bank_name character varying(100),
    notes text,
    usuario character varying(50),
    department_id bigint,
    default_branch_id uuid,
    birth_date date,
    cuil character varying(15),
    emergency_contact jsonb,
    work_schedule jsonb DEFAULT '{}'::jsonb,
    last_login timestamp with time zone,
    failed_login_attempts integer DEFAULT 0,
    locked_until timestamp with time zone,
    password_reset_token character varying(255),
    password_reset_expires timestamp with time zone,
    two_factor_enabled boolean DEFAULT false,
    two_factor_secret character varying(255),
    permissions jsonb DEFAULT '{}'::jsonb,
    settings jsonb DEFAULT '{}'::jsonb,
    has_fingerprint boolean DEFAULT false,
    has_facial_data boolean DEFAULT false,
    biometric_last_updated timestamp with time zone,
    gps_enabled boolean DEFAULT false,
    allowed_locations jsonb DEFAULT '[]'::jsonb,
    concurrent_sessions integer DEFAULT 0,
    last_activity timestamp with time zone,
    display_name character varying(255),
    vendor_code character varying(20),
    version integer DEFAULT 1,
    biometric_enrolled boolean DEFAULT false,
    biometric_templates_count integer DEFAULT 0,
    last_biometric_scan timestamp without time zone,
    biometric_quality_avg numeric(4,2),
    ai_analysis_enabled boolean DEFAULT true,
    fatigue_monitoring boolean DEFAULT false,
    emotion_monitoring boolean DEFAULT false,
    biometric_notes text,
    can_authorize_late_arrivals boolean DEFAULT false NOT NULL,
    authorized_departments jsonb DEFAULT '[]'::jsonb,
    notification_preference_late_arrivals character varying(20) DEFAULT 'email'::character varying,
    can_use_mobile_app boolean DEFAULT true NOT NULL,
    can_use_kiosk boolean DEFAULT true NOT NULL,
    can_use_all_kiosks boolean DEFAULT false NOT NULL,
    authorized_kiosks jsonb DEFAULT '[]'::jsonb,
    has_flexible_schedule boolean DEFAULT false NOT NULL,
    flexible_schedule_notes text,
    legajo character varying(50),
    "isActive" boolean DEFAULT true,
    biometric_photo_url text,
    biometric_photo_date timestamp without time zone,
    biometric_photo_expiration timestamp without time zone,
    email_verified boolean DEFAULT false,
    email_verified_at timestamp without time zone,
    pending_consents uuid[] DEFAULT '{}'::uuid[],
    verification_pending boolean DEFAULT true NOT NULL,
    account_status public.user_account_status DEFAULT 'pending_verification'::public.user_account_status NOT NULL,
    secondary_phone character varying(20),
    home_phone character varying(20),
    city character varying(100),
    province character varying(100),
    postal_code character varying(10),
    neighborhood character varying(100),
    street character varying(255),
    street_number character varying(20),
    floor_apt character varying(20),
    health_insurance_provider character varying(255),
    health_insurance_plan character varying(255),
    health_insurance_number character varying(100),
    health_insurance_expiry date,
    branch_id uuid,
    additional_roles jsonb DEFAULT '[]'::jsonb,
    branch_scope jsonb,
    is_core_user boolean DEFAULT false,
    force_password_change boolean DEFAULT false,
    password_changed_at timestamp without time zone,
    core_user_created_at timestamp without time zone,
    onboarding_trace_id character varying(100),
    sector_id integer,
    salary_category_id integer,
    organizational_position_id integer,
    street_address character varying(255),
    country character varying(100) DEFAULT 'Argentina'::character varying,
    address_latitude numeric(10,8),
    address_longitude numeric(11,8),
    residence_type character varying(20) DEFAULT 'own'::character varying,
    housing_type character varying(20) DEFAULT 'apartment'::character varying,
    residence_since date,
    previous_moves_5years integer DEFAULT 0,
    household_size integer DEFAULT 1,
    dependents_count integer DEFAULT 0,
    lives_alone boolean DEFAULT false,
    has_vehicle boolean DEFAULT false,
    vehicle_type character varying(50),
    commute_method character varying(50),
    commute_time_minutes integer,
    CONSTRAINT core_user_must_be_admin CHECK (((is_core_user = false) OR ((is_core_user = true) AND (role = 'admin'::public.enum_users_role)))),
    CONSTRAINT core_user_usuario_must_be_administrador CHECK (((is_core_user = false) OR ((is_core_user = true) AND ((usuario)::text = 'administrador'::text)))),
    CONSTRAINT users_notification_preference_late_arrivals_check CHECK (((notification_preference_late_arrivals)::text = ANY ((ARRAY['email'::character varying, 'whatsapp'::character varying, 'both'::character varying])::text[])))
);


--
-- Name: TABLE users; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.users IS 'Tabla de usuarios SOLO para empresas clientes. Staff de Aponnt usa tabla aponnt_staff separada.';


--
-- Name: COLUMN users.dni; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.dni IS 'Documento Nacional de Identidad nico';


--
-- Name: COLUMN users."allowOutsideRadius"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users."allowOutsideRadius" IS 'Permite al usuario fichar fuera del radio GPS del departamento';


--
-- Name: COLUMN users."convenioColectivo"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users."convenioColectivo" IS 'Convenio Colectivo de Trabajo aplicable al empleado';


--
-- Name: COLUMN users.biometric_enrolled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_enrolled IS 'Indica si el usuario tiene biometra registrada';


--
-- Name: COLUMN users.biometric_templates_count; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_templates_count IS 'Nmero de templates biomtricos registrados';


--
-- Name: COLUMN users.last_biometric_scan; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.last_biometric_scan IS 'ltima vez que se escane biomtricamente';


--
-- Name: COLUMN users.biometric_quality_avg; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_quality_avg IS 'Calidad promedio de templates (0-100)';


--
-- Name: COLUMN users.ai_analysis_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.ai_analysis_enabled IS 'Si est habilitado el anlisis IA para este usuario';


--
-- Name: COLUMN users.fatigue_monitoring; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.fatigue_monitoring IS 'Si est habilitado el monitoreo de fatiga';


--
-- Name: COLUMN users.emotion_monitoring; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.emotion_monitoring IS 'Si est habilitado el monitoreo emocional';


--
-- Name: COLUMN users.biometric_notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_notes IS 'Notas sobre configuracin biomtrica del usuario';


--
-- Name: COLUMN users.can_authorize_late_arrivals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.can_authorize_late_arrivals IS 'Indica si el usuario puede autorizar llegadas fuera de tolerancia';


--
-- Name: COLUMN users.authorized_departments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.authorized_departments IS 'Array de department_ids que este usuario puede autorizar (ej: [1,3,5])';


--
-- Name: COLUMN users.notification_preference_late_arrivals; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.notification_preference_late_arrivals IS 'Canal preferido para recibir notificaciones de autorizacin';


--
-- Name: COLUMN users.can_use_mobile_app; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.can_use_mobile_app IS 'Permite al empleado usar app mvil para fichar';


--
-- Name: COLUMN users.can_use_kiosk; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.can_use_kiosk IS 'Permite al empleado usar kioscos fsicos';


--
-- Name: COLUMN users.can_use_all_kiosks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.can_use_all_kiosks IS 'Si true, puede usar cualquier kiosko de la empresa';


--
-- Name: COLUMN users.authorized_kiosks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.authorized_kiosks IS 'Array JSON de IDs de kiosks autorizados para este empleado';


--
-- Name: COLUMN users.has_flexible_schedule; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.has_flexible_schedule IS 'Si true, puede fichar sin restricciones de horario';


--
-- Name: COLUMN users.biometric_photo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_photo_url IS 'URL de la foto visible capturada durante el registro biomtrico';


--
-- Name: COLUMN users.biometric_photo_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_photo_date IS 'Fecha de captura de la foto biomtrica';


--
-- Name: COLUMN users.biometric_photo_expiration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.biometric_photo_expiration IS 'Fecha de vencimiento de la foto biomtrica (renovacin anual)';


--
-- Name: COLUMN users.email_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.email_verified IS 'Indica si el email del usuario ha sido verificado';


--
-- Name: COLUMN users.email_verified_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.email_verified_at IS 'Fecha y hora de verificacin del email';


--
-- Name: COLUMN users.pending_consents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.pending_consents IS 'Array de consent_ids pendientes de aceptacin';


--
-- Name: COLUMN users.verification_pending; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.verification_pending IS 'Indica si el usuario est pendiente de verificacin de email';


--
-- Name: COLUMN users.account_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.account_status IS 'Estado de la cuenta del usuario';


--
-- Name: COLUMN users.secondary_phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.secondary_phone IS 'Telfono secundario del empleado';


--
-- Name: COLUMN users.home_phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.home_phone IS 'Telfono fijo del empleado';


--
-- Name: COLUMN users.city; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.city IS 'Ciudad';


--
-- Name: COLUMN users.province; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.province IS 'Provincia o estado';


--
-- Name: COLUMN users.postal_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.postal_code IS 'Cdigo postal';


--
-- Name: COLUMN users.neighborhood; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.neighborhood IS 'Barrio';


--
-- Name: COLUMN users.street; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.street IS 'Calle (extrado de address)';


--
-- Name: COLUMN users.street_number; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.street_number IS 'Nmero de calle';


--
-- Name: COLUMN users.floor_apt; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.floor_apt IS 'Piso y departamento';


--
-- Name: COLUMN users.health_insurance_provider; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.health_insurance_provider IS 'Obra social o prepaga (ej: OSDE, Swiss Medical, IOMA)';


--
-- Name: COLUMN users.health_insurance_plan; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.health_insurance_plan IS 'Plan especfico (ej: OSDE 210, Swiss Medical SMG11)';


--
-- Name: COLUMN users.health_insurance_number; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.health_insurance_number IS 'Nmero de afiliado';


--
-- Name: COLUMN users.health_insurance_expiry; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.health_insurance_expiry IS ' VENCIMIENTO - Fecha de vencimiento de la credencial (requiere sistema de alertas)';


--
-- Name: COLUMN users.branch_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.branch_id IS 'Sucursal a la que pertenece el usuario (NULL = sin sucursal especfica)';


--
-- Name: COLUMN users.branch_scope; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.branch_scope IS 'Array de branch_ids a los que el usuario tiene acceso. NULL = todas las sucursales (gerente general). Ejemplo: [1, 2, 5]';


--
-- Name: COLUMN users.is_core_user; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.is_core_user IS 'TRUE si es el usuario CORE inmutable creado automticamente al alta (usuario: administrador, role: admin)';


--
-- Name: COLUMN users.force_password_change; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.force_password_change IS 'TRUE si debe cambiar password en prximo login (comn en usuario CORE recin creado)';


--
-- Name: COLUMN users.password_changed_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.password_changed_at IS 'Fecha y hora del ltimo cambio de password';


--
-- Name: COLUMN users.core_user_created_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.core_user_created_at IS 'Fecha de creacin del usuario CORE (solo para is_core_user = TRUE)';


--
-- Name: COLUMN users.onboarding_trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.onboarding_trace_id IS 'Trace ID del proceso de onboarding que cre este usuario CORE';


--
-- Name: COLUMN users.organizational_position_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.organizational_position_id IS 'FK a organizational_positions - SSOT para puesto/cargo del empleado';


--
-- Name: COLUMN users.street_address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.street_address IS 'Calle y nmero de la direccin';


--
-- Name: COLUMN users.country; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.country IS 'Pas';


--
-- Name: COLUMN users.residence_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.residence_type IS 'Tipo de tenencia: own, rent, family, shared, employer, temporary, other';


--
-- Name: COLUMN users.housing_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.housing_type IS 'Tipo de vivienda: house, apartment, duplex, studio, room, farm, mobile, other';


--
-- Name: COLUMN users.residence_since; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.residence_since IS 'Fecha desde la que reside en la direccin actual';


--
-- Name: COLUMN users.household_size; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.household_size IS 'Cantidad total de personas en el hogar';


--
-- Name: COLUMN users.dependents_count; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.dependents_count IS 'Cantidad de personas que dependen econmicamente del empleado';


--
-- Name: COLUMN users.commute_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.users.commute_method IS 'Mtodo de transporte al trabajo: car, public, bike, walk, motorcycle, remote';


--
-- Name: biometric_photos_stats; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.biometric_photos_stats AS
 SELECT count(*) FILTER (WHERE (biometric_photo_url IS NOT NULL)) AS total_with_photo,
    count(*) FILTER (WHERE (biometric_photo_url IS NULL)) AS total_without_photo,
    count(*) FILTER (WHERE (biometric_photo_expiration < now())) AS total_expired,
    count(*) FILTER (WHERE ((biometric_photo_expiration IS NOT NULL) AND (biometric_photo_expiration <= (now() + '30 days'::interval)) AND (biometric_photo_expiration > now()))) AS total_expiring_soon,
    count(*) FILTER (WHERE ((biometric_photo_expiration IS NOT NULL) AND (biometric_photo_expiration > (now() + '30 days'::interval)))) AS total_valid
   FROM public.users
  WHERE ("isActive" = true);


--
-- Name: VIEW biometric_photos_stats; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.biometric_photos_stats IS 'Estadsticas globales de fotos biomtricas (con foto, sin foto, vencidas, prximas a vencer, vlidas)';


--
-- Name: biometric_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    face_recognition_enabled boolean DEFAULT true,
    fingerprint_enabled boolean DEFAULT true,
    iris_enabled boolean DEFAULT false,
    voice_enabled boolean DEFAULT false,
    min_confidence_threshold numeric(5,2) DEFAULT 85.0,
    max_attempts integer DEFAULT 3,
    template_update_interval integer DEFAULT 30,
    settings jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: biometric_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.biometric_templates (
    id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id character varying(255) NOT NULL,
    embedding_encrypted text NOT NULL,
    embedding_hash character varying(64) NOT NULL,
    algorithm character varying(50) DEFAULT 'face-api-js-v0.22.2'::character varying NOT NULL,
    model_version character varying(50) DEFAULT 'faceRecognitionNet'::character varying NOT NULL,
    template_version character varying(20) DEFAULT '1.0.0'::character varying NOT NULL,
    quality_score numeric(5,3) NOT NULL,
    confidence_score numeric(5,3) NOT NULL,
    face_size_ratio numeric(5,3),
    position_score numeric(5,3),
    lighting_score numeric(5,3),
    is_primary boolean DEFAULT false,
    is_active boolean DEFAULT true,
    is_validated boolean DEFAULT false,
    match_count integer DEFAULT 0,
    last_matched timestamp without time zone,
    capture_session_id character varying(100),
    capture_timestamp timestamp without time zone DEFAULT now() NOT NULL,
    encryption_algorithm character varying(50) DEFAULT 'AES-256-CBC'::character varying NOT NULL,
    encryption_key_version character varying(20) DEFAULT '1.0'::character varying NOT NULL,
    created_by integer,
    gdpr_consent boolean DEFAULT false NOT NULL,
    retention_expires timestamp without time zone,
    embedding_magnitude numeric(10,6),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT biometric_templates_confidence_score_check CHECK (((confidence_score >= 0.0) AND (confidence_score <= 1.0))),
    CONSTRAINT biometric_templates_face_size_ratio_check CHECK (((face_size_ratio >= 0.0) AND (face_size_ratio <= 1.0))),
    CONSTRAINT biometric_templates_lighting_score_check CHECK (((lighting_score >= 0.0) AND (lighting_score <= 1.0))),
    CONSTRAINT biometric_templates_position_score_check CHECK (((position_score >= 0.0) AND (position_score <= 1.0))),
    CONSTRAINT biometric_templates_quality_score_check CHECK (((quality_score >= 0.0) AND (quality_score <= 1.0)))
);


--
-- Name: biometric_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.biometric_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: biometric_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.biometric_templates_id_seq OWNED BY public.biometric_templates.id;


--
-- Name: branch_offices_fiscal; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.branch_offices_fiscal (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_office_id integer,
    nombre character varying(255) NOT NULL,
    codigo character varying(50),
    punto_venta integer NOT NULL,
    punto_venta_descripcion character varying(255),
    domicilio_fiscal character varying(500) NOT NULL,
    codigo_postal character varying(10),
    localidad character varying(100),
    provincia character varying(100),
    pais character varying(100) DEFAULT 'Argentina'::character varying,
    comprobantes_habilitados jsonb DEFAULT '[]'::jsonb,
    ultimo_numero_factura_a integer DEFAULT 0,
    ultimo_numero_factura_b integer DEFAULT 0,
    ultimo_numero_factura_c integer DEFAULT 0,
    ultimo_numero_nc_a integer DEFAULT 0,
    ultimo_numero_nc_b integer DEFAULT 0,
    ultimo_numero_nc_c integer DEFAULT 0,
    ultimo_numero_nd_a integer DEFAULT 0,
    ultimo_numero_nd_b integer DEFAULT 0,
    ultimo_numero_nd_c integer DEFAULT 0,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT valid_punto_venta CHECK (((punto_venta > 0) AND (punto_venta <= 9999)))
);


--
-- Name: branch_offices_fiscal_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.branch_offices_fiscal_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: branch_offices_fiscal_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.branch_offices_fiscal_id_seq OWNED BY public.branch_offices_fiscal.id;


--
-- Name: branches; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.branches (
    id uuid NOT NULL,
    name character varying(255) NOT NULL,
    code character varying(255),
    address text,
    phone character varying(255),
    email character varying(255),
    latitude numeric(10,8),
    longitude numeric(11,8),
    radius integer DEFAULT 50,
    "isActive" boolean DEFAULT true,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    company_id integer,
    country character varying(100),
    state_province character varying(100),
    postal_code character varying(20),
    city character varying(100),
    timezone character varying(50) DEFAULT 'America/Argentina/Buenos_Aires'::character varying,
    is_main boolean DEFAULT false
);


--
-- Name: COLUMN branches.country; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.branches.country IS 'Pas de la sucursal (ej: Argentina, Chile, Bolivia)';


--
-- Name: COLUMN branches.state_province; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.branches.state_province IS 'Provincia/Estado de la sucursal (ej: Buenos Aires, Santiago)';


--
-- Name: branches_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.branches_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: budgets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.budgets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trace_id character varying(100) NOT NULL,
    company_id integer NOT NULL,
    vendor_id uuid NOT NULL,
    budget_code character varying(50) NOT NULL,
    budget_date date DEFAULT CURRENT_DATE NOT NULL,
    valid_until date NOT NULL,
    selected_modules jsonb NOT NULL,
    contracted_employees integer NOT NULL,
    price_per_employee numeric(10,2) NOT NULL,
    subtotal numeric(12,2) NOT NULL,
    total_monthly numeric(12,2) NOT NULL,
    client_contact_name character varying(255) NOT NULL,
    client_contact_email character varying(255) NOT NULL,
    client_contact_phone character varying(50),
    status character varying(50) DEFAULT 'PENDING'::character varying NOT NULL,
    sent_at timestamp without time zone,
    viewed_at timestamp without time zone,
    accepted_at timestamp without time zone,
    rejected_at timestamp without time zone,
    rejection_reason text,
    notes text,
    payment_method character varying(50) DEFAULT 'TRANSFERENCIA'::character varying,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT budgets_contracted_employees_check CHECK ((contracted_employees > 0)),
    CONSTRAINT valid_dates CHECK ((valid_until > budget_date)),
    CONSTRAINT valid_status CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'SENT'::character varying, 'VIEWED'::character varying, 'ACCEPTED'::character varying, 'REJECTED'::character varying, 'EXPIRED'::character varying, 'CANCELLED'::character varying])::text[])))
);


--
-- Name: TABLE budgets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.budgets IS 'Presupuestos para onboarding de empresas (Workflow altaEmpresa - FASE 1)';


--
-- Name: COLUMN budgets.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.trace_id IS 'ID nico de trazabilidad del workflow completo (ONBOARDING-{UUID})';


--
-- Name: COLUMN budgets.budget_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.budget_code IS 'Cdigo legible del presupuesto (PPTO-YYYY-NNNN)';


--
-- Name: COLUMN budgets.valid_until; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.valid_until IS 'Fecha de expiracin (30 das desde creacin)';


--
-- Name: COLUMN budgets.selected_modules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.selected_modules IS 'Array JSON de mdulos seleccionados con pricing';


--
-- Name: COLUMN budgets.total_monthly; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.total_monthly IS 'Total mensual = SUM(mdulos base_price)  empleados';


--
-- Name: COLUMN budgets.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.budgets.status IS 'Estado: PENDING, SENT, VIEWED, ACCEPTED, REJECTED, EXPIRED, CANCELLED';


--
-- Name: business_validations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.business_validations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    department_id integer,
    validation_code character varying(50) NOT NULL,
    validation_name character varying(100) NOT NULL,
    validation_type character varying(30) NOT NULL,
    validation_params jsonb NOT NULL,
    severity character varying(20) DEFAULT 'error'::character varying,
    auto_reject boolean DEFAULT false,
    error_message text,
    active boolean DEFAULT true
);


--
-- Name: business_validations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.business_validations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: business_validations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.business_validations_id_seq OWNED BY public.business_validations.id;


--
-- Name: calendar_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.calendar_events (
    id integer NOT NULL,
    calendar_integration_id integer,
    notification_group_id uuid,
    employee_id character varying(100) NOT NULL,
    event_type character varying(50),
    external_event_id character varying(255),
    event_start timestamp without time zone NOT NULL,
    event_end timestamp without time zone NOT NULL,
    event_title character varying(255),
    synced_at timestamp without time zone DEFAULT now(),
    last_updated timestamp without time zone
);


--
-- Name: calendar_events_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.calendar_events_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: calendar_events_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.calendar_events_id_seq OWNED BY public.calendar_events.id;


--
-- Name: calendar_integrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.calendar_integrations (
    id integer NOT NULL,
    employee_id character varying(100) NOT NULL,
    calendar_provider character varying(20),
    access_token text,
    refresh_token text,
    calendar_id character varying(255),
    sync_enabled boolean DEFAULT true,
    last_sync timestamp without time zone,
    sync_errors jsonb
);


--
-- Name: calendar_integrations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.calendar_integrations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: calendar_integrations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.calendar_integrations_id_seq OWNED BY public.calendar_integrations.id;


--
-- Name: chronic_conditions_catalog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.chronic_conditions_catalog (
    id integer NOT NULL,
    code character varying(20) NOT NULL,
    name character varying(200) NOT NULL,
    category character varying(100),
    description text,
    severity_default character varying(20) DEFAULT 'moderate'::character varying,
    requires_medication boolean DEFAULT false,
    requires_monitoring boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE chronic_conditions_catalog; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.chronic_conditions_catalog IS 'Catlogo de enfermedades crnicas comunes';


--
-- Name: chronic_conditions_catalog_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.chronic_conditions_catalog_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: chronic_conditions_catalog_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.chronic_conditions_catalog_id_seq OWNED BY public.chronic_conditions_catalog.id;


--
-- Name: commission_liquidations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commission_liquidations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trace_id character varying(100) NOT NULL,
    invoice_id uuid,
    company_id integer NOT NULL,
    liquidation_type character varying(50) NOT NULL,
    liquidation_code character varying(50) NOT NULL,
    liquidation_date date DEFAULT CURRENT_DATE NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    invoice_amount numeric(12,2) NOT NULL,
    invoice_number character varying(100),
    invoice_date date,
    total_commissionable numeric(12,2) NOT NULL,
    total_commission_amount numeric(12,2) NOT NULL,
    commission_breakdown jsonb NOT NULL,
    status character varying(50) DEFAULT 'CALCULATED'::character varying NOT NULL,
    approved_by uuid,
    approved_at timestamp without time zone,
    rejection_reason text,
    payment_batch_id uuid,
    payment_scheduled_date date,
    payment_executed_date date,
    payment_method character varying(50) DEFAULT 'TRANSFERENCIA'::character varying,
    notes text,
    source character varying(50) DEFAULT 'SYSTEM'::character varying,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT approved_if_paid CHECK ((((status)::text <> 'PAID'::text) OR (((status)::text = 'PAID'::text) AND (approved_at IS NOT NULL)))),
    CONSTRAINT valid_liquidation_status CHECK (((status)::text = ANY ((ARRAY['CALCULATED'::character varying, 'APPROVED'::character varying, 'REJECTED'::character varying, 'PAYMENT_PENDING'::character varying, 'PAYMENT_IN_PROGRESS'::character varying, 'PAID'::character varying, 'CANCELLED'::character varying])::text[]))),
    CONSTRAINT valid_liquidation_type CHECK (((liquidation_type)::text = ANY ((ARRAY['ONBOARDING_IMMEDIATE'::character varying, 'MONTHLY'::character varying])::text[]))),
    CONSTRAINT valid_period CHECK ((period_end >= period_start))
);


--
-- Name: TABLE commission_liquidations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commission_liquidations IS 'Liquidaciones de comisiones inmediatas o mensuales (Workflow altaEmpresa - FASE 5)';


--
-- Name: COLUMN commission_liquidations.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_liquidations.trace_id IS 'ID nico de trazabilidad (COMMISSION-{UUID})';


--
-- Name: COLUMN commission_liquidations.liquidation_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_liquidations.liquidation_type IS 'Tipo: ONBOARDING_IMMEDIATE (alta empresa) o MONTHLY (ciclo mensual)';


--
-- Name: COLUMN commission_liquidations.commission_breakdown; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_liquidations.commission_breakdown IS 'Array JSONB con breakdown de comisiones por vendedor (directas + piramidales)';


--
-- Name: COLUMN commission_liquidations.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_liquidations.status IS 'Estado: CALCULATED, APPROVED, PAYMENT_PENDING, PAID, CANCELLED';


--
-- Name: commission_payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.commission_payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trace_id character varying(100) NOT NULL,
    liquidation_id uuid NOT NULL,
    vendor_id uuid NOT NULL,
    company_id integer NOT NULL,
    payment_code character varying(50) NOT NULL,
    payment_date date DEFAULT CURRENT_DATE NOT NULL,
    commission_amount numeric(12,2) NOT NULL,
    tax_withholding numeric(12,2) DEFAULT 0.00,
    net_amount numeric(12,2) NOT NULL,
    commission_type character varying(50) NOT NULL,
    commission_percentage numeric(5,2) NOT NULL,
    payment_method character varying(50) DEFAULT 'TRANSFERENCIA'::character varying NOT NULL,
    bank_name character varying(255),
    account_type character varying(50),
    account_number character varying(100),
    cbu character varying(22),
    alias character varying(100),
    wallet_provider character varying(100),
    wallet_account character varying(255),
    status character varying(50) DEFAULT 'PENDING'::character varying NOT NULL,
    scheduled_date date,
    executed_date date,
    confirmation_code character varying(100),
    transaction_id character varying(255),
    failure_reason text,
    failure_date timestamp without time zone,
    retry_count integer DEFAULT 0,
    last_retry_at timestamp without time zone,
    reconciled boolean DEFAULT false,
    reconciled_at timestamp without time zone,
    reconciled_by uuid,
    receipt_url character varying(500),
    receipt_generated_at timestamp without time zone,
    notification_sent boolean DEFAULT false,
    notification_sent_at timestamp without time zone,
    notes text,
    payment_batch_id uuid,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT bank_data_if_transfer CHECK ((((payment_method)::text <> 'TRANSFERENCIA'::text) OR (((payment_method)::text = 'TRANSFERENCIA'::text) AND ((cbu IS NOT NULL) OR (account_number IS NOT NULL))))),
    CONSTRAINT commission_payments_commission_amount_check CHECK ((commission_amount > (0)::numeric)),
    CONSTRAINT valid_commission_type CHECK (((commission_type)::text = ANY ((ARRAY['DIRECT_SALES'::character varying, 'PYRAMID_L1'::character varying, 'PYRAMID_L2'::character varying, 'PYRAMID_L3'::character varying, 'PYRAMID_L4'::character varying, 'SUPPORT_TEMPORARY'::character varying])::text[]))),
    CONSTRAINT valid_net_amount CHECK ((net_amount = (commission_amount - tax_withholding))),
    CONSTRAINT valid_payment_method CHECK (((payment_method)::text = ANY ((ARRAY['TRANSFERENCIA'::character varying, 'VIRTUAL_WALLET'::character varying, 'CHEQUE'::character varying, 'EFECTIVO'::character varying])::text[]))),
    CONSTRAINT valid_payment_status CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'SCHEDULED'::character varying, 'IN_PROCESS'::character varying, 'COMPLETED'::character varying, 'FAILED'::character varying, 'CANCELLED'::character varying, 'REFUNDED'::character varying])::text[]))),
    CONSTRAINT wallet_data_if_wallet CHECK ((((payment_method)::text <> 'VIRTUAL_WALLET'::text) OR (((payment_method)::text = 'VIRTUAL_WALLET'::text) AND (wallet_provider IS NOT NULL) AND (wallet_account IS NOT NULL))))
);


--
-- Name: TABLE commission_payments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.commission_payments IS 'Pagos individuales de comisiones a vendedores (Workflow altaEmpresa - FASE 5)';


--
-- Name: COLUMN commission_payments.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_payments.trace_id IS 'ID nico de trazabilidad (PAYMENT-{UUID})';


--
-- Name: COLUMN commission_payments.commission_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_payments.commission_type IS 'Tipo: DIRECT_SALES, PYRAMID_L1-L4, SUPPORT_TEMPORARY';


--
-- Name: COLUMN commission_payments.payment_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_payments.payment_method IS 'Mtodo: TRANSFERENCIA, VIRTUAL_WALLET, CHEQUE, EFECTIVO';


--
-- Name: COLUMN commission_payments.cbu; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_payments.cbu IS 'CBU de Argentina (22 dgitos)';


--
-- Name: COLUMN commission_payments.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.commission_payments.status IS 'Estado: PENDING, SCHEDULED, IN_PROCESS, COMPLETED, FAILED, CANCELLED';


--
-- Name: companies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.companies (
    company_id integer NOT NULL,
    name character varying(255) NOT NULL,
    slug character varying(255) NOT NULL,
    contact_email character varying(255),
    phone character varying(50),
    address text,
    tax_id character varying(50),
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp without time zone,
    "displayName" character varying(255),
    description text,
    max_employees integer DEFAULT 50,
    modules_data jsonb,
    modules_pricing jsonb,
    monthly_total numeric(10,2) DEFAULT 0,
    license_type character varying(50) DEFAULT 'basic'::character varying,
    "createdAt" timestamp with time zone DEFAULT now(),
    "updatedAt" timestamp with time zone DEFAULT now(),
    legal_name character varying(255),
    contact_phone character varying(50),
    city character varying(255),
    province character varying(255),
    country character varying(255) DEFAULT 'Argentina'::character varying NOT NULL,
    website character varying(255),
    registration_number character varying(255),
    timezone character varying(255) DEFAULT 'America/Argentina/Buenos_Aires'::character varying NOT NULL,
    locale character varying(10) DEFAULT 'es-AR'::character varying NOT NULL,
    currency character varying(3) DEFAULT 'ARS'::character varying NOT NULL,
    logo text,
    primary_color character varying(7) DEFAULT '#0066CC'::character varying,
    secondary_color character varying(7) DEFAULT '#666666'::character varying,
    subscription_type public.enum_companies_subscription_type DEFAULT 'basic'::public.enum_companies_subscription_type NOT NULL,
    max_branches integer DEFAULT 5,
    status character varying(20) DEFAULT 'active'::character varying NOT NULL,
    is_trial boolean DEFAULT false NOT NULL,
    trial_ends_at timestamp with time zone,
    subscription_expires_at timestamp with time zone,
    features jsonb DEFAULT '{"medical": false, "reports": true, "apiAccess": false, "biometric": true, "multiuser": true, "attendance": true, "departments": true, "gpsTracking": false, "offlineMode": false, "realTimeSync": true, "customBranding": false, "ssoIntegration": false, "advancedReports": false}'::jsonb,
    pricing_info jsonb DEFAULT '{}'::jsonb,
    password_policy jsonb DEFAULT '{"maxAge": null, "minLength": 6, "requireNumbers": false, "requireSymbols": false, "requireLowercase": false, "requireUppercase": false}'::jsonb,
    two_factor_required boolean DEFAULT false NOT NULL,
    session_timeout integer DEFAULT 480 NOT NULL,
    settings jsonb DEFAULT '{}'::jsonb,
    created_by integer,
    last_config_update timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    display_name character varying(255),
    postal_code character varying(20) DEFAULT ''::character varying,
    vendor character varying(255) DEFAULT ''::character varying,
    commission_percentage numeric(5,2) DEFAULT 10.0,
    cbu character varying(50) DEFAULT ''::character varying,
    pricing jsonb,
    modules jsonb DEFAULT '[]'::jsonb,
    contracted_employees integer DEFAULT 1 NOT NULL,
    monthly_subtotal numeric(10,2) DEFAULT 0,
    monthly_tax numeric(10,2) DEFAULT 0,
    state character varying(255),
    email character varying(255),
    fallback_notification_email character varying(255),
    fallback_notification_whatsapp character varying(20),
    active_modules text,
    created_by_staff_id uuid,
    assigned_vendor_id uuid,
    support_vendor_id uuid,
    sales_commission_usd numeric(12,2) DEFAULT 0.00,
    support_commission_usd numeric(12,2) DEFAULT 0.00,
    multi_branch_enabled boolean DEFAULT false NOT NULL,
    onboarding_status character varying(50) DEFAULT 'PENDING'::character varying,
    requiere_supervision_factura boolean DEFAULT false,
    activated_at timestamp without time zone,
    onboarding_trace_id character varying(100),
    vendor_id uuid,
    modules_trial jsonb DEFAULT '[]'::jsonb,
    support_sla_plan_id uuid,
    config jsonb DEFAULT '{}'::jsonb,
    is_aponnt_master boolean DEFAULT false,
    CONSTRAINT valid_onboarding_status CHECK (((onboarding_status)::text = ANY ((ARRAY['PENDING'::character varying, 'BUDGET_ACCEPTED'::character varying, 'CONTRACT_SENT'::character varying, 'CONTRACT_SIGNED'::character varying, 'INVOICE_GENERATED'::character varying, 'INVOICE_SUPERVISED'::character varying, 'PAYMENT_PENDING'::character varying, 'PAYMENT_CONFIRMED'::character varying, 'ACTIVE'::character varying, 'SUSPENDED'::character varying, 'CANCELLED'::character varying])::text[])))
);


--
-- Name: COLUMN companies.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.name IS 'Company name';


--
-- Name: COLUMN companies.legal_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.legal_name IS 'Legal company name';


--
-- Name: COLUMN companies.contact_phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.contact_phone IS 'Alternative contact phone';


--
-- Name: COLUMN companies.city; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.city IS 'Company city';


--
-- Name: COLUMN companies.province; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.province IS 'Company state/province';


--
-- Name: COLUMN companies.country; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.country IS 'Company country';


--
-- Name: COLUMN companies.website; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.website IS 'Company website URL';


--
-- Name: COLUMN companies.registration_number; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.registration_number IS 'Company registration number';


--
-- Name: COLUMN companies.timezone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.timezone IS 'Company timezone';


--
-- Name: COLUMN companies.locale; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.locale IS 'Company locale (language-country)';


--
-- Name: COLUMN companies.currency; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.currency IS 'Currency code (ISO 4217)';


--
-- Name: COLUMN companies.logo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.logo IS 'Company logo in base64 format';


--
-- Name: COLUMN companies.primary_color; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.primary_color IS 'Primary brand color (hex)';


--
-- Name: COLUMN companies.secondary_color; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.secondary_color IS 'Secondary brand color (hex)';


--
-- Name: COLUMN companies.subscription_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.subscription_type IS 'Subscription plan type';


--
-- Name: COLUMN companies.max_branches; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.max_branches IS 'Maximum number of branches allowed';


--
-- Name: COLUMN companies.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.status IS 'Company status (active, suspended, trial, expired)';


--
-- Name: COLUMN companies.is_trial; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.is_trial IS 'Whether this is a trial account';


--
-- Name: COLUMN companies.trial_ends_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.trial_ends_at IS 'Trial expiration date';


--
-- Name: COLUMN companies.subscription_expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.subscription_expires_at IS 'Subscription expiration date';


--
-- Name: COLUMN companies.features; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.features IS 'Enabled features for this company';


--
-- Name: COLUMN companies.pricing_info; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.pricing_info IS 'General pricing information';


--
-- Name: COLUMN companies.password_policy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.password_policy IS 'Password policy configuration';


--
-- Name: COLUMN companies.two_factor_required; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.two_factor_required IS 'Whether 2FA is required for all users';


--
-- Name: COLUMN companies.session_timeout; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.session_timeout IS 'Session timeout in minutes';


--
-- Name: COLUMN companies.settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.settings IS 'Company-specific settings';


--
-- Name: COLUMN companies.created_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.created_by IS 'User who created this company';


--
-- Name: COLUMN companies.last_config_update; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.last_config_update IS 'Last time configuration was updated';


--
-- Name: COLUMN companies.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.metadata IS 'Additional company metadata';


--
-- Name: COLUMN companies.fallback_notification_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.fallback_notification_email IS 'Email fallback si no hay autorizador asignado (ej: rrhh@empresa.com)';


--
-- Name: COLUMN companies.fallback_notification_whatsapp; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.fallback_notification_whatsapp IS 'WhatsApp fallback si no hay autorizador asignado';


--
-- Name: COLUMN companies.created_by_staff_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.created_by_staff_id IS 'ID del staff que cre la empresa';


--
-- Name: COLUMN companies.assigned_vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.assigned_vendor_id IS 'Vendedor asignado a VENTAS (comisin permanente)';


--
-- Name: COLUMN companies.support_vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.support_vendor_id IS 'Vendedor asignado a SOPORTE (comisin temporal)';


--
-- Name: COLUMN companies.sales_commission_usd; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.sales_commission_usd IS 'Comisin en USD para vendedor de venta';


--
-- Name: COLUMN companies.support_commission_usd; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.support_commission_usd IS 'Comisin en USD para vendedor de soporte';


--
-- Name: COLUMN companies.multi_branch_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.multi_branch_enabled IS 'Feature flag para habilitar funcionalidad multi-sucursal. FALSE = sin sucursales visibles en UI';


--
-- Name: COLUMN companies.onboarding_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.onboarding_status IS 'Estado del proceso de onboarding: PENDING, BUDGET_ACCEPTED, CONTRACT_SENT, CONTRACT_SIGNED, INVOICE_GENERATED, INVOICE_SUPERVISED, PAYMENT_PENDING, PAYMENT_CONFIRMED, ACTIVE, SUSPENDED, CANCELLED';


--
-- Name: COLUMN companies.requiere_supervision_factura; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.requiere_supervision_factura IS 'TRUE si las facturas de esta empresa requieren aprobacin de admin Aponnt antes de enviar';


--
-- Name: COLUMN companies.activated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.activated_at IS 'Fecha y hora de activacin definitiva de la empresa (cuando onboarding_status pasa a ACTIVE)';


--
-- Name: COLUMN companies.onboarding_trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.onboarding_trace_id IS 'Trace ID del proceso de onboarding (ONBOARDING-{UUID})';


--
-- Name: COLUMN companies.vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.vendor_id IS 'Vendedor que dio de alta la empresa (FK a aponnt_staff)';


--
-- Name: COLUMN companies.modules_trial; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.modules_trial IS 'Array JSONB de mdulos en perodo de prueba: [{ module_key, trial_start, trial_end, status, activated_by }]';


--
-- Name: COLUMN companies.support_sla_plan_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.support_sla_plan_id IS 'Plan de SLA de soporte contratado por la empresa';


--
-- Name: COLUMN companies.is_aponnt_master; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.companies.is_aponnt_master IS 'TRUE = Esta es la entidad APONNT que factura a las empresas clientes';


--
-- Name: companies_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.companies_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: companies_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.companies_id_seq OWNED BY public.companies.company_id;


--
-- Name: company_account_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_account_notifications (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid,
    notification_type character varying(50) NOT NULL,
    title character varying(255) NOT NULL,
    message text,
    reference_type character varying(30),
    reference_id character varying(100),
    priority character varying(20) DEFAULT 'normal'::character varying,
    is_read boolean DEFAULT false,
    read_at timestamp with time zone,
    dismissed_at timestamp with time zone,
    action_url character varying(255),
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: company_account_notifications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_account_notifications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_account_notifications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_account_notifications_id_seq OWNED BY public.company_account_notifications.id;


--
-- Name: company_associate_contracts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_associate_contracts (
    id integer NOT NULL,
    company_id integer NOT NULL,
    associate_id uuid NOT NULL,
    contract_type public.contract_type NOT NULL,
    scope_type public.contract_scope DEFAULT 'all_company'::public.contract_scope NOT NULL,
    assigned_branches uuid[] DEFAULT '{}'::uuid[],
    assigned_departments integer[] DEFAULT '{}'::integer[],
    role_id integer,
    custom_permissions jsonb,
    start_date date DEFAULT CURRENT_DATE NOT NULL,
    end_date date,
    status public.contract_status DEFAULT 'pending'::public.contract_status,
    terms_accepted boolean DEFAULT false,
    terms_accepted_at timestamp without time zone,
    hourly_rate_agreed numeric(10,2),
    currency character varying(3) DEFAULT 'ARS'::character varying,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    created_by uuid,
    approved_by uuid,
    approved_at timestamp without time zone,
    terminated_by uuid,
    terminated_at timestamp without time zone,
    termination_reason text
);


--
-- Name: company_associate_contracts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_associate_contracts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_associate_contracts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_associate_contracts_id_seq OWNED BY public.company_associate_contracts.id;


--
-- Name: company_benefit_policies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_benefit_policies (
    id integer NOT NULL,
    company_id integer NOT NULL,
    benefit_type_id integer NOT NULL,
    is_enabled boolean DEFAULT false,
    max_amount numeric(15,2),
    max_quantity integer,
    max_beneficiaries_per_employee integer DEFAULT 1,
    duration_months integer,
    renewal_required boolean,
    renewal_advance_days integer,
    requires_approval boolean,
    approval_levels integer,
    eligible_roles integer[],
    eligible_departments integer[],
    min_seniority_months integer,
    payment_frequency character varying(20),
    payment_day integer,
    terms_and_conditions text,
    internal_notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid
);


--
-- Name: TABLE company_benefit_policies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_benefit_policies IS 'Polticas de beneficios configuradas por cada empresa';


--
-- Name: COLUMN company_benefit_policies.company_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_benefit_policies.company_id IS 'SSOT: companies.company_id';


--
-- Name: COLUMN company_benefit_policies.benefit_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_benefit_policies.benefit_type_id IS 'SSOT: benefit_types.id';


--
-- Name: COLUMN company_benefit_policies.eligible_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_benefit_policies.eligible_roles IS 'SSOT: Array de roles.id';


--
-- Name: company_benefit_policies_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_benefit_policies_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_benefit_policies_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_benefit_policies_id_seq OWNED BY public.company_benefit_policies.id;


--
-- Name: company_branches; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_branches (
    id integer NOT NULL,
    company_id integer NOT NULL,
    country_id integer,
    branch_code character varying(20) NOT NULL,
    branch_name character varying(200) NOT NULL,
    address text,
    city character varying(100),
    state_province character varying(100),
    postal_code character varying(20),
    phone character varying(50),
    email character varying(200),
    local_tax_id character varying(50),
    local_registration_number character varying(100),
    local_labor_authority character varying(200),
    default_pay_day integer DEFAULT 5,
    pay_frequency_override character varying(20),
    timezone character varying(50) DEFAULT 'America/Argentina/Buenos_Aires'::character varying,
    is_headquarters boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    default_agreement_id integer,
    default_template_id integer,
    payroll_settings jsonb DEFAULT '{}'::jsonb
);


--
-- Name: company_branches_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_branches_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_branches_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_branches_id_seq OWNED BY public.company_branches.id;


--
-- Name: company_communications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_communications (
    id integer NOT NULL,
    company_id integer NOT NULL,
    direction character varying(10) DEFAULT 'inbound'::character varying NOT NULL,
    department character varying(30) DEFAULT 'support'::character varying,
    from_user_id uuid,
    from_staff_id uuid,
    from_name character varying(255),
    subject character varying(255) NOT NULL,
    message text NOT NULL,
    priority character varying(20) DEFAULT 'normal'::character varying,
    status character varying(30) DEFAULT 'unread'::character varying,
    requires_response boolean DEFAULT false,
    response_deadline timestamp with time zone,
    parent_id integer,
    attachments jsonb DEFAULT '[]'::jsonb,
    read_at timestamp with time zone,
    read_by uuid,
    replied_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: company_communications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_communications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_communications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_communications_id_seq OWNED BY public.company_communications.id;


--
-- Name: company_dependencies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_dependencies (
    id integer NOT NULL,
    company_id integer NOT NULL,
    dependency_code character varying(50) NOT NULL,
    dependency_name character varying(150) NOT NULL,
    dependency_name_i18n jsonb DEFAULT '{}'::jsonb,
    description text,
    dependency_type_id integer NOT NULL,
    config jsonb DEFAULT '{}'::jsonb,
    icon character varying(50),
    color_hex character varying(7),
    display_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid
);


--
-- Name: TABLE company_dependencies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_dependencies IS 'Dependencias definidas por cada empresa (multi-tenant). Cada empresa crea las suyas.';


--
-- Name: COLUMN company_dependencies.config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_dependencies.config IS 'Configuracin especfica segn el tipo de dependencia (JSONB flexible)';


--
-- Name: company_dependencies_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_dependencies_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_dependencies_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_dependencies_id_seq OWNED BY public.company_dependencies.id;


--
-- Name: company_email_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_email_config (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    smtp_host character varying(255) NOT NULL,
    smtp_port integer DEFAULT 587,
    smtp_user character varying(255) NOT NULL,
    smtp_password character varying(500) NOT NULL,
    smtp_secure boolean DEFAULT false,
    smtp_from_email character varying(255) NOT NULL,
    smtp_from_name character varying(255),
    smtp_reply_to character varying(255),
    imap_host character varying(255),
    imap_port integer DEFAULT 993,
    imap_user character varying(255),
    imap_password character varying(500),
    imap_secure boolean DEFAULT true,
    imap_enabled boolean DEFAULT false,
    imap_folder character varying(100) DEFAULT 'INBOX'::character varying,
    imap_last_poll timestamp without time zone,
    imap_last_uid integer DEFAULT 0,
    bidirectional_enabled boolean DEFAULT false,
    poll_interval_seconds integer DEFAULT 60,
    is_active boolean DEFAULT true,
    is_validated boolean DEFAULT false,
    validated_at timestamp without time zone,
    last_error text,
    error_count integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE company_email_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_email_config IS 'Configuracin de email SMTP/IMAP por empresa para sistema bidireccional';


--
-- Name: COLUMN company_email_config.imap_last_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_email_config.imap_last_uid IS 'ltimo UID procesado del inbox (para no reprocesar)';


--
-- Name: COLUMN company_email_config.bidirectional_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_email_config.bidirectional_enabled IS 'Si est habilitado el sistema bidireccional (emails de respuesta)';


--
-- Name: company_fiscal_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_fiscal_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    cuit character varying(13) NOT NULL,
    razon_social character varying(255) NOT NULL,
    condicion_iva character varying(50) NOT NULL,
    inicio_actividades date,
    certificate_pem text,
    private_key_encrypted text,
    certificate_expiration timestamp without time zone,
    certificate_type character varying(20) DEFAULT 'TESTING'::character varying,
    afip_environment character varying(20) DEFAULT 'TESTING'::character varying,
    cached_token text,
    cached_sign text,
    token_expiration timestamp without time zone,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer,
    updated_by integer,
    CONSTRAINT valid_condicion_iva CHECK (((condicion_iva)::text = ANY ((ARRAY['RI'::character varying, 'RM'::character varying, 'EX'::character varying, 'CF'::character varying, 'MONOTRIBUTO'::character varying])::text[]))),
    CONSTRAINT valid_cuit CHECK (((cuit)::text ~ '^\d{2}-\d{8}-\d{1}$'::text))
);


--
-- Name: company_fiscal_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_fiscal_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_fiscal_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_fiscal_config_id_seq OWNED BY public.company_fiscal_config.id;


--
-- Name: company_inbox_processed; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_inbox_processed (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    message_uid integer NOT NULL,
    message_id character varying(500),
    from_email character varying(255) NOT NULL,
    subject character varying(1000),
    received_at timestamp without time zone,
    processed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    processing_status character varying(50) DEFAULT 'PROCESSED'::character varying,
    linked_inbound_id uuid,
    error_message text
);


--
-- Name: TABLE company_inbox_processed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_inbox_processed IS 'Tracking de emails procesados del inbox de cada empresa';


--
-- Name: company_medical_staff; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_medical_staff (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    partner_id uuid NOT NULL,
    is_primary boolean DEFAULT false,
    is_active boolean DEFAULT true,
    assigned_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    assigned_by uuid
);


--
-- Name: company_modules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_modules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    system_module_id uuid NOT NULL,
    precio_mensual numeric(10,2) DEFAULT 0.00 NOT NULL,
    activo boolean DEFAULT true NOT NULL,
    fecha_asignacion timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    is_bundled boolean DEFAULT false,
    bundled_with uuid,
    auto_activated boolean DEFAULT false,
    is_active boolean DEFAULT true,
    contracted_price numeric(10,2),
    employee_tier character varying(20),
    expires_at timestamp without time zone,
    suspended_at timestamp without time zone,
    suspended_reason text,
    last_billed_at timestamp without time zone,
    next_billing_at timestamp without time zone,
    usage_stats jsonb DEFAULT '{}'::jsonb,
    configuration jsonb DEFAULT '{}'::jsonb,
    notes text
);


--
-- Name: TABLE company_modules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_modules IS 'Mdulos contratados por cada empresa (multi-tenant)';


--
-- Name: company_non_working_days; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_non_working_days (
    id integer NOT NULL,
    company_id integer NOT NULL,
    date date NOT NULL,
    reason character varying(255),
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: company_non_working_days_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_non_working_days_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_non_working_days_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_non_working_days_id_seq OWNED BY public.company_non_working_days.id;


--
-- Name: company_risk_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_risk_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    threshold_method character varying(30) DEFAULT 'manual'::character varying,
    hybrid_weights jsonb DEFAULT '{"manual": 0.3, "quartile": 0.4, "benchmark": 0.3}'::jsonb,
    global_thresholds jsonb DEFAULT '{"fatigue": {"low": 30, "high": 70, "medium": 50, "critical": 85}, "accident": {"low": 30, "high": 70, "medium": 50, "critical": 85}, "turnover": {"low": 30, "high": 70, "medium": 50, "critical": 85}, "legal_claim": {"low": 30, "high": 70, "medium": 50, "critical": 85}, "performance": {"low": 30, "high": 70, "medium": 50, "critical": 85}}'::jsonb,
    global_weights jsonb DEFAULT '{"fatigue": 0.25, "accident": 0.25, "turnover": 0.15, "legal_claim": 0.20, "performance": 0.15}'::jsonb,
    enable_segmentation boolean DEFAULT false,
    default_benchmark_code character varying(50) DEFAULT 'ADM-GENERAL'::character varying,
    quartile_recalc_frequency character varying(20) DEFAULT 'weekly'::character varying,
    last_quartile_calculation timestamp without time zone,
    calculated_quartiles jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    updated_by uuid,
    CONSTRAINT company_risk_config_quartile_recalc_frequency_check CHECK (((quartile_recalc_frequency)::text = ANY ((ARRAY['daily'::character varying, 'weekly'::character varying, 'monthly'::character varying, 'manual'::character varying])::text[]))),
    CONSTRAINT company_risk_config_threshold_method_check CHECK (((threshold_method)::text = ANY ((ARRAY['manual'::character varying, 'quartile'::character varying, 'benchmark'::character varying, 'hybrid'::character varying])::text[])))
);


--
-- Name: company_risk_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_risk_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_risk_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_risk_config_id_seq OWNED BY public.company_risk_config.id;


--
-- Name: company_support_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_support_assignments (
    assignment_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    company_id integer NOT NULL,
    support_type character varying(50) NOT NULL,
    assigned_vendor_id uuid,
    original_vendor_id uuid NOT NULL,
    assigned_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    is_active boolean DEFAULT true,
    notes text,
    assigned_by_user_id uuid,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone,
    CONSTRAINT company_support_assignments_support_type_check CHECK (((support_type)::text = ANY ((ARRAY['original_vendor'::character varying, 'other_vendor'::character varying, 'aponnt_support'::character varying])::text[])))
);


--
-- Name: TABLE company_support_assignments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_support_assignments IS 'Asignacin de soporte tcnico por empresa';


--
-- Name: COLUMN company_support_assignments.support_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_support_assignments.support_type IS 'Tipo: vendedor original, otro vendedor, o Aponnt directo';


--
-- Name: COLUMN company_support_assignments.original_vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_support_assignments.original_vendor_id IS 'Vendedor que realiz la venta inicial';


--
-- Name: company_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_tasks (
    id integer NOT NULL,
    company_id integer NOT NULL,
    task_name character varying(255) NOT NULL,
    task_description text,
    task_code character varying(50),
    task_category character varying(100),
    task_type character varying(100),
    estimated_hours numeric(5,2),
    priority_default character varying(50),
    requires_approval boolean DEFAULT false,
    approval_role character varying(50),
    is_active boolean DEFAULT true,
    is_template boolean DEFAULT false,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT company_tasks_priority_default_check CHECK (((priority_default)::text = ANY ((ARRAY['baja'::character varying, 'media'::character varying, 'alta'::character varying, 'urgente'::character varying])::text[])))
);


--
-- Name: TABLE company_tasks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.company_tasks IS 'Catlogo de tareas de la empresa (biblioteca de tareas disponibles)';


--
-- Name: COLUMN company_tasks.task_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_tasks.task_code IS 'Cdigo interno nico para identificar la tarea';


--
-- Name: COLUMN company_tasks.is_template; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.company_tasks.is_template IS 'Si es plantilla, se puede usar como modelo para crear nuevas tareas';


--
-- Name: company_tasks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_tasks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_tasks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_tasks_id_seq OWNED BY public.company_tasks.id;


--
-- Name: company_tax_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.company_tax_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    tax_template_id integer NOT NULL,
    custom_tax_id character varying(50),
    custom_condition_code character varying(20),
    custom_currencies jsonb,
    concept_overrides jsonb DEFAULT '{}'::jsonb,
    factura_a_numero integer DEFAULT 1,
    factura_b_numero integer DEFAULT 1,
    factura_c_numero integer DEFAULT 1,
    remito_numero integer DEFAULT 1,
    recibo_numero integer DEFAULT 1,
    punto_venta integer DEFAULT 1,
    actividad_principal character varying(200),
    descuento_maximo numeric(5,2) DEFAULT 0,
    recargo_maximo numeric(5,2) DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT company_tax_config_descuento_maximo_check CHECK (((descuento_maximo >= (0)::numeric) AND (descuento_maximo <= (100)::numeric))),
    CONSTRAINT company_tax_config_punto_venta_check CHECK (((punto_venta > 0) AND (punto_venta <= 9999))),
    CONSTRAINT company_tax_config_recargo_maximo_check CHECK (((recargo_maximo >= (0)::numeric) AND (recargo_maximo <= (100)::numeric)))
);


--
-- Name: company_tax_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.company_tax_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: company_tax_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.company_tax_config_id_seq OWNED BY public.company_tax_config.id;


--
-- Name: comparative_analytics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.comparative_analytics (
    id bigint NOT NULL,
    company_id integer NOT NULL,
    cube_id character varying(100) NOT NULL,
    dimension_time character varying(50),
    dimension_time_value character varying(50),
    dimension_org character varying(50),
    dimension_org_value character varying(255),
    dimension_geo character varying(50),
    dimension_geo_value character varying(255),
    measure_name character varying(50),
    measure_value numeric(15,4),
    measure_unit character varying(20),
    comparison_baseline_value numeric(15,4),
    comparison_diff_absolute numeric(15,4),
    comparison_diff_percent numeric(7,2),
    sample_size integer,
    confidence_level numeric(5,2),
    calculated_at timestamp without time zone DEFAULT now(),
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE comparative_analytics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.comparative_analytics IS 'Cubos OLAP pre-calculados para comparaciones multi-dimensionales';


--
-- Name: comparative_analytics_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.comparative_analytics_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: comparative_analytics_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.comparative_analytics_id_seq OWNED BY public.comparative_analytics.id;


--
-- Name: compliance_rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_rules (
    id integer NOT NULL,
    rule_code character varying(50) NOT NULL,
    legal_reference character varying(255),
    rule_type character varying(30),
    severity character varying(20),
    check_frequency character varying(20),
    validation_query text,
    active boolean DEFAULT true
);


--
-- Name: TABLE compliance_rules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.compliance_rules IS 'Reglas de cumplimiento legal argentino (LCT)';


--
-- Name: compliance_rules_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.compliance_rules_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: compliance_rules_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.compliance_rules_id_seq OWNED BY public.compliance_rules.id;


--
-- Name: compliance_violations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.compliance_violations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    rule_code character varying(50),
    employee_id character varying(100),
    violation_date timestamp without time zone DEFAULT now(),
    violation_data jsonb,
    status character varying(20) DEFAULT 'active'::character varying,
    resolved_at timestamp without time zone,
    resolution_notes text
);


--
-- Name: compliance_violations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.compliance_violations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: compliance_violations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.compliance_violations_id_seq OWNED BY public.compliance_violations.id;


--
-- Name: concept_dependencies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.concept_dependencies (
    id integer NOT NULL,
    company_id integer NOT NULL,
    concept_id integer NOT NULL,
    dependency_id integer NOT NULL,
    on_failure character varying(20) DEFAULT 'SKIP'::character varying,
    failure_message character varying(255),
    multiplier_mode character varying(20) DEFAULT 'NONE'::character varying,
    evaluation_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT concept_dependencies_multiplier_mode_check CHECK (((multiplier_mode)::text = ANY ((ARRAY['NONE'::character varying, 'PER_VALID'::character varying, 'FIXED'::character varying])::text[]))),
    CONSTRAINT concept_dependencies_on_failure_check CHECK (((on_failure)::text = ANY ((ARRAY['SKIP'::character varying, 'REDUCE_PROPORTIONAL'::character varying, 'WARN_ONLY'::character varying])::text[])))
);


--
-- Name: TABLE concept_dependencies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.concept_dependencies IS 'Vinculacin entre conceptos de liquidacin y sus dependencias requeridas.';


--
-- Name: COLUMN concept_dependencies.on_failure; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.concept_dependencies.on_failure IS 'Qu hacer si no se cumple: SKIP=no aplicar, REDUCE_PROPORTIONAL=reducir, WARN_ONLY=advertir';


--
-- Name: COLUMN concept_dependencies.multiplier_mode; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.concept_dependencies.multiplier_mode IS 'Cmo multiplicar: NONE=binario, PER_VALID=por cada vlido, FIXED=monto fijo';


--
-- Name: concept_dependencies_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.concept_dependencies_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: concept_dependencies_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.concept_dependencies_id_seq OWNED BY public.concept_dependencies.id;


--
-- Name: consent_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.consent_audit_log (
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_consent_id uuid NOT NULL,
    action character varying(50) NOT NULL,
    old_status character varying(20),
    new_status character varying(20),
    ip_address character varying(45),
    changed_by integer,
    notes text,
    metadata jsonb,
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT consent_audit_log_action_check CHECK (((action)::text = ANY ((ARRAY['created'::character varying, 'accepted'::character varying, 'rejected'::character varying, 'revoked'::character varying, 'updated'::character varying, 'viewed'::character varying])::text[])))
);


--
-- Name: TABLE consent_audit_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.consent_audit_log IS 'Auditora completa de cambios en consentimientos';


--
-- Name: COLUMN consent_audit_log.action; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_audit_log.action IS 'Accin realizada: created, accepted, rejected, revoked, updated, viewed';


--
-- Name: COLUMN consent_audit_log.changed_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_audit_log.changed_by IS 'user_id de quien realiz el cambio (puede ser admin)';


--
-- Name: COLUMN consent_audit_log.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_audit_log.metadata IS 'Datos adicionales en formato JSON';


--
-- Name: consent_change_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.consent_change_log (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    consent_id integer,
    old_branch_id integer,
    old_country_id integer,
    old_country_code character varying(3),
    old_renewal_months integer,
    old_consent_status character varying(50),
    old_expires_at timestamp without time zone,
    new_branch_id integer,
    new_country_id integer,
    new_country_code character varying(3),
    new_renewal_months integer,
    change_type character varying(50) NOT NULL,
    action_taken character varying(50) NOT NULL,
    triggered_by character varying(50) DEFAULT 'SYSTEM'::character varying,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: consent_change_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.consent_change_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: consent_change_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.consent_change_log_id_seq OWNED BY public.consent_change_log.id;


--
-- Name: consent_definitions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.consent_definitions (
    consent_id uuid DEFAULT gen_random_uuid() NOT NULL,
    consent_key character varying(100) NOT NULL,
    title character varying(255) NOT NULL,
    description text NOT NULL,
    full_text text NOT NULL,
    version character varying(20) DEFAULT '1.0'::character varying NOT NULL,
    applicable_roles text[] NOT NULL,
    is_required boolean DEFAULT false,
    category character varying(50) NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT consent_definitions_category_check CHECK (((category)::text = ANY ((ARRAY['privacy'::character varying, 'legal'::character varying, 'commercial'::character varying, 'safety'::character varying, 'operational'::character varying])::text[])))
);


--
-- Name: TABLE consent_definitions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.consent_definitions IS 'Definiciones maestras de consentimientos aplicables a diferentes roles';


--
-- Name: COLUMN consent_definitions.consent_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_definitions.consent_key IS 'Identificador nico: biometric_data, email_marketing, etc.';


--
-- Name: COLUMN consent_definitions.version; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_definitions.version IS 'Versin del consentimiento para control de cambios';


--
-- Name: COLUMN consent_definitions.applicable_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_definitions.applicable_roles IS 'Roles a los que aplica: employee, vendor, leader, supervisor, partner, admin';


--
-- Name: COLUMN consent_definitions.is_required; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.consent_definitions.is_required IS 'Si es obligatorio para operar el sistema';


--
-- Name: consent_legal_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.consent_legal_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    version character varying(20) NOT NULL,
    document_type character varying(50) DEFAULT 'consent_form'::character varying NOT NULL,
    language character varying(10) DEFAULT 'es-AR'::character varying NOT NULL,
    title text NOT NULL,
    content text NOT NULL,
    pdf_url text,
    pdf_hash character varying(64),
    regulations jsonb,
    is_active boolean DEFAULT true,
    effective_from timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    effective_until timestamp without time zone,
    created_by_user_id uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: contextual_help; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contextual_help (
    id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    screen_key character varying(100),
    element_key character varying(100),
    help_type character varying(20) DEFAULT 'tooltip'::character varying,
    title character varying(200),
    content text NOT NULL,
    content_html text,
    step_order integer,
    show_condition jsonb DEFAULT '{}'::jsonb,
    image_url text,
    video_url text,
    "position" character varying(20) DEFAULT 'auto'::character varying,
    style jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    priority integer DEFAULT 0,
    view_count integer DEFAULT 0,
    helpful_count integer DEFAULT 0,
    not_helpful_count integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    quick_start text,
    common_issues jsonb DEFAULT '[]'::jsonb,
    walkthrough_steps jsonb DEFAULT '[]'::jsonb,
    documentation_url text
);


--
-- Name: contextual_help_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.contextual_help_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: contextual_help_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.contextual_help_id_seq OWNED BY public.contextual_help.id;


--
-- Name: contract_apk_licenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_apk_licenses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    contract_id uuid NOT NULL,
    company_id integer NOT NULL,
    apk_type character varying(50) NOT NULL,
    apk_name character varying(100) NOT NULL,
    max_devices integer,
    max_users integer,
    is_active boolean DEFAULT true,
    activated_at timestamp without time zone,
    deactivated_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT valid_apk_type CHECK (((apk_type)::text = ANY ((ARRAY['kiosk'::character varying, 'medical'::character varying, 'legal'::character varying, 'employee'::character varying])::text[])))
);


--
-- Name: TABLE contract_apk_licenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_apk_licenses IS 'Licencias de APKs (Kiosk, Medical, Legal, Employee) por contrato';


--
-- Name: contract_renewal_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_renewal_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    contract_id uuid NOT NULL,
    event_type character varying(50) NOT NULL,
    recipients jsonb,
    details jsonb,
    days_until_expiry integer,
    notification_sent boolean DEFAULT false,
    notification_error text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by character varying(100) DEFAULT 'SYSTEM'::character varying
);


--
-- Name: TABLE contract_renewal_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_renewal_logs IS 'Historial de eventos de renovacin y alertas';


--
-- Name: contract_template_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_template_types (
    id integer NOT NULL,
    code character varying(50) NOT NULL,
    name character varying(150) NOT NULL,
    name_en character varying(150),
    description text,
    category character varying(30) NOT NULL,
    applicable_to_benefit_types character varying[] DEFAULT ARRAY[]::character varying[],
    requires_witness boolean DEFAULT false,
    requires_notarization boolean DEFAULT false,
    requires_registration boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE contract_template_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_template_types IS 'Tipos de contratos/documentos legales';


--
-- Name: COLUMN contract_template_types.applicable_to_benefit_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_template_types.applicable_to_benefit_types IS 'Array de benefit_types.code a los que aplica';


--
-- Name: contract_template_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.contract_template_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: contract_template_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.contract_template_types_id_seq OWNED BY public.contract_template_types.id;


--
-- Name: contract_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contract_templates (
    id integer NOT NULL,
    template_type_id integer NOT NULL,
    country_code character varying(3) NOT NULL,
    country_name character varying(100) NOT NULL,
    version character varying(20) DEFAULT '1.0'::character varying NOT NULL,
    title character varying(200) NOT NULL,
    template_html text NOT NULL,
    required_variables jsonb DEFAULT '[]'::jsonb,
    legal_references text,
    country_specific_requirements jsonb DEFAULT '{}'::jsonb,
    additional_clauses text,
    is_default boolean DEFAULT false,
    status character varying(30) DEFAULT 'draft'::character varying,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid,
    approved_at timestamp without time zone,
    approved_by uuid
);


--
-- Name: TABLE contract_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contract_templates IS 'Templates de contratos legales por pas (adaptados a legislacin local)';


--
-- Name: COLUMN contract_templates.template_type_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_templates.template_type_id IS 'SSOT: contract_template_types.id';


--
-- Name: COLUMN contract_templates.country_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_templates.country_code IS 'ISO 3166-1 alpha-3 (ARG, MEX, CHL, etc.)';


--
-- Name: COLUMN contract_templates.template_html; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_templates.template_html IS 'HTML con placeholders: {{VARIABLE_NAME}}';


--
-- Name: COLUMN contract_templates.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contract_templates.status IS 'draft, active, archived, superseded';


--
-- Name: contract_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.contract_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: contract_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.contract_templates_id_seq OWNED BY public.contract_templates.id;


--
-- Name: contracts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contracts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trace_id character varying(100) NOT NULL,
    budget_id uuid NOT NULL,
    company_id integer NOT NULL,
    contract_code character varying(50) NOT NULL,
    contract_type character varying(50) DEFAULT 'EULA'::character varying NOT NULL,
    contract_date date DEFAULT CURRENT_DATE NOT NULL,
    valid_until date,
    template_version character varying(20) DEFAULT '1.0'::character varying NOT NULL,
    template_content text NOT NULL,
    selected_modules jsonb NOT NULL,
    contracted_employees integer NOT NULL,
    total_monthly numeric(12,2) NOT NULL,
    payment_method character varying(50) DEFAULT 'TRANSFERENCIA'::character varying,
    signature_required boolean DEFAULT true,
    signature_method character varying(50),
    signer_name character varying(255),
    signer_email character varying(255),
    signer_dni character varying(50),
    signer_role character varying(100),
    signed_at timestamp without time zone,
    signature_ip character varying(100),
    signature_hash character varying(255),
    signature_certificate text,
    status character varying(50) DEFAULT 'DRAFT'::character varying NOT NULL,
    sent_at timestamp without time zone,
    viewed_at timestamp without time zone,
    rejected_at timestamp without time zone,
    rejection_reason text,
    activated_at timestamp without time zone,
    notes text,
    legal_representative jsonb,
    created_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    contract_number character varying(50),
    quote_id integer,
    seller_id integer,
    support_partner_id integer,
    modules_data jsonb DEFAULT '[]'::jsonb,
    monthly_total numeric(10,2) DEFAULT 0,
    start_date timestamp without time zone,
    end_date timestamp without time zone,
    termination_date timestamp without time zone,
    termination_reason text,
    billing_cycle character varying(20) DEFAULT 'monthly'::character varying,
    payment_day integer DEFAULT 10,
    payment_terms_days integer DEFAULT 10,
    late_payment_surcharge_percentage numeric(5,2) DEFAULT 10,
    suspension_days_threshold integer DEFAULT 20,
    termination_days_threshold integer DEFAULT 30,
    seller_commission_percentage numeric(5,2),
    seller_sale_commission_percentage numeric(5,2),
    seller_support_commission_percentage numeric(5,2),
    support_commission_percentage numeric(5,2),
    pdf_file_path character varying(500),
    signed_pdf_file_path character varying(500),
    client_signature_date timestamp without time zone,
    company_signature_date timestamp without time zone,
    terms_and_conditions text,
    sla_terms jsonb,
    renewal_notification_sent boolean DEFAULT false,
    renewal_date timestamp without time zone,
    updated_by integer,
    vendor_id uuid,
    grace_period_end date,
    contracted_apks jsonb DEFAULT '[]'::jsonb,
    next_renewal_alert_date date,
    auto_extension_count integer DEFAULT 0,
    renewal_alert_sent_at timestamp without time zone,
    original_end_date date,
    template_id uuid,
    CONSTRAINT signature_required_if_signed CHECK (((signed_at IS NULL) OR ((signed_at IS NOT NULL) AND (signature_hash IS NOT NULL) AND (signer_name IS NOT NULL)))),
    CONSTRAINT valid_contract_status CHECK (((status)::text = ANY ((ARRAY['DRAFT'::character varying, 'SENT'::character varying, 'VIEWED'::character varying, 'PENDING_SIGNATURE'::character varying, 'SIGNED'::character varying, 'REJECTED'::character varying, 'EXPIRED'::character varying, 'CANCELLED'::character varying, 'ACTIVE'::character varying, 'RENEWAL_PENDING'::character varying, 'GRACE_PERIOD'::character varying, 'SUSPENDED'::character varying, 'TERMINATED'::character varying])::text[])))
);


--
-- Name: TABLE contracts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.contracts IS 'Contratos firmados con empresas cliente';


--
-- Name: COLUMN contracts.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.trace_id IS 'ID nico de trazabilidad (mismo que budget)';


--
-- Name: COLUMN contracts.contract_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.contract_code IS 'Cdigo legible del contrato (CTRCT-YYYY-NNNN)';


--
-- Name: COLUMN contracts.template_content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.template_content IS 'HTML del contrato con variables reemplazadas';


--
-- Name: COLUMN contracts.signature_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.signature_hash IS 'Hash SHA-256 del contrato firmado (inmutable)';


--
-- Name: COLUMN contracts.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.status IS 'Estados: DRAFT, SENT, PENDING_SIGNATURE, SIGNED, ACTIVE, RENEWAL_PENDING, GRACE_PERIOD, SUSPENDED, TERMINATED, EXPIRED';


--
-- Name: COLUMN contracts.vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.vendor_id IS 'Vendedor asignado al contrato';


--
-- Name: COLUMN contracts.grace_period_end; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.grace_period_end IS 'Fecha fin del perodo de gracia (60 das despus de end_date)';


--
-- Name: COLUMN contracts.contracted_apks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.contracted_apks IS 'APKs contratadas: kiosk, medical, legal, employee';


--
-- Name: COLUMN contracts.next_renewal_alert_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.next_renewal_alert_date IS 'Prxima fecha de alerta de renovacin';


--
-- Name: COLUMN contracts.auto_extension_count; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.auto_extension_count IS 'Cantidad de extensiones automticas aplicadas';


--
-- Name: COLUMN contracts.renewal_alert_sent_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.renewal_alert_sent_at IS 'ltima alerta de renovacin enviada';


--
-- Name: COLUMN contracts.original_end_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.contracts.original_end_date IS 'Fecha original de fin antes de extensiones';


--
-- Name: cost_budgets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cost_budgets (
    id integer NOT NULL,
    company_id integer NOT NULL,
    department_id integer,
    cost_category character varying(50),
    period_start date,
    period_end date,
    alert_threshold_percent integer DEFAULT 90
);


--
-- Name: TABLE cost_budgets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.cost_budgets IS 'Presupuestos por empresa/departamento para control de costos';


--
-- Name: cost_budgets_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.cost_budgets_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: cost_budgets_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.cost_budgets_id_seq OWNED BY public.cost_budgets.id;


--
-- Name: cost_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.cost_transactions (
    id integer NOT NULL,
    company_id integer NOT NULL,
    department_id integer,
    employee_id character varying(100),
    notification_group_id uuid,
    cost_category character varying(50),
    description text,
    transaction_date timestamp without time zone DEFAULT now(),
    metadata jsonb
);


--
-- Name: cost_transactions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.cost_transactions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: cost_transactions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.cost_transactions_id_seq OWNED BY public.cost_transactions.id;


--
-- Name: country_safety_regulations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.country_safety_regulations (
    country_code character varying(2) NOT NULL,
    country_name character varying(100) NOT NULL,
    allows_individual_tracking boolean DEFAULT true,
    requires_explicit_consent boolean DEFAULT true,
    consent_renewal_days integer,
    image_retention_max_days integer DEFAULT 30,
    detection_retention_max_days integer DEFAULT 365,
    required_legal_documents jsonb,
    legal_framework text,
    regulatory_body text,
    alert_mode character varying(20) DEFAULT 'INDIVIDUAL'::character varying,
    max_fine_info text,
    is_active boolean DEFAULT true,
    last_updated timestamp with time zone DEFAULT now(),
    updated_by integer,
    CONSTRAINT country_safety_regulations_alert_mode_check CHECK (((alert_mode)::text = ANY ((ARRAY['INDIVIDUAL'::character varying, 'ANONYMOUS'::character varying, 'AGGREGATE_ONLY'::character varying])::text[])))
);


--
-- Name: data_integrity_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.data_integrity_log (
    id integer NOT NULL,
    check_type character varying(50) NOT NULL,
    table_name character varying(50) NOT NULL,
    record_id character varying(100),
    company_id integer,
    issue_description text,
    auto_fixed boolean DEFAULT false,
    fix_description text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: data_integrity_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.data_integrity_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: data_integrity_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.data_integrity_log_id_seq OWNED BY public.data_integrity_log.id;


--
-- Name: department_aliases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.department_aliases (
    id integer NOT NULL,
    alias character varying(100) NOT NULL,
    department_id integer NOT NULL,
    company_id integer NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: department_aliases_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.department_aliases_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: department_aliases_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.department_aliases_id_seq OWNED BY public.department_aliases.id;


--
-- Name: departments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.departments (
    name character varying(100) NOT NULL,
    description text DEFAULT ''::text,
    address character varying(255) DEFAULT ''::character varying,
    gps_lat numeric(10,8),
    gps_lng numeric(11,8),
    coverage_radius integer DEFAULT 50 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    deleted_at timestamp with time zone,
    company_id integer NOT NULL,
    id integer NOT NULL,
    branch_id uuid,
    default_kiosk_id integer,
    authorized_kiosks jsonb DEFAULT '[]'::jsonb,
    allow_gps_attendance boolean DEFAULT false NOT NULL,
    notification_recipients jsonb DEFAULT '[]'::jsonb,
    manager_user_id uuid
);


--
-- Name: COLUMN departments.default_kiosk_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.departments.default_kiosk_id IS 'DEPRECADO - Kiosk por defecto donde este departamento debe marcar. Usar authorized_kiosks en su lugar';


--
-- Name: COLUMN departments.authorized_kiosks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.departments.authorized_kiosks IS 'Array de kiosk_id autorizados para este departamento. Si est vaco, solo pueden marcar por GPS. Ejemplo: [9, 10, 17]';


--
-- Name: COLUMN departments.allow_gps_attendance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.departments.allow_gps_attendance IS 'Si true, empleados pueden marcar asistencia desde APK cuando estn dentro del radio de cobertura GPS';


--
-- Name: COLUMN departments.notification_recipients; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.departments.notification_recipients IS 'JSON array de user_ids que reciben notificaciones enviadas al departamento.
Formato: [{"user_id": "uuid", "role": "primary"}, {"user_id": "uuid", "role": "backup"}]
Si est vaco, usa manager_user_id como fallback.';


--
-- Name: COLUMN departments.manager_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.departments.manager_user_id IS 'Usuario responsable/jefe del departamento. Recibe notificaciones si notification_recipients est vaco.';


--
-- Name: departments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.departments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: departments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.departments_id_seq OWNED BY public.departments.id;


--
-- Name: dependency_evaluations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dependency_evaluations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    payroll_run_id integer,
    payroll_period character varying(20),
    user_id uuid NOT NULL,
    concept_id integer NOT NULL,
    dependency_id integer NOT NULL,
    evaluation_result boolean NOT NULL,
    evaluation_details jsonb DEFAULT '{}'::jsonb,
    action_taken character varying(20),
    original_amount numeric(15,2),
    final_amount numeric(15,2),
    reduction_reason text,
    evaluated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT dependency_evaluations_action_taken_check CHECK (((action_taken)::text = ANY ((ARRAY['APPLIED'::character varying, 'SKIPPED'::character varying, 'REDUCED'::character varying, 'WARNED'::character varying])::text[])))
);


--
-- Name: TABLE dependency_evaluations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dependency_evaluations IS 'Historial de evaluacin de dependencias durante liquidacin (auditora).';


--
-- Name: dependency_evaluations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.dependency_evaluations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: dependency_evaluations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.dependency_evaluations_id_seq OWNED BY public.dependency_evaluations.id;


--
-- Name: dependency_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dependency_types (
    id integer NOT NULL,
    type_code character varying(30) NOT NULL,
    type_name character varying(100) NOT NULL,
    type_name_i18n jsonb DEFAULT '{}'::jsonb,
    description text,
    icon character varying(50) DEFAULT 'file-text'::character varying,
    color_hex character varying(7) DEFAULT '#6c757d'::character varying,
    requires_expiration boolean DEFAULT true,
    requires_file boolean DEFAULT false,
    requires_family_member boolean DEFAULT false,
    is_system boolean DEFAULT false,
    is_active boolean DEFAULT true,
    display_order integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE dependency_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.dependency_types IS 'Tipos base de dependencias (del sistema). Solo 4 tipos genricos.';


--
-- Name: dependency_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.dependency_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: dependency_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.dependency_types_id_seq OWNED BY public.dependency_types.id;


--
-- Name: dms_access_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_access_log (
    id bigint NOT NULL,
    document_id uuid NOT NULL,
    document_version integer,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    user_name character varying(255),
    user_role character varying(50),
    action character varying(30) NOT NULL,
    action_detail text,
    ip_address character varying(45),
    user_agent text,
    session_id character varying(100),
    device_type character varying(20),
    success boolean DEFAULT true,
    error_message text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: dms_access_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.dms_access_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: dms_access_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.dms_access_log_id_seq OWNED BY public.dms_access_log.id;


--
-- Name: dms_document_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_alerts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid,
    request_id uuid,
    company_id integer NOT NULL,
    alert_type character varying(30) NOT NULL,
    severity character varying(20) DEFAULT 'warning'::character varying,
    title character varying(255) NOT NULL,
    message text,
    user_id uuid NOT NULL,
    is_read boolean DEFAULT false,
    is_dismissed boolean DEFAULT false,
    trigger_date date,
    created_at timestamp without time zone DEFAULT now(),
    read_at timestamp without time zone,
    dismissed_at timestamp without time zone
);


--
-- Name: dms_document_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_categories (
    code character varying(50) NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    icon character varying(50),
    color character varying(20),
    sort_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: dms_document_metadata; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_metadata (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid NOT NULL,
    company_id integer NOT NULL,
    metadata_key character varying(100) NOT NULL,
    metadata_value text,
    data_type character varying(20) DEFAULT 'string'::character varying NOT NULL,
    is_searchable boolean DEFAULT true,
    is_required boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: dms_document_permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_permissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid NOT NULL,
    company_id integer NOT NULL,
    grantee_type character varying(20) NOT NULL,
    grantee_id uuid,
    grantee_role character varying(50),
    permission_level character varying(20) NOT NULL,
    can_view boolean DEFAULT true,
    can_download boolean DEFAULT false,
    can_edit boolean DEFAULT false,
    can_sign boolean DEFAULT false,
    can_approve boolean DEFAULT false,
    can_share boolean DEFAULT false,
    can_delete boolean DEFAULT false,
    valid_from timestamp without time zone DEFAULT now(),
    valid_until timestamp without time zone,
    granted_by uuid NOT NULL,
    granted_at timestamp without time zone DEFAULT now(),
    revoked_by uuid,
    revoked_at timestamp without time zone,
    is_active boolean DEFAULT true
);


--
-- Name: dms_document_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    type_code character varying(50) NOT NULL,
    title character varying(255),
    description text,
    requested_from_type character varying(20) NOT NULL,
    requested_from_id uuid NOT NULL,
    requested_from_name character varying(255),
    requested_by uuid NOT NULL,
    requested_by_name character varying(255),
    priority character varying(20) DEFAULT 'normal'::character varying,
    due_date date,
    status character varying(20) DEFAULT 'pending'::character varying,
    document_id uuid,
    uploaded_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone,
    reminder_sent_at timestamp without time zone,
    reminder_count integer DEFAULT 0
);


--
-- Name: dms_document_statuses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_statuses (
    code character varying(50) NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    color character varying(20),
    icon character varying(50),
    is_active boolean DEFAULT true
);


--
-- Name: dms_document_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_types (
    code character varying(50) NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    category_code character varying(50),
    requires_approval boolean DEFAULT false,
    max_size_mb integer DEFAULT 10,
    allowed_extensions text[],
    retention_days integer DEFAULT 3650,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: dms_document_versions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_document_versions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid NOT NULL,
    company_id integer NOT NULL,
    version_number integer NOT NULL,
    original_filename character varying(255) NOT NULL,
    stored_filename character varying(255) NOT NULL,
    storage_path character varying(500) NOT NULL,
    file_size_bytes bigint NOT NULL,
    mime_type character varying(100) NOT NULL,
    checksum_sha256 character varying(64) NOT NULL,
    change_summary text,
    changed_fields jsonb,
    created_by uuid NOT NULL,
    created_at timestamp without time zone DEFAULT now(),
    created_from_ip character varying(45)
);


--
-- Name: dms_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    document_number character varying(50),
    external_reference character varying(100),
    category_code character varying(10) NOT NULL,
    type_code character varying(50) NOT NULL,
    folder_id uuid,
    parent_document_id uuid,
    title character varying(255) NOT NULL,
    description text,
    original_filename character varying(255) NOT NULL,
    stored_filename character varying(255) NOT NULL,
    storage_path character varying(500) NOT NULL,
    file_size_bytes bigint NOT NULL,
    mime_type character varying(100) NOT NULL,
    file_extension character varying(20) NOT NULL,
    checksum_sha256 character varying(64) NOT NULL,
    owner_type character varying(50) DEFAULT 'user'::character varying NOT NULL,
    owner_id uuid NOT NULL,
    owner_name character varying(255),
    source_module character varying(50),
    source_entity_type character varying(50),
    source_entity_id uuid,
    status character varying(30) DEFAULT 'DRAFT'::character varying NOT NULL,
    previous_status character varying(30),
    status_changed_at timestamp without time zone,
    status_changed_by uuid,
    status_reason text,
    version integer DEFAULT 1 NOT NULL,
    is_current_version boolean DEFAULT true,
    superseded_by_id uuid,
    supersedes_id uuid,
    version_notes text,
    issue_date date,
    effective_date date,
    expiration_date date,
    expiration_alert_days integer DEFAULT 30,
    last_expiration_alert_at timestamp without time zone,
    requires_signature boolean DEFAULT false,
    is_signed boolean DEFAULT false,
    signature_data jsonb,
    signed_by uuid,
    signed_at timestamp without time zone,
    signature_ip character varying(45),
    visibility character varying(20) DEFAULT 'private'::character varying,
    is_confidential boolean DEFAULT false,
    is_sensitive boolean DEFAULT false,
    access_level integer DEFAULT 1,
    is_locked boolean DEFAULT false,
    locked_at timestamp without time zone,
    locked_by uuid,
    locked_reason text,
    lock_expires_at timestamp without time zone,
    is_checked_out boolean DEFAULT false,
    checked_out_by uuid,
    checked_out_at timestamp without time zone,
    checkout_expires_at timestamp without time zone,
    content_text text,
    search_vector tsvector,
    tags character varying[] DEFAULT ARRAY[]::character varying[],
    retention_until date,
    disposal_action character varying(20),
    disposal_date date,
    created_by uuid NOT NULL,
    created_at timestamp without time zone DEFAULT now(),
    updated_by uuid,
    updated_at timestamp without time zone,
    is_deleted boolean DEFAULT false,
    deleted_by uuid,
    deleted_at timestamp without time zone,
    deletion_reason text,
    view_count integer DEFAULT 0,
    download_count integer DEFAULT 0,
    share_count integer DEFAULT 0,
    last_accessed_at timestamp without time zone,
    last_accessed_by uuid
);


--
-- Name: dms_folders; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_folders (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    parent_id uuid,
    name character varying(255) NOT NULL,
    description text,
    full_path character varying(1000),
    depth integer DEFAULT 0,
    owner_type character varying(50) DEFAULT 'company'::character varying,
    owner_id uuid,
    inherit_permissions boolean DEFAULT true,
    default_visibility character varying(20) DEFAULT 'private'::character varying,
    color character varying(7),
    icon character varying(10),
    is_system boolean DEFAULT false,
    folder_type character varying(50),
    is_active boolean DEFAULT true,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: dms_workflow_approvals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_workflow_approvals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    workflow_id uuid NOT NULL,
    document_id uuid NOT NULL,
    company_id integer NOT NULL,
    step_number integer NOT NULL,
    assigned_to uuid NOT NULL,
    assigned_role character varying(50),
    decision character varying(20) DEFAULT 'pending'::character varying,
    decision_comment text,
    decision_at timestamp without time zone,
    delegated_to uuid,
    delegated_at timestamp without time zone,
    delegation_reason text,
    due_at timestamp without time zone,
    reminded_at timestamp without time zone,
    reminder_count integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: dms_workflow_instances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_workflow_instances (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    document_id uuid NOT NULL,
    template_id integer,
    company_id integer NOT NULL,
    name character varying(100) NOT NULL,
    status character varying(20) DEFAULT 'active'::character varying,
    current_step integer DEFAULT 1,
    total_steps integer NOT NULL,
    steps_data jsonb DEFAULT '[]'::jsonb NOT NULL,
    started_at timestamp without time zone DEFAULT now(),
    completed_at timestamp without time zone,
    deadline timestamp without time zone,
    started_by uuid NOT NULL,
    completed_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: dms_workflow_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.dms_workflow_templates (
    id integer NOT NULL,
    company_id integer,
    name character varying(100) NOT NULL,
    description text,
    steps jsonb DEFAULT '[]'::jsonb NOT NULL,
    trigger_on_types character varying[] DEFAULT ARRAY[]::character varying[],
    is_system boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: dms_workflow_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.dms_workflow_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: dms_workflow_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.dms_workflow_templates_id_seq OWNED BY public.dms_workflow_templates.id;


--
-- Name: document_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_categories (
    id integer NOT NULL,
    code character varying(10) NOT NULL,
    name character varying(100) NOT NULL,
    name_en character varying(100),
    description text,
    icon character varying(10),
    color character varying(7),
    parent_id integer,
    sort_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: document_categories_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.document_categories_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: document_categories_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.document_categories_id_seq OWNED BY public.document_categories.id;


--
-- Name: document_statuses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_statuses (
    id integer NOT NULL,
    code character varying(30) NOT NULL,
    name character varying(50) NOT NULL,
    name_en character varying(50),
    description text,
    color character varying(7),
    icon character varying(10),
    sort_order integer DEFAULT 0,
    is_final boolean DEFAULT false,
    allowed_transitions character varying[] DEFAULT ARRAY[]::character varying[]
);


--
-- Name: document_statuses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.document_statuses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: document_statuses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.document_statuses_id_seq OWNED BY public.document_statuses.id;


--
-- Name: document_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_types (
    id integer NOT NULL,
    code character varying(50) NOT NULL,
    category_code character varying(10) NOT NULL,
    name character varying(150) NOT NULL,
    name_en character varying(150),
    description text,
    retention_years integer,
    requires_expiration boolean DEFAULT false,
    requires_signature boolean DEFAULT false,
    is_sensitive boolean DEFAULT false,
    is_auto_generated boolean DEFAULT false,
    required_metadata jsonb DEFAULT '[]'::jsonb,
    optional_metadata jsonb DEFAULT '[]'::jsonb,
    allowed_extensions character varying[] DEFAULT ARRAY['pdf'::text, 'jpg'::text, 'jpeg'::text, 'png'::text, 'doc'::text, 'docx'::text],
    max_file_size_mb integer DEFAULT 10,
    default_visibility character varying(20) DEFAULT 'private'::character varying,
    allowed_roles character varying[] DEFAULT ARRAY['admin'::text, 'hr_manager'::text],
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone
);


--
-- Name: document_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.document_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: document_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.document_types_id_seq OWNED BY public.document_types.id;


--
-- Name: ecosystem_applications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ecosystem_applications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    app_key character varying(100) NOT NULL,
    name text NOT NULL,
    app_type character varying(50),
    platform character varying(100),
    description text,
    status character varying(20) DEFAULT 'planned'::character varying,
    progress integer DEFAULT 0,
    version character varying(20),
    url character varying(500),
    entry_file character varying(500),
    depends_on_modules text[] DEFAULT '{}'::text[],
    users text[] DEFAULT '{}'::text[],
    tech_stack jsonb DEFAULT '{}'::jsonb,
    features jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT ecosystem_applications_app_type_check CHECK (((app_type)::text = ANY ((ARRAY['web'::character varying, 'mobile'::character varying, 'api'::character varying, 'desktop'::character varying])::text[]))),
    CONSTRAINT ecosystem_applications_status_check CHECK (((status)::text = ANY ((ARRAY['planned'::character varying, 'in_progress'::character varying, 'production'::character varying, 'deprecated'::character varying])::text[])))
);


--
-- Name: ecosystem_file_cache; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ecosystem_file_cache (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    file_path character varying(1000) NOT NULL,
    file_type character varying(50),
    file_category character varying(50),
    exports jsonb DEFAULT '{}'::jsonb,
    imports jsonb DEFAULT '{}'::jsonb,
    functions jsonb DEFAULT '{}'::jsonb,
    classes jsonb DEFAULT '{}'::jsonb,
    endpoints jsonb DEFAULT '{}'::jsonb,
    file_size integer,
    line_count integer,
    last_modified timestamp without time zone,
    checksum character varying(64),
    scanned_at timestamp without time zone DEFAULT now(),
    is_valid boolean DEFAULT true
);


--
-- Name: ecosystem_phases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ecosystem_phases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    phase_key character varying(100) NOT NULL,
    name text NOT NULL,
    description text,
    status character varying(20) DEFAULT 'planned'::character varying,
    progress integer DEFAULT 0,
    priority character varying(10) DEFAULT 'medium'::character varying,
    start_date date,
    target_date date,
    completion_date date,
    depends_on text[] DEFAULT '{}'::text[],
    assigned_to character varying(100),
    tags text[] DEFAULT '{}'::text[],
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT ecosystem_phases_priority_check CHECK (((priority)::text = ANY ((ARRAY['critical'::character varying, 'high'::character varying, 'medium'::character varying, 'low'::character varying])::text[]))),
    CONSTRAINT ecosystem_phases_progress_check CHECK (((progress >= 0) AND (progress <= 100))),
    CONSTRAINT ecosystem_phases_status_check CHECK (((status)::text = ANY ((ARRAY['planned'::character varying, 'in_progress'::character varying, 'complete'::character varying, 'blocked'::character varying])::text[])))
);


--
-- Name: ecosystem_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ecosystem_tasks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    task_code character varying(50) NOT NULL,
    phase_id uuid,
    name text NOT NULL,
    description text,
    status character varying(20) DEFAULT 'pending'::character varying,
    progress integer DEFAULT 0,
    priority character varying(10) DEFAULT 'medium'::character varying,
    auto_detected boolean DEFAULT false,
    detection_method character varying(100),
    detection_rule jsonb,
    last_detection_check timestamp without time zone,
    assigned_module character varying(100),
    depends_on text[] DEFAULT '{}'::text[],
    blocks text[] DEFAULT '{}'::text[],
    assigned_to character varying(100),
    assigned_type character varying(20),
    started_at timestamp without time zone,
    completed_at timestamp without time zone,
    verified_by_test character varying(100),
    estimated_hours numeric(5,1),
    actual_hours numeric(5,1),
    tags text[] DEFAULT '{}'::text[],
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT ecosystem_tasks_assigned_type_check CHECK (((assigned_type)::text = ANY ((ARRAY['human'::character varying, 'claude'::character varying, 'auto'::character varying])::text[]))),
    CONSTRAINT ecosystem_tasks_priority_check CHECK (((priority)::text = ANY ((ARRAY['critical'::character varying, 'high'::character varying, 'medium'::character varying, 'low'::character varying])::text[]))),
    CONSTRAINT ecosystem_tasks_progress_check CHECK (((progress >= 0) AND (progress <= 100))),
    CONSTRAINT ecosystem_tasks_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'blocked'::character varying, 'obsolete'::character varying])::text[])))
);


--
-- Name: ecosystem_workflows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ecosystem_workflows (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    workflow_key character varying(100) NOT NULL,
    name text NOT NULL,
    description text,
    module_key character varying(100),
    trigger_type character varying(50),
    trigger_config jsonb,
    steps jsonb DEFAULT '[]'::jsonb NOT NULL,
    is_active boolean DEFAULT true,
    is_auto_generated boolean DEFAULT false,
    source_file character varying(500),
    source_line integer,
    execution_count integer DEFAULT 0,
    last_executed_at timestamp without time zone,
    avg_duration_ms integer,
    tutorial_enabled boolean DEFAULT false,
    tutorial_content jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: email_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_configurations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    institutional_email character varying(255) NOT NULL,
    display_name character varying(255) NOT NULL,
    smtp_host character varying(255) NOT NULL,
    smtp_port integer NOT NULL,
    smtp_user character varying(255) NOT NULL,
    smtp_password text NOT NULL,
    smtp_secure boolean DEFAULT false,
    is_verified boolean DEFAULT false,
    verification_token character varying(255),
    verified_at timestamp without time zone,
    last_verification_attempt timestamp without time zone,
    verification_attempts integer DEFAULT 0,
    daily_limit integer DEFAULT 500,
    monthly_limit integer DEFAULT 10000,
    current_daily_count integer DEFAULT 0,
    current_monthly_count integer DEFAULT 0,
    last_reset_daily timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    last_reset_monthly timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    from_name character varying(255),
    reply_to character varying(255),
    cc_copy character varying(255),
    bcc_copy character varying(255),
    use_company_templates boolean DEFAULT true,
    signature text,
    is_active boolean DEFAULT true,
    suspended boolean DEFAULT false,
    suspended_reason text,
    suspended_at timestamp without time zone,
    last_error text,
    last_error_at timestamp without time zone,
    error_count integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid,
    updated_by uuid,
    CONSTRAINT chk_limits CHECK (((daily_limit > 0) AND (monthly_limit > 0))),
    CONSTRAINT chk_smtp_port CHECK (((smtp_port >= 1) AND (smtp_port <= 65535)))
);


--
-- Name: TABLE email_configurations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_configurations IS 'Configuraciones SMTP por empresa - REQUERIDA para crear empresa';


--
-- Name: COLUMN email_configurations.institutional_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_configurations.institutional_email IS 'Email institucional de la empresa - NICO en todo el sistema';


--
-- Name: COLUMN email_configurations.is_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_configurations.is_verified IS 'Email verificado mediante test de envo SMTP';


--
-- Name: email_configurations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.email_configurations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: email_configurations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.email_configurations_id_seq OWNED BY public.email_configurations.id;


--
-- Name: email_inbound_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_inbound_log (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    message_id character varying(500),
    in_reply_to character varying(500),
    references_header text,
    from_email character varying(255) NOT NULL,
    from_name character varying(255),
    to_email character varying(255) NOT NULL,
    to_name character varying(255),
    cc_emails jsonb DEFAULT '[]'::jsonb,
    subject character varying(1000),
    body_text text,
    body_html text,
    attachments jsonb DEFAULT '[]'::jsonb,
    raw_headers jsonb DEFAULT '{}'::jsonb,
    linked_notification_id uuid,
    linked_thread_id uuid,
    linked_group_id uuid,
    linked_company_id integer,
    linked_user_id integer,
    processing_status character varying(50) DEFAULT 'PENDING'::character varying,
    processing_error text,
    processed_at timestamp without time zone,
    created_message_id uuid,
    response_sent boolean DEFAULT false,
    response_sent_at timestamp without time zone,
    email_provider character varying(50),
    provider_event_id character varying(255),
    spam_score numeric(5,2),
    is_auto_reply boolean DEFAULT false,
    detected_language character varying(10),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE email_inbound_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_inbound_log IS 'Log de todos los emails entrantes recibidos va webhook';


--
-- Name: email_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_logs (
    id integer NOT NULL,
    sender_type character varying(50) NOT NULL,
    sender_id character varying(255),
    email_config_id integer,
    recipient_email character varying(255) NOT NULL,
    recipient_name character varying(255),
    recipient_type character varying(50),
    recipient_id character varying(255),
    subject text NOT NULL,
    body_html text,
    body_text text,
    notification_id integer,
    template_id integer,
    category character varying(100),
    priority character varying(20) DEFAULT 'normal'::character varying,
    has_attachments boolean DEFAULT false,
    attachments jsonb,
    status character varying(50) DEFAULT 'pending'::character varying,
    sent_at timestamp without time zone,
    delivered_at timestamp without time zone,
    opened_at timestamp without time zone,
    clicked_at timestamp without time zone,
    bounced_at timestamp without time zone,
    message_id character varying(255),
    tracking_id uuid DEFAULT gen_random_uuid(),
    error_message text,
    error_code character varying(50),
    retry_count integer DEFAULT 0,
    max_retries integer DEFAULT 3,
    next_retry_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    reply_to_address character varying(255),
    expects_reply boolean DEFAULT false,
    reply_received boolean DEFAULT false,
    reply_received_at timestamp without time zone,
    CONSTRAINT chk_email_status CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'sent'::character varying, 'failed'::character varying, 'bounced'::character varying, 'opened'::character varying, 'clicked'::character varying])::text[]))),
    CONSTRAINT chk_priority CHECK (((priority)::text = ANY ((ARRAY['high'::character varying, 'normal'::character varying, 'low'::character varying])::text[]))),
    CONSTRAINT chk_sender_type CHECK (((sender_type)::text = ANY ((ARRAY['aponnt'::character varying, 'company'::character varying, 'employee'::character varying])::text[])))
);


--
-- Name: TABLE email_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_logs IS 'Log completo de todos los emails enviados en el sistema';


--
-- Name: COLUMN email_logs.tracking_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_logs.tracking_id IS 'UUID nico para tracking de apertura/clicks';


--
-- Name: email_logs_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.email_logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: email_logs_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.email_logs_id_seq OWNED BY public.email_logs.id;


--
-- Name: email_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_templates (
    id integer NOT NULL,
    company_id integer,
    template_key character varying(100) NOT NULL,
    template_name character varying(255) NOT NULL,
    description text,
    subject character varying(500) NOT NULL,
    body_html text NOT NULL,
    body_text text,
    available_variables jsonb,
    category character varying(100),
    is_active boolean DEFAULT true,
    is_default boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid
);


--
-- Name: TABLE email_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_templates IS 'Templates HTML reutilizables por empresa';


--
-- Name: email_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.email_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: email_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.email_templates_id_seq OWNED BY public.email_templates.id;


--
-- Name: email_thread_mapping; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_thread_mapping (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    outbound_message_id character varying(500) NOT NULL,
    notification_id uuid,
    thread_id uuid,
    group_id uuid,
    company_id integer,
    entity_type character varying(50),
    entity_id character varying(100),
    recipient_email character varying(255),
    recipient_name character varying(255),
    recipient_type character varying(50),
    is_active boolean DEFAULT true,
    expires_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE email_thread_mapping; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_thread_mapping IS 'Mapeo entre Message-ID de emails enviados y threads de notificaciones';


--
-- Name: email_verification_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.email_verification_tokens (
    token_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    user_type character varying(50) NOT NULL,
    email character varying(255) NOT NULL,
    token character varying(255) NOT NULL,
    expires_at timestamp without time zone NOT NULL,
    verified_at timestamp without time zone,
    is_verified boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    company_id integer,
    CONSTRAINT email_verification_tokens_user_type_check CHECK (((user_type)::text = ANY ((ARRAY['employee'::character varying, 'vendor'::character varying, 'leader'::character varying, 'supervisor'::character varying, 'partner'::character varying, 'admin'::character varying])::text[])))
);


--
-- Name: TABLE email_verification_tokens; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.email_verification_tokens IS 'Tokens de verificacin de email para todos los tipos de usuarios del sistema';


--
-- Name: COLUMN email_verification_tokens.user_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_verification_tokens.user_type IS 'Tipo de usuario: employee (users table), vendor/leader/supervisor/partner (partners table)';


--
-- Name: COLUMN email_verification_tokens.token; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_verification_tokens.token IS 'Token nico de verificacin (UUID o hash)';


--
-- Name: COLUMN email_verification_tokens.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.email_verification_tokens.expires_at IS 'Fecha de expiracin del token (tpicamente 24-48 horas)';


--
-- Name: employee_assigned_assets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_assigned_assets (
    id integer NOT NULL,
    employee_benefit_id integer NOT NULL,
    user_id uuid NOT NULL,
    asset_type character varying(50) NOT NULL,
    asset_brand character varying(100),
    asset_model character varying(100),
    asset_serial_number character varying(200),
    asset_imei character varying(50),
    asset_plate_number character varying(20),
    asset_vin character varying(50),
    asset_value numeric(15,2),
    depreciation_rate numeric(5,2),
    current_value numeric(15,2),
    asset_condition character varying(30) DEFAULT 'new'::character varying,
    assignment_date date NOT NULL,
    expected_return_date date,
    actual_return_date date,
    status character varying(30) DEFAULT 'assigned'::character varying,
    employee_responsible boolean DEFAULT true,
    deposit_amount numeric(15,2),
    deposit_paid boolean DEFAULT false,
    last_maintenance_date date,
    next_maintenance_date date,
    maintenance_notes text,
    insurance_policy_number character varying(100),
    insurance_company character varying(200),
    insurance_expiration_date date,
    assignment_notes text,
    return_notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    assigned_by uuid
);


--
-- Name: TABLE employee_assigned_assets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.employee_assigned_assets IS 'Activos fsicos asignados a empleados (vehculos, telfonos, computadoras)';


--
-- Name: COLUMN employee_assigned_assets.employee_benefit_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_assigned_assets.employee_benefit_id IS 'SSOT: employee_benefits.id';


--
-- Name: COLUMN employee_assigned_assets.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_assigned_assets.user_id IS 'SSOT: users.user_id';


--
-- Name: COLUMN employee_assigned_assets.asset_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_assigned_assets.asset_type IS 'VEHICLE, MOBILE_PHONE, LAPTOP, DESKTOP, TABLET, OTHER';


--
-- Name: COLUMN employee_assigned_assets.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_assigned_assets.status IS 'assigned, in_use, returned, damaged, lost, stolen';


--
-- Name: employee_assigned_assets_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.employee_assigned_assets_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: employee_assigned_assets_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.employee_assigned_assets_id_seq OWNED BY public.employee_assigned_assets.id;


--
-- Name: employee_benefit_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_benefit_documents (
    id integer NOT NULL,
    employee_benefit_id integer NOT NULL,
    requirement_id integer NOT NULL,
    dms_document_id integer,
    document_file_path character varying(500),
    document_number character varying(100),
    issue_date date,
    expiration_date date,
    issuing_authority character varying(200),
    verification_status character varying(30) DEFAULT 'pending'::character varying,
    verified_at timestamp without time zone,
    verified_by uuid,
    verification_notes text,
    expiration_alert_sent boolean DEFAULT false,
    expiration_alert_sent_at timestamp without time zone,
    is_current boolean DEFAULT true,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    uploaded_by uuid
);


--
-- Name: TABLE employee_benefit_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.employee_benefit_documents IS 'Documentos presentados por empleados para beneficios (SSOT: DMS para archivos fsicos)';


--
-- Name: COLUMN employee_benefit_documents.employee_benefit_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefit_documents.employee_benefit_id IS 'SSOT: employee_benefits.id';


--
-- Name: COLUMN employee_benefit_documents.requirement_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefit_documents.requirement_id IS 'SSOT: benefit_document_requirements.id';


--
-- Name: COLUMN employee_benefit_documents.dms_document_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefit_documents.dms_document_id IS 'SSOT: DMS documents table (cuando est integrado)';


--
-- Name: COLUMN employee_benefit_documents.verification_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefit_documents.verification_status IS 'pending, verified, rejected, expired';


--
-- Name: employee_benefit_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.employee_benefit_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: employee_benefit_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.employee_benefit_documents_id_seq OWNED BY public.employee_benefit_documents.id;


--
-- Name: employee_benefits; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_benefits (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    company_benefit_policy_id integer NOT NULL,
    assigned_amount numeric(15,2),
    assigned_quantity integer,
    effective_from date NOT NULL,
    effective_until date,
    status character varying(30) DEFAULT 'pending_approval'::character varying NOT NULL,
    status_reason text,
    status_changed_at timestamp without time zone,
    status_changed_by uuid,
    beneficiary_type character varying(30),
    beneficiary_name character varying(200),
    beneficiary_relationship character varying(50),
    beneficiary_document_id character varying(50),
    beneficiary_birth_date date,
    beneficiary_metadata jsonb DEFAULT '{}'::jsonb,
    provider_name character varying(200),
    provider_tax_id character varying(50),
    provider_address text,
    provider_contact_info jsonb DEFAULT '{}'::jsonb,
    has_required_documents boolean DEFAULT false,
    documents_last_verified_at timestamp without time zone,
    documents_next_verification_date date,
    renewal_status character varying(30),
    renewal_requested_at timestamp without time zone,
    renewal_approved_at timestamp without time zone,
    internal_notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid
);


--
-- Name: TABLE employee_benefits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.employee_benefits IS 'Beneficios asignados a empleados individuales';


--
-- Name: COLUMN employee_benefits.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefits.user_id IS 'SSOT: users.user_id';


--
-- Name: COLUMN employee_benefits.company_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefits.company_id IS 'SSOT: companies.company_id';


--
-- Name: COLUMN employee_benefits.company_benefit_policy_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefits.company_benefit_policy_id IS 'SSOT: company_benefit_policies.id  benefit_types.id';


--
-- Name: COLUMN employee_benefits.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_benefits.status IS 'pending_approval, approved, active, suspended, cancelled, expired, rejected';


--
-- Name: employee_benefits_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.employee_benefits_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: employee_benefits_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.employee_benefits_id_seq OWNED BY public.employee_benefits.id;


--
-- Name: employee_dependency_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_dependency_documents (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    dependency_id integer NOT NULL,
    family_member_type character varying(20),
    family_member_id integer,
    family_member_name character varying(150),
    issue_date date NOT NULL,
    expiration_date date,
    file_url character varying(500),
    file_name character varying(255),
    file_size integer,
    file_mime_type character varying(100),
    status character varying(20) DEFAULT 'VALID'::character varying,
    days_until_expiration integer,
    replaced_by_id integer,
    is_current boolean DEFAULT true,
    notes text,
    uploaded_by uuid,
    reviewed_by uuid,
    reviewed_at timestamp without time zone,
    review_notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT employee_dependency_documents_family_member_type_check CHECK (((family_member_type)::text = ANY ((ARRAY['SELF'::character varying, 'CHILD'::character varying, 'SPOUSE'::character varying, 'OTHER'::character varying])::text[]))),
    CONSTRAINT employee_dependency_documents_status_check CHECK (((status)::text = ANY ((ARRAY['VALID'::character varying, 'EXPIRING_SOON'::character varying, 'EXPIRED'::character varying, 'PENDING_REVIEW'::character varying])::text[])))
);


--
-- Name: TABLE employee_dependency_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.employee_dependency_documents IS 'Documentos/certificados cargados por empleados que satisfacen dependencias.';


--
-- Name: employee_dependency_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.employee_dependency_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: employee_dependency_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.employee_dependency_documents_id_seq OWNED BY public.employee_dependency_documents.id;


--
-- Name: employee_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_documents (
    id integer NOT NULL,
    "userId" uuid NOT NULL,
    "documentType" public."enum_employee_documents_documentType" NOT NULL,
    "documentNumber" character varying(100),
    "issuingAuthority" character varying(255),
    "issuingCountry" character varying(100),
    "issueDate" timestamp with time zone,
    "expiryDate" timestamp with time zone,
    "documentData" json DEFAULT '{}'::json,
    "frontPhotoPath" character varying(500),
    "backPhotoPath" character varying(500),
    "additionalFiles" json DEFAULT '[]'::json,
    status public.enum_employee_documents_status DEFAULT 'valid'::public.enum_employee_documents_status,
    "alertDays" integer DEFAULT 30,
    "lastAlertSent" timestamp with time zone,
    notes text,
    "isActive" boolean DEFAULT true,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: COLUMN employee_documents."userId"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."userId" IS 'ID del usuario/empleado';


--
-- Name: COLUMN employee_documents."documentType"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."documentType" IS 'Tipo de documento';


--
-- Name: COLUMN employee_documents."documentNumber"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."documentNumber" IS 'Nmero del documento';


--
-- Name: COLUMN employee_documents."issuingAuthority"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."issuingAuthority" IS 'Autoridad emisora del documento';


--
-- Name: COLUMN employee_documents."issuingCountry"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."issuingCountry" IS 'Pas emisor';


--
-- Name: COLUMN employee_documents."issueDate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."issueDate" IS 'Fecha de emisin';


--
-- Name: COLUMN employee_documents."expiryDate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."expiryDate" IS 'Fecha de vencimiento';


--
-- Name: COLUMN employee_documents."documentData"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."documentData" IS 'Datos especficos del documento (categoras de licencia, tipo de visa, etc.)';


--
-- Name: COLUMN employee_documents."frontPhotoPath"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."frontPhotoPath" IS 'Ruta del archivo de foto frontal';


--
-- Name: COLUMN employee_documents."backPhotoPath"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."backPhotoPath" IS 'Ruta del archivo de foto trasera/segunda pgina';


--
-- Name: COLUMN employee_documents."additionalFiles"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."additionalFiles" IS 'Array de rutas de archivos adicionales';


--
-- Name: COLUMN employee_documents.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents.status IS 'Estado actual del documento';


--
-- Name: COLUMN employee_documents."alertDays"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."alertDays" IS 'Das antes del vencimiento para alertar';


--
-- Name: COLUMN employee_documents."lastAlertSent"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."lastAlertSent" IS 'ltima vez que se envi una alerta';


--
-- Name: COLUMN employee_documents.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents.notes IS 'Notas adicionales sobre el documento';


--
-- Name: COLUMN employee_documents."isActive"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_documents."isActive" IS 'Si el documento est activo';


--
-- Name: employee_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.employee_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: employee_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.employee_documents_id_seq OWNED BY public.employee_documents.id;


--
-- Name: employee_locations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_locations (
    id uuid NOT NULL,
    "userId" uuid NOT NULL,
    company_id integer NOT NULL,
    latitude numeric(10,8) NOT NULL,
    longitude numeric(11,8) NOT NULL,
    accuracy double precision,
    altitude double precision,
    heading double precision,
    speed double precision,
    "isWorkingHours" boolean DEFAULT false,
    "isOnBreak" boolean DEFAULT false,
    "isInGeofence" boolean DEFAULT false,
    "currentActivity" public."enum_employee_locations_currentActivity" DEFAULT 'idle'::public."enum_employee_locations_currentActivity",
    "deviceId" character varying(255),
    "appVersion" character varying(255),
    "batteryLevel" integer,
    "connectionType" public."enum_employee_locations_connectionType" DEFAULT 'unknown'::public."enum_employee_locations_connectionType",
    address character varying(255),
    "nearbyLandmarks" json,
    "weatherConditions" json,
    "isPrivacyMode" boolean DEFAULT false,
    "sharingLevel" public."enum_employee_locations_sharingLevel" DEFAULT 'full'::public."enum_employee_locations_sharingLevel",
    "reportedAt" timestamp with time zone NOT NULL,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: COLUMN employee_locations.latitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.latitude IS 'Latitud GPS del empleado';


--
-- Name: COLUMN employee_locations.longitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.longitude IS 'Longitud GPS del empleado';


--
-- Name: COLUMN employee_locations.accuracy; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.accuracy IS 'Precisin en metros del GPS';


--
-- Name: COLUMN employee_locations.altitude; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.altitude IS 'Altitud en metros';


--
-- Name: COLUMN employee_locations.heading; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.heading IS 'Direccin en grados (0-360)';


--
-- Name: COLUMN employee_locations.speed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.speed IS 'Velocidad en m/s';


--
-- Name: COLUMN employee_locations."isWorkingHours"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."isWorkingHours" IS 'Si est en horario laboral';


--
-- Name: COLUMN employee_locations."isOnBreak"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."isOnBreak" IS 'Si est en descanso';


--
-- Name: COLUMN employee_locations."isInGeofence"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."isInGeofence" IS 'Si est dentro del rea laboral permitida';


--
-- Name: COLUMN employee_locations."currentActivity"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."currentActivity" IS 'Actividad actual del empleado';


--
-- Name: COLUMN employee_locations."deviceId"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."deviceId" IS 'ID del dispositivo mvil';


--
-- Name: COLUMN employee_locations."appVersion"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."appVersion" IS 'Versin de la aplicacin mvil';


--
-- Name: COLUMN employee_locations."batteryLevel"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."batteryLevel" IS 'Nivel de batera del dispositivo (0-100)';


--
-- Name: COLUMN employee_locations."connectionType"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."connectionType" IS 'Tipo de conexin del dispositivo';


--
-- Name: COLUMN employee_locations.address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations.address IS 'Direccin aproximada (geocodificacin inversa)';


--
-- Name: COLUMN employee_locations."nearbyLandmarks"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."nearbyLandmarks" IS 'Puntos de referencia cercanos';


--
-- Name: COLUMN employee_locations."weatherConditions"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."weatherConditions" IS 'Condiciones climticas en el momento';


--
-- Name: COLUMN employee_locations."isPrivacyMode"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."isPrivacyMode" IS 'Si el empleado activ modo privacidad';


--
-- Name: COLUMN employee_locations."sharingLevel"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."sharingLevel" IS 'Nivel de compartir ubicacin';


--
-- Name: COLUMN employee_locations."reportedAt"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.employee_locations."reportedAt" IS 'Momento en que se report la ubicacin';


--
-- Name: employee_ppe_consents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.employee_ppe_consents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    consent_type character varying(50) DEFAULT 'PPE_MONITORING'::character varying,
    consent_given boolean DEFAULT false,
    consent_date timestamp with time zone,
    consent_expires timestamp with time zone,
    consent_document_version character varying(20),
    consent_document_hash character varying(64),
    ip_address character varying(45),
    user_agent text,
    revoked boolean DEFAULT false,
    revoked_at timestamp with time zone,
    revocation_reason text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    employee_id uuid NOT NULL
);


--
-- Name: epp_catalog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.epp_catalog (
    id integer NOT NULL,
    company_id integer NOT NULL,
    category_id integer NOT NULL,
    code character varying(50) NOT NULL,
    name character varying(200) NOT NULL,
    description text,
    brand character varying(100),
    model character varying(100),
    certifications jsonb,
    default_lifespan_days integer,
    lifespan_unit character varying(20) DEFAULT 'days'::character varying,
    max_uses integer,
    available_sizes jsonb,
    unit_cost numeric(10,2),
    min_stock_alert integer DEFAULT 5,
    usage_instructions text,
    maintenance_instructions text,
    storage_instructions text,
    disposal_instructions text,
    procedure_id integer,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE epp_catalog; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.epp_catalog IS 'Catalogo de EPP especifico por empresa con vida util y certificaciones';


--
-- Name: epp_catalog_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.epp_catalog_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: epp_catalog_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.epp_catalog_id_seq OWNED BY public.epp_catalog.id;


--
-- Name: epp_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.epp_categories (
    id integer NOT NULL,
    code character varying(20) NOT NULL,
    name_es character varying(100) NOT NULL,
    name_en character varying(100) NOT NULL,
    icon character varying(50),
    body_zone character varying(50),
    iso_reference character varying(50),
    sort_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE epp_categories; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.epp_categories IS 'Categorias globales de EPP segun ISO 45001 y estandares internacionales';


--
-- Name: epp_categories_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.epp_categories_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: epp_categories_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.epp_categories_id_seq OWNED BY public.epp_categories.id;


--
-- Name: epp_deliveries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.epp_deliveries (
    id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    epp_catalog_id integer NOT NULL,
    requirement_id integer,
    delivery_date date DEFAULT CURRENT_DATE NOT NULL,
    delivered_by uuid,
    quantity_delivered integer DEFAULT 1,
    size_delivered character varying(20),
    serial_number character varying(100),
    batch_number character varying(100),
    manufacture_date date,
    expiration_date date,
    calculated_replacement_date date NOT NULL,
    status character varying(30) DEFAULT 'active'::character varying,
    employee_signature_date timestamp without time zone,
    employee_signature_method character varying(30),
    signature_document_url text,
    return_date date,
    return_reason character varying(100),
    return_notes text,
    replaced_by_delivery_id integer,
    notification_30_sent boolean DEFAULT false,
    notification_15_sent boolean DEFAULT false,
    notification_7_sent boolean DEFAULT false,
    notification_expired_sent boolean DEFAULT false,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE epp_deliveries; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.epp_deliveries IS 'Registro de entregas de EPP a empleados con tracking de vencimiento';


--
-- Name: epp_deliveries_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.epp_deliveries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: epp_deliveries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.epp_deliveries_id_seq OWNED BY public.epp_deliveries.id;


--
-- Name: epp_inspections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.epp_inspections (
    id integer NOT NULL,
    delivery_id integer NOT NULL,
    inspection_date date DEFAULT CURRENT_DATE NOT NULL,
    inspector_id uuid NOT NULL,
    condition character varying(30) NOT NULL,
    is_compliant boolean DEFAULT true,
    checklist_results jsonb,
    action_required character varying(50),
    action_notes text,
    action_deadline date,
    action_completed boolean DEFAULT false,
    photos jsonb,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE epp_inspections; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.epp_inspections IS 'Historial de inspecciones periodicas de EPP';


--
-- Name: epp_inspections_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.epp_inspections_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: epp_inspections_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.epp_inspections_id_seq OWNED BY public.epp_inspections.id;


--
-- Name: epp_role_requirements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.epp_role_requirements (
    id integer NOT NULL,
    company_id integer NOT NULL,
    position_id integer NOT NULL,
    epp_catalog_id integer NOT NULL,
    is_mandatory boolean DEFAULT true,
    priority integer DEFAULT 1,
    quantity_required integer DEFAULT 1,
    custom_lifespan_days integer,
    conditions text,
    applicable_work_environments jsonb,
    specific_procedure_id integer,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE epp_role_requirements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.epp_role_requirements IS 'Matriz de EPP requerido por posicion organizacional';


--
-- Name: epp_role_requirements_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.epp_role_requirements_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: epp_role_requirements_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.epp_role_requirements_id_seq OWNED BY public.epp_role_requirements.id;


--
-- Name: extraordinary_licenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.extraordinary_licenses (
    id integer NOT NULL,
    company_id integer NOT NULL,
    type character varying(100) NOT NULL,
    description text,
    days integer NOT NULL,
    day_type character varying(20) DEFAULT 'corrido'::character varying,
    requires_approval boolean DEFAULT true,
    requires_documentation boolean DEFAULT false,
    max_per_year integer,
    advance_notice_days integer DEFAULT 0,
    legal_basis text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT extraordinary_licenses_day_type_check CHECK (((day_type)::text = ANY ((ARRAY['habil'::character varying, 'corrido'::character varying])::text[])))
);


--
-- Name: TABLE extraordinary_licenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.extraordinary_licenses IS 'Licencias extraordinarias segn LCT Argentina';


--
-- Name: COLUMN extraordinary_licenses.type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.extraordinary_licenses.type IS 'Tipo de licencia (Matrimonio, Nacimiento, Fallecimiento, etc.)';


--
-- Name: COLUMN extraordinary_licenses.day_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.extraordinary_licenses.day_type IS 'habil = das hbiles, corrido = das corridos';


--
-- Name: COLUMN extraordinary_licenses.legal_basis; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.extraordinary_licenses.legal_basis IS 'Artculo de la LCT u otra ley aplicable';


--
-- Name: extraordinary_licenses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.extraordinary_licenses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: extraordinary_licenses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.extraordinary_licenses_id_seq OWNED BY public.extraordinary_licenses.id;


--
-- Name: facial_biometric_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.facial_biometric_data (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    face_encoding text NOT NULL,
    face_template bytea,
    quality_score numeric(5,2) DEFAULT 0.0,
    capture_timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    is_active boolean DEFAULT true,
    device_info jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: fingerprint_biometric_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.fingerprint_biometric_data (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    finger_position integer,
    template_data bytea NOT NULL,
    minutiae_data jsonb,
    quality_score numeric(5,2) DEFAULT 0.0,
    capture_timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    is_active boolean DEFAULT true,
    device_info jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: holidays; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.holidays (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    country character varying(100) NOT NULL,
    state_province character varying(100),
    date date NOT NULL,
    name character varying(255) NOT NULL,
    is_national boolean DEFAULT true,
    is_provincial boolean DEFAULT false,
    year integer NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: hour_bank_agreements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_agreements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    template_id integer,
    agreement_type character varying(30) NOT NULL,
    start_date date NOT NULL,
    end_date date,
    document_url text,
    signed_at timestamp with time zone,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE hour_bank_agreements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_agreements IS 'Registro de acuerdos escritos requeridos legalmente';


--
-- Name: hour_bank_balances; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_balances (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    template_id integer,
    current_balance numeric(6,2) DEFAULT 0.00,
    total_accrued numeric(8,2) DEFAULT 0.00,
    total_used numeric(8,2) DEFAULT 0.00,
    total_expired numeric(8,2) DEFAULT 0.00,
    total_paid_out numeric(8,2) DEFAULT 0.00,
    next_expiry_date date,
    next_expiry_hours numeric(5,2),
    last_transaction_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE hour_bank_balances; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_balances IS 'Saldo actual de horas acumuladas por empleado';


--
-- Name: hour_bank_blackout_dates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_blackout_dates (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    template_id integer,
    start_date date NOT NULL,
    end_date date NOT NULL,
    reason character varying(200),
    allow_emergencies boolean DEFAULT false,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE hour_bank_blackout_dates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_blackout_dates IS 'Fechas bloqueadas donde no se permite usar banco';


--
-- Name: hour_bank_blackout_dates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hour_bank_blackout_dates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hour_bank_blackout_dates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hour_bank_blackout_dates_id_seq OWNED BY public.hour_bank_blackout_dates.id;


--
-- Name: hour_bank_budgets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_budgets (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    department_id integer,
    period_start date NOT NULL,
    period_end date NOT NULL,
    period_label character varying(50),
    budget_hours numeric(10,2) DEFAULT 150.00 NOT NULL,
    allocated_hours numeric(10,2) DEFAULT 0.00,
    used_hours numeric(10,2) DEFAULT 0.00,
    available_hours numeric(10,2) GENERATED ALWAYS AS ((budget_hours - allocated_hours)) STORED,
    status character varying(20) DEFAULT 'active'::character varying,
    alert_level character varying(20) DEFAULT 'normal'::character varying,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer
);


--
-- Name: TABLE hour_bank_budgets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_budgets IS 'Presupuestos de horas por periodo para empresa/sucursal/departamento';


--
-- Name: hour_bank_budgets_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hour_bank_budgets_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hour_bank_budgets_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hour_bank_budgets_id_seq OWNED BY public.hour_bank_budgets.id;


--
-- Name: hour_bank_loans; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_loans (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    redemption_request_id uuid,
    hours_borrowed numeric(6,2) NOT NULL,
    interest_rate numeric(4,2) DEFAULT 0,
    interest_hours numeric(6,2) DEFAULT 0,
    total_to_repay numeric(6,2) NOT NULL,
    hours_repaid numeric(6,2) DEFAULT 0,
    balance_remaining numeric(6,2) NOT NULL,
    status character varying(20) DEFAULT 'active'::character varying,
    borrowed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    due_date date,
    fully_repaid_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT valid_loan_status CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying, 'repaid'::character varying, 'overdue'::character varying, 'written_off'::character varying])::text[])))
);


--
-- Name: hour_bank_metrics_aggregated; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_metrics_aggregated (
    id integer NOT NULL,
    aggregation_level character varying(20) NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    department_id integer,
    user_id integer,
    period_type character varying(20) NOT NULL,
    period_date date NOT NULL,
    total_overtime_hours numeric(10,2) DEFAULT 0,
    overtime_to_bank_hours numeric(10,2) DEFAULT 0,
    overtime_to_pay_hours numeric(10,2) DEFAULT 0,
    overtime_pending_hours numeric(10,2) DEFAULT 0,
    bank_hours_used numeric(10,2) DEFAULT 0,
    bank_hours_expired numeric(10,2) DEFAULT 0,
    total_bank_balance numeric(12,2) DEFAULT 0,
    employee_count integer DEFAULT 0,
    avg_balance_per_employee numeric(8,2) DEFAULT 0,
    budget_hours numeric(10,2),
    budget_used_pct numeric(5,2),
    budget_status character varying(20),
    employees_at_risk integer DEFAULT 0,
    avg_health_score numeric(5,2) DEFAULT 100,
    vicious_cycle_employees integer DEFAULT 0,
    estimated_liability numeric(14,2) DEFAULT 0,
    overtime_cost_saved numeric(14,2) DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE hour_bank_metrics_aggregated; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_metrics_aggregated IS 'Metricas agregadas para drill-down en dashboards';


--
-- Name: hour_bank_metrics_aggregated_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hour_bank_metrics_aggregated_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hour_bank_metrics_aggregated_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hour_bank_metrics_aggregated_id_seq OWNED BY public.hour_bank_metrics_aggregated.id;


--
-- Name: hour_bank_pending_decisions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_pending_decisions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    attendance_id uuid,
    overtime_date date NOT NULL,
    overtime_hours numeric(5,2) NOT NULL,
    overtime_type character varying(20),
    if_paid_amount numeric(10,2),
    if_banked_hours numeric(5,2),
    conversion_rate numeric(4,2),
    status character varying(20) DEFAULT 'pending'::character varying,
    decision character varying(10),
    decided_at timestamp with time zone,
    expires_at timestamp with time zone NOT NULL,
    reminder_sent_at timestamp with time zone,
    transaction_id uuid,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE hour_bank_pending_decisions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_pending_decisions IS 'Decisiones pendientes del empleado: cobrar vs acumular';


--
-- Name: hour_bank_redemption_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_redemption_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    previous_status character varying(30),
    new_status character varying(30) NOT NULL,
    changed_by uuid,
    changed_by_role character varying(50),
    comments text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE hour_bank_redemption_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_redemption_history IS 'Historial de cambios de estado de las solicitudes de canje';


--
-- Name: hour_bank_redemption_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_redemption_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    hours_requested numeric(6,2) NOT NULL,
    scheduled_date date NOT NULL,
    scheduled_start_time time without time zone,
    scheduled_end_time time without time zone,
    redemption_type character varying(20) DEFAULT 'early_departure'::character varying,
    balance_at_request numeric(8,2) NOT NULL,
    status character varying(30) DEFAULT 'pending_supervisor'::character varying,
    supervisor_id uuid,
    supervisor_decision character varying(20),
    supervisor_decision_at timestamp without time zone,
    supervisor_comments text,
    hr_approver_id uuid,
    hr_decision character varying(20),
    hr_decision_at timestamp without time zone,
    hr_comments text,
    reason text,
    executed_at timestamp without time zone,
    actual_hours_used numeric(6,2),
    execution_notes text,
    transaction_id uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    is_loan_request boolean DEFAULT false,
    loan_justification text,
    loan_total_debt numeric(6,2),
    CONSTRAINT hour_bank_redemption_requests_hours_requested_check CHECK ((hours_requested > (0)::numeric)),
    CONSTRAINT scheduled_date_future CHECK (((scheduled_date >= CURRENT_DATE) OR ((status)::text = ANY ((ARRAY['executed'::character varying, 'expired'::character varying, 'cancelled'::character varying])::text[])))),
    CONSTRAINT valid_redemption_type CHECK (((redemption_type)::text = ANY ((ARRAY['early_departure'::character varying, 'late_arrival'::character varying, 'full_day'::character varying, 'partial'::character varying])::text[]))),
    CONSTRAINT valid_status CHECK (((status)::text = ANY ((ARRAY['pending_supervisor'::character varying, 'approved_supervisor'::character varying, 'pending_hr'::character varying, 'approved'::character varying, 'rejected_supervisor'::character varying, 'rejected_hr'::character varying, 'cancelled'::character varying, 'executed'::character varying, 'expired'::character varying])::text[])))
);


--
-- Name: TABLE hour_bank_redemption_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_redemption_requests IS 'Solicitudes de canje de horas del banco con workflow de aprobacin';


--
-- Name: hour_bank_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    template_id integer,
    request_type character varying(30) NOT NULL,
    requested_date date NOT NULL,
    end_date date,
    hours_requested numeric(5,2) NOT NULL,
    start_time time without time zone,
    end_time time without time zone,
    reason text,
    status character varying(20) DEFAULT 'pending'::character varying,
    supervisor_id uuid,
    supervisor_status character varying(20),
    supervisor_at timestamp with time zone,
    supervisor_notes text,
    hr_id uuid,
    hr_status character varying(20),
    hr_at timestamp with time zone,
    hr_notes text,
    approved_hours numeric(5,2),
    transaction_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE hour_bank_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_requests IS 'Solicitudes de uso de horas con workflow de aprobacion';


--
-- Name: hour_bank_risk_analysis; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_risk_analysis (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id integer NOT NULL,
    branch_id integer,
    department_id integer,
    analysis_date date DEFAULT CURRENT_DATE NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    total_overtime_hours numeric(8,2) DEFAULT 0,
    hours_to_bank numeric(8,2) DEFAULT 0,
    hours_to_pay numeric(8,2) DEFAULT 0,
    bank_ratio numeric(5,4) GENERATED ALWAYS AS (
CASE
    WHEN (total_overtime_hours > (0)::numeric) THEN (hours_to_bank / total_overtime_hours)
    ELSE (0)::numeric
END) STORED,
    hours_used numeric(8,2) DEFAULT 0,
    hours_expired numeric(8,2) DEFAULT 0,
    current_balance numeric(8,2) DEFAULT 0,
    usage_velocity numeric(6,2) DEFAULT 0,
    accumulation_velocity numeric(6,2) DEFAULT 0,
    burn_rate numeric(5,2) DEFAULT 0,
    months_until_zero numeric(4,1),
    return_generated_overtime numeric(8,2) DEFAULT 0,
    vicious_cycle_ratio numeric(5,4) DEFAULT 0,
    vicious_cycle_risk character varying(20) DEFAULT 'low'::character varying,
    coverage_deficit_hours numeric(8,2) DEFAULT 0,
    projected_overtime_cost numeric(12,2) DEFAULT 0,
    health_score integer DEFAULT 100,
    risk_factors jsonb DEFAULT '[]'::jsonb,
    recommendations jsonb DEFAULT '[]'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE hour_bank_risk_analysis; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_risk_analysis IS 'Analisis de riesgo y salud de cuenta corriente por empleado';


--
-- Name: hour_bank_risk_analysis_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hour_bank_risk_analysis_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hour_bank_risk_analysis_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hour_bank_risk_analysis_id_seq OWNED BY public.hour_bank_risk_analysis.id;


--
-- Name: hour_bank_scheduled_redemptions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_scheduled_redemptions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    scheduled_date date NOT NULL,
    hours_approved numeric(6,2) NOT NULL,
    expected_checkout_time time without time zone,
    expected_checkin_time time without time zone,
    shift_id uuid,
    is_executed boolean DEFAULT false,
    executed_at timestamp without time zone,
    actual_checkout_time time without time zone,
    actual_checkin_time time without time zone,
    compliance_status character varying(20) DEFAULT 'pending'::character varying,
    deviation_minutes integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE hour_bank_scheduled_redemptions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_scheduled_redemptions IS 'Canjes programados para integracin con sistema de asistencia';


--
-- Name: hour_bank_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_templates (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    country_code character varying(3),
    template_code character varying(50) NOT NULL,
    template_name character varying(200) NOT NULL,
    description text,
    is_enabled boolean DEFAULT true,
    conversion_rate_normal numeric(4,2) DEFAULT 1.00,
    conversion_rate_weekend numeric(4,2) DEFAULT 1.50,
    conversion_rate_holiday numeric(4,2) DEFAULT 2.00,
    conversion_rate_night numeric(4,2) DEFAULT 1.20,
    max_accumulation_hours numeric(6,2) DEFAULT 120.00,
    max_monthly_accrual numeric(5,2) DEFAULT 30.00,
    min_balance_for_use numeric(4,2) DEFAULT 0.50,
    expiration_enabled boolean DEFAULT true,
    expiration_months integer DEFAULT 12,
    expiration_warning_days integer DEFAULT 30,
    expired_hours_action character varying(20) DEFAULT 'payout'::character varying,
    employee_choice_enabled boolean DEFAULT true,
    choice_timeout_hours integer DEFAULT 24,
    default_action character varying(10) DEFAULT 'bank'::character varying,
    choice_reminder_hours integer DEFAULT 8,
    min_usage_hours numeric(4,2) DEFAULT 0.50,
    max_usage_hours_per_day numeric(4,2) DEFAULT 8.00,
    allow_partial_day_usage boolean DEFAULT true,
    allow_full_day_usage boolean DEFAULT true,
    allow_early_departure boolean DEFAULT true,
    allow_late_arrival_compensation boolean DEFAULT true,
    requires_supervisor_approval boolean DEFAULT false,
    requires_hr_approval boolean DEFAULT false,
    usage_requires_approval boolean DEFAULT true,
    auto_approve_under_hours numeric(4,2) DEFAULT 2.00,
    advance_notice_days integer DEFAULT 2,
    notify_employee_on_accrual boolean DEFAULT true,
    notify_supervisor_on_accrual boolean DEFAULT true,
    notify_hr_on_accrual boolean DEFAULT true,
    notify_on_low_balance boolean DEFAULT true,
    low_balance_threshold numeric(4,2) DEFAULT 4.00,
    notify_on_high_balance boolean DEFAULT true,
    high_balance_threshold numeric(5,2) DEFAULT 80.00,
    blackout_dates_enabled boolean DEFAULT false,
    max_concurrent_users_percent numeric(4,2) DEFAULT 20.00,
    requires_written_agreement boolean DEFAULT false,
    union_agreement_required boolean DEFAULT false,
    legal_reference character varying(100),
    version integer DEFAULT 1,
    is_current_version boolean DEFAULT true,
    parent_template_id integer,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    budget_enabled boolean DEFAULT false,
    budget_period_months integer DEFAULT 6,
    budget_total_hours numeric(8,2) DEFAULT 150.00,
    budget_alert_threshold_pct numeric(5,2) DEFAULT 80.00,
    budget_critical_threshold_pct numeric(5,2) DEFAULT 95.00,
    max_bank_salary_pct numeric(5,2) DEFAULT 15.00,
    max_monthly_return_hours numeric(5,2) DEFAULT 16.00,
    risk_return_overtime_ratio numeric(4,2) DEFAULT 0.50,
    max_hours_per_redemption numeric(4,1) DEFAULT 8.0,
    min_hours_per_redemption numeric(4,1) DEFAULT 1.0,
    allow_hour_loans boolean DEFAULT false,
    max_loan_hours numeric(6,2) DEFAULT 8.00,
    loan_interest_rate numeric(4,2) DEFAULT 0.00,
    loan_repayment_priority character varying(20) DEFAULT 'mandatory'::character varying,
    max_negative_balance numeric(8,2) DEFAULT '-16.00'::numeric,
    loan_warning_threshold numeric(6,2) DEFAULT '-8.00'::numeric,
    require_loan_justification boolean DEFAULT true,
    loan_approval_level character varying(20) DEFAULT 'hr'::character varying
);


--
-- Name: TABLE hour_bank_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_templates IS 'Plantillas SSOT para parametrizacion de Banco de Horas por sucursal/pais';


--
-- Name: COLUMN hour_bank_templates.conversion_rate_normal; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.conversion_rate_normal IS 'Multiplicador para HE dias normales. 1.0=1:1, 1.5=50% adicional';


--
-- Name: COLUMN hour_bank_templates.expiration_months; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.expiration_months IS 'Meses hasta vencimiento. 0=no vence. Brasil:6-12, Espana:4';


--
-- Name: COLUMN hour_bank_templates.employee_choice_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.employee_choice_enabled IS 'Si empleado elige en tiempo real entre cobrar o acumular';


--
-- Name: COLUMN hour_bank_templates.auto_approve_under_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.auto_approve_under_hours IS 'Auto-aprobar solicitudes menores a X horas. 0=siempre manual';


--
-- Name: COLUMN hour_bank_templates.budget_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.budget_enabled IS 'Habilita control de presupuesto de horas a nivel empresa/sucursal';


--
-- Name: COLUMN hour_bank_templates.budget_period_months; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.budget_period_months IS 'Periodo del presupuesto en meses (ej: 6 = semestral)';


--
-- Name: COLUMN hour_bank_templates.budget_total_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.budget_total_hours IS 'Total de horas presupuestadas para el periodo';


--
-- Name: COLUMN hour_bank_templates.budget_alert_threshold_pct; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.budget_alert_threshold_pct IS 'Porcentaje de uso que dispara alerta amarilla';


--
-- Name: COLUMN hour_bank_templates.budget_critical_threshold_pct; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.budget_critical_threshold_pct IS 'Porcentaje de uso que dispara alerta roja/bloqueo';


--
-- Name: COLUMN hour_bank_templates.max_bank_salary_pct; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.max_bank_salary_pct IS 'Max % del sueldo que puede estar en banco (evita sobreacumulacion)';


--
-- Name: COLUMN hour_bank_templates.max_monthly_return_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.max_monthly_return_hours IS 'Max horas que empleado puede usar por mes sin generar deficit operativo';


--
-- Name: COLUMN hour_bank_templates.risk_return_overtime_ratio; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.risk_return_overtime_ratio IS 'Si devolver genera > este ratio de HE nuevas, hay ciclo vicioso';


--
-- Name: COLUMN hour_bank_templates.max_hours_per_redemption; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.max_hours_per_redemption IS 'Mximo de horas que se pueden canjear por evento';


--
-- Name: COLUMN hour_bank_templates.min_hours_per_redemption; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.min_hours_per_redemption IS 'Mnimo de horas que se pueden canjear por evento';


--
-- Name: COLUMN hour_bank_templates.allow_hour_loans; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.allow_hour_loans IS 'Permite prstamos de horas (saldo negativo)';


--
-- Name: COLUMN hour_bank_templates.max_loan_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.max_loan_hours IS 'Mximo de horas que se pueden pedir prestadas por solicitud';


--
-- Name: COLUMN hour_bank_templates.loan_interest_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.loan_interest_rate IS 'Tasa de inters del prstamo (0.10 = 10%, pides 2h debes 2.2h)';


--
-- Name: COLUMN hour_bank_templates.loan_repayment_priority; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.loan_repayment_priority IS 'mandatory=100% overtime salda deuda, partial=50%, flexible=empleado elige';


--
-- Name: COLUMN hour_bank_templates.max_negative_balance; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.max_negative_balance IS 'Lmite mximo de saldo negativo (ej: -16 = mximo 16h de deuda)';


--
-- Name: COLUMN hour_bank_templates.loan_warning_threshold; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.loan_warning_threshold IS 'Umbral para alertar sobre deuda alta';


--
-- Name: COLUMN hour_bank_templates.require_loan_justification; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.require_loan_justification IS 'Requiere justificacin para prstamos';


--
-- Name: COLUMN hour_bank_templates.loan_approval_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_templates.loan_approval_level IS 'Nivel de aprobacin: supervisor, hr, both';


--
-- Name: hour_bank_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hour_bank_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hour_bank_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hour_bank_templates_id_seq OWNED BY public.hour_bank_templates.id;


--
-- Name: hour_bank_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hour_bank_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    template_id integer,
    transaction_type character varying(20) NOT NULL,
    hours_raw numeric(5,2) NOT NULL,
    conversion_rate numeric(4,2) DEFAULT 1.00,
    hours_final numeric(5,2) NOT NULL,
    balance_before numeric(6,2),
    balance_after numeric(6,2),
    source_type character varying(30),
    source_attendance_id uuid,
    source_request_id uuid,
    expires_at date,
    is_expired boolean DEFAULT false,
    description text,
    notes text,
    status character varying(20) DEFAULT 'completed'::character varying,
    approved_by uuid,
    approved_at timestamp with time zone,
    rejection_reason text,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    overtime_destination character varying(20),
    attendance_id integer,
    return_impact_hours numeric(5,2),
    is_loan boolean DEFAULT false,
    loan_original_hours numeric(6,2),
    loan_interest_hours numeric(6,2) DEFAULT 0,
    loan_repaid boolean DEFAULT false,
    loan_repaid_at timestamp without time zone
);


--
-- Name: TABLE hour_bank_transactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hour_bank_transactions IS 'Historial completo de movimientos del banco de horas';


--
-- Name: COLUMN hour_bank_transactions.overtime_destination; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_transactions.overtime_destination IS 'Destino de la hora extra: bank=acumulada, pay=pagada, pending=sin decidir';


--
-- Name: COLUMN hour_bank_transactions.attendance_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_transactions.attendance_id IS 'Referencia al fichaje que genero esta transaccion';


--
-- Name: COLUMN hour_bank_transactions.return_impact_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.hour_bank_transactions.return_impact_hours IS 'Si es uso, cuantas HE genero cubrir este ausentismo';


--
-- Name: hse_case_number_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hse_case_number_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hse_cases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_cases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    case_number character varying(50),
    source_type character varying(50) NOT NULL,
    source_id uuid,
    medical_certificate_id integer,
    case_type character varying(50) NOT NULL,
    case_subtype character varying(50),
    cie10_code character varying(10),
    cie10_description text,
    body_location character varying(100),
    severity character varying(20),
    days_off integer DEFAULT 0,
    indicated_violations text[],
    violation_notes text,
    correlated_detections uuid[],
    correlation_score numeric(5,2),
    correlation_details jsonb,
    assigned_to integer,
    assigned_at timestamp with time zone,
    investigation_status character varying(50) DEFAULT 'PENDING'::character varying,
    investigation_deadline date,
    investigation_notes text,
    verdict character varying(50),
    verdict_notes text,
    verdict_by integer,
    verdict_at timestamp with time zone,
    confirmed_violations text[],
    training_assigned boolean DEFAULT false,
    training_ids integer[],
    sanction_created boolean DEFAULT false,
    sanction_id integer,
    corrective_actions jsonb,
    preventive_actions jsonb,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    follow_up_notes text,
    external_report_required boolean DEFAULT false,
    external_report_sent boolean DEFAULT false,
    external_report_date date,
    external_report_number character varying(100),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    closed_at timestamp with time zone,
    created_by integer,
    employee_id uuid,
    CONSTRAINT hse_cases_case_type_check CHECK (((case_type)::text = ANY ((ARRAY['ACCIDENTE_TRABAJO'::character varying, 'ENFERMEDAD_PROFESIONAL'::character varying, 'ENFERMEDAD_RELACIONADA'::character varying, 'INCIDENTE_SIN_LESION'::character varying])::text[]))),
    CONSTRAINT hse_cases_investigation_status_check CHECK (((investigation_status)::text = ANY ((ARRAY['PENDING'::character varying, 'ASSIGNED'::character varying, 'IN_PROGRESS'::character varying, 'AWAITING_INFO'::character varying, 'COMPLETED'::character varying, 'CLOSED'::character varying])::text[]))),
    CONSTRAINT hse_cases_severity_check CHECK (((severity)::text = ANY ((ARRAY['LEVE'::character varying, 'MODERADO'::character varying, 'GRAVE'::character varying, 'MUY_GRAVE'::character varying, 'FATAL'::character varying])::text[]))),
    CONSTRAINT hse_cases_source_type_check CHECK (((source_type)::text = ANY ((ARRAY['MEDICAL_CERTIFICATE'::character varying, 'PPE_DETECTION'::character varying, 'MANUAL'::character varying, 'EXTERNAL_REPORT'::character varying])::text[]))),
    CONSTRAINT hse_cases_verdict_check CHECK (((verdict)::text = ANY ((ARRAY['CONFIRMED_VIOLATION'::character varying, 'NOT_CONFIRMED'::character varying, 'UNSAFE_CONDITION'::character varying, 'THIRD_PARTY'::character varying, 'MIXED_CAUSES'::character varying, 'UNDETERMINED'::character varying])::text[])))
);


--
-- Name: hse_company_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_company_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    primary_standard character varying(30) DEFAULT 'ISO45001'::character varying,
    secondary_standards jsonb,
    alert_days_before jsonb DEFAULT '[30, 15, 7, 1]'::jsonb,
    notify_employee boolean DEFAULT true,
    notify_supervisor boolean DEFAULT true,
    notify_hse_manager boolean DEFAULT true,
    notify_hr boolean DEFAULT false,
    block_work_without_epp boolean DEFAULT false,
    require_signature_on_delivery boolean DEFAULT true,
    auto_schedule_inspections boolean DEFAULT true,
    inspection_frequency_days integer DEFAULT 90,
    hse_manager_role_id integer,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE hse_company_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.hse_company_config IS 'Configuracion del modulo HSE por empresa';


--
-- Name: hse_company_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hse_company_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hse_company_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hse_company_config_id_seq OWNED BY public.hse_company_config.id;


--
-- Name: hse_ppe_detections; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_ppe_detections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    zone_config_id uuid,
    detection_timestamp timestamp with time zone DEFAULT now() NOT NULL,
    camera_id character varying(100),
    zone_name character varying(100),
    detected_ppe jsonb,
    missing_ppe text[],
    confidence_scores jsonb,
    confidence_avg numeric(5,2),
    is_anonymous boolean DEFAULT false,
    alert_mode character varying(20) DEFAULT 'INDIVIDUAL'::character varying,
    image_url text,
    image_blob_path text,
    image_retention_until date,
    notification_sent boolean DEFAULT false,
    notification_id uuid,
    training_assigned boolean DEFAULT false,
    training_id integer,
    sanction_created boolean DEFAULT false,
    sanction_id integer,
    hse_case_id uuid,
    status character varying(20) DEFAULT 'NEW'::character varying,
    reviewed_by integer,
    reviewed_at timestamp with time zone,
    review_notes text,
    created_at timestamp with time zone DEFAULT now(),
    azure_request_id character varying(100),
    processing_time_ms integer,
    employee_id uuid,
    CONSTRAINT hse_ppe_detections_status_check CHECK (((status)::text = ANY ((ARRAY['NEW'::character varying, 'NOTIFIED'::character varying, 'REVIEWED'::character varying, 'ACTIONED'::character varying, 'DISMISSED'::character varying])::text[])))
);


--
-- Name: hse_ppe_stats; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_ppe_stats (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    zone_name character varying(100),
    stat_date date NOT NULL,
    total_checks integer DEFAULT 0,
    compliant_count integer DEFAULT 0,
    violation_count integer DEFAULT 0,
    compliance_rate numeric(5,2),
    violations_by_ppe jsonb,
    violations_by_hour jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    employee_id uuid
);


--
-- Name: hse_ppe_stats_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.hse_ppe_stats_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: hse_ppe_stats_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.hse_ppe_stats_id_seq OWNED BY public.hse_ppe_stats.id;


--
-- Name: hse_violation_catalog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_violation_catalog (
    code character varying(50) NOT NULL,
    category character varying(50) NOT NULL,
    name character varying(200) NOT NULL,
    name_short character varying(50),
    description text,
    icon character varying(10),
    is_detectable_by_ai boolean DEFAULT false,
    ai_model_tag character varying(100),
    ai_confidence_threshold numeric(3,2) DEFAULT 0.70,
    is_medical_selectable boolean DEFAULT true,
    related_cie10_codes text[],
    body_locations text[],
    default_training_template_id integer,
    training_is_mandatory boolean DEFAULT true,
    default_sanction_type character varying(50),
    reincidence_threshold integer DEFAULT 3,
    display_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by integer,
    updated_by integer,
    CONSTRAINT hse_violation_catalog_category_check CHECK (((category)::text = ANY ((ARRAY['EPP'::character varying, 'PROCEDIMIENTO'::character varying, 'CONDICION'::character varying])::text[])))
);


--
-- Name: hse_zone_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.hse_zone_configurations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    zone_code character varying(50) NOT NULL,
    zone_name character varying(200) NOT NULL,
    zone_description text,
    required_ppe_codes text[] NOT NULL,
    camera_config jsonb,
    monitoring_schedule jsonb,
    monitoring_enabled boolean DEFAULT true,
    alert_config jsonb DEFAULT '{"period_days": 30, "confidence_min": 0.70, "threshold_warning": 1, "threshold_sanction": 5, "threshold_training": 3, "check_interval_seconds": 300}'::jsonb,
    affected_position_ids integer[],
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by integer
);


--
-- Name: invoices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoices (
    id bigint NOT NULL,
    company_id integer NOT NULL,
    invoice_number character varying(50) NOT NULL,
    billing_period_month integer NOT NULL,
    billing_period_year integer NOT NULL,
    subtotal numeric(12,2) DEFAULT 0 NOT NULL,
    tax_rate numeric(5,2) DEFAULT 0,
    tax_amount numeric(12,2) DEFAULT 0,
    total_amount numeric(12,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    status character varying(20) DEFAULT 'draft'::character varying NOT NULL,
    issue_date date NOT NULL,
    due_date date NOT NULL,
    sent_at timestamp with time zone,
    paid_at timestamp with time zone,
    notes text,
    internal_notes text,
    created_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone
);


--
-- Name: invoices_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.invoices_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: invoices_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.invoices_id_seq OWNED BY public.invoices.id;


--
-- Name: job_application_notes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.job_application_notes (
    id integer NOT NULL,
    application_id integer NOT NULL,
    note_type character varying(50) DEFAULT 'general'::character varying,
    content text NOT NULL,
    is_private boolean DEFAULT false,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT job_application_notes_note_type_check CHECK (((note_type)::text = ANY ((ARRAY['general'::character varying, 'rrhh'::character varying, 'entrevista'::character varying, 'medico'::character varying, 'tecnica'::character varying, 'referencia'::character varying])::text[])))
);


--
-- Name: job_application_notes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.job_application_notes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: job_application_notes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.job_application_notes_id_seq OWNED BY public.job_application_notes.id;


--
-- Name: job_applications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.job_applications (
    id integer NOT NULL,
    company_id integer NOT NULL,
    job_posting_id integer NOT NULL,
    candidate_first_name character varying(100) NOT NULL,
    candidate_last_name character varying(100) NOT NULL,
    candidate_email character varying(255) NOT NULL,
    candidate_phone character varying(50),
    candidate_dni character varying(20),
    candidate_birth_date date,
    candidate_gender character varying(20),
    candidate_nationality character varying(100),
    candidate_address text,
    candidate_city character varying(100),
    candidate_province character varying(100),
    candidate_postal_code character varying(20),
    experience_years integer,
    current_position character varying(255),
    current_company character varying(255),
    education_level character varying(50),
    education_title character varying(255),
    skills jsonb DEFAULT '[]'::jsonb,
    languages jsonb DEFAULT '[]'::jsonb,
    certifications jsonb DEFAULT '[]'::jsonb,
    cv_file_path character varying(500),
    cv_file_name character varying(255),
    cv_uploaded_at timestamp with time zone,
    cover_letter text,
    additional_documents jsonb DEFAULT '[]'::jsonb,
    salary_expectation numeric(12,2),
    availability character varying(50),
    preferred_schedule character varying(100),
    willing_to_relocate boolean DEFAULT false,
    status character varying(50) DEFAULT 'nuevo'::character varying,
    status_history jsonb DEFAULT '[]'::jsonb,
    reviewed_by uuid,
    reviewed_at timestamp with time zone,
    review_notes text,
    review_score integer,
    interview_scheduled_at timestamp with time zone,
    interview_location character varying(255),
    interview_type character varying(50),
    interview_notes text,
    interview_score integer,
    interviewer_id uuid,
    admin_approved_by uuid,
    admin_approved_at timestamp with time zone,
    admin_approval_notes text,
    medical_record_id integer,
    medical_exam_date date,
    medical_result character varying(50),
    medical_observations text,
    medical_restrictions jsonb DEFAULT '[]'::jsonb,
    medical_approved_by uuid,
    medical_approved_at timestamp with time zone,
    hired_at timestamp with time zone,
    hired_by uuid,
    employee_user_id uuid,
    start_date date,
    assigned_department_id integer,
    assigned_position character varying(255),
    final_salary numeric(12,2),
    contract_type character varying(50),
    rejected_at timestamp with time zone,
    rejected_by uuid,
    rejection_reason character varying(255),
    rejection_notes text,
    rejection_stage character varying(50),
    notification_sent_to_medical boolean DEFAULT false,
    notification_sent_at timestamp with time zone,
    notification_id integer,
    source character varying(100),
    referrer_employee_id uuid,
    ip_address character varying(45),
    user_agent text,
    applied_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT job_applications_check CHECK (((interview_score >= 1) AND (review_score <= 10))),
    CONSTRAINT job_applications_review_score_check CHECK (((review_score >= 1) AND (review_score <= 10))),
    CONSTRAINT job_applications_status_check CHECK (((status)::text = ANY ((ARRAY['nuevo'::character varying, 'revision'::character varying, 'entrevista_pendiente'::character varying, 'entrevista_realizada'::character varying, 'aprobado_administrativo'::character varying, 'examen_pendiente'::character varying, 'examen_realizado'::character varying, 'apto'::character varying, 'apto_con_observaciones'::character varying, 'no_apto'::character varying, 'contratado'::character varying, 'rechazado'::character varying, 'desistio'::character varying])::text[])))
);


--
-- Name: TABLE job_applications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.job_applications IS 'Postulaciones a ofertas laborales con flujo completo hasta contratacin';


--
-- Name: job_applications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.job_applications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: job_applications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.job_applications_id_seq OWNED BY public.job_applications.id;


--
-- Name: job_postings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.job_postings (
    id integer NOT NULL,
    company_id integer NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    requirements text,
    responsibilities text,
    department_id integer,
    department_name character varying(100),
    location character varying(255),
    job_type character varying(50) DEFAULT 'full-time'::character varying,
    salary_min numeric(12,2),
    salary_max numeric(12,2),
    salary_currency character varying(3) DEFAULT 'ARS'::character varying,
    salary_period character varying(20) DEFAULT 'monthly'::character varying,
    benefits jsonb DEFAULT '[]'::jsonb,
    status character varying(30) DEFAULT 'draft'::character varying,
    is_public boolean DEFAULT true,
    is_internal boolean DEFAULT false,
    max_applications integer,
    auto_close_date date,
    requires_cv boolean DEFAULT true,
    requires_cover_letter boolean DEFAULT false,
    tags jsonb DEFAULT '[]'::jsonb,
    skills_required jsonb DEFAULT '[]'::jsonb,
    hiring_manager_id uuid,
    recruiter_id uuid,
    views_count integer DEFAULT 0,
    applications_count integer DEFAULT 0,
    posted_at timestamp with time zone,
    closed_at timestamp with time zone,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    search_scope character varying(20) DEFAULT 'external'::character varying,
    internal_matching_enabled boolean DEFAULT true,
    internal_matching_criteria jsonb DEFAULT '{"match_skills": true, "match_education": true, "min_match_score": 50, "match_experience": true, "match_certifications": true}'::jsonb,
    internal_candidates_notified jsonb DEFAULT '[]'::jsonb,
    internal_matching_executed_at timestamp without time zone,
    internal_candidates_count integer DEFAULT 0,
    CONSTRAINT job_postings_job_type_check CHECK (((job_type)::text = ANY ((ARRAY['full-time'::character varying, 'part-time'::character varying, 'contract'::character varying, 'temporary'::character varying, 'internship'::character varying])::text[]))),
    CONSTRAINT job_postings_salary_period_check CHECK (((salary_period)::text = ANY ((ARRAY['hourly'::character varying, 'daily'::character varying, 'weekly'::character varying, 'monthly'::character varying, 'yearly'::character varying])::text[]))),
    CONSTRAINT job_postings_status_check CHECK (((status)::text = ANY ((ARRAY['draft'::character varying, 'active'::character varying, 'paused'::character varying, 'closed'::character varying, 'filled'::character varying])::text[])))
);


--
-- Name: TABLE job_postings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.job_postings IS 'Ofertas laborales publicadas por empresas';


--
-- Name: job_postings_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.job_postings_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: job_postings_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.job_postings_id_seq OWNED BY public.job_postings.id;


--
-- Name: kiosks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.kiosks (
    id integer NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    device_id character varying(100),
    gps_lat numeric(10,8),
    gps_lng numeric(11,8),
    is_configured boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    company_id integer NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    deleted_at timestamp without time zone,
    location text,
    authorized_departments jsonb DEFAULT '[]'::jsonb,
    has_external_reader boolean DEFAULT false,
    reader_model character varying(100),
    reader_config jsonb DEFAULT '{}'::jsonb,
    ip_address character varying(50),
    port integer DEFAULT 9998,
    last_seen timestamp without time zone,
    apk_version character varying(20),
    CONSTRAINT kiosks_both_gps_or_none CHECK ((((gps_lat IS NULL) AND (gps_lng IS NULL)) OR ((gps_lat IS NOT NULL) AND (gps_lng IS NOT NULL)))),
    CONSTRAINT kiosks_gps_lat_range CHECK (((gps_lat >= ('-90'::integer)::numeric) AND (gps_lat <= (90)::numeric))),
    CONSTRAINT kiosks_gps_lng_range CHECK (((gps_lng >= ('-180'::integer)::numeric) AND (gps_lng <= (180)::numeric)))
);


--
-- Name: TABLE kiosks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.kiosks IS 'Kioscos fsicos para registro de asistencia biomtrica';


--
-- Name: COLUMN kiosks.device_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.kiosks.device_id IS 'Identificador nico del dispositivo (MAC, serial, etc.)';


--
-- Name: COLUMN kiosks.is_configured; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.kiosks.is_configured IS 'Indica si el kiosko est completamente configurado (nombre + GPS)';


--
-- Name: kiosks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.kiosks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: kiosks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.kiosks_id_seq OWNED BY public.kiosks.id;


--
-- Name: labor_agreements_catalog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.labor_agreements_catalog (
    id integer NOT NULL,
    code character varying(20) NOT NULL,
    name character varying(300) NOT NULL,
    industry character varying(100),
    union_name character varying(200),
    description text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE labor_agreements_catalog; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.labor_agreements_catalog IS 'Catlogo de convenios colectivos de trabajo';


--
-- Name: labor_agreements_catalog_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.labor_agreements_catalog_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: labor_agreements_catalog_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.labor_agreements_catalog_id_seq OWNED BY public.labor_agreements_catalog.id;


--
-- Name: labor_agreements_v2; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.labor_agreements_v2 (
    id integer NOT NULL,
    country_id integer,
    company_id integer,
    code character varying(50) NOT NULL,
    name character varying(300) NOT NULL,
    short_name character varying(100),
    industry character varying(200),
    legal_references jsonb DEFAULT '[]'::jsonb,
    effective_date date,
    expiration_date date,
    base_work_hours_weekly numeric(5,2) DEFAULT 48,
    base_work_hours_daily numeric(5,2) DEFAULT 8,
    overtime_threshold_daily numeric(5,2) DEFAULT 8,
    overtime_50_multiplier numeric(4,2) DEFAULT 1.50,
    overtime_100_multiplier numeric(4,2) DEFAULT 2.00,
    night_shift_multiplier numeric(4,2) DEFAULT 1.00,
    vacation_days_by_seniority jsonb DEFAULT '[{"days": 14, "max_years": 5, "min_years": 0}, {"days": 21, "max_years": 10, "min_years": 5}, {"days": 28, "max_years": 20, "min_years": 10}, {"days": 35, "max_years": null, "min_years": 20}]'::jsonb,
    receipt_legal_text text,
    receipt_footer_text text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: labor_agreements_v2_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.labor_agreements_v2_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: labor_agreements_v2_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.labor_agreements_v2_id_seq OWNED BY public.labor_agreements_v2.id;


--
-- Name: late_arrival_authorizations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.late_arrival_authorizations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    employee_id uuid NOT NULL,
    company_id integer NOT NULL,
    request_date date DEFAULT CURRENT_DATE NOT NULL,
    scheduled_time time without time zone NOT NULL,
    actual_arrival_time time without time zone,
    minutes_late integer NOT NULL,
    reason text,
    shift_id uuid,
    shift_name character varying(100),
    requested_authorizer_id uuid,
    actual_authorizer_id uuid,
    authorizer_position character varying(200),
    status character varying(50) DEFAULT 'pending'::character varying NOT NULL,
    authorization_window_start timestamp without time zone,
    authorization_window_end timestamp without time zone,
    decision_timestamp timestamp without time zone,
    decision_reason text,
    notification_sent_at timestamp without time zone,
    notification_channels jsonb DEFAULT '[]'::jsonb,
    escalation_level integer DEFAULT 0,
    escalated_at timestamp without time zone,
    attendance_id uuid,
    completed_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE late_arrival_authorizations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.late_arrival_authorizations IS 'Stores late arrival authorization requests and their resolution';


--
-- Name: learning_patterns; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.learning_patterns (
    id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    test_count integer DEFAULT 0,
    total_passed integer DEFAULT 0,
    total_failed integer DEFAULT 0,
    last_score integer DEFAULT 0,
    patterns_json jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: learning_patterns_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.learning_patterns_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: learning_patterns_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.learning_patterns_id_seq OWNED BY public.learning_patterns.id;


--
-- Name: legal_ai_analysis; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_ai_analysis (
    id integer NOT NULL,
    case_id integer,
    company_id integer NOT NULL,
    analysis_type character varying(50) NOT NULL,
    prompt_used text,
    analysis_result text NOT NULL,
    confidence_score numeric(3,2),
    structured_data jsonb,
    related_deadline_id integer,
    related_document_id integer,
    model_used character varying(50) DEFAULT 'llama3.1:8b'::character varying,
    tokens_used integer,
    processing_time_ms integer,
    is_reviewed boolean DEFAULT false,
    reviewed_by uuid,
    reviewed_at timestamp without time zone,
    review_notes text,
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_ai_analysis_analysis_type_check CHECK (((analysis_type)::text = ANY ((ARRAY['risk_assessment'::character varying, 'case_summary'::character varying, 'deadline_alert'::character varying, 'pattern_detection'::character varying, 'recommendation'::character varying, 'document_analysis'::character varying, 'precedent_search'::character varying, 'exposure_calculation'::character varying, 'timeline_analysis'::character varying, 'employee_history'::character varying])::text[])))
);


--
-- Name: TABLE legal_ai_analysis; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_ai_analysis IS 'Analisis de IA (Ollama) sobre casos legales';


--
-- Name: legal_ai_analysis_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_ai_analysis_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_ai_analysis_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_ai_analysis_id_seq OWNED BY public.legal_ai_analysis.id;


--
-- Name: legal_case_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_case_documents (
    id integer NOT NULL,
    case_id integer NOT NULL,
    stage_id integer,
    timeline_event_id integer,
    document_type character varying(50) NOT NULL,
    file_name character varying(500) NOT NULL,
    file_path character varying(1000) NOT NULL,
    file_size integer,
    mime_type character varying(100),
    document_date date,
    document_number character varying(100),
    title character varying(500) NOT NULL,
    description text,
    source character varying(50),
    is_confidential boolean DEFAULT false,
    is_original boolean DEFAULT false,
    is_certified boolean DEFAULT false,
    from_employee_360 boolean DEFAULT false,
    original_table character varying(100),
    original_id integer,
    uploaded_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    expects_response boolean DEFAULT false,
    response_type character varying(50),
    response_deadline date,
    response_received boolean DEFAULT false,
    response_received_at timestamp without time zone,
    response_document_id integer,
    is_locked boolean DEFAULT false,
    locked_at timestamp without time zone,
    lock_reason character varying(255),
    edit_window_hours integer DEFAULT 72,
    can_edit_until timestamp without time zone,
    CONSTRAINT legal_case_documents_document_type_check CHECK (((document_type)::text = ANY ((ARRAY['employment_contract'::character varying, 'salary_receipt'::character varying, 'warning_letter'::character varying, 'suspension_letter'::character varying, 'termination_letter'::character varying, 'resignation_letter'::character varying, 'carta_documento'::character varying, 'telegrama'::character varying, 'email_evidence'::character varying, 'internal_memo'::character varying, 'acuse_recibo'::character varying, 'constancia_entrega'::character varying, 'respuesta_empleado'::character varying, 'descargo'::character varying, 'demanda'::character varying, 'contestacion'::character varying, 'prueba_documental'::character varying, 'prueba_testimonial'::character varying, 'prueba_pericial'::character varying, 'alegato'::character varying, 'sentencia'::character varying, 'recurso'::character varying, 'resolucion'::character varying, 'acta_mediacion'::character varying, 'acuerdo_mediacion'::character varying, 'citacion_mediacion'::character varying, 'medical_certificate'::character varying, 'attendance_report'::character varying, 'witness_statement'::character varying, 'photo_evidence'::character varying, 'video_evidence'::character varying, 'informe_tecnico'::character varying, 'dictamen_pericial'::character varying, 'expediente_completo'::character varying, 'other'::character varying])::text[]))),
    CONSTRAINT legal_case_documents_response_type_check CHECK (((response_type IS NULL) OR ((response_type)::text = ANY ((ARRAY['acuse_recibo'::character varying, 'contestacion_extrajudicial'::character varying, 'contestacion_judicial'::character varying, 'notificacion_judicial'::character varying, 'resolucion'::character varying, 'apelacion'::character varying, 'recurso_extraordinario'::character varying, 'none'::character varying])::text[])))),
    CONSTRAINT legal_case_documents_source_check CHECK (((source)::text = ANY ((ARRAY['internal'::character varying, 'employee'::character varying, 'court'::character varying, 'opposing_party'::character varying, 'third_party'::character varying, 'auto_generated'::character varying])::text[])))
);


--
-- Name: TABLE legal_case_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_case_documents IS 'Documentos adjuntos al expediente legal';


--
-- Name: COLUMN legal_case_documents.expects_response; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_case_documents.expects_response IS 'Indica si este documento espera una respuesta (acuse, contestacin)';


--
-- Name: COLUMN legal_case_documents.response_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_case_documents.response_type IS 'Tipo de respuesta esperada';


--
-- Name: COLUMN legal_case_documents.can_edit_until; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_case_documents.can_edit_until IS 'Fecha lmite para editar (despus se bloquea)';


--
-- Name: legal_case_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_case_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_case_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_case_documents_id_seq OWNED BY public.legal_case_documents.id;


--
-- Name: legal_case_parties; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_case_parties (
    id integer NOT NULL,
    case_id integer NOT NULL,
    party_type character varying(30) NOT NULL,
    name character varying(255) NOT NULL,
    role_description character varying(255),
    email character varying(255),
    phone character varying(50),
    address text,
    is_internal boolean DEFAULT false,
    user_id uuid,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_case_parties_party_type_check CHECK (((party_type)::text = ANY ((ARRAY['plaintiff'::character varying, 'defendant'::character varying, 'witness'::character varying, 'expert'::character varying, 'mediator'::character varying, 'judge'::character varying, 'lawyer'::character varying, 'union_rep'::character varying, 'other'::character varying])::text[])))
);


--
-- Name: TABLE legal_case_parties; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_case_parties IS 'Partes involucradas en el caso (testigos, peritos, etc)';


--
-- Name: legal_case_parties_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_case_parties_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_case_parties_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_case_parties_id_seq OWNED BY public.legal_case_parties.id;


--
-- Name: legal_case_stages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_case_stages (
    id integer NOT NULL,
    case_id integer NOT NULL,
    stage character varying(30) NOT NULL,
    sub_status character varying(50) NOT NULL,
    description text,
    notes text,
    start_date timestamp without time zone DEFAULT now(),
    end_date timestamp without time zone,
    outcome character varying(50),
    outcome_details text,
    recorded_by uuid,
    sequence_order integer,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_case_stages_stage_check CHECK (((stage)::text = ANY ((ARRAY['prejudicial'::character varying, 'mediation'::character varying, 'judicial'::character varying, 'appeal'::character varying, 'execution'::character varying, 'closed'::character varying])::text[])))
);


--
-- Name: TABLE legal_case_stages; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_case_stages IS 'Etapas del workflow legal: prejudicial -> mediacion -> judicial';


--
-- Name: legal_case_stages_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_case_stages_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_case_stages_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_case_stages_id_seq OWNED BY public.legal_case_stages.id;


--
-- Name: legal_case_timeline_events; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_case_timeline_events (
    id integer NOT NULL,
    case_id integer NOT NULL,
    stage_id integer,
    event_type character varying(50) NOT NULL,
    title character varying(500) NOT NULL,
    description text,
    event_date timestamp without time zone NOT NULL,
    importance character varying(20) DEFAULT 'normal'::character varying,
    is_public boolean DEFAULT true,
    is_milestone boolean DEFAULT false,
    document_id integer,
    related_event_id integer,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_case_timeline_events_event_type_check CHECK (((event_type)::text = ANY ((ARRAY['document_sent'::character varying, 'document_received'::character varying, 'document_filed'::character varying, 'hearing_scheduled'::character varying, 'hearing_held'::character varying, 'hearing_postponed'::character varying, 'resolution_issued'::character varying, 'sentence_issued'::character varying, 'appeal_filed'::character varying, 'notification_sent'::character varying, 'notification_received'::character varying, 'payment_made'::character varying, 'payment_received'::character varying, 'stage_change'::character varying, 'status_change'::character varying, 'note_added'::character varying, 'meeting_held'::character varying, 'deadline_set'::character varying, 'deadline_met'::character varying, 'deadline_missed'::character varying, 'alert_triggered'::character varying, 'other'::character varying])::text[]))),
    CONSTRAINT legal_case_timeline_events_importance_check CHECK (((importance)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'critical'::character varying])::text[])))
);


--
-- Name: TABLE legal_case_timeline_events; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_case_timeline_events IS 'Linea de tiempo de eventos del caso';


--
-- Name: legal_case_timeline_events_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_case_timeline_events_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_case_timeline_events_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_case_timeline_events_id_seq OWNED BY public.legal_case_timeline_events.id;


--
-- Name: legal_cases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_cases (
    id integer NOT NULL,
    company_id integer NOT NULL,
    case_number character varying(50) NOT NULL,
    external_case_number character varying(100),
    case_type character varying(50) NOT NULL,
    employee_id uuid NOT NULL,
    employee_name character varying(255),
    employee_position character varying(255),
    employee_department character varying(255),
    employee_hire_date date,
    employee_termination_date date,
    title character varying(500) NOT NULL,
    description text,
    claimed_amount numeric(15,2),
    currency character varying(3) DEFAULT 'ARS'::character varying,
    plaintiff_lawyer character varying(255),
    plaintiff_lawyer_contact text,
    defendant_lawyer character varying(255),
    defendant_lawyer_id uuid,
    jurisdiction character varying(100),
    jurisdiction_code character varying(10),
    judge_name character varying(255),
    current_stage character varying(30) DEFAULT 'prejudicial'::character varying,
    current_sub_status character varying(50),
    resolution_type character varying(30),
    resolution_amount numeric(15,2),
    resolution_date date,
    resolution_summary text,
    incident_date date,
    notification_date date,
    filing_date date,
    priority character varying(20) DEFAULT 'normal'::character varying,
    risk_assessment character varying(20),
    estimated_exposure numeric(15,2),
    is_active boolean DEFAULT true,
    is_confidential boolean DEFAULT false,
    requires_reserve boolean DEFAULT false,
    reserve_amount numeric(15,2),
    employee_360_snapshot jsonb,
    created_by uuid,
    assigned_to uuid,
    tags text[],
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    closed_at timestamp without time zone,
    CONSTRAINT legal_cases_case_type_check CHECK (((case_type)::text = ANY ((ARRAY['lawsuit_employee'::character varying, 'lawsuit_company'::character varying, 'labor_claim'::character varying, 'mediation_request'::character varying, 'administrative_claim'::character varying, 'union_dispute'::character varying, 'workplace_accident'::character varying, 'occupational_disease'::character varying, 'wrongful_termination'::character varying, 'discrimination'::character varying, 'harassment'::character varying, 'other'::character varying])::text[]))),
    CONSTRAINT legal_cases_current_stage_check CHECK (((current_stage)::text = ANY ((ARRAY['prejudicial'::character varying, 'mediation'::character varying, 'judicial'::character varying, 'appeal'::character varying, 'execution'::character varying, 'closed'::character varying])::text[]))),
    CONSTRAINT legal_cases_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT legal_cases_resolution_type_check CHECK (((resolution_type)::text = ANY ((ARRAY['favorable'::character varying, 'unfavorable'::character varying, 'partial'::character varying, 'settlement'::character varying, 'withdrawal'::character varying, 'dismissal'::character varying, 'prescription'::character varying, 'in_progress'::character varying])::text[]))),
    CONSTRAINT legal_cases_risk_assessment_check CHECK (((risk_assessment)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'very_high'::character varying])::text[])))
);


--
-- Name: TABLE legal_cases; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_cases IS 'Expedientes legales - Demandas, reclamos, mediaciones';


--
-- Name: legal_cases_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_cases_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_cases_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_cases_id_seq OWNED BY public.legal_cases.id;


--
-- Name: legal_communication_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_communication_types (
    id character varying(50) NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    category character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    legal_basis text,
    legal_requirements text,
    requires_response boolean DEFAULT false,
    response_days integer DEFAULT 5,
    requires_witness boolean DEFAULT false,
    requires_signature boolean DEFAULT true,
    requires_notification_receipt boolean DEFAULT true,
    template_content text,
    creates_antecedent boolean DEFAULT true,
    max_before_escalation integer,
    escalation_type_id character varying(50),
    is_active boolean DEFAULT true,
    display_order integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT legal_communication_types_category_check CHECK (((category)::text = ANY ((ARRAY['disciplinaria'::character varying, 'informativa'::character varying, 'contractual'::character varying, 'administrativa'::character varying, 'despido'::character varying])::text[]))),
    CONSTRAINT legal_communication_types_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[])))
);


--
-- Name: TABLE legal_communication_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_communication_types IS 'Tipos de comunicaciones legales segn LCT Argentina';


--
-- Name: COLUMN legal_communication_types.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_communication_types.category IS 'Categora: disciplinaria, informativa, contractual, administrativa, despido';


--
-- Name: COLUMN legal_communication_types.severity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_communication_types.severity IS 'Severidad: low (informacin), medium (advertencia), high (sancin), critical (despido)';


--
-- Name: COLUMN legal_communication_types.legal_basis; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_communication_types.legal_basis IS 'Artculos de la LCT que fundamentan este tipo de comunicacin';


--
-- Name: COLUMN legal_communication_types.creates_antecedent; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_communication_types.creates_antecedent IS 'Si esta comunicacin crea un antecedente laboral permanente';


--
-- Name: legal_communications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_communications (
    id character varying(100) NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    type_id character varying(50) NOT NULL,
    reference_number character varying(100) NOT NULL,
    subject character varying(500) NOT NULL,
    description text,
    facts_description text,
    legal_articles text,
    status character varying(50) DEFAULT 'draft'::character varying NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    scheduled_date date,
    sent_date timestamp without time zone,
    delivery_date timestamp without time zone,
    response_deadline date,
    response_date timestamp without time zone,
    closed_date timestamp without time zone,
    employee_response text,
    employee_accepted boolean,
    witness_1_name character varying(255),
    witness_1_id character varying(50),
    witness_1_signature boolean DEFAULT false,
    witness_2_name character varying(255),
    witness_2_id character varying(50),
    witness_2_signature boolean DEFAULT false,
    pdf_path text,
    signed_pdf_path text,
    attachments jsonb DEFAULT '[]'::jsonb,
    created_by uuid NOT NULL,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    is_locked boolean DEFAULT false,
    locked_at timestamp without time zone,
    edit_count integer DEFAULT 0,
    last_edited_by uuid,
    last_edited_at timestamp without time zone,
    is_deleted boolean DEFAULT false,
    deleted_at timestamp without time zone,
    deleted_by uuid,
    deletion_reason text,
    CONSTRAINT legal_communications_status_check CHECK (((status)::text = ANY ((ARRAY['draft'::character varying, 'generated'::character varying, 'sent'::character varying, 'delivered'::character varying, 'responded'::character varying, 'closed'::character varying, 'expired'::character varying])::text[])))
);


--
-- Name: legal_deadlines; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_deadlines (
    id integer NOT NULL,
    case_id integer NOT NULL,
    stage_id integer,
    company_id integer NOT NULL,
    deadline_type character varying(50) NOT NULL,
    title character varying(500) NOT NULL,
    description text,
    due_date timestamp without time zone NOT NULL,
    reminder_date timestamp without time zone,
    alert_days_before integer DEFAULT 3,
    status character varying(20) DEFAULT 'pending'::character varying,
    completed_at timestamp without time zone,
    completed_by uuid,
    priority character varying(20) DEFAULT 'normal'::character varying,
    assigned_to uuid,
    notify_users uuid[],
    notification_id integer,
    notification_group_id character varying(100),
    notifications_sent jsonb DEFAULT '[]'::jsonb,
    is_recurring boolean DEFAULT false,
    recurrence_pattern character varying(50),
    recurrence_end_date date,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_deadlines_deadline_type_check CHECK (((deadline_type)::text = ANY ((ARRAY['response_deadline'::character varying, 'appeal_deadline'::character varying, 'evidence_deadline'::character varying, 'hearing_date'::character varying, 'payment_deadline'::character varying, 'filing_deadline'::character varying, 'prescription_date'::character varying, 'mediation_deadline'::character varying, 'internal_review'::character varying, 'report_due'::character varying, 'custom'::character varying])::text[]))),
    CONSTRAINT legal_deadlines_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT legal_deadlines_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'completed'::character varying, 'overdue'::character varying, 'cancelled'::character varying, 'extended'::character varying])::text[])))
);


--
-- Name: TABLE legal_deadlines; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_deadlines IS 'Vencimientos y plazos procesales integrados con notificaciones';


--
-- Name: legal_deadlines_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_deadlines_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_deadlines_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_deadlines_id_seq OWNED BY public.legal_deadlines.id;


--
-- Name: legal_document_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_document_alerts (
    id integer NOT NULL,
    document_id integer,
    case_id integer,
    company_id integer,
    alert_type character varying(50) NOT NULL,
    message text NOT NULL,
    severity character varying(20) DEFAULT 'warning'::character varying,
    is_resolved boolean DEFAULT false,
    resolved_at timestamp without time zone,
    resolved_by uuid,
    due_date date,
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT legal_document_alerts_severity_check CHECK (((severity)::text = ANY ((ARRAY['info'::character varying, 'warning'::character varying, 'error'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT legal_document_alerts_type_check CHECK (((alert_type)::text = ANY ((ARRAY['missing_acuse'::character varying, 'response_overdue'::character varying, 'edit_window_expiring'::character varying, 'document_locked'::character varying, 'missing_attachment'::character varying, 'deadline_approaching'::character varying, 'action_required'::character varying])::text[])))
);


--
-- Name: TABLE legal_document_alerts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_document_alerts IS 'Alertas de documentos legales pendientes - acuses, respuestas, vencimientos';


--
-- Name: legal_document_alerts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_document_alerts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_document_alerts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_document_alerts_id_seq OWNED BY public.legal_document_alerts.id;


--
-- Name: legal_edit_authorizations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.legal_edit_authorizations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    record_id integer NOT NULL,
    record_table character varying(50) NOT NULL,
    record_type character varying(50) NOT NULL,
    requested_by uuid NOT NULL,
    requested_at timestamp without time zone DEFAULT now(),
    request_reason text NOT NULL,
    action_type character varying(20) NOT NULL,
    proposed_changes jsonb,
    priority character varying(20) DEFAULT 'normal'::character varying,
    status character varying(20) DEFAULT 'pending'::character varying,
    authorized_by uuid,
    authorized_at timestamp without time zone,
    authorization_response text,
    current_step integer DEFAULT 1,
    escalated_at timestamp without time zone,
    escalation_reason character varying(255),
    authorization_window_start timestamp without time zone,
    authorization_window_end timestamp without time zone,
    window_used boolean DEFAULT false,
    window_used_at timestamp without time zone,
    window_action_performed character varying(50),
    notification_id integer,
    notification_group_id character varying(100),
    jurisdiction_code character varying(10),
    audit_trail jsonb DEFAULT '[]'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    expires_at timestamp without time zone,
    CONSTRAINT chk_window_dates CHECK (((authorization_window_end IS NULL) OR (authorization_window_start IS NULL) OR (authorization_window_end > authorization_window_start))),
    CONSTRAINT legal_edit_authorizations_action_type_check CHECK (((action_type)::text = ANY ((ARRAY['edit'::character varying, 'delete'::character varying])::text[]))),
    CONSTRAINT legal_edit_authorizations_current_step_check CHECK ((current_step = ANY (ARRAY[1, 2]))),
    CONSTRAINT legal_edit_authorizations_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'urgent'::character varying])::text[]))),
    CONSTRAINT legal_edit_authorizations_record_table_check CHECK (((record_table)::text = ANY ((ARRAY['legal_communications'::character varying, 'user_legal_issues'::character varying])::text[]))),
    CONSTRAINT legal_edit_authorizations_request_reason_check CHECK ((length(request_reason) >= 10)),
    CONSTRAINT legal_edit_authorizations_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'expired'::character varying, 'cancelled'::character varying, 'escalated'::character varying])::text[])))
);


--
-- Name: TABLE legal_edit_authorizations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.legal_edit_authorizations IS 'Autorizaciones para edicin/eliminacin de registros legales bloqueados';


--
-- Name: COLUMN legal_edit_authorizations.record_table; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_edit_authorizations.record_table IS 'Tabla origen: legal_communications o user_legal_issues';


--
-- Name: COLUMN legal_edit_authorizations.current_step; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_edit_authorizations.current_step IS '1=RRHH, 2=Gerencia Legal/Supervisor';


--
-- Name: COLUMN legal_edit_authorizations.authorization_window_end; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_edit_authorizations.authorization_window_end IS 'Usuario tiene 24h post-aprobacin para actuar';


--
-- Name: COLUMN legal_edit_authorizations.jurisdiction_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.legal_edit_authorizations.jurisdiction_code IS 'Cdigo pas (ARG, BRA, etc) para contexto legal';


--
-- Name: legal_edit_authorizations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.legal_edit_authorizations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: legal_edit_authorizations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.legal_edit_authorizations_id_seq OWNED BY public.legal_edit_authorizations.id;


--
-- Name: medical_absence_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_absence_types (
    code character varying(50) NOT NULL,
    name character varying(200) NOT NULL,
    description text,
    category character varying(50) NOT NULL,
    subtypes jsonb,
    requires_hse_review boolean DEFAULT false,
    requires_cie10 boolean DEFAULT true,
    requires_body_location boolean DEFAULT false,
    requires_violation_check boolean DEFAULT false,
    legal_framework text,
    display_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT medical_absence_types_category_check CHECK (((category)::text = ANY ((ARRAY['ENFERMEDAD_COMUN'::character varying, 'ENFERMEDAD_PROFESIONAL'::character varying, 'ACCIDENTE_TRABAJO'::character varying, 'ENFERMEDAD_RELACIONADA'::character varying])::text[])))
);


--
-- Name: medical_certificates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_certificates (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    certificate_number character varying(100),
    issue_date date DEFAULT CURRENT_DATE NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    requested_days integer NOT NULL,
    diagnosis_code character varying(50),
    diagnosis character varying(500),
    symptoms text,
    has_visited_doctor boolean DEFAULT true,
    medical_center character varying(255),
    attending_physician character varying(255),
    medical_prescription text,
    questionnaire jsonb,
    status character varying(50) DEFAULT 'pending'::character varying,
    auditor_id uuid,
    auditor_response text,
    final_diagnosis character varying(500),
    diagnosis_category character varying(100),
    doctor_observations text,
    medical_recommendations text,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    treating_physician character varying(255),
    treating_physician_license character varying(100),
    medical_institution character varying(255),
    notify_art boolean DEFAULT false,
    art_notified boolean DEFAULT false,
    art_notification_date timestamp with time zone,
    approved_days integer,
    needs_audit boolean DEFAULT false,
    is_justified boolean DEFAULT true,
    audit_date timestamp with time zone,
    attachments jsonb DEFAULT '[]'::jsonb,
    created_by uuid,
    last_modified_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    "userId" uuid,
    "certificateNumber" character varying(255),
    "issueDate" timestamp without time zone,
    "startDate" timestamp without time zone,
    "endDate" timestamp without time zone,
    "requestedDays" integer,
    "diagnosisCode" character varying(255),
    "hasVisitedDoctor" boolean DEFAULT false,
    "medicalCenter" character varying(255),
    "attendingPhysician" character varying(255),
    "medicalPrescription" text,
    "auditorId" uuid,
    "auditorResponse" text,
    "finalDiagnosis" text,
    "diagnosisCategory" character varying(255),
    "doctorObservations" text,
    "medicalRecommendations" text,
    "followUpRequired" boolean DEFAULT false,
    "followUpDate" timestamp without time zone,
    "treatingPhysician" character varying(255),
    "treatingPhysicianLicense" character varying(255),
    "medicalInstitution" character varying(255),
    "notifyART" boolean DEFAULT false,
    "artNotified" boolean DEFAULT false,
    "artNotificationDate" timestamp without time zone,
    "approvedDays" integer,
    "needsAudit" boolean DEFAULT true,
    "isJustified" boolean,
    "auditDate" timestamp without time zone,
    "createdBy" uuid,
    "lastModifiedBy" uuid,
    "createdAt" timestamp without time zone,
    "updatedAt" timestamp without time zone,
    absence_type character varying(50),
    absence_subtype character varying(50),
    cie10_code character varying(10),
    body_location character varying(100),
    possible_safety_violations text[],
    safety_violation_notes text,
    requires_hse_review boolean DEFAULT false,
    hse_case_id uuid,
    CONSTRAINT check_medical_dates CHECK ((end_date >= start_date)),
    CONSTRAINT medical_certificates_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'under_review'::character varying, 'expired'::character varying])::text[])))
);


--
-- Name: medical_certificates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.medical_certificates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: medical_certificates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.medical_certificates_id_seq OWNED BY public.medical_certificates.id;


--
-- Name: medical_communications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_communications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    absence_case_id uuid NOT NULL,
    sender_type character varying(20) NOT NULL,
    sender_id uuid,
    receiver_type character varying(20) NOT NULL,
    receiver_id uuid,
    message_type character varying(50) NOT NULL,
    subject character varying(255),
    message text NOT NULL,
    attachments jsonb DEFAULT '[]'::jsonb,
    is_read boolean DEFAULT false,
    read_at timestamp without time zone,
    requires_response boolean DEFAULT false,
    response_deadline timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT medical_communications_message_type_check CHECK (((message_type)::text = ANY ((ARRAY['initial_notification'::character varying, 'request_info'::character varying, 'employee_response'::character varying, 'request_document'::character varying, 'document_upload'::character varying, 'diagnosis'::character varying, 'justification'::character varying, 'case_closed'::character varying, 'follow_up'::character varying])::text[]))),
    CONSTRAINT medical_communications_receiver_type_check CHECK (((receiver_type)::text = ANY ((ARRAY['employee'::character varying, 'doctor'::character varying, 'hr'::character varying])::text[]))),
    CONSTRAINT medical_communications_sender_type_check CHECK (((sender_type)::text = ANY ((ARRAY['employee'::character varying, 'doctor'::character varying, 'hr'::character varying, 'system'::character varying])::text[]))),
    CONSTRAINT valid_sender CHECK (((((sender_type)::text = 'employee'::text) AND (sender_id IS NOT NULL)) OR (((sender_type)::text = 'doctor'::text) AND (sender_id IS NOT NULL)) OR (((sender_type)::text = 'hr'::text) AND (sender_id IS NOT NULL)) OR ((sender_type)::text = 'system'::text)))
);


--
-- Name: TABLE medical_communications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_communications IS 'Sistema de mensajera bidireccional mdico-empleado';


--
-- Name: COLUMN medical_communications.message_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_communications.message_type IS 'Tipo de mensaje en el flujo de comunicacin';


--
-- Name: COLUMN medical_communications.requires_response; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_communications.requires_response IS 'Si requiere respuesta obligatoria del receptor';


--
-- Name: medical_diagnoses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_diagnoses (
    id uuid NOT NULL,
    code character varying(255) NOT NULL,
    description text NOT NULL,
    category character varying(255),
    subcategory character varying(255),
    "typicalDaysOff" integer,
    "minDaysOff" integer,
    "maxDaysOff" integer,
    "requiresAudit" boolean DEFAULT true,
    "requiresCertificate" boolean DEFAULT true,
    "isWorkRelated" boolean DEFAULT false,
    "isActive" boolean DEFAULT true,
    "createdBy" uuid NOT NULL,
    "lastModifiedBy" uuid,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: COLUMN medical_diagnoses."typicalDaysOff"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_diagnoses."typicalDaysOff" IS 'Das tpicos de baja para este diagnstico';


--
-- Name: COLUMN medical_diagnoses."requiresAudit"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_diagnoses."requiresAudit" IS 'Si requiere auditora mdica obligatoriamente';


--
-- Name: COLUMN medical_diagnoses."requiresCertificate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_diagnoses."requiresCertificate" IS 'Si requiere certificado mdico obligatoriamente';


--
-- Name: COLUMN medical_diagnoses."isWorkRelated"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.medical_diagnoses."isWorkRelated" IS 'Si tpicamente es relacionado al trabajo';


--
-- Name: medical_edit_authorizations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_edit_authorizations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    record_id integer NOT NULL,
    record_type character varying(50) NOT NULL,
    requested_by uuid NOT NULL,
    requested_at timestamp with time zone DEFAULT now(),
    request_reason text NOT NULL,
    action_type character varying(20) NOT NULL,
    proposed_changes jsonb,
    priority character varying(20) DEFAULT 'normal'::character varying,
    status character varying(20) DEFAULT 'pending'::character varying,
    authorized_by uuid,
    authorized_at timestamp with time zone,
    authorization_response text,
    current_step integer DEFAULT 1,
    escalated_at timestamp with time zone,
    escalation_reason character varying(255),
    authorization_window_start timestamp with time zone,
    authorization_window_end timestamp with time zone,
    window_used boolean DEFAULT false,
    window_used_at timestamp with time zone,
    window_action_performed character varying(50),
    notification_id integer,
    notification_group_id character varying(100),
    audit_trail jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    expires_at timestamp with time zone,
    CONSTRAINT medical_edit_authorizations_action_type_check CHECK (((action_type)::text = ANY ((ARRAY['edit'::character varying, 'delete'::character varying])::text[]))),
    CONSTRAINT medical_edit_authorizations_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'urgent'::character varying])::text[]))),
    CONSTRAINT medical_edit_authorizations_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'expired'::character varying, 'cancelled'::character varying, 'escalated'::character varying])::text[])))
);


--
-- Name: TABLE medical_edit_authorizations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_edit_authorizations IS 'Autorizaciones de edicion/borrado de registros medicos via notificaciones proactivas';


--
-- Name: medical_edit_authorizations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.medical_edit_authorizations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: medical_edit_authorizations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.medical_edit_authorizations_id_seq OWNED BY public.medical_edit_authorizations.id;


--
-- Name: medical_exam_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_exam_templates (
    id integer NOT NULL,
    company_id integer,
    template_name character varying(100) NOT NULL,
    template_code character varying(20),
    exam_type character varying(50) NOT NULL,
    description text,
    required_studies jsonb DEFAULT '[]'::jsonb,
    required_documents jsonb DEFAULT '[]'::jsonb,
    validity_days integer DEFAULT 365,
    reminder_days_before integer DEFAULT 30,
    is_active boolean DEFAULT true,
    is_default boolean DEFAULT false,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT medical_exam_templates_exam_type_check CHECK (((exam_type)::text = ANY ((ARRAY['preocupacional'::character varying, 'periodico'::character varying, 'reingreso'::character varying, 'retiro'::character varying, 'especial'::character varying])::text[])))
);


--
-- Name: TABLE medical_exam_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_exam_templates IS 'Plantillas de examenes medicos configurables por empresa segun normativa SRT';


--
-- Name: medical_exam_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.medical_exam_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: medical_exam_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.medical_exam_templates_id_seq OWNED BY public.medical_exam_templates.id;


--
-- Name: medical_leaves; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_leaves (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    leave_type character varying(50) DEFAULT 'sick'::character varying NOT NULL,
    diagnosis text,
    doctor_name character varying(200),
    medical_institution character varying(200),
    certificate_number character varying(100),
    status character varying(50) DEFAULT 'pending'::character varying NOT NULL,
    approved_by uuid,
    approved_at timestamp without time zone,
    has_certificate boolean DEFAULT false,
    certificate_url text,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE medical_leaves; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_leaves IS 'Stores medical leave records for employees';


--
-- Name: medical_record_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_record_audit_log (
    id integer NOT NULL,
    company_id integer NOT NULL,
    record_id integer NOT NULL,
    record_type character varying(50) NOT NULL,
    action character varying(30) NOT NULL,
    action_by uuid NOT NULL,
    action_by_name character varying(255),
    action_by_role character varying(50),
    action_at timestamp with time zone DEFAULT now(),
    old_values jsonb,
    new_values jsonb,
    ip_address character varying(45),
    user_agent text,
    session_id character varying(100),
    authorization_id integer,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    CONSTRAINT medical_record_audit_log_action_check CHECK (((action)::text = ANY ((ARRAY['created'::character varying, 'viewed'::character varying, 'edited'::character varying, 'signed'::character varying, 'locked'::character varying, 'unlocked_temporary'::character varying, 'delete_requested'::character varying, 'delete_approved'::character varying, 'delete_rejected'::character varying, 'deleted'::character varying, 'restored'::character varying, 'authorization_requested'::character varying, 'authorization_approved'::character varying, 'authorization_rejected'::character varying, 'authorization_expired'::character varying, 'window_opened'::character varying, 'window_used'::character varying, 'window_expired'::character varying, 'attachment_added'::character varying, 'attachment_removed'::character varying, 'exported'::character varying, 'printed'::character varying])::text[])))
);


--
-- Name: TABLE medical_record_audit_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_record_audit_log IS 'Log de auditoria inmutable (append-only) para trazabilidad legal completa';


--
-- Name: medical_record_audit_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.medical_record_audit_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: medical_record_audit_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.medical_record_audit_log_id_seq OWNED BY public.medical_record_audit_log.id;


--
-- Name: medical_records; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_records (
    id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id uuid NOT NULL,
    record_type character varying(50) NOT NULL,
    template_id integer,
    title character varying(255) NOT NULL,
    description text,
    exam_date date NOT NULL,
    expiration_date date,
    result character varying(50),
    result_details text,
    observations text,
    restrictions jsonb DEFAULT '[]'::jsonb,
    attachments jsonb DEFAULT '[]'::jsonb,
    completed_studies jsonb DEFAULT '[]'::jsonb,
    submitted_documents jsonb DEFAULT '[]'::jsonb,
    digital_signature character varying(64),
    signature_timestamp timestamp with time zone,
    signature_data jsonb,
    signed_by uuid,
    editable_until timestamp with time zone,
    is_locked boolean DEFAULT false,
    locked_at timestamp with time zone,
    locked_by uuid,
    locked_reason character varying(255) DEFAULT 'Ventana de edicion expirada'::character varying,
    edit_count integer DEFAULT 0,
    last_edited_by uuid,
    last_edited_at timestamp with time zone,
    is_deleted boolean DEFAULT false,
    deleted_at timestamp with time zone,
    deleted_by uuid,
    deletion_reason text,
    deletion_authorized_by uuid,
    deletion_authorization_id integer,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    metadata jsonb DEFAULT '{}'::jsonb,
    version integer DEFAULT 1,
    CONSTRAINT medical_records_record_type_check CHECK (((record_type)::text = ANY ((ARRAY['exam'::character varying, 'certificate'::character varying, 'study'::character varying, 'prescription'::character varying, 'antecedent'::character varying, 'aptitude'::character varying, 'disability'::character varying, 'accident'::character varying])::text[]))),
    CONSTRAINT medical_records_result_check CHECK (((result)::text = ANY ((ARRAY['apto'::character varying, 'apto_con_observaciones'::character varying, 'no_apto'::character varying, 'pendiente'::character varying, 'vencido'::character varying, 'suspendido'::character varying])::text[])))
);


--
-- Name: TABLE medical_records; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.medical_records IS 'Registros medicos con inmutabilidad controlada y validez legal segun Ley 19.587';


--
-- Name: medical_records_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.medical_records_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: medical_records_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.medical_records_id_seq OWNED BY public.medical_records.id;


--
-- Name: medical_staff; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.medical_staff (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    user_id uuid,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    email character varying(255) NOT NULL,
    phone character varying(50),
    license_number character varying(50) NOT NULL,
    specialty character varying(100),
    sub_specialty character varying(100),
    password_hash text,
    is_active boolean DEFAULT true,
    can_access_web boolean DEFAULT true,
    can_access_app boolean DEFAULT true,
    notification_preferences jsonb DEFAULT '{"sms": false, "push": true, "email": true}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid,
    CONSTRAINT check_access CHECK (((can_access_web = true) OR (can_access_app = true)))
);


--
-- Name: messages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.messages (
    id uuid NOT NULL,
    title character varying(255) NOT NULL,
    content text NOT NULL,
    type public.enum_messages_type DEFAULT 'notification'::public.enum_messages_type,
    priority public.enum_messages_priority DEFAULT 'normal'::public.enum_messages_priority,
    "isRead" boolean DEFAULT false,
    "readAt" timestamp with time zone,
    "requiresBiometricConfirmation" boolean DEFAULT false,
    "biometricConfirmedAt" timestamp with time zone,
    "expiresAt" timestamp with time zone,
    attachments json DEFAULT '[]'::json,
    metadata json DEFAULT '{}'::json,
    "recipientId" uuid NOT NULL,
    "senderId" uuid,
    "relatedEntity" character varying(255),
    "relatedEntityId" uuid,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: migration_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.migration_log (
    id integer NOT NULL,
    migration_name character varying(200) NOT NULL,
    executed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    description text
);


--
-- Name: migration_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.migration_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: migration_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.migration_log_id_seq OWNED BY public.migration_log.id;


--
-- Name: module_actions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.module_actions (
    id character varying(100) NOT NULL,
    module_key character varying(50) NOT NULL,
    action_name character varying(50) NOT NULL,
    display_name character varying(100) NOT NULL,
    description text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: module_definitions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.module_definitions (
    id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    module_name character varying(200) NOT NULL,
    description text,
    category character varying(50),
    icon character varying(50),
    available_actions text[] DEFAULT ARRAY['read'::text, 'create'::text, 'update'::text, 'delete'::text],
    available_scopes text[] DEFAULT ARRAY['all'::text, 'own_branch'::text, 'own_department'::text, 'own'::text, 'assigned_only'::text],
    required_dependencies text[] DEFAULT '{}'::text[],
    help_title character varying(200),
    help_description text,
    help_getting_started text,
    help_common_tasks jsonb DEFAULT '[]'::jsonb,
    prerequisite_data jsonb DEFAULT '{}'::jsonb,
    sort_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    is_premium boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: module_definitions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.module_definitions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: module_definitions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.module_definitions_id_seq OWNED BY public.module_definitions.id;


--
-- Name: multiple_art_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.multiple_art_configurations (
    id integer NOT NULL,
    name character varying(255) NOT NULL,
    "clientCode" character varying(100),
    email character varying(255) NOT NULL,
    phone character varying(50),
    "emergencyContact" character varying(255),
    "preferredChannel" public."enum_multiple_art_configurations_preferredChannel" DEFAULT 'email'::public."enum_multiple_art_configurations_preferredChannel",
    priority public.enum_multiple_art_configurations_priority DEFAULT 'secondary'::public.enum_multiple_art_configurations_priority,
    schedule text,
    "isActive" boolean DEFAULT true,
    "notificationSettings" json DEFAULT '{"enableEmergency":true,"enableRoutine":true,"responseTimeout":24,"escalationEnabled":true}'::json,
    address text,
    website character varying(255),
    notes text,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: COLUMN multiple_art_configurations.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.name IS 'Nombre del proveedor ART';


--
-- Name: COLUMN multiple_art_configurations."clientCode"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations."clientCode" IS 'Cdigo o nmero de cliente de la empresa';


--
-- Name: COLUMN multiple_art_configurations.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.email IS 'Email principal para notificaciones';


--
-- Name: COLUMN multiple_art_configurations.phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.phone IS 'Telfono de contacto';


--
-- Name: COLUMN multiple_art_configurations."emergencyContact"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations."emergencyContact" IS 'Contacto de emergencia (nombre y cargo)';


--
-- Name: COLUMN multiple_art_configurations."preferredChannel"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations."preferredChannel" IS 'Canal preferido de comunicacin';


--
-- Name: COLUMN multiple_art_configurations.priority; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.priority IS 'Prioridad del proveedor ART';


--
-- Name: COLUMN multiple_art_configurations.schedule; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.schedule IS 'Horarios de atencin del proveedor';


--
-- Name: COLUMN multiple_art_configurations."isActive"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations."isActive" IS 'Si el proveedor est activo';


--
-- Name: COLUMN multiple_art_configurations."notificationSettings"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations."notificationSettings" IS 'Configuracin de notificaciones especficas';


--
-- Name: COLUMN multiple_art_configurations.address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.address IS 'Direccin fsica del proveedor';


--
-- Name: COLUMN multiple_art_configurations.website; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.website IS 'Sitio web del proveedor';


--
-- Name: COLUMN multiple_art_configurations.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.multiple_art_configurations.notes IS 'Notas adicionales sobre el proveedor';


--
-- Name: multiple_art_configurations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.multiple_art_configurations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: multiple_art_configurations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.multiple_art_configurations_id_seq OWNED BY public.multiple_art_configurations.id;


--
-- Name: notification_actions_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_actions_log (
    id bigint NOT NULL,
    notification_id bigint NOT NULL,
    thread_id uuid,
    company_id integer,
    action character varying(50) NOT NULL,
    action_by uuid,
    action_by_name character varying(255),
    action_by_role character varying(50),
    action_at timestamp without time zone DEFAULT now(),
    previous_status character varying(50),
    new_status character varying(50),
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    ip_address inet,
    user_agent text,
    device_type character varying(50)
);


--
-- Name: TABLE notification_actions_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_actions_log IS 'Historial completo de todas las acciones';


--
-- Name: notification_actions_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_actions_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_actions_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_actions_log_id_seq OWNED BY public.notification_actions_log.id;


--
-- Name: notification_ai_learning; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_ai_learning (
    id integer NOT NULL,
    company_id integer,
    category character varying(100),
    module character varying(50),
    question_pattern text NOT NULL,
    question_keywords text[],
    answer_content text NOT NULL,
    answer_summary character varying(500),
    learned_from_thread_id uuid,
    learned_from_notification_id uuid,
    answered_by_user_id uuid,
    answered_by_role character varying(50),
    times_suggested integer DEFAULT 0,
    times_accepted integer DEFAULT 0,
    times_rejected integer DEFAULT 0,
    confidence_score numeric(5,4) DEFAULT 0.5,
    is_active boolean DEFAULT true,
    is_verified boolean DEFAULT false,
    verified_by uuid,
    verified_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_ai_learning; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_ai_learning IS 'Base de conocimiento para respuestas automaticas con IA';


--
-- Name: notification_ai_learning_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_ai_learning_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_ai_learning_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_ai_learning_id_seq OWNED BY public.notification_ai_learning.id;


--
-- Name: notification_ai_suggestions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_ai_suggestions (
    id integer NOT NULL,
    trigger_message_id uuid NOT NULL,
    group_id uuid NOT NULL,
    company_id integer NOT NULL,
    recipient_id character varying(100),
    suggestion_type character varying(50) NOT NULL,
    suggested_response text NOT NULL,
    confidence numeric(5,4) NOT NULL,
    source_type character varying(50),
    source_id integer,
    source_thread_id uuid,
    explanation text,
    status character varying(20) DEFAULT 'pending'::character varying,
    user_response text,
    feedback_rating integer,
    feedback_comment text,
    auto_applied boolean DEFAULT false,
    applied_at timestamp without time zone,
    applied_message_id uuid,
    created_at timestamp without time zone DEFAULT now(),
    expires_at timestamp without time zone,
    responded_at timestamp without time zone
);


--
-- Name: TABLE notification_ai_suggestions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_ai_suggestions IS 'Sugerencias de respuesta generadas por IA para notificaciones';


--
-- Name: notification_ai_suggestions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_ai_suggestions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_ai_suggestions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_ai_suggestions_id_seq OWNED BY public.notification_ai_suggestions.id;


--
-- Name: notification_audit_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_audit_log (
    id bigint NOT NULL,
    group_id uuid NOT NULL,
    message_id uuid,
    action character varying(50) NOT NULL,
    actor_type character varying(20),
    actor_id character varying(100),
    "timestamp" timestamp without time zone DEFAULT now(),
    ip_address inet,
    user_agent text,
    metadata jsonb
);


--
-- Name: TABLE notification_audit_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_audit_log IS 'Log de auditora inmutable de todas las acciones sobre notificaciones';


--
-- Name: notification_audit_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_audit_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_audit_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_audit_log_id_seq OWNED BY public.notification_audit_log.id;


--
-- Name: notification_context_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_context_data (
    id integer NOT NULL,
    notification_message_id uuid NOT NULL,
    context_type character varying(50) NOT NULL,
    context_data jsonb NOT NULL,
    severity character varying(20),
    display_as character varying(20),
    display_message text,
    icon character varying(10),
    calculated_at timestamp without time zone DEFAULT now()
);


--
-- Name: notification_context_data_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_context_data_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_context_data_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_context_data_id_seq OWNED BY public.notification_context_data.id;


--
-- Name: notification_escalations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_escalations (
    id integer NOT NULL,
    message_id uuid,
    original_deadline timestamp without time zone NOT NULL,
    escalation_level integer DEFAULT 1,
    escalated_to character varying(100),
    escalated_at timestamp without time zone DEFAULT now(),
    reason text
);


--
-- Name: notification_escalations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_escalations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_escalations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_escalations_id_seq OWNED BY public.notification_escalations.id;


--
-- Name: notification_faq_patterns; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_faq_patterns (
    id integer NOT NULL,
    pattern_name character varying(200) NOT NULL,
    pattern_description text,
    category character varying(100) NOT NULL,
    regex_pattern text,
    keyword_patterns text[],
    semantic_pattern text,
    standard_response text,
    response_variables jsonb DEFAULT '{}'::jsonb,
    auto_respond boolean DEFAULT false,
    require_confirmation boolean DEFAULT true,
    notify_original_recipient boolean DEFAULT true,
    times_matched integer DEFAULT 0,
    last_matched_at timestamp without time zone,
    is_active boolean DEFAULT true,
    company_id integer,
    created_by character varying(100),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_faq_patterns; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_faq_patterns IS 'Patrones FAQ configurables para respuestas automticas';


--
-- Name: notification_faq_patterns_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_faq_patterns_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_faq_patterns_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_faq_patterns_id_seq OWNED BY public.notification_faq_patterns.id;


--
-- Name: notification_flow_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_flow_templates (
    id integer NOT NULL,
    request_type_code character varying(50) NOT NULL,
    flow_name character varying(100) NOT NULL,
    description text,
    flow_steps jsonb NOT NULL,
    optional_modules jsonb,
    active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: notification_flow_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_flow_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_flow_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_flow_templates_id_seq OWNED BY public.notification_flow_templates.id;


--
-- Name: notification_groups; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_groups (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    group_type character varying(50) NOT NULL,
    initiator_type character varying(20) NOT NULL,
    initiator_id character varying(100) NOT NULL,
    subject character varying(255) NOT NULL,
    status character varying(20) DEFAULT 'open'::character varying,
    priority character varying(10) DEFAULT 'normal'::character varying,
    company_id integer NOT NULL,
    created_at timestamp without time zone DEFAULT now(),
    closed_at timestamp without time zone,
    closed_by character varying(100),
    metadata jsonb,
    requires_sla boolean DEFAULT true,
    default_sla_hours integer DEFAULT 24,
    auto_escalate boolean DEFAULT true,
    escalation_chain jsonb DEFAULT '["supervisor", "rrhh", "gerencia"]'::jsonb,
    total_escalations integer DEFAULT 0,
    last_activity_at timestamp without time zone,
    ai_last_analyzed_at timestamp without time zone,
    ai_resolution_status character varying(50) DEFAULT 'unknown'::character varying,
    ai_detected_topic character varying(100),
    ai_summary text
);


--
-- Name: TABLE notification_groups; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_groups IS 'Grupos/hilos de notificaciones - Cada conversacin tiene un ID nico';


--
-- Name: COLUMN notification_groups.requires_sla; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.requires_sla IS 'Si este grupo requiere control de SLA';


--
-- Name: COLUMN notification_groups.default_sla_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.default_sla_hours IS 'Horas por defecto para SLA en este grupo';


--
-- Name: COLUMN notification_groups.auto_escalate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.auto_escalate IS 'Si se escala automticamente al vencer SLA';


--
-- Name: COLUMN notification_groups.escalation_chain; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.escalation_chain IS 'Cadena de escalamiento: ["supervisor","rrhh","gerencia"]';


--
-- Name: COLUMN notification_groups.total_escalations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.total_escalations IS 'Contador de escalamientos en este hilo';


--
-- Name: COLUMN notification_groups.last_activity_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.last_activity_at IS 'ltima actividad en el hilo';


--
-- Name: COLUMN notification_groups.ai_resolution_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_groups.ai_resolution_status IS 'Estado de resolucin detectado por IA: unknown, pending, resolved, needs_human';


--
-- Name: notification_learned_responses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_learned_responses (
    id integer NOT NULL,
    category character varying(100) NOT NULL,
    subcategory character varying(100),
    department character varying(100),
    question_pattern text NOT NULL,
    question_keywords text[],
    answer_content text NOT NULL,
    answer_summary character varying(500),
    answer_metadata jsonb DEFAULT '{}'::jsonb,
    source_message_id uuid,
    source_group_id uuid,
    learned_from_employee_id character varying(100),
    answered_by_employee_id character varying(100),
    answered_by_role character varying(50),
    valid_from date,
    valid_until date,
    is_temporal boolean DEFAULT false,
    times_suggested integer DEFAULT 0,
    times_accepted integer DEFAULT 0,
    times_rejected integer DEFAULT 0,
    confidence_score numeric(5,4) DEFAULT 0.5,
    is_active boolean DEFAULT true,
    is_verified boolean DEFAULT false,
    verified_by character varying(100),
    verified_at timestamp without time zone,
    company_id integer,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_learned_responses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_learned_responses IS 'Base de conocimiento de Q&A aprendidas de notificaciones anteriores';


--
-- Name: COLUMN notification_learned_responses.question_pattern; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_learned_responses.question_pattern IS 'Pregunta normalizada para matching';


--
-- Name: COLUMN notification_learned_responses.confidence_score; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_learned_responses.confidence_score IS 'Score de confianza basado en aceptacin (times_accepted/times_suggested)';


--
-- Name: notification_learned_responses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_learned_responses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_learned_responses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_learned_responses_id_seq OWNED BY public.notification_learned_responses.id;


--
-- Name: notification_messages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_messages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    group_id uuid NOT NULL,
    sequence_number integer NOT NULL,
    sender_type character varying(20) NOT NULL,
    sender_id character varying(100) NOT NULL,
    sender_name character varying(255),
    recipient_type character varying(20) NOT NULL,
    recipient_id character varying(100) NOT NULL,
    recipient_name character varying(255),
    message_type character varying(30) NOT NULL,
    subject character varying(255),
    content text NOT NULL,
    content_encrypted text,
    created_at timestamp without time zone DEFAULT now() NOT NULL,
    deadline_at timestamp without time zone,
    requires_response boolean DEFAULT false,
    delivered_at timestamp without time zone,
    read_at timestamp without time zone,
    responded_at timestamp without time zone,
    message_hash character varying(64) NOT NULL,
    hash_algorithm character varying(20) DEFAULT 'SHA-256'::character varying,
    channels jsonb DEFAULT '["web"]'::jsonb,
    channel_status jsonb,
    attachments jsonb,
    is_deleted boolean DEFAULT false,
    company_id integer NOT NULL,
    sla_response_hours integer DEFAULT 24,
    sla_breach boolean DEFAULT false,
    sla_breach_at timestamp without time zone,
    sender_notified_at timestamp without time zone,
    sender_notified_response boolean DEFAULT false,
    recipient_notified_at timestamp without time zone,
    escalation_status character varying(20) DEFAULT 'none'::character varying,
    escalation_level integer DEFAULT 0,
    escalated_to_id character varying(100),
    escalated_at timestamp without time zone,
    impact_on_evaluation boolean DEFAULT false,
    evaluation_score_impact numeric(5,2) DEFAULT 0,
    discharge_reason text,
    discharge_at timestamp without time zone,
    discharge_accepted boolean,
    ai_analyzed boolean DEFAULT false,
    ai_analyzed_at timestamp without time zone,
    ai_suggested_response_id integer,
    ai_auto_generated boolean DEFAULT false,
    ai_confidence numeric(5,4),
    ai_source_type character varying(50)
);


--
-- Name: TABLE notification_messages; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_messages IS 'Mensajes individuales dentro de un grupo - Sistema inmutable con hash SHA-256';


--
-- Name: COLUMN notification_messages.sla_response_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.sla_response_hours IS 'Horas esperadas para respuesta segn SLA (default 24h)';


--
-- Name: COLUMN notification_messages.sla_breach; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.sla_breach IS 'TRUE si el destinatario no respondi dentro del SLA';


--
-- Name: COLUMN notification_messages.sla_breach_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.sla_breach_at IS 'Momento en que se detect el incumplimiento de SLA';


--
-- Name: COLUMN notification_messages.sender_notified_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.sender_notified_at IS 'Cuando el remitente fue notificado de la respuesta o incumplimiento';


--
-- Name: COLUMN notification_messages.sender_notified_response; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.sender_notified_response IS 'TRUE si el remitente ya fue notificado de la respuesta';


--
-- Name: COLUMN notification_messages.recipient_notified_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.recipient_notified_at IS 'Cuando el destinatario fue notificado de que debe responder';


--
-- Name: COLUMN notification_messages.escalation_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.escalation_status IS 'none, pending, escalated, resolved, discharged';


--
-- Name: COLUMN notification_messages.escalation_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.escalation_level IS '0=ninguno, 1=supervisor, 2=RRHH, 3=gerencia';


--
-- Name: COLUMN notification_messages.escalated_to_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.escalated_to_id IS 'ID del usuario/departamento al que se escal';


--
-- Name: COLUMN notification_messages.escalated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.escalated_at IS 'Momento del escalamiento';


--
-- Name: COLUMN notification_messages.impact_on_evaluation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.impact_on_evaluation IS 'TRUE si el incumplimiento impacta evaluacin del empleado';


--
-- Name: COLUMN notification_messages.evaluation_score_impact; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.evaluation_score_impact IS 'Puntos negativos en evaluacin (ej: -5.00)';


--
-- Name: COLUMN notification_messages.discharge_reason; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.discharge_reason IS 'Descargo del empleado que incumpli';


--
-- Name: COLUMN notification_messages.discharge_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.discharge_at IS 'Fecha del descargo';


--
-- Name: COLUMN notification_messages.discharge_accepted; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.discharge_accepted IS 'Si el descargo fue aceptado por RRHH';


--
-- Name: COLUMN notification_messages.ai_analyzed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.ai_analyzed IS 'TRUE si el mensaje fue analizado por Ollama';


--
-- Name: COLUMN notification_messages.ai_auto_generated; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.ai_auto_generated IS 'TRUE si el mensaje fue generado automticamente por IA';


--
-- Name: COLUMN notification_messages.ai_confidence; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_messages.ai_confidence IS 'Confianza de la IA en la respuesta generada';


--
-- Name: notification_participant_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_participant_types (
    id integer NOT NULL,
    type_code character varying(30) NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    requires_action boolean DEFAULT false,
    is_decisor boolean DEFAULT false,
    is_informative boolean DEFAULT false,
    can_forward boolean DEFAULT false,
    creates_deadline boolean DEFAULT true
);


--
-- Name: notification_participant_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_participant_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_participant_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_participant_types_id_seq OWNED BY public.notification_participant_types.id;


--
-- Name: notification_queue; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_queue (
    id character varying(255) NOT NULL,
    company_id character varying(50) NOT NULL,
    notification_id character varying(255) NOT NULL,
    channel public.enum_notification_queue_channel NOT NULL,
    status public.enum_notification_queue_status DEFAULT 'pending'::public.enum_notification_queue_status,
    attempts integer DEFAULT 0,
    max_attempts integer DEFAULT 3,
    scheduled_at timestamp with time zone,
    processed_at timestamp with time zone,
    error_message text
);


--
-- Name: notification_sla_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_sla_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    notification_type character varying(50) NOT NULL,
    sla_hours integer DEFAULT 24,
    warning_hours integer DEFAULT 4,
    escalation_enabled boolean DEFAULT true,
    escalation_chain jsonb DEFAULT '["supervisor", "rrhh"]'::jsonb,
    evaluation_impact numeric(5,2) DEFAULT '-2.00'::numeric,
    active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_sla_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_sla_config IS 'Configuracin de SLA por tipo de notificacin y empresa';


--
-- Name: notification_sla_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_sla_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_sla_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_sla_config_id_seq OWNED BY public.notification_sla_config.id;


--
-- Name: notification_sla_records; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_sla_records (
    id integer NOT NULL,
    message_id uuid,
    employee_id character varying(100) NOT NULL,
    company_id integer NOT NULL,
    sla_type character varying(50) NOT NULL,
    expected_response_at timestamp without time zone NOT NULL,
    actual_response_at timestamp without time zone,
    sla_met boolean,
    breach_minutes integer,
    escalation_triggered boolean DEFAULT false,
    escalation_level integer DEFAULT 0,
    evaluation_impact numeric(5,2) DEFAULT 0,
    discharge_filed boolean DEFAULT false,
    discharge_reason text,
    discharge_verdict character varying(20),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_sla_records; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_sla_records IS 'Registro histrico de cumplimiento de SLA para scoring de empleados';


--
-- Name: notification_sla_records_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_sla_records_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_sla_records_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_sla_records_id_seq OWNED BY public.notification_sla_records.id;


--
-- Name: notification_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_templates (
    id integer NOT NULL,
    company_id integer,
    template_key character varying(100) NOT NULL,
    template_name character varying(255) NOT NULL,
    module character varying(50) NOT NULL,
    category character varying(50) DEFAULT 'general'::character varying,
    title_template character varying(255),
    message_template text,
    short_message_template character varying(280),
    available_variables jsonb DEFAULT '[]'::jsonb,
    default_priority character varying(20) DEFAULT 'medium'::character varying,
    default_channels jsonb DEFAULT '["app"]'::jsonb,
    requires_action boolean DEFAULT false,
    default_action_type character varying(50),
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    email_template text,
    default_send_email boolean DEFAULT false,
    default_send_whatsapp boolean DEFAULT false,
    default_send_sms boolean DEFAULT false
);


--
-- Name: TABLE notification_templates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_templates IS 'Plantillas reutilizables con variables';


--
-- Name: notification_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_templates_id_seq OWNED BY public.notification_templates.id;


--
-- Name: notification_thread_analysis; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_thread_analysis (
    id integer NOT NULL,
    group_id uuid NOT NULL,
    company_id integer NOT NULL,
    thread_summary text,
    detected_intent character varying(100),
    detected_topic character varying(100),
    detected_urgency character varying(20),
    detected_sentiment character varying(20),
    is_resolved boolean DEFAULT false,
    resolution_message_id uuid,
    resolution_summary text,
    has_anomalies boolean DEFAULT false,
    anomalies jsonb DEFAULT '[]'::jsonb,
    pending_suggestions jsonb DEFAULT '[]'::jsonb,
    last_analyzed_at timestamp without time zone DEFAULT now(),
    last_message_analyzed_id uuid,
    analysis_version integer DEFAULT 1,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_thread_analysis; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_thread_analysis IS 'Anlisis inteligente de hilos de notificacin por Ollama';


--
-- Name: notification_thread_analysis_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_thread_analysis_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_thread_analysis_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_thread_analysis_id_seq OWNED BY public.notification_thread_analysis.id;


--
-- Name: notification_threads; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_threads (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer,
    subject character varying(255) NOT NULL,
    category character varying(50) NOT NULL,
    module character varying(50),
    thread_type character varying(50) NOT NULL,
    initiator_type character varying(50),
    initiator_id character varying(100),
    initiator_name character varying(255),
    participants jsonb DEFAULT '[]'::jsonb,
    status character varying(50) DEFAULT 'open'::character varying,
    priority character varying(20) DEFAULT 'medium'::character varying,
    message_count integer DEFAULT 0,
    unread_count integer DEFAULT 0,
    current_workflow_step integer DEFAULT 0,
    workflow_id integer,
    sla_deadline timestamp without time zone,
    sla_breached boolean DEFAULT false,
    ai_summary text,
    ai_topic character varying(100),
    ai_resolution_status character varying(50),
    last_message_at timestamp without time zone DEFAULT now(),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    closed_at timestamp without time zone,
    closed_by uuid,
    commercial_flow character varying(50),
    trace_id character varying(100),
    vendor_id uuid,
    external_email character varying(255)
);


--
-- Name: TABLE notification_threads; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_threads IS 'Agrupacion de notificaciones en conversaciones';


--
-- Name: COLUMN notification_threads.commercial_flow; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_threads.commercial_flow IS 'Tipo de flujo comercial: onboarding, support, billing, renewal, upsell';


--
-- Name: COLUMN notification_threads.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_threads.trace_id IS 'ID de rastreo para vincular con workflows';


--
-- Name: COLUMN notification_threads.vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_threads.vendor_id IS 'ID del vendedor APONNT asignado';


--
-- Name: COLUMN notification_threads.external_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.notification_threads.external_email IS 'Email del contacto externo para el thread';


--
-- Name: notification_workflows; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_workflows (
    id integer NOT NULL,
    company_id integer,
    workflow_key character varying(100) NOT NULL,
    workflow_name character varying(255) NOT NULL,
    module character varying(50) NOT NULL,
    description text,
    is_active boolean DEFAULT true,
    steps jsonb DEFAULT '[]'::jsonb NOT NULL,
    activation_conditions jsonb DEFAULT '{}'::jsonb,
    on_approval_actions jsonb DEFAULT '[]'::jsonb,
    on_rejection_actions jsonb DEFAULT '[]'::jsonb,
    on_timeout_actions jsonb DEFAULT '[]'::jsonb,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE notification_workflows; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.notification_workflows IS 'Definicion de flujos de aprobacion multi-nivel';


--
-- Name: notification_workflows_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notification_workflows_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notification_workflows_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notification_workflows_id_seq OWNED BY public.notification_workflows.id;


--
-- Name: notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notifications (
    id bigint NOT NULL,
    uuid uuid DEFAULT gen_random_uuid(),
    company_id integer NOT NULL,
    module character varying(50) NOT NULL,
    category character varying(50) DEFAULT 'info'::character varying NOT NULL,
    notification_type character varying(100) NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying NOT NULL,
    recipient_user_id uuid,
    recipient_role character varying(50),
    recipient_department_id integer,
    recipient_shift_id uuid,
    recipient_custom_list jsonb DEFAULT '[]'::jsonb,
    is_broadcast boolean DEFAULT false,
    title character varying(255) NOT NULL,
    message text NOT NULL,
    short_message character varying(140),
    email_body text,
    related_entity_type character varying(50),
    related_entity_id bigint,
    related_user_id uuid,
    related_department_id integer,
    related_kiosk_id integer,
    related_attendance_id uuid,
    metadata jsonb DEFAULT '{}'::jsonb,
    is_read boolean DEFAULT false,
    read_at timestamp without time zone,
    read_by uuid,
    requires_action boolean DEFAULT false,
    action_status character varying(50) DEFAULT 'pending'::character varying,
    action_type character varying(50),
    action_deadline timestamp without time zone,
    action_taken_at timestamp without time zone,
    action_taken_by uuid,
    action_response text,
    action_options jsonb DEFAULT '[]'::jsonb,
    escalation_level integer DEFAULT 0,
    escalated_from_notification_id bigint,
    escalated_to_notification_id bigint,
    escalation_reason character varying(255),
    sent_via_app boolean DEFAULT true,
    sent_via_email boolean DEFAULT false,
    sent_via_whatsapp boolean DEFAULT false,
    sent_via_sms boolean DEFAULT false,
    email_sent_at timestamp without time zone,
    whatsapp_sent_at timestamp without time zone,
    sms_sent_at timestamp without time zone,
    reminder_sent boolean DEFAULT false,
    reminder_sent_at timestamp without time zone,
    reminder_count integer DEFAULT 0,
    expires_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    created_by uuid,
    deleted_at timestamp without time zone,
    deleted_by uuid
);


--
-- Name: notifications_enterprise; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notifications_enterprise (
    id character varying(255) NOT NULL,
    company_id character varying(50) NOT NULL,
    notification_code character varying(200) NOT NULL,
    from_module public.enum_notifications_enterprise_from_module NOT NULL,
    from_user_id character varying(255),
    to_user_id character varying(255) NOT NULL,
    to_role public.enum_notifications_enterprise_to_role NOT NULL,
    title character varying(255) NOT NULL,
    message text NOT NULL,
    notification_type public.enum_notifications_enterprise_notification_type NOT NULL,
    status public.enum_notifications_enterprise_status DEFAULT 'pending'::public.enum_notifications_enterprise_status,
    priority public.enum_notifications_enterprise_priority DEFAULT 'medium'::public.enum_notifications_enterprise_priority,
    channels json,
    delivery_attempts integer DEFAULT 0,
    metadata json,
    requires_response boolean DEFAULT false,
    response_data json,
    response_at timestamp with time zone,
    read_at timestamp with time zone,
    delivered_at timestamp with time zone,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: notifications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.notifications_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: notifications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.notifications_id_seq OWNED BY public.notifications.id;


--
-- Name: oh_certification_alert_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_certification_alert_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    alert_days_schedule integer[] DEFAULT '{30,15,7,1}'::integer[],
    alerts_enabled boolean DEFAULT true,
    default_recipients text[],
    notify_employee boolean DEFAULT true,
    notify_supervisor boolean DEFAULT true,
    notify_hr boolean DEFAULT true,
    hr_email character varying(200),
    send_time time without time zone DEFAULT '09:00:00'::time without time zone,
    timezone character varying(50) DEFAULT 'America/Buenos_Aires'::character varying,
    created_at timestamp with time zone DEFAULT now(),
    last_updated_at timestamp with time zone DEFAULT now(),
    last_updated_by character varying(100)
);


--
-- Name: oh_certification_alert_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_certification_alert_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_certification_alert_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_certification_alert_config_id_seq OWNED BY public.oh_certification_alert_config.id;


--
-- Name: oh_certification_alerts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_certification_alerts (
    id integer NOT NULL,
    certification_id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id character varying(50) NOT NULL,
    alert_type character varying(50) NOT NULL,
    days_until_expiration integer NOT NULL,
    sent_at timestamp with time zone DEFAULT now(),
    sent_to character varying(500) NOT NULL,
    sent_via character varying(50) DEFAULT 'email'::character varying,
    status character varying(50) DEFAULT 'sent'::character varying,
    subject text,
    message_body text,
    send_response jsonb,
    error_message text,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: oh_certification_alerts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_certification_alerts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_certification_alerts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_certification_alerts_id_seq OWNED BY public.oh_certification_alerts.id;


--
-- Name: oh_certification_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_certification_types (
    id integer NOT NULL,
    type_code character varying(100) NOT NULL,
    name_i18n jsonb DEFAULT '{}'::jsonb NOT NULL,
    description_i18n jsonb DEFAULT '{}'::jsonb,
    category character varying(50) NOT NULL,
    default_alert_days integer DEFAULT 30,
    is_mandatory boolean DEFAULT false,
    requires_renewal boolean DEFAULT true,
    standard_validity_months integer DEFAULT 12,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    last_updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: oh_certification_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_certification_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_certification_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_certification_types_id_seq OWNED BY public.oh_certification_types.id;


--
-- Name: oh_claim_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_claim_documents (
    id integer NOT NULL,
    claim_id integer NOT NULL,
    document_type character varying(100) NOT NULL,
    file_name character varying(500) NOT NULL,
    file_path character varying(1000) NOT NULL,
    file_size integer,
    file_type character varying(100),
    uploaded_by character varying(200),
    upload_date timestamp with time zone DEFAULT now(),
    description text,
    is_required boolean DEFAULT false,
    is_verified boolean DEFAULT false,
    verified_by character varying(200),
    verified_date timestamp with time zone,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE oh_claim_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_claim_documents IS 'Documentos adjuntos a reclamos de accidentes laborales';


--
-- Name: COLUMN oh_claim_documents.document_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_claim_documents.document_type IS 'Tipo: medical_report, witness_statement, employer_report, art_form, photos, etc.';


--
-- Name: oh_claim_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_claim_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_claim_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_claim_documents_id_seq OWNED BY public.oh_claim_documents.id;


--
-- Name: oh_claim_status_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_claim_status_history (
    id integer NOT NULL,
    claim_id integer NOT NULL,
    previous_status character varying(50),
    new_status character varying(50) NOT NULL,
    changed_by character varying(200) NOT NULL,
    change_reason text,
    notes text,
    changed_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE oh_claim_status_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_claim_status_history IS 'Historial de cambios de estado de reclamos';


--
-- Name: oh_claim_status_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_claim_status_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_claim_status_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_claim_status_history_id_seq OWNED BY public.oh_claim_status_history.id;


--
-- Name: oh_claim_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_claim_types (
    id integer NOT NULL,
    region character varying(10) NOT NULL,
    type_code character varying(50) NOT NULL,
    name_i18n jsonb NOT NULL,
    description_i18n jsonb,
    severity_level character varying(20),
    requires_medical_report boolean DEFAULT true,
    requires_witness_statement boolean DEFAULT false,
    requires_employer_report boolean DEFAULT true,
    typical_recovery_days integer,
    legal_deadline_days integer,
    is_active boolean DEFAULT true,
    display_order integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE oh_claim_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_claim_types IS 'Tipos de reclamos de accidentes laborales parametrizados por regin';


--
-- Name: COLUMN oh_claim_types.region; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_claim_types.region IS 'Cdigo de regin: US, AR, MX, BR, CL, CO, PE, etc.';


--
-- Name: COLUMN oh_claim_types.severity_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_claim_types.severity_level IS 'Nivel de severidad: minor, moderate, severe, critical, fatal';


--
-- Name: COLUMN oh_claim_types.legal_deadline_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_claim_types.legal_deadline_days IS 'Das lmite legales para reportar el accidente';


--
-- Name: oh_claim_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_claim_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_claim_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_claim_types_id_seq OWNED BY public.oh_claim_types.id;


--
-- Name: oh_employee_certifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_employee_certifications (
    id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id character varying(50) NOT NULL,
    employee_name character varying(200),
    employee_email character varying(200),
    department character varying(100),
    certification_type_id integer NOT NULL,
    certification_number character varying(200),
    issue_date date NOT NULL,
    expiration_date date NOT NULL,
    alert_days_before integer DEFAULT 30,
    last_alert_sent_at timestamp with time zone,
    alert_count integer DEFAULT 0,
    status character varying(50) DEFAULT 'active'::character varying NOT NULL,
    issuing_authority character varying(200),
    issuing_country character varying(10),
    document_path text,
    document_filename character varying(500),
    document_size bigint,
    document_type character varying(100),
    renewed_by_certification_id integer,
    is_renewal_of_certification_id integer,
    notes text,
    created_by character varying(100),
    created_at timestamp with time zone DEFAULT now(),
    last_updated_at timestamp with time zone DEFAULT now(),
    last_updated_by character varying(100),
    deleted_at timestamp with time zone
);


--
-- Name: oh_employee_certifications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_employee_certifications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_employee_certifications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_employee_certifications_id_seq OWNED BY public.oh_employee_certifications.id;


--
-- Name: oh_pre_employment_screenings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_pre_employment_screenings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    candidate_first_name character varying(255) NOT NULL,
    candidate_last_name character varying(255) NOT NULL,
    candidate_email character varying(255),
    candidate_phone character varying(50),
    candidate_id_number character varying(100),
    candidate_date_of_birth date,
    candidate_gender character varying(20),
    position_title character varying(255) NOT NULL,
    department character varying(255),
    position_level character varying(100),
    job_category character varying(100),
    expected_start_date date,
    screening_type_id integer,
    screening_type_code character varying(100),
    scheduled_date timestamp without time zone,
    completed_date timestamp without time zone,
    country_code character varying(2) NOT NULL,
    location_address text,
    location_city character varying(255),
    location_state character varying(100),
    location_postal_code character varying(20),
    provider_name character varying(255),
    provider_license_number character varying(100),
    physician_name character varying(255),
    physician_license_number character varying(100),
    overall_result character varying(50),
    result_summary text,
    result_details jsonb,
    has_restrictions boolean DEFAULT false,
    restrictions_description text,
    requires_accommodations boolean DEFAULT false,
    accommodations_description text,
    accommodation_cost_estimate numeric(10,2),
    requires_follow_up boolean DEFAULT false,
    follow_up_date date,
    follow_up_reason text,
    follow_up_completed boolean DEFAULT false,
    has_documents boolean DEFAULT false,
    documents_count integer DEFAULT 0,
    valid_from date,
    valid_until date,
    screening_cost_usd numeric(10,2),
    paid_by character varying(50) DEFAULT 'company'::character varying,
    payment_status character varying(50) DEFAULT 'pending'::character varying,
    status character varying(50) DEFAULT 'scheduled'::character varying,
    workflow_stage character varying(100),
    reviewed_by character varying(255),
    reviewed_at timestamp without time zone,
    review_notes text,
    approved_for_hiring boolean,
    approval_date timestamp without time zone,
    approved_by character varying(255),
    rejection_reason text,
    candidate_notified boolean DEFAULT false,
    candidate_notified_at timestamp without time zone,
    hr_notified boolean DEFAULT false,
    hr_notified_at timestamp without time zone,
    consent_signed boolean DEFAULT false,
    consent_signed_at timestamp without time zone,
    consent_document_url text,
    hipaa_compliant boolean DEFAULT true,
    gdpr_compliant boolean DEFAULT true,
    lgpd_compliant boolean DEFAULT true,
    metadata jsonb,
    tags text[],
    created_by character varying(255),
    updated_by character varying(255),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp without time zone,
    CONSTRAINT chk_overall_result CHECK (((overall_result)::text = ANY ((ARRAY['pass'::character varying, 'fail'::character varying, 'conditional'::character varying, 'pending'::character varying, 'cancelled'::character varying])::text[]))),
    CONSTRAINT chk_status CHECK (((status)::text = ANY ((ARRAY['scheduled'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'no_show'::character varying])::text[])))
);


--
-- Name: TABLE oh_pre_employment_screenings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_pre_employment_screenings IS 'Registro de screenings mdicos pre-empleo (multi-country)';


--
-- Name: COLUMN oh_pre_employment_screenings.country_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_pre_employment_screenings.country_code IS 'ISO 3166-1 alpha-2: US, MX, BR, AR, DE, etc.';


--
-- Name: COLUMN oh_pre_employment_screenings.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_pre_employment_screenings.metadata IS 'Campos especficos por pas en JSON';


--
-- Name: oh_screening_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_screening_config (
    id integer NOT NULL,
    company_id integer NOT NULL,
    country_code character varying(2) NOT NULL,
    required_screening_types integer[] DEFAULT ARRAY[]::integer[],
    default_validity_days integer DEFAULT 365,
    require_renewal boolean DEFAULT true,
    renewal_reminder_days integer DEFAULT 30,
    requires_hr_approval boolean DEFAULT true,
    requires_medical_approval boolean DEFAULT false,
    requires_manager_approval boolean DEFAULT false,
    auto_approve_pass_results boolean DEFAULT false,
    company_pays boolean DEFAULT true,
    max_reimbursement_usd numeric(10,2),
    preferred_providers text[],
    blacklisted_providers text[],
    notify_candidate_on_schedule boolean DEFAULT true,
    notify_candidate_on_results boolean DEFAULT true,
    notify_hr_on_results boolean DEFAULT true,
    notification_template_id integer,
    require_consent_form boolean DEFAULT true,
    consent_template_url text,
    data_retention_days integer DEFAULT 2555,
    config_data jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_by character varying(255),
    updated_by character varying(255),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE oh_screening_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_screening_config IS 'Configuracin de screening por empresa y pas';


--
-- Name: COLUMN oh_screening_config.config_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_screening_config.config_data IS 'Configuracin especfica por pas (leyes locales, requisitos)';


--
-- Name: oh_screening_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_screening_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_screening_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_screening_config_id_seq OWNED BY public.oh_screening_config.id;


--
-- Name: oh_screening_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_screening_documents (
    id integer NOT NULL,
    screening_id uuid NOT NULL,
    company_id integer NOT NULL,
    document_type character varying(100) NOT NULL,
    document_name character varying(255) NOT NULL,
    file_name character varying(255) NOT NULL,
    file_path text NOT NULL,
    file_size_bytes bigint,
    mime_type character varying(100),
    document_date date,
    issued_by character varying(255),
    language character varying(10),
    is_confidential boolean DEFAULT true,
    requires_physician_review boolean DEFAULT false,
    viewed_by text[],
    view_count integer DEFAULT 0,
    is_verified boolean DEFAULT false,
    verified_by character varying(255),
    verified_at timestamp without time zone,
    status character varying(50) DEFAULT 'active'::character varying,
    uploaded_by character varying(255),
    uploaded_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp without time zone
);


--
-- Name: TABLE oh_screening_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_screening_documents IS 'Documentos adjuntos al screening (reportes, certificados, etc.)';


--
-- Name: oh_screening_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_screening_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_screening_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_screening_documents_id_seq OWNED BY public.oh_screening_documents.id;


--
-- Name: oh_screening_results; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_screening_results (
    id integer NOT NULL,
    screening_id uuid NOT NULL,
    company_id integer NOT NULL,
    test_category character varying(100) NOT NULL,
    test_name character varying(255) NOT NULL,
    test_code character varying(100),
    result_value character varying(500),
    result_unit character varying(50),
    result_status character varying(50),
    reference_range character varying(255),
    interpretation text,
    is_within_normal boolean,
    requires_attention boolean DEFAULT false,
    clinical_significance character varying(100),
    result_data jsonb,
    notes text,
    tested_at timestamp without time zone,
    reported_at timestamp without time zone,
    reviewed_by character varying(255),
    reviewed_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_result_status CHECK (((result_status)::text = ANY ((ARRAY['normal'::character varying, 'abnormal'::character varying, 'critical'::character varying, 'borderline'::character varying, 'pending'::character varying])::text[])))
);


--
-- Name: TABLE oh_screening_results; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_screening_results IS 'Resultados detallados de cada test dentro del screening';


--
-- Name: oh_screening_results_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_screening_results_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_screening_results_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_screening_results_id_seq OWNED BY public.oh_screening_results.id;


--
-- Name: oh_screening_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_screening_types (
    id integer NOT NULL,
    code character varying(100) NOT NULL,
    name_i18n jsonb DEFAULT '{}'::jsonb NOT NULL,
    description_i18n jsonb DEFAULT '{}'::jsonb,
    category character varying(50) NOT NULL,
    country_codes text[] DEFAULT ARRAY['*'::text],
    region character varying(50),
    is_mandatory boolean DEFAULT false,
    required_for_roles text[],
    requires_physician boolean DEFAULT false,
    requires_lab boolean DEFAULT false,
    validity_days integer,
    renewal_reminder_days integer DEFAULT 30,
    result_types jsonb DEFAULT '["pass", "fail", "conditional"]'::jsonb,
    pass_criteria jsonb,
    estimated_cost_usd numeric(10,2),
    estimated_duration_minutes integer,
    is_active boolean DEFAULT true,
    display_order integer DEFAULT 0,
    created_by character varying(255),
    updated_by character varying(255),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp without time zone
);


--
-- Name: TABLE oh_screening_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_screening_types IS 'Tipos de screening mdico parametrizables por pas/regin';


--
-- Name: COLUMN oh_screening_types.name_i18n; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_screening_types.name_i18n IS 'Nombre en mltiples idiomas: {"en": "...", "es": "...", "pt": "..."}';


--
-- Name: COLUMN oh_screening_types.country_codes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_screening_types.country_codes IS 'ISO 3166-1 alpha-2 codes o [*] para global';


--
-- Name: oh_screening_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_screening_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_screening_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_screening_types_id_seq OWNED BY public.oh_screening_types.id;


--
-- Name: oh_workers_compensation_claims; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.oh_workers_compensation_claims (
    id integer NOT NULL,
    company_id integer NOT NULL,
    employee_id character varying(50) NOT NULL,
    claim_number character varying(100) NOT NULL,
    incident_date date NOT NULL,
    incident_time time without time zone,
    incident_location text,
    department character varying(100),
    supervisor_name character varying(200),
    claim_type_id integer NOT NULL,
    country_code character varying(10) NOT NULL,
    injury_description text NOT NULL,
    body_part_affected character varying(100),
    injury_cause text,
    witnesses text,
    status character varying(50) DEFAULT 'reported'::character varying NOT NULL,
    medical_treatment_required boolean DEFAULT false,
    medical_facility_name character varying(200),
    treating_physician character varying(200),
    first_aid_provided boolean DEFAULT false,
    first_aid_description text,
    hospitalization_required boolean DEFAULT false,
    work_days_lost integer DEFAULT 0,
    estimated_return_date date,
    actual_return_date date,
    art_company_name character varying(200),
    art_policy_number character varying(100),
    art_claim_number character varying(100),
    art_case_manager character varying(200),
    art_case_manager_phone character varying(50),
    art_case_manager_email character varying(200),
    osha_recordable boolean DEFAULT false,
    osha_classification character varying(50),
    reported_to_authority boolean DEFAULT false,
    authority_reference_number character varying(100),
    reported_to_authority_date date,
    estimated_cost_medical numeric(10,2),
    estimated_cost_compensation numeric(10,2),
    actual_cost_medical numeric(10,2),
    actual_cost_compensation numeric(10,2),
    preventive_measures_taken text,
    similar_incidents_count integer DEFAULT 0,
    case_notes text,
    resolution_notes text,
    closed_date date,
    closed_by character varying(200),
    documents_count integer DEFAULT 0,
    reported_by character varying(200),
    reported_date timestamp with time zone DEFAULT now(),
    last_updated_by character varying(200),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    deleted_at timestamp with time zone
);


--
-- Name: TABLE oh_workers_compensation_claims; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.oh_workers_compensation_claims IS 'Reclamos de accidentes laborales y compensaciones (multi-regin)';


--
-- Name: COLUMN oh_workers_compensation_claims.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_workers_compensation_claims.status IS 'reported | under_review | approved | rejected | in_treatment | closed | appealed';


--
-- Name: COLUMN oh_workers_compensation_claims.art_company_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_workers_compensation_claims.art_company_name IS 'Aseguradora de Riesgos del Trabajo (para Argentina)';


--
-- Name: COLUMN oh_workers_compensation_claims.osha_recordable; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.oh_workers_compensation_claims.osha_recordable IS 'Indica si debe registrarse en OSHA (solo US)';


--
-- Name: oh_workers_compensation_claims_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.oh_workers_compensation_claims_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: oh_workers_compensation_claims_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.oh_workers_compensation_claims_id_seq OWNED BY public.oh_workers_compensation_claims.id;


--
-- Name: organizational_positions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.organizational_positions (
    id integer NOT NULL,
    company_id integer NOT NULL,
    position_code character varying(30) NOT NULL,
    position_name character varying(100) NOT NULL,
    description text,
    parent_position_id integer,
    level_order integer DEFAULT 1,
    salary_category_id integer,
    payslip_template_id integer,
    payroll_template_id integer,
    department_id integer,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    work_environment character varying(50) DEFAULT 'oficina'::character varying,
    physical_demand_level integer DEFAULT 1,
    work_category character varying(50) DEFAULT 'administrativo'::character varying,
    cognitive_demand_level integer DEFAULT 3,
    risk_exposure_level integer DEFAULT 1,
    international_code_ciuo character varying(10),
    international_code_srt character varying(20),
    applies_accident_risk boolean DEFAULT true,
    applies_fatigue_index boolean DEFAULT true,
    custom_risk_weights jsonb,
    custom_thresholds jsonb,
    hierarchy_level integer DEFAULT 99 NOT NULL,
    branch_code character varying(50),
    branch_order integer DEFAULT 0,
    full_path text,
    is_escalation_point boolean DEFAULT false,
    can_approve_permissions boolean DEFAULT false,
    max_approval_days integer DEFAULT 0,
    color_hex character varying(7) DEFAULT '#3B82F6'::character varying,
    CONSTRAINT organizational_positions_cognitive_demand_level_check CHECK (((cognitive_demand_level >= 1) AND (cognitive_demand_level <= 5))),
    CONSTRAINT organizational_positions_physical_demand_level_check CHECK (((physical_demand_level >= 1) AND (physical_demand_level <= 5))),
    CONSTRAINT organizational_positions_risk_exposure_level_check CHECK (((risk_exposure_level >= 1) AND (risk_exposure_level <= 5))),
    CONSTRAINT organizational_positions_work_category_check CHECK (((work_category)::text = ANY ((ARRAY['administrativo'::character varying, 'operativo'::character varying, 'tecnico'::character varying, 'comercial'::character varying, 'gerencial'::character varying, 'mixto'::character varying])::text[]))),
    CONSTRAINT organizational_positions_work_environment_check CHECK (((work_environment)::text = ANY ((ARRAY['oficina'::character varying, 'planta'::character varying, 'exterior'::character varying, 'remoto'::character varying, 'mixto'::character varying])::text[])))
);


--
-- Name: TABLE organizational_positions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.organizational_positions IS 'Posiciones/cargos organizacionales con template de recibo asignado';


--
-- Name: COLUMN organizational_positions.position_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.position_code IS 'Cdigo nico del cargo dentro de la empresa';


--
-- Name: COLUMN organizational_positions.level_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.level_order IS 'Nivel jerrquico: 1=operativo, 2=supervisor, 3=gerente, etc.';


--
-- Name: COLUMN organizational_positions.payslip_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.payslip_template_id IS 'Template de recibo de sueldo para este cargo';


--
-- Name: COLUMN organizational_positions.payroll_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.payroll_template_id IS 'Template de conceptos de liquidacin para este cargo';


--
-- Name: COLUMN organizational_positions.physical_demand_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.physical_demand_level IS 'Nivel de demanda fsica 1-5 (OIT)';


--
-- Name: COLUMN organizational_positions.work_category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.work_category IS 'Categora de trabajo: administrativo, operativo, tcnico, comercial, gerencial, mixto';


--
-- Name: COLUMN organizational_positions.international_code_ciuo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.international_code_ciuo IS 'Cdigo CIUO-08 de la OIT';


--
-- Name: COLUMN organizational_positions.hierarchy_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.hierarchy_level IS 'Nivel jerrquico (0=CEO, 1=Gerente, 2=Jefe, 3=Supervisor, 4=Operativo)';


--
-- Name: COLUMN organizational_positions.branch_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.branch_code IS 'Cdigo de rama organizacional (ej: PROD, VENTAS, IT). Permite agrupar posiciones de la misma rea funcional.';


--
-- Name: COLUMN organizational_positions.branch_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.branch_order IS 'Orden dentro de la rama';


--
-- Name: COLUMN organizational_positions.full_path; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.full_path IS 'Ruta completa de IDs (ej: 1.5.12)';


--
-- Name: COLUMN organizational_positions.is_escalation_point; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.is_escalation_point IS 'Punto de escalamiento para notificaciones';


--
-- Name: COLUMN organizational_positions.can_approve_permissions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.can_approve_permissions IS 'Puede aprobar permisos';


--
-- Name: COLUMN organizational_positions.max_approval_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.max_approval_days IS 'Mximo das que puede aprobar';


--
-- Name: COLUMN organizational_positions.color_hex; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.organizational_positions.color_hex IS 'Color para visualizacin en organigrama';


--
-- Name: organizational_positions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.organizational_positions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: organizational_positions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.organizational_positions_id_seq OWNED BY public.organizational_positions.id;


--
-- Name: partner_commission_summaries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.partner_commission_summaries (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    partner_id uuid NOT NULL,
    year integer NOT NULL,
    month integer NOT NULL,
    total_cases integer DEFAULT 0 NOT NULL,
    total_billable numeric(12,2) DEFAULT 0 NOT NULL,
    total_commission numeric(12,2) DEFAULT 0 NOT NULL,
    total_net numeric(12,2) DEFAULT 0 NOT NULL,
    pending_amount numeric(12,2) DEFAULT 0 NOT NULL,
    invoiced_amount numeric(12,2) DEFAULT 0 NOT NULL,
    paid_amount numeric(12,2) DEFAULT 0 NOT NULL,
    status character varying(20) DEFAULT 'open'::character varying NOT NULL,
    closed_at timestamp with time zone,
    settled_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT pcs_month_check CHECK (((month >= 1) AND (month <= 12)))
);


--
-- Name: partner_commission_transactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.partner_commission_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    partner_id uuid NOT NULL,
    partner_commission_id uuid,
    reference_type character varying(50) NOT NULL,
    reference_id uuid NOT NULL,
    company_id integer,
    billable_amount numeric(12,2) DEFAULT 0 NOT NULL,
    commission_percentage numeric(5,2) NOT NULL,
    commission_amount numeric(12,2) NOT NULL,
    net_amount numeric(12,2) NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    transaction_date date DEFAULT CURRENT_DATE NOT NULL,
    invoiced_at timestamp with time zone,
    paid_at timestamp with time zone,
    invoice_number character varying(50),
    payment_reference character varying(100),
    payment_method character varying(30),
    description text,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT pct_amounts_check CHECK (((billable_amount >= (0)::numeric) AND (commission_amount >= (0)::numeric) AND (net_amount >= (0)::numeric))),
    CONSTRAINT pct_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'invoiced'::character varying, 'paid'::character varying, 'cancelled'::character varying])::text[])))
);


--
-- Name: partner_commissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.partner_commissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    partner_id uuid NOT NULL,
    commission_type character varying(30) DEFAULT 'percentage'::character varying NOT NULL,
    percentage numeric(5,2) DEFAULT 15.00,
    fixed_amount numeric(10,2) DEFAULT 0,
    tiered_config jsonb,
    is_active boolean DEFAULT true NOT NULL,
    effective_from date DEFAULT CURRENT_DATE NOT NULL,
    effective_until date,
    notes text,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT partner_commissions_percentage_check CHECK (((percentage >= (0)::numeric) AND (percentage <= (100)::numeric))),
    CONSTRAINT partner_commissions_type_check CHECK (((commission_type)::text = ANY ((ARRAY['percentage'::character varying, 'fixed_per_case'::character varying, 'monthly_fee'::character varying, 'tiered'::character varying])::text[])))
);


--
-- Name: partner_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.partner_roles (
    id integer NOT NULL,
    role_name character varying(100) NOT NULL,
    category character varying(50) NOT NULL,
    description text,
    requires_license boolean DEFAULT false,
    requires_insurance boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone NOT NULL
);


--
-- Name: partner_roles_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.partner_roles_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: partner_roles_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.partner_roles_id_seq OWNED BY public.partner_roles.id;


--
-- Name: partners; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.partners (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    dni character varying(20) NOT NULL,
    email character varying(255) NOT NULL,
    phone character varying(20),
    partner_role_id uuid,
    approval_status character varying(20) DEFAULT 'pending'::character varying,
    approved_by uuid,
    approved_at timestamp without time zone,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    username character varying(50),
    password character varying(255),
    first_login boolean DEFAULT true,
    last_login_at timestamp without time zone,
    password_changed_at timestamp without time zone,
    face_image_url character varying(500),
    face_descriptor text,
    face_registered_at timestamp without time zone,
    fingerprint_data text,
    biometric_enabled boolean DEFAULT false,
    denial_reason text,
    approval_notes text,
    email_verified boolean DEFAULT false,
    email_verified_at timestamp without time zone,
    pending_consents uuid[] DEFAULT '{}'::uuid[],
    verification_pending boolean DEFAULT true NOT NULL,
    account_status public.partner_account_status DEFAULT 'pending_verification'::public.partner_account_status NOT NULL,
    specialty character varying(100),
    license_number character varying(50),
    is_medical_staff boolean DEFAULT false,
    password_hash character varying(255),
    mobile character varying(20),
    profile_photo_url text,
    bio text,
    languages jsonb,
    professional_licenses jsonb,
    education jsonb,
    certifications jsonb,
    experience_years integer,
    specialties jsonb,
    contract_type character varying(50) DEFAULT 'per_service'::character varying,
    commission_calculation character varying(50) DEFAULT 'per_module_user'::character varying,
    commission_percentage numeric(5,2),
    fixed_monthly_rate numeric(10,2),
    fixed_per_employee_rate numeric(10,2),
    city character varying(100),
    province character varying(100),
    country character varying(100),
    service_area jsonb,
    rating numeric(3,2) DEFAULT 0,
    total_reviews integer DEFAULT 0,
    total_services integer DEFAULT 0,
    status character varying(20) DEFAULT 'pending'::character varying,
    CONSTRAINT partners_approval_status_check CHECK (((approval_status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'denied'::character varying])::text[])))
);


--
-- Name: TABLE partners; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.partners IS 'Asociados profesionales (mdicos, abogados, etc.)';


--
-- Name: COLUMN partners.approval_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.approval_status IS 'Estado: pending, approved, denied';


--
-- Name: COLUMN partners.approved_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.approved_by IS 'ID del staff de Aponnt que aprob (UUID de aponnt_staff)';


--
-- Name: COLUMN partners.username; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.username IS 'Usuario para login (generalmente DNI)';


--
-- Name: COLUMN partners.password; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.password IS 'Contrasea hasheada con bcrypt';


--
-- Name: COLUMN partners.first_login; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.first_login IS 'Si debe cambiar contrasea en primer login';


--
-- Name: COLUMN partners.face_descriptor; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.face_descriptor IS 'Descriptor facial de Azure Face API (formato JSON)';


--
-- Name: COLUMN partners.biometric_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.biometric_enabled IS 'Si est habilitado el acceso biomtrico (para futuras APKs)';


--
-- Name: COLUMN partners.denial_reason; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.denial_reason IS 'Motivo de denegacin de la solicitud';


--
-- Name: COLUMN partners.email_verified; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.email_verified IS 'Indica si el email del partner ha sido verificado';


--
-- Name: COLUMN partners.email_verified_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.email_verified_at IS 'Fecha y hora de verificacin del email';


--
-- Name: COLUMN partners.pending_consents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.pending_consents IS 'Array de consent_ids pendientes de aceptacin';


--
-- Name: COLUMN partners.verification_pending; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.verification_pending IS 'Indica si el partner est pendiente de verificacin de email';


--
-- Name: COLUMN partners.account_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.partners.account_status IS 'Estado de la cuenta del partner';


--
-- Name: password_auth_attempts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.password_auth_attempts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    employee_id uuid,
    company_id integer NOT NULL,
    kiosk_id integer,
    password_valid boolean,
    facial_similarity numeric,
    security_photo bytea,
    success boolean,
    requires_hr_review boolean DEFAULT false,
    "timestamp" timestamp without time zone DEFAULT now(),
    device_id character varying(255),
    ip_address character varying(50),
    notes text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payments (
    id bigint NOT NULL,
    invoice_id bigint NOT NULL,
    company_id integer NOT NULL,
    amount numeric(12,2) NOT NULL,
    currency character varying(3) DEFAULT 'USD'::character varying NOT NULL,
    payment_method character varying(50),
    payment_reference character varying(255),
    payment_date date NOT NULL,
    receipt_file_path text,
    receipt_file_name character varying(255),
    notes text,
    registered_by uuid NOT NULL,
    registered_at timestamp with time zone,
    commissions_generated boolean DEFAULT false,
    commissions_generated_at timestamp with time zone,
    created_at timestamp with time zone
);


--
-- Name: payments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payments_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payments_id_seq OWNED BY public.payments.id;


--
-- Name: payroll_concept_classifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_concept_classifications (
    id integer NOT NULL,
    classification_code character varying(30) NOT NULL,
    classification_name character varying(100) NOT NULL,
    descriptions jsonb DEFAULT '{}'::jsonb,
    sign integer NOT NULL,
    affects_employee_net boolean DEFAULT false NOT NULL,
    affects_employer_cost boolean DEFAULT false NOT NULL,
    calculation_order integer DEFAULT 0 NOT NULL,
    is_system boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: payroll_concept_classifications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_concept_classifications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_concept_classifications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_concept_classifications_id_seq OWNED BY public.payroll_concept_classifications.id;


--
-- Name: payroll_concept_type_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_concept_type_rates (
    id integer NOT NULL,
    concept_type_id integer NOT NULL,
    country_id integer,
    employee_rate numeric(8,4) DEFAULT 0 NOT NULL,
    employer_rate numeric(8,4) DEFAULT 0 NOT NULL,
    rate_ceiling numeric(15,2),
    rate_floor numeric(15,2),
    calculation_base character varying(30) DEFAULT 'GROSS'::character varying,
    effective_from date DEFAULT CURRENT_DATE NOT NULL,
    effective_to date,
    legal_reference text,
    legal_url character varying(500),
    help_text text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE payroll_concept_type_rates; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.payroll_concept_type_rates IS 'Tasas de conceptos por pas con historial de vigencia';


--
-- Name: payroll_concept_type_rates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_concept_type_rates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_concept_type_rates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_concept_type_rates_id_seq OWNED BY public.payroll_concept_type_rates.id;


--
-- Name: payroll_concept_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_concept_types (
    id integer NOT NULL,
    type_code character varying(30) NOT NULL,
    type_name character varying(100) NOT NULL,
    description text,
    affects_gross boolean DEFAULT true,
    affects_net boolean DEFAULT true,
    is_taxable boolean DEFAULT true,
    is_deduction boolean DEFAULT false,
    is_employer_cost boolean DEFAULT false,
    display_order integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    country_id integer,
    company_id integer,
    classification_id integer,
    is_remunerative boolean DEFAULT true,
    is_pre_tax boolean DEFAULT false,
    is_mandatory boolean DEFAULT false,
    is_social_security_base boolean DEFAULT true,
    is_proportional_to_time boolean DEFAULT true,
    is_one_time boolean DEFAULT false,
    default_employee_rate numeric(8,4) DEFAULT 0,
    default_employer_rate numeric(8,4) DEFAULT 0,
    rate_ceiling numeric(15,2),
    calculation_base_type character varying(30) DEFAULT 'GROSS'::character varying,
    help_tooltip character varying(200),
    help_detailed text,
    legal_reference text,
    examples_by_country jsonb DEFAULT '{}'::jsonb,
    icon_name character varying(50),
    color_hex character varying(7),
    names_by_locale jsonb DEFAULT '{}'::jsonb
);


--
-- Name: payroll_concept_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_concept_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_concept_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_concept_types_id_seq OWNED BY public.payroll_concept_types.id;


--
-- Name: payroll_countries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_countries (
    id integer NOT NULL,
    country_code character varying(3) NOT NULL,
    country_name character varying(100) NOT NULL,
    currency_code character varying(3) NOT NULL,
    currency_symbol character varying(10) DEFAULT '$'::character varying,
    decimal_places integer DEFAULT 2,
    thousand_separator character varying(1) DEFAULT '.'::character varying,
    decimal_separator character varying(1) DEFAULT ','::character varying,
    labor_law_name character varying(200),
    labor_law_reference character varying(500),
    collective_agreement_name character varying(100) DEFAULT 'Convenio Colectivo de Trabajo'::character varying,
    default_pay_frequency character varying(20) DEFAULT 'monthly'::character varying,
    fiscal_year_start_month integer DEFAULT 1,
    aguinaldo_enabled boolean DEFAULT false,
    aguinaldo_frequency character varying(20) DEFAULT 'biannual'::character varying,
    vacation_calculation_method character varying(50) DEFAULT 'calendar_days'::character varying,
    tax_id_name character varying(50) DEFAULT 'CUIL'::character varying,
    tax_id_format character varying(100),
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    privacy_law_name character varying(100),
    privacy_law_full_name character varying(255),
    privacy_law_url character varying(500),
    privacy_authority_name character varying(255),
    privacy_authority_url character varying(500),
    privacy_authority_email character varying(255),
    requires_explicit_consent boolean DEFAULT true,
    biometric_data_retention_days integer DEFAULT 90,
    emotional_data_retention_days integer DEFAULT 30,
    audit_log_retention_years integer DEFAULT 5,
    allows_automated_decisions boolean DEFAULT false,
    requires_dpo boolean DEFAULT false,
    min_age_consent integer DEFAULT 18,
    allows_employer_monitoring boolean DEFAULT true,
    requires_works_council_approval boolean DEFAULT false,
    data_subject_rights jsonb DEFAULT '[]'::jsonb,
    legal_bases_allowed jsonb DEFAULT '[]'::jsonb,
    consent_intro_text text,
    consent_biometric_text text,
    consent_emotional_text text,
    consent_rights_text text,
    consent_revocation_text text,
    consent_footer_text text,
    breach_notification_hours integer DEFAULT 72,
    consent_expiry_warning_days integer DEFAULT 30,
    requires_dpia_biometric boolean DEFAULT true,
    dpia_template_url character varying(500),
    max_penalty_description character varying(500),
    penalty_currency character varying(10),
    max_penalty_amount numeric(15,2),
    penalty_percentage_revenue numeric(5,2),
    privacy_config_version character varying(20) DEFAULT '1.0'::character varying,
    privacy_config_updated_at timestamp without time zone DEFAULT now(),
    is_gdpr_equivalent boolean DEFAULT false,
    gdpr_adequacy_decision boolean DEFAULT false,
    consent_renewal_months integer DEFAULT 24,
    privacy_law_reference character varying(255),
    privacy_law_version character varying(50),
    data_protection_authority character varying(150),
    dpa_contact_url character varying(255),
    consent_data_sharing_text text,
    rights_exercise_url character varying(255),
    rights_response_days integer DEFAULT 30,
    attendance_data_retention_years integer DEFAULT 5,
    requires_dpia boolean DEFAULT false,
    allows_biometric_for_attendance boolean DEFAULT true,
    allows_emotional_analysis boolean DEFAULT true,
    penalty_calculation_method character varying(100),
    allows_international_transfer boolean DEFAULT false,
    transfer_mechanisms jsonb DEFAULT '[]'::jsonb,
    adequate_countries jsonb DEFAULT '[]'::jsonb,
    breach_notification_authority character varying(150),
    last_privacy_review timestamp without time zone,
    next_privacy_review timestamp without time zone
);


--
-- Name: COLUMN payroll_countries.consent_renewal_months; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.payroll_countries.consent_renewal_months IS 'Perodo de renovacin del consentimiento biomtrico en meses. Vara segn regulaciones de privacidad del pas.';


--
-- Name: payroll_countries_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_countries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_countries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_countries_id_seq OWNED BY public.payroll_countries.id;


--
-- Name: payroll_entities; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_entities (
    entity_id integer NOT NULL,
    company_id integer,
    country_id integer,
    entity_code character varying(30) NOT NULL,
    entity_name character varying(200) NOT NULL,
    entity_type character varying(50) NOT NULL,
    tax_id character varying(30),
    legal_name character varying(200),
    address text,
    phone character varying(50),
    email character varying(100),
    website character varying(200),
    bank_name character varying(100),
    bank_account_number character varying(50),
    bank_account_type character varying(30),
    bank_cbu character varying(30),
    bank_alias character varying(100),
    presentation_format character varying(50),
    presentation_frequency character varying(20) DEFAULT 'monthly'::character varying,
    presentation_deadline_day integer,
    settings jsonb DEFAULT '{}'::jsonb,
    is_government boolean DEFAULT false,
    is_mandatory boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    category_id integer,
    entity_short_name character varying(50),
    requires_employee_affiliation boolean DEFAULT false,
    affiliation_id_name character varying(50),
    calculation_notes text,
    legal_reference text
);


--
-- Name: TABLE payroll_entities; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.payroll_entities IS 'Entidades receptoras de deducciones (AFIP, Obras Sociales, Sindicatos, etc.)';


--
-- Name: payroll_entities_entity_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_entities_entity_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_entities_entity_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_entities_entity_id_seq OWNED BY public.payroll_entities.entity_id;


--
-- Name: payroll_entity_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_entity_categories (
    id integer NOT NULL,
    country_id integer,
    company_id integer,
    category_code character varying(50) NOT NULL,
    category_name character varying(200) NOT NULL,
    category_name_short character varying(50),
    description text,
    flow_direction character varying(30) DEFAULT 'deduction'::character varying NOT NULL,
    icon_name character varying(50),
    color_hex character varying(7),
    consolidation_group character varying(50),
    requires_tax_id boolean DEFAULT false,
    requires_bank_info boolean DEFAULT false,
    default_presentation_format character varying(50),
    presentation_entity_name character varying(200),
    display_order integer DEFAULT 0,
    is_system boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE payroll_entity_categories; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.payroll_entity_categories IS 'Categoras parametrizables de entidades (reemplaza entity_type hardcodeado)';


--
-- Name: COLUMN payroll_entity_categories.flow_direction; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.payroll_entity_categories.flow_direction IS 'Direccin del flujo: earning=ingreso, deduction=descuento empleado, employer_contribution=aporte patronal, informative=solo informativo';


--
-- Name: payroll_entity_categories_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_entity_categories_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_entity_categories_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_entity_categories_id_seq OWNED BY public.payroll_entity_categories.id;


--
-- Name: payroll_entity_settlement_details; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_entity_settlement_details (
    detail_id integer NOT NULL,
    settlement_id integer NOT NULL,
    user_id uuid NOT NULL,
    run_detail_id integer,
    employee_name character varying(200),
    employee_tax_id character varying(30),
    employee_code character varying(50),
    base_amount numeric(15,2) DEFAULT 0,
    employee_amount numeric(15,2) DEFAULT 0,
    employer_amount numeric(15,2) DEFAULT 0,
    total_amount numeric(15,2) DEFAULT 0,
    concepts_breakdown jsonb DEFAULT '[]'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE payroll_entity_settlement_details; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.payroll_entity_settlement_details IS 'Detalle por empleado de cada liquidacin consolidada';


--
-- Name: payroll_entity_settlement_details_detail_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_entity_settlement_details_detail_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_entity_settlement_details_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_entity_settlement_details_detail_id_seq OWNED BY public.payroll_entity_settlement_details.detail_id;


--
-- Name: payroll_entity_settlements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_entity_settlements (
    settlement_id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    entity_id integer NOT NULL,
    period_year integer NOT NULL,
    period_month integer NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    run_id integer,
    settlement_code character varying(50) NOT NULL,
    total_employees integer DEFAULT 0,
    total_amount numeric(18,2) DEFAULT 0,
    total_employer_contribution numeric(18,2) DEFAULT 0,
    total_employee_contribution numeric(18,2) DEFAULT 0,
    grand_total numeric(18,2) DEFAULT 0,
    status character varying(20) DEFAULT 'pending'::character varying,
    generated_at timestamp without time zone,
    reviewed_at timestamp without time zone,
    approved_at timestamp without time zone,
    submitted_at timestamp without time zone,
    paid_at timestamp without time zone,
    generated_by uuid,
    reviewed_by uuid,
    approved_by uuid,
    payment_reference character varying(100),
    payment_date date,
    payment_method character varying(30),
    payment_receipt_url character varying(500),
    presentation_file_url character varying(500),
    presentation_format character varying(50),
    presentation_response jsonb,
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE payroll_entity_settlements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.payroll_entity_settlements IS 'Liquidaciones consolidadas por entidad para presentacin y pago';


--
-- Name: payroll_entity_settlements_settlement_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_entity_settlements_settlement_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_entity_settlements_settlement_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_entity_settlements_settlement_id_seq OWNED BY public.payroll_entity_settlements.settlement_id;


--
-- Name: payroll_payslip_block_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_payslip_block_types (
    id integer NOT NULL,
    block_type character varying(50) NOT NULL,
    block_name character varying(100) NOT NULL,
    description text,
    icon character varying(50),
    configurable_fields jsonb DEFAULT '[]'::jsonb,
    html_template text,
    suggested_order integer DEFAULT 50,
    required_for_countries jsonb DEFAULT '[]'::jsonb,
    is_active boolean DEFAULT true
);


--
-- Name: payroll_payslip_block_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_payslip_block_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_payslip_block_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_payslip_block_types_id_seq OWNED BY public.payroll_payslip_block_types.id;


--
-- Name: payroll_payslip_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_payslip_templates (
    id integer NOT NULL,
    country_id integer,
    company_id integer,
    template_code character varying(30) NOT NULL,
    template_name character varying(100) NOT NULL,
    description text,
    layout_config jsonb DEFAULT '{"style": {"margins": {"top": 20, "left": 15, "right": 15, "bottom": 20}, "font_size": 10, "paper_size": "A4", "font_family": "Arial", "orientation": "portrait", "primary_color": "#1a1a2e", "secondary_color": "#4a5568"}, "blocks": []}'::jsonb NOT NULL,
    required_fields jsonb DEFAULT '[]'::jsonb,
    legal_disclaimers jsonb DEFAULT '[]'::jsonb,
    logo_url character varying(500),
    signature_config jsonb DEFAULT '{"employee_signature": true, "employer_signature": true, "digital_signature_enabled": false}'::jsonb,
    is_default boolean DEFAULT false,
    is_system boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: payroll_payslip_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_payslip_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_payslip_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_payslip_templates_id_seq OWNED BY public.payroll_payslip_templates.id;


--
-- Name: payroll_run_concept_details; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_run_concept_details (
    id integer NOT NULL,
    run_detail_id integer NOT NULL,
    template_concept_id integer,
    concept_type_id integer,
    concept_code character varying(50) NOT NULL,
    concept_name character varying(200) NOT NULL,
    quantity numeric(10,4),
    rate numeric(15,4),
    amount numeric(15,2) NOT NULL,
    calculation_detail text,
    is_override boolean DEFAULT false,
    display_order integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT now(),
    entity_id integer,
    entity_code character varying(30),
    entity_name character varying(200),
    concept_detail_id integer,
    detail_id integer,
    concept_id integer,
    concept_type character varying(30),
    calculation_type character varying(20),
    base_amount numeric(15,2),
    calculated_amount numeric(15,2),
    is_remunerative boolean DEFAULT true,
    is_taxable boolean DEFAULT true,
    is_bonus boolean DEFAULT false,
    show_in_payslip boolean DEFAULT true,
    calculation_details jsonb DEFAULT '{}'::jsonb,
    updated_at timestamp without time zone
);


--
-- Name: payroll_run_concept_details_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_run_concept_details_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_run_concept_details_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_run_concept_details_id_seq OWNED BY public.payroll_run_concept_details.id;


--
-- Name: payroll_run_details; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_run_details (
    id integer NOT NULL,
    run_id integer NOT NULL,
    user_id uuid NOT NULL,
    assignment_id integer,
    worked_days numeric(5,2),
    worked_hours numeric(7,2),
    overtime_50_hours numeric(6,2) DEFAULT 0,
    overtime_100_hours numeric(6,2) DEFAULT 0,
    night_hours numeric(6,2) DEFAULT 0,
    absent_days numeric(5,2) DEFAULT 0,
    gross_earnings numeric(15,2) DEFAULT 0,
    non_remunerative numeric(15,2) DEFAULT 0,
    total_deductions numeric(15,2) DEFAULT 0,
    net_salary numeric(15,2) DEFAULT 0,
    employer_contributions numeric(15,2) DEFAULT 0,
    earnings_detail jsonb DEFAULT '[]'::jsonb,
    deductions_detail jsonb DEFAULT '[]'::jsonb,
    employer_detail jsonb DEFAULT '[]'::jsonb,
    status character varying(30) DEFAULT 'calculated'::character varying,
    error_message text,
    receipt_number character varying(50),
    receipt_generated_at timestamp without time zone,
    receipt_url text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    employee_snapshot jsonb DEFAULT '{}'::jsonb,
    payslip_template_snapshot jsonb DEFAULT '{}'::jsonb
);


--
-- Name: COLUMN payroll_run_details.employee_snapshot; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.payroll_run_details.employee_snapshot IS 'Snapshot del empleado al momento de liquidacin. Estructura:
        {
            "employee_code": "EMP-001",
            "full_name": "Juan Prez",
            "document_number": "12345678",
            "position": {
                "id": 1,
                "code": "GERENTE",
                "name": "Gerente General"
            },
            "department": {
                "id": 5,
                "name": "Administracin"
            },
            "branch": {
                "id": 2,
                "name": "Sucursal Centro"
            },
            "template": {
                "id": 10,
                "code": "TPL-001",
                "name": "Plantilla Mensual"
            },
            "category": {
                "id": 3,
                "name": "Categora A",
                "level": 1
            },
            "base_salary": 150000.00,
            "hire_date": "2020-01-15",
            "seniority_years": 4
        }';


--
-- Name: COLUMN payroll_run_details.payslip_template_snapshot; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.payroll_run_details.payslip_template_snapshot IS 'Snapshot del template de recibo usado. Incluye layout y bloques.';


--
-- Name: payroll_run_details_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_run_details_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_run_details_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_run_details_id_seq OWNED BY public.payroll_run_details.id;


--
-- Name: payroll_runs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_runs (
    id integer NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    run_code character varying(50) NOT NULL,
    run_name character varying(200),
    period_year integer NOT NULL,
    period_month integer NOT NULL,
    period_half integer,
    period_week integer,
    period_start date NOT NULL,
    period_end date NOT NULL,
    payment_date date,
    total_employees integer DEFAULT 0,
    total_gross numeric(18,2) DEFAULT 0,
    total_deductions numeric(18,2) DEFAULT 0,
    total_net numeric(18,2) DEFAULT 0,
    total_employer_cost numeric(18,2) DEFAULT 0,
    status character varying(30) DEFAULT 'draft'::character varying,
    approved_by uuid,
    approved_at timestamp without time zone,
    paid_at timestamp without time zone,
    notes text,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: payroll_runs_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_runs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_runs_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_runs_id_seq OWNED BY public.payroll_runs.id;


--
-- Name: payroll_template_concepts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_template_concepts (
    id integer NOT NULL,
    template_id integer NOT NULL,
    concept_type_id integer NOT NULL,
    concept_code character varying(50) NOT NULL,
    concept_name character varying(200) NOT NULL,
    short_name character varying(50),
    description text,
    calculation_type character varying(30) DEFAULT 'fixed'::character varying NOT NULL,
    default_value numeric(15,4) DEFAULT 0,
    percentage_base character varying(100),
    formula text,
    min_value numeric(15,4),
    max_value numeric(15,4),
    cap_value numeric(15,4),
    applies_to_hourly boolean DEFAULT true,
    applies_to_monthly boolean DEFAULT true,
    is_mandatory boolean DEFAULT false,
    is_visible_receipt boolean DEFAULT true,
    is_editable_per_user boolean DEFAULT true,
    employee_contribution_rate numeric(6,4),
    employer_contribution_rate numeric(6,4),
    legal_reference text,
    display_order integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    entity_id integer,
    entity_account_code character varying(50),
    entity_label character varying(100),
    receipt_note text
);


--
-- Name: payroll_template_concepts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_template_concepts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_template_concepts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_template_concepts_id_seq OWNED BY public.payroll_template_concepts.id;


--
-- Name: payroll_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payroll_templates (
    id integer NOT NULL,
    company_id integer NOT NULL,
    country_id integer,
    branch_id integer,
    labor_agreement_id integer,
    template_code character varying(50) NOT NULL,
    template_name character varying(200) NOT NULL,
    description text,
    pay_frequency character varying(20) DEFAULT 'monthly'::character varying NOT NULL,
    calculation_basis character varying(20) DEFAULT 'monthly'::character varying NOT NULL,
    work_hours_per_day numeric(5,2) DEFAULT 8,
    work_days_per_week numeric(3,1) DEFAULT 5,
    work_hours_per_month numeric(6,2) DEFAULT 200,
    overtime_50_after_hours numeric(5,2) DEFAULT 8,
    overtime_100_after_hours numeric(5,2) DEFAULT 12,
    night_shift_start time without time zone DEFAULT '21:00:00'::time without time zone,
    night_shift_end time without time zone DEFAULT '06:00:00'::time without time zone,
    round_to_cents boolean DEFAULT true,
    round_method character varying(20) DEFAULT 'nearest'::character varying,
    receipt_header text,
    receipt_legal_text text,
    receipt_footer text,
    version integer DEFAULT 1,
    is_current_version boolean DEFAULT true,
    parent_template_id integer,
    is_active boolean DEFAULT true,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: payroll_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.payroll_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: payroll_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.payroll_templates_id_seq OWNED BY public.payroll_templates.id;


--
-- Name: permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.permissions (
    id uuid NOT NULL,
    type public.enum_permissions_type NOT NULL,
    "startDate" timestamp with time zone NOT NULL,
    "endDate" timestamp with time zone NOT NULL,
    hours numeric(4,2),
    reason text NOT NULL,
    status public.enum_permissions_status DEFAULT 'pending'::public.enum_permissions_status,
    "approvedBy" uuid,
    "approvedAt" timestamp with time zone,
    "rejectionReason" text,
    documents json DEFAULT '[]'::json,
    "isEmergency" boolean DEFAULT false,
    "notificationSent" boolean DEFAULT false,
    "UserId" uuid NOT NULL,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    user_id uuid
);


--
-- Name: proactive_executions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.proactive_executions (
    id bigint NOT NULL,
    rule_id integer,
    execution_time timestamp without time zone DEFAULT now(),
    matched_count integer DEFAULT 0,
    actions_taken integer DEFAULT 0,
    execution_details jsonb
);


--
-- Name: proactive_executions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.proactive_executions_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: proactive_executions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.proactive_executions_id_seq OWNED BY public.proactive_executions.id;


--
-- Name: proactive_rules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.proactive_rules (
    id integer NOT NULL,
    company_id integer NOT NULL,
    rule_name character varying(100),
    rule_type character varying(50),
    trigger_condition text,
    trigger_threshold jsonb,
    auto_action character varying(50),
    notification_recipients jsonb,
    notification_template_id integer,
    priority character varying(20),
    check_frequency character varying(20) DEFAULT 'daily'::character varying,
    last_checked timestamp without time zone,
    active boolean DEFAULT true
);


--
-- Name: TABLE proactive_rules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.proactive_rules IS 'Reglas que detectan problemas ANTES de que ocurran';


--
-- Name: proactive_rules_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.proactive_rules_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: proactive_rules_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.proactive_rules_id_seq OWNED BY public.proactive_rules.id;


--
-- Name: procedure_acknowledgements; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_acknowledgements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    procedure_version_id uuid,
    user_id uuid NOT NULL,
    employee_id character varying(50),
    employee_name character varying(255),
    status character varying(20) DEFAULT 'pending'::character varying,
    notification_id uuid,
    notification_sent_at timestamp without time zone,
    acknowledged_at timestamp without time zone,
    acknowledgement_ip character varying(45),
    acknowledgement_method character varying(20),
    reminder_count integer DEFAULT 0,
    last_reminder_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE procedure_acknowledgements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedure_acknowledgements IS 'Acuses de recibo de procedimientos';


--
-- Name: procedure_attachments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_attachments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    procedure_version_id uuid,
    file_name character varying(255) NOT NULL,
    file_type character varying(50),
    file_size integer,
    file_path text,
    mime_type character varying(100),
    description text,
    is_main_document boolean DEFAULT false,
    uploaded_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE procedure_attachments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedure_attachments IS 'Archivos adjuntos a procedimientos';


--
-- Name: procedure_comments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_comments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    procedure_version_id uuid,
    user_id uuid NOT NULL,
    comment_type character varying(20) DEFAULT 'comment'::character varying,
    content text NOT NULL,
    is_resolved boolean DEFAULT false,
    resolved_by uuid,
    resolved_at timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE procedure_comments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedure_comments IS 'Comentarios y revisiones de procedimientos';


--
-- Name: procedure_draft_locks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_draft_locks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    locked_by uuid NOT NULL,
    locked_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    unlocked_at timestamp without time zone,
    unlock_reason character varying(50),
    expires_at timestamp without time zone NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: procedure_roles; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_roles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    organizational_position_id integer,
    role_name character varying(100),
    scope_type character varying(20) DEFAULT 'must_read'::character varying,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE procedure_roles; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedure_roles IS 'Roles organizacionales alcanzados por cada procedimiento';


--
-- Name: procedure_versions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedure_versions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    procedure_id uuid NOT NULL,
    version_number integer NOT NULL,
    version_label character varying(20) NOT NULL,
    objective text,
    scope text,
    definitions text,
    responsibilities text,
    procedure_content text,
    "references" text,
    annexes text,
    changes_summary text,
    change_reason text,
    created_by uuid,
    published_by uuid,
    published_at timestamp without time zone,
    status character varying(20) DEFAULT 'current'::character varying,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE procedure_versions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedure_versions IS 'Historial de versiones de procedimientos';


--
-- Name: procedures; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.procedures (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer NOT NULL,
    code character varying(50) NOT NULL,
    title character varying(255) NOT NULL,
    type character varying(20) DEFAULT 'instructivo'::character varying,
    current_version integer DEFAULT 1,
    version_label character varying(20) DEFAULT '1.0'::character varying,
    status character varying(20) DEFAULT 'draft'::character varying,
    objective text,
    scope text,
    definitions text,
    responsibilities text,
    procedure_content text,
    "references" text,
    annexes text,
    branch_id integer,
    department_id integer,
    sector_id integer,
    effective_date date,
    review_date date,
    obsolete_date date,
    created_by uuid,
    reviewed_by uuid,
    approved_by uuid,
    published_by uuid,
    reviewed_at timestamp without time zone,
    approved_at timestamp without time zone,
    published_at timestamp without time zone,
    tags text[],
    is_critical boolean DEFAULT false,
    requires_training boolean DEFAULT false,
    training_module_id uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    owners jsonb DEFAULT '[]'::jsonb,
    expiry_date date,
    scope_type public.procedure_scope_type DEFAULT 'company'::public.procedure_scope_type,
    scope_entities jsonb DEFAULT '[]'::jsonb,
    draft_locked_by uuid,
    draft_locked_at timestamp without time zone,
    draft_expires_at timestamp without time zone,
    parent_id uuid,
    hierarchy_level integer DEFAULT 4,
    hierarchy_path text,
    inherit_scope boolean DEFAULT true,
    CONSTRAINT procedures_hierarchy_level_check CHECK (((hierarchy_level >= 1) AND (hierarchy_level <= 4)))
);


--
-- Name: TABLE procedures; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.procedures IS 'Manual de Procedimientos - Documentos ISO 9001';


--
-- Name: COLUMN procedures.owners; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.owners IS 'Lista de propietarios/creadores del documento en orden cronolgico';


--
-- Name: COLUMN procedures.expiry_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.expiry_date IS 'Fecha de caducidad programada del documento';


--
-- Name: COLUMN procedures.scope_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.scope_type IS 'Tipo de alcance: company, branch, department, sector, role, position, users';


--
-- Name: COLUMN procedures.scope_entities; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.scope_entities IS 'Entidades especficas alcanzadas segn scope_type [{id, name, ...}]';


--
-- Name: COLUMN procedures.draft_locked_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.draft_locked_by IS 'Usuario que tiene bloqueado el borrador actualmente';


--
-- Name: COLUMN procedures.draft_locked_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.draft_locked_at IS 'Momento en que se bloque el borrador';


--
-- Name: COLUMN procedures.draft_expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.draft_expires_at IS 'Momento en que expira el borrador (mx 7 das)';


--
-- Name: COLUMN procedures.parent_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.parent_id IS 'ID del documento padre en la jerarqua (NULL solo para polticas)';


--
-- Name: COLUMN procedures.hierarchy_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.hierarchy_level IS 'Nivel jerrquico: 1=poltica, 2=manual, 3=procedimiento, 4=instructivo';


--
-- Name: COLUMN procedures.hierarchy_path; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.hierarchy_path IS 'Ruta materializada para queries eficientes (/uuid1/uuid2/uuid3)';


--
-- Name: COLUMN procedures.inherit_scope; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.procedures.inherit_scope IS 'Si TRUE, hereda el scope del documento padre';


--
-- Name: report_access_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.report_access_log (
    id bigint NOT NULL,
    report_id integer NOT NULL,
    access_type character varying(30) NOT NULL,
    accessed_at timestamp without time zone DEFAULT now() NOT NULL,
    accessed_by character varying(100),
    success boolean DEFAULT true,
    ip_address inet,
    user_agent text
);


--
-- Name: TABLE report_access_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.report_access_log IS 'Log inmutable de accesos a reportes para trazabilidad completa';


--
-- Name: report_access_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.report_access_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: report_access_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.report_access_log_id_seq OWNED BY public.report_access_log.id;


--
-- Name: request_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.request_types (
    id integer NOT NULL,
    code character varying(50) NOT NULL,
    category character varying(30) NOT NULL,
    display_name_es character varying(255) NOT NULL,
    display_name_en character varying(255),
    display_name_pt character varying(255),
    legal_term character varying(100) NOT NULL,
    description text,
    approval_chain jsonb NOT NULL,
    form_fields jsonb NOT NULL,
    validation_rules jsonb,
    email_subject_template character varying(255),
    email_body_template text,
    requires_attachments boolean DEFAULT false,
    allowed_file_types character varying(255),
    icon character varying(50) DEFAULT ''::character varying,
    color character varying(7) DEFAULT '#007bff'::character varying,
    active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: request_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.request_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: request_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.request_types_id_seq OWNED BY public.request_types.id;


--
-- Name: risk_benchmarks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.risk_benchmarks (
    id integer NOT NULL,
    benchmark_code character varying(50) NOT NULL,
    benchmark_name character varying(200) NOT NULL,
    ciuo_code character varying(10),
    work_category character varying(50),
    industry_code character varying(20),
    country_code character varying(3) DEFAULT 'ARG'::character varying,
    source character varying(100) NOT NULL,
    source_year integer,
    source_url text,
    fatigue_p25 numeric(5,2),
    fatigue_p50 numeric(5,2),
    fatigue_p75 numeric(5,2),
    fatigue_p90 numeric(5,2),
    accident_p25 numeric(5,2),
    accident_p50 numeric(5,2),
    accident_p75 numeric(5,2),
    accident_p90 numeric(5,2),
    legal_claim_p25 numeric(5,2),
    legal_claim_p50 numeric(5,2),
    legal_claim_p75 numeric(5,2),
    legal_claim_p90 numeric(5,2),
    turnover_p25 numeric(5,2),
    turnover_p50 numeric(5,2),
    turnover_p75 numeric(5,2),
    turnover_p90 numeric(5,2),
    recommended_weights jsonb DEFAULT '{"legal": 0.20, "fatigue": 0.25, "accident": 0.25, "turnover": 0.15, "performance": 0.15}'::jsonb,
    is_active boolean DEFAULT true,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE risk_benchmarks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.risk_benchmarks IS 'Benchmarks internacionales de riesgo laboral por tipo de ocupacin (OIT, OSHA, SRT)';


--
-- Name: risk_benchmarks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.risk_benchmarks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: risk_benchmarks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.risk_benchmarks_id_seq OWNED BY public.risk_benchmarks.id;


--
-- Name: role_definitions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.role_definitions (
    id integer NOT NULL,
    company_id integer,
    role_key character varying(50) NOT NULL,
    role_name character varying(100) NOT NULL,
    description text,
    category character varying(50) DEFAULT 'internal'::character varying,
    module_permissions jsonb DEFAULT '{}'::jsonb NOT NULL,
    special_permissions jsonb DEFAULT '{}'::jsonb,
    is_system_role boolean DEFAULT false,
    is_default_for_new_users boolean DEFAULT false,
    priority integer DEFAULT 0,
    color character varying(20) DEFAULT '#6c757d'::character varying,
    icon character varying(50) DEFAULT 'fa-user'::character varying,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    created_by uuid,
    inherits_from integer,
    max_users_per_company integer,
    requires_position_category text[]
);


--
-- Name: role_definitions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.role_definitions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: role_definitions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.role_definitions_id_seq OWNED BY public.role_definitions.id;


--
-- Name: role_template_permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.role_template_permissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    role_template_id character varying(50) NOT NULL,
    action_id character varying(100) NOT NULL,
    has_access boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: salary_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.salary_categories (
    id integer NOT NULL,
    labor_agreement_id integer,
    category_code character varying(20) NOT NULL,
    category_name character varying(200) NOT NULL,
    description text,
    base_salary_reference numeric(12,2),
    effective_date date,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE salary_categories; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.salary_categories IS 'Categoras salariales por convenio';


--
-- Name: salary_categories_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.salary_categories_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: salary_categories_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.salary_categories_id_seq OWNED BY public.salary_categories.id;


--
-- Name: salary_categories_v2; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.salary_categories_v2 (
    id integer NOT NULL,
    labor_agreement_id integer,
    company_id integer,
    category_code character varying(50) NOT NULL,
    category_name character varying(200) NOT NULL,
    description text,
    base_salary_min numeric(15,2),
    base_salary_max numeric(15,2),
    hourly_rate_min numeric(10,4),
    hourly_rate_max numeric(10,4),
    recommended_base_salary numeric(15,2),
    recommended_hourly_rate numeric(10,4),
    seniority_level integer DEFAULT 1,
    is_active boolean DEFAULT true,
    effective_from date,
    effective_to date,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    category_id integer,
    agreement_id integer,
    base_salary numeric(15,2),
    hourly_rate numeric(10,2),
    level integer DEFAULT 1,
    requires_degree boolean DEFAULT false,
    min_experience_years integer DEFAULT 0
);


--
-- Name: salary_categories_v2_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.salary_categories_v2_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: salary_categories_v2_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.salary_categories_v2_id_seq OWNED BY public.salary_categories_v2.id;


--
-- Name: sanction_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sanction_history (
    id integer NOT NULL,
    sanction_id integer,
    action character varying(50) NOT NULL,
    actor_id uuid,
    actor_name character varying(255),
    actor_role character varying(50),
    previous_status character varying(50),
    new_status character varying(50),
    notes text,
    metadata jsonb DEFAULT '{}'::jsonb,
    ip_address character varying(45),
    user_agent text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE sanction_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sanction_history IS 'Historial inmutable de todas las acciones sobre sanciones';


--
-- Name: COLUMN sanction_history.action; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanction_history.action IS 'created, submitted, lawyer_approved, lawyer_rejected, lawyer_modified, hr_confirmed, activated, appealed, appeal_resolved, closed, etc.';


--
-- Name: sanction_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sanction_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sanction_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sanction_history_id_seq OWNED BY public.sanction_history.id;


--
-- Name: sanction_types; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sanction_types (
    id integer NOT NULL,
    company_id integer,
    code character varying(50) NOT NULL,
    name character varying(200) NOT NULL,
    description text,
    category character varying(50) DEFAULT 'other'::character varying,
    default_severity character varying(50) DEFAULT 'warning'::character varying,
    default_points_deducted integer DEFAULT 0,
    requires_legal_review boolean DEFAULT true,
    suspension_days_default integer DEFAULT 0,
    is_system boolean DEFAULT false,
    is_active boolean DEFAULT true,
    sort_order integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE sanction_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sanction_types IS 'Catlogo de tipos de sancin parametrizables por empresa';


--
-- Name: COLUMN sanction_types.company_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanction_types.company_id IS 'NULL = tipo global disponible para todas las empresas';


--
-- Name: COLUMN sanction_types.is_system; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanction_types.is_system IS 'true = no puede ser modificado ni eliminado';


--
-- Name: sanction_types_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sanction_types_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sanction_types_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sanction_types_id_seq OWNED BY public.sanction_types.id;


--
-- Name: sanctions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sanctions (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    employee_id character varying(50),
    employee_name character varying(255),
    employee_department character varying(255),
    sanction_type character varying(100) NOT NULL,
    severity character varying(50) DEFAULT 'low'::character varying,
    title character varying(255) NOT NULL,
    description text,
    sanction_date date DEFAULT CURRENT_DATE NOT NULL,
    expiration_date date,
    status character varying(50) DEFAULT 'active'::character varying,
    points_deducted integer DEFAULT 0,
    is_automatic boolean DEFAULT false,
    related_attendance_id uuid,
    related_incident_id integer,
    created_by uuid,
    approved_by uuid,
    approval_date timestamp with time zone,
    appeal_notes text,
    appeal_date timestamp with time zone,
    appeal_resolved_by uuid,
    appeal_resolution text,
    documents jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    workflow_status character varying(50) DEFAULT 'draft'::character varying,
    sanction_type_id integer,
    requester_id uuid,
    requester_role character varying(50),
    original_description text,
    lawyer_id uuid,
    lawyer_review_date timestamp without time zone,
    lawyer_notes text,
    lawyer_modified_description text,
    hr_confirmation_id uuid,
    hr_confirmation_date timestamp without time zone,
    hr_notes text,
    delivery_method character varying(50) DEFAULT 'system'::character varying,
    suspension_start_date date,
    suspension_days integer DEFAULT 0,
    suspension_end_date date,
    rejection_reason text,
    rejected_by uuid,
    rejected_at timestamp without time zone,
    appeal_status character varying(50),
    appeal_resolved_at timestamp without time zone,
    appeal_resolution_notes text,
    workflow_metadata jsonb DEFAULT '{}'::jsonb,
    CONSTRAINT sanctions_sanction_type_check CHECK (((sanction_type)::text = ANY ((ARRAY['warning'::character varying, 'written_warning'::character varying, 'suspension'::character varying, 'dismissal'::character varying, 'other'::character varying])::text[]))),
    CONSTRAINT sanctions_severity_check CHECK (((severity)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying])::text[]))),
    CONSTRAINT sanctions_status_check CHECK (((status)::text = ANY ((ARRAY['active'::character varying, 'expired'::character varying, 'revoked'::character varying, 'appealed'::character varying])::text[])))
);


--
-- Name: COLUMN sanctions.workflow_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanctions.workflow_status IS 'draft, pending_lawyer, pending_hr, active, rejected, appealed, closed';


--
-- Name: COLUMN sanctions.delivery_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanctions.delivery_method IS 'system, email, carta_documento, presencial';


--
-- Name: COLUMN sanctions.appeal_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.sanctions.appeal_status IS 'pending, approved, denied';


--
-- Name: sanctions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sanctions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sanctions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sanctions_id_seq OWNED BY public.sanctions.id;


--
-- Name: schema_migrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.schema_migrations (
    version character varying(255) NOT NULL,
    name character varying(500) NOT NULL,
    executed_at timestamp without time zone DEFAULT now()
);


--
-- Name: scoring_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.scoring_history (
    id bigint NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    snapshot_date date NOT NULL,
    scoring_total numeric(5,2),
    scoring_punctuality numeric(5,2),
    scoring_absence numeric(5,2),
    scoring_late_arrival numeric(5,2),
    scoring_early_departure numeric(5,2),
    change_from_previous numeric(6,2),
    change_reason character varying(255),
    trend character varying(20),
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT chk_scoring_hist_trend CHECK (((trend)::text = ANY ((ARRAY['improving'::character varying, 'stable'::character varying, 'declining'::character varying])::text[])))
);


--
-- Name: TABLE scoring_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.scoring_history IS 'Historial temporal de scoring (snapshots semanales para trending)';


--
-- Name: scoring_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.scoring_history_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: scoring_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.scoring_history_id_seq OWNED BY public.scoring_history.id;


--
-- Name: sectors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sectors (
    id integer NOT NULL,
    company_id integer NOT NULL,
    department_id integer NOT NULL,
    name character varying(100) NOT NULL,
    code character varying(20),
    description text,
    supervisor_id uuid,
    gps_lat numeric(10,8),
    gps_lng numeric(11,8),
    coverage_radius integer DEFAULT 50,
    max_employees integer,
    is_active boolean DEFAULT true,
    display_order integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: sectors_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sectors_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sectors_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sectors_id_seq OWNED BY public.sectors.id;


--
-- Name: shifts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.shifts (
    id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    name character varying(255) NOT NULL,
    "startTime" time without time zone NOT NULL,
    "endTime" time without time zone NOT NULL,
    "toleranceMinutes" integer DEFAULT 10,
    "isActive" boolean DEFAULT true,
    description text,
    days json,
    "toleranceMinutesEntry" integer DEFAULT 10,
    "toleranceMinutesExit" integer DEFAULT 15,
    "shiftType" public."enum_shifts_shiftType" DEFAULT 'standard'::public."enum_shifts_shiftType",
    "breakStartTime" time without time zone,
    "breakEndTime" time without time zone,
    "rotationPattern" character varying(255),
    "cycleStartDate" date,
    "workDays" integer,
    "restDays" integer,
    "flashStartDate" date,
    "flashEndDate" date,
    "flashPriority" public."enum_shifts_flashPriority" DEFAULT 'normal'::public."enum_shifts_flashPriority",
    "allowOverride" boolean DEFAULT false,
    "permanentPriority" public."enum_shifts_permanentPriority" DEFAULT 'normal'::public."enum_shifts_permanentPriority",
    "hourlyRates" json DEFAULT '{"normal":1,"overtime":1.5,"weekend":1.5,"holiday":2}'::json,
    color character varying(7) DEFAULT '#007bff'::character varying,
    notes text,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL,
    company_id integer,
    "toleranceConfig" jsonb DEFAULT '{"exit": {"after": 30, "before": 0}, "entry": {"after": 10, "before": 15}}'::jsonb,
    global_cycle_start_date date,
    phases jsonb DEFAULT '[]'::jsonb,
    branch_id uuid,
    respect_national_holidays boolean DEFAULT false,
    respect_provincial_holidays boolean DEFAULT false,
    custom_non_working_days jsonb DEFAULT '[]'::jsonb
);


--
-- Name: COLUMN shifts.days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.days IS 'Array de das: [0=Dom, 1=Lun, ..., 6=Sab]';


--
-- Name: COLUMN shifts."shiftType"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."shiftType" IS 'Tipo de turno: estndar, rotativo, permanente o flash';


--
-- Name: COLUMN shifts."breakStartTime"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."breakStartTime" IS 'Hora inicio descanso';


--
-- Name: COLUMN shifts."breakEndTime"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."breakEndTime" IS 'Hora fin descanso';


--
-- Name: COLUMN shifts."rotationPattern"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."rotationPattern" IS 'Patrn rotativo: 12x4, 6x2, etc.';


--
-- Name: COLUMN shifts."cycleStartDate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."cycleStartDate" IS 'Fecha inicio ciclo rotativo';


--
-- Name: COLUMN shifts."workDays"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."workDays" IS 'Das trabajados en ciclo rotativo';


--
-- Name: COLUMN shifts."restDays"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."restDays" IS 'Das descanso en ciclo rotativo';


--
-- Name: COLUMN shifts."flashStartDate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."flashStartDate" IS 'Fecha inicio turno flash';


--
-- Name: COLUMN shifts."flashEndDate"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."flashEndDate" IS 'Fecha fin turno flash';


--
-- Name: COLUMN shifts."flashPriority"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."flashPriority" IS 'Prioridad del turno flash';


--
-- Name: COLUMN shifts."allowOverride"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."allowOverride" IS 'Permitir sobreasignacin sobre otros turnos';


--
-- Name: COLUMN shifts."permanentPriority"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."permanentPriority" IS 'Prioridad del turno permanente';


--
-- Name: COLUMN shifts."hourlyRates"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."hourlyRates" IS 'Multiplicadores de tarifa por tipo de hora';


--
-- Name: COLUMN shifts.color; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.color IS 'Color para visualizacin en calendario';


--
-- Name: COLUMN shifts.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.notes IS 'Notas adicionales del turno';


--
-- Name: COLUMN shifts."toleranceConfig"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts."toleranceConfig" IS 'Configuracin detallada de tolerancias de entrada y salida';


--
-- Name: COLUMN shifts.global_cycle_start_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.global_cycle_start_date IS 'Fecha en que ARRANC el ciclo del turno (reloj propio global)';


--
-- Name: COLUMN shifts.phases; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.phases IS 'Fases detalladas del turno: [{ name, duration, startTime, endTime, groupName, sector }]';


--
-- Name: COLUMN shifts.branch_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.branch_id IS 'Sucursal del turno (NULL = aplica a TODAS las sucursales)';


--
-- Name: COLUMN shifts.respect_national_holidays; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.respect_national_holidays IS 'Si TRUE, excluye feriados nacionales del calendario';


--
-- Name: COLUMN shifts.respect_provincial_holidays; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.respect_provincial_holidays IS 'Si TRUE, excluye feriados provinciales del calendario';


--
-- Name: COLUMN shifts.custom_non_working_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.shifts.custom_non_working_days IS 'Array de fechas personalizadas no laborables: ["2025-12-24", "2026-01-02"]';


--
-- Name: siac_cajas; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_cajas (
    id integer NOT NULL,
    punto_venta_id integer NOT NULL,
    codigo_caja character varying(10) NOT NULL,
    nombre_caja character varying(100) NOT NULL,
    descripcion text,
    tipo_caja character varying(20) DEFAULT 'GENERAL'::character varying,
    permite_efectivo boolean DEFAULT true,
    permite_tarjetas boolean DEFAULT true,
    permite_cheques boolean DEFAULT false,
    permite_transferencias boolean DEFAULT false,
    permite_cuenta_corriente boolean DEFAULT false,
    limite_efectivo numeric(12,2) DEFAULT 0,
    limite_descuento_porcentaje numeric(5,2) DEFAULT 0,
    requiere_autorizacion_descuento boolean DEFAULT false,
    requiere_supervisor_anulacion boolean DEFAULT true,
    activo boolean DEFAULT true,
    predeterminada boolean DEFAULT false,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer,
    updated_by integer
);


--
-- Name: siac_cajas_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_cajas_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_cajas_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_cajas_id_seq OWNED BY public.siac_cajas.id;


--
-- Name: siac_clientes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_clientes (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_cliente character varying(20) NOT NULL,
    razon_social character varying(255) NOT NULL,
    nombre_fantasia character varying(255),
    tipo_cliente character varying(20) DEFAULT 'PERSONA_FISICA'::character varying,
    documento_tipo character varying(20) DEFAULT 'CUIT'::character varying,
    documento_numero character varying(20) NOT NULL,
    documento_formateado character varying(30),
    email character varying(255),
    telefono character varying(50),
    celular character varying(50),
    whatsapp character varying(50),
    website character varying(255),
    domicilio_calle character varying(255),
    domicilio_numero character varying(20),
    domicilio_piso character varying(10),
    domicilio_depto character varying(10),
    domicilio_completo text,
    ciudad character varying(100),
    provincia_estado character varying(100),
    codigo_postal character varying(20),
    pais character varying(100) DEFAULT 'Argentina'::character varying,
    latitud numeric(10,8),
    longitud numeric(11,8),
    categoria_cliente character varying(50) DEFAULT 'GENERAL'::character varying,
    lista_precio character varying(50) DEFAULT 'GENERAL'::character varying,
    descuento_maximo numeric(5,2) DEFAULT 0.00,
    limite_credito numeric(15,4) DEFAULT 0,
    credito_disponible numeric(15,4) DEFAULT 0,
    dias_vencimiento integer DEFAULT 30,
    vendedor_asignado_id integer,
    canal_venta character varying(50) DEFAULT 'DIRECTO'::character varying,
    origen_cliente character varying(50) DEFAULT 'MANUAL'::character varying,
    requiere_orden_compra boolean DEFAULT false,
    formato_facturacion character varying(20) DEFAULT 'A'::character varying,
    email_facturacion character varying(255),
    fecha_alta date DEFAULT CURRENT_DATE,
    fecha_primera_compra date,
    fecha_ultima_compra date,
    total_compras numeric(15,4) DEFAULT 0,
    cantidad_facturas integer DEFAULT 0,
    promedio_compra numeric(15,4) DEFAULT 0,
    observaciones text,
    notas_internas text,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    datos_extra jsonb DEFAULT '{}'::jsonb,
    estado character varying(20) DEFAULT 'ACTIVO'::character varying,
    motivo_inactivacion text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    provincia character varying(100),
    localidad character varying(100),
    calle character varying(200),
    numero character varying(20),
    piso character varying(10),
    departamento character varying(10),
    condicion_fiscal character varying(50),
    condicion_fiscal_code character varying(20),
    cuenta_corriente_habilitada boolean DEFAULT false,
    plazo_pago_dias integer DEFAULT 0,
    credito_maximo numeric(12,2) DEFAULT 0,
    credito_utilizado numeric(12,2) DEFAULT 0,
    bloqueo_por_vencimiento boolean DEFAULT false,
    bloqueo_por_credito boolean DEFAULT false,
    fecha_ultimo_analisis date,
    observaciones_credito text,
    banco character varying(100),
    tipo_cuenta character varying(50),
    numero_cuenta character varying(50),
    cbu character varying(22),
    alias_cbu character varying(100),
    descuento_general numeric(5,2) DEFAULT 0,
    lista_precios_id integer,
    vendedor_id integer,
    zona_comercial character varying(100)
);


--
-- Name: COLUMN siac_clientes.pais; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.pais IS 'Pas del cliente (multi-pas)';


--
-- Name: COLUMN siac_clientes.credito_disponible; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.credito_disponible IS 'Crdito disponible (auto-calculado)';


--
-- Name: COLUMN siac_clientes.provincia; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.provincia IS 'Provincia/Estado del cliente';


--
-- Name: COLUMN siac_clientes.condicion_fiscal; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.condicion_fiscal IS 'Condicin fiscal parametrizable (ej: RI, RM, CF en Argentina)';


--
-- Name: COLUMN siac_clientes.condicion_fiscal_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.condicion_fiscal_code IS 'Cdigo de condicin fiscal segn tax_conditions';


--
-- Name: COLUMN siac_clientes.cuenta_corriente_habilitada; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.cuenta_corriente_habilitada IS 'Si tiene cuenta corriente habilitada';


--
-- Name: COLUMN siac_clientes.plazo_pago_dias; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.plazo_pago_dias IS 'Plazo de pago en das (30, 60, 90)';


--
-- Name: COLUMN siac_clientes.credito_maximo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.credito_maximo IS 'Crdito mximo disponible';


--
-- Name: COLUMN siac_clientes.credito_utilizado; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.credito_utilizado IS 'Crdito actualmente utilizado';


--
-- Name: COLUMN siac_clientes.bloqueo_por_vencimiento; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.bloqueo_por_vencimiento IS 'Bloqueado por vencimiento de plazo';


--
-- Name: COLUMN siac_clientes.bloqueo_por_credito; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_clientes.bloqueo_por_credito IS 'Bloqueado por exceso de crdito';


--
-- Name: siac_clientes_contactos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_clientes_contactos (
    id integer NOT NULL,
    cliente_id integer NOT NULL,
    nombre character varying(100) NOT NULL,
    apellido character varying(100),
    cargo character varying(100),
    departamento character varying(100),
    telefono character varying(50),
    celular character varying(50),
    email character varying(255),
    es_contacto_principal boolean DEFAULT false,
    recibe_facturas boolean DEFAULT false,
    recibe_cobranzas boolean DEFAULT false,
    recibe_marketing boolean DEFAULT true,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_clientes_contactos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_clientes_contactos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_clientes_contactos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_clientes_contactos_id_seq OWNED BY public.siac_clientes_contactos.id;


--
-- Name: siac_clientes_direcciones; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_clientes_direcciones (
    id integer NOT NULL,
    cliente_id integer NOT NULL,
    tipo_direccion character varying(30) DEFAULT 'ADICIONAL'::character varying NOT NULL,
    nombre_direccion character varying(100),
    calle character varying(255) NOT NULL,
    numero character varying(20),
    piso character varying(10),
    departamento character varying(10),
    entre_calles character varying(255),
    referencias text,
    ciudad character varying(100),
    provincia_estado character varying(100),
    codigo_postal character varying(20),
    pais character varying(100) DEFAULT 'Argentina'::character varying,
    latitud numeric(10,8),
    longitud numeric(11,8),
    es_direccion_principal boolean DEFAULT false,
    activa_para_facturacion boolean DEFAULT true,
    activa_para_entrega boolean DEFAULT true,
    horarios_entrega jsonb DEFAULT '{}'::jsonb,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_clientes_direcciones_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_clientes_direcciones_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_clientes_direcciones_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_clientes_direcciones_id_seq OWNED BY public.siac_clientes_direcciones.id;


--
-- Name: siac_clientes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_clientes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_clientes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_clientes_id_seq OWNED BY public.siac_clientes.id;


--
-- Name: siac_clientes_precios_especiales; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_clientes_precios_especiales (
    id integer NOT NULL,
    cliente_id integer NOT NULL,
    producto_id integer,
    producto_codigo character varying(50),
    producto_descripcion character varying(255),
    precio_especial numeric(15,4) NOT NULL,
    moneda character varying(3) DEFAULT 'ARS'::character varying,
    tipo_precio character varying(20) DEFAULT 'FIJO'::character varying,
    valor_descuento numeric(15,4),
    fecha_desde date DEFAULT CURRENT_DATE,
    fecha_hasta date,
    cantidad_minima integer DEFAULT 1,
    solo_contado boolean DEFAULT false,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_clientes_precios_especiales_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_clientes_precios_especiales_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_clientes_precios_especiales_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_clientes_precios_especiales_id_seq OWNED BY public.siac_clientes_precios_especiales.id;


--
-- Name: siac_configuracion_empresa; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_configuracion_empresa (
    id integer NOT NULL,
    company_id integer NOT NULL,
    razon_social character varying(255),
    domicilio character varying(255),
    cuit character varying(15),
    ingresos_brutos character varying(20),
    condicion_iva character varying(50) DEFAULT 'RESPONSABLE_INSCRIPTO'::character varying,
    punto_venta integer DEFAULT 1,
    agente_retencion_iva boolean DEFAULT false,
    agente_percepcion_iva boolean DEFAULT false,
    agente_retencion_ib boolean DEFAULT false,
    agente_percepcion_ib boolean DEFAULT false,
    porc_retencion_iva numeric(5,2) DEFAULT 10.50,
    porc_percepcion_iva numeric(5,2) DEFAULT 21.00,
    porc_retencion_ib numeric(5,2) DEFAULT 3.00,
    porc_percepcion_ib numeric(5,2) DEFAULT 3.50,
    habilita_facturacion boolean DEFAULT true,
    factura_a_numero integer DEFAULT 1,
    factura_b_numero integer DEFAULT 1,
    factura_c_numero integer DEFAULT 1,
    pais character varying(3) DEFAULT 'ARG'::character varying,
    moneda character varying(3) DEFAULT 'ARS'::character varying,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_configuracion_empresa_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_configuracion_empresa_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_configuracion_empresa_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_configuracion_empresa_id_seq OWNED BY public.siac_configuracion_empresa.id;


--
-- Name: siac_configuracion_terminal; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_configuracion_terminal (
    id integer NOT NULL,
    company_id integer NOT NULL,
    terminal_id character varying(50) NOT NULL,
    nombre_terminal character varying(100),
    tipo_terminal character varying(30) DEFAULT 'CAJA'::character varying,
    impresora_principal character varying(100),
    impresora_tickets character varying(100),
    display_cliente character varying(100),
    lector_codigo_barras character varying(100),
    modulos_habilitados jsonb DEFAULT '[]'::jsonb,
    permisos_especiales jsonb DEFAULT '{}'::jsonb,
    punto_venta_asignado integer,
    certificado_fiscal character varying(255),
    activo boolean DEFAULT true,
    ultimo_uso timestamp without time zone,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_configuracion_terminal_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_configuracion_terminal_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_configuracion_terminal_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_configuracion_terminal_id_seq OWNED BY public.siac_configuracion_terminal.id;


--
-- Name: siac_facturas; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_facturas (
    id integer NOT NULL,
    caja_id integer NOT NULL,
    tipo_comprobante_id integer NOT NULL,
    numero_completo character varying(50) NOT NULL,
    prefijo character varying(10),
    numero integer NOT NULL,
    fecha_factura date DEFAULT CURRENT_DATE NOT NULL,
    fecha_vencimiento date,
    fecha_entrega date,
    cliente_id integer,
    cliente_codigo character varying(50),
    cliente_razon_social character varying(200) NOT NULL,
    cliente_documento_tipo character varying(10),
    cliente_documento_numero character varying(20),
    cliente_direccion text,
    cliente_telefono character varying(50),
    cliente_email character varying(100),
    cliente_condicion_iva character varying(50) DEFAULT 'CONSUMIDOR_FINAL'::character varying,
    subtotal numeric(12,2) DEFAULT 0,
    descuento_porcentaje numeric(5,2) DEFAULT 0,
    descuento_importe numeric(12,2) DEFAULT 0,
    total_impuestos numeric(12,2) DEFAULT 0,
    total_neto numeric(12,2) DEFAULT 0,
    total_factura numeric(12,2) DEFAULT 0 NOT NULL,
    estado character varying(20) DEFAULT 'PENDIENTE'::character varying,
    factura_original_id integer,
    motivo_anulacion text,
    autorizada_por integer,
    cae character varying(50),
    cae_vencimiento date,
    codigo_barras text,
    observaciones text,
    notas_internas text,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer NOT NULL,
    updated_by integer,
    presupuesto_id integer,
    company_id integer DEFAULT 1 NOT NULL,
    punto_venta integer,
    tipo_comprobante_afip integer,
    numero_comprobante bigint,
    estado_afip character varying(20) DEFAULT 'PENDIENTE'::character varying,
    observaciones_afip text,
    cliente_cuit character varying(13),
    concepto integer DEFAULT 1,
    moneda character varying(3) DEFAULT 'PES'::character varying,
    cotizacion numeric(10,4) DEFAULT 1,
    fecha_servicio_desde date,
    fecha_servicio_hasta date,
    items jsonb DEFAULT '[]'::jsonb,
    impuestos jsonb DEFAULT '[]'::jsonb,
    invoice_number character varying(50),
    CONSTRAINT valid_cliente_cuit CHECK (((cliente_cuit IS NULL) OR ((cliente_cuit)::text ~ '^\d{2}-\d{8}-\d{1}$'::text)))
);


--
-- Name: COLUMN siac_facturas.punto_venta; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.punto_venta IS 'Punto de venta AFIP (1-9999)';


--
-- Name: COLUMN siac_facturas.tipo_comprobante_afip; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.tipo_comprobante_afip IS 'Cdigo AFIP: 1=Fact A, 6=Fact B, 11=Fact C';


--
-- Name: COLUMN siac_facturas.numero_comprobante; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.numero_comprobante IS 'Nmero de comprobante AFIP (sin formato)';


--
-- Name: COLUMN siac_facturas.estado_afip; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.estado_afip IS 'PENDIENTE, APROBADO, RECHAZADO, ERROR';


--
-- Name: COLUMN siac_facturas.cliente_cuit; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.cliente_cuit IS 'CUIT del cliente (formato XX-XXXXXXXX-X)';


--
-- Name: COLUMN siac_facturas.concepto; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.concepto IS '1=Productos, 2=Servicios, 3=Productos y Servicios';


--
-- Name: COLUMN siac_facturas.moneda; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.moneda IS 'Cdigo de moneda: PES, DOL, EUR, etc.';


--
-- Name: COLUMN siac_facturas.items; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.items IS 'Array JSON con items de la factura';


--
-- Name: COLUMN siac_facturas.impuestos; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.siac_facturas.impuestos IS 'Array JSON con impuestos calculados (IVA, percepciones)';


--
-- Name: siac_facturas_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_facturas_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_facturas_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_facturas_id_seq OWNED BY public.siac_facturas.id;


--
-- Name: siac_facturas_impuestos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_facturas_impuestos (
    id integer NOT NULL,
    factura_id integer NOT NULL,
    codigo_impuesto character varying(20) NOT NULL,
    nombre_impuesto character varying(100) NOT NULL,
    tipo_impuesto character varying(50) DEFAULT 'IVA'::character varying,
    base_imponible numeric(12,2) DEFAULT 0 NOT NULL,
    alicuota_porcentaje numeric(8,2) DEFAULT 0 NOT NULL,
    importe_impuesto numeric(12,2) DEFAULT 0 NOT NULL,
    condicion_impuesto character varying(50),
    codigo_afip integer,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_facturas_impuestos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_facturas_impuestos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_facturas_impuestos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_facturas_impuestos_id_seq OWNED BY public.siac_facturas_impuestos.id;


--
-- Name: siac_facturas_items; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_facturas_items (
    id integer NOT NULL,
    factura_id integer NOT NULL,
    numero_item integer NOT NULL,
    producto_id integer,
    producto_codigo character varying(50) NOT NULL,
    producto_descripcion text NOT NULL,
    producto_unidad_medida character varying(20) DEFAULT 'UNI'::character varying,
    cantidad numeric(10,3) DEFAULT 1 NOT NULL,
    precio_unitario numeric(12,2) DEFAULT 0 NOT NULL,
    descuento_porcentaje numeric(5,2) DEFAULT 0,
    descuento_importe numeric(12,2) DEFAULT 0,
    subtotal numeric(12,2) DEFAULT 0 NOT NULL,
    subtotal_con_descuento numeric(12,2) DEFAULT 0 NOT NULL,
    alicuota_iva numeric(5,2) DEFAULT 21.00,
    importe_iva numeric(12,2) DEFAULT 0,
    otros_impuestos numeric(12,2) DEFAULT 0,
    total_item numeric(12,2) DEFAULT 0 NOT NULL,
    categoria_producto character varying(100),
    marca_producto character varying(100),
    codigo_barras character varying(50),
    notas text,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_facturas_items_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_facturas_items_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_facturas_items_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_facturas_items_id_seq OWNED BY public.siac_facturas_items.id;


--
-- Name: siac_facturas_pagos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_facturas_pagos (
    id integer NOT NULL,
    factura_id integer NOT NULL,
    forma_pago character varying(50) NOT NULL,
    descripcion_pago character varying(200),
    importe_pago numeric(12,2) DEFAULT 0 NOT NULL,
    numero_tarjeta character varying(20),
    tipo_tarjeta character varying(50),
    numero_cupon character varying(50),
    numero_lote character varying(20),
    codigo_autorizacion character varying(50),
    numero_cheque character varying(50),
    banco_cheque character varying(100),
    fecha_cheque date,
    fecha_vencimiento_cheque date,
    numero_operacion character varying(50),
    banco_origen character varying(100),
    genera_cuenta_corriente boolean DEFAULT false,
    estado_pago character varying(20) DEFAULT 'CONFIRMADO'::character varying,
    fecha_pago timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_facturas_pagos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_facturas_pagos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_facturas_pagos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_facturas_pagos_id_seq OWNED BY public.siac_facturas_pagos.id;


--
-- Name: siac_listas_precios; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_listas_precios (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_lista character varying(20) NOT NULL,
    nombre_lista character varying(100) NOT NULL,
    descripcion text,
    tipo_lista character varying(20) DEFAULT 'GENERAL'::character varying,
    factor_multiplicador numeric(8,4) DEFAULT 1.0000,
    redondeo character varying(20) DEFAULT 'CENTAVO'::character varying,
    fecha_vigencia_desde date DEFAULT CURRENT_DATE,
    fecha_vigencia_hasta date,
    aplica_automaticamente boolean DEFAULT false,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_listas_precios_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_listas_precios_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_listas_precios_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_listas_precios_id_seq OWNED BY public.siac_listas_precios.id;


--
-- Name: siac_modulos_empresa; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_modulos_empresa (
    id integer NOT NULL,
    company_id integer NOT NULL,
    modulo_codigo character varying(50) NOT NULL,
    modulo_nombre character varying(100) NOT NULL,
    modulo_descripcion text,
    activo boolean DEFAULT true,
    fecha_contratacion date DEFAULT CURRENT_DATE,
    fecha_vencimiento date,
    configuracion jsonb DEFAULT '{}'::jsonb,
    precio_mensual numeric(10,2) DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_modulos_empresa_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_modulos_empresa_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_modulos_empresa_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_modulos_empresa_id_seq OWNED BY public.siac_modulos_empresa.id;


--
-- Name: siac_numeracion_comprobantes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_numeracion_comprobantes (
    id integer NOT NULL,
    caja_id integer NOT NULL,
    tipo_comprobante_id integer NOT NULL,
    numero_actual integer DEFAULT 0,
    prefijo character varying(10) DEFAULT ''::character varying,
    sufijo character varying(10) DEFAULT ''::character varying,
    numero_desde integer DEFAULT 1,
    numero_hasta integer DEFAULT 999999999,
    fecha_autorizacion date,
    fecha_vencimiento_autorizacion date,
    activo boolean DEFAULT true,
    requiere_cae boolean DEFAULT false,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_numeracion_comprobantes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_numeracion_comprobantes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_numeracion_comprobantes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_numeracion_comprobantes_id_seq OWNED BY public.siac_numeracion_comprobantes.id;


--
-- Name: siac_numeracion_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_numeracion_log (
    id integer NOT NULL,
    company_id integer NOT NULL,
    tipo_comprobante character varying(50) NOT NULL,
    numero_asignado integer NOT NULL,
    numero_anterior integer,
    session_id character varying(100),
    user_id integer,
    terminal_id character varying(50),
    timestamp_asignacion timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    ip_address inet,
    user_agent text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_numeracion_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_numeracion_log_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_numeracion_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_numeracion_log_id_seq OWNED BY public.siac_numeracion_log.id;


--
-- Name: siac_presupuestos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_presupuestos (
    id integer NOT NULL,
    company_id integer NOT NULL,
    numero_presupuesto character varying(50) NOT NULL,
    prefijo character varying(10),
    numero integer NOT NULL,
    cliente_id integer,
    cliente_codigo character varying(50),
    cliente_razon_social character varying(200) NOT NULL,
    cliente_documento_tipo character varying(10),
    cliente_documento_numero character varying(20),
    cliente_direccion text,
    cliente_telefono character varying(50),
    cliente_email character varying(100),
    cliente_condicion_iva character varying(50) DEFAULT 'CONSUMIDOR_FINAL'::character varying,
    fecha_emision date DEFAULT CURRENT_DATE NOT NULL,
    fecha_validez date,
    tipo_facturacion character varying(20) DEFAULT 'OCASIONAL'::character varying,
    frecuencia_facturacion character varying(20),
    fecha_inicio_facturacion date,
    fecha_fin_facturacion date,
    proximo_periodo_facturacion date,
    items jsonb DEFAULT '[]'::jsonb NOT NULL,
    subtotal numeric(12,2) DEFAULT 0,
    descuento_porcentaje numeric(5,2) DEFAULT 0,
    descuento_importe numeric(12,2) DEFAULT 0,
    total_impuestos numeric(12,2) DEFAULT 0,
    total_neto numeric(12,2) DEFAULT 0,
    total_presupuesto numeric(12,2) DEFAULT 0 NOT NULL,
    estado character varying(20) DEFAULT 'PENDIENTE'::character varying,
    fecha_aprobacion timestamp without time zone,
    aprobado_por character varying(255),
    cantidad_facturas_generadas integer DEFAULT 0,
    facturas_generadas jsonb DEFAULT '[]'::jsonb,
    contract_id uuid,
    observaciones text,
    notas_internas text,
    terminos_condiciones text,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer NOT NULL,
    updated_by integer,
    CONSTRAINT check_estado_presupuesto CHECK (((estado)::text = ANY ((ARRAY['PENDIENTE'::character varying, 'APROBADO'::character varying, 'RECHAZADO'::character varying, 'VENCIDO'::character varying, 'FACTURADO'::character varying, 'ACTIVO'::character varying, 'FINALIZADO'::character varying])::text[]))),
    CONSTRAINT check_frecuencia_facturacion CHECK (((frecuencia_facturacion IS NULL) OR ((frecuencia_facturacion)::text = ANY ((ARRAY['MONTHLY'::character varying, 'QUARTERLY'::character varying, 'YEARLY'::character varying])::text[])))),
    CONSTRAINT check_recurrente_tiene_frecuencia CHECK ((((tipo_facturacion)::text <> 'RECURRENTE'::text) OR (frecuencia_facturacion IS NOT NULL))),
    CONSTRAINT check_tipo_facturacion CHECK (((tipo_facturacion)::text = ANY ((ARRAY['OCASIONAL'::character varying, 'RECURRENTE'::character varying])::text[])))
);


--
-- Name: siac_presupuestos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_presupuestos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_presupuestos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_presupuestos_id_seq OWNED BY public.siac_presupuestos.id;


--
-- Name: siac_productos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_productos (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_producto character varying(50) NOT NULL,
    codigo_barras character varying(50),
    codigo_fabricante character varying(50),
    codigo_proveedor character varying(50),
    nombre_producto character varying(255) NOT NULL,
    descripcion_corta character varying(500),
    descripcion_larga text,
    categoria_id integer,
    marca_id integer,
    proveedor_principal_id integer,
    unidad_medida character varying(20) DEFAULT 'UNIDAD'::character varying,
    unidad_compra character varying(20) DEFAULT 'UNIDAD'::character varying,
    factor_conversion numeric(10,4) DEFAULT 1,
    precio_compra numeric(15,4) DEFAULT 0,
    precio_venta numeric(15,4) DEFAULT 0 NOT NULL,
    precio_lista numeric(15,4) DEFAULT 0,
    moneda character varying(3) DEFAULT 'ARS'::character varying,
    margen_porcentaje numeric(5,2) DEFAULT 0,
    margen_absoluto numeric(15,4) DEFAULT 0,
    precio_minimo numeric(15,4) DEFAULT 0,
    precio_sugerido numeric(15,4) DEFAULT 0,
    controla_stock boolean DEFAULT true,
    stock_actual numeric(15,4) DEFAULT 0,
    stock_minimo numeric(15,4) DEFAULT 0,
    stock_maximo numeric(15,4) DEFAULT 1000,
    punto_reposicion numeric(15,4) DEFAULT 10,
    peso numeric(10,4) DEFAULT 0,
    volumen numeric(10,4) DEFAULT 0,
    dimensiones jsonb DEFAULT '{}'::jsonb,
    aplica_iva boolean DEFAULT true,
    alicuota_iva numeric(5,2) DEFAULT 21.00,
    aplica_impuesto_interno boolean DEFAULT false,
    alicuota_impuesto_interno numeric(5,2) DEFAULT 0,
    permite_fraccionamiento boolean DEFAULT false,
    requiere_lote boolean DEFAULT false,
    requiere_vencimiento boolean DEFAULT false,
    dias_vida_util integer,
    es_servicio boolean DEFAULT false,
    es_combo boolean DEFAULT false,
    imagen_principal character varying(500),
    imagenes_adicionales jsonb DEFAULT '[]'::jsonb,
    ficha_tecnica_url character varying(500),
    slug character varying(255),
    keywords text,
    meta_description character varying(500),
    visible_web boolean DEFAULT false,
    destacado boolean DEFAULT false,
    atributos_especiales jsonb DEFAULT '{}'::jsonb,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    estado character varying(20) DEFAULT 'ACTIVO'::character varying,
    motivo_inactivacion text,
    fecha_alta date DEFAULT CURRENT_DATE,
    fecha_baja date,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_productos_categorias; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_productos_categorias (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_categoria character varying(20) NOT NULL,
    nombre_categoria character varying(100) NOT NULL,
    descripcion text,
    categoria_padre_id integer,
    nivel_jerarquia integer DEFAULT 1,
    orden_visualizacion integer DEFAULT 1,
    imagen_url character varying(500),
    configuracion_especial jsonb DEFAULT '{}'::jsonb,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_productos_categorias_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_productos_categorias_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_productos_categorias_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_productos_categorias_id_seq OWNED BY public.siac_productos_categorias.id;


--
-- Name: siac_productos_componentes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_productos_componentes (
    id integer NOT NULL,
    producto_padre_id integer NOT NULL,
    producto_componente_id integer NOT NULL,
    cantidad_componente numeric(10,4) DEFAULT 1 NOT NULL,
    precio_componente numeric(15,4),
    es_opcional boolean DEFAULT false,
    orden_visualizacion integer DEFAULT 1,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_productos_componentes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_productos_componentes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_productos_componentes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_productos_componentes_id_seq OWNED BY public.siac_productos_componentes.id;


--
-- Name: siac_productos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_productos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_productos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_productos_id_seq OWNED BY public.siac_productos.id;


--
-- Name: siac_productos_marcas; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_productos_marcas (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_marca character varying(20) NOT NULL,
    nombre_marca character varying(100) NOT NULL,
    descripcion text,
    logo_url character varying(500),
    sitio_web character varying(255),
    contacto_proveedor character varying(255),
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_productos_marcas_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_productos_marcas_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_productos_marcas_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_productos_marcas_id_seq OWNED BY public.siac_productos_marcas.id;


--
-- Name: siac_productos_precios; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_productos_precios (
    id integer NOT NULL,
    producto_id integer NOT NULL,
    lista_precios_id integer NOT NULL,
    precio_especial numeric(15,4) NOT NULL,
    precio_con_descuento numeric(15,4),
    descuento_porcentaje numeric(5,2) DEFAULT 0,
    fecha_vigencia_desde date DEFAULT CURRENT_DATE,
    fecha_vigencia_hasta date,
    cantidad_minima numeric(10,4) DEFAULT 1,
    activo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_productos_precios_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_productos_precios_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_productos_precios_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_productos_precios_id_seq OWNED BY public.siac_productos_precios.id;


--
-- Name: siac_puntos_venta; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_puntos_venta (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_punto_venta character varying(10) NOT NULL,
    nombre_punto_venta character varying(100) NOT NULL,
    direccion text,
    telefono character varying(50),
    email character varying(100),
    responsable_nombre character varying(100),
    responsable_documento character varying(20),
    cuit_empresa character varying(13) NOT NULL,
    razon_social_empresa character varying(200) NOT NULL,
    condicion_iva character varying(50) DEFAULT 'RESPONSABLE_INSCRIPTO'::character varying NOT NULL,
    punto_venta_afip integer,
    certificado_afip text,
    clave_fiscal text,
    permite_factura_a boolean DEFAULT true,
    permite_factura_b boolean DEFAULT true,
    permite_factura_c boolean DEFAULT true,
    permite_nota_credito boolean DEFAULT true,
    permite_nota_debito boolean DEFAULT true,
    permite_presupuestos boolean DEFAULT true,
    activo boolean DEFAULT true,
    predeterminado boolean DEFAULT false,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by integer,
    updated_by integer
);


--
-- Name: siac_puntos_venta_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_puntos_venta_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_puntos_venta_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_puntos_venta_id_seq OWNED BY public.siac_puntos_venta.id;


--
-- Name: siac_sesiones_caja; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_sesiones_caja (
    id integer NOT NULL,
    caja_id integer NOT NULL,
    fecha_apertura timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    fecha_cierre timestamp without time zone,
    usuario_apertura integer NOT NULL,
    usuario_cierre integer,
    monto_inicial_efectivo numeric(12,2) DEFAULT 0,
    monto_final_efectivo numeric(12,2) DEFAULT 0,
    diferencia_efectivo numeric(12,2) DEFAULT 0,
    total_ventas_efectivo numeric(12,2) DEFAULT 0,
    total_ventas_tarjetas numeric(12,2) DEFAULT 0,
    total_ventas_otros numeric(12,2) DEFAULT 0,
    total_ventas_sesion numeric(12,2) DEFAULT 0,
    cantidad_facturas integer DEFAULT 0,
    cantidad_notas_credito integer DEFAULT 0,
    cantidad_anulaciones integer DEFAULT 0,
    estado character varying(20) DEFAULT 'ABIERTA'::character varying,
    observaciones_apertura text,
    observaciones_cierre text,
    motivo_diferencia text,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_sesiones_caja_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_sesiones_caja_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_sesiones_caja_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_sesiones_caja_id_seq OWNED BY public.siac_sesiones_caja.id;


--
-- Name: siac_sesiones_locales; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_sesiones_locales (
    id integer NOT NULL,
    company_id integer NOT NULL,
    session_id character varying(100) NOT NULL,
    terminal_id character varying(50) NOT NULL,
    user_id integer NOT NULL,
    facturacion_temp jsonb DEFAULT '[]'::jsonb,
    recibos_temp jsonb DEFAULT '[]'::jsonb,
    ordenes_pago_temp jsonb DEFAULT '[]'::jsonb,
    otros_temp jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    locked_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    last_activity timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    configuracion_local jsonb DEFAULT '{}'::jsonb,
    ip_address inet,
    user_agent text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_sesiones_locales_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_sesiones_locales_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_sesiones_locales_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_sesiones_locales_id_seq OWNED BY public.siac_sesiones_locales.id;


--
-- Name: siac_stock_movimientos; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_stock_movimientos (
    id integer NOT NULL,
    company_id integer NOT NULL,
    producto_id integer NOT NULL,
    tipo_movimiento character varying(20) NOT NULL,
    cantidad numeric(15,4) NOT NULL,
    precio_unitario numeric(15,4) DEFAULT 0,
    stock_anterior numeric(15,4) NOT NULL,
    stock_resultante numeric(15,4) NOT NULL,
    factura_id integer,
    compra_id integer,
    ajuste_id integer,
    motivo character varying(100),
    observaciones text,
    lote character varying(50),
    fecha_vencimiento date,
    deposito character varying(50) DEFAULT 'PRINCIPAL'::character varying,
    ubicacion character varying(100),
    usuario_id integer,
    fecha_movimiento timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_stock_movimientos_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_stock_movimientos_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_stock_movimientos_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_stock_movimientos_id_seq OWNED BY public.siac_stock_movimientos.id;


--
-- Name: siac_tipos_comprobantes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_tipos_comprobantes (
    id integer NOT NULL,
    company_id integer NOT NULL,
    codigo_tipo character varying(10) NOT NULL,
    nombre_tipo character varying(100) NOT NULL,
    descripcion text,
    codigo_afip integer,
    letra_comprobante character(1),
    discrimina_iva boolean DEFAULT false,
    es_factura boolean DEFAULT true,
    es_nota_credito boolean DEFAULT false,
    es_nota_debito boolean DEFAULT false,
    es_presupuesto boolean DEFAULT false,
    afecta_stock boolean DEFAULT true,
    afecta_cuenta_corriente boolean DEFAULT true,
    requiere_autorizacion boolean DEFAULT false,
    permite_descuento boolean DEFAULT true,
    usa_numeracion_automatica boolean DEFAULT true,
    formato_numero character varying(50) DEFAULT '00000-00000000'::character varying,
    activo boolean DEFAULT true,
    predeterminado boolean DEFAULT false,
    configuracion_adicional jsonb DEFAULT '{}'::jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: siac_tipos_comprobantes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_tipos_comprobantes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_tipos_comprobantes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_tipos_comprobantes_id_seq OWNED BY public.siac_tipos_comprobantes.id;


--
-- Name: siac_transacciones_pendientes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.siac_transacciones_pendientes (
    id integer NOT NULL,
    company_id integer NOT NULL,
    session_id character varying(100) NOT NULL,
    tipo_operacion character varying(50) NOT NULL,
    estado character varying(20) DEFAULT 'INICIADA'::character varying,
    datos_operacion jsonb NOT NULL,
    numero_comprobante integer,
    iniciada_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    completada_at timestamp without time zone,
    error_message text,
    reintentos integer DEFAULT 0,
    metadata jsonb DEFAULT '{}'::jsonb
);


--
-- Name: siac_transacciones_pendientes_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.siac_transacciones_pendientes_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: siac_transacciones_pendientes_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.siac_transacciones_pendientes_id_seq OWNED BY public.siac_transacciones_pendientes.id;


--
-- Name: sla_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sla_metrics (
    id integer NOT NULL,
    approver_id character varying(100),
    approver_role character varying(50),
    department_id integer,
    request_type character varying(50),
    company_id integer NOT NULL,
    total_requests integer DEFAULT 0,
    avg_response_hours numeric(10,2),
    median_response_hours numeric(10,2),
    min_response_hours numeric(10,2),
    max_response_hours numeric(10,2),
    sla_target_hours integer,
    within_sla_count integer DEFAULT 0,
    outside_sla_count integer DEFAULT 0,
    sla_compliance_percent numeric(5,2),
    period_start date,
    period_end date
);


--
-- Name: TABLE sla_metrics; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sla_metrics IS 'Mtricas de tiempos de respuesta para rankings y cuellos de botella';


--
-- Name: sla_metrics_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sla_metrics_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sla_metrics_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sla_metrics_id_seq OWNED BY public.sla_metrics.id;


--
-- Name: sports_catalog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.sports_catalog (
    id integer NOT NULL,
    name character varying(100) NOT NULL,
    category character varying(50),
    is_extreme boolean DEFAULT false,
    risk_level character varying(20) DEFAULT 'low'::character varying,
    requires_medical_clearance boolean DEFAULT false,
    description text,
    is_active boolean DEFAULT true
);


--
-- Name: TABLE sports_catalog; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.sports_catalog IS 'Catlogo de deportes disponibles';


--
-- Name: sports_catalog_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.sports_catalog_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: sports_catalog_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.sports_catalog_id_seq OWNED BY public.sports_catalog.id;


--
-- Name: super_users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.super_users (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    username character varying(50) NOT NULL,
    password character varying(255) NOT NULL,
    full_name character varying(200) NOT NULL,
    email character varying(255) NOT NULL,
    permissions jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    last_login timestamp without time zone,
    CONSTRAINT super_users_password_length CHECK ((length((password)::text) >= 8)),
    CONSTRAINT super_users_username_format CHECK (((username)::text ~ '^[a-z0-9_-]+$'::text))
);


--
-- Name: support_activity_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_activity_log (
    log_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ticket_id uuid NOT NULL,
    support_user_id uuid NOT NULL,
    company_id integer NOT NULL,
    session_id uuid NOT NULL,
    session_started_at timestamp with time zone,
    session_ended_at timestamp with time zone,
    activity_type character varying(100) NOT NULL,
    module_name character varying(100),
    action_description text NOT NULL,
    affected_data jsonb,
    ip_address character varying(45),
    user_agent text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_activity_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_activity_log IS 'Log transparente de toda actividad de soporte en empresa cliente';


--
-- Name: COLUMN support_activity_log.session_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_activity_log.session_id IS 'ID de sesin temporal de acceso de soporte';


--
-- Name: COLUMN support_activity_log.affected_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_activity_log.affected_data IS 'Datos JSON con detalles de registros afectados';


--
-- Name: support_assistant_attempts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_assistant_attempts (
    attempt_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ticket_id uuid NOT NULL,
    assistant_type character varying(50) NOT NULL,
    user_question text NOT NULL,
    assistant_response text NOT NULL,
    confidence_score numeric(3,2),
    user_satisfied boolean,
    user_feedback text,
    attempted_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    responded_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_assistant_attempts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_assistant_attempts IS 'Log de intentos del asistente IA para resolver antes de escalar a soporte';


--
-- Name: COLUMN support_assistant_attempts.assistant_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_assistant_attempts.assistant_type IS 'fallback (sin IA) o ai_powered (con Ollama)';


--
-- Name: COLUMN support_assistant_attempts.user_satisfied; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_assistant_attempts.user_satisfied IS 'true=resolvi, false=escalar, null=sin responder';


--
-- Name: support_escalations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_escalations (
    escalation_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ticket_id uuid NOT NULL,
    escalated_from_user_id uuid,
    escalated_to_user_id uuid NOT NULL,
    escalation_reason character varying(100) NOT NULL,
    escalated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    resolved_at timestamp with time zone,
    escalation_notes text,
    resolution_notes text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_escalations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_escalations IS 'Log de todos los escalamientos de tickets a supervisores';


--
-- Name: COLUMN support_escalations.escalation_reason; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_escalations.escalation_reason IS 'Razn: sla_timeout, manual_escalation, no_response';


--
-- Name: support_sla_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_sla_config (
    id integer NOT NULL,
    priority character varying(20) NOT NULL,
    response_time_hours integer NOT NULL,
    resolution_time_hours integer NOT NULL,
    escalation_time_hours integer NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE support_sla_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_sla_config IS 'Configuracin de SLA por prioridad de ticket';


--
-- Name: support_sla_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.support_sla_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: support_sla_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.support_sla_config_id_seq OWNED BY public.support_sla_config.id;


--
-- Name: support_sla_plans; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_sla_plans (
    plan_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    plan_name character varying(100) NOT NULL,
    display_name character varying(200) NOT NULL,
    first_response_hours integer NOT NULL,
    resolution_hours integer NOT NULL,
    escalation_hours integer NOT NULL,
    price_monthly numeric(10,2) DEFAULT 0.00,
    has_ai_assistant boolean DEFAULT false,
    priority_level integer DEFAULT 3,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_sla_plans; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_sla_plans IS 'Planes de SLA contratables por las empresas';


--
-- Name: COLUMN support_sla_plans.first_response_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_sla_plans.first_response_hours IS 'Tiempo mximo para primera respuesta del soporte';


--
-- Name: COLUMN support_sla_plans.resolution_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_sla_plans.resolution_hours IS 'Tiempo mximo para resolver el ticket completamente';


--
-- Name: COLUMN support_sla_plans.escalation_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_sla_plans.escalation_hours IS 'Tiempo sin respuesta para escalar automticamente a supervisor';


--
-- Name: COLUMN support_sla_plans.has_ai_assistant; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_sla_plans.has_ai_assistant IS 'Si incluye asistente IA comercial (con Ollama) o solo fallback';


--
-- Name: support_ticket_escalations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_ticket_escalations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    ticket_id uuid NOT NULL,
    from_level integer NOT NULL,
    to_level integer NOT NULL,
    from_staff_id uuid,
    to_staff_id uuid,
    escalation_type character varying(20) NOT NULL,
    reason text,
    escalated_by uuid,
    created_at timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE support_ticket_escalations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_ticket_escalations IS 'Historial de escalamientos de tickets';


--
-- Name: support_ticket_messages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_ticket_messages (
    message_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ticket_id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_role character varying(50) NOT NULL,
    message text NOT NULL,
    attachments jsonb DEFAULT '[]'::jsonb,
    is_internal boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_ticket_messages; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_ticket_messages IS 'Mensajes/conversacin dentro de cada ticket';


--
-- Name: COLUMN support_ticket_messages.is_internal; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_ticket_messages.is_internal IS 'Notas internas visibles solo para soporte';


--
-- Name: support_tickets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_tickets (
    ticket_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    ticket_number character varying(50) NOT NULL,
    company_id integer NOT NULL,
    created_by_user_id uuid NOT NULL,
    module_name character varying(100) NOT NULL,
    module_display_name character varying(200),
    subject character varying(500) NOT NULL,
    description text NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying,
    allow_support_access boolean DEFAULT false,
    temp_support_user_id uuid,
    temp_password_hash character varying(255),
    temp_password_expires_at timestamp with time zone,
    temp_access_granted_at timestamp with time zone,
    assigned_to_vendor_id uuid,
    assigned_at timestamp with time zone,
    status character varying(50) DEFAULT 'open'::character varying,
    closed_by_user_id uuid,
    closed_at timestamp with time zone,
    close_reason text,
    rating integer,
    rating_comment text,
    rated_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    sla_first_response_deadline timestamp with time zone,
    sla_resolution_deadline timestamp with time zone,
    sla_escalation_deadline timestamp with time zone,
    first_response_at timestamp with time zone,
    escalated_to_supervisor_id uuid,
    assistant_attempted boolean DEFAULT false,
    assistant_resolved boolean DEFAULT false,
    thread_id uuid,
    notification_id uuid,
    feedback text,
    escalation_level integer DEFAULT 1,
    assigned_staff_id uuid,
    escalated_at timestamp with time zone,
    escalation_reason text,
    sla_breach_at timestamp with time zone,
    CONSTRAINT support_tickets_priority_check CHECK (((priority)::text = ANY ((ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying])::text[]))),
    CONSTRAINT support_tickets_rating_check CHECK (((rating >= 1) AND (rating <= 5))),
    CONSTRAINT support_tickets_status_check CHECK (((status)::text = ANY ((ARRAY['open'::character varying, 'in_progress'::character varying, 'waiting_customer'::character varying, 'resolved'::character varying, 'closed'::character varying])::text[])))
);


--
-- Name: TABLE support_tickets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_tickets IS 'Tickets de soporte tcnico multi-tenant';


--
-- Name: COLUMN support_tickets.ticket_number; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.ticket_number IS 'Nmero de ticket auto-generado nico globalmente';


--
-- Name: COLUMN support_tickets.allow_support_access; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.allow_support_access IS 'Cliente autoriza acceso temporal a soporte';


--
-- Name: COLUMN support_tickets.temp_support_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.temp_support_user_id IS 'Usuario temporal creado para que soporte ingrese';


--
-- Name: COLUMN support_tickets.assigned_to_vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.assigned_to_vendor_id IS 'Vendedor/tcnico asignado para dar soporte';


--
-- Name: COLUMN support_tickets.sla_first_response_deadline; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.sla_first_response_deadline IS 'Deadline para primera respuesta segn SLA';


--
-- Name: COLUMN support_tickets.sla_resolution_deadline; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.sla_resolution_deadline IS 'Deadline para resolucin completa segn SLA';


--
-- Name: COLUMN support_tickets.sla_escalation_deadline; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.sla_escalation_deadline IS 'Deadline para escalar automticamente si no hay respuesta';


--
-- Name: COLUMN support_tickets.assistant_attempted; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.assistant_attempted IS 'Si el asistente IA intent resolver el ticket';


--
-- Name: COLUMN support_tickets.assistant_resolved; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.assistant_resolved IS 'Si el asistente IA logr resolver sin escalar';


--
-- Name: COLUMN support_tickets.escalation_level; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_tickets.escalation_level IS '1=Soporte asignado, 2=Coordinador, 3=Direccin';


--
-- Name: support_vendor_stats; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_vendor_stats (
    stat_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    vendor_id uuid NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    total_tickets integer DEFAULT 0,
    tickets_resolved integer DEFAULT 0,
    tickets_closed integer DEFAULT 0,
    avg_resolution_time_hours numeric(10,2),
    avg_rating numeric(3,2),
    calculated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_vendor_stats; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_vendor_stats IS 'Estadsticas agregadas de performance de soporte por vendedor';


--
-- Name: support_vendor_supervisors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.support_vendor_supervisors (
    assignment_id uuid DEFAULT public.uuid_generate_v4() NOT NULL,
    vendor_id uuid NOT NULL,
    supervisor_id uuid NOT NULL,
    assigned_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    assigned_by_user_id uuid,
    is_active boolean DEFAULT true,
    notes text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE support_vendor_supervisors; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.support_vendor_supervisors IS 'Jerarqua de supervisores asignados a cada vendedor';


--
-- Name: COLUMN support_vendor_supervisors.supervisor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.support_vendor_supervisors.supervisor_id IS 'Supervisor que recibe tickets escalados del vendedor';


--
-- Name: suspension_blocks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.suspension_blocks (
    id integer NOT NULL,
    sanction_id integer,
    employee_id uuid,
    company_id integer,
    start_date date NOT NULL,
    end_date date NOT NULL,
    total_work_days integer NOT NULL,
    days_served integer DEFAULT 0,
    is_active boolean DEFAULT true,
    block_type character varying(50) DEFAULT 'full'::character varying,
    blocked_actions jsonb DEFAULT '["checkin", "checkout"]'::jsonb,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    deactivated_at timestamp without time zone,
    deactivated_by uuid
);


--
-- Name: TABLE suspension_blocks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.suspension_blocks IS 'Bloqueos activos de fichaje por suspensin disciplinaria';


--
-- Name: COLUMN suspension_blocks.total_work_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.suspension_blocks.total_work_days IS 'Das laborables de suspensin (excluye fines de semana segn turno)';


--
-- Name: COLUMN suspension_blocks.days_served; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.suspension_blocks.days_served IS 'Das de suspensin ya cumplidos';


--
-- Name: suspension_blocks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.suspension_blocks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: suspension_blocks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.suspension_blocks_id_seq OWNED BY public.suspension_blocks.id;


--
-- Name: system_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_config (
    id uuid NOT NULL,
    "connectionMode" public."enum_system_config_connectionMode" DEFAULT 'local'::public."enum_system_config_connectionMode",
    "toleranceMinutesEntry" integer DEFAULT 10,
    "toleranceMinutesExit" integer DEFAULT 15,
    "maxOvertimeHours" numeric(4,2) DEFAULT 3,
    "gpsRadius" integer DEFAULT 50,
    "requireAdminApproval" boolean DEFAULT true,
    "sendNotifications" boolean DEFAULT true,
    "autoBackup" boolean DEFAULT true,
    "backupHour" integer DEFAULT 2,
    "maxLoginAttempts" integer DEFAULT 5,
    "lockoutDuration" integer DEFAULT 30,
    "sessionTimeout" integer DEFAULT 24,
    "companyName" character varying(255) DEFAULT 'Mi Empresa'::character varying,
    "companyLogo" character varying(255),
    timezone character varying(255) DEFAULT 'America/Argentina/Buenos_Aires'::character varying,
    locale character varying(255) DEFAULT 'es-AR'::character varying,
    currency character varying(255) DEFAULT 'ARS'::character varying,
    "emailSettings" json DEFAULT '{}'::json,
    "smsSettings" json DEFAULT '{}'::json,
    "whatsappSettings" json DEFAULT '{}'::json,
    "biometricSettings" json DEFAULT '{"fingerprintEnabled":true,"faceRecognitionEnabled":true,"maxFingerprints":5,"readerType":"zkteco"}'::json,
    "createdAt" timestamp with time zone NOT NULL,
    "updatedAt" timestamp with time zone NOT NULL
);


--
-- Name: system_consciousness_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_consciousness_log (
    log_id bigint NOT NULL,
    event_type character varying(50) NOT NULL,
    module_key character varying(100),
    company_id integer,
    event_data jsonb,
    result character varying(20) NOT NULL,
    message text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE system_consciousness_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.system_consciousness_log IS 'Log de eventos del sistema de auto-conciencia';


--
-- Name: COLUMN system_consciousness_log.event_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_consciousness_log.event_type IS 'Tipo de evento: module_loaded, limit_checked, dependency_validated, config_changed';


--
-- Name: system_consciousness_log_log_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.system_consciousness_log_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: system_consciousness_log_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.system_consciousness_log_log_id_seq OWNED BY public.system_consciousness_log.log_id;


--
-- Name: system_metadata; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_metadata (
    metadata_id integer NOT NULL,
    metadata_key character varying(100) NOT NULL,
    metadata_value jsonb NOT NULL,
    metadata_type character varying(50) NOT NULL,
    description text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE system_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.system_metadata IS 'Metadatos del sistema para auto-conciencia y configuracin dinmica';


--
-- Name: COLUMN system_metadata.metadata_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_metadata.metadata_key IS 'Clave nica del metadato (e.g. system_version, max_employees_basic)';


--
-- Name: COLUMN system_metadata.metadata_value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_metadata.metadata_value IS 'Valor en formato JSON para flexibilidad';


--
-- Name: COLUMN system_metadata.metadata_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_metadata.metadata_type IS 'Tipo de metadato: config, limit, feature_flag, module_info';


--
-- Name: system_metadata_metadata_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.system_metadata_metadata_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: system_metadata_metadata_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.system_metadata_metadata_id_seq OWNED BY public.system_metadata.metadata_id;


--
-- Name: system_modules; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_modules (
    id uuid NOT NULL,
    module_key character varying(50) NOT NULL,
    name character varying(100) NOT NULL,
    description text,
    icon character varying(50),
    color character varying(7),
    category public.enum_system_modules_category DEFAULT 'core'::public.enum_system_modules_category NOT NULL,
    base_price numeric(10,2) DEFAULT 0 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_core boolean DEFAULT false NOT NULL,
    display_order integer DEFAULT 0 NOT NULL,
    features jsonb DEFAULT '[]'::jsonb,
    requirements jsonb DEFAULT '[]'::jsonb,
    version character varying(20) DEFAULT '1.0.0'::character varying NOT NULL,
    min_employees integer,
    max_employees integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    rubro character varying(100) DEFAULT 'General'::character varying,
    bundled_modules jsonb DEFAULT '[]'::jsonb,
    available_in character varying(20) DEFAULT 'both'::character varying,
    provides_to jsonb DEFAULT '[]'::jsonb,
    integrates_with jsonb DEFAULT '[]'::jsonb,
    metadata jsonb DEFAULT '{}'::jsonb,
    ui_metadata jsonb DEFAULT '{"tabs": [], "inputs": [], "modals": [], "mainButtons": []}'::jsonb
);


--
-- Name: TABLE system_modules; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.system_modules IS 'Catlogo de mdulos del sistema - Core y premium';


--
-- Name: COLUMN system_modules.module_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.module_key IS 'Identificador nico del mdulo (ej: users, attendance, biometric)';


--
-- Name: COLUMN system_modules.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.name IS 'Nombre descriptivo del mdulo';


--
-- Name: COLUMN system_modules.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.description IS 'Descripcin detallada del mdulo';


--
-- Name: COLUMN system_modules.icon; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.icon IS 'Emoji o icono representativo del mdulo';


--
-- Name: COLUMN system_modules.color; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.color IS 'Color hexadecimal del mdulo para UI';


--
-- Name: COLUMN system_modules.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.category IS 'Categora del mdulo';


--
-- Name: COLUMN system_modules.base_price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.base_price IS 'Precio base por empleado/mes en USD';


--
-- Name: COLUMN system_modules.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.is_active IS 'Indica si el mdulo est disponible para contratacin';


--
-- Name: COLUMN system_modules.is_core; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.is_core IS 'Indica si es un mdulo core obligatorio';


--
-- Name: COLUMN system_modules.display_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.display_order IS 'Orden de visualizacin en interfaces';


--
-- Name: COLUMN system_modules.features; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.features IS 'Lista de caractersticas que incluye el mdulo';


--
-- Name: COLUMN system_modules.requirements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.requirements IS 'Lista de mdulos requeridos para funcionar';


--
-- Name: COLUMN system_modules.version; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.version IS 'Versin del mdulo';


--
-- Name: COLUMN system_modules.min_employees; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.min_employees IS 'Nmero mnimo de empleados para contratar este mdulo';


--
-- Name: COLUMN system_modules.max_employees; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.max_employees IS 'Nmero mximo de empleados para este mdulo';


--
-- Name: COLUMN system_modules.ui_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules.ui_metadata IS 'UI metadata discovered by Phase4 Auto-Healing (buttons, tabs, inputs, modals)';


--
-- Name: system_modules_registry; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_modules_registry (
    registry_id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    module_name character varying(255) NOT NULL,
    module_category character varying(50) NOT NULL,
    pricing numeric(10,2) DEFAULT 0.00,
    dependencies jsonb DEFAULT '[]'::jsonb,
    optional_dependencies jsonb DEFAULT '[]'::jsonb,
    provides_to jsonb DEFAULT '[]'::jsonb,
    integrates_with jsonb DEFAULT '[]'::jsonb,
    limits jsonb DEFAULT '{}'::jsonb,
    features jsonb DEFAULT '[]'::jsonb,
    description text,
    icon character varying(50),
    version character varying(20) DEFAULT '1.0.0'::character varying,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: TABLE system_modules_registry; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.system_modules_registry IS 'Registry centralizado de mdulos con dependencias y lmites';


--
-- Name: COLUMN system_modules_registry.module_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules_registry.module_key IS 'Identificador nico del mdulo (e.g. users, attendance)';


--
-- Name: COLUMN system_modules_registry.dependencies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules_registry.dependencies IS 'Array JSON de mdulos requeridos para funcionar';


--
-- Name: COLUMN system_modules_registry.provides_to; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_modules_registry.provides_to IS 'Array JSON de mdulos que dependen de este';


--
-- Name: system_modules_registry_registry_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.system_modules_registry_registry_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: system_modules_registry_registry_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.system_modules_registry_registry_id_seq OWNED BY public.system_modules_registry.registry_id;


--
-- Name: task_compatibility; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.task_compatibility (
    id integer NOT NULL,
    company_id integer NOT NULL,
    primary_user_id uuid NOT NULL,
    cover_user_id uuid NOT NULL,
    compatibility_score numeric(5,2) DEFAULT 0,
    coverable_tasks jsonb DEFAULT '[]'::jsonb,
    max_coverage_hours integer,
    max_concurrent_tasks integer DEFAULT 3,
    last_performance_score numeric(5,2),
    total_coverage_hours integer DEFAULT 0,
    successful_coverages integer DEFAULT 0,
    is_auto_calculated boolean DEFAULT false,
    last_calculation_date date,
    calculation_data jsonb,
    is_active boolean DEFAULT true,
    manual_notes text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE task_compatibility; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.task_compatibility IS 'Matriz de compatibilidad para cobertura de tareas durante ausencias';


--
-- Name: COLUMN task_compatibility.compatibility_score; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.task_compatibility.compatibility_score IS 'Puntuacin de compatibilidad (0-100)';


--
-- Name: COLUMN task_compatibility.coverable_tasks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.task_compatibility.coverable_tasks IS 'Array JSON de tareas que puede cubrir con nivel de competencia';


--
-- Name: task_compatibility_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.task_compatibility_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: task_compatibility_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.task_compatibility_id_seq OWNED BY public.task_compatibility.id;


--
-- Name: tax_concepts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tax_concepts (
    id integer NOT NULL,
    tax_template_id integer NOT NULL,
    concept_code character varying(20) NOT NULL,
    concept_name character varying(100) NOT NULL,
    description text,
    calculation_order integer DEFAULT 1 NOT NULL,
    base_amount character varying(20) DEFAULT 'neto_final'::character varying NOT NULL,
    concept_type character varying(20) DEFAULT 'tax'::character varying NOT NULL,
    is_percentage boolean DEFAULT true,
    is_compound boolean DEFAULT false,
    affects_total boolean DEFAULT true,
    is_mandatory boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT tax_concepts_calculation_order_check CHECK ((calculation_order > 0))
);


--
-- Name: tax_concepts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.tax_concepts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: tax_concepts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.tax_concepts_id_seq OWNED BY public.tax_concepts.id;


--
-- Name: tax_conditions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tax_conditions (
    id integer NOT NULL,
    tax_template_id integer NOT NULL,
    condition_code character varying(20) NOT NULL,
    condition_name character varying(100) NOT NULL,
    description text,
    display_order integer DEFAULT 1,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: tax_conditions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.tax_conditions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: tax_conditions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.tax_conditions_id_seq OWNED BY public.tax_conditions.id;


--
-- Name: tax_rates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tax_rates (
    id integer NOT NULL,
    tax_concept_id integer NOT NULL,
    rate_code character varying(20) NOT NULL,
    rate_name character varying(100) NOT NULL,
    rate_percentage numeric(8,4) NOT NULL,
    minimum_amount numeric(15,4) DEFAULT 0,
    maximum_amount numeric(15,4),
    is_default boolean DEFAULT false,
    applicable_conditions jsonb,
    date_from date,
    date_to date,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT tax_rates_minimum_amount_check CHECK ((minimum_amount >= (0)::numeric)),
    CONSTRAINT tax_rates_rate_percentage_check CHECK ((rate_percentage >= (0)::numeric))
);


--
-- Name: tax_rates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.tax_rates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: tax_rates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.tax_rates_id_seq OWNED BY public.tax_rates.id;


--
-- Name: tax_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tax_templates (
    id integer NOT NULL,
    country character varying(50) NOT NULL,
    country_code character varying(3) NOT NULL,
    template_name character varying(100) NOT NULL,
    tax_id_format character varying(50),
    tax_id_field_name character varying(50) DEFAULT 'CUIT'::character varying,
    tax_id_validation_regex character varying(200),
    remove_separators boolean DEFAULT true,
    currencies jsonb DEFAULT '["ARS"]'::jsonb,
    default_currency character varying(3) DEFAULT 'ARS'::character varying,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    tax_id_field_description character varying(200),
    tax_id_format_mask character varying(50),
    tax_id_min_length integer DEFAULT 8,
    tax_id_max_length integer DEFAULT 15,
    tax_id_required_for_invoicing boolean DEFAULT true
);


--
-- Name: COLUMN tax_templates.tax_id_field_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tax_templates.tax_id_field_name IS 'Nombre del campo de identificacin fiscal segn pas (CUIT, RUT, RUC, RFC, CNPJ, NIT)';


--
-- Name: COLUMN tax_templates.tax_id_validation_regex; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tax_templates.tax_id_validation_regex IS 'Expresin regular para validar el formato';


--
-- Name: COLUMN tax_templates.tax_id_field_description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tax_templates.tax_id_field_description IS 'Descripcin completa del campo fiscal';


--
-- Name: COLUMN tax_templates.tax_id_format_mask; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tax_templates.tax_id_format_mask IS 'Mscara de formato (ej: XX-XXXXXXXX-X)';


--
-- Name: COLUMN tax_templates.tax_id_required_for_invoicing; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tax_templates.tax_id_required_for_invoicing IS 'Si es obligatorio para facturacin';


--
-- Name: tax_templates_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.tax_templates_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: tax_templates_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.tax_templates_id_seq OWNED BY public.tax_templates.id;


--
-- Name: test_executions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.test_executions (
    id integer NOT NULL,
    execution_id uuid NOT NULL,
    environment character varying(20) NOT NULL,
    module character varying(100) NOT NULL,
    company_id integer,
    company_name character varying(255),
    cycles integer DEFAULT 1 NOT NULL,
    slow_mo integer DEFAULT 50 NOT NULL,
    base_url character varying(500),
    status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    total_tests integer DEFAULT 0,
    ui_tests_passed integer DEFAULT 0,
    ui_tests_failed integer DEFAULT 0,
    db_tests_passed integer DEFAULT 0,
    db_tests_failed integer DEFAULT 0,
    success_rate numeric(5,2),
    start_time timestamp with time zone DEFAULT now() NOT NULL,
    end_time timestamp with time zone,
    duration_seconds numeric(10,2),
    errors jsonb DEFAULT '[]'::jsonb,
    tickets jsonb DEFAULT '[]'::jsonb,
    logs jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT test_executions_environment_check CHECK (((environment)::text = ANY ((ARRAY['local'::character varying, 'staging'::character varying, 'production'::character varying])::text[]))),
    CONSTRAINT test_executions_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'starting'::character varying, 'running'::character varying, 'completed'::character varying, 'failed'::character varying, 'killed'::character varying, 'error'::character varying])::text[])))
);


--
-- Name: TABLE test_executions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.test_executions IS 'Registro de ejecuciones de tests E2E automatizados';


--
-- Name: COLUMN test_executions.execution_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.test_executions.execution_id IS 'UUID nico de la ejecucin';


--
-- Name: COLUMN test_executions.success_rate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.test_executions.success_rate IS 'Porcentaje de tests exitosos (calculado automticamente)';


--
-- Name: COLUMN test_executions.logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.test_executions.logs IS 'Array de logs en formato JSON';


--
-- Name: test_executions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.test_executions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: test_executions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.test_executions_id_seq OWNED BY public.test_executions.id;


--
-- Name: test_results; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.test_results (
    id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    test_timestamp timestamp with time zone DEFAULT now() NOT NULL,
    total_tests integer DEFAULT 0,
    passed integer DEFAULT 0,
    failed integer DEFAULT 0,
    coverage integer DEFAULT 0,
    duration_ms integer DEFAULT 0,
    results_json jsonb DEFAULT '{}'::jsonb,
    discoveries_json jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: test_results_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.test_results_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: test_results_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.test_results_id_seq OWNED BY public.test_results.id;


--
-- Name: testing_tickets; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.testing_tickets (
    id integer NOT NULL,
    ticket_number character varying(20) NOT NULL,
    status character varying(50) DEFAULT 'PENDING_REPAIR'::character varying NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying NOT NULL,
    module_name character varying(100) NOT NULL,
    error_type character varying(100),
    error_message text NOT NULL,
    error_stack text,
    error_details jsonb,
    file_path character varying(500),
    line_number integer,
    function_name character varying(255),
    test_name character varying(255),
    test_type character varying(50),
    test_context jsonb,
    created_by character varying(100) DEFAULT 'ollama-auditor'::character varying NOT NULL,
    assigned_to character varying(100) DEFAULT 'claude-code'::character varying,
    fix_attempted boolean DEFAULT false,
    fix_strategy character varying(255),
    fix_description text,
    fix_files_modified jsonb,
    fix_applied_at timestamp with time zone,
    fix_applied_by character varying(100),
    retest_count integer DEFAULT 0,
    retest_passed boolean,
    retest_last_at timestamp with time zone,
    retest_details jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    closed_at timestamp with time zone,
    time_to_fix_minutes integer,
    time_to_close_minutes integer,
    last_message text,
    conversation_log jsonb DEFAULT '[]'::jsonb
);


--
-- Name: TABLE testing_tickets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.testing_tickets IS 'Sistema de tickets para ciclo autnomo Ollama  Claude Code';


--
-- Name: COLUMN testing_tickets.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.testing_tickets.status IS 'Estado del ticket: PENDING_REPAIR, IN_REPAIR, FIXED, RETESTING, CLOSED, REOPENED, BLOCKED';


--
-- Name: COLUMN testing_tickets.priority; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.testing_tickets.priority IS 'Prioridad del ticket: critical, high, medium, low';


--
-- Name: COLUMN testing_tickets.conversation_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.testing_tickets.conversation_log IS 'Historial de mensajes entre Ollama y Claude Code';


--
-- Name: testing_tickets_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.testing_tickets_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: testing_tickets_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.testing_tickets_id_seq OWNED BY public.testing_tickets.id;


--
-- Name: training_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.training_assignments (
    id integer NOT NULL,
    company_id integer NOT NULL,
    training_id integer NOT NULL,
    user_id uuid NOT NULL,
    status character varying(50) DEFAULT 'pending'::character varying,
    progress_percentage integer DEFAULT 0,
    time_spent_minutes integer DEFAULT 0,
    assigned_at timestamp with time zone DEFAULT now(),
    started_at timestamp with time zone,
    completed_at timestamp with time zone,
    due_date date,
    score numeric(5,2),
    certificate_url character varying(500),
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT training_assignments_progress_percentage_check CHECK (((progress_percentage >= 0) AND (progress_percentage <= 100))),
    CONSTRAINT training_assignments_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'expired'::character varying, 'cancelled'::character varying])::text[])))
);


--
-- Name: training_assignments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.training_assignments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: training_assignments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.training_assignments_id_seq OWNED BY public.training_assignments.id;


--
-- Name: trainings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.trainings (
    id integer NOT NULL,
    company_id integer NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    category character varying(100),
    duration integer DEFAULT 60,
    is_mandatory boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    type character varying(50),
    content_url text,
    start_date date,
    deadline date,
    instructor character varying(255),
    max_score integer DEFAULT 100,
    min_score integer DEFAULT 70,
    attempts integer DEFAULT 2,
    mandatory boolean DEFAULT false,
    certificate boolean DEFAULT false,
    status character varying(20) DEFAULT 'active'::character varying,
    participants integer DEFAULT 0,
    completed integer DEFAULT 0,
    progress integer DEFAULT 0
);


--
-- Name: trainings_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.trainings_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: trainings_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.trainings_id_seq OWNED BY public.trainings.id;


--
-- Name: unauthorized_access_attempts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.unauthorized_access_attempts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    kiosk_id integer,
    employee_id uuid,
    company_id integer NOT NULL,
    employee_name character varying(255),
    employee_department character varying(100),
    kiosk_authorized_departments jsonb,
    attempt_type character varying(50),
    biometric_similarity numeric,
    security_photo bytea,
    "timestamp" timestamp without time zone DEFAULT now(),
    device_id character varying(255),
    ip_address character varying(50),
    reason character varying(255),
    requires_hr_review boolean DEFAULT true,
    reviewed_by uuid,
    reviewed_at timestamp without time zone,
    review_notes text,
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: unified_help_interactions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.unified_help_interactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    interaction_type character varying(20) NOT NULL,
    question text,
    answer text,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    CONSTRAINT unified_help_interactions_interaction_type_check CHECK (((interaction_type)::text = ANY ((ARRAY['chat'::character varying, 'ticket_created'::character varying, 'ticket_reply'::character varying, 'walkthrough'::character varying, 'feedback'::character varying])::text[])))
);


--
-- Name: TABLE unified_help_interactions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.unified_help_interactions IS 'Registro unificado de todas las interacciones del centro de ayuda';


--
-- Name: unified_help_stats; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.unified_help_stats AS
 SELECT company_id,
    count(*) FILTER (WHERE ((interaction_type)::text = 'chat'::text)) AS chat_count,
    count(*) FILTER (WHERE ((interaction_type)::text = 'ticket_created'::text)) AS tickets_created,
    count(*) FILTER (WHERE (((interaction_type)::text = 'feedback'::text) AND (((metadata ->> 'isHelpful'::text))::boolean = true))) AS positive_feedback,
    count(*) FILTER (WHERE (((interaction_type)::text = 'feedback'::text) AND (((metadata ->> 'isHelpful'::text))::boolean = false))) AS negative_feedback,
    date_trunc('day'::text, created_at) AS day
   FROM public.unified_help_interactions
  GROUP BY company_id, (date_trunc('day'::text, created_at));


--
-- Name: unified_notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.unified_notifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id integer,
    thread_id uuid,
    parent_id uuid,
    sequence_in_thread integer DEFAULT 1,
    origin_type character varying(50) NOT NULL,
    origin_id character varying(100),
    origin_name character varying(255),
    origin_role character varying(50),
    recipient_type character varying(50) NOT NULL,
    recipient_id character varying(100),
    recipient_name character varying(255),
    recipient_role character varying(50),
    recipient_department_id integer,
    recipient_hierarchy_level integer DEFAULT 0,
    category character varying(50) DEFAULT 'general'::character varying NOT NULL,
    module character varying(50),
    notification_type character varying(100),
    priority character varying(20) DEFAULT 'medium'::character varying,
    title character varying(255) NOT NULL,
    message text NOT NULL,
    short_message character varying(280),
    metadata jsonb DEFAULT '{}'::jsonb,
    related_entity_type character varying(50),
    related_entity_id character varying(100),
    is_read boolean DEFAULT false,
    read_at timestamp without time zone,
    read_by uuid,
    requires_action boolean DEFAULT false,
    action_type character varying(50),
    action_options jsonb DEFAULT '[]'::jsonb,
    action_status character varying(50) DEFAULT 'pending'::character varying,
    action_deadline timestamp without time zone,
    action_taken_at timestamp without time zone,
    action_taken_by uuid,
    action_response text,
    action_notes text,
    workflow_id integer,
    workflow_step integer DEFAULT 0,
    workflow_status character varying(50),
    sla_hours integer,
    sla_deadline timestamp without time zone,
    sla_breached boolean DEFAULT false,
    sla_breach_at timestamp without time zone,
    escalation_level integer DEFAULT 0,
    escalated_from_id uuid,
    escalated_to_id uuid,
    escalation_reason text,
    channels jsonb DEFAULT '["app"]'::jsonb,
    sent_via_app boolean DEFAULT true,
    sent_via_email boolean DEFAULT false,
    sent_via_push boolean DEFAULT false,
    email_sent_at timestamp without time zone,
    push_sent_at timestamp without time zone,
    ai_analyzed boolean DEFAULT false,
    ai_analyzed_at timestamp without time zone,
    ai_suggested_response text,
    ai_confidence numeric(5,4),
    ai_auto_responded boolean DEFAULT false,
    ai_topic character varying(100),
    ai_sentiment character varying(20),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    created_by uuid,
    expires_at timestamp without time zone,
    deleted_at timestamp without time zone,
    deleted_by uuid,
    direction character varying(20) DEFAULT 'internal'::character varying,
    external_email character varying(255),
    external_name character varying(255),
    trace_id character varying(100),
    vendor_id uuid,
    aponnt_department character varying(50),
    is_commercial boolean DEFAULT false,
    response_required_by timestamp without time zone
);


--
-- Name: TABLE unified_notifications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.unified_notifications IS 'Sistema unificado de notificaciones v3.0 - Usado por Admin, Empresa y APKs';


--
-- Name: COLUMN unified_notifications.direction; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.direction IS 'Direccin: internal (dentro de empresa), inbound (de APONNT a empresa), outbound (de empresa a APONNT)';


--
-- Name: COLUMN unified_notifications.external_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.external_email IS 'Email externo para notificaciones a no-usuarios (ej: contacto de empresa prospect)';


--
-- Name: COLUMN unified_notifications.external_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.external_name IS 'Nombre del contacto externo';


--
-- Name: COLUMN unified_notifications.trace_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.trace_id IS 'ID de rastreo para vincular con workflows (ej: ONBOARDING-uuid)';


--
-- Name: COLUMN unified_notifications.vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.vendor_id IS 'ID del vendedor APONNT relacionado (para comisiones y seguimiento)';


--
-- Name: COLUMN unified_notifications.aponnt_department; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.aponnt_department IS 'Departamento APONNT: sales, support, billing, legal, management';


--
-- Name: COLUMN unified_notifications.is_commercial; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.is_commercial IS 'True si es parte del flujo comercial APONNT  Empresa';


--
-- Name: COLUMN unified_notifications.response_required_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.unified_notifications.response_required_by IS 'Fecha lmite para respuesta en flujo comercial';


--
-- Name: used_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.used_tokens (
    id integer NOT NULL,
    token character varying(500) NOT NULL,
    message_id uuid,
    used_at timestamp without time zone DEFAULT now(),
    used_by character varying(100)
);


--
-- Name: used_tokens_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.used_tokens_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: used_tokens_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.used_tokens_id_seq OWNED BY public.used_tokens.id;


--
-- Name: user_activity_restrictions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_activity_restrictions (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    restriction_type character varying(100) NOT NULL,
    description text NOT NULL,
    start_date date NOT NULL,
    end_date date,
    is_permanent boolean DEFAULT false,
    medical_certificate_url text,
    issuing_doctor character varying(255),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_activity_restrictions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_activity_restrictions IS 'Restricciones de actividad fsica';


--
-- Name: user_activity_restrictions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_activity_restrictions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_activity_restrictions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_activity_restrictions_id_seq OWNED BY public.user_activity_restrictions.id;


--
-- Name: user_allergies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_allergies (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    allergen character varying(255) NOT NULL,
    allergy_type character varying(50),
    severity character varying(50),
    symptoms text,
    diagnosed_date date,
    requires_epipen boolean DEFAULT false,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_allergies_allergy_type_check CHECK (((allergy_type)::text = ANY ((ARRAY['medicamento'::character varying, 'alimento'::character varying, 'ambiental'::character varying, 'insecto'::character varying, 'contacto'::character varying, 'otro'::character varying])::text[]))),
    CONSTRAINT user_allergies_severity_check CHECK (((severity)::text = ANY ((ARRAY['leve'::character varying, 'moderada'::character varying, 'grave'::character varying, 'anafilaxia'::character varying])::text[])))
);


--
-- Name: TABLE user_allergies; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_allergies IS 'Alergias mdicas';


--
-- Name: user_allergies_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_allergies_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_allergies_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_allergies_id_seq OWNED BY public.user_allergies.id;


--
-- Name: user_anthropometric_data; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_anthropometric_data (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    measurement_date date DEFAULT CURRENT_DATE NOT NULL,
    weight_kg numeric(5,2),
    height_cm numeric(5,2),
    bmi numeric(4,2),
    waist_circumference_cm numeric(5,2),
    hip_circumference_cm numeric(5,2),
    body_fat_percentage numeric(4,2),
    muscle_mass_kg numeric(5,2),
    blood_pressure_systolic integer,
    blood_pressure_diastolic integer,
    heart_rate_bpm integer,
    blood_type character varying(5),
    rh_factor character varying(10),
    measured_by character varying(200),
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_anthropometric_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_anthropometric_data IS 'Datos antropomtricos del empleado (peso, altura, IMC, etc.)';


--
-- Name: user_anthropometric_data_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_anthropometric_data_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_anthropometric_data_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_anthropometric_data_id_seq OWNED BY public.user_anthropometric_data.id;


--
-- Name: user_assigned_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_assigned_tasks (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    task_id integer NOT NULL,
    assigned_by uuid,
    assigned_date date DEFAULT CURRENT_DATE,
    due_date date,
    status character varying(50) DEFAULT 'pendiente'::character varying,
    priority character varying(50),
    progress_percentage integer DEFAULT 0,
    start_date date,
    completion_date date,
    actual_hours numeric(5,2),
    requires_approval boolean DEFAULT false,
    submitted_for_approval boolean DEFAULT false,
    approval_date date,
    approved_by uuid,
    approval_notes text,
    notes text,
    attachments jsonb,
    comments jsonb,
    reminder_sent boolean DEFAULT false,
    reminder_date date,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_assigned_tasks_priority_check CHECK (((priority)::text = ANY ((ARRAY['baja'::character varying, 'media'::character varying, 'alta'::character varying, 'urgente'::character varying])::text[]))),
    CONSTRAINT user_assigned_tasks_progress_percentage_check CHECK (((progress_percentage >= 0) AND (progress_percentage <= 100))),
    CONSTRAINT user_assigned_tasks_status_check CHECK (((status)::text = ANY ((ARRAY['pendiente'::character varying, 'en_progreso'::character varying, 'completada'::character varying, 'cancelada'::character varying, 'pausada'::character varying])::text[])))
);


--
-- Name: TABLE user_assigned_tasks; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_assigned_tasks IS 'Tareas asignadas a empleados especficos';


--
-- Name: COLUMN user_assigned_tasks.progress_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_assigned_tasks.progress_percentage IS 'Porcentaje de progreso (0-100)';


--
-- Name: COLUMN user_assigned_tasks.actual_hours; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_assigned_tasks.actual_hours IS 'Horas reales dedicadas a la tarea';


--
-- Name: COLUMN user_assigned_tasks.attachments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_assigned_tasks.attachments IS 'JSON array de archivos adjuntos [{filename, url, uploadDate}]';


--
-- Name: COLUMN user_assigned_tasks.comments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_assigned_tasks.comments IS 'JSON array de comentarios [{userId, userName, date, text}]';


--
-- Name: user_assigned_tasks_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_assigned_tasks_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_assigned_tasks_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_assigned_tasks_id_seq OWNED BY public.user_assigned_tasks.id;


--
-- Name: user_audit_logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_audit_logs (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    changed_by_user_id uuid,
    company_id integer,
    action character varying(50) NOT NULL,
    field_name character varying(100),
    old_value text,
    new_value text,
    description text,
    metadata jsonb DEFAULT '{}'::jsonb,
    ip_address character varying(45),
    user_agent text,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_audit_logs_action_check CHECK (((action)::text = ANY ((ARRAY['CREATE'::character varying, 'UPDATE'::character varying, 'DELETE'::character varying, 'ACTIVATE'::character varying, 'DEACTIVATE'::character varying, 'PASSWORD_RESET'::character varying, 'ROLE_CHANGE'::character varying, 'DEPARTMENT_CHANGE'::character varying, 'SHIFT_ASSIGN'::character varying, 'SHIFT_REMOVE'::character varying, 'BRANCH_CHANGE'::character varying, 'LOGIN'::character varying, 'LOGOUT'::character varying, 'LOGIN_FAILED'::character varying, 'BIOMETRIC_REGISTER'::character varying, 'CONSENT_GIVEN'::character varying, 'CONSENT_REVOKED'::character varying, 'GPS_CONFIG_CHANGE'::character varying, 'PROFILE_UPDATE'::character varying, 'BULK_UPDATE'::character varying])::text[])))
);


--
-- Name: TABLE user_audit_logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_audit_logs IS 'Registro de auditora de todos los cambios en usuarios';


--
-- Name: COLUMN user_audit_logs.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.user_id IS 'ID del usuario que fue modificado (UUID)';


--
-- Name: COLUMN user_audit_logs.changed_by_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.changed_by_user_id IS 'ID del usuario que realiz el cambio (NULL = sistema)';


--
-- Name: COLUMN user_audit_logs.action; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.action IS 'Tipo de accin realizada';


--
-- Name: COLUMN user_audit_logs.field_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.field_name IS 'Nombre del campo modificado (para UPDATE)';


--
-- Name: COLUMN user_audit_logs.old_value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.old_value IS 'Valor anterior del campo';


--
-- Name: COLUMN user_audit_logs.new_value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.new_value IS 'Nuevo valor del campo';


--
-- Name: COLUMN user_audit_logs.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_audit_logs.metadata IS 'Informacin adicional en formato JSON';


--
-- Name: user_audit_logs_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_audit_logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_audit_logs_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_audit_logs_id_seq OWNED BY public.user_audit_logs.id;


--
-- Name: user_children; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_children (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    full_name character varying(255) NOT NULL,
    dni character varying(50),
    birth_date date NOT NULL,
    gender character varying(20),
    lives_with_employee boolean DEFAULT true,
    is_dependent boolean DEFAULT true,
    health_insurance_coverage boolean DEFAULT false,
    special_needs text,
    school_name character varying(255),
    grade_level character varying(50),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_children_gender_check CHECK (((gender)::text = ANY ((ARRAY['masculino'::character varying, 'femenino'::character varying, 'otro'::character varying])::text[])))
);


--
-- Name: TABLE user_children; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_children IS 'Hijos del empleado';


--
-- Name: user_children_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_children_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_children_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_children_id_seq OWNED BY public.user_children.id;


--
-- Name: user_chronic_conditions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_chronic_conditions (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    condition_name character varying(255) NOT NULL,
    diagnosis_date date,
    severity character varying(50),
    requires_treatment boolean DEFAULT false,
    requires_monitoring boolean DEFAULT false,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_chronic_conditions_severity_check CHECK (((severity)::text = ANY ((ARRAY['leve'::character varying, 'moderada'::character varying, 'grave'::character varying])::text[])))
);


--
-- Name: TABLE user_chronic_conditions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_chronic_conditions IS 'Enfermedades crnicas';


--
-- Name: user_chronic_conditions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_chronic_conditions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_chronic_conditions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_chronic_conditions_id_seq OWNED BY public.user_chronic_conditions.id;


--
-- Name: user_chronic_conditions_v2; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_chronic_conditions_v2 (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    condition_catalog_id integer,
    condition_name character varying(200),
    diagnosis_date date,
    diagnosed_by character varying(200),
    severity character varying(20) DEFAULT 'moderate'::character varying,
    current_status character varying(30) DEFAULT 'active'::character varying,
    treatment_status character varying(30),
    affects_work_capacity boolean DEFAULT false,
    work_restrictions text,
    medications_required text,
    monitoring_frequency character varying(50),
    last_checkup_date date,
    next_checkup_date date,
    specialist_doctor character varying(200),
    specialist_phone character varying(50),
    notes text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_chronic_conditions_v2; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_chronic_conditions_v2 IS 'Condiciones crnicas del empleado con detalle completo';


--
-- Name: user_chronic_conditions_v2_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_chronic_conditions_v2_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_chronic_conditions_v2_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_chronic_conditions_v2_id_seq OWNED BY public.user_chronic_conditions_v2.id;


--
-- Name: user_consents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_consents (
    user_consent_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id integer NOT NULL,
    user_type character varying(50) NOT NULL,
    consent_id uuid NOT NULL,
    consent_version character varying(20) NOT NULL,
    status character varying(20) NOT NULL,
    accepted_at timestamp without time zone,
    rejected_at timestamp without time zone,
    revoked_at timestamp without time zone,
    ip_address character varying(45),
    user_agent text,
    signature_data text,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    company_id integer,
    CONSTRAINT user_consents_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'accepted'::character varying, 'rejected'::character varying, 'revoked'::character varying])::text[]))),
    CONSTRAINT user_consents_user_type_check CHECK (((user_type)::text = ANY ((ARRAY['employee'::character varying, 'vendor'::character varying, 'leader'::character varying, 'supervisor'::character varying, 'partner'::character varying, 'admin'::character varying])::text[])))
);


--
-- Name: TABLE user_consents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_consents IS 'Registro de aceptaciones/rechazos de consentimientos por usuario';


--
-- Name: COLUMN user_consents.user_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_consents.user_type IS 'Tipo de usuario: employee (users table), vendor/leader/supervisor/partner (partners table)';


--
-- Name: COLUMN user_consents.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_consents.status IS 'Estado: pending, accepted, rejected, revoked';


--
-- Name: COLUMN user_consents.signature_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_consents.signature_data IS 'JSON con datos de firma digital si aplica';


--
-- Name: user_contact_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_contact_history (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    field_name character varying(100) NOT NULL,
    old_value text,
    new_value text,
    changed_by uuid,
    change_reason text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_contact_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_contact_history IS 'Historial de cambios en datos de contacto';


--
-- Name: user_contact_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_contact_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_contact_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_contact_history_id_seq OWNED BY public.user_contact_history.id;


--
-- Name: user_disciplinary_actions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_disciplinary_actions (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    action_type character varying(100) NOT NULL,
    severity character varying(50),
    date_occurred date NOT NULL,
    description text NOT NULL,
    action_taken text NOT NULL,
    issued_by uuid NOT NULL,
    issued_date date DEFAULT CURRENT_DATE,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    employee_acknowledgement boolean DEFAULT false,
    employee_comments text,
    supporting_document_url text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_disciplinary_actions_action_type_check CHECK (((action_type)::text = ANY ((ARRAY['advertencia_verbal'::character varying, 'advertencia_escrita'::character varying, 'suspension'::character varying, 'descuento'::character varying, 'despido'::character varying, 'otro'::character varying])::text[]))),
    CONSTRAINT user_disciplinary_actions_severity_check CHECK (((severity)::text = ANY ((ARRAY['leve'::character varying, 'moderada'::character varying, 'grave'::character varying, 'muy_grave'::character varying])::text[])))
);


--
-- Name: TABLE user_disciplinary_actions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_disciplinary_actions IS 'Acciones disciplinarias';


--
-- Name: user_disciplinary_actions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_disciplinary_actions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_disciplinary_actions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_disciplinary_actions_id_seq OWNED BY public.user_disciplinary_actions.id;


--
-- Name: user_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_documents (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    document_type character varying(100) NOT NULL,
    document_number character varying(100),
    issue_date date,
    expiration_date date,
    issuing_authority character varying(255),
    file_url text,
    is_verified boolean DEFAULT false,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_documents_document_type_check CHECK (((document_type)::text = ANY ((ARRAY['dni'::character varying, 'pasaporte'::character varying, 'licencia_conducir'::character varying, 'visa'::character varying, 'certificado_antecedentes'::character varying, 'otro'::character varying])::text[])))
);


--
-- Name: TABLE user_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_documents IS 'Documentos personales (DNI, pasaporte, etc)';


--
-- Name: user_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_documents_id_seq OWNED BY public.user_documents.id;


--
-- Name: user_driver_licenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_driver_licenses (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    license_type character varying(50) NOT NULL,
    license_number character varying(100),
    license_class character varying(20),
    subclass character varying(50),
    issue_date date,
    expiry_date date,
    photo_url text,
    issuing_authority character varying(255),
    issuing_country character varying(100) DEFAULT 'Argentina'::character varying,
    restrictions text,
    observations text,
    requires_glasses boolean DEFAULT false,
    is_active boolean DEFAULT true,
    suspension_start_date date,
    suspension_end_date date,
    suspension_reason text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_driver_licenses_license_type_check CHECK (((license_type)::text = ANY ((ARRAY['nacional'::character varying, 'internacional'::character varying, 'pasajeros'::character varying])::text[])))
);


--
-- Name: TABLE user_driver_licenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_driver_licenses IS 'Licencias de conducir del empleado (nacional, internacional, pasajeros)';


--
-- Name: COLUMN user_driver_licenses.license_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_driver_licenses.license_type IS 'Tipo: nacional (licencia estndar), internacional (para conducir en otros pases), pasajeros (transporte pblico)';


--
-- Name: COLUMN user_driver_licenses.license_class; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_driver_licenses.license_class IS 'Clase de licencia: A (motos), B (autos), C (camiones), D (transporte pasajeros), E (articulados)';


--
-- Name: COLUMN user_driver_licenses.expiry_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_driver_licenses.expiry_date IS ' VENCIMIENTO - Fecha de vencimiento de la licencia (requiere sistema de alertas)';


--
-- Name: COLUMN user_driver_licenses.photo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_driver_licenses.photo_url IS 'URL de la foto escaneada de la licencia';


--
-- Name: COLUMN user_driver_licenses.requires_glasses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_driver_licenses.requires_glasses IS 'Si la licencia especifica uso obligatorio de anteojos (importante para biometra)';


--
-- Name: user_driver_licenses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_driver_licenses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_driver_licenses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_driver_licenses_id_seq OWNED BY public.user_driver_licenses.id;


--
-- Name: user_education; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_education (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    education_level character varying(100) NOT NULL,
    institution_name character varying(255) NOT NULL,
    degree_title character varying(255),
    field_of_study character varying(255),
    start_date date,
    end_date date,
    graduated boolean DEFAULT false,
    certificate_file_url text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_education_education_level_check CHECK (((education_level)::text = ANY ((ARRAY['primaria'::character varying, 'secundaria'::character varying, 'terciaria'::character varying, 'universitaria'::character varying, 'posgrado'::character varying, 'doctorado'::character varying])::text[])))
);


--
-- Name: TABLE user_education; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_education IS 'Historial educativo';


--
-- Name: user_education_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_education_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_education_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_education_id_seq OWNED BY public.user_education.id;


--
-- Name: user_emails; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_emails (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    email character varying(255) NOT NULL,
    is_primary boolean DEFAULT true,
    is_verified boolean DEFAULT false,
    verification_token character varying(255),
    verified_at timestamp without time zone,
    receive_system_notifications boolean DEFAULT true,
    receive_attendance_alerts boolean DEFAULT true,
    receive_vacation_updates boolean DEFAULT true,
    receive_medical_notifications boolean DEFAULT true,
    receive_legal_notices boolean DEFAULT true,
    receive_shifts_changes boolean DEFAULT true,
    receive_payroll_notifications boolean DEFAULT true,
    email_format character varying(20) DEFAULT 'html'::character varying,
    email_frequency character varying(20) DEFAULT 'instant'::character varying,
    is_active boolean DEFAULT true,
    bounced boolean DEFAULT false,
    bounced_at timestamp without time zone,
    bounce_count integer DEFAULT 0,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    last_email_sent timestamp without time zone,
    CONSTRAINT chk_email_format CHECK (((email_format)::text = ANY ((ARRAY['html'::character varying, 'text'::character varying])::text[]))),
    CONSTRAINT chk_email_frequency CHECK (((email_frequency)::text = ANY ((ARRAY['instant'::character varying, 'daily_digest'::character varying, 'weekly_digest'::character varying])::text[])))
);


--
-- Name: TABLE user_emails; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_emails IS 'Emails de empleados con sincronizacin automtica desde tabla users';


--
-- Name: COLUMN user_emails.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_emails.email IS 'Email del empleado - se sincroniza automticamente con users.email';


--
-- Name: user_emails_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_emails_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_emails_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_emails_id_seq OWNED BY public.user_emails.id;


--
-- Name: user_emergency_contacts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_emergency_contacts (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer,
    priority integer DEFAULT 1 NOT NULL,
    full_name character varying(255) NOT NULL,
    relationship character varying(30) NOT NULL,
    phone_primary character varying(30) NOT NULL,
    phone_secondary character varying(30),
    phone_work character varying(30),
    email character varying(255),
    address text,
    city character varying(100),
    province character varying(100),
    available_hours character varying(100),
    preferred_contact_method character varying(20) DEFAULT 'phone'::character varying,
    special_instructions text,
    speaks_languages character varying(100),
    can_make_medical_decisions boolean DEFAULT false,
    can_pickup_employee boolean DEFAULT true,
    has_keys_to_home boolean DEFAULT false,
    is_active boolean DEFAULT true,
    verified_at timestamp with time zone,
    verified_by uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_emergency_contacts_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_emergency_contacts_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_emergency_contacts_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_emergency_contacts_id_seq OWNED BY public.user_emergency_contacts.id;


--
-- Name: user_family_members; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_family_members (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    full_name character varying(255) NOT NULL,
    relationship character varying(100) NOT NULL,
    dni character varying(50),
    birth_date date,
    phone character varying(50),
    lives_with_employee boolean DEFAULT false,
    is_dependent boolean DEFAULT false,
    is_emergency_contact boolean DEFAULT false,
    health_insurance_coverage boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_family_members; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_family_members IS 'Otros familiares del empleado';


--
-- Name: user_family_members_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_family_members_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_family_members_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_family_members_id_seq OWNED BY public.user_family_members.id;


--
-- Name: user_healthy_habits; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_healthy_habits (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    does_regular_exercise boolean DEFAULT false,
    exercise_minutes_per_week integer,
    sedentary_hours_per_day integer,
    smoking_status character varying(30),
    cigarettes_per_day integer,
    smoking_years integer,
    quit_date date,
    alcohol_consumption character varying(30),
    drinks_per_week integer,
    diet_type character varying(50),
    diet_restrictions text,
    meals_per_day integer,
    drinks_water_liters numeric(3,1),
    average_sleep_hours numeric(3,1),
    sleep_quality character varying(30),
    has_sleep_disorders boolean DEFAULT false,
    sleep_disorder_details text,
    stress_level character varying(30),
    stress_management_activities text,
    last_general_checkup date,
    last_dental_checkup date,
    last_vision_checkup date,
    last_gynecological_checkup date,
    last_urological_checkup date,
    notes text,
    last_updated date DEFAULT CURRENT_DATE,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_healthy_habits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_healthy_habits IS 'Hbitos saludables generales del empleado';


--
-- Name: user_healthy_habits_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_healthy_habits_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_healthy_habits_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_healthy_habits_id_seq OWNED BY public.user_healthy_habits.id;


--
-- Name: user_household_members; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_household_members (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer,
    full_name character varying(255) NOT NULL,
    relationship character varying(30) NOT NULL,
    birth_date date,
    gender character varying(20),
    dni character varying(20),
    is_dependent boolean DEFAULT false,
    is_cohabitant boolean DEFAULT true,
    has_disability boolean DEFAULT false,
    disability_type character varying(100),
    has_chronic_illness boolean DEFAULT false,
    chronic_illness_notes text,
    works_externally boolean DEFAULT false,
    occupation character varying(100),
    education_level character varying(30),
    is_student boolean DEFAULT false,
    school_name character varying(255),
    has_own_health_insurance boolean DEFAULT false,
    health_insurance_provider character varying(100),
    is_covered_by_employee boolean DEFAULT false,
    is_life_insurance_beneficiary boolean DEFAULT false,
    beneficiary_percentage numeric(5,2),
    notes text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid,
    updated_by uuid
);


--
-- Name: user_household_members_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_household_members_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_household_members_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_household_members_id_seq OWNED BY public.user_household_members.id;


--
-- Name: user_legal_issues; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_legal_issues (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    issue_type character varying(100) NOT NULL,
    issue_subtype character varying(255),
    case_number character varying(100),
    court character varying(255),
    jurisdiction character varying(255),
    filing_date date,
    resolution_date date,
    last_hearing_date date,
    next_hearing_date date,
    status character varying(50),
    description text,
    plaintiff character varying(255),
    defendant character varying(255),
    outcome text,
    sentence_details text,
    fine_amount numeric(12,2),
    affects_employment boolean DEFAULT false,
    employment_restriction_details text,
    document_url text,
    notes text,
    is_confidential boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    is_locked boolean DEFAULT false,
    locked_at timestamp without time zone,
    edit_count integer DEFAULT 0,
    last_edited_by uuid,
    last_edited_at timestamp without time zone,
    is_deleted boolean DEFAULT false,
    deleted_at timestamp without time zone,
    deleted_by uuid,
    deletion_reason text,
    CONSTRAINT user_legal_issues_issue_type_check CHECK (((issue_type)::text = ANY ((ARRAY['penal'::character varying, 'civil'::character varying, 'laboral'::character varying, 'comercial'::character varying, 'administrativo'::character varying, 'otro'::character varying])::text[]))),
    CONSTRAINT user_legal_issues_status_check CHECK (((status)::text = ANY ((ARRAY['en_tramite'::character varying, 'resuelto'::character varying, 'archivado'::character varying, 'desestimado'::character varying, 'apelacion'::character varying, 'ejecutoria'::character varying])::text[])))
);


--
-- Name: TABLE user_legal_issues; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_legal_issues IS 'Antecedentes legales y judiciales del empleado';


--
-- Name: COLUMN user_legal_issues.issue_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_legal_issues.issue_type IS 'Tipo de causa: penal, civil, laboral, comercial, administrativo';


--
-- Name: COLUMN user_legal_issues.affects_employment; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_legal_issues.affects_employment IS 'Si el caso afecta la elegibilidad para el empleo actual';


--
-- Name: COLUMN user_legal_issues.is_confidential; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_legal_issues.is_confidential IS 'Marca informacin sensible que requiere permisos especiales para visualizar';


--
-- Name: user_legal_issues_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_legal_issues_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_legal_issues_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_legal_issues_id_seq OWNED BY public.user_legal_issues.id;


--
-- Name: user_marital_status; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_marital_status (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    marital_status character varying(50) NOT NULL,
    spouse_name character varying(255),
    spouse_dni character varying(50),
    spouse_phone character varying(50),
    spouse_occupation character varying(255),
    marriage_date date,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_marital_status_marital_status_check CHECK (((marital_status)::text = ANY ((ARRAY['soltero'::character varying, 'casado'::character varying, 'divorciado'::character varying, 'viudo'::character varying, 'union_libre'::character varying])::text[])))
);


--
-- Name: TABLE user_marital_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_marital_status IS 'Estado civil y datos del cnyuge';


--
-- Name: user_marital_status_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_marital_status_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_marital_status_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_marital_status_id_seq OWNED BY public.user_marital_status.id;


--
-- Name: user_medical_documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_medical_documents (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    document_type character varying(100) NOT NULL,
    document_name character varying(255) NOT NULL,
    file_url text NOT NULL,
    upload_date date DEFAULT CURRENT_DATE,
    expiration_date date,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_medical_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_medical_documents IS 'Documentos mdicos escaneados';


--
-- Name: user_medical_documents_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_medical_documents_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_medical_documents_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_medical_documents_id_seq OWNED BY public.user_medical_documents.id;


--
-- Name: user_medical_exams; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_medical_exams (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    exam_type character varying(100) NOT NULL,
    exam_date date NOT NULL,
    result character varying(50),
    observations text,
    next_exam_date date,
    medical_center character varying(255),
    examining_doctor character varying(255),
    certificate_url text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_medical_exams_exam_type_check CHECK (((exam_type)::text = ANY ((ARRAY['preocupacional'::character varying, 'periodico'::character varying, 'reingreso'::character varying, 'retiro'::character varying, 'especial'::character varying])::text[]))),
    CONSTRAINT user_medical_exams_result_check CHECK (((result)::text = ANY ((ARRAY['apto'::character varying, 'apto_con_observaciones'::character varying, 'no_apto'::character varying, 'pendiente'::character varying])::text[])))
);


--
-- Name: TABLE user_medical_exams; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_medical_exams IS 'Exmenes mdicos ocupacionales';


--
-- Name: user_medical_exams_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_medical_exams_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_medical_exams_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_medical_exams_id_seq OWNED BY public.user_medical_exams.id;


--
-- Name: user_medications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_medications (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    medication_name character varying(255) NOT NULL,
    dosage character varying(100),
    frequency character varying(100),
    route character varying(50),
    start_date date,
    end_date date,
    is_continuous boolean DEFAULT false,
    prescribing_doctor character varying(255),
    purpose text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_medications_route_check CHECK (((route)::text = ANY ((ARRAY['oral'::character varying, 'inyectable'::character varying, 'topico'::character varying, 'inhalado'::character varying, 'otro'::character varying])::text[])))
);


--
-- Name: TABLE user_medications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_medications IS 'Medicamentos actuales';


--
-- Name: user_medications_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_medications_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_medications_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_medications_id_seq OWNED BY public.user_medications.id;


--
-- Name: user_notification_preferences; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_notification_preferences (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer,
    module character varying(50),
    receive_app boolean DEFAULT true,
    receive_email boolean DEFAULT true,
    receive_push boolean DEFAULT true,
    receive_whatsapp boolean DEFAULT false,
    receive_sms boolean DEFAULT false,
    quiet_hours_enabled boolean DEFAULT false,
    quiet_hours_start time without time zone DEFAULT '22:00:00'::time without time zone,
    quiet_hours_end time without time zone DEFAULT '08:00:00'::time without time zone,
    quiet_days jsonb DEFAULT '[]'::jsonb,
    daily_digest boolean DEFAULT false,
    digest_time time without time zone DEFAULT '08:00:00'::time without time zone,
    allow_ai_responses boolean DEFAULT true,
    ai_auto_respond_threshold numeric(3,2) DEFAULT 0.85,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: user_notification_preferences_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_notification_preferences_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_notification_preferences_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_notification_preferences_id_seq OWNED BY public.user_notification_preferences.id;


--
-- Name: user_payroll_assignment; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_payroll_assignment (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    branch_id integer,
    template_id integer NOT NULL,
    category_id integer,
    base_salary numeric(15,2) NOT NULL,
    hourly_rate numeric(10,4),
    calculation_basis character varying(20) DEFAULT 'monthly'::character varying,
    effective_from date DEFAULT CURRENT_DATE NOT NULL,
    effective_to date,
    is_current boolean DEFAULT true,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    assignment_id integer,
    salary_type character varying(20) DEFAULT 'monthly'::character varying,
    bank_name character varying(100),
    bank_account_number character varying(50),
    bank_account_type character varying(20),
    payment_method character varying(20) DEFAULT 'bank_transfer'::character varying,
    tax_id character varying(20),
    hire_date date,
    seniority_date date,
    termination_date date,
    work_schedule jsonb DEFAULT '{"type": "full_time", "days_per_week": 5, "hours_per_week": 40}'::jsonb,
    notes text,
    is_active boolean DEFAULT true
);


--
-- Name: user_payroll_assignment_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_payroll_assignment_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_payroll_assignment_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_payroll_assignment_id_seq OWNED BY public.user_payroll_assignment.id;


--
-- Name: user_payroll_bonuses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_payroll_bonuses (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    bonus_code character varying(50) NOT NULL,
    bonus_name character varying(200) NOT NULL,
    description text,
    bonus_type character varying(30) NOT NULL,
    concept_type_id integer,
    amount numeric(15,2),
    percentage numeric(6,4),
    percentage_base character varying(100),
    frequency character varying(30) DEFAULT 'monthly'::character varying NOT NULL,
    next_payment_date date,
    last_payment_date date,
    requires_approval boolean DEFAULT false,
    approved_by uuid,
    approved_at timestamp without time zone,
    effective_from date DEFAULT CURRENT_DATE NOT NULL,
    effective_to date,
    is_active boolean DEFAULT true,
    reason_category character varying(50),
    reason_detail text,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    bonus_id integer,
    is_remunerative boolean DEFAULT true,
    is_taxable boolean DEFAULT true,
    payment_month integer,
    reason text
);


--
-- Name: user_payroll_bonuses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_payroll_bonuses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_payroll_bonuses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_payroll_bonuses_id_seq OWNED BY public.user_payroll_bonuses.id;


--
-- Name: user_payroll_concept_overrides; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_payroll_concept_overrides (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    assignment_id integer NOT NULL,
    template_concept_id integer,
    concept_type_id integer,
    custom_concept_code character varying(50),
    custom_concept_name character varying(200),
    override_value numeric(15,4),
    override_percentage numeric(6,4),
    is_percentage boolean DEFAULT false,
    is_active boolean DEFAULT true,
    applies_from date,
    applies_to date,
    reason text,
    created_by uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    override_id integer,
    concept_id integer,
    override_type character varying(20) DEFAULT 'replace'::character varying,
    fixed_amount numeric(15,2),
    percentage_value numeric(8,4),
    is_remunerative boolean,
    approved_by uuid,
    approved_at timestamp without time zone,
    effective_to date
);


--
-- Name: user_payroll_concept_overrides_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_payroll_concept_overrides_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_payroll_concept_overrides_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_payroll_concept_overrides_id_seq OWNED BY public.user_payroll_concept_overrides.id;


--
-- Name: user_payroll_records; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_payroll_records (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    period_year integer NOT NULL,
    period_month integer NOT NULL,
    period_type character varying(30),
    payment_date date,
    base_salary numeric(12,2),
    seniority_bonus numeric(12,2) DEFAULT 0,
    presentation_bonus numeric(12,2) DEFAULT 0,
    overtime_hours numeric(6,2) DEFAULT 0,
    overtime_50_amount numeric(12,2) DEFAULT 0,
    overtime_100_amount numeric(12,2) DEFAULT 0,
    vacation_days_paid integer DEFAULT 0,
    vacation_amount numeric(12,2) DEFAULT 0,
    sac_aguinaldo numeric(12,2) DEFAULT 0,
    commissions numeric(12,2) DEFAULT 0,
    bonuses numeric(12,2) DEFAULT 0,
    other_earnings numeric(12,2) DEFAULT 0,
    other_earnings_detail text,
    gross_total numeric(12,2),
    jubilacion numeric(12,2) DEFAULT 0,
    obra_social numeric(12,2) DEFAULT 0,
    ley_19032 numeric(12,2) DEFAULT 0,
    sindicato numeric(12,2) DEFAULT 0,
    ganancias numeric(12,2) DEFAULT 0,
    other_deductions numeric(12,2) DEFAULT 0,
    other_deductions_detail text,
    deductions_total numeric(12,2),
    net_salary numeric(12,2),
    regular_hours_worked numeric(6,2),
    overtime_50_hours numeric(6,2) DEFAULT 0,
    overtime_100_hours numeric(6,2) DEFAULT 0,
    total_hours_worked numeric(6,2),
    days_worked integer,
    absent_days integer DEFAULT 0,
    vacation_days_taken integer DEFAULT 0,
    sick_days integer DEFAULT 0,
    status character varying(30) DEFAULT 'draft'::character varying,
    receipt_number character varying(50),
    digital_receipt_url text,
    signed_by_employee boolean DEFAULT false,
    signed_date date,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid,
    approved_by uuid
);


--
-- Name: TABLE user_payroll_records; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_payroll_records IS 'Historial de liquidaciones y recibos de sueldo';


--
-- Name: user_payroll_records_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_payroll_records_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_payroll_records_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_payroll_records_id_seq OWNED BY public.user_payroll_records.id;


--
-- Name: user_permission_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_permission_requests (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    request_type character varying(100) NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    total_days integer NOT NULL,
    reason text,
    status character varying(50) DEFAULT 'pendiente'::character varying,
    requested_date timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    approved_by uuid,
    approval_date timestamp without time zone,
    rejection_reason text,
    supporting_document_url text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_permission_requests_request_type_check CHECK (((request_type)::text = ANY ((ARRAY['vacaciones'::character varying, 'licencia_medica'::character varying, 'permiso_personal'::character varying, 'estudio'::character varying, 'duelo'::character varying, 'maternidad'::character varying, 'paternidad'::character varying, 'otro'::character varying])::text[]))),
    CONSTRAINT user_permission_requests_status_check CHECK (((status)::text = ANY ((ARRAY['pendiente'::character varying, 'aprobado'::character varying, 'rechazado'::character varying, 'cancelado'::character varying])::text[])))
);


--
-- Name: TABLE user_permission_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_permission_requests IS 'Solicitudes de permisos y ausencias';


--
-- Name: user_permission_requests_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_permission_requests_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_permission_requests_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_permission_requests_id_seq OWNED BY public.user_permission_requests.id;


--
-- Name: user_permissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_permissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    module_id character varying(50) NOT NULL,
    action_id character varying(100) NOT NULL,
    has_access boolean DEFAULT true,
    granted_by uuid,
    granted_at timestamp with time zone DEFAULT now(),
    revoked_at timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- Name: user_primary_physician; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_primary_physician (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    physician_name character varying(255) NOT NULL,
    specialty character varying(255),
    phone character varying(50),
    email character varying(255),
    clinic_name character varying(255),
    clinic_address text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_primary_physician; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_primary_physician IS 'Mdico de cabecera';


--
-- Name: user_primary_physician_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_primary_physician_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_primary_physician_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_primary_physician_id_seq OWNED BY public.user_primary_physician.id;


--
-- Name: user_professional_licenses; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_professional_licenses (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    license_name character varying(255) NOT NULL,
    profession character varying(255),
    license_number character varying(100),
    issuing_body character varying(255),
    issuing_country character varying(100) DEFAULT 'Argentina'::character varying,
    jurisdiction character varying(255),
    issue_date date,
    expiry_date date,
    certificate_url text,
    verification_url text,
    is_active boolean DEFAULT true,
    requires_renewal boolean DEFAULT true,
    renewal_frequency character varying(50),
    last_renewal_date date,
    is_suspended boolean DEFAULT false,
    suspension_start_date date,
    suspension_end_date date,
    suspension_reason text,
    specializations text,
    observations text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_professional_licenses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_professional_licenses IS 'Licencias y matrculas profesionales del empleado';


--
-- Name: COLUMN user_professional_licenses.license_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_professional_licenses.license_name IS 'Nombre de la licencia/matrcula (ej: Matrcula Mdica)';


--
-- Name: COLUMN user_professional_licenses.profession; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_professional_licenses.profession IS 'Profesin (ej: Mdico, Abogado, Ingeniero, Contador)';


--
-- Name: COLUMN user_professional_licenses.issuing_body; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_professional_licenses.issuing_body IS 'Organismo emisor (ej: Colegio Mdico, Colegio de Abogados)';


--
-- Name: COLUMN user_professional_licenses.expiry_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_professional_licenses.expiry_date IS ' VENCIMIENTO - Algunas profesiones requieren renovacin peridica';


--
-- Name: COLUMN user_professional_licenses.verification_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_professional_licenses.verification_url IS 'URL para verificar la licencia online en el sitio del organismo emisor';


--
-- Name: user_professional_licenses_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_professional_licenses_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_professional_licenses_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_professional_licenses_id_seq OWNED BY public.user_professional_licenses.id;


--
-- Name: user_psychiatric_treatments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_psychiatric_treatments (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    treatment_type character varying(50) NOT NULL,
    condition_treated character varying(200),
    diagnosis_date date,
    treatment_start_date date,
    treatment_end_date date,
    is_current boolean DEFAULT true,
    treating_professional character varying(200),
    professional_type character varying(50),
    professional_license character varying(50),
    professional_phone character varying(50),
    session_frequency character varying(50),
    takes_psychiatric_medication boolean DEFAULT false,
    medication_details text,
    medication_side_effects text,
    affects_work_performance boolean DEFAULT false,
    work_accommodations_needed text,
    emergency_protocol text,
    hospitalization_history boolean DEFAULT false,
    hospitalization_details text,
    last_crisis_date date,
    crisis_frequency character varying(50),
    confidentiality_level character varying(20) DEFAULT 'restricted'::character varying,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_psychiatric_treatments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_psychiatric_treatments IS 'Tratamientos psiquitricos/psicolgicos actuales e histricos';


--
-- Name: user_psychiatric_treatments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_psychiatric_treatments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_psychiatric_treatments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_psychiatric_treatments_id_seq OWNED BY public.user_psychiatric_treatments.id;


--
-- Name: user_role_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_role_assignments (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    role_id integer NOT NULL,
    scope_override jsonb,
    valid_from date DEFAULT CURRENT_DATE,
    valid_until date,
    is_active boolean DEFAULT true,
    is_primary boolean DEFAULT false,
    assigned_at timestamp without time zone DEFAULT now(),
    assigned_by uuid,
    deactivated_at timestamp without time zone,
    deactivated_by uuid,
    deactivation_reason text
);


--
-- Name: user_role_assignments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_role_assignments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_role_assignments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_role_assignments_id_seq OWNED BY public.user_role_assignments.id;


--
-- Name: user_salary_config; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_salary_config (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    base_salary numeric(12,2) NOT NULL,
    salary_currency character varying(10) DEFAULT 'ARS'::character varying,
    salary_type character varying(50),
    payment_frequency character varying(50),
    payment_day integer,
    bank_name character varying(255),
    bank_account_number character varying(100),
    bank_account_type character varying(50),
    cbu character varying(22),
    alias_cbu character varying(100),
    swift_code character varying(15),
    payment_method character varying(50) DEFAULT 'transferencia'::character varying,
    payment_notes text,
    bonuses jsonb,
    allowances jsonb,
    deductions jsonb,
    has_obra_social boolean DEFAULT true,
    obra_social_deduction numeric(10,2),
    has_sindicato boolean DEFAULT false,
    sindicato_deduction numeric(10,2),
    tax_withholding_percentage numeric(5,2),
    has_tax_exemption boolean DEFAULT false,
    tax_exemption_reason text,
    overtime_enabled boolean DEFAULT true,
    overtime_rate_weekday numeric(5,2) DEFAULT 1.50,
    overtime_rate_weekend numeric(5,2) DEFAULT 2.00,
    overtime_rate_holiday numeric(5,2) DEFAULT 2.00,
    vacation_days_per_year integer DEFAULT 14,
    vacation_days_used integer DEFAULT 0,
    vacation_days_pending integer DEFAULT 14,
    sac_enabled boolean DEFAULT true,
    sac_calculation_method character varying(50) DEFAULT 'best_salary'::character varying,
    last_salary_review_date date,
    next_salary_review_date date,
    salary_increase_percentage numeric(5,2),
    salary_increase_notes text,
    notes text,
    is_active boolean DEFAULT true,
    created_by uuid,
    last_updated_by uuid,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_salary_config_bank_account_type_check CHECK (((bank_account_type)::text = ANY ((ARRAY['caja_ahorro'::character varying, 'cuenta_corriente'::character varying])::text[]))),
    CONSTRAINT user_salary_config_payment_frequency_check CHECK (((payment_frequency)::text = ANY ((ARRAY['mensual'::character varying, 'quincenal'::character varying, 'semanal'::character varying, 'diario'::character varying])::text[]))),
    CONSTRAINT user_salary_config_payment_method_check CHECK (((payment_method)::text = ANY ((ARRAY['transferencia'::character varying, 'cheque'::character varying, 'efectivo'::character varying, 'tarjeta'::character varying])::text[]))),
    CONSTRAINT user_salary_config_salary_type_check CHECK (((salary_type)::text = ANY ((ARRAY['mensual'::character varying, 'jornal'::character varying, 'por_hora'::character varying, 'comision'::character varying])::text[])))
);


--
-- Name: TABLE user_salary_config; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_salary_config IS 'Configuracin salarial completa del empleado';


--
-- Name: COLUMN user_salary_config.base_salary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.base_salary IS 'Salario base (bruto)';


--
-- Name: COLUMN user_salary_config.salary_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.salary_type IS 'Tipo de salario: mensual (fijo), jornal (diario), por_hora, comisin';


--
-- Name: COLUMN user_salary_config.cbu; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.cbu IS 'CBU de 22 dgitos para transferencias bancarias';


--
-- Name: COLUMN user_salary_config.bonuses; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.bonuses IS 'JSON array de bonos [{name, amount, frequency, description}]';


--
-- Name: COLUMN user_salary_config.deductions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.deductions IS 'JSON array de descuentos [{name, amount, type, description}]';


--
-- Name: COLUMN user_salary_config.overtime_rate_weekday; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.overtime_rate_weekday IS 'Multiplicador para horas extra entre semana (ej: 1.50 = 50% ms)';


--
-- Name: COLUMN user_salary_config.sac_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.sac_enabled IS 'Si cobra aguinaldo (SAC - Sueldo Anual Complementario)';


--
-- Name: COLUMN user_salary_config.next_salary_review_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_salary_config.next_salary_review_date IS ' Fecha de prxima revisin salarial';


--
-- Name: user_salary_config_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_salary_config_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_salary_config_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_salary_config_id_seq OWNED BY public.user_salary_config.id;


--
-- Name: user_salary_config_v2; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_salary_config_v2 (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    labor_agreement_id integer,
    salary_category_id integer,
    custom_category character varying(100),
    payment_type character varying(30) NOT NULL,
    base_salary numeric(12,2) NOT NULL,
    gross_salary numeric(12,2),
    net_salary numeric(12,2),
    currency character varying(10) DEFAULT 'ARS'::character varying,
    seniority_bonus numeric(12,2) DEFAULT 0,
    presentation_bonus numeric(12,2) DEFAULT 0,
    food_allowance numeric(12,2) DEFAULT 0,
    transport_allowance numeric(12,2) DEFAULT 0,
    other_bonuses numeric(12,2) DEFAULT 0,
    other_bonuses_detail text,
    contracted_hours_per_week numeric(4,1) DEFAULT 48,
    work_schedule_type character varying(30),
    hourly_rate numeric(10,2),
    overtime_rate_50 numeric(10,2),
    overtime_rate_100 numeric(10,2),
    last_salary_update date,
    previous_base_salary numeric(12,2),
    salary_increase_percentage numeric(5,2),
    salary_increase_reason character varying(200),
    next_review_date date,
    bank_name character varying(100),
    bank_account_type character varying(30),
    bank_account_number character varying(50),
    bank_cbu character varying(30),
    bank_alias character varying(50),
    effective_from date NOT NULL,
    effective_to date,
    is_current boolean DEFAULT true,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    created_by uuid
);


--
-- Name: TABLE user_salary_config_v2; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_salary_config_v2 IS 'Configuracin salarial detallada del empleado';


--
-- Name: user_salary_config_v2_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_salary_config_v2_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_salary_config_v2_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_salary_config_v2_id_seq OWNED BY public.user_salary_config_v2.id;


--
-- Name: user_shift_assignments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_shift_assignments (
    id bigint NOT NULL,
    user_id uuid NOT NULL,
    shift_id uuid NOT NULL,
    company_id integer NOT NULL,
    join_date date NOT NULL,
    assigned_phase character varying(50) NOT NULL,
    group_name character varying(255),
    sector character varying(100),
    assigned_by uuid,
    assigned_at timestamp without time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    deactivated_at timestamp without time zone,
    deactivated_by uuid,
    notes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);


--
-- Name: user_shift_assignments_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_shift_assignments_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_shift_assignments_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_shift_assignments_id_seq OWNED BY public.user_shift_assignments.id;


--
-- Name: user_shifts; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_shifts (
    user_id uuid NOT NULL,
    shift_id uuid NOT NULL,
    "createdAt" timestamp with time zone DEFAULT now(),
    "updatedAt" timestamp with time zone DEFAULT now()
);


--
-- Name: TABLE user_shifts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_shifts IS 'Tabla de relacin many-to-many entre usuarios y turnos';


--
-- Name: COLUMN user_shifts.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_shifts.user_id IS 'ID del usuario (UUID)';


--
-- Name: COLUMN user_shifts.shift_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_shifts.shift_id IS 'ID del turno (UUID)';


--
-- Name: user_sports_activities; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_sports_activities (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    sport_catalog_id integer,
    sport_name character varying(100),
    practice_level character varying(30) NOT NULL,
    frequency character varying(30),
    hours_per_week numeric(4,1),
    years_practicing integer,
    is_federated boolean DEFAULT false,
    federation_name character varying(200),
    license_number character varying(50),
    team_club_name character varying(200),
    participates_in_competitions boolean DEFAULT false,
    competition_level character varying(50),
    competitions_per_year integer,
    last_competition_date date,
    achievements text,
    has_coach boolean DEFAULT false,
    coach_name character varying(200),
    training_location character varying(200),
    medical_clearance_required boolean DEFAULT false,
    medical_clearance_date date,
    medical_clearance_expiry date,
    is_extreme_sport boolean DEFAULT false,
    insurance_required boolean DEFAULT false,
    insurance_company character varying(200),
    insurance_policy character varying(100),
    notes text,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_sports_activities; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_sports_activities IS 'Actividades deportivas del empleado';


--
-- Name: user_sports_activities_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_sports_activities_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_sports_activities_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_sports_activities_id_seq OWNED BY public.user_sports_activities.id;


--
-- Name: user_surgeries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_surgeries (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    surgery_type character varying(200) NOT NULL,
    surgery_date date,
    hospital_clinic character varying(200),
    surgeon_name character varying(200),
    reason text,
    complications boolean DEFAULT false,
    complications_details text,
    recovery_days integer,
    return_to_work_date date,
    has_permanent_effects boolean DEFAULT false,
    permanent_effects_details text,
    follow_up_required boolean DEFAULT false,
    follow_up_frequency character varying(50),
    last_follow_up_date date,
    documents_attached text[],
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_surgeries; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_surgeries IS 'Historial de cirugas del empleado';


--
-- Name: user_surgeries_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_surgeries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_surgeries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_surgeries_id_seq OWNED BY public.user_surgeries.id;


--
-- Name: user_tasks_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.user_tasks_summary AS
 SELECT u.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS full_name,
    u.company_id,
    count(*) FILTER (WHERE ((uat.status)::text = 'pendiente'::text)) AS tasks_pending,
    count(*) FILTER (WHERE ((uat.status)::text = 'en_progreso'::text)) AS tasks_in_progress,
    count(*) FILTER (WHERE ((uat.status)::text = 'completada'::text)) AS tasks_completed,
    count(*) FILTER (WHERE ((uat.due_date < CURRENT_DATE) AND ((uat.status)::text <> ALL ((ARRAY['completada'::character varying, 'cancelada'::character varying])::text[])))) AS tasks_overdue,
    count(*) AS total_tasks
   FROM (public.users u
     LEFT JOIN public.user_assigned_tasks uat ON ((u.user_id = uat.user_id)))
  GROUP BY u.user_id, u."firstName", u."lastName", u.company_id;


--
-- Name: VIEW user_tasks_summary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.user_tasks_summary IS 'Resumen de tareas por usuario';


--
-- Name: user_union_affiliation; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_union_affiliation (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    union_name character varying(255) NOT NULL,
    union_full_name character varying(500),
    union_cuit character varying(15),
    membership_number character varying(100),
    affiliation_date date NOT NULL,
    resignation_date date,
    is_active boolean DEFAULT true,
    delegate_role character varying(100),
    delegate_start_date date,
    delegate_end_date date,
    section_or_branch character varying(255),
    workplace_delegate boolean DEFAULT false,
    has_fuero_sindical boolean DEFAULT false,
    fuero_start_date date,
    fuero_end_date date,
    monthly_dues numeric(10,2),
    dues_payment_method character varying(50),
    last_payment_date date,
    union_phone character varying(50),
    union_email character varying(255),
    union_address text,
    union_delegate_contact character varying(255),
    membership_card_url text,
    certificate_url text,
    benefits text,
    notes text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT user_union_affiliation_dues_payment_method_check CHECK (((dues_payment_method)::text = ANY ((ARRAY['descuento_automatico'::character varying, 'transferencia'::character varying, 'efectivo'::character varying, 'debito'::character varying])::text[])))
);


--
-- Name: TABLE user_union_affiliation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_union_affiliation IS 'Afiliacin sindical del empleado';


--
-- Name: COLUMN user_union_affiliation.union_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_union_affiliation.union_name IS 'Nombre del sindicato (ej: UOM, Camioneros, UOCRA)';


--
-- Name: COLUMN user_union_affiliation.delegate_role; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_union_affiliation.delegate_role IS 'Rol dentro del sindicato: delegado, subdelegado, miembro de comisin, afiliado simple';


--
-- Name: COLUMN user_union_affiliation.workplace_delegate; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_union_affiliation.workplace_delegate IS 'Si es delegado de planta/establecimiento';


--
-- Name: COLUMN user_union_affiliation.has_fuero_sindical; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_union_affiliation.has_fuero_sindical IS 'Si el empleado tiene fuero sindical (proteccin legal especial)';


--
-- Name: COLUMN user_union_affiliation.dues_payment_method; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_union_affiliation.dues_payment_method IS 'Mtodo de pago de cuota sindical';


--
-- Name: user_union_affiliation_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_union_affiliation_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_union_affiliation_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_union_affiliation_id_seq OWNED BY public.user_union_affiliation.id;


--
-- Name: user_vaccinations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_vaccinations (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    vaccine_name character varying(255) NOT NULL,
    vaccine_type character varying(100),
    dose_number integer,
    total_doses integer,
    date_administered date NOT NULL,
    next_dose_date date,
    administering_institution character varying(255),
    lot_number character varying(100),
    certificate_url text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_vaccinations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_vaccinations IS 'Historial de vacunacin';


--
-- Name: user_vaccinations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_vaccinations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_vaccinations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_vaccinations_id_seq OWNED BY public.user_vaccinations.id;


--
-- Name: user_work_history; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_work_history (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    company_name character varying(255) NOT NULL,
    "position" character varying(255) NOT NULL,
    start_date date NOT NULL,
    end_date date,
    currently_working boolean DEFAULT false,
    reason_for_leaving text,
    responsibilities text,
    supervisor_name character varying(255),
    supervisor_contact character varying(100),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_work_history; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_work_history IS 'Historial laboral del empleado';


--
-- Name: user_work_history_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_work_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_work_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_work_history_id_seq OWNED BY public.user_work_history.id;


--
-- Name: user_work_restrictions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_work_restrictions (
    id integer NOT NULL,
    user_id uuid NOT NULL,
    company_id integer NOT NULL,
    restriction_type character varying(100) NOT NULL,
    description text NOT NULL,
    start_date date NOT NULL,
    end_date date,
    is_permanent boolean DEFAULT false,
    medical_certificate_url text,
    issuing_doctor character varying(255),
    affects_current_role boolean DEFAULT false,
    accommodation_needed text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE user_work_restrictions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.user_work_restrictions IS 'Restricciones laborales';


--
-- Name: user_work_restrictions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.user_work_restrictions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: user_work_restrictions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.user_work_restrictions_id_seq OWNED BY public.user_work_restrictions.id;


--
-- Name: ux_discoveries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ux_discoveries (
    id integer NOT NULL,
    module_key character varying(100) NOT NULL,
    company_id integer,
    discovery_type character varying(50) NOT NULL,
    discovery_data jsonb NOT NULL,
    context character varying(100),
    screen_location character varying(100),
    validation_status character varying(20) DEFAULT 'discovered'::character varying,
    validation_count integer DEFAULT 1,
    last_seen_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    first_seen_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    works_correctly boolean,
    error_details text,
    test_execution_id character varying(100),
    browser_context jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: COLUMN ux_discoveries.discovery_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.ux_discoveries.discovery_data IS 'JSON con datos especficos del descubrimiento';


--
-- Name: COLUMN ux_discoveries.validation_count; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.ux_discoveries.validation_count IS 'Cuntas veces se re-descubri (mayor = ms confiable)';


--
-- Name: COLUMN ux_discoveries.works_correctly; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.ux_discoveries.works_correctly IS 'NULL = no testeado, true = funciona, false = error';


--
-- Name: ux_discoveries_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.ux_discoveries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: ux_discoveries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.ux_discoveries_id_seq OWNED BY public.ux_discoveries.id;


--
-- Name: v_active_kiosks; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_active_kiosks AS
SELECT
    NULL::integer AS id,
    NULL::character varying(100) AS name,
    NULL::text AS description,
    NULL::character varying(100) AS device_id,
    NULL::numeric(10,8) AS gps_lat,
    NULL::numeric(11,8) AS gps_lng,
    NULL::boolean AS is_configured,
    NULL::integer AS company_id,
    NULL::character varying(255) AS company_name,
    NULL::character varying(255) AS company_slug,
    NULL::timestamp without time zone AS created_at,
    NULL::bigint AS total_attendances;


--
-- Name: v_admin_tasks_dashboard; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_admin_tasks_dashboard AS
 SELECT t.id,
    t.task_code,
    t.task_type,
    t.priority,
    t.due_date,
    t.title,
    t.description,
    t.status,
    t.entity_type,
    t.entity_id,
    t.company_id,
    c.name AS company_name,
    t.assigned_role,
    t.created_at,
        CASE
            WHEN (t.due_date < CURRENT_TIMESTAMP) THEN 'OVERDUE'::text
            WHEN (t.due_date < (CURRENT_TIMESTAMP + '1 day'::interval)) THEN 'DUE_TODAY'::text
            WHEN (t.due_date < (CURRENT_TIMESTAMP + '3 days'::interval)) THEN 'DUE_SOON'::text
            ELSE 'ON_TIME'::text
        END AS urgency
   FROM (public.aponnt_admin_tasks t
     LEFT JOIN public.companies c ON ((t.company_id = c.company_id)))
  WHERE ((t.status)::text = ANY ((ARRAY['PENDING'::character varying, 'IN_PROGRESS'::character varying])::text[]))
  ORDER BY
        CASE t.priority
            WHEN 'URGENT'::text THEN 1
            WHEN 'HIGH'::text THEN 2
            WHEN 'MEDIUM'::text THEN 3
            WHEN 'LOW'::text THEN 4
            ELSE NULL::integer
        END, t.due_date;


--
-- Name: v_ai_detectable_violations; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_ai_detectable_violations AS
 SELECT code,
    name,
    name_short,
    icon,
    ai_model_tag,
    ai_confidence_threshold
   FROM public.hse_violation_catalog
  WHERE ((is_detectable_by_ai = true) AND (is_active = true))
  ORDER BY display_order;


--
-- Name: v_assigned_assets_full; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_assigned_assets_full AS
 SELECT eaa.id AS assignment_id,
    eaa.user_id,
    (((e."firstName")::text || ' '::text) || (e."lastName")::text) AS employee_name,
    e.company_id,
    bt.name AS benefit_name,
    eaa.asset_type,
    eaa.asset_brand,
    eaa.asset_model,
    eaa.asset_serial_number,
    eaa.asset_plate_number,
    eaa.asset_value,
    eaa.current_value,
    eaa.assignment_date,
    eaa.expected_return_date,
    eaa.actual_return_date,
    eaa.status,
    eaa.asset_condition,
    ac.contract_number,
    ac.contract_type,
    ac.status AS contract_status
   FROM (((((public.employee_assigned_assets eaa
     JOIN public.employee_benefits eb ON ((eaa.employee_benefit_id = eb.id)))
     JOIN public.company_benefit_policies cbp ON ((eb.company_benefit_policy_id = cbp.id)))
     JOIN public.benefit_types bt ON ((cbp.benefit_type_id = bt.id)))
     JOIN public.users e ON ((eaa.user_id = e.user_id)))
     LEFT JOIN public.asset_contracts ac ON ((ac.asset_assignment_id = eaa.id)));


--
-- Name: VIEW v_assigned_assets_full; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_assigned_assets_full IS 'Activos asignados con informacin completa de empleado y contrato';


--
-- Name: v_attendances_360; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_attendances_360 AS
 SELECT id,
    "UserId" AS user_id,
    company_id,
    date,
    "checkInTime" AS check_in,
    "checkOutTime" AS check_out,
    "checkInMethod",
    "checkOutMethod",
    "workingHours",
    status,
    notes,
    "BranchId" AS branch_id,
    kiosk_id,
    origin_type,
    break_out,
    break_in,
    "createdAt" AS created_at,
    "updatedAt" AS updated_at
   FROM public.attendances;


--
-- Name: v_candidates_pending_medical; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_candidates_pending_medical AS
 SELECT ja.id AS application_id,
    ja.company_id,
    ja.job_posting_id,
    jp.title AS job_title,
    jp.department_name,
    ja.candidate_first_name,
    ja.candidate_last_name,
    (((ja.candidate_first_name)::text || ' '::text) || (ja.candidate_last_name)::text) AS candidate_full_name,
    ja.candidate_email,
    ja.candidate_phone,
    ja.candidate_dni,
    ja.candidate_birth_date,
    ja.candidate_gender,
    ja.status,
    ja.admin_approved_at,
    ja.admin_approved_by,
    ja.notification_sent_to_medical,
    ja.notification_sent_at,
    ja.applied_at,
    EXTRACT(day FROM (now() - ja.admin_approved_at)) AS days_since_approval
   FROM (public.job_applications ja
     JOIN public.job_postings jp ON ((ja.job_posting_id = jp.id)))
  WHERE ((ja.status)::text = ANY ((ARRAY['aprobado_administrativo'::character varying, 'examen_pendiente'::character varying])::text[]))
  ORDER BY ja.admin_approved_at;


--
-- Name: VIEW v_candidates_pending_medical; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_candidates_pending_medical IS 'Vista para mdicos: candidatos pendientes de examen preocupacional';


--
-- Name: v_commercial_notifications; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_commercial_notifications AS
 SELECT n.id,
    n.thread_id,
    n.company_id,
    c.name AS company_name,
    c.contact_email AS company_email,
    n.direction,
    n.origin_type,
    n.origin_name,
    n.recipient_type,
    n.recipient_name,
    n.external_email,
    n.external_name,
    n.category,
    n.module,
    n.notification_type,
    n.priority,
    n.title,
    n.message,
    n.short_message,
    n.trace_id,
    n.vendor_id,
    concat(s.first_name, ' ', s.last_name) AS vendor_name,
    s.email AS vendor_email,
    n.aponnt_department,
    n.is_read,
    n.read_at,
    n.requires_action,
    n.action_status,
    n.action_deadline,
    n.response_required_by,
    n.channels,
    n.sent_via_email,
    n.email_sent_at,
    n.metadata,
    n.related_entity_type,
    n.related_entity_id,
    n.created_at,
    n.updated_at
   FROM ((public.unified_notifications n
     LEFT JOIN public.companies c ON ((n.company_id = c.company_id)))
     LEFT JOIN public.aponnt_staff s ON ((n.vendor_id = s.staff_id)))
  WHERE ((n.is_commercial = true) AND (n.deleted_at IS NULL))
  ORDER BY n.created_at DESC;


--
-- Name: VIEW v_commercial_notifications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_commercial_notifications IS 'Vista de notificaciones del flujo comercial APONNT  Empresa';


--
-- Name: v_companies_with_imap; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_companies_with_imap AS
 SELECT cec.id AS config_id,
    cec.company_id,
    c.name AS company_name,
    c.slug AS company_slug,
    cec.imap_host,
    cec.imap_port,
    cec.imap_user,
    cec.imap_folder,
    cec.imap_last_poll,
    cec.imap_last_uid,
    cec.poll_interval_seconds,
    cec.smtp_from_email,
    cec.bidirectional_enabled
   FROM (public.company_email_config cec
     JOIN public.companies c ON ((cec.company_id = c.company_id)))
  WHERE ((cec.imap_enabled = true) AND (cec.bidirectional_enabled = true) AND (cec.is_active = true) AND (c.is_active = true));


--
-- Name: v_concept_dependencies_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_concept_dependencies_summary AS
 SELECT cd.concept_id,
    ptc.concept_name,
    cd.company_id,
    count(cd.id) AS total_dependencies,
    string_agg((dep.dependency_name)::text, ', '::text ORDER BY cd.evaluation_order) AS dependencies_list
   FROM ((public.concept_dependencies cd
     JOIN public.company_dependencies dep ON ((dep.id = cd.dependency_id)))
     JOIN public.payroll_template_concepts ptc ON ((ptc.id = cd.concept_id)))
  WHERE (cd.is_active = true)
  GROUP BY cd.concept_id, ptc.concept_name, cd.company_id;


--
-- Name: v_concept_types_with_help; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_concept_types_with_help AS
 SELECT pct.id,
    pct.type_code,
    pct.type_name,
    pct.description,
    pcc.classification_code,
    pcc.classification_name,
    pcc.sign AS monetary_sign,
    pct.is_deduction,
    pct.is_employer_cost,
    pct.is_taxable,
    pct.is_remunerative,
    pct.is_mandatory,
    pct.is_pre_tax,
    pct.is_proportional_to_time,
    pct.calculation_base_type,
    pct.default_employee_rate,
    pct.default_employer_rate,
    pct.rate_ceiling,
    pct.icon_name,
    pct.color_hex,
    pct.help_tooltip,
    pct.help_detailed,
    pct.legal_reference,
    pct.names_by_locale,
    pct.examples_by_country,
    pct.display_order,
    pct.is_active,
    pct.country_id,
    pc.country_code,
    pc.country_name
   FROM ((public.payroll_concept_types pct
     LEFT JOIN public.payroll_concept_classifications pcc ON ((pct.classification_id = pcc.id)))
     LEFT JOIN public.payroll_countries pc ON ((pct.country_id = pc.id)))
  WHERE (pct.is_active = true);


--
-- Name: VIEW v_concept_types_with_help; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_concept_types_with_help IS 'Vista de tipos de concepto con toda la ayuda contextual';


--
-- Name: v_department_wellness; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_department_wellness AS
 SELECT u.company_id,
    u.department_id,
    d.name AS department_name,
    count(DISTINCT e.user_id) AS users_analyzed,
    avg(e.wellness_score) AS avg_wellness_score,
    avg(e.fatigue_score) AS avg_fatigue_score,
    avg(e.stress_score) AS avg_stress_score,
    avg(e.emotion_happiness) AS avg_happiness,
    date_trunc('day'::text, e.scan_timestamp) AS analysis_date
   FROM ((public.biometric_emotional_analysis e
     JOIN public.users u ON (((e.user_id = u.user_id) AND (e.company_id = u.company_id))))
     LEFT JOIN public.departments d ON ((u.department_id = d.id)))
  WHERE (u.department_id IS NOT NULL)
  GROUP BY u.company_id, u.department_id, d.name, (date_trunc('day'::text, e.scan_timestamp))
 HAVING (count(DISTINCT e.user_id) >= 10);


--
-- Name: v_email_configurations_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_email_configurations_summary AS
 SELECT c.company_id,
    c.name AS company_name,
    ec.institutional_email,
    ec.is_verified,
    ec.is_active,
    ec.current_daily_count,
    ec.daily_limit,
    ec.current_monthly_count,
    ec.monthly_limit,
    ec.last_error,
    ec.error_count,
    ( SELECT count(*) AS count
           FROM public.user_emails ue
          WHERE ((ue.company_id = c.company_id) AND (ue.is_active = true))) AS total_employee_emails,
    ( SELECT count(*) AS count
           FROM public.email_logs el
          WHERE (((el.sender_id)::integer = c.company_id) AND ((el.sender_type)::text = 'company'::text) AND (el.created_at >= CURRENT_DATE))) AS emails_sent_today
   FROM (public.companies c
     LEFT JOIN public.email_configurations ec ON (((c.company_id = ec.company_id) AND (ec.is_active = true))));


--
-- Name: v_email_stats_by_company; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_email_stats_by_company AS
 SELECT company_id,
    company_name,
    total_sent,
    total_delivered,
    total_bounced,
    total_opened,
    round((((total_delivered)::numeric / (NULLIF(total_sent, 0))::numeric) * (100)::numeric), 2) AS delivery_rate,
    round((((total_opened)::numeric / (NULLIF(total_delivered, 0))::numeric) * (100)::numeric), 2) AS open_rate
   FROM ( SELECT c.company_id,
            c.name AS company_name,
            count(*) FILTER (WHERE ((el.status)::text = ANY ((ARRAY['sent'::character varying, 'delivered'::character varying, 'opened'::character varying])::text[]))) AS total_sent,
            count(*) FILTER (WHERE ((el.status)::text = ANY ((ARRAY['delivered'::character varying, 'opened'::character varying])::text[]))) AS total_delivered,
            count(*) FILTER (WHERE ((el.status)::text = 'bounced'::text)) AS total_bounced,
            count(*) FILTER (WHERE ((el.status)::text = 'opened'::text)) AS total_opened
           FROM (public.companies c
             LEFT JOIN public.email_logs el ON ((((el.sender_id)::integer = c.company_id) AND ((el.sender_type)::text = 'company'::text))))
          GROUP BY c.company_id, c.name) stats;


--
-- Name: v_employee_benefits_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_employee_benefits_summary AS
 SELECT eb.user_id,
    (((e."firstName")::text || ' '::text) || (e."lastName")::text) AS employee_name,
    e.company_id,
    c.name AS company_name,
    bt.code AS benefit_code,
    bt.name AS benefit_name,
    bt.category,
    eb.status,
    eb.assigned_amount,
    eb.assigned_quantity,
    eb.effective_from,
    eb.effective_until,
    eb.has_required_documents,
        CASE
            WHEN ((eb.effective_until IS NOT NULL) AND (eb.effective_until < CURRENT_DATE)) THEN 'Vencido'::text
            WHEN ((eb.effective_until IS NOT NULL) AND ((eb.effective_until - CURRENT_DATE) <= 30)) THEN 'Por vencer'::text
            ELSE 'Vigente'::text
        END AS expiration_status
   FROM ((((public.employee_benefits eb
     JOIN public.users e ON ((eb.user_id = e.user_id)))
     JOIN public.companies c ON ((eb.company_id = c.company_id)))
     JOIN public.company_benefit_policies cbp ON ((eb.company_benefit_policy_id = cbp.id)))
     JOIN public.benefit_types bt ON ((cbp.benefit_type_id = bt.id)));


--
-- Name: VIEW v_employee_benefits_summary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_employee_benefits_summary IS 'Resumen de beneficios activos por empleado';


--
-- Name: v_employee_loan_status; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_employee_loan_status AS
 SELECT l.company_id,
    l.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    u.legajo,
    count(*) FILTER (WHERE ((l.status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying])::text[]))) AS active_loans,
    COALESCE(sum(l.hours_borrowed) FILTER (WHERE ((l.status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying])::text[]))), (0)::numeric) AS total_borrowed,
    COALESCE(sum(l.hours_repaid) FILTER (WHERE ((l.status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying])::text[]))), (0)::numeric) AS total_repaid,
    COALESCE(sum(l.balance_remaining) FILTER (WHERE ((l.status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying])::text[]))), (0)::numeric) AS current_debt,
    min(l.borrowed_at) FILTER (WHERE ((l.status)::text = ANY ((ARRAY['active'::character varying, 'partial'::character varying])::text[]))) AS oldest_loan_date,
    count(*) FILTER (WHERE ((l.status)::text = 'repaid'::text)) AS loans_repaid
   FROM (public.hour_bank_loans l
     JOIN public.users u ON ((u.user_id = l.user_id)))
  GROUP BY l.company_id, l.user_id, u."firstName", u."lastName", u.legajo;


--
-- Name: v_employee_procedures; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_employee_procedures AS
 SELECT u.user_id,
    u."employeeId" AS employee_id,
    u.company_id,
    p.id AS procedure_id,
    p.code,
    p.title,
    p.type,
    p.version_label,
    p.status,
    p.effective_date,
    p.is_critical,
    pa.status AS acknowledgement_status,
    pa.acknowledged_at,
    pa.notification_sent_at,
    pr.scope_type
   FROM ((((public.users u
     JOIN public.organizational_positions op ON ((u.organizational_position_id = op.id)))
     JOIN public.procedure_roles pr ON ((pr.organizational_position_id = op.id)))
     JOIN public.procedures p ON ((p.id = pr.procedure_id)))
     LEFT JOIN public.procedure_acknowledgements pa ON (((pa.procedure_id = p.id) AND (pa.user_id = u.user_id) AND (pa.procedure_version_id = ( SELECT procedure_versions.id
           FROM public.procedure_versions
          WHERE ((procedure_versions.procedure_id = p.id) AND ((procedure_versions.status)::text = 'current'::text))
         LIMIT 1)))))
  WHERE (((p.status)::text = 'published'::text) AND (u.is_active = true));


--
-- Name: v_entities_period_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_entities_period_summary AS
 SELECT pe.entity_id,
    pe.entity_code,
    pe.entity_name,
    pec.category_name,
    pec.flow_direction,
    pec.color_hex,
    es.company_id,
    es.period_year,
    es.period_month,
    es.total_employees,
    es.total_employer_contribution,
    es.total_employee_contribution,
    es.grand_total,
    es.status,
    (es.paid_at IS NOT NULL) AS is_paid
   FROM ((public.payroll_entities pe
     LEFT JOIN public.payroll_entity_categories pec ON ((pe.category_id = pec.id)))
     LEFT JOIN public.payroll_entity_settlements es ON ((pe.entity_id = es.entity_id)));


--
-- Name: v_entity_settlements_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_entity_settlements_summary AS
 SELECT es.settlement_id,
    es.company_id,
    c.name AS company_name,
    es.entity_id,
    pe.entity_code,
    pe.entity_name,
    pe.entity_type,
    es.period_year,
    es.period_month,
    es.period_start,
    es.period_end,
    es.settlement_code,
    es.total_employees,
    es.total_employer_contribution,
    es.total_employee_contribution,
    es.grand_total,
    es.status,
    es.generated_at,
    es.approved_at,
    es.paid_at,
    es.payment_reference
   FROM ((public.payroll_entity_settlements es
     JOIN public.companies c ON ((es.company_id = c.company_id)))
     JOIN public.payroll_entities pe ON ((es.entity_id = pe.entity_id)));


--
-- Name: v_expiring_documents; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_expiring_documents AS
 SELECT edd.id,
    edd.company_id,
    c.name AS company_name,
    edd.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    u.email AS employee_email,
    cd.dependency_name,
    edd.family_member_name,
    edd.expiration_date,
    edd.days_until_expiration,
    edd.status,
    (cd.config -> 'notification_days'::text) AS notification_days
   FROM (((public.employee_dependency_documents edd
     JOIN public.companies c ON ((c.company_id = edd.company_id)))
     JOIN public.users u ON ((u.user_id = edd.user_id)))
     JOIN public.company_dependencies cd ON ((cd.id = edd.dependency_id)))
  WHERE ((edd.is_current = true) AND (edd.expiration_date IS NOT NULL) AND (edd.expiration_date <= (CURRENT_DATE + '30 days'::interval)) AND (edd.expiration_date >= CURRENT_DATE))
  ORDER BY edd.expiration_date;


--
-- Name: v_hr_security_alerts; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_hr_security_alerts AS
 SELECT 'unauthorized_access'::text AS alert_type,
    ua.id,
    ua.company_id,
    ua.employee_id,
    ua.employee_name,
    ua.employee_department,
    k.name AS kiosk_name,
    ua.attempt_type,
    ua.reason,
    ua."timestamp",
    ua.requires_hr_review,
    ua.reviewed_by,
    ua.reviewed_at
   FROM (public.unauthorized_access_attempts ua
     LEFT JOIN public.kiosks k ON ((ua.kiosk_id = k.id)))
  WHERE (ua.requires_hr_review = true)
UNION ALL
 SELECT 'password_suspicious'::text AS alert_type,
    pa.id,
    pa.company_id,
    pa.employee_id,
    concat(u."firstName", ' ', u."lastName") AS employee_name,
    d.name AS employee_department,
    k.name AS kiosk_name,
    'password'::character varying AS attempt_type,
    'suspicious_photo'::character varying AS reason,
    pa."timestamp",
    pa.requires_hr_review,
    NULL::uuid AS reviewed_by,
    NULL::timestamp without time zone AS reviewed_at
   FROM (((public.password_auth_attempts pa
     LEFT JOIN public.users u ON ((pa.employee_id = u.user_id)))
     LEFT JOIN public.departments d ON ((u.department_id = d.id)))
     LEFT JOIN public.kiosks k ON ((pa.kiosk_id = k.id)))
  WHERE (pa.requires_hr_review = true)
  ORDER BY 10 DESC;


--
-- Name: v_hse_pending_cases; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_hse_pending_cases AS
 SELECT c.id,
    c.case_number,
    c.company_id,
    c.employee_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    c.case_type,
    c.severity,
    c.investigation_status AS status,
    c.indicated_violations AS reported_violations,
    c.correlation_score,
    c.created_at,
    c.assigned_to,
    EXTRACT(day FROM (now() - c.created_at)) AS days_open
   FROM (public.hse_cases c
     LEFT JOIN public.users u ON ((c.employee_id = u.user_id)))
  WHERE ((c.investigation_status)::text = ANY ((ARRAY['PENDING'::character varying, 'ASSIGNED'::character varying, 'IN_PROGRESS'::character varying, 'AWAITING_INFO'::character varying])::text[]))
  ORDER BY
        CASE c.severity
            WHEN 'MUY_GRAVE'::text THEN 1
            WHEN 'GRAVE'::text THEN 2
            WHEN 'MODERADO'::text THEN 3
            ELSE 4
        END, c.created_at;


--
-- Name: v_job_applications_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_job_applications_summary AS
 SELECT company_id,
    count(*) AS total_applications,
    count(*) FILTER (WHERE ((status)::text = 'nuevo'::text)) AS nuevas,
    count(*) FILTER (WHERE ((status)::text = 'revision'::text)) AS en_revision,
    count(*) FILTER (WHERE ((status)::text = ANY ((ARRAY['entrevista_pendiente'::character varying, 'entrevista_realizada'::character varying])::text[]))) AS en_entrevista,
    count(*) FILTER (WHERE ((status)::text = 'aprobado_administrativo'::text)) AS aprobadas_admin,
    count(*) FILTER (WHERE ((status)::text = ANY ((ARRAY['examen_pendiente'::character varying, 'examen_realizado'::character varying])::text[]))) AS en_examen_medico,
    count(*) FILTER (WHERE ((status)::text = 'apto'::text)) AS aptos,
    count(*) FILTER (WHERE ((status)::text = 'contratado'::text)) AS contratados,
    count(*) FILTER (WHERE ((status)::text = 'rechazado'::text)) AS rechazados,
    count(*) FILTER (WHERE ((status)::text = 'no_apto'::text)) AS no_aptos
   FROM public.job_applications
  GROUP BY company_id;


--
-- Name: v_medical_selectable_violations; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_medical_selectable_violations AS
 SELECT code,
    category,
    name,
    name_short,
    icon,
    related_cie10_codes,
    body_locations
   FROM public.hse_violation_catalog
  WHERE ((is_medical_selectable = true) AND (is_active = true))
  ORDER BY category, display_order;


--
-- Name: v_notification_pending_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_notification_pending_summary AS
 SELECT recipient_id AS employee_id,
    company_id,
    count(*) FILTER (WHERE ((requires_response = true) AND (responded_at IS NULL))) AS pending_responses,
    count(*) FILTER (WHERE ((deadline_at < now()) AND (responded_at IS NULL))) AS overdue_responses,
    count(*) FILTER (WHERE (read_at IS NULL)) AS unread_messages,
    count(*) FILTER (WHERE ((escalation_status)::text = 'escalated'::text)) AS escalated_count,
    count(*) FILTER (WHERE (sla_breach = true)) AS sla_breaches,
    max(created_at) AS last_notification_at
   FROM public.notification_messages m
  WHERE (is_deleted = false)
  GROUP BY recipient_id, company_id;


--
-- Name: VIEW v_notification_pending_summary; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_notification_pending_summary IS 'Resumen de notificaciones pendientes por empleado';


--
-- Name: v_oh_active_screenings; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_oh_active_screenings AS
 SELECT s.id,
    s.company_id,
    (((s.candidate_first_name)::text || ' '::text) || (s.candidate_last_name)::text) AS candidate_name,
    s.candidate_email,
    s.position_title,
    st.code AS screening_type_code,
    (st.name_i18n ->> 'en'::text) AS screening_type_name,
    s.scheduled_date,
    s.overall_result,
    s.status,
    s.country_code,
    s.approved_for_hiring,
    s.created_at,
        CASE
            WHEN (s.valid_until < CURRENT_DATE) THEN 'expired'::text
            WHEN (s.valid_until < (CURRENT_DATE + '30 days'::interval)) THEN 'expiring_soon'::text
            ELSE 'valid'::text
        END AS validity_status
   FROM (public.oh_pre_employment_screenings s
     LEFT JOIN public.oh_screening_types st ON ((s.screening_type_id = st.id)))
  WHERE ((s.deleted_at IS NULL) AND ((s.status)::text <> 'cancelled'::text));


--
-- Name: VIEW v_oh_active_screenings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_oh_active_screenings IS 'Vista de screenings activos con informacin bsica';


--
-- Name: v_partner_commission_dashboard; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_partner_commission_dashboard AS
 SELECT p.id AS partner_id,
    (((p.first_name)::text || ' '::text) || (p.last_name)::text) AS partner_name,
    p.specialty,
    p.email,
    pc.commission_type,
    pc.percentage AS current_percentage,
    COALESCE(pcs_current.total_cases, 0) AS cases_this_month,
    COALESCE(pcs_current.total_billable, (0)::numeric) AS billable_this_month,
    COALESCE(pcs_current.total_commission, (0)::numeric) AS commission_this_month,
    COALESCE(pcs_current.pending_amount, (0)::numeric) AS pending_this_month,
    COALESCE(( SELECT sum(partner_commission_transactions.commission_amount) AS sum
           FROM public.partner_commission_transactions
          WHERE ((partner_commission_transactions.partner_id = p.id) AND ((partner_commission_transactions.status)::text = 'pending'::text))), (0)::numeric) AS total_pending,
    COALESCE(( SELECT sum(partner_commission_transactions.commission_amount) AS sum
           FROM public.partner_commission_transactions
          WHERE ((partner_commission_transactions.partner_id = p.id) AND ((partner_commission_transactions.status)::text = 'paid'::text))), (0)::numeric) AS total_paid
   FROM ((public.partners p
     LEFT JOIN public.partner_commissions pc ON (((p.id = pc.partner_id) AND (pc.is_active = true))))
     LEFT JOIN public.partner_commission_summaries pcs_current ON (((p.id = pcs_current.partner_id) AND ((pcs_current.year)::numeric = EXTRACT(year FROM CURRENT_DATE)) AND ((pcs_current.month)::numeric = EXTRACT(month FROM CURRENT_DATE)))))
  WHERE (p.is_active = true);


--
-- Name: v_payroll_entities_with_category; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_payroll_entities_with_category AS
 SELECT pe.entity_id,
    pe.company_id,
    pe.country_id,
    pc.country_code,
    pc.country_name,
    pe.category_id,
    pec.category_code,
    pec.category_name,
    pec.flow_direction,
    pec.icon_name,
    pec.color_hex,
    pec.consolidation_group,
    pe.entity_code,
    pe.entity_name,
    pe.entity_short_name,
    pe.entity_type,
    pe.tax_id,
    pe.legal_name,
    pe.bank_name,
    pe.bank_cbu,
    pe.presentation_format,
    pe.is_government,
    pe.is_mandatory,
    pe.is_active,
    pe.settings
   FROM ((public.payroll_entities pe
     LEFT JOIN public.payroll_countries pc ON ((pe.country_id = pc.id)))
     LEFT JOIN public.payroll_entity_categories pec ON ((pe.category_id = pec.id)))
  WHERE (pe.is_active = true);


--
-- Name: VIEW v_payroll_entities_with_category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_payroll_entities_with_category IS 'Vista de entidades con datos de categora para UI';


--
-- Name: v_payslip_templates_full; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_payslip_templates_full AS
 SELECT pt.id,
    pt.country_id,
    pt.company_id,
    pt.template_code,
    pt.template_name,
    pt.description,
    pt.layout_config,
    pt.required_fields,
    pt.legal_disclaimers,
    pt.logo_url,
    pt.signature_config,
    pt.is_default,
    pt.is_system,
    pt.is_active,
    pt.created_at,
    pt.updated_at,
    pc.country_code,
    pc.country_name,
    c.name AS company_name
   FROM ((public.payroll_payslip_templates pt
     LEFT JOIN public.payroll_countries pc ON ((pt.country_id = pc.id)))
     LEFT JOIN public.companies c ON ((pt.company_id = c.company_id)))
  WHERE (pt.is_active = true);


--
-- Name: v_pending_hr_approvals; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_pending_hr_approvals AS
 SELECT r.id AS request_id,
    r.company_id,
    r.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    u.legajo,
    d.name AS department_name,
    r.hours_requested,
    r.scheduled_date,
    r.redemption_type,
    r.reason,
    r.balance_at_request,
    r.supervisor_id,
    (((sup."firstName")::text || ' '::text) || (sup."lastName")::text) AS supervisor_name,
    r.supervisor_decision_at,
    r.supervisor_comments,
    r.created_at AS requested_at
   FROM (((public.hour_bank_redemption_requests r
     JOIN public.users u ON ((u.user_id = r.user_id)))
     LEFT JOIN public.departments d ON ((d.id = u.department_id)))
     LEFT JOIN public.users sup ON ((sup.user_id = r.supervisor_id)))
  WHERE ((r.status)::text = 'approved_supervisor'::text);


--
-- Name: v_pending_inbound_emails; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_pending_inbound_emails AS
 SELECT id,
    message_id,
    in_reply_to,
    references_header,
    from_email,
    from_name,
    to_email,
    to_name,
    cc_emails,
    subject,
    body_text,
    body_html,
    attachments,
    raw_headers,
    linked_notification_id,
    linked_thread_id,
    linked_group_id,
    linked_company_id,
    linked_user_id,
    processing_status,
    processing_error,
    processed_at,
    created_message_id,
    response_sent,
    response_sent_at,
    email_provider,
    provider_event_id,
    spam_score,
    is_auto_reply,
    detected_language,
    created_at,
    updated_at,
        CASE
            WHEN (linked_thread_id IS NOT NULL) THEN 'has_thread'::text
            WHEN (linked_notification_id IS NOT NULL) THEN 'has_notification'::text
            WHEN (in_reply_to IS NOT NULL) THEN 'has_reference'::text
            ELSE 'no_reference'::text
        END AS linkage_status
   FROM public.email_inbound_log eil
  WHERE ((processing_status)::text = 'PENDING'::text)
  ORDER BY created_at;


--
-- Name: v_pending_pre_invoices; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_pending_pre_invoices AS
 SELECT pi.id,
    pi.pre_invoice_code,
    pi.company_id,
    c.name AS company_name,
    c.slug AS company_slug,
    pi.cliente_razon_social,
    pi.cliente_cuit,
    pi.periodo_desde,
    pi.periodo_hasta,
    pi.subtotal,
    pi.iva_21,
    pi.total,
    pi.status,
    pi.created_at,
    pi.contract_id,
    con.contract_code AS contract_number
   FROM ((public.aponnt_pre_invoices pi
     JOIN public.companies c ON ((pi.company_id = c.company_id)))
     LEFT JOIN public.contracts con ON ((pi.contract_id = con.id)))
  WHERE ((pi.status)::text = ANY ((ARRAY['PENDING_REVIEW'::character varying, 'APPROVED'::character varying])::text[]))
  ORDER BY
        CASE pi.status
            WHEN 'PENDING_REVIEW'::text THEN 1
            WHEN 'APPROVED'::text THEN 2
            ELSE NULL::integer
        END, pi.created_at DESC;


--
-- Name: v_pending_supervisor_approvals; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_pending_supervisor_approvals AS
 SELECT r.id AS request_id,
    r.company_id,
    r.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    u.legajo,
    d.name AS department_name,
    r.hours_requested,
    r.scheduled_date,
    r.redemption_type,
    r.reason,
    r.balance_at_request,
    r.created_at AS requested_at,
    r.supervisor_id,
    (((sup."firstName")::text || ' '::text) || (sup."lastName")::text) AS supervisor_name
   FROM (((public.hour_bank_redemption_requests r
     JOIN public.users u ON ((u.user_id = r.user_id)))
     LEFT JOIN public.departments d ON ((d.id = u.department_id)))
     LEFT JOIN public.users sup ON ((sup.user_id = r.supervisor_id)))
  WHERE ((r.status)::text = 'pending_supervisor'::text);


--
-- Name: v_procedure_hierarchy; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_procedure_hierarchy AS
 SELECT p.id,
    p.company_id,
    p.code,
    p.title,
    p.type,
    p.hierarchy_level,
    p.parent_id,
    parent.code AS parent_code,
    parent.title AS parent_title,
    p.status,
    p.hierarchy_path,
    ( SELECT count(*) AS count
           FROM public.procedures c
          WHERE (c.parent_id = p.id)) AS children_count,
    ( SELECT count(*) AS count
           FROM public.get_procedure_children(p.id, true) get_procedure_children(id, code, title, type, hierarchy_level, parent_id, status, depth)) AS descendants_count,
        CASE p.hierarchy_level
            WHEN 1 THEN ''::text
            WHEN 2 THEN ''::text
            WHEN 3 THEN ''::text
            WHEN 4 THEN ''::text
            ELSE NULL::text
        END AS icon,
        CASE p.hierarchy_level
            WHEN 1 THEN 'Poltica'::text
            WHEN 2 THEN 'Manual'::text
            WHEN 3 THEN 'Procedimiento'::text
            WHEN 4 THEN 'Instructivo'::text
            ELSE NULL::text
        END AS level_name,
    p.created_at,
    p.updated_at
   FROM (public.procedures p
     LEFT JOIN public.procedures parent ON ((p.parent_id = parent.id)));


--
-- Name: v_sent_notifications_awaiting_response; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_sent_notifications_awaiting_response AS
 SELECT sender_id AS employee_id,
    company_id,
    count(*) FILTER (WHERE ((requires_response = true) AND (responded_at IS NULL))) AS awaiting_response,
    count(*) FILTER (WHERE ((deadline_at < now()) AND (responded_at IS NULL))) AS overdue_no_response,
    count(*) FILTER (WHERE ((escalation_status)::text = 'escalated'::text)) AS escalated_count
   FROM public.notification_messages m
  WHERE ((is_deleted = false) AND (requires_response = true))
  GROUP BY sender_id, company_id;


--
-- Name: VIEW v_sent_notifications_awaiting_response; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_sent_notifications_awaiting_response IS 'Notificaciones enviadas que esperan respuesta';


--
-- Name: v_staff_pyramid_percentage; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_staff_pyramid_percentage AS
 SELECT s.staff_id,
    s.first_name,
    s.last_name,
    s.role_id,
    r.role_code,
    r.role_name,
    r.pyramid_commission_percentage AS role_default_percentage,
    s.pyramid_commission_percentage_override AS staff_override_percentage,
    COALESCE(s.pyramid_commission_percentage_override, r.pyramid_commission_percentage, 0.0) AS effective_pyramid_percentage,
    s.is_active
   FROM (public.aponnt_staff s
     JOIN public.aponnt_staff_roles r ON ((s.role_id = r.role_id)));


--
-- Name: VIEW v_staff_pyramid_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_staff_pyramid_percentage IS 'Vista que calcula el % piramidal efectivo de cada staff: usa override si existe, sino usa % del rol, sino 0%';


--
-- Name: v_template_concepts_with_entity; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_template_concepts_with_entity AS
 SELECT ptc.id AS concept_id,
    ptc.template_id,
    pt.template_name,
    pt.company_id,
    ptc.concept_code,
    ptc.concept_name,
    ptc.short_name,
    ptc.calculation_type,
    ptc.default_value,
    pct.type_code AS concept_type_code,
    pct.type_name AS concept_type_name,
    pct.is_deduction,
    pct.is_employer_cost,
    pct.is_taxable,
    pct.affects_gross,
    ptc.entity_id,
    pe.entity_code,
    pe.entity_name,
    pec.category_code AS entity_category_code,
    pec.category_name AS entity_category_name,
    pec.flow_direction AS entity_flow,
    pec.color_hex AS entity_color,
    ptc.entity_label,
    ptc.entity_account_code,
    ptc.display_order,
    ptc.is_active
   FROM ((((public.payroll_template_concepts ptc
     JOIN public.payroll_templates pt ON ((ptc.template_id = pt.id)))
     JOIN public.payroll_concept_types pct ON ((ptc.concept_type_id = pct.id)))
     LEFT JOIN public.payroll_entities pe ON ((ptc.entity_id = pe.entity_id)))
     LEFT JOIN public.payroll_entity_categories pec ON ((pe.category_id = pec.id)));


--
-- Name: VIEW v_template_concepts_with_entity; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_template_concepts_with_entity IS 'Vista de conceptos de plantilla con datos de entidad para UI';


--
-- Name: v_user_socioeconomic_summary; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_user_socioeconomic_summary AS
 SELECT user_id,
    company_id,
    ((("firstName")::text || ' '::text) || ("lastName")::text) AS full_name,
    ((COALESCE(street_address, ''::character varying))::text ||
        CASE
            WHEN (floor_apt IS NOT NULL) THEN (' '::text || (floor_apt)::text)
            ELSE ''::text
        END) AS address_line1,
    COALESCE(neighborhood, ''::character varying) AS neighborhood,
    ((COALESCE(city, ''::character varying))::text ||
        CASE
            WHEN (province IS NOT NULL) THEN (', '::text || (province)::text)
            ELSE ''::text
        END) AS city_province,
    COALESCE(country, 'Argentina'::character varying) AS country,
    residence_type,
    housing_type,
    household_size,
    dependents_count,
    ( SELECT count(*) AS count
           FROM public.user_household_members m
          WHERE ((m.user_id = u.user_id) AND (m.is_active = true))) AS total_household_members,
    ( SELECT count(*) AS count
           FROM public.user_emergency_contacts e
          WHERE ((e.user_id = u.user_id) AND (e.is_active = true))) AS emergency_contacts_count
   FROM public.users u
  WHERE (is_active = true);


--
-- Name: v_vendor_notifications; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_vendor_notifications AS
 SELECT n.id,
    n.thread_id,
    n.company_id,
    c.name AS company_name,
    n.direction,
        CASE
            WHEN ((n.direction)::text = 'outbound'::text) THEN 'Mensaje de empresa'::text
            WHEN ((n.direction)::text = 'inbound'::text) THEN 'Enviado por ti'::text
            ELSE 'Interno'::text
        END AS direction_label,
    n.notification_type,
    n.priority,
    n.title,
    n.message,
    n.trace_id,
    n.vendor_id,
    n.is_read,
    n.requires_action,
    n.action_status,
    n.response_required_by,
    (n.metadata ->> 'phase'::text) AS workflow_phase,
    (n.metadata ->> 'budget_code'::text) AS budget_code,
    (n.metadata ->> 'contract_code'::text) AS contract_code,
    (n.metadata ->> 'invoice_number'::text) AS invoice_number,
    n.created_at,
    ( SELECT count(*) AS count
           FROM public.unified_notifications sub
          WHERE ((sub.thread_id = n.thread_id) AND (sub.is_read = false))) AS unread_in_thread
   FROM (public.unified_notifications n
     LEFT JOIN public.companies c ON ((n.company_id = c.company_id)))
  WHERE ((n.is_commercial = true) AND (n.vendor_id IS NOT NULL) AND (n.deleted_at IS NULL))
  ORDER BY n.created_at DESC;


--
-- Name: VIEW v_vendor_notifications; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.v_vendor_notifications IS 'Vista de notificaciones para vendedores en panel-administrativo';


--
-- Name: v_wellness_trends; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.v_wellness_trends AS
 SELECT company_id,
    date_trunc('hour'::text, scan_timestamp) AS hour_bucket,
    time_of_day,
    count(*) AS scans_count,
    avg(wellness_score) AS avg_wellness,
    avg(fatigue_score) AS avg_fatigue,
    avg(stress_score) AS avg_stress
   FROM public.biometric_emotional_analysis
  WHERE (scan_timestamp >= (now() - '7 days'::interval))
  GROUP BY company_id, (date_trunc('hour'::text, scan_timestamp)), time_of_day
  ORDER BY company_id, (date_trunc('hour'::text, scan_timestamp)) DESC;


--
-- Name: vacation_configurations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vacation_configurations (
    id integer NOT NULL,
    company_id integer NOT NULL,
    vacation_interruptible boolean DEFAULT true,
    min_continuous_days integer DEFAULT 7,
    max_fractions integer DEFAULT 3,
    auto_scheduling_enabled boolean DEFAULT true,
    min_advance_notice_days integer DEFAULT 15,
    max_simultaneous_percentage integer DEFAULT 30,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE vacation_configurations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.vacation_configurations IS 'Configuracin general de vacaciones por empresa';


--
-- Name: COLUMN vacation_configurations.vacation_interruptible; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_configurations.vacation_interruptible IS 'Si las vacaciones pueden ser interrumpidas';


--
-- Name: COLUMN vacation_configurations.min_continuous_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_configurations.min_continuous_days IS 'Mnimo de das continuos obligatorios (LCT Argentina: 7)';


--
-- Name: COLUMN vacation_configurations.max_fractions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_configurations.max_fractions IS 'Mximo de fracciones permitidas por perodo';


--
-- Name: COLUMN vacation_configurations.max_simultaneous_percentage; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_configurations.max_simultaneous_percentage IS 'Porcentaje mximo de empleados de vacaciones simultneamente';


--
-- Name: vacation_configurations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vacation_configurations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vacation_configurations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vacation_configurations_id_seq OWNED BY public.vacation_configurations.id;


--
-- Name: vacation_requests; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vacation_requests (
    id integer NOT NULL,
    company_id integer NOT NULL,
    user_id uuid NOT NULL,
    request_type character varying(50) DEFAULT 'vacation'::character varying,
    extraordinary_license_id integer,
    start_date date NOT NULL,
    end_date date NOT NULL,
    total_days integer NOT NULL,
    reason text,
    status character varying(50) DEFAULT 'pending'::character varying,
    approved_by uuid,
    approval_date timestamp with time zone,
    approval_comments text,
    source character varying(50) DEFAULT 'manual'::character varying,
    coverage_assignments jsonb DEFAULT '[]'::jsonb,
    supporting_documents jsonb DEFAULT '[]'::jsonb,
    is_auto_generated boolean DEFAULT false,
    auto_generation_data jsonb,
    compatibility_score numeric(5,2),
    conflicts jsonb DEFAULT '[]'::jsonb,
    modification_history jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT check_dates CHECK ((end_date >= start_date)),
    CONSTRAINT vacation_requests_request_type_check CHECK (((request_type)::text = ANY ((ARRAY['vacation'::character varying, 'personal_leave'::character varying, 'sick_leave'::character varying, 'maternity'::character varying, 'paternity'::character varying, 'bereavement'::character varying, 'study'::character varying, 'other'::character varying])::text[]))),
    CONSTRAINT vacation_requests_source_check CHECK (((source)::text = ANY ((ARRAY['web'::character varying, 'mobile-apk'::character varying, 'mobile_app'::character varying, 'manual'::character varying, 'system'::character varying])::text[]))),
    CONSTRAINT vacation_requests_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'cancelled'::character varying, 'completed'::character varying])::text[])))
);


--
-- Name: TABLE vacation_requests; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.vacation_requests IS 'Solicitudes de vacaciones y licencias extraordinarias';


--
-- Name: COLUMN vacation_requests.source; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_requests.source IS 'Origen: web, mobile-apk, system';


--
-- Name: COLUMN vacation_requests.coverage_assignments; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_requests.coverage_assignments IS 'Asignaciones de cobertura de tareas durante ausencia';


--
-- Name: COLUMN vacation_requests.conflicts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_requests.conflicts IS 'Conflictos detectados con otras solicitudes';


--
-- Name: vacation_requests_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vacation_requests_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vacation_requests_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vacation_requests_id_seq OWNED BY public.vacation_requests.id;


--
-- Name: vacation_scales; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vacation_scales (
    id integer NOT NULL,
    company_id integer NOT NULL,
    years_from numeric(4,2) NOT NULL,
    years_to numeric(4,2),
    range_description character varying(100),
    vacation_days integer NOT NULL,
    priority integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: TABLE vacation_scales; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.vacation_scales IS 'Escalas de das de vacaciones segn antigedad';


--
-- Name: COLUMN vacation_scales.years_from; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_scales.years_from IS 'Antigedad mnima en aos';


--
-- Name: COLUMN vacation_scales.years_to; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_scales.years_to IS 'Antigedad mxima en aos (NULL = sin lmite)';


--
-- Name: COLUMN vacation_scales.vacation_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vacation_scales.vacation_days IS 'Das de vacaciones correspondientes';


--
-- Name: vacation_scales_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vacation_scales_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vacation_scales_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vacation_scales_id_seq OWNED BY public.vacation_scales.id;


--
-- Name: vendor_commissions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vendor_commissions (
    id bigint NOT NULL,
    vendor_id uuid NOT NULL,
    company_id integer NOT NULL,
    commission_type character varying(20) NOT NULL,
    percentage numeric(5,2) NOT NULL,
    monthly_amount numeric(10,2) DEFAULT 0,
    is_active boolean DEFAULT true NOT NULL,
    is_transferable boolean DEFAULT false NOT NULL,
    original_vendor_id uuid,
    transferred_date timestamp with time zone,
    transfer_reason text,
    referral_id bigint,
    base_commission_amount numeric(10,2) DEFAULT 0,
    total_users integer DEFAULT 0,
    start_date date,
    end_date date,
    last_calculated timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT vendor_commissions_commission_type_check CHECK (((commission_type)::text = ANY ((ARRAY['sales'::character varying, 'support'::character varying, 'referral'::character varying])::text[]))),
    CONSTRAINT vendor_commissions_percentage_check CHECK (((percentage >= (0)::numeric) AND (percentage <= (100)::numeric)))
);


--
-- Name: COLUMN vendor_commissions.vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vendor_commissions.vendor_id IS 'UUID del staff de Aponnt que recibe la comisin (FK a aponnt_staff.staff_id)';


--
-- Name: COLUMN vendor_commissions.original_vendor_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.vendor_commissions.original_vendor_id IS 'UUID del staff original antes de transferencia (FK a aponnt_staff.staff_id)';


--
-- Name: vendor_commissions_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vendor_commissions_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vendor_commissions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vendor_commissions_id_seq OWNED BY public.vendor_commissions.id;


--
-- Name: vendor_ratings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vendor_ratings (
    id bigint NOT NULL,
    vendor_id uuid NOT NULL,
    company_id integer NOT NULL,
    rating numeric(3,2) NOT NULL,
    response_time_score numeric(3,2) DEFAULT 5.0,
    resolution_quality_score numeric(3,2) DEFAULT 5.0,
    customer_satisfaction_score numeric(3,2) DEFAULT 5.0,
    total_tickets integer DEFAULT 0,
    resolved_tickets integer DEFAULT 0,
    avg_response_time integer DEFAULT 0,
    avg_resolution_time integer DEFAULT 0,
    last_review_date timestamp with time zone,
    improvement_plan text,
    is_under_review boolean DEFAULT false,
    review_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    "responseTimeScore" numeric(3,2) DEFAULT 5,
    "resolutionQualityScore" numeric(3,2) DEFAULT 5,
    "customerSatisfactionScore" numeric(3,2) DEFAULT 5,
    "totalTickets" integer DEFAULT 0,
    "resolvedTickets" integer DEFAULT 0,
    "averageResponseTimeMinutes" integer,
    "averageResolutionTimeHours" numeric(8,2),
    is_active boolean DEFAULT true,
    "reviewStartDate" timestamp without time zone,
    "improvementPlan" text,
    notes text,
    "createdAt" timestamp without time zone,
    "updatedAt" timestamp without time zone,
    CONSTRAINT vendor_ratings_rating_check CHECK (((rating >= 1.0) AND (rating <= 5.0)))
);


--
-- Name: vendor_ratings_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vendor_ratings_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vendor_ratings_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vendor_ratings_id_seq OWNED BY public.vendor_ratings.id;


--
-- Name: vendor_referrals; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vendor_referrals (
    id bigint NOT NULL,
    referrer_id uuid NOT NULL,
    referred_id uuid NOT NULL,
    referral_code character varying(50) NOT NULL,
    level integer DEFAULT 1 NOT NULL,
    commission_percentage numeric(5,2) DEFAULT 5.0 NOT NULL,
    total_commission_earned numeric(10,2) DEFAULT 0,
    status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    activation_date timestamp with time zone,
    last_commission_date timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    "referrerId" integer,
    "referredId" integer,
    "activationDate" timestamp without time zone,
    "commissionPercentage" numeric(5,2) DEFAULT 5,
    "totalCommissionEarned" numeric(10,2) DEFAULT 0,
    "monthlyCommissionEarned" numeric(10,2) DEFAULT 0,
    "lastCommissionDate" timestamp without time zone,
    "isActive" boolean DEFAULT true,
    "contractStartDate" timestamp without time zone,
    "contractEndDate" timestamp without time zone,
    "referralCode" character varying(20),
    notes text,
    "createdAt" timestamp without time zone,
    "updatedAt" timestamp without time zone,
    "deletedAt" timestamp without time zone,
    CONSTRAINT vendor_referrals_level_check CHECK (((level >= 1) AND (level <= 3))),
    CONSTRAINT vendor_referrals_status_check CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'active'::character varying, 'inactive'::character varying, 'cancelled'::character varying])::text[])))
);


--
-- Name: vendor_referrals_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.vendor_referrals_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: vendor_referrals_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.vendor_referrals_id_seq OWNED BY public.vendor_referrals.id;


--
-- Name: vendor_statistics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.vendor_statistics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    vendor_id uuid NOT NULL,
    total_companies integer DEFAULT 0,
    sales_companies integer DEFAULT 0,
    support_companies integer DEFAULT 0,
    total_users integer DEFAULT 0,
    sales_users integer DEFAULT 0,
    support_users integer DEFAULT 0,
    sales_commission_percentage numeric(5,2) DEFAULT 10.00,
    total_sales_commission_usd numeric(12,2) DEFAULT 0.00,
    monthly_sales_commission_usd numeric(12,2) DEFAULT 0.00,
    support_commission_percentage numeric(5,2) DEFAULT 0.00,
    total_support_commission_usd numeric(12,2) DEFAULT 0.00,
    monthly_support_commission_usd numeric(12,2) DEFAULT 0.00,
    total_referrals integer DEFAULT 0,
    referral_commission_usd numeric(12,2) DEFAULT 0.00,
    grand_total_commission_usd numeric(12,2) DEFAULT 0.00,
    total_modules_value_usd numeric(12,2) DEFAULT 0.00,
    rating numeric(3,1) DEFAULT 0.0,
    total_ratings integer DEFAULT 0,
    cbu character varying(22),
    last_updated_at timestamp without time zone DEFAULT now(),
    created_at timestamp without time zone DEFAULT now()
);


--
-- Name: visitor_gps_tracking; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.visitor_gps_tracking (
    id integer NOT NULL,
    visitor_id integer NOT NULL,
    latitude numeric(10,8) NOT NULL,
    longitude numeric(11,8) NOT NULL,
    accuracy numeric(6,2),
    recorded_at timestamp with time zone NOT NULL,
    is_inside_facility boolean DEFAULT true NOT NULL,
    distance_from_center_meters numeric(10,2),
    battery_level integer,
    signal_strength integer,
    company_id integer NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    gps_lat numeric(10,8),
    gps_lng numeric(11,8),
    altitude numeric(8,2),
    speed numeric(6,2),
    distance_from_facility numeric(10,2),
    alert_generated boolean DEFAULT false,
    alert_type character varying(255),
    alert_message text,
    area_id integer,
    area_name character varying(100),
    device_id character varying(100),
    CONSTRAINT visitor_gps_tracking_battery_level_check CHECK (((battery_level >= 0) AND (battery_level <= 100)))
);


--
-- Name: visitor_gps_tracking_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.visitor_gps_tracking_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: visitor_gps_tracking_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.visitor_gps_tracking_id_seq OWNED BY public.visitor_gps_tracking.id;


--
-- Name: visitors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.visitors (
    id integer NOT NULL,
    dni character varying(20) NOT NULL,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    email character varying(255),
    phone character varying(20),
    visit_reason text NOT NULL,
    visiting_department_id integer,
    responsible_employee_id uuid,
    authorization_status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    authorized_by uuid,
    authorized_at timestamp with time zone,
    rejection_reason text,
    gps_tracking_enabled boolean DEFAULT false NOT NULL,
    keyring_id character varying(50),
    facial_template text,
    photo_url text,
    check_in timestamp with time zone,
    check_out timestamp with time zone,
    kiosk_id integer,
    scheduled_visit_date timestamp with time zone NOT NULL,
    expected_duration_minutes integer DEFAULT 60,
    is_active boolean DEFAULT true NOT NULL,
    notes text,
    company_id integer NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    deleted_at timestamp with time zone,
    CONSTRAINT visitors_authorization_status_check CHECK (((authorization_status)::text = ANY ((ARRAY['pending'::character varying, 'authorized'::character varying, 'rejected'::character varying, 'completed'::character varying])::text[])))
);


--
-- Name: visitors_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.visitors_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: visitors_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.visitors_id_seq OWNED BY public.visitors.id;


--
-- Name: vw_admin_tasks_dashboard; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_admin_tasks_dashboard AS
 SELECT at.id,
    at.task_type,
    at.title,
    at.priority,
    at.status,
    at.due_date,
    at.created_at,
    c.name AS company_name,
    c.slug AS company_slug,
    concat(asf.first_name, ' ', asf.last_name) AS assigned_to_name,
    (EXTRACT(day FROM (CURRENT_TIMESTAMP - (at.created_at)::timestamp with time zone)))::integer AS days_pending,
        CASE
            WHEN ((at.due_date IS NOT NULL) AND (at.due_date < CURRENT_DATE)) THEN true
            ELSE false
        END AS is_overdue
   FROM ((public.administrative_tasks at
     LEFT JOIN public.companies c ON ((at.company_id = c.company_id)))
     LEFT JOIN public.aponnt_staff asf ON ((at.assigned_to = asf.staff_id)))
  WHERE ((at.status)::text <> ALL ((ARRAY['COMPLETED'::character varying, 'CANCELLED'::character varying])::text[]));


--
-- Name: vw_commission_payments_dashboard; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_commission_payments_dashboard AS
 SELECT cp.id,
    cp.payment_code,
    cp.payment_date,
    cp.status,
    cp.commission_type,
    cp.net_amount,
    cp.payment_method,
    concat(v.first_name, ' ', v.last_name) AS vendor_name,
    v.email AS vendor_email,
    c.name AS company_name,
    cl.liquidation_code,
    cp.scheduled_date,
    cp.executed_date
   FROM (((public.commission_payments cp
     JOIN public.aponnt_staff v ON ((cp.vendor_id = v.staff_id)))
     JOIN public.companies c ON ((cp.company_id = c.company_id)))
     JOIN public.commission_liquidations cl ON ((cp.liquidation_id = cl.id)))
  ORDER BY cp.payment_date DESC;


--
-- Name: vw_commissions_dashboard; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_commissions_dashboard AS
 SELECT cl.id AS liquidation_id,
    cl.liquidation_code,
    cl.liquidation_type,
    cl.liquidation_date,
    cl.status,
    cl.total_commission_amount,
    c.name AS company_name,
    c.slug AS company_slug,
    NULL::text AS invoice_number,
    cl.payment_scheduled_date,
    jsonb_array_length(cl.commission_breakdown) AS vendor_count
   FROM (public.commission_liquidations cl
     JOIN public.companies c ON ((cl.company_id = c.company_id)))
  ORDER BY cl.liquidation_date DESC;


--
-- Name: vw_hour_bank_drilldown; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_hour_bank_drilldown AS
 WITH user_metrics AS (
         SELECT t.company_id,
            u.branch_id,
            u.department_id,
            t.user_id,
            COALESCE((((u."firstName")::text || ' '::text) || (u."lastName")::text), (u.display_name)::text, 'Sin nombre'::text) AS user_name,
            COALESCE(u.legajo, u."employeeId") AS legajo,
            sum(
                CASE
                    WHEN ((t.transaction_type)::text = 'accrual'::text) THEN t.hours_final
                    ELSE (0)::numeric
                END) AS hours_accrued,
            sum(
                CASE
                    WHEN ((t.transaction_type)::text = 'usage'::text) THEN abs(t.hours_final)
                    ELSE (0)::numeric
                END) AS hours_used,
            sum(
                CASE
                    WHEN ((t.overtime_destination)::text = 'bank'::text) THEN t.hours_raw
                    ELSE (0)::numeric
                END) AS overtime_to_bank,
            sum(
                CASE
                    WHEN ((t.overtime_destination)::text = 'pay'::text) THEN t.hours_raw
                    ELSE (0)::numeric
                END) AS overtime_to_pay,
            count(
                CASE
                    WHEN ((t.overtime_destination)::text = 'pending'::text) THEN 1
                    ELSE NULL::integer
                END) AS decisions_pending,
            b.current_balance
           FROM ((public.hour_bank_transactions t
             JOIN public.users u ON ((t.user_id = u.user_id)))
             LEFT JOIN public.hour_bank_balances b ON (((t.company_id = b.company_id) AND (t.user_id = b.user_id))))
          WHERE (t.created_at >= (CURRENT_DATE - '6 mons'::interval))
          GROUP BY t.company_id, u.branch_id, u.department_id, t.user_id, u."firstName", u."lastName", u.display_name, u.legajo, u."employeeId", b.current_balance
        )
 SELECT company_id,
    branch_id,
    department_id,
    user_id,
    user_name,
    legajo,
    hours_accrued,
    hours_used,
    overtime_to_bank,
    overtime_to_pay,
        CASE
            WHEN ((overtime_to_bank + overtime_to_pay) > (0)::numeric) THEN round(((overtime_to_bank / (overtime_to_bank + overtime_to_pay)) * (100)::numeric), 1)
            ELSE (0)::numeric
        END AS bank_ratio_pct,
    decisions_pending,
    COALESCE(current_balance, (0)::numeric) AS current_balance
   FROM user_metrics;


--
-- Name: VIEW vw_hour_bank_drilldown; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.vw_hour_bank_drilldown IS 'Vista consolidada para reportes con drill-down jerarquico';


--
-- Name: vw_payroll_historical_details; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_payroll_historical_details AS
 SELECT prd.id,
    prd.run_id,
    prd.user_id,
    pr.run_code,
    pr.period_year,
    pr.period_month,
    pr.period_start,
    pr.period_end,
    pr.payment_date,
    (prd.employee_snapshot ->> 'employee_code'::text) AS employee_code,
    (prd.employee_snapshot ->> 'full_name'::text) AS employee_name,
    (prd.employee_snapshot ->> 'document_number'::text) AS document_number,
    ((prd.employee_snapshot -> 'position'::text) ->> 'name'::text) AS position_name,
    ((prd.employee_snapshot -> 'position'::text) ->> 'code'::text) AS position_code,
    ((prd.employee_snapshot -> 'department'::text) ->> 'name'::text) AS department_name,
    ((prd.employee_snapshot -> 'branch'::text) ->> 'name'::text) AS branch_name,
    ((prd.employee_snapshot -> 'template'::text) ->> 'name'::text) AS template_name,
    ((prd.employee_snapshot -> 'category'::text) ->> 'name'::text) AS category_name,
    ((prd.employee_snapshot ->> 'base_salary'::text))::numeric AS base_salary_at_time,
    ((prd.employee_snapshot ->> 'seniority_years'::text))::integer AS seniority_at_time,
    prd.gross_earnings,
    prd.total_deductions,
    prd.net_salary,
    prd.employer_contributions,
    prd.status,
    prd.receipt_number,
    prd.receipt_generated_at,
    prd.created_at AS liquidation_date
   FROM (public.payroll_run_details prd
     JOIN public.payroll_runs pr ON ((prd.run_id = pr.id)))
  ORDER BY pr.period_year DESC, pr.period_month DESC;


--
-- Name: VIEW vw_payroll_historical_details; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.vw_payroll_historical_details IS 'Vista de histrico de liquidaciones con datos snapshot.
Los datos del empleado/cargo/template se preservan aunque se modifiquen o eliminen posteriormente.';


--
-- Name: vw_positions_with_templates; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_positions_with_templates AS
 SELECT op.id,
    op.company_id,
    op.position_code,
    op.position_name,
    op.description,
    op.parent_position_id,
    op.level_order,
    op.salary_category_id,
    op.payslip_template_id,
    op.payroll_template_id,
    op.department_id,
    op.is_active,
    op.created_at,
    op.updated_at,
    ppt.template_name,
    ppt.template_code,
    c.name AS company_name,
    parent.position_name AS parent_position_name
   FROM (((public.organizational_positions op
     LEFT JOIN public.payroll_payslip_templates ppt ON ((op.payslip_template_id = ppt.id)))
     LEFT JOIN public.companies c ON ((op.company_id = c.company_id)))
     LEFT JOIN public.organizational_positions parent ON ((op.parent_position_id = parent.id)));


--
-- Name: vw_user_salary_complete; Type: VIEW; Schema: public; Owner: -
--

CREATE VIEW public.vw_user_salary_complete AS
 SELECT u.user_id,
    (((u."firstName")::text || ' '::text) || (u."lastName")::text) AS employee_name,
    u.company_id,
    c.name AS company_name,
    u.branch_id AS user_branch_uuid,
    lac.code AS agreement_code,
    lac.name AS agreement_name,
    sc.category_code,
    sc.category_name,
    sc.base_salary_reference AS category_base_salary,
    usc.base_salary AS user_base_salary,
    usc.gross_salary,
    usc.hourly_rate,
    usc.overtime_rate_50,
    usc.overtime_rate_100,
    usc.currency,
    usc.effective_from,
    usc.last_salary_update,
    usc.salary_increase_percentage AS last_increase_pct,
    usc.is_current
   FROM ((((public.users u
     LEFT JOIN public.companies c ON ((c.company_id = u.company_id)))
     LEFT JOIN public.user_salary_config_v2 usc ON (((usc.user_id = u.user_id) AND (usc.is_current = true))))
     LEFT JOIN public.labor_agreements_catalog lac ON ((lac.id = usc.labor_agreement_id)))
     LEFT JOIN public.salary_categories sc ON ((sc.id = usc.salary_category_id)))
  WHERE (u.is_active = true);


--
-- Name: VIEW vw_user_salary_complete; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON VIEW public.vw_user_salary_complete IS 'Vista completa de la cadena User  Convenio  Categora  Salario con datos de sucursal y pas';


--
-- Name: biometric_alerts_p0; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p0 FOR VALUES WITH (modulus 16, remainder 0);


--
-- Name: biometric_alerts_p1; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p1 FOR VALUES WITH (modulus 16, remainder 1);


--
-- Name: biometric_alerts_p10; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p10 FOR VALUES WITH (modulus 16, remainder 10);


--
-- Name: biometric_alerts_p11; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p11 FOR VALUES WITH (modulus 16, remainder 11);


--
-- Name: biometric_alerts_p12; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p12 FOR VALUES WITH (modulus 16, remainder 12);


--
-- Name: biometric_alerts_p13; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p13 FOR VALUES WITH (modulus 16, remainder 13);


--
-- Name: biometric_alerts_p14; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p14 FOR VALUES WITH (modulus 16, remainder 14);


--
-- Name: biometric_alerts_p15; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p15 FOR VALUES WITH (modulus 16, remainder 15);


--
-- Name: biometric_alerts_p2; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p2 FOR VALUES WITH (modulus 16, remainder 2);


--
-- Name: biometric_alerts_p3; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p3 FOR VALUES WITH (modulus 16, remainder 3);


--
-- Name: biometric_alerts_p4; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p4 FOR VALUES WITH (modulus 16, remainder 4);


--
-- Name: biometric_alerts_p5; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p5 FOR VALUES WITH (modulus 16, remainder 5);


--
-- Name: biometric_alerts_p6; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p6 FOR VALUES WITH (modulus 16, remainder 6);


--
-- Name: biometric_alerts_p7; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p7 FOR VALUES WITH (modulus 16, remainder 7);


--
-- Name: biometric_alerts_p8; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p8 FOR VALUES WITH (modulus 16, remainder 8);


--
-- Name: biometric_alerts_p9; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p9 FOR VALUES WITH (modulus 16, remainder 9);


--
-- Name: biometric_scans_p0; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p0 FOR VALUES WITH (modulus 16, remainder 0);


--
-- Name: biometric_scans_p1; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p1 FOR VALUES WITH (modulus 16, remainder 1);


--
-- Name: biometric_scans_p10; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p10 FOR VALUES WITH (modulus 16, remainder 10);


--
-- Name: biometric_scans_p11; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p11 FOR VALUES WITH (modulus 16, remainder 11);


--
-- Name: biometric_scans_p12; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p12 FOR VALUES WITH (modulus 16, remainder 12);


--
-- Name: biometric_scans_p13; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p13 FOR VALUES WITH (modulus 16, remainder 13);


--
-- Name: biometric_scans_p14; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p14 FOR VALUES WITH (modulus 16, remainder 14);


--
-- Name: biometric_scans_p15; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p15 FOR VALUES WITH (modulus 16, remainder 15);


--
-- Name: biometric_scans_p2; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p2 FOR VALUES WITH (modulus 16, remainder 2);


--
-- Name: biometric_scans_p3; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p3 FOR VALUES WITH (modulus 16, remainder 3);


--
-- Name: biometric_scans_p4; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p4 FOR VALUES WITH (modulus 16, remainder 4);


--
-- Name: biometric_scans_p5; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p5 FOR VALUES WITH (modulus 16, remainder 5);


--
-- Name: biometric_scans_p6; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p6 FOR VALUES WITH (modulus 16, remainder 6);


--
-- Name: biometric_scans_p7; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p7 FOR VALUES WITH (modulus 16, remainder 7);


--
-- Name: biometric_scans_p8; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p8 FOR VALUES WITH (modulus 16, remainder 8);


--
-- Name: biometric_scans_p9; Type: TABLE ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p9 FOR VALUES WITH (modulus 16, remainder 9);


--
-- Name: access_audit_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_audit_log ALTER COLUMN id SET DEFAULT nextval('public.access_audit_log_id_seq'::regclass);


--
-- Name: access_notifications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_notifications ALTER COLUMN id SET DEFAULT nextval('public.access_notifications_id_seq'::regclass);


--
-- Name: afip_auth_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_auth_log ALTER COLUMN id SET DEFAULT nextval('public.afip_auth_log_id_seq'::regclass);


--
-- Name: afip_cae_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log ALTER COLUMN id SET DEFAULT nextval('public.afip_cae_log_id_seq'::regclass);


--
-- Name: aponnt_admin_tasks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_admin_tasks ALTER COLUMN id SET DEFAULT nextval('public.aponnt_admin_tasks_id_seq'::regclass);


--
-- Name: aponnt_email_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_email_config ALTER COLUMN id SET DEFAULT nextval('public.aponnt_email_config_id_seq'::regclass);


--
-- Name: aponnt_pre_invoices id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices ALTER COLUMN id SET DEFAULT nextval('public.aponnt_pre_invoices_id_seq'::regclass);


--
-- Name: approved_shift_swaps id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approved_shift_swaps ALTER COLUMN id SET DEFAULT nextval('public.approved_shift_swaps_id_seq'::regclass);


--
-- Name: asset_contracts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts ALTER COLUMN id SET DEFAULT nextval('public.asset_contracts_id_seq'::regclass);


--
-- Name: associate_employee_assignments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments ALTER COLUMN id SET DEFAULT nextval('public.associate_employee_assignments_id_seq'::regclass);


--
-- Name: attendance_analytics_cache id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_analytics_cache ALTER COLUMN id SET DEFAULT nextval('public.attendance_analytics_cache_id_seq'::regclass);


--
-- Name: attendance_patterns id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_patterns ALTER COLUMN id SET DEFAULT nextval('public.attendance_patterns_id_seq'::regclass);


--
-- Name: attendance_profiles id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_profiles ALTER COLUMN id SET DEFAULT nextval('public.attendance_profiles_id_seq'::regclass);


--
-- Name: audit_reports id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_reports ALTER COLUMN id SET DEFAULT nextval('public.audit_reports_id_seq'::regclass);


--
-- Name: benefit_approval_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_history ALTER COLUMN id SET DEFAULT nextval('public.benefit_approval_history_id_seq'::regclass);


--
-- Name: benefit_approval_workflows id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows ALTER COLUMN id SET DEFAULT nextval('public.benefit_approval_workflows_id_seq'::regclass);


--
-- Name: benefit_document_requirements id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_document_requirements ALTER COLUMN id SET DEFAULT nextval('public.benefit_document_requirements_id_seq'::regclass);


--
-- Name: benefit_expense_allowances id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_allowances ALTER COLUMN id SET DEFAULT nextval('public.benefit_expense_allowances_id_seq'::regclass);


--
-- Name: benefit_expense_submissions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions ALTER COLUMN id SET DEFAULT nextval('public.benefit_expense_submissions_id_seq'::regclass);


--
-- Name: benefit_payroll_concepts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts ALTER COLUMN id SET DEFAULT nextval('public.benefit_payroll_concepts_id_seq'::regclass);


--
-- Name: benefit_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_types ALTER COLUMN id SET DEFAULT nextval('public.benefit_types_id_seq'::regclass);


--
-- Name: biometric_alerts alert_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts ALTER COLUMN alert_id SET DEFAULT nextval('public.biometric_alerts_alert_id_seq'::regclass);


--
-- Name: biometric_analytics_aggregated id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_analytics_aggregated ALTER COLUMN id SET DEFAULT nextval('public.biometric_analytics_aggregated_id_seq'::regclass);


--
-- Name: biometric_audit_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_audit_log ALTER COLUMN id SET DEFAULT nextval('public.biometric_audit_log_id_seq'::regclass);


--
-- Name: biometric_company_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_company_config ALTER COLUMN id SET DEFAULT nextval('public.biometric_company_config_id_seq'::regclass);


--
-- Name: biometric_consents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents ALTER COLUMN id SET DEFAULT nextval('public.biometric_consents_id_seq'::regclass);


--
-- Name: biometric_emotional_analysis id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_emotional_analysis ALTER COLUMN id SET DEFAULT nextval('public.biometric_emotional_analysis_id_seq'::regclass);


--
-- Name: biometric_scans scan_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_scans ALTER COLUMN scan_id SET DEFAULT nextval('public.biometric_scans_scan_id_seq'::regclass);


--
-- Name: biometric_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_templates ALTER COLUMN id SET DEFAULT nextval('public.biometric_templates_id_seq'::regclass);


--
-- Name: branch_offices_fiscal id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branch_offices_fiscal ALTER COLUMN id SET DEFAULT nextval('public.branch_offices_fiscal_id_seq'::regclass);


--
-- Name: business_validations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.business_validations ALTER COLUMN id SET DEFAULT nextval('public.business_validations_id_seq'::regclass);


--
-- Name: calendar_events id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_events ALTER COLUMN id SET DEFAULT nextval('public.calendar_events_id_seq'::regclass);


--
-- Name: calendar_integrations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_integrations ALTER COLUMN id SET DEFAULT nextval('public.calendar_integrations_id_seq'::regclass);


--
-- Name: chronic_conditions_catalog id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.chronic_conditions_catalog ALTER COLUMN id SET DEFAULT nextval('public.chronic_conditions_catalog_id_seq'::regclass);


--
-- Name: companies company_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.companies ALTER COLUMN company_id SET DEFAULT nextval('public.companies_id_seq'::regclass);


--
-- Name: company_account_notifications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_account_notifications ALTER COLUMN id SET DEFAULT nextval('public.company_account_notifications_id_seq'::regclass);


--
-- Name: company_associate_contracts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts ALTER COLUMN id SET DEFAULT nextval('public.company_associate_contracts_id_seq'::regclass);


--
-- Name: company_benefit_policies id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies ALTER COLUMN id SET DEFAULT nextval('public.company_benefit_policies_id_seq'::regclass);


--
-- Name: company_branches id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches ALTER COLUMN id SET DEFAULT nextval('public.company_branches_id_seq'::regclass);


--
-- Name: company_communications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_communications ALTER COLUMN id SET DEFAULT nextval('public.company_communications_id_seq'::regclass);


--
-- Name: company_dependencies id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies ALTER COLUMN id SET DEFAULT nextval('public.company_dependencies_id_seq'::regclass);


--
-- Name: company_fiscal_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_fiscal_config ALTER COLUMN id SET DEFAULT nextval('public.company_fiscal_config_id_seq'::regclass);


--
-- Name: company_non_working_days id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_non_working_days ALTER COLUMN id SET DEFAULT nextval('public.company_non_working_days_id_seq'::regclass);


--
-- Name: company_risk_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_risk_config ALTER COLUMN id SET DEFAULT nextval('public.company_risk_config_id_seq'::regclass);


--
-- Name: company_tasks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tasks ALTER COLUMN id SET DEFAULT nextval('public.company_tasks_id_seq'::regclass);


--
-- Name: company_tax_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tax_config ALTER COLUMN id SET DEFAULT nextval('public.company_tax_config_id_seq'::regclass);


--
-- Name: comparative_analytics id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.comparative_analytics ALTER COLUMN id SET DEFAULT nextval('public.comparative_analytics_id_seq'::regclass);


--
-- Name: compliance_rules id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_rules ALTER COLUMN id SET DEFAULT nextval('public.compliance_rules_id_seq'::regclass);


--
-- Name: compliance_violations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations ALTER COLUMN id SET DEFAULT nextval('public.compliance_violations_id_seq'::regclass);


--
-- Name: concept_dependencies id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies ALTER COLUMN id SET DEFAULT nextval('public.concept_dependencies_id_seq'::regclass);


--
-- Name: consent_change_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_change_log ALTER COLUMN id SET DEFAULT nextval('public.consent_change_log_id_seq'::regclass);


--
-- Name: contextual_help id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contextual_help ALTER COLUMN id SET DEFAULT nextval('public.contextual_help_id_seq'::regclass);


--
-- Name: contract_template_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_template_types ALTER COLUMN id SET DEFAULT nextval('public.contract_template_types_id_seq'::regclass);


--
-- Name: contract_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates ALTER COLUMN id SET DEFAULT nextval('public.contract_templates_id_seq'::regclass);


--
-- Name: cost_budgets id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cost_budgets ALTER COLUMN id SET DEFAULT nextval('public.cost_budgets_id_seq'::regclass);


--
-- Name: cost_transactions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cost_transactions ALTER COLUMN id SET DEFAULT nextval('public.cost_transactions_id_seq'::regclass);


--
-- Name: data_integrity_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.data_integrity_log ALTER COLUMN id SET DEFAULT nextval('public.data_integrity_log_id_seq'::regclass);


--
-- Name: department_aliases id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.department_aliases ALTER COLUMN id SET DEFAULT nextval('public.department_aliases_id_seq'::regclass);


--
-- Name: departments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments ALTER COLUMN id SET DEFAULT nextval('public.departments_id_seq'::regclass);


--
-- Name: dependency_evaluations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations ALTER COLUMN id SET DEFAULT nextval('public.dependency_evaluations_id_seq'::regclass);


--
-- Name: dependency_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_types ALTER COLUMN id SET DEFAULT nextval('public.dependency_types_id_seq'::regclass);


--
-- Name: dms_access_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_access_log ALTER COLUMN id SET DEFAULT nextval('public.dms_access_log_id_seq'::regclass);


--
-- Name: dms_workflow_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_templates ALTER COLUMN id SET DEFAULT nextval('public.dms_workflow_templates_id_seq'::regclass);


--
-- Name: document_categories id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_categories ALTER COLUMN id SET DEFAULT nextval('public.document_categories_id_seq'::regclass);


--
-- Name: document_statuses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_statuses ALTER COLUMN id SET DEFAULT nextval('public.document_statuses_id_seq'::regclass);


--
-- Name: document_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_types ALTER COLUMN id SET DEFAULT nextval('public.document_types_id_seq'::regclass);


--
-- Name: email_configurations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations ALTER COLUMN id SET DEFAULT nextval('public.email_configurations_id_seq'::regclass);


--
-- Name: email_logs id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs ALTER COLUMN id SET DEFAULT nextval('public.email_logs_id_seq'::regclass);


--
-- Name: email_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates ALTER COLUMN id SET DEFAULT nextval('public.email_templates_id_seq'::regclass);


--
-- Name: employee_assigned_assets id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_assigned_assets ALTER COLUMN id SET DEFAULT nextval('public.employee_assigned_assets_id_seq'::regclass);


--
-- Name: employee_benefit_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents ALTER COLUMN id SET DEFAULT nextval('public.employee_benefit_documents_id_seq'::regclass);


--
-- Name: employee_benefits id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits ALTER COLUMN id SET DEFAULT nextval('public.employee_benefits_id_seq'::regclass);


--
-- Name: employee_dependency_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents ALTER COLUMN id SET DEFAULT nextval('public.employee_dependency_documents_id_seq'::regclass);


--
-- Name: employee_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_documents ALTER COLUMN id SET DEFAULT nextval('public.employee_documents_id_seq'::regclass);


--
-- Name: epp_catalog id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_catalog ALTER COLUMN id SET DEFAULT nextval('public.epp_catalog_id_seq'::regclass);


--
-- Name: epp_categories id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_categories ALTER COLUMN id SET DEFAULT nextval('public.epp_categories_id_seq'::regclass);


--
-- Name: epp_deliveries id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries ALTER COLUMN id SET DEFAULT nextval('public.epp_deliveries_id_seq'::regclass);


--
-- Name: epp_inspections id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_inspections ALTER COLUMN id SET DEFAULT nextval('public.epp_inspections_id_seq'::regclass);


--
-- Name: epp_role_requirements id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements ALTER COLUMN id SET DEFAULT nextval('public.epp_role_requirements_id_seq'::regclass);


--
-- Name: extraordinary_licenses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.extraordinary_licenses ALTER COLUMN id SET DEFAULT nextval('public.extraordinary_licenses_id_seq'::regclass);


--
-- Name: hour_bank_blackout_dates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates ALTER COLUMN id SET DEFAULT nextval('public.hour_bank_blackout_dates_id_seq'::regclass);


--
-- Name: hour_bank_budgets id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_budgets ALTER COLUMN id SET DEFAULT nextval('public.hour_bank_budgets_id_seq'::regclass);


--
-- Name: hour_bank_metrics_aggregated id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_metrics_aggregated ALTER COLUMN id SET DEFAULT nextval('public.hour_bank_metrics_aggregated_id_seq'::regclass);


--
-- Name: hour_bank_risk_analysis id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_risk_analysis ALTER COLUMN id SET DEFAULT nextval('public.hour_bank_risk_analysis_id_seq'::regclass);


--
-- Name: hour_bank_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates ALTER COLUMN id SET DEFAULT nextval('public.hour_bank_templates_id_seq'::regclass);


--
-- Name: hse_company_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_company_config ALTER COLUMN id SET DEFAULT nextval('public.hse_company_config_id_seq'::regclass);


--
-- Name: hse_ppe_stats id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_ppe_stats ALTER COLUMN id SET DEFAULT nextval('public.hse_ppe_stats_id_seq'::regclass);


--
-- Name: invoices id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices ALTER COLUMN id SET DEFAULT nextval('public.invoices_id_seq'::regclass);


--
-- Name: job_application_notes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_application_notes ALTER COLUMN id SET DEFAULT nextval('public.job_application_notes_id_seq'::regclass);


--
-- Name: job_applications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications ALTER COLUMN id SET DEFAULT nextval('public.job_applications_id_seq'::regclass);


--
-- Name: job_postings id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings ALTER COLUMN id SET DEFAULT nextval('public.job_postings_id_seq'::regclass);


--
-- Name: kiosks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kiosks ALTER COLUMN id SET DEFAULT nextval('public.kiosks_id_seq'::regclass);


--
-- Name: labor_agreements_catalog id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_catalog ALTER COLUMN id SET DEFAULT nextval('public.labor_agreements_catalog_id_seq'::regclass);


--
-- Name: labor_agreements_v2 id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_v2 ALTER COLUMN id SET DEFAULT nextval('public.labor_agreements_v2_id_seq'::regclass);


--
-- Name: learning_patterns id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.learning_patterns ALTER COLUMN id SET DEFAULT nextval('public.learning_patterns_id_seq'::regclass);


--
-- Name: legal_ai_analysis id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis ALTER COLUMN id SET DEFAULT nextval('public.legal_ai_analysis_id_seq'::regclass);


--
-- Name: legal_case_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents ALTER COLUMN id SET DEFAULT nextval('public.legal_case_documents_id_seq'::regclass);


--
-- Name: legal_case_parties id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_parties ALTER COLUMN id SET DEFAULT nextval('public.legal_case_parties_id_seq'::regclass);


--
-- Name: legal_case_stages id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_stages ALTER COLUMN id SET DEFAULT nextval('public.legal_case_stages_id_seq'::regclass);


--
-- Name: legal_case_timeline_events id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events ALTER COLUMN id SET DEFAULT nextval('public.legal_case_timeline_events_id_seq'::regclass);


--
-- Name: legal_cases id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases ALTER COLUMN id SET DEFAULT nextval('public.legal_cases_id_seq'::regclass);


--
-- Name: legal_deadlines id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines ALTER COLUMN id SET DEFAULT nextval('public.legal_deadlines_id_seq'::regclass);


--
-- Name: legal_document_alerts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts ALTER COLUMN id SET DEFAULT nextval('public.legal_document_alerts_id_seq'::regclass);


--
-- Name: legal_edit_authorizations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_edit_authorizations ALTER COLUMN id SET DEFAULT nextval('public.legal_edit_authorizations_id_seq'::regclass);


--
-- Name: medical_certificates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates ALTER COLUMN id SET DEFAULT nextval('public.medical_certificates_id_seq'::regclass);


--
-- Name: medical_edit_authorizations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations ALTER COLUMN id SET DEFAULT nextval('public.medical_edit_authorizations_id_seq'::regclass);


--
-- Name: medical_exam_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_exam_templates ALTER COLUMN id SET DEFAULT nextval('public.medical_exam_templates_id_seq'::regclass);


--
-- Name: medical_record_audit_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_record_audit_log ALTER COLUMN id SET DEFAULT nextval('public.medical_record_audit_log_id_seq'::regclass);


--
-- Name: medical_records id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records ALTER COLUMN id SET DEFAULT nextval('public.medical_records_id_seq'::regclass);


--
-- Name: migration_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.migration_log ALTER COLUMN id SET DEFAULT nextval('public.migration_log_id_seq'::regclass);


--
-- Name: module_definitions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.module_definitions ALTER COLUMN id SET DEFAULT nextval('public.module_definitions_id_seq'::regclass);


--
-- Name: multiple_art_configurations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multiple_art_configurations ALTER COLUMN id SET DEFAULT nextval('public.multiple_art_configurations_id_seq'::regclass);


--
-- Name: notification_actions_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_actions_log ALTER COLUMN id SET DEFAULT nextval('public.notification_actions_log_id_seq'::regclass);


--
-- Name: notification_ai_learning id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_ai_learning ALTER COLUMN id SET DEFAULT nextval('public.notification_ai_learning_id_seq'::regclass);


--
-- Name: notification_ai_suggestions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_ai_suggestions ALTER COLUMN id SET DEFAULT nextval('public.notification_ai_suggestions_id_seq'::regclass);


--
-- Name: notification_audit_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_audit_log ALTER COLUMN id SET DEFAULT nextval('public.notification_audit_log_id_seq'::regclass);


--
-- Name: notification_context_data id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_context_data ALTER COLUMN id SET DEFAULT nextval('public.notification_context_data_id_seq'::regclass);


--
-- Name: notification_escalations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_escalations ALTER COLUMN id SET DEFAULT nextval('public.notification_escalations_id_seq'::regclass);


--
-- Name: notification_faq_patterns id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_faq_patterns ALTER COLUMN id SET DEFAULT nextval('public.notification_faq_patterns_id_seq'::regclass);


--
-- Name: notification_flow_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_flow_templates ALTER COLUMN id SET DEFAULT nextval('public.notification_flow_templates_id_seq'::regclass);


--
-- Name: notification_learned_responses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_learned_responses ALTER COLUMN id SET DEFAULT nextval('public.notification_learned_responses_id_seq'::regclass);


--
-- Name: notification_participant_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_participant_types ALTER COLUMN id SET DEFAULT nextval('public.notification_participant_types_id_seq'::regclass);


--
-- Name: notification_sla_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_config ALTER COLUMN id SET DEFAULT nextval('public.notification_sla_config_id_seq'::regclass);


--
-- Name: notification_sla_records id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_records ALTER COLUMN id SET DEFAULT nextval('public.notification_sla_records_id_seq'::regclass);


--
-- Name: notification_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_templates ALTER COLUMN id SET DEFAULT nextval('public.notification_templates_id_seq'::regclass);


--
-- Name: notification_thread_analysis id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_thread_analysis ALTER COLUMN id SET DEFAULT nextval('public.notification_thread_analysis_id_seq'::regclass);


--
-- Name: notification_workflows id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_workflows ALTER COLUMN id SET DEFAULT nextval('public.notification_workflows_id_seq'::regclass);


--
-- Name: notifications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications ALTER COLUMN id SET DEFAULT nextval('public.notifications_id_seq'::regclass);


--
-- Name: oh_certification_alert_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alert_config ALTER COLUMN id SET DEFAULT nextval('public.oh_certification_alert_config_id_seq'::regclass);


--
-- Name: oh_certification_alerts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alerts ALTER COLUMN id SET DEFAULT nextval('public.oh_certification_alerts_id_seq'::regclass);


--
-- Name: oh_certification_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_types ALTER COLUMN id SET DEFAULT nextval('public.oh_certification_types_id_seq'::regclass);


--
-- Name: oh_claim_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_documents ALTER COLUMN id SET DEFAULT nextval('public.oh_claim_documents_id_seq'::regclass);


--
-- Name: oh_claim_status_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_status_history ALTER COLUMN id SET DEFAULT nextval('public.oh_claim_status_history_id_seq'::regclass);


--
-- Name: oh_claim_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_types ALTER COLUMN id SET DEFAULT nextval('public.oh_claim_types_id_seq'::regclass);


--
-- Name: oh_employee_certifications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications ALTER COLUMN id SET DEFAULT nextval('public.oh_employee_certifications_id_seq'::regclass);


--
-- Name: oh_screening_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_config ALTER COLUMN id SET DEFAULT nextval('public.oh_screening_config_id_seq'::regclass);


--
-- Name: oh_screening_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_documents ALTER COLUMN id SET DEFAULT nextval('public.oh_screening_documents_id_seq'::regclass);


--
-- Name: oh_screening_results id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_results ALTER COLUMN id SET DEFAULT nextval('public.oh_screening_results_id_seq'::regclass);


--
-- Name: oh_screening_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_types ALTER COLUMN id SET DEFAULT nextval('public.oh_screening_types_id_seq'::regclass);


--
-- Name: oh_workers_compensation_claims id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_workers_compensation_claims ALTER COLUMN id SET DEFAULT nextval('public.oh_workers_compensation_claims_id_seq'::regclass);


--
-- Name: organizational_positions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions ALTER COLUMN id SET DEFAULT nextval('public.organizational_positions_id_seq'::regclass);


--
-- Name: partner_roles id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_roles ALTER COLUMN id SET DEFAULT nextval('public.partner_roles_id_seq'::regclass);


--
-- Name: payments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments ALTER COLUMN id SET DEFAULT nextval('public.payments_id_seq'::regclass);


--
-- Name: payroll_concept_classifications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_classifications ALTER COLUMN id SET DEFAULT nextval('public.payroll_concept_classifications_id_seq'::regclass);


--
-- Name: payroll_concept_type_rates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_type_rates ALTER COLUMN id SET DEFAULT nextval('public.payroll_concept_type_rates_id_seq'::regclass);


--
-- Name: payroll_concept_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types ALTER COLUMN id SET DEFAULT nextval('public.payroll_concept_types_id_seq'::regclass);


--
-- Name: payroll_countries id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_countries ALTER COLUMN id SET DEFAULT nextval('public.payroll_countries_id_seq'::regclass);


--
-- Name: payroll_entities entity_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entities ALTER COLUMN entity_id SET DEFAULT nextval('public.payroll_entities_entity_id_seq'::regclass);


--
-- Name: payroll_entity_categories id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_categories ALTER COLUMN id SET DEFAULT nextval('public.payroll_entity_categories_id_seq'::regclass);


--
-- Name: payroll_entity_settlement_details detail_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlement_details ALTER COLUMN detail_id SET DEFAULT nextval('public.payroll_entity_settlement_details_detail_id_seq'::regclass);


--
-- Name: payroll_entity_settlements settlement_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements ALTER COLUMN settlement_id SET DEFAULT nextval('public.payroll_entity_settlements_settlement_id_seq'::regclass);


--
-- Name: payroll_payslip_block_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_block_types ALTER COLUMN id SET DEFAULT nextval('public.payroll_payslip_block_types_id_seq'::regclass);


--
-- Name: payroll_payslip_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_templates ALTER COLUMN id SET DEFAULT nextval('public.payroll_payslip_templates_id_seq'::regclass);


--
-- Name: payroll_run_concept_details id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details ALTER COLUMN id SET DEFAULT nextval('public.payroll_run_concept_details_id_seq'::regclass);


--
-- Name: payroll_run_details id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_details ALTER COLUMN id SET DEFAULT nextval('public.payroll_run_details_id_seq'::regclass);


--
-- Name: payroll_runs id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs ALTER COLUMN id SET DEFAULT nextval('public.payroll_runs_id_seq'::regclass);


--
-- Name: payroll_template_concepts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts ALTER COLUMN id SET DEFAULT nextval('public.payroll_template_concepts_id_seq'::regclass);


--
-- Name: payroll_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates ALTER COLUMN id SET DEFAULT nextval('public.payroll_templates_id_seq'::regclass);


--
-- Name: proactive_executions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proactive_executions ALTER COLUMN id SET DEFAULT nextval('public.proactive_executions_id_seq'::regclass);


--
-- Name: proactive_rules id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proactive_rules ALTER COLUMN id SET DEFAULT nextval('public.proactive_rules_id_seq'::regclass);


--
-- Name: report_access_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.report_access_log ALTER COLUMN id SET DEFAULT nextval('public.report_access_log_id_seq'::regclass);


--
-- Name: request_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.request_types ALTER COLUMN id SET DEFAULT nextval('public.request_types_id_seq'::regclass);


--
-- Name: risk_benchmarks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_benchmarks ALTER COLUMN id SET DEFAULT nextval('public.risk_benchmarks_id_seq'::regclass);


--
-- Name: role_definitions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_definitions ALTER COLUMN id SET DEFAULT nextval('public.role_definitions_id_seq'::regclass);


--
-- Name: salary_categories id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories ALTER COLUMN id SET DEFAULT nextval('public.salary_categories_id_seq'::regclass);


--
-- Name: salary_categories_v2 id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories_v2 ALTER COLUMN id SET DEFAULT nextval('public.salary_categories_v2_id_seq'::regclass);


--
-- Name: sanction_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_history ALTER COLUMN id SET DEFAULT nextval('public.sanction_history_id_seq'::regclass);


--
-- Name: sanction_types id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_types ALTER COLUMN id SET DEFAULT nextval('public.sanction_types_id_seq'::regclass);


--
-- Name: sanctions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions ALTER COLUMN id SET DEFAULT nextval('public.sanctions_id_seq'::regclass);


--
-- Name: scoring_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scoring_history ALTER COLUMN id SET DEFAULT nextval('public.scoring_history_id_seq'::regclass);


--
-- Name: sectors id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sectors ALTER COLUMN id SET DEFAULT nextval('public.sectors_id_seq'::regclass);


--
-- Name: siac_cajas id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_cajas ALTER COLUMN id SET DEFAULT nextval('public.siac_cajas_id_seq'::regclass);


--
-- Name: siac_clientes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes ALTER COLUMN id SET DEFAULT nextval('public.siac_clientes_id_seq'::regclass);


--
-- Name: siac_clientes_contactos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_contactos ALTER COLUMN id SET DEFAULT nextval('public.siac_clientes_contactos_id_seq'::regclass);


--
-- Name: siac_clientes_direcciones id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_direcciones ALTER COLUMN id SET DEFAULT nextval('public.siac_clientes_direcciones_id_seq'::regclass);


--
-- Name: siac_clientes_precios_especiales id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_precios_especiales ALTER COLUMN id SET DEFAULT nextval('public.siac_clientes_precios_especiales_id_seq'::regclass);


--
-- Name: siac_configuracion_empresa id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_empresa ALTER COLUMN id SET DEFAULT nextval('public.siac_configuracion_empresa_id_seq'::regclass);


--
-- Name: siac_configuracion_terminal id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_terminal ALTER COLUMN id SET DEFAULT nextval('public.siac_configuracion_terminal_id_seq'::regclass);


--
-- Name: siac_facturas id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas ALTER COLUMN id SET DEFAULT nextval('public.siac_facturas_id_seq'::regclass);


--
-- Name: siac_facturas_impuestos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_impuestos ALTER COLUMN id SET DEFAULT nextval('public.siac_facturas_impuestos_id_seq'::regclass);


--
-- Name: siac_facturas_items id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_items ALTER COLUMN id SET DEFAULT nextval('public.siac_facturas_items_id_seq'::regclass);


--
-- Name: siac_facturas_pagos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_pagos ALTER COLUMN id SET DEFAULT nextval('public.siac_facturas_pagos_id_seq'::regclass);


--
-- Name: siac_listas_precios id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_listas_precios ALTER COLUMN id SET DEFAULT nextval('public.siac_listas_precios_id_seq'::regclass);


--
-- Name: siac_modulos_empresa id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_modulos_empresa ALTER COLUMN id SET DEFAULT nextval('public.siac_modulos_empresa_id_seq'::regclass);


--
-- Name: siac_numeracion_comprobantes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_comprobantes ALTER COLUMN id SET DEFAULT nextval('public.siac_numeracion_comprobantes_id_seq'::regclass);


--
-- Name: siac_numeracion_log id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_log ALTER COLUMN id SET DEFAULT nextval('public.siac_numeracion_log_id_seq'::regclass);


--
-- Name: siac_presupuestos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_presupuestos ALTER COLUMN id SET DEFAULT nextval('public.siac_presupuestos_id_seq'::regclass);


--
-- Name: siac_productos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos ALTER COLUMN id SET DEFAULT nextval('public.siac_productos_id_seq'::regclass);


--
-- Name: siac_productos_categorias id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_categorias ALTER COLUMN id SET DEFAULT nextval('public.siac_productos_categorias_id_seq'::regclass);


--
-- Name: siac_productos_componentes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_componentes ALTER COLUMN id SET DEFAULT nextval('public.siac_productos_componentes_id_seq'::regclass);


--
-- Name: siac_productos_marcas id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_marcas ALTER COLUMN id SET DEFAULT nextval('public.siac_productos_marcas_id_seq'::regclass);


--
-- Name: siac_productos_precios id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_precios ALTER COLUMN id SET DEFAULT nextval('public.siac_productos_precios_id_seq'::regclass);


--
-- Name: siac_puntos_venta id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_puntos_venta ALTER COLUMN id SET DEFAULT nextval('public.siac_puntos_venta_id_seq'::regclass);


--
-- Name: siac_sesiones_caja id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_caja ALTER COLUMN id SET DEFAULT nextval('public.siac_sesiones_caja_id_seq'::regclass);


--
-- Name: siac_sesiones_locales id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_locales ALTER COLUMN id SET DEFAULT nextval('public.siac_sesiones_locales_id_seq'::regclass);


--
-- Name: siac_stock_movimientos id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_stock_movimientos ALTER COLUMN id SET DEFAULT nextval('public.siac_stock_movimientos_id_seq'::regclass);


--
-- Name: siac_tipos_comprobantes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_tipos_comprobantes ALTER COLUMN id SET DEFAULT nextval('public.siac_tipos_comprobantes_id_seq'::regclass);


--
-- Name: siac_transacciones_pendientes id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_transacciones_pendientes ALTER COLUMN id SET DEFAULT nextval('public.siac_transacciones_pendientes_id_seq'::regclass);


--
-- Name: sla_metrics id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sla_metrics ALTER COLUMN id SET DEFAULT nextval('public.sla_metrics_id_seq'::regclass);


--
-- Name: sports_catalog id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sports_catalog ALTER COLUMN id SET DEFAULT nextval('public.sports_catalog_id_seq'::regclass);


--
-- Name: support_sla_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_sla_config ALTER COLUMN id SET DEFAULT nextval('public.support_sla_config_id_seq'::regclass);


--
-- Name: suspension_blocks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks ALTER COLUMN id SET DEFAULT nextval('public.suspension_blocks_id_seq'::regclass);


--
-- Name: system_consciousness_log log_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_consciousness_log ALTER COLUMN log_id SET DEFAULT nextval('public.system_consciousness_log_log_id_seq'::regclass);


--
-- Name: system_metadata metadata_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_metadata ALTER COLUMN metadata_id SET DEFAULT nextval('public.system_metadata_metadata_id_seq'::regclass);


--
-- Name: system_modules_registry registry_id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_modules_registry ALTER COLUMN registry_id SET DEFAULT nextval('public.system_modules_registry_registry_id_seq'::regclass);


--
-- Name: task_compatibility id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility ALTER COLUMN id SET DEFAULT nextval('public.task_compatibility_id_seq'::regclass);


--
-- Name: tax_concepts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_concepts ALTER COLUMN id SET DEFAULT nextval('public.tax_concepts_id_seq'::regclass);


--
-- Name: tax_conditions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_conditions ALTER COLUMN id SET DEFAULT nextval('public.tax_conditions_id_seq'::regclass);


--
-- Name: tax_rates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_rates ALTER COLUMN id SET DEFAULT nextval('public.tax_rates_id_seq'::regclass);


--
-- Name: tax_templates id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_templates ALTER COLUMN id SET DEFAULT nextval('public.tax_templates_id_seq'::regclass);


--
-- Name: test_executions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_executions ALTER COLUMN id SET DEFAULT nextval('public.test_executions_id_seq'::regclass);


--
-- Name: test_results id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_results ALTER COLUMN id SET DEFAULT nextval('public.test_results_id_seq'::regclass);


--
-- Name: testing_tickets id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.testing_tickets ALTER COLUMN id SET DEFAULT nextval('public.testing_tickets_id_seq'::regclass);


--
-- Name: training_assignments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.training_assignments ALTER COLUMN id SET DEFAULT nextval('public.training_assignments_id_seq'::regclass);


--
-- Name: trainings id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trainings ALTER COLUMN id SET DEFAULT nextval('public.trainings_id_seq'::regclass);


--
-- Name: used_tokens id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.used_tokens ALTER COLUMN id SET DEFAULT nextval('public.used_tokens_id_seq'::regclass);


--
-- Name: user_activity_restrictions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_activity_restrictions ALTER COLUMN id SET DEFAULT nextval('public.user_activity_restrictions_id_seq'::regclass);


--
-- Name: user_allergies id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_allergies ALTER COLUMN id SET DEFAULT nextval('public.user_allergies_id_seq'::regclass);


--
-- Name: user_anthropometric_data id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_anthropometric_data ALTER COLUMN id SET DEFAULT nextval('public.user_anthropometric_data_id_seq'::regclass);


--
-- Name: user_assigned_tasks id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks ALTER COLUMN id SET DEFAULT nextval('public.user_assigned_tasks_id_seq'::regclass);


--
-- Name: user_audit_logs id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_audit_logs ALTER COLUMN id SET DEFAULT nextval('public.user_audit_logs_id_seq'::regclass);


--
-- Name: user_children id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_children ALTER COLUMN id SET DEFAULT nextval('public.user_children_id_seq'::regclass);


--
-- Name: user_chronic_conditions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions ALTER COLUMN id SET DEFAULT nextval('public.user_chronic_conditions_id_seq'::regclass);


--
-- Name: user_chronic_conditions_v2 id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions_v2 ALTER COLUMN id SET DEFAULT nextval('public.user_chronic_conditions_v2_id_seq'::regclass);


--
-- Name: user_contact_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contact_history ALTER COLUMN id SET DEFAULT nextval('public.user_contact_history_id_seq'::regclass);


--
-- Name: user_disciplinary_actions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_disciplinary_actions ALTER COLUMN id SET DEFAULT nextval('public.user_disciplinary_actions_id_seq'::regclass);


--
-- Name: user_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_documents ALTER COLUMN id SET DEFAULT nextval('public.user_documents_id_seq'::regclass);


--
-- Name: user_driver_licenses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_driver_licenses ALTER COLUMN id SET DEFAULT nextval('public.user_driver_licenses_id_seq'::regclass);


--
-- Name: user_education id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_education ALTER COLUMN id SET DEFAULT nextval('public.user_education_id_seq'::regclass);


--
-- Name: user_emails id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emails ALTER COLUMN id SET DEFAULT nextval('public.user_emails_id_seq'::regclass);


--
-- Name: user_emergency_contacts id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emergency_contacts ALTER COLUMN id SET DEFAULT nextval('public.user_emergency_contacts_id_seq'::regclass);


--
-- Name: user_family_members id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_family_members ALTER COLUMN id SET DEFAULT nextval('public.user_family_members_id_seq'::regclass);


--
-- Name: user_healthy_habits id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_healthy_habits ALTER COLUMN id SET DEFAULT nextval('public.user_healthy_habits_id_seq'::regclass);


--
-- Name: user_household_members id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_household_members ALTER COLUMN id SET DEFAULT nextval('public.user_household_members_id_seq'::regclass);


--
-- Name: user_legal_issues id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues ALTER COLUMN id SET DEFAULT nextval('public.user_legal_issues_id_seq'::regclass);


--
-- Name: user_marital_status id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_marital_status ALTER COLUMN id SET DEFAULT nextval('public.user_marital_status_id_seq'::regclass);


--
-- Name: user_medical_documents id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_documents ALTER COLUMN id SET DEFAULT nextval('public.user_medical_documents_id_seq'::regclass);


--
-- Name: user_medical_exams id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_exams ALTER COLUMN id SET DEFAULT nextval('public.user_medical_exams_id_seq'::regclass);


--
-- Name: user_medications id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medications ALTER COLUMN id SET DEFAULT nextval('public.user_medications_id_seq'::regclass);


--
-- Name: user_notification_preferences id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_notification_preferences ALTER COLUMN id SET DEFAULT nextval('public.user_notification_preferences_id_seq'::regclass);


--
-- Name: user_payroll_assignment id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment ALTER COLUMN id SET DEFAULT nextval('public.user_payroll_assignment_id_seq'::regclass);


--
-- Name: user_payroll_bonuses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses ALTER COLUMN id SET DEFAULT nextval('public.user_payroll_bonuses_id_seq'::regclass);


--
-- Name: user_payroll_concept_overrides id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides ALTER COLUMN id SET DEFAULT nextval('public.user_payroll_concept_overrides_id_seq'::regclass);


--
-- Name: user_payroll_records id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_records ALTER COLUMN id SET DEFAULT nextval('public.user_payroll_records_id_seq'::regclass);


--
-- Name: user_permission_requests id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permission_requests ALTER COLUMN id SET DEFAULT nextval('public.user_permission_requests_id_seq'::regclass);


--
-- Name: user_primary_physician id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_primary_physician ALTER COLUMN id SET DEFAULT nextval('public.user_primary_physician_id_seq'::regclass);


--
-- Name: user_professional_licenses id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_professional_licenses ALTER COLUMN id SET DEFAULT nextval('public.user_professional_licenses_id_seq'::regclass);


--
-- Name: user_psychiatric_treatments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_psychiatric_treatments ALTER COLUMN id SET DEFAULT nextval('public.user_psychiatric_treatments_id_seq'::regclass);


--
-- Name: user_role_assignments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments ALTER COLUMN id SET DEFAULT nextval('public.user_role_assignments_id_seq'::regclass);


--
-- Name: user_salary_config id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config ALTER COLUMN id SET DEFAULT nextval('public.user_salary_config_id_seq'::regclass);


--
-- Name: user_salary_config_v2 id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config_v2 ALTER COLUMN id SET DEFAULT nextval('public.user_salary_config_v2_id_seq'::regclass);


--
-- Name: user_shift_assignments id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments ALTER COLUMN id SET DEFAULT nextval('public.user_shift_assignments_id_seq'::regclass);


--
-- Name: user_sports_activities id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sports_activities ALTER COLUMN id SET DEFAULT nextval('public.user_sports_activities_id_seq'::regclass);


--
-- Name: user_surgeries id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_surgeries ALTER COLUMN id SET DEFAULT nextval('public.user_surgeries_id_seq'::regclass);


--
-- Name: user_union_affiliation id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_union_affiliation ALTER COLUMN id SET DEFAULT nextval('public.user_union_affiliation_id_seq'::regclass);


--
-- Name: user_vaccinations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_vaccinations ALTER COLUMN id SET DEFAULT nextval('public.user_vaccinations_id_seq'::regclass);


--
-- Name: user_work_history id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_history ALTER COLUMN id SET DEFAULT nextval('public.user_work_history_id_seq'::regclass);


--
-- Name: user_work_restrictions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_restrictions ALTER COLUMN id SET DEFAULT nextval('public.user_work_restrictions_id_seq'::regclass);


--
-- Name: ux_discoveries id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ux_discoveries ALTER COLUMN id SET DEFAULT nextval('public.ux_discoveries_id_seq'::regclass);


--
-- Name: vacation_configurations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_configurations ALTER COLUMN id SET DEFAULT nextval('public.vacation_configurations_id_seq'::regclass);


--
-- Name: vacation_requests id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_requests ALTER COLUMN id SET DEFAULT nextval('public.vacation_requests_id_seq'::regclass);


--
-- Name: vacation_scales id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_scales ALTER COLUMN id SET DEFAULT nextval('public.vacation_scales_id_seq'::regclass);


--
-- Name: vendor_commissions id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions ALTER COLUMN id SET DEFAULT nextval('public.vendor_commissions_id_seq'::regclass);


--
-- Name: vendor_ratings id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_ratings ALTER COLUMN id SET DEFAULT nextval('public.vendor_ratings_id_seq'::regclass);


--
-- Name: vendor_referrals id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals ALTER COLUMN id SET DEFAULT nextval('public.vendor_referrals_id_seq'::regclass);


--
-- Name: visitor_gps_tracking id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.visitor_gps_tracking ALTER COLUMN id SET DEFAULT nextval('public.visitor_gps_tracking_id_seq'::regclass);


--
-- Name: visitors id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.visitors ALTER COLUMN id SET DEFAULT nextval('public.visitors_id_seq'::regclass);


--
-- Name: biometric_alerts pk_biometric_alerts; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_alerts
    ADD CONSTRAINT pk_biometric_alerts PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p0 biometric_alerts_p0_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p0
    ADD CONSTRAINT biometric_alerts_p0_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p10 biometric_alerts_p10_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p10
    ADD CONSTRAINT biometric_alerts_p10_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p11 biometric_alerts_p11_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p11
    ADD CONSTRAINT biometric_alerts_p11_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p12 biometric_alerts_p12_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p12
    ADD CONSTRAINT biometric_alerts_p12_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p13 biometric_alerts_p13_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p13
    ADD CONSTRAINT biometric_alerts_p13_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p14 biometric_alerts_p14_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p14
    ADD CONSTRAINT biometric_alerts_p14_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p15 biometric_alerts_p15_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p15
    ADD CONSTRAINT biometric_alerts_p15_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p1 biometric_alerts_p1_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p1
    ADD CONSTRAINT biometric_alerts_p1_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p2 biometric_alerts_p2_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p2
    ADD CONSTRAINT biometric_alerts_p2_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p3 biometric_alerts_p3_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p3
    ADD CONSTRAINT biometric_alerts_p3_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p4 biometric_alerts_p4_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p4
    ADD CONSTRAINT biometric_alerts_p4_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p5 biometric_alerts_p5_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p5
    ADD CONSTRAINT biometric_alerts_p5_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p6 biometric_alerts_p6_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p6
    ADD CONSTRAINT biometric_alerts_p6_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p7 biometric_alerts_p7_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p7
    ADD CONSTRAINT biometric_alerts_p7_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p8 biometric_alerts_p8_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p8
    ADD CONSTRAINT biometric_alerts_p8_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_alerts_p9 biometric_alerts_p9_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_alerts_p9
    ADD CONSTRAINT biometric_alerts_p9_pkey PRIMARY KEY (alert_id, company_id);


--
-- Name: biometric_scans pk_biometric_scans; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_scans
    ADD CONSTRAINT pk_biometric_scans PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p0 biometric_scans_p0_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p0
    ADD CONSTRAINT biometric_scans_p0_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p10 biometric_scans_p10_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p10
    ADD CONSTRAINT biometric_scans_p10_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p11 biometric_scans_p11_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p11
    ADD CONSTRAINT biometric_scans_p11_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p12 biometric_scans_p12_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p12
    ADD CONSTRAINT biometric_scans_p12_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p13 biometric_scans_p13_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p13
    ADD CONSTRAINT biometric_scans_p13_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p14 biometric_scans_p14_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p14
    ADD CONSTRAINT biometric_scans_p14_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p15 biometric_scans_p15_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p15
    ADD CONSTRAINT biometric_scans_p15_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p1 biometric_scans_p1_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p1
    ADD CONSTRAINT biometric_scans_p1_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p2 biometric_scans_p2_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p2
    ADD CONSTRAINT biometric_scans_p2_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p3 biometric_scans_p3_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p3
    ADD CONSTRAINT biometric_scans_p3_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p4 biometric_scans_p4_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p4
    ADD CONSTRAINT biometric_scans_p4_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p5 biometric_scans_p5_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p5
    ADD CONSTRAINT biometric_scans_p5_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p6 biometric_scans_p6_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p6
    ADD CONSTRAINT biometric_scans_p6_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p7 biometric_scans_p7_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p7
    ADD CONSTRAINT biometric_scans_p7_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p8 biometric_scans_p8_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p8
    ADD CONSTRAINT biometric_scans_p8_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: biometric_scans_p9 biometric_scans_p9_pkey; Type: CONSTRAINT; Schema: biometric_partitions; Owner: -
--

ALTER TABLE ONLY biometric_partitions.biometric_scans_p9
    ADD CONSTRAINT biometric_scans_p9_pkey PRIMARY KEY (scan_id, company_id);


--
-- Name: UserShifts UserShifts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."UserShifts"
    ADD CONSTRAINT "UserShifts_pkey" PRIMARY KEY ("UserUserId", "ShiftId");


--
-- Name: absence_cases absence_cases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_pkey PRIMARY KEY (id);


--
-- Name: access_audit_log access_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_audit_log
    ADD CONSTRAINT access_audit_log_pkey PRIMARY KEY (id);


--
-- Name: access_notifications access_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_notifications
    ADD CONSTRAINT access_notifications_pkey PRIMARY KEY (id);


--
-- Name: additional_role_types additional_role_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.additional_role_types
    ADD CONSTRAINT additional_role_types_pkey PRIMARY KEY (id);


--
-- Name: administrative_tasks administrative_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_pkey PRIMARY KEY (id);


--
-- Name: afip_auth_log afip_auth_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_auth_log
    ADD CONSTRAINT afip_auth_log_pkey PRIMARY KEY (id);


--
-- Name: afip_cae_log afip_cae_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log
    ADD CONSTRAINT afip_cae_log_pkey PRIMARY KEY (id);


--
-- Name: aponnt_admin_tasks aponnt_admin_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_admin_tasks
    ADD CONSTRAINT aponnt_admin_tasks_pkey PRIMARY KEY (id);


--
-- Name: aponnt_associates aponnt_associates_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_associates
    ADD CONSTRAINT aponnt_associates_email_key UNIQUE (email);


--
-- Name: aponnt_associates aponnt_associates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_associates
    ADD CONSTRAINT aponnt_associates_pkey PRIMARY KEY (id);


--
-- Name: aponnt_email_config aponnt_email_config_config_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_email_config
    ADD CONSTRAINT aponnt_email_config_config_type_key UNIQUE (config_type);


--
-- Name: aponnt_email_config aponnt_email_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_email_config
    ADD CONSTRAINT aponnt_email_config_pkey PRIMARY KEY (id);


--
-- Name: aponnt_pre_invoices aponnt_pre_invoices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices
    ADD CONSTRAINT aponnt_pre_invoices_pkey PRIMARY KEY (id);


--
-- Name: aponnt_staff_companies aponnt_staff_companies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff_companies
    ADD CONSTRAINT aponnt_staff_companies_pkey PRIMARY KEY (id);


--
-- Name: aponnt_staff_companies aponnt_staff_companies_staff_id_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff_companies
    ADD CONSTRAINT aponnt_staff_companies_staff_id_company_id_key UNIQUE (staff_id, company_id);


--
-- Name: aponnt_staff aponnt_staff_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_email_key UNIQUE (email);


--
-- Name: aponnt_staff aponnt_staff_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_pkey PRIMARY KEY (staff_id);


--
-- Name: aponnt_staff_roles aponnt_staff_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff_roles
    ADD CONSTRAINT aponnt_staff_roles_pkey PRIMARY KEY (role_id);


--
-- Name: aponnt_staff_roles aponnt_staff_roles_role_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff_roles
    ADD CONSTRAINT aponnt_staff_roles_role_code_key UNIQUE (role_code);


--
-- Name: aponnt_staff aponnt_staff_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_user_id_key UNIQUE (user_id);


--
-- Name: approved_shift_swaps approved_shift_swaps_company_id_employee_1_id_employee_2_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approved_shift_swaps
    ADD CONSTRAINT approved_shift_swaps_company_id_employee_1_id_employee_2_id_key UNIQUE (company_id, employee_1_id, employee_2_id, swap_date);


--
-- Name: approved_shift_swaps approved_shift_swaps_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approved_shift_swaps
    ADD CONSTRAINT approved_shift_swaps_pkey PRIMARY KEY (id);


--
-- Name: art_configurations art_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.art_configurations
    ADD CONSTRAINT art_configurations_pkey PRIMARY KEY (id);


--
-- Name: asset_contracts asset_contracts_contract_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_contract_number_key UNIQUE (contract_number);


--
-- Name: asset_contracts asset_contracts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_pkey PRIMARY KEY (id);


--
-- Name: assistant_action_handlers assistant_action_handlers_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_action_handlers
    ADD CONSTRAINT assistant_action_handlers_pkey PRIMARY KEY (id);


--
-- Name: assistant_conversations assistant_conversations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_conversations
    ADD CONSTRAINT assistant_conversations_pkey PRIMARY KEY (id);


--
-- Name: assistant_knowledge_base assistant_knowledge_base_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_knowledge_base
    ADD CONSTRAINT assistant_knowledge_base_pkey PRIMARY KEY (id);


--
-- Name: associate_employee_assignments associate_employee_assignments_contract_id_employee_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_contract_id_employee_id_key UNIQUE (contract_id, employee_id);


--
-- Name: associate_employee_assignments associate_employee_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_pkey PRIMARY KEY (id);


--
-- Name: attendance_analytics_cache attendance_analytics_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_analytics_cache
    ADD CONSTRAINT attendance_analytics_cache_pkey PRIMARY KEY (id);


--
-- Name: attendance_patterns attendance_patterns_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_patterns
    ADD CONSTRAINT attendance_patterns_pkey PRIMARY KEY (id);


--
-- Name: attendance_profiles attendance_profiles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_profiles
    ADD CONSTRAINT attendance_profiles_pkey PRIMARY KEY (id);


--
-- Name: attendances attendances_authorization_token_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT attendances_authorization_token_key UNIQUE (authorization_token);


--
-- Name: attendances attendances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT attendances_pkey PRIMARY KEY (id);


--
-- Name: audit_logs audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_logs
    ADD CONSTRAINT audit_logs_pkey PRIMARY KEY (id);


--
-- Name: audit_reports audit_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_reports
    ADD CONSTRAINT audit_reports_pkey PRIMARY KEY (id);


--
-- Name: audit_reports audit_reports_verification_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_reports
    ADD CONSTRAINT audit_reports_verification_code_key UNIQUE (verification_code);


--
-- Name: audit_test_logs audit_test_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_test_logs
    ADD CONSTRAINT audit_test_logs_pkey PRIMARY KEY (id);


--
-- Name: benefit_approval_history benefit_approval_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_history
    ADD CONSTRAINT benefit_approval_history_pkey PRIMARY KEY (id);


--
-- Name: benefit_approval_workflows benefit_approval_workflows_company_id_benefit_type_id_appro_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows
    ADD CONSTRAINT benefit_approval_workflows_company_id_benefit_type_id_appro_key UNIQUE (company_id, benefit_type_id, approval_level, sequence_order);


--
-- Name: benefit_approval_workflows benefit_approval_workflows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows
    ADD CONSTRAINT benefit_approval_workflows_pkey PRIMARY KEY (id);


--
-- Name: benefit_document_requirements benefit_document_requirements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_document_requirements
    ADD CONSTRAINT benefit_document_requirements_pkey PRIMARY KEY (id);


--
-- Name: benefit_expense_allowances benefit_expense_allowances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_allowances
    ADD CONSTRAINT benefit_expense_allowances_pkey PRIMARY KEY (id);


--
-- Name: benefit_expense_submissions benefit_expense_submissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions
    ADD CONSTRAINT benefit_expense_submissions_pkey PRIMARY KEY (id);


--
-- Name: benefit_payroll_concepts benefit_payroll_concepts_benefit_type_id_payroll_concept_ty_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts
    ADD CONSTRAINT benefit_payroll_concepts_benefit_type_id_payroll_concept_ty_key UNIQUE (benefit_type_id, payroll_concept_type_id, company_id);


--
-- Name: benefit_payroll_concepts benefit_payroll_concepts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts
    ADD CONSTRAINT benefit_payroll_concepts_pkey PRIMARY KEY (id);


--
-- Name: benefit_types benefit_types_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_types
    ADD CONSTRAINT benefit_types_code_key UNIQUE (code);


--
-- Name: benefit_types benefit_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_types
    ADD CONSTRAINT benefit_types_pkey PRIMARY KEY (id);


--
-- Name: biometric_ai_analysis biometric_ai_analysis_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_ai_analysis
    ADD CONSTRAINT biometric_ai_analysis_pkey PRIMARY KEY (id);


--
-- Name: biometric_analytics_aggregated biometric_analytics_aggregate_company_id_measurement_date_d_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_analytics_aggregated
    ADD CONSTRAINT biometric_analytics_aggregate_company_id_measurement_date_d_key UNIQUE (company_id, measurement_date, department_id, shift_id);


--
-- Name: biometric_analytics_aggregated biometric_analytics_aggregated_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_analytics_aggregated
    ADD CONSTRAINT biometric_analytics_aggregated_pkey PRIMARY KEY (id);


--
-- Name: biometric_audit_log biometric_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_audit_log
    ADD CONSTRAINT biometric_audit_log_pkey PRIMARY KEY (id);


--
-- Name: biometric_capture_attempts biometric_capture_attempts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_capture_attempts
    ADD CONSTRAINT biometric_capture_attempts_pkey PRIMARY KEY (id);


--
-- Name: biometric_company_config biometric_company_config_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_company_config
    ADD CONSTRAINT biometric_company_config_company_id_key UNIQUE (company_id);


--
-- Name: biometric_company_config biometric_company_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_company_config
    ADD CONSTRAINT biometric_company_config_pkey PRIMARY KEY (id);


--
-- Name: biometric_consents biometric_consents_consent_token_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_consent_token_key UNIQUE (consent_token);


--
-- Name: biometric_consents biometric_consents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_pkey PRIMARY KEY (id);


--
-- Name: biometric_data biometric_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_data
    ADD CONSTRAINT biometric_data_pkey PRIMARY KEY (id);


--
-- Name: biometric_detections biometric_detections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_detections
    ADD CONSTRAINT biometric_detections_pkey PRIMARY KEY (id);


--
-- Name: biometric_devices biometric_devices_company_id_device_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_devices
    ADD CONSTRAINT biometric_devices_company_id_device_id_key UNIQUE (company_id, device_id);


--
-- Name: biometric_devices biometric_devices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_devices
    ADD CONSTRAINT biometric_devices_pkey PRIMARY KEY (id);


--
-- Name: biometric_emotional_analysis biometric_emotional_analysis_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_emotional_analysis
    ADD CONSTRAINT biometric_emotional_analysis_pkey PRIMARY KEY (id);


--
-- Name: biometric_events biometric_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_events
    ADD CONSTRAINT biometric_events_pkey PRIMARY KEY (id);


--
-- Name: biometric_settings biometric_settings_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_settings
    ADD CONSTRAINT biometric_settings_company_id_key UNIQUE (company_id);


--
-- Name: biometric_settings biometric_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_settings
    ADD CONSTRAINT biometric_settings_pkey PRIMARY KEY (id);


--
-- Name: biometric_templates biometric_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_templates
    ADD CONSTRAINT biometric_templates_pkey PRIMARY KEY (id);


--
-- Name: branch_offices_fiscal branch_offices_fiscal_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branch_offices_fiscal
    ADD CONSTRAINT branch_offices_fiscal_pkey PRIMARY KEY (id);


--
-- Name: branches branches_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branches
    ADD CONSTRAINT branches_code_key UNIQUE (code);


--
-- Name: branches branches_code_key1; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branches
    ADD CONSTRAINT branches_code_key1 UNIQUE (code);


--
-- Name: branches branches_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branches
    ADD CONSTRAINT branches_pkey PRIMARY KEY (id);


--
-- Name: budgets budgets_budget_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_budget_code_key UNIQUE (budget_code);


--
-- Name: budgets budgets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_pkey PRIMARY KEY (id);


--
-- Name: budgets budgets_trace_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_trace_id_key UNIQUE (trace_id);


--
-- Name: business_validations business_validations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.business_validations
    ADD CONSTRAINT business_validations_pkey PRIMARY KEY (id);


--
-- Name: calendar_events calendar_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_events
    ADD CONSTRAINT calendar_events_pkey PRIMARY KEY (id);


--
-- Name: calendar_integrations calendar_integrations_employee_id_calendar_provider_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_integrations
    ADD CONSTRAINT calendar_integrations_employee_id_calendar_provider_key UNIQUE (employee_id, calendar_provider);


--
-- Name: calendar_integrations calendar_integrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_integrations
    ADD CONSTRAINT calendar_integrations_pkey PRIMARY KEY (id);


--
-- Name: chronic_conditions_catalog chronic_conditions_catalog_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.chronic_conditions_catalog
    ADD CONSTRAINT chronic_conditions_catalog_code_key UNIQUE (code);


--
-- Name: chronic_conditions_catalog chronic_conditions_catalog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.chronic_conditions_catalog
    ADD CONSTRAINT chronic_conditions_catalog_pkey PRIMARY KEY (id);


--
-- Name: commission_liquidations commission_liquidations_liquidation_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_liquidation_code_key UNIQUE (liquidation_code);


--
-- Name: commission_liquidations commission_liquidations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_pkey PRIMARY KEY (id);


--
-- Name: commission_liquidations commission_liquidations_trace_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_trace_id_key UNIQUE (trace_id);


--
-- Name: commission_payments commission_payments_payment_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_payment_code_key UNIQUE (payment_code);


--
-- Name: commission_payments commission_payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_pkey PRIMARY KEY (id);


--
-- Name: commission_payments commission_payments_trace_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_trace_id_key UNIQUE (trace_id);


--
-- Name: companies companies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.companies
    ADD CONSTRAINT companies_pkey PRIMARY KEY (company_id);


--
-- Name: company_account_notifications company_account_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_account_notifications
    ADD CONSTRAINT company_account_notifications_pkey PRIMARY KEY (id);


--
-- Name: company_associate_contracts company_associate_contracts_company_id_associate_id_status_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_company_id_associate_id_status_key UNIQUE (company_id, associate_id, status);


--
-- Name: company_associate_contracts company_associate_contracts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_pkey PRIMARY KEY (id);


--
-- Name: company_benefit_policies company_benefit_policies_company_id_benefit_type_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies
    ADD CONSTRAINT company_benefit_policies_company_id_benefit_type_id_key UNIQUE (company_id, benefit_type_id);


--
-- Name: company_benefit_policies company_benefit_policies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies
    ADD CONSTRAINT company_benefit_policies_pkey PRIMARY KEY (id);


--
-- Name: company_branches company_branches_company_id_branch_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_company_id_branch_code_key UNIQUE (company_id, branch_code);


--
-- Name: company_branches company_branches_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_pkey PRIMARY KEY (id);


--
-- Name: company_communications company_communications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_communications
    ADD CONSTRAINT company_communications_pkey PRIMARY KEY (id);


--
-- Name: company_dependencies company_dependencies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies
    ADD CONSTRAINT company_dependencies_pkey PRIMARY KEY (id);


--
-- Name: company_email_config company_email_config_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_email_config
    ADD CONSTRAINT company_email_config_company_id_key UNIQUE (company_id);


--
-- Name: company_email_config company_email_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_email_config
    ADD CONSTRAINT company_email_config_pkey PRIMARY KEY (id);


--
-- Name: company_fiscal_config company_fiscal_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_fiscal_config
    ADD CONSTRAINT company_fiscal_config_pkey PRIMARY KEY (id);


--
-- Name: company_inbox_processed company_inbox_processed_company_id_message_uid_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_inbox_processed
    ADD CONSTRAINT company_inbox_processed_company_id_message_uid_key UNIQUE (company_id, message_uid);


--
-- Name: company_inbox_processed company_inbox_processed_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_inbox_processed
    ADD CONSTRAINT company_inbox_processed_pkey PRIMARY KEY (id);


--
-- Name: company_medical_staff company_medical_staff_company_id_partner_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_medical_staff
    ADD CONSTRAINT company_medical_staff_company_id_partner_id_key UNIQUE (company_id, partner_id);


--
-- Name: company_medical_staff company_medical_staff_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_medical_staff
    ADD CONSTRAINT company_medical_staff_pkey PRIMARY KEY (id);


--
-- Name: company_modules company_modules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_modules
    ADD CONSTRAINT company_modules_pkey PRIMARY KEY (id);


--
-- Name: company_non_working_days company_non_working_days_company_id_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_non_working_days
    ADD CONSTRAINT company_non_working_days_company_id_date_key UNIQUE (company_id, date);


--
-- Name: company_non_working_days company_non_working_days_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_non_working_days
    ADD CONSTRAINT company_non_working_days_pkey PRIMARY KEY (id);


--
-- Name: company_risk_config company_risk_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_risk_config
    ADD CONSTRAINT company_risk_config_pkey PRIMARY KEY (id);


--
-- Name: company_support_assignments company_support_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_support_assignments
    ADD CONSTRAINT company_support_assignments_pkey PRIMARY KEY (assignment_id);


--
-- Name: company_tasks company_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tasks
    ADD CONSTRAINT company_tasks_pkey PRIMARY KEY (id);


--
-- Name: company_tax_config company_tax_config_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tax_config
    ADD CONSTRAINT company_tax_config_company_id_key UNIQUE (company_id);


--
-- Name: company_tax_config company_tax_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tax_config
    ADD CONSTRAINT company_tax_config_pkey PRIMARY KEY (id);


--
-- Name: comparative_analytics comparative_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.comparative_analytics
    ADD CONSTRAINT comparative_analytics_pkey PRIMARY KEY (id);


--
-- Name: compliance_rules compliance_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_rules
    ADD CONSTRAINT compliance_rules_pkey PRIMARY KEY (id);


--
-- Name: compliance_rules compliance_rules_rule_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_rules
    ADD CONSTRAINT compliance_rules_rule_code_key UNIQUE (rule_code);


--
-- Name: compliance_violations compliance_violations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_pkey PRIMARY KEY (id);


--
-- Name: concept_dependencies concept_dependencies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies
    ADD CONSTRAINT concept_dependencies_pkey PRIMARY KEY (id);


--
-- Name: consent_audit_log consent_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_audit_log
    ADD CONSTRAINT consent_audit_log_pkey PRIMARY KEY (audit_id);


--
-- Name: consent_change_log consent_change_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_change_log
    ADD CONSTRAINT consent_change_log_pkey PRIMARY KEY (id);


--
-- Name: consent_definitions consent_definitions_consent_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_definitions
    ADD CONSTRAINT consent_definitions_consent_key_key UNIQUE (consent_key);


--
-- Name: consent_definitions consent_definitions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_definitions
    ADD CONSTRAINT consent_definitions_pkey PRIMARY KEY (consent_id);


--
-- Name: consent_legal_documents consent_legal_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_legal_documents
    ADD CONSTRAINT consent_legal_documents_pkey PRIMARY KEY (id);


--
-- Name: contextual_help contextual_help_module_key_screen_key_element_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contextual_help
    ADD CONSTRAINT contextual_help_module_key_screen_key_element_key_key UNIQUE (module_key, screen_key, element_key);


--
-- Name: contextual_help contextual_help_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contextual_help
    ADD CONSTRAINT contextual_help_pkey PRIMARY KEY (id);


--
-- Name: contract_apk_licenses contract_apk_licenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_apk_licenses
    ADD CONSTRAINT contract_apk_licenses_pkey PRIMARY KEY (id);


--
-- Name: contract_renewal_logs contract_renewal_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_renewal_logs
    ADD CONSTRAINT contract_renewal_logs_pkey PRIMARY KEY (id);


--
-- Name: contract_template_types contract_template_types_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_template_types
    ADD CONSTRAINT contract_template_types_code_key UNIQUE (code);


--
-- Name: contract_template_types contract_template_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_template_types
    ADD CONSTRAINT contract_template_types_pkey PRIMARY KEY (id);


--
-- Name: contract_templates contract_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates
    ADD CONSTRAINT contract_templates_pkey PRIMARY KEY (id);


--
-- Name: contract_templates contract_templates_template_type_id_country_code_version_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates
    ADD CONSTRAINT contract_templates_template_type_id_country_code_version_key UNIQUE (template_type_id, country_code, version);


--
-- Name: contracts contracts_contract_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_contract_code_key UNIQUE (contract_code);


--
-- Name: contracts contracts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_pkey PRIMARY KEY (id);


--
-- Name: cost_budgets cost_budgets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cost_budgets
    ADD CONSTRAINT cost_budgets_pkey PRIMARY KEY (id);


--
-- Name: cost_transactions cost_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cost_transactions
    ADD CONSTRAINT cost_transactions_pkey PRIMARY KEY (id);


--
-- Name: country_safety_regulations country_safety_regulations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.country_safety_regulations
    ADD CONSTRAINT country_safety_regulations_pkey PRIMARY KEY (country_code);


--
-- Name: data_integrity_log data_integrity_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.data_integrity_log
    ADD CONSTRAINT data_integrity_log_pkey PRIMARY KEY (id);


--
-- Name: department_aliases department_aliases_alias_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.department_aliases
    ADD CONSTRAINT department_aliases_alias_company_id_key UNIQUE (alias, company_id);


--
-- Name: department_aliases department_aliases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.department_aliases
    ADD CONSTRAINT department_aliases_pkey PRIMARY KEY (id);


--
-- Name: departments departments_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_name_key UNIQUE (name);


--
-- Name: departments departments_name_key1; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_name_key1 UNIQUE (name);


--
-- Name: departments departments_name_key2; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_name_key2 UNIQUE (name);


--
-- Name: departments departments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_pkey PRIMARY KEY (id);


--
-- Name: dependency_evaluations dependency_evaluations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations
    ADD CONSTRAINT dependency_evaluations_pkey PRIMARY KEY (id);


--
-- Name: dependency_types dependency_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_types
    ADD CONSTRAINT dependency_types_pkey PRIMARY KEY (id);


--
-- Name: dependency_types dependency_types_type_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_types
    ADD CONSTRAINT dependency_types_type_code_key UNIQUE (type_code);


--
-- Name: dms_access_log dms_access_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_access_log
    ADD CONSTRAINT dms_access_log_pkey PRIMARY KEY (id);


--
-- Name: dms_document_alerts dms_document_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_alerts
    ADD CONSTRAINT dms_document_alerts_pkey PRIMARY KEY (id);


--
-- Name: dms_document_categories dms_document_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_categories
    ADD CONSTRAINT dms_document_categories_pkey PRIMARY KEY (code);


--
-- Name: dms_document_metadata dms_document_metadata_document_id_metadata_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_metadata
    ADD CONSTRAINT dms_document_metadata_document_id_metadata_key_key UNIQUE (document_id, metadata_key);


--
-- Name: dms_document_metadata dms_document_metadata_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_metadata
    ADD CONSTRAINT dms_document_metadata_pkey PRIMARY KEY (id);


--
-- Name: dms_document_permissions dms_document_permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_permissions
    ADD CONSTRAINT dms_document_permissions_pkey PRIMARY KEY (id);


--
-- Name: dms_document_requests dms_document_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_requests
    ADD CONSTRAINT dms_document_requests_pkey PRIMARY KEY (id);


--
-- Name: dms_document_statuses dms_document_statuses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_statuses
    ADD CONSTRAINT dms_document_statuses_pkey PRIMARY KEY (code);


--
-- Name: dms_document_types dms_document_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_types
    ADD CONSTRAINT dms_document_types_pkey PRIMARY KEY (code);


--
-- Name: dms_document_versions dms_document_versions_document_id_version_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_versions
    ADD CONSTRAINT dms_document_versions_document_id_version_number_key UNIQUE (document_id, version_number);


--
-- Name: dms_document_versions dms_document_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_versions
    ADD CONSTRAINT dms_document_versions_pkey PRIMARY KEY (id);


--
-- Name: dms_documents dms_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_documents
    ADD CONSTRAINT dms_documents_pkey PRIMARY KEY (id);


--
-- Name: dms_folders dms_folders_company_id_full_path_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_folders
    ADD CONSTRAINT dms_folders_company_id_full_path_key UNIQUE (company_id, full_path);


--
-- Name: dms_folders dms_folders_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_folders
    ADD CONSTRAINT dms_folders_pkey PRIMARY KEY (id);


--
-- Name: dms_workflow_approvals dms_workflow_approvals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_approvals
    ADD CONSTRAINT dms_workflow_approvals_pkey PRIMARY KEY (id);


--
-- Name: dms_workflow_instances dms_workflow_instances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_instances
    ADD CONSTRAINT dms_workflow_instances_pkey PRIMARY KEY (id);


--
-- Name: dms_workflow_templates dms_workflow_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_templates
    ADD CONSTRAINT dms_workflow_templates_pkey PRIMARY KEY (id);


--
-- Name: document_categories document_categories_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_categories
    ADD CONSTRAINT document_categories_code_key UNIQUE (code);


--
-- Name: document_categories document_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_categories
    ADD CONSTRAINT document_categories_pkey PRIMARY KEY (id);


--
-- Name: document_statuses document_statuses_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_statuses
    ADD CONSTRAINT document_statuses_code_key UNIQUE (code);


--
-- Name: document_statuses document_statuses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_statuses
    ADD CONSTRAINT document_statuses_pkey PRIMARY KEY (id);


--
-- Name: document_types document_types_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_types
    ADD CONSTRAINT document_types_code_key UNIQUE (code);


--
-- Name: document_types document_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_types
    ADD CONSTRAINT document_types_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_applications ecosystem_applications_app_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_applications
    ADD CONSTRAINT ecosystem_applications_app_key_key UNIQUE (app_key);


--
-- Name: ecosystem_applications ecosystem_applications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_applications
    ADD CONSTRAINT ecosystem_applications_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_file_cache ecosystem_file_cache_file_path_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_file_cache
    ADD CONSTRAINT ecosystem_file_cache_file_path_key UNIQUE (file_path);


--
-- Name: ecosystem_file_cache ecosystem_file_cache_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_file_cache
    ADD CONSTRAINT ecosystem_file_cache_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_phases ecosystem_phases_phase_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_phases
    ADD CONSTRAINT ecosystem_phases_phase_key_key UNIQUE (phase_key);


--
-- Name: ecosystem_phases ecosystem_phases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_phases
    ADD CONSTRAINT ecosystem_phases_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_tasks ecosystem_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_tasks
    ADD CONSTRAINT ecosystem_tasks_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_tasks ecosystem_tasks_task_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_tasks
    ADD CONSTRAINT ecosystem_tasks_task_code_key UNIQUE (task_code);


--
-- Name: ecosystem_workflows ecosystem_workflows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_workflows
    ADD CONSTRAINT ecosystem_workflows_pkey PRIMARY KEY (id);


--
-- Name: ecosystem_workflows ecosystem_workflows_workflow_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_workflows
    ADD CONSTRAINT ecosystem_workflows_workflow_key_key UNIQUE (workflow_key);


--
-- Name: email_configurations email_configurations_institutional_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations
    ADD CONSTRAINT email_configurations_institutional_email_key UNIQUE (institutional_email);


--
-- Name: email_configurations email_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations
    ADD CONSTRAINT email_configurations_pkey PRIMARY KEY (id);


--
-- Name: email_inbound_log email_inbound_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_inbound_log
    ADD CONSTRAINT email_inbound_log_pkey PRIMARY KEY (id);


--
-- Name: email_logs email_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs
    ADD CONSTRAINT email_logs_pkey PRIMARY KEY (id);


--
-- Name: email_templates email_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT email_templates_pkey PRIMARY KEY (id);


--
-- Name: email_thread_mapping email_thread_mapping_outbound_message_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_thread_mapping
    ADD CONSTRAINT email_thread_mapping_outbound_message_id_key UNIQUE (outbound_message_id);


--
-- Name: email_thread_mapping email_thread_mapping_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_thread_mapping
    ADD CONSTRAINT email_thread_mapping_pkey PRIMARY KEY (id);


--
-- Name: email_verification_tokens email_verification_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_verification_tokens
    ADD CONSTRAINT email_verification_tokens_pkey PRIMARY KEY (token_id);


--
-- Name: email_verification_tokens email_verification_tokens_token_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_verification_tokens
    ADD CONSTRAINT email_verification_tokens_token_key UNIQUE (token);


--
-- Name: employee_assigned_assets employee_assigned_assets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_assigned_assets
    ADD CONSTRAINT employee_assigned_assets_pkey PRIMARY KEY (id);


--
-- Name: employee_benefit_documents employee_benefit_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents
    ADD CONSTRAINT employee_benefit_documents_pkey PRIMARY KEY (id);


--
-- Name: employee_benefits employee_benefits_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_pkey PRIMARY KEY (id);


--
-- Name: employee_dependency_documents employee_dependency_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_pkey PRIMARY KEY (id);


--
-- Name: employee_documents employee_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_documents
    ADD CONSTRAINT employee_documents_pkey PRIMARY KEY (id);


--
-- Name: employee_locations employee_locations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_locations
    ADD CONSTRAINT employee_locations_pkey PRIMARY KEY (id);


--
-- Name: employee_ppe_consents employee_ppe_consents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_ppe_consents
    ADD CONSTRAINT employee_ppe_consents_pkey PRIMARY KEY (id);


--
-- Name: epp_catalog epp_catalog_company_id_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_catalog
    ADD CONSTRAINT epp_catalog_company_id_code_key UNIQUE (company_id, code);


--
-- Name: epp_catalog epp_catalog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_catalog
    ADD CONSTRAINT epp_catalog_pkey PRIMARY KEY (id);


--
-- Name: epp_categories epp_categories_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_categories
    ADD CONSTRAINT epp_categories_code_key UNIQUE (code);


--
-- Name: epp_categories epp_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_categories
    ADD CONSTRAINT epp_categories_pkey PRIMARY KEY (id);


--
-- Name: epp_deliveries epp_deliveries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries
    ADD CONSTRAINT epp_deliveries_pkey PRIMARY KEY (id);


--
-- Name: epp_inspections epp_inspections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_inspections
    ADD CONSTRAINT epp_inspections_pkey PRIMARY KEY (id);


--
-- Name: epp_role_requirements epp_role_requirements_company_id_position_id_epp_catalog_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements
    ADD CONSTRAINT epp_role_requirements_company_id_position_id_epp_catalog_id_key UNIQUE (company_id, position_id, epp_catalog_id);


--
-- Name: epp_role_requirements epp_role_requirements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements
    ADD CONSTRAINT epp_role_requirements_pkey PRIMARY KEY (id);


--
-- Name: extraordinary_licenses extraordinary_licenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.extraordinary_licenses
    ADD CONSTRAINT extraordinary_licenses_pkey PRIMARY KEY (id);


--
-- Name: facial_biometric_data facial_biometric_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.facial_biometric_data
    ADD CONSTRAINT facial_biometric_data_pkey PRIMARY KEY (id);


--
-- Name: fingerprint_biometric_data fingerprint_biometric_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fingerprint_biometric_data
    ADD CONSTRAINT fingerprint_biometric_data_pkey PRIMARY KEY (id);


--
-- Name: holidays holidays_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.holidays
    ADD CONSTRAINT holidays_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_agreements hour_bank_agreements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_agreements
    ADD CONSTRAINT hour_bank_agreements_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_balances hour_bank_balances_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_balances hour_bank_balances_user_id_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_user_id_company_id_key UNIQUE (user_id, company_id);


--
-- Name: hour_bank_blackout_dates hour_bank_blackout_dates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates
    ADD CONSTRAINT hour_bank_blackout_dates_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_budgets hour_bank_budgets_company_id_branch_id_department_id_period_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_budgets
    ADD CONSTRAINT hour_bank_budgets_company_id_branch_id_department_id_period_key UNIQUE (company_id, branch_id, department_id, period_start);


--
-- Name: hour_bank_budgets hour_bank_budgets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_budgets
    ADD CONSTRAINT hour_bank_budgets_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_loans hour_bank_loans_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_loans
    ADD CONSTRAINT hour_bank_loans_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_metrics_aggregated hour_bank_metrics_aggregated_aggregation_level_company_id_b_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_metrics_aggregated
    ADD CONSTRAINT hour_bank_metrics_aggregated_aggregation_level_company_id_b_key UNIQUE (aggregation_level, company_id, branch_id, department_id, user_id, period_type, period_date);


--
-- Name: hour_bank_metrics_aggregated hour_bank_metrics_aggregated_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_metrics_aggregated
    ADD CONSTRAINT hour_bank_metrics_aggregated_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_pending_decisions hour_bank_pending_decisions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_pending_decisions
    ADD CONSTRAINT hour_bank_pending_decisions_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_redemption_history hour_bank_redemption_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_history
    ADD CONSTRAINT hour_bank_redemption_history_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_requests hour_bank_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_risk_analysis hour_bank_risk_analysis_company_id_user_id_analysis_date_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_risk_analysis
    ADD CONSTRAINT hour_bank_risk_analysis_company_id_user_id_analysis_date_key UNIQUE (company_id, user_id, analysis_date);


--
-- Name: hour_bank_risk_analysis hour_bank_risk_analysis_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_risk_analysis
    ADD CONSTRAINT hour_bank_risk_analysis_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_scheduled_redemptions hour_bank_scheduled_redemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_scheduled_redemptions
    ADD CONSTRAINT hour_bank_scheduled_redemptions_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_templates hour_bank_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates
    ADD CONSTRAINT hour_bank_templates_pkey PRIMARY KEY (id);


--
-- Name: hour_bank_transactions hour_bank_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_pkey PRIMARY KEY (id);


--
-- Name: hse_cases hse_cases_case_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_cases
    ADD CONSTRAINT hse_cases_case_number_key UNIQUE (case_number);


--
-- Name: hse_cases hse_cases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_cases
    ADD CONSTRAINT hse_cases_pkey PRIMARY KEY (id);


--
-- Name: hse_company_config hse_company_config_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_company_config
    ADD CONSTRAINT hse_company_config_company_id_key UNIQUE (company_id);


--
-- Name: hse_company_config hse_company_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_company_config
    ADD CONSTRAINT hse_company_config_pkey PRIMARY KEY (id);


--
-- Name: hse_ppe_detections hse_ppe_detections_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_ppe_detections
    ADD CONSTRAINT hse_ppe_detections_pkey PRIMARY KEY (id);


--
-- Name: hse_ppe_stats hse_ppe_stats_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_ppe_stats
    ADD CONSTRAINT hse_ppe_stats_pkey PRIMARY KEY (id);


--
-- Name: hse_violation_catalog hse_violation_catalog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_violation_catalog
    ADD CONSTRAINT hse_violation_catalog_pkey PRIMARY KEY (code);


--
-- Name: hse_zone_configurations hse_zone_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_zone_configurations
    ADD CONSTRAINT hse_zone_configurations_pkey PRIMARY KEY (id);


--
-- Name: biometric_emotional_analysis idx_emotional_analysis_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_emotional_analysis
    ADD CONSTRAINT idx_emotional_analysis_unique UNIQUE (company_id, user_id, scan_timestamp);


--
-- Name: invoices invoices_invoice_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_invoice_number_key UNIQUE (invoice_number);


--
-- Name: invoices invoices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_pkey PRIMARY KEY (id);


--
-- Name: job_application_notes job_application_notes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_application_notes
    ADD CONSTRAINT job_application_notes_pkey PRIMARY KEY (id);


--
-- Name: job_applications job_applications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_pkey PRIMARY KEY (id);


--
-- Name: job_postings job_postings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_pkey PRIMARY KEY (id);


--
-- Name: kiosks kiosks_device_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kiosks
    ADD CONSTRAINT kiosks_device_id_key UNIQUE (device_id);


--
-- Name: kiosks kiosks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kiosks
    ADD CONSTRAINT kiosks_pkey PRIMARY KEY (id);


--
-- Name: kiosks kiosks_unique_name_per_company; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kiosks
    ADD CONSTRAINT kiosks_unique_name_per_company UNIQUE (name, company_id);


--
-- Name: labor_agreements_catalog labor_agreements_catalog_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_catalog
    ADD CONSTRAINT labor_agreements_catalog_code_key UNIQUE (code);


--
-- Name: labor_agreements_catalog labor_agreements_catalog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_catalog
    ADD CONSTRAINT labor_agreements_catalog_pkey PRIMARY KEY (id);


--
-- Name: labor_agreements_v2 labor_agreements_v2_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_v2
    ADD CONSTRAINT labor_agreements_v2_pkey PRIMARY KEY (id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_pkey PRIMARY KEY (id);


--
-- Name: learning_patterns learning_patterns_module_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.learning_patterns
    ADD CONSTRAINT learning_patterns_module_key_key UNIQUE (module_key);


--
-- Name: learning_patterns learning_patterns_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.learning_patterns
    ADD CONSTRAINT learning_patterns_pkey PRIMARY KEY (id);


--
-- Name: legal_ai_analysis legal_ai_analysis_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_pkey PRIMARY KEY (id);


--
-- Name: legal_case_documents legal_case_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_pkey PRIMARY KEY (id);


--
-- Name: legal_case_parties legal_case_parties_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_parties
    ADD CONSTRAINT legal_case_parties_pkey PRIMARY KEY (id);


--
-- Name: legal_case_stages legal_case_stages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_stages
    ADD CONSTRAINT legal_case_stages_pkey PRIMARY KEY (id);


--
-- Name: legal_case_timeline_events legal_case_timeline_events_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events
    ADD CONSTRAINT legal_case_timeline_events_pkey PRIMARY KEY (id);


--
-- Name: legal_cases legal_cases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_pkey PRIMARY KEY (id);


--
-- Name: legal_communication_types legal_communication_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communication_types
    ADD CONSTRAINT legal_communication_types_pkey PRIMARY KEY (id);


--
-- Name: legal_communications legal_communications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_pkey PRIMARY KEY (id);


--
-- Name: legal_communications legal_communications_reference_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_reference_number_key UNIQUE (reference_number);


--
-- Name: legal_deadlines legal_deadlines_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_pkey PRIMARY KEY (id);


--
-- Name: legal_document_alerts legal_document_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts
    ADD CONSTRAINT legal_document_alerts_pkey PRIMARY KEY (id);


--
-- Name: legal_edit_authorizations legal_edit_authorizations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_edit_authorizations
    ADD CONSTRAINT legal_edit_authorizations_pkey PRIMARY KEY (id);


--
-- Name: medical_absence_types medical_absence_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_absence_types
    ADD CONSTRAINT medical_absence_types_pkey PRIMARY KEY (code);


--
-- Name: medical_certificates medical_certificates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_pkey PRIMARY KEY (id);


--
-- Name: medical_communications medical_communications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_communications
    ADD CONSTRAINT medical_communications_pkey PRIMARY KEY (id);


--
-- Name: medical_diagnoses medical_diagnoses_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_diagnoses
    ADD CONSTRAINT medical_diagnoses_code_key UNIQUE (code);


--
-- Name: medical_diagnoses medical_diagnoses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_diagnoses
    ADD CONSTRAINT medical_diagnoses_pkey PRIMARY KEY (id);


--
-- Name: medical_edit_authorizations medical_edit_authorizations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations
    ADD CONSTRAINT medical_edit_authorizations_pkey PRIMARY KEY (id);


--
-- Name: medical_exam_templates medical_exam_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_exam_templates
    ADD CONSTRAINT medical_exam_templates_pkey PRIMARY KEY (id);


--
-- Name: medical_leaves medical_leaves_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_leaves
    ADD CONSTRAINT medical_leaves_pkey PRIMARY KEY (id);


--
-- Name: medical_record_audit_log medical_record_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_record_audit_log
    ADD CONSTRAINT medical_record_audit_log_pkey PRIMARY KEY (id);


--
-- Name: medical_records medical_records_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_pkey PRIMARY KEY (id);


--
-- Name: medical_staff medical_staff_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_email_key UNIQUE (email);


--
-- Name: medical_staff medical_staff_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_pkey PRIMARY KEY (id);


--
-- Name: medical_staff medical_staff_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_user_id_key UNIQUE (user_id);


--
-- Name: messages messages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.messages
    ADD CONSTRAINT messages_pkey PRIMARY KEY (id);


--
-- Name: migration_log migration_log_migration_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.migration_log
    ADD CONSTRAINT migration_log_migration_name_key UNIQUE (migration_name);


--
-- Name: migration_log migration_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.migration_log
    ADD CONSTRAINT migration_log_pkey PRIMARY KEY (id);


--
-- Name: module_actions module_actions_module_key_action_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.module_actions
    ADD CONSTRAINT module_actions_module_key_action_name_key UNIQUE (module_key, action_name);


--
-- Name: module_actions module_actions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.module_actions
    ADD CONSTRAINT module_actions_pkey PRIMARY KEY (id);


--
-- Name: module_definitions module_definitions_module_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.module_definitions
    ADD CONSTRAINT module_definitions_module_key_key UNIQUE (module_key);


--
-- Name: module_definitions module_definitions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.module_definitions
    ADD CONSTRAINT module_definitions_pkey PRIMARY KEY (id);


--
-- Name: multiple_art_configurations multiple_art_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.multiple_art_configurations
    ADD CONSTRAINT multiple_art_configurations_pkey PRIMARY KEY (id);


--
-- Name: notification_actions_log notification_actions_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_actions_log
    ADD CONSTRAINT notification_actions_log_pkey PRIMARY KEY (id);


--
-- Name: notification_ai_learning notification_ai_learning_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_ai_learning
    ADD CONSTRAINT notification_ai_learning_pkey PRIMARY KEY (id);


--
-- Name: notification_ai_suggestions notification_ai_suggestions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_ai_suggestions
    ADD CONSTRAINT notification_ai_suggestions_pkey PRIMARY KEY (id);


--
-- Name: notification_audit_log notification_audit_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_audit_log
    ADD CONSTRAINT notification_audit_log_pkey PRIMARY KEY (id);


--
-- Name: notification_context_data notification_context_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_context_data
    ADD CONSTRAINT notification_context_data_pkey PRIMARY KEY (id);


--
-- Name: notification_escalations notification_escalations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_escalations
    ADD CONSTRAINT notification_escalations_pkey PRIMARY KEY (id);


--
-- Name: notification_faq_patterns notification_faq_patterns_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_faq_patterns
    ADD CONSTRAINT notification_faq_patterns_pkey PRIMARY KEY (id);


--
-- Name: notification_flow_templates notification_flow_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_flow_templates
    ADD CONSTRAINT notification_flow_templates_pkey PRIMARY KEY (id);


--
-- Name: notification_groups notification_groups_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_groups
    ADD CONSTRAINT notification_groups_pkey PRIMARY KEY (id);


--
-- Name: notification_learned_responses notification_learned_responses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_learned_responses
    ADD CONSTRAINT notification_learned_responses_pkey PRIMARY KEY (id);


--
-- Name: notification_messages notification_messages_group_id_sequence_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_messages
    ADD CONSTRAINT notification_messages_group_id_sequence_number_key UNIQUE (group_id, sequence_number);


--
-- Name: notification_messages notification_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_messages
    ADD CONSTRAINT notification_messages_pkey PRIMARY KEY (id);


--
-- Name: notification_participant_types notification_participant_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_participant_types
    ADD CONSTRAINT notification_participant_types_pkey PRIMARY KEY (id);


--
-- Name: notification_participant_types notification_participant_types_type_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_participant_types
    ADD CONSTRAINT notification_participant_types_type_code_key UNIQUE (type_code);


--
-- Name: notification_queue notification_queue_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_queue
    ADD CONSTRAINT notification_queue_pkey PRIMARY KEY (id);


--
-- Name: notification_sla_config notification_sla_config_company_id_notification_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_config
    ADD CONSTRAINT notification_sla_config_company_id_notification_type_key UNIQUE (company_id, notification_type);


--
-- Name: notification_sla_config notification_sla_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_config
    ADD CONSTRAINT notification_sla_config_pkey PRIMARY KEY (id);


--
-- Name: notification_sla_records notification_sla_records_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_records
    ADD CONSTRAINT notification_sla_records_pkey PRIMARY KEY (id);


--
-- Name: notification_templates notification_templates_company_id_template_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_templates
    ADD CONSTRAINT notification_templates_company_id_template_key_key UNIQUE (company_id, template_key);


--
-- Name: notification_templates notification_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_templates
    ADD CONSTRAINT notification_templates_pkey PRIMARY KEY (id);


--
-- Name: notification_thread_analysis notification_thread_analysis_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_thread_analysis
    ADD CONSTRAINT notification_thread_analysis_pkey PRIMARY KEY (id);


--
-- Name: notification_threads notification_threads_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_threads
    ADD CONSTRAINT notification_threads_pkey PRIMARY KEY (id);


--
-- Name: notification_workflows notification_workflows_company_id_workflow_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_workflows
    ADD CONSTRAINT notification_workflows_company_id_workflow_key_key UNIQUE (company_id, workflow_key);


--
-- Name: notification_workflows notification_workflows_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_workflows
    ADD CONSTRAINT notification_workflows_pkey PRIMARY KEY (id);


--
-- Name: notifications_enterprise notifications_enterprise_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications_enterprise
    ADD CONSTRAINT notifications_enterprise_pkey PRIMARY KEY (id);


--
-- Name: notifications notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_pkey PRIMARY KEY (id);


--
-- Name: notifications notifications_uuid_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_uuid_key UNIQUE (uuid);


--
-- Name: oh_certification_alert_config oh_certification_alert_config_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alert_config
    ADD CONSTRAINT oh_certification_alert_config_company_id_key UNIQUE (company_id);


--
-- Name: oh_certification_alert_config oh_certification_alert_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alert_config
    ADD CONSTRAINT oh_certification_alert_config_pkey PRIMARY KEY (id);


--
-- Name: oh_certification_alerts oh_certification_alerts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alerts
    ADD CONSTRAINT oh_certification_alerts_pkey PRIMARY KEY (id);


--
-- Name: oh_certification_types oh_certification_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_types
    ADD CONSTRAINT oh_certification_types_pkey PRIMARY KEY (id);


--
-- Name: oh_certification_types oh_certification_types_type_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_types
    ADD CONSTRAINT oh_certification_types_type_code_key UNIQUE (type_code);


--
-- Name: oh_claim_documents oh_claim_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_documents
    ADD CONSTRAINT oh_claim_documents_pkey PRIMARY KEY (id);


--
-- Name: oh_claim_status_history oh_claim_status_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_status_history
    ADD CONSTRAINT oh_claim_status_history_pkey PRIMARY KEY (id);


--
-- Name: oh_claim_types oh_claim_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_types
    ADD CONSTRAINT oh_claim_types_pkey PRIMARY KEY (id);


--
-- Name: oh_claim_types oh_claim_types_region_type_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_types
    ADD CONSTRAINT oh_claim_types_region_type_code_key UNIQUE (region, type_code);


--
-- Name: oh_employee_certifications oh_employee_certifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications
    ADD CONSTRAINT oh_employee_certifications_pkey PRIMARY KEY (id);


--
-- Name: oh_pre_employment_screenings oh_pre_employment_screenings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_pre_employment_screenings
    ADD CONSTRAINT oh_pre_employment_screenings_pkey PRIMARY KEY (id);


--
-- Name: oh_screening_config oh_screening_config_company_id_country_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_config
    ADD CONSTRAINT oh_screening_config_company_id_country_code_key UNIQUE (company_id, country_code);


--
-- Name: oh_screening_config oh_screening_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_config
    ADD CONSTRAINT oh_screening_config_pkey PRIMARY KEY (id);


--
-- Name: oh_screening_documents oh_screening_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_documents
    ADD CONSTRAINT oh_screening_documents_pkey PRIMARY KEY (id);


--
-- Name: oh_screening_results oh_screening_results_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_results
    ADD CONSTRAINT oh_screening_results_pkey PRIMARY KEY (id);


--
-- Name: oh_screening_types oh_screening_types_code_region_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_types
    ADD CONSTRAINT oh_screening_types_code_region_key UNIQUE (code, region);


--
-- Name: oh_screening_types oh_screening_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_types
    ADD CONSTRAINT oh_screening_types_pkey PRIMARY KEY (id);


--
-- Name: oh_workers_compensation_claims oh_workers_compensation_claims_claim_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_workers_compensation_claims
    ADD CONSTRAINT oh_workers_compensation_claims_claim_number_key UNIQUE (claim_number);


--
-- Name: oh_workers_compensation_claims oh_workers_compensation_claims_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_workers_compensation_claims
    ADD CONSTRAINT oh_workers_compensation_claims_pkey PRIMARY KEY (id);


--
-- Name: organizational_positions organizational_positions_company_id_position_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_company_id_position_code_key UNIQUE (company_id, position_code);


--
-- Name: organizational_positions organizational_positions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_pkey PRIMARY KEY (id);


--
-- Name: partner_commission_summaries partner_commission_summaries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_summaries
    ADD CONSTRAINT partner_commission_summaries_pkey PRIMARY KEY (id);


--
-- Name: partner_commission_transactions partner_commission_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_transactions
    ADD CONSTRAINT partner_commission_transactions_pkey PRIMARY KEY (id);


--
-- Name: partner_commissions partner_commissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commissions
    ADD CONSTRAINT partner_commissions_pkey PRIMARY KEY (id);


--
-- Name: partner_roles partner_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_roles
    ADD CONSTRAINT partner_roles_pkey PRIMARY KEY (id);


--
-- Name: partner_roles partner_roles_role_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_roles
    ADD CONSTRAINT partner_roles_role_name_key UNIQUE (role_name);


--
-- Name: partners partners_dni_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partners
    ADD CONSTRAINT partners_dni_key UNIQUE (dni);


--
-- Name: partners partners_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partners
    ADD CONSTRAINT partners_email_key UNIQUE (email);


--
-- Name: partners partners_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partners
    ADD CONSTRAINT partners_pkey PRIMARY KEY (id);


--
-- Name: partners partners_username_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partners
    ADD CONSTRAINT partners_username_key UNIQUE (username);


--
-- Name: password_auth_attempts password_auth_attempts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.password_auth_attempts
    ADD CONSTRAINT password_auth_attempts_pkey PRIMARY KEY (id);


--
-- Name: payments payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_pkey PRIMARY KEY (id);


--
-- Name: payroll_concept_classifications payroll_concept_classifications_classification_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_classifications
    ADD CONSTRAINT payroll_concept_classifications_classification_code_key UNIQUE (classification_code);


--
-- Name: payroll_concept_classifications payroll_concept_classifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_classifications
    ADD CONSTRAINT payroll_concept_classifications_pkey PRIMARY KEY (id);


--
-- Name: payroll_concept_type_rates payroll_concept_type_rates_concept_type_id_country_id_effec_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_type_rates
    ADD CONSTRAINT payroll_concept_type_rates_concept_type_id_country_id_effec_key UNIQUE (concept_type_id, country_id, effective_from);


--
-- Name: payroll_concept_type_rates payroll_concept_type_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_type_rates
    ADD CONSTRAINT payroll_concept_type_rates_pkey PRIMARY KEY (id);


--
-- Name: payroll_concept_types payroll_concept_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types
    ADD CONSTRAINT payroll_concept_types_pkey PRIMARY KEY (id);


--
-- Name: payroll_concept_types payroll_concept_types_type_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types
    ADD CONSTRAINT payroll_concept_types_type_code_key UNIQUE (type_code);


--
-- Name: payroll_countries payroll_countries_country_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_countries
    ADD CONSTRAINT payroll_countries_country_code_key UNIQUE (country_code);


--
-- Name: payroll_countries payroll_countries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_countries
    ADD CONSTRAINT payroll_countries_pkey PRIMARY KEY (id);


--
-- Name: payroll_entities payroll_entities_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entities
    ADD CONSTRAINT payroll_entities_pkey PRIMARY KEY (entity_id);


--
-- Name: payroll_entity_categories payroll_entity_categories_country_id_company_id_category_co_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_categories
    ADD CONSTRAINT payroll_entity_categories_country_id_company_id_category_co_key UNIQUE NULLS NOT DISTINCT (country_id, company_id, category_code);


--
-- Name: payroll_entity_categories payroll_entity_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_categories
    ADD CONSTRAINT payroll_entity_categories_pkey PRIMARY KEY (id);


--
-- Name: payroll_entity_settlement_details payroll_entity_settlement_details_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlement_details
    ADD CONSTRAINT payroll_entity_settlement_details_pkey PRIMARY KEY (detail_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_pkey PRIMARY KEY (settlement_id);


--
-- Name: payroll_payslip_block_types payroll_payslip_block_types_block_type_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_block_types
    ADD CONSTRAINT payroll_payslip_block_types_block_type_key UNIQUE (block_type);


--
-- Name: payroll_payslip_block_types payroll_payslip_block_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_block_types
    ADD CONSTRAINT payroll_payslip_block_types_pkey PRIMARY KEY (id);


--
-- Name: payroll_payslip_templates payroll_payslip_templates_company_id_template_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_templates
    ADD CONSTRAINT payroll_payslip_templates_company_id_template_code_key UNIQUE (company_id, template_code);


--
-- Name: payroll_payslip_templates payroll_payslip_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_templates
    ADD CONSTRAINT payroll_payslip_templates_pkey PRIMARY KEY (id);


--
-- Name: payroll_run_concept_details payroll_run_concept_details_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details
    ADD CONSTRAINT payroll_run_concept_details_pkey PRIMARY KEY (id);


--
-- Name: payroll_run_details payroll_run_details_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_details
    ADD CONSTRAINT payroll_run_details_pkey PRIMARY KEY (id);


--
-- Name: payroll_runs payroll_runs_company_id_run_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_company_id_run_code_key UNIQUE (company_id, run_code);


--
-- Name: payroll_runs payroll_runs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_pkey PRIMARY KEY (id);


--
-- Name: payroll_template_concepts payroll_template_concepts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts
    ADD CONSTRAINT payroll_template_concepts_pkey PRIMARY KEY (id);


--
-- Name: payroll_template_concepts payroll_template_concepts_template_id_concept_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts
    ADD CONSTRAINT payroll_template_concepts_template_id_concept_code_key UNIQUE (template_id, concept_code);


--
-- Name: payroll_templates payroll_templates_company_id_template_code_version_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_company_id_template_code_version_key UNIQUE (company_id, template_code, version);


--
-- Name: payroll_templates payroll_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_pkey PRIMARY KEY (id);


--
-- Name: partner_commission_summaries pcs_unique_period; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_summaries
    ADD CONSTRAINT pcs_unique_period UNIQUE (partner_id, year, month);


--
-- Name: permissions permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.permissions
    ADD CONSTRAINT permissions_pkey PRIMARY KEY (id);


--
-- Name: proactive_executions proactive_executions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proactive_executions
    ADD CONSTRAINT proactive_executions_pkey PRIMARY KEY (id);


--
-- Name: proactive_rules proactive_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proactive_rules
    ADD CONSTRAINT proactive_rules_pkey PRIMARY KEY (id);


--
-- Name: procedure_acknowledgements procedure_acknowledgements_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_acknowledgements
    ADD CONSTRAINT procedure_acknowledgements_pkey PRIMARY KEY (id);


--
-- Name: procedure_acknowledgements procedure_acknowledgements_procedure_id_procedure_version_i_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_acknowledgements
    ADD CONSTRAINT procedure_acknowledgements_procedure_id_procedure_version_i_key UNIQUE (procedure_id, procedure_version_id, user_id);


--
-- Name: procedure_attachments procedure_attachments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_attachments
    ADD CONSTRAINT procedure_attachments_pkey PRIMARY KEY (id);


--
-- Name: procedure_comments procedure_comments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_comments
    ADD CONSTRAINT procedure_comments_pkey PRIMARY KEY (id);


--
-- Name: procedure_draft_locks procedure_draft_locks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_draft_locks
    ADD CONSTRAINT procedure_draft_locks_pkey PRIMARY KEY (id);


--
-- Name: procedure_roles procedure_roles_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_roles
    ADD CONSTRAINT procedure_roles_pkey PRIMARY KEY (id);


--
-- Name: procedure_roles procedure_roles_procedure_id_organizational_position_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_roles
    ADD CONSTRAINT procedure_roles_procedure_id_organizational_position_id_key UNIQUE (procedure_id, organizational_position_id);


--
-- Name: procedure_versions procedure_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_versions
    ADD CONSTRAINT procedure_versions_pkey PRIMARY KEY (id);


--
-- Name: procedure_versions procedure_versions_procedure_id_version_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_versions
    ADD CONSTRAINT procedure_versions_procedure_id_version_number_key UNIQUE (procedure_id, version_number);


--
-- Name: procedures procedures_company_id_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_company_id_code_key UNIQUE (company_id, code);


--
-- Name: procedures procedures_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_pkey PRIMARY KEY (id);


--
-- Name: report_access_log report_access_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.report_access_log
    ADD CONSTRAINT report_access_log_pkey PRIMARY KEY (id);


--
-- Name: request_types request_types_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.request_types
    ADD CONSTRAINT request_types_code_key UNIQUE (code);


--
-- Name: request_types request_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.request_types
    ADD CONSTRAINT request_types_pkey PRIMARY KEY (id);


--
-- Name: risk_benchmarks risk_benchmarks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_benchmarks
    ADD CONSTRAINT risk_benchmarks_pkey PRIMARY KEY (id);


--
-- Name: role_definitions role_definitions_company_id_role_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_definitions
    ADD CONSTRAINT role_definitions_company_id_role_key_key UNIQUE (company_id, role_key);


--
-- Name: role_definitions role_definitions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_definitions
    ADD CONSTRAINT role_definitions_pkey PRIMARY KEY (id);


--
-- Name: role_template_permissions role_template_permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_template_permissions
    ADD CONSTRAINT role_template_permissions_pkey PRIMARY KEY (id);


--
-- Name: role_template_permissions role_template_permissions_role_template_id_action_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_template_permissions
    ADD CONSTRAINT role_template_permissions_role_template_id_action_id_key UNIQUE (role_template_id, action_id);


--
-- Name: salary_categories salary_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories
    ADD CONSTRAINT salary_categories_pkey PRIMARY KEY (id);


--
-- Name: salary_categories_v2 salary_categories_v2_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories_v2
    ADD CONSTRAINT salary_categories_v2_pkey PRIMARY KEY (id);


--
-- Name: sanction_history sanction_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_history
    ADD CONSTRAINT sanction_history_pkey PRIMARY KEY (id);


--
-- Name: sanction_types sanction_types_company_id_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_types
    ADD CONSTRAINT sanction_types_company_id_code_key UNIQUE (company_id, code);


--
-- Name: sanction_types sanction_types_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_types
    ADD CONSTRAINT sanction_types_pkey PRIMARY KEY (id);


--
-- Name: sanctions sanctions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_pkey PRIMARY KEY (id);


--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schema_migrations
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);


--
-- Name: scoring_history scoring_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scoring_history
    ADD CONSTRAINT scoring_history_pkey PRIMARY KEY (id);


--
-- Name: sectors sectors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sectors
    ADD CONSTRAINT sectors_pkey PRIMARY KEY (id);


--
-- Name: shifts shifts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.shifts
    ADD CONSTRAINT shifts_pkey PRIMARY KEY (id);


--
-- Name: siac_cajas siac_cajas_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_cajas
    ADD CONSTRAINT siac_cajas_pkey PRIMARY KEY (id);


--
-- Name: siac_cajas siac_cajas_punto_venta_id_codigo_caja_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_cajas
    ADD CONSTRAINT siac_cajas_punto_venta_id_codigo_caja_key UNIQUE (punto_venta_id, codigo_caja);


--
-- Name: siac_productos_categorias siac_categorias_codigo_company_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_categorias
    ADD CONSTRAINT siac_categorias_codigo_company_uk UNIQUE (company_id, codigo_categoria);


--
-- Name: siac_clientes siac_clientes_codigo_company_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes
    ADD CONSTRAINT siac_clientes_codigo_company_uk UNIQUE (company_id, codigo_cliente);


--
-- Name: siac_clientes_contactos siac_clientes_contactos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_contactos
    ADD CONSTRAINT siac_clientes_contactos_pkey PRIMARY KEY (id);


--
-- Name: siac_clientes_direcciones siac_clientes_direcciones_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_direcciones
    ADD CONSTRAINT siac_clientes_direcciones_pkey PRIMARY KEY (id);


--
-- Name: siac_clientes siac_clientes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes
    ADD CONSTRAINT siac_clientes_pkey PRIMARY KEY (id);


--
-- Name: siac_clientes_precios_especiales siac_clientes_precios_especiales_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_clientes_precios_especiales
    ADD CONSTRAINT siac_clientes_precios_especiales_pkey PRIMARY KEY (id);


--
-- Name: siac_configuracion_empresa siac_configuracion_empresa_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_empresa
    ADD CONSTRAINT siac_configuracion_empresa_company_id_key UNIQUE (company_id);


--
-- Name: siac_configuracion_empresa siac_configuracion_empresa_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_empresa
    ADD CONSTRAINT siac_configuracion_empresa_pkey PRIMARY KEY (id);


--
-- Name: siac_configuracion_terminal siac_configuracion_terminal_company_id_terminal_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_terminal
    ADD CONSTRAINT siac_configuracion_terminal_company_id_terminal_id_key UNIQUE (company_id, terminal_id);


--
-- Name: siac_configuracion_terminal siac_configuracion_terminal_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_configuracion_terminal
    ADD CONSTRAINT siac_configuracion_terminal_pkey PRIMARY KEY (id);


--
-- Name: siac_facturas siac_facturas_caja_id_tipo_comprobante_id_prefijo_numero_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT siac_facturas_caja_id_tipo_comprobante_id_prefijo_numero_key UNIQUE (caja_id, tipo_comprobante_id, prefijo, numero);


--
-- Name: siac_facturas_impuestos siac_facturas_impuestos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_impuestos
    ADD CONSTRAINT siac_facturas_impuestos_pkey PRIMARY KEY (id);


--
-- Name: siac_facturas_items siac_facturas_items_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_items
    ADD CONSTRAINT siac_facturas_items_pkey PRIMARY KEY (id);


--
-- Name: siac_facturas_pagos siac_facturas_pagos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_pagos
    ADD CONSTRAINT siac_facturas_pagos_pkey PRIMARY KEY (id);


--
-- Name: siac_facturas siac_facturas_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT siac_facturas_pkey PRIMARY KEY (id);


--
-- Name: siac_listas_precios siac_listas_codigo_company_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_listas_precios
    ADD CONSTRAINT siac_listas_codigo_company_uk UNIQUE (company_id, codigo_lista);


--
-- Name: siac_listas_precios siac_listas_precios_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_listas_precios
    ADD CONSTRAINT siac_listas_precios_pkey PRIMARY KEY (id);


--
-- Name: siac_productos_marcas siac_marcas_codigo_company_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_marcas
    ADD CONSTRAINT siac_marcas_codigo_company_uk UNIQUE (company_id, codigo_marca);


--
-- Name: siac_modulos_empresa siac_modulos_empresa_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_modulos_empresa
    ADD CONSTRAINT siac_modulos_empresa_pkey PRIMARY KEY (id);


--
-- Name: siac_modulos_empresa siac_modulos_empresa_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_modulos_empresa
    ADD CONSTRAINT siac_modulos_empresa_uk UNIQUE (company_id, modulo_codigo);


--
-- Name: siac_numeracion_comprobantes siac_numeracion_comprobantes_caja_id_tipo_comprobante_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_comprobantes
    ADD CONSTRAINT siac_numeracion_comprobantes_caja_id_tipo_comprobante_id_key UNIQUE (caja_id, tipo_comprobante_id);


--
-- Name: siac_numeracion_comprobantes siac_numeracion_comprobantes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_comprobantes
    ADD CONSTRAINT siac_numeracion_comprobantes_pkey PRIMARY KEY (id);


--
-- Name: siac_numeracion_log siac_numeracion_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_log
    ADD CONSTRAINT siac_numeracion_log_pkey PRIMARY KEY (id);


--
-- Name: siac_presupuestos siac_presupuestos_numero_unico; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_presupuestos
    ADD CONSTRAINT siac_presupuestos_numero_unico UNIQUE (company_id, prefijo, numero);


--
-- Name: siac_presupuestos siac_presupuestos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_presupuestos
    ADD CONSTRAINT siac_presupuestos_pkey PRIMARY KEY (id);


--
-- Name: siac_productos_categorias siac_productos_categorias_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_categorias
    ADD CONSTRAINT siac_productos_categorias_pkey PRIMARY KEY (id);


--
-- Name: siac_productos siac_productos_codigo_company_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos
    ADD CONSTRAINT siac_productos_codigo_company_uk UNIQUE (company_id, codigo_producto);


--
-- Name: siac_productos_componentes siac_productos_componentes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_componentes
    ADD CONSTRAINT siac_productos_componentes_pkey PRIMARY KEY (id);


--
-- Name: siac_productos_componentes siac_productos_componentes_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_componentes
    ADD CONSTRAINT siac_productos_componentes_uk UNIQUE (producto_padre_id, producto_componente_id);


--
-- Name: siac_productos_marcas siac_productos_marcas_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_marcas
    ADD CONSTRAINT siac_productos_marcas_pkey PRIMARY KEY (id);


--
-- Name: siac_productos siac_productos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos
    ADD CONSTRAINT siac_productos_pkey PRIMARY KEY (id);


--
-- Name: siac_productos_precios siac_productos_precios_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_precios
    ADD CONSTRAINT siac_productos_precios_pkey PRIMARY KEY (id);


--
-- Name: siac_productos_precios siac_productos_precios_uk; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_precios
    ADD CONSTRAINT siac_productos_precios_uk UNIQUE (producto_id, lista_precios_id, fecha_vigencia_desde);


--
-- Name: siac_puntos_venta siac_puntos_venta_company_id_codigo_punto_venta_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_puntos_venta
    ADD CONSTRAINT siac_puntos_venta_company_id_codigo_punto_venta_key UNIQUE (company_id, codigo_punto_venta);


--
-- Name: siac_puntos_venta siac_puntos_venta_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_puntos_venta
    ADD CONSTRAINT siac_puntos_venta_pkey PRIMARY KEY (id);


--
-- Name: siac_sesiones_caja siac_sesiones_caja_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_caja
    ADD CONSTRAINT siac_sesiones_caja_pkey PRIMARY KEY (id);


--
-- Name: siac_sesiones_locales siac_sesiones_locales_company_id_terminal_id_is_active_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_locales
    ADD CONSTRAINT siac_sesiones_locales_company_id_terminal_id_is_active_key UNIQUE (company_id, terminal_id, is_active);


--
-- Name: siac_sesiones_locales siac_sesiones_locales_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_locales
    ADD CONSTRAINT siac_sesiones_locales_pkey PRIMARY KEY (id);


--
-- Name: siac_sesiones_locales siac_sesiones_locales_session_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_locales
    ADD CONSTRAINT siac_sesiones_locales_session_id_key UNIQUE (session_id);


--
-- Name: siac_stock_movimientos siac_stock_movimientos_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_stock_movimientos
    ADD CONSTRAINT siac_stock_movimientos_pkey PRIMARY KEY (id);


--
-- Name: siac_tipos_comprobantes siac_tipos_comprobantes_company_id_codigo_tipo_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_tipos_comprobantes
    ADD CONSTRAINT siac_tipos_comprobantes_company_id_codigo_tipo_key UNIQUE (company_id, codigo_tipo);


--
-- Name: siac_tipos_comprobantes siac_tipos_comprobantes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_tipos_comprobantes
    ADD CONSTRAINT siac_tipos_comprobantes_pkey PRIMARY KEY (id);


--
-- Name: siac_transacciones_pendientes siac_transacciones_pendientes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_transacciones_pendientes
    ADD CONSTRAINT siac_transacciones_pendientes_pkey PRIMARY KEY (id);


--
-- Name: sla_metrics sla_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sla_metrics
    ADD CONSTRAINT sla_metrics_pkey PRIMARY KEY (id);


--
-- Name: sports_catalog sports_catalog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sports_catalog
    ADD CONSTRAINT sports_catalog_pkey PRIMARY KEY (id);


--
-- Name: super_users super_users_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.super_users
    ADD CONSTRAINT super_users_email_key UNIQUE (email);


--
-- Name: super_users super_users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.super_users
    ADD CONSTRAINT super_users_pkey PRIMARY KEY (id);


--
-- Name: super_users super_users_username_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.super_users
    ADD CONSTRAINT super_users_username_key UNIQUE (username);


--
-- Name: support_activity_log support_activity_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_activity_log
    ADD CONSTRAINT support_activity_log_pkey PRIMARY KEY (log_id);


--
-- Name: support_assistant_attempts support_assistant_attempts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_assistant_attempts
    ADD CONSTRAINT support_assistant_attempts_pkey PRIMARY KEY (attempt_id);


--
-- Name: support_escalations support_escalations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_escalations
    ADD CONSTRAINT support_escalations_pkey PRIMARY KEY (escalation_id);


--
-- Name: support_sla_config support_sla_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_sla_config
    ADD CONSTRAINT support_sla_config_pkey PRIMARY KEY (id);


--
-- Name: support_sla_plans support_sla_plans_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_sla_plans
    ADD CONSTRAINT support_sla_plans_pkey PRIMARY KEY (plan_id);


--
-- Name: support_sla_plans support_sla_plans_plan_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_sla_plans
    ADD CONSTRAINT support_sla_plans_plan_name_key UNIQUE (plan_name);


--
-- Name: support_ticket_escalations support_ticket_escalations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_escalations
    ADD CONSTRAINT support_ticket_escalations_pkey PRIMARY KEY (id);


--
-- Name: support_ticket_messages support_ticket_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_messages
    ADD CONSTRAINT support_ticket_messages_pkey PRIMARY KEY (message_id);


--
-- Name: support_tickets support_tickets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_pkey PRIMARY KEY (ticket_id);


--
-- Name: support_tickets support_tickets_ticket_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_ticket_number_key UNIQUE (ticket_number);


--
-- Name: support_vendor_stats support_vendor_stats_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_stats
    ADD CONSTRAINT support_vendor_stats_pkey PRIMARY KEY (stat_id);


--
-- Name: support_vendor_stats support_vendor_stats_vendor_id_period_start_period_end_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_stats
    ADD CONSTRAINT support_vendor_stats_vendor_id_period_start_period_end_key UNIQUE (vendor_id, period_start, period_end);


--
-- Name: support_vendor_supervisors support_vendor_supervisors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_supervisors
    ADD CONSTRAINT support_vendor_supervisors_pkey PRIMARY KEY (assignment_id);


--
-- Name: support_vendor_supervisors support_vendor_supervisors_vendor_id_supervisor_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_supervisors
    ADD CONSTRAINT support_vendor_supervisors_vendor_id_supervisor_id_key UNIQUE (vendor_id, supervisor_id);


--
-- Name: suspension_blocks suspension_blocks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks
    ADD CONSTRAINT suspension_blocks_pkey PRIMARY KEY (id);


--
-- Name: system_config system_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_config
    ADD CONSTRAINT system_config_pkey PRIMARY KEY (id);


--
-- Name: system_consciousness_log system_consciousness_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_consciousness_log
    ADD CONSTRAINT system_consciousness_log_pkey PRIMARY KEY (log_id);


--
-- Name: system_metadata system_metadata_metadata_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_metadata
    ADD CONSTRAINT system_metadata_metadata_key_key UNIQUE (metadata_key);


--
-- Name: system_metadata system_metadata_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_metadata
    ADD CONSTRAINT system_metadata_pkey PRIMARY KEY (metadata_id);


--
-- Name: system_modules system_modules_module_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_modules
    ADD CONSTRAINT system_modules_module_key_key UNIQUE (module_key);


--
-- Name: system_modules system_modules_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_modules
    ADD CONSTRAINT system_modules_pkey PRIMARY KEY (id);


--
-- Name: system_modules_registry system_modules_registry_module_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_modules_registry
    ADD CONSTRAINT system_modules_registry_module_key_key UNIQUE (module_key);


--
-- Name: system_modules_registry system_modules_registry_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_modules_registry
    ADD CONSTRAINT system_modules_registry_pkey PRIMARY KEY (registry_id);


--
-- Name: task_compatibility task_compatibility_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility
    ADD CONSTRAINT task_compatibility_pkey PRIMARY KEY (id);


--
-- Name: tax_concepts tax_concepts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_concepts
    ADD CONSTRAINT tax_concepts_pkey PRIMARY KEY (id);


--
-- Name: tax_concepts tax_concepts_tax_template_id_concept_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_concepts
    ADD CONSTRAINT tax_concepts_tax_template_id_concept_code_key UNIQUE (tax_template_id, concept_code);


--
-- Name: tax_conditions tax_conditions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_conditions
    ADD CONSTRAINT tax_conditions_pkey PRIMARY KEY (id);


--
-- Name: tax_conditions tax_conditions_tax_template_id_condition_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_conditions
    ADD CONSTRAINT tax_conditions_tax_template_id_condition_code_key UNIQUE (tax_template_id, condition_code);


--
-- Name: tax_rates tax_rates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_rates
    ADD CONSTRAINT tax_rates_pkey PRIMARY KEY (id);


--
-- Name: tax_rates tax_rates_tax_concept_id_rate_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_rates
    ADD CONSTRAINT tax_rates_tax_concept_id_rate_code_key UNIQUE (tax_concept_id, rate_code);


--
-- Name: tax_templates tax_templates_country_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_templates
    ADD CONSTRAINT tax_templates_country_code_key UNIQUE (country_code);


--
-- Name: tax_templates tax_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_templates
    ADD CONSTRAINT tax_templates_pkey PRIMARY KEY (id);


--
-- Name: test_executions test_executions_execution_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_executions
    ADD CONSTRAINT test_executions_execution_id_key UNIQUE (execution_id);


--
-- Name: test_executions test_executions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_executions
    ADD CONSTRAINT test_executions_pkey PRIMARY KEY (id);


--
-- Name: test_results test_results_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_results
    ADD CONSTRAINT test_results_pkey PRIMARY KEY (id);


--
-- Name: testing_tickets testing_tickets_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.testing_tickets
    ADD CONSTRAINT testing_tickets_pkey PRIMARY KEY (id);


--
-- Name: testing_tickets testing_tickets_ticket_number_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.testing_tickets
    ADD CONSTRAINT testing_tickets_ticket_number_key UNIQUE (ticket_number);


--
-- Name: training_assignments training_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.training_assignments
    ADD CONSTRAINT training_assignments_pkey PRIMARY KEY (id);


--
-- Name: trainings trainings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trainings
    ADD CONSTRAINT trainings_pkey PRIMARY KEY (id);


--
-- Name: company_modules uk_company_module_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_modules
    ADD CONSTRAINT uk_company_module_unique UNIQUE (company_id, system_module_id);


--
-- Name: legal_cases uk_legal_case_number; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT uk_legal_case_number UNIQUE (company_id, case_number);


--
-- Name: unauthorized_access_attempts unauthorized_access_attempts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unauthorized_access_attempts
    ADD CONSTRAINT unauthorized_access_attempts_pkey PRIMARY KEY (id);


--
-- Name: unified_help_interactions unified_help_interactions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unified_help_interactions
    ADD CONSTRAINT unified_help_interactions_pkey PRIMARY KEY (id);


--
-- Name: unified_notifications unified_notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unified_notifications
    ADD CONSTRAINT unified_notifications_pkey PRIMARY KEY (id);


--
-- Name: contract_apk_licenses unique_apk_per_contract; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_apk_licenses
    ADD CONSTRAINT unique_apk_per_contract UNIQUE (contract_id, apk_type);


--
-- Name: afip_cae_log unique_cae; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log
    ADD CONSTRAINT unique_cae UNIQUE (cae);


--
-- Name: company_fiscal_config unique_company_fiscal; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_fiscal_config
    ADD CONSTRAINT unique_company_fiscal UNIQUE (company_id);


--
-- Name: branch_offices_fiscal unique_company_punto_venta; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branch_offices_fiscal
    ADD CONSTRAINT unique_company_punto_venta UNIQUE (company_id, punto_venta);


--
-- Name: afip_cae_log unique_comprobante_cae; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log
    ADD CONSTRAINT unique_comprobante_cae UNIQUE (company_id, punto_venta, tipo_comprobante, numero_comprobante);


--
-- Name: medical_exam_templates unique_default_template; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_exam_templates
    ADD CONSTRAINT unique_default_template UNIQUE (company_id, exam_type, is_default) DEFERRABLE INITIALLY DEFERRED;


--
-- Name: medical_staff unique_license_per_company; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT unique_license_per_company UNIQUE (company_id, license_number);


--
-- Name: aponnt_pre_invoices unique_pre_invoice_code; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices
    ADD CONSTRAINT unique_pre_invoice_code UNIQUE (pre_invoice_code);


--
-- Name: support_sla_config unique_priority; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_sla_config
    ADD CONSTRAINT unique_priority UNIQUE (priority);


--
-- Name: hse_ppe_stats unique_stat_per_zone_date; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_ppe_stats
    ADD CONSTRAINT unique_stat_per_zone_date UNIQUE (company_id, branch_id, zone_name, stat_date);


--
-- Name: aponnt_admin_tasks unique_task_code; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_admin_tasks
    ADD CONSTRAINT unique_task_code UNIQUE (task_code);


--
-- Name: task_compatibility unique_task_compatibility_pair; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility
    ADD CONSTRAINT unique_task_compatibility_pair UNIQUE (primary_user_id, cover_user_id);


--
-- Name: consent_legal_documents unique_version_company; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_legal_documents
    ADD CONSTRAINT unique_version_company UNIQUE (company_id, version, document_type);


--
-- Name: hse_zone_configurations unique_zone_per_branch; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_zone_configurations
    ADD CONSTRAINT unique_zone_per_branch UNIQUE (company_id, branch_id, zone_code);


--
-- Name: company_dependencies uq_company_dependency_code; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies
    ADD CONSTRAINT uq_company_dependency_code UNIQUE (company_id, dependency_code);


--
-- Name: concept_dependencies uq_concept_dependency; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies
    ADD CONSTRAINT uq_concept_dependency UNIQUE (concept_id, dependency_id);


--
-- Name: biometric_consents uq_consent_user_type; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT uq_consent_user_type UNIQUE (company_id, user_id, consent_type, revoked);


--
-- Name: email_templates uq_template_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT uq_template_key UNIQUE (company_id, template_key);


--
-- Name: user_emails uq_user_email; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emails
    ADD CONSTRAINT uq_user_email UNIQUE (user_id, email);


--
-- Name: used_tokens used_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.used_tokens
    ADD CONSTRAINT used_tokens_pkey PRIMARY KEY (id);


--
-- Name: used_tokens used_tokens_token_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.used_tokens
    ADD CONSTRAINT used_tokens_token_key UNIQUE (token);


--
-- Name: user_activity_restrictions user_activity_restrictions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_activity_restrictions
    ADD CONSTRAINT user_activity_restrictions_pkey PRIMARY KEY (id);


--
-- Name: user_allergies user_allergies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_allergies
    ADD CONSTRAINT user_allergies_pkey PRIMARY KEY (id);


--
-- Name: user_anthropometric_data user_anthropometric_data_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_anthropometric_data
    ADD CONSTRAINT user_anthropometric_data_pkey PRIMARY KEY (id);


--
-- Name: user_assigned_tasks user_assigned_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_pkey PRIMARY KEY (id);


--
-- Name: user_audit_logs user_audit_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_audit_logs
    ADD CONSTRAINT user_audit_logs_pkey PRIMARY KEY (id);


--
-- Name: user_children user_children_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_children
    ADD CONSTRAINT user_children_pkey PRIMARY KEY (id);


--
-- Name: user_chronic_conditions user_chronic_conditions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions
    ADD CONSTRAINT user_chronic_conditions_pkey PRIMARY KEY (id);


--
-- Name: user_chronic_conditions_v2 user_chronic_conditions_v2_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions_v2
    ADD CONSTRAINT user_chronic_conditions_v2_pkey PRIMARY KEY (id);


--
-- Name: user_consents user_consents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_consents
    ADD CONSTRAINT user_consents_pkey PRIMARY KEY (user_consent_id);


--
-- Name: user_contact_history user_contact_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contact_history
    ADD CONSTRAINT user_contact_history_pkey PRIMARY KEY (id);


--
-- Name: user_disciplinary_actions user_disciplinary_actions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_disciplinary_actions
    ADD CONSTRAINT user_disciplinary_actions_pkey PRIMARY KEY (id);


--
-- Name: user_documents user_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_documents
    ADD CONSTRAINT user_documents_pkey PRIMARY KEY (id);


--
-- Name: user_driver_licenses user_driver_licenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_driver_licenses
    ADD CONSTRAINT user_driver_licenses_pkey PRIMARY KEY (id);


--
-- Name: user_education user_education_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_education
    ADD CONSTRAINT user_education_pkey PRIMARY KEY (id);


--
-- Name: user_emails user_emails_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emails
    ADD CONSTRAINT user_emails_pkey PRIMARY KEY (id);


--
-- Name: user_emergency_contacts user_emergency_contacts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emergency_contacts
    ADD CONSTRAINT user_emergency_contacts_pkey PRIMARY KEY (id);


--
-- Name: user_family_members user_family_members_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_family_members
    ADD CONSTRAINT user_family_members_pkey PRIMARY KEY (id);


--
-- Name: user_healthy_habits user_healthy_habits_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_healthy_habits
    ADD CONSTRAINT user_healthy_habits_pkey PRIMARY KEY (id);


--
-- Name: user_household_members user_household_members_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_household_members
    ADD CONSTRAINT user_household_members_pkey PRIMARY KEY (id);


--
-- Name: user_legal_issues user_legal_issues_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues
    ADD CONSTRAINT user_legal_issues_pkey PRIMARY KEY (id);


--
-- Name: user_marital_status user_marital_status_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_marital_status
    ADD CONSTRAINT user_marital_status_pkey PRIMARY KEY (id);


--
-- Name: user_marital_status user_marital_status_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_marital_status
    ADD CONSTRAINT user_marital_status_user_id_key UNIQUE (user_id);


--
-- Name: user_medical_documents user_medical_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_documents
    ADD CONSTRAINT user_medical_documents_pkey PRIMARY KEY (id);


--
-- Name: user_medical_exams user_medical_exams_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_exams
    ADD CONSTRAINT user_medical_exams_pkey PRIMARY KEY (id);


--
-- Name: user_medications user_medications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medications
    ADD CONSTRAINT user_medications_pkey PRIMARY KEY (id);


--
-- Name: user_notification_preferences user_notification_preferences_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_notification_preferences
    ADD CONSTRAINT user_notification_preferences_pkey PRIMARY KEY (id);


--
-- Name: user_notification_preferences user_notification_preferences_user_id_company_id_module_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_notification_preferences
    ADD CONSTRAINT user_notification_preferences_user_id_company_id_module_key UNIQUE (user_id, company_id, module);


--
-- Name: user_payroll_assignment user_payroll_assignment_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_pkey PRIMARY KEY (id);


--
-- Name: user_payroll_assignment user_payroll_assignment_user_id_effective_from_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_user_id_effective_from_key UNIQUE (user_id, effective_from);


--
-- Name: user_payroll_bonuses user_payroll_bonuses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_pkey PRIMARY KEY (id);


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_pkey PRIMARY KEY (id);


--
-- Name: user_payroll_records user_payroll_records_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_records
    ADD CONSTRAINT user_payroll_records_pkey PRIMARY KEY (id);


--
-- Name: user_permission_requests user_permission_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permission_requests
    ADD CONSTRAINT user_permission_requests_pkey PRIMARY KEY (id);


--
-- Name: user_permissions user_permissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permissions
    ADD CONSTRAINT user_permissions_pkey PRIMARY KEY (id);


--
-- Name: user_permissions user_permissions_user_id_company_id_action_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permissions
    ADD CONSTRAINT user_permissions_user_id_company_id_action_id_key UNIQUE (user_id, company_id, action_id);


--
-- Name: user_primary_physician user_primary_physician_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_primary_physician
    ADD CONSTRAINT user_primary_physician_pkey PRIMARY KEY (id);


--
-- Name: user_primary_physician user_primary_physician_user_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_primary_physician
    ADD CONSTRAINT user_primary_physician_user_id_key UNIQUE (user_id);


--
-- Name: user_professional_licenses user_professional_licenses_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_professional_licenses
    ADD CONSTRAINT user_professional_licenses_pkey PRIMARY KEY (id);


--
-- Name: user_psychiatric_treatments user_psychiatric_treatments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_psychiatric_treatments
    ADD CONSTRAINT user_psychiatric_treatments_pkey PRIMARY KEY (id);


--
-- Name: user_role_assignments user_role_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_pkey PRIMARY KEY (id);


--
-- Name: user_role_assignments user_role_assignments_user_id_role_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_user_id_role_id_key UNIQUE (user_id, role_id);


--
-- Name: user_salary_config user_salary_config_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config
    ADD CONSTRAINT user_salary_config_pkey PRIMARY KEY (id);


--
-- Name: user_salary_config_v2 user_salary_config_v2_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config_v2
    ADD CONSTRAINT user_salary_config_v2_pkey PRIMARY KEY (id);


--
-- Name: user_shift_assignments user_shift_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT user_shift_assignments_pkey PRIMARY KEY (id);


--
-- Name: user_shifts user_shifts_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shifts
    ADD CONSTRAINT user_shifts_pkey PRIMARY KEY (user_id, shift_id);


--
-- Name: user_sports_activities user_sports_activities_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sports_activities
    ADD CONSTRAINT user_sports_activities_pkey PRIMARY KEY (id);


--
-- Name: user_surgeries user_surgeries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_surgeries
    ADD CONSTRAINT user_surgeries_pkey PRIMARY KEY (id);


--
-- Name: user_union_affiliation user_union_affiliation_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_union_affiliation
    ADD CONSTRAINT user_union_affiliation_pkey PRIMARY KEY (id);


--
-- Name: user_vaccinations user_vaccinations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_vaccinations
    ADD CONSTRAINT user_vaccinations_pkey PRIMARY KEY (id);


--
-- Name: user_work_history user_work_history_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_history
    ADD CONSTRAINT user_work_history_pkey PRIMARY KEY (id);


--
-- Name: user_work_restrictions user_work_restrictions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_restrictions
    ADD CONSTRAINT user_work_restrictions_pkey PRIMARY KEY (id);


--
-- Name: users users_company_usuario_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_company_usuario_unique UNIQUE (company_id, usuario);


--
-- Name: users users_cuil_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_cuil_key UNIQUE (cuil);


--
-- Name: users users_dni_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_dni_key UNIQUE (dni);


--
-- Name: users users_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);


--
-- Name: users users_employeeId_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT "users_employeeId_key" UNIQUE ("employeeId");


--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (user_id);


--
-- Name: users users_vendor_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_vendor_code_key UNIQUE (vendor_code);


--
-- Name: ux_discoveries ux_discoveries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ux_discoveries
    ADD CONSTRAINT ux_discoveries_pkey PRIMARY KEY (id);


--
-- Name: vacation_configurations vacation_configurations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_configurations
    ADD CONSTRAINT vacation_configurations_pkey PRIMARY KEY (id);


--
-- Name: vacation_requests vacation_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_requests
    ADD CONSTRAINT vacation_requests_pkey PRIMARY KEY (id);


--
-- Name: vacation_scales vacation_scales_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_scales
    ADD CONSTRAINT vacation_scales_pkey PRIMARY KEY (id);


--
-- Name: vendor_commissions vendor_commissions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions
    ADD CONSTRAINT vendor_commissions_pkey PRIMARY KEY (id);


--
-- Name: vendor_ratings vendor_ratings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_ratings
    ADD CONSTRAINT vendor_ratings_pkey PRIMARY KEY (id);


--
-- Name: vendor_ratings vendor_ratings_vendor_id_company_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_ratings
    ADD CONSTRAINT vendor_ratings_vendor_id_company_id_key UNIQUE (vendor_id, company_id);


--
-- Name: vendor_referrals vendor_referrals_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals
    ADD CONSTRAINT vendor_referrals_pkey PRIMARY KEY (id);


--
-- Name: vendor_referrals vendor_referrals_referral_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals
    ADD CONSTRAINT vendor_referrals_referral_code_key UNIQUE (referral_code);


--
-- Name: vendor_referrals vendor_referrals_referrer_id_referred_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals
    ADD CONSTRAINT vendor_referrals_referrer_id_referred_id_key UNIQUE (referrer_id, referred_id);


--
-- Name: vendor_statistics vendor_statistics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_statistics
    ADD CONSTRAINT vendor_statistics_pkey PRIMARY KEY (id);


--
-- Name: vendor_statistics vendor_statistics_vendor_id_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_statistics
    ADD CONSTRAINT vendor_statistics_vendor_id_unique UNIQUE (vendor_id);


--
-- Name: visitor_gps_tracking visitor_gps_tracking_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.visitor_gps_tracking
    ADD CONSTRAINT visitor_gps_tracking_pkey PRIMARY KEY (id);


--
-- Name: visitors visitors_keyring_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.visitors
    ADD CONSTRAINT visitors_keyring_id_key UNIQUE (keyring_id);


--
-- Name: visitors visitors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.visitors
    ADD CONSTRAINT visitors_pkey PRIMARY KEY (id);


--
-- Name: idx_biometric_alerts_p0_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p0_status ON biometric_partitions.biometric_alerts_p0 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p0_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p0_user_id ON biometric_partitions.biometric_alerts_p0 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p10_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p10_status ON biometric_partitions.biometric_alerts_p10 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p10_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p10_user_id ON biometric_partitions.biometric_alerts_p10 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p11_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p11_status ON biometric_partitions.biometric_alerts_p11 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p11_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p11_user_id ON biometric_partitions.biometric_alerts_p11 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p12_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p12_status ON biometric_partitions.biometric_alerts_p12 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p12_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p12_user_id ON biometric_partitions.biometric_alerts_p12 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p13_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p13_status ON biometric_partitions.biometric_alerts_p13 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p13_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p13_user_id ON biometric_partitions.biometric_alerts_p13 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p14_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p14_status ON biometric_partitions.biometric_alerts_p14 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p14_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p14_user_id ON biometric_partitions.biometric_alerts_p14 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p15_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p15_status ON biometric_partitions.biometric_alerts_p15 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p15_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p15_user_id ON biometric_partitions.biometric_alerts_p15 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p1_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p1_status ON biometric_partitions.biometric_alerts_p1 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p1_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p1_user_id ON biometric_partitions.biometric_alerts_p1 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p2_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p2_status ON biometric_partitions.biometric_alerts_p2 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p2_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p2_user_id ON biometric_partitions.biometric_alerts_p2 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p3_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p3_status ON biometric_partitions.biometric_alerts_p3 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p3_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p3_user_id ON biometric_partitions.biometric_alerts_p3 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p4_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p4_status ON biometric_partitions.biometric_alerts_p4 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p4_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p4_user_id ON biometric_partitions.biometric_alerts_p4 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p5_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p5_status ON biometric_partitions.biometric_alerts_p5 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p5_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p5_user_id ON biometric_partitions.biometric_alerts_p5 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p6_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p6_status ON biometric_partitions.biometric_alerts_p6 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p6_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p6_user_id ON biometric_partitions.biometric_alerts_p6 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p7_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p7_status ON biometric_partitions.biometric_alerts_p7 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p7_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p7_user_id ON biometric_partitions.biometric_alerts_p7 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p8_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p8_status ON biometric_partitions.biometric_alerts_p8 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p8_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p8_user_id ON biometric_partitions.biometric_alerts_p8 USING btree (user_id);


--
-- Name: idx_biometric_alerts_p9_status; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p9_status ON biometric_partitions.biometric_alerts_p9 USING btree (status, created_at DESC);


--
-- Name: idx_biometric_alerts_p9_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_alerts_p9_user_id ON biometric_partitions.biometric_alerts_p9 USING btree (user_id);


--
-- Name: idx_biometric_scans_p0_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p0_ai_analysis ON biometric_partitions.biometric_scans_p0 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p0_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p0_created_at ON biometric_partitions.biometric_scans_p0 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p0_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p0_template_hash ON biometric_partitions.biometric_scans_p0 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p0_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p0_user_id ON biometric_partitions.biometric_scans_p0 USING btree (user_id);


--
-- Name: idx_biometric_scans_p10_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p10_ai_analysis ON biometric_partitions.biometric_scans_p10 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p10_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p10_created_at ON biometric_partitions.biometric_scans_p10 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p10_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p10_template_hash ON biometric_partitions.biometric_scans_p10 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p10_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p10_user_id ON biometric_partitions.biometric_scans_p10 USING btree (user_id);


--
-- Name: idx_biometric_scans_p11_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p11_ai_analysis ON biometric_partitions.biometric_scans_p11 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p11_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p11_created_at ON biometric_partitions.biometric_scans_p11 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p11_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p11_template_hash ON biometric_partitions.biometric_scans_p11 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p11_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p11_user_id ON biometric_partitions.biometric_scans_p11 USING btree (user_id);


--
-- Name: idx_biometric_scans_p12_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p12_ai_analysis ON biometric_partitions.biometric_scans_p12 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p12_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p12_created_at ON biometric_partitions.biometric_scans_p12 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p12_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p12_template_hash ON biometric_partitions.biometric_scans_p12 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p12_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p12_user_id ON biometric_partitions.biometric_scans_p12 USING btree (user_id);


--
-- Name: idx_biometric_scans_p13_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p13_ai_analysis ON biometric_partitions.biometric_scans_p13 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p13_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p13_created_at ON biometric_partitions.biometric_scans_p13 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p13_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p13_template_hash ON biometric_partitions.biometric_scans_p13 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p13_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p13_user_id ON biometric_partitions.biometric_scans_p13 USING btree (user_id);


--
-- Name: idx_biometric_scans_p14_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p14_ai_analysis ON biometric_partitions.biometric_scans_p14 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p14_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p14_created_at ON biometric_partitions.biometric_scans_p14 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p14_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p14_template_hash ON biometric_partitions.biometric_scans_p14 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p14_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p14_user_id ON biometric_partitions.biometric_scans_p14 USING btree (user_id);


--
-- Name: idx_biometric_scans_p15_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p15_ai_analysis ON biometric_partitions.biometric_scans_p15 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p15_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p15_created_at ON biometric_partitions.biometric_scans_p15 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p15_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p15_template_hash ON biometric_partitions.biometric_scans_p15 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p15_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p15_user_id ON biometric_partitions.biometric_scans_p15 USING btree (user_id);


--
-- Name: idx_biometric_scans_p1_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p1_ai_analysis ON biometric_partitions.biometric_scans_p1 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p1_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p1_created_at ON biometric_partitions.biometric_scans_p1 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p1_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p1_template_hash ON biometric_partitions.biometric_scans_p1 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p1_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p1_user_id ON biometric_partitions.biometric_scans_p1 USING btree (user_id);


--
-- Name: idx_biometric_scans_p2_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p2_ai_analysis ON biometric_partitions.biometric_scans_p2 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p2_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p2_created_at ON biometric_partitions.biometric_scans_p2 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p2_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p2_template_hash ON biometric_partitions.biometric_scans_p2 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p2_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p2_user_id ON biometric_partitions.biometric_scans_p2 USING btree (user_id);


--
-- Name: idx_biometric_scans_p3_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p3_ai_analysis ON biometric_partitions.biometric_scans_p3 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p3_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p3_created_at ON biometric_partitions.biometric_scans_p3 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p3_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p3_template_hash ON biometric_partitions.biometric_scans_p3 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p3_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p3_user_id ON biometric_partitions.biometric_scans_p3 USING btree (user_id);


--
-- Name: idx_biometric_scans_p4_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p4_ai_analysis ON biometric_partitions.biometric_scans_p4 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p4_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p4_created_at ON biometric_partitions.biometric_scans_p4 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p4_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p4_template_hash ON biometric_partitions.biometric_scans_p4 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p4_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p4_user_id ON biometric_partitions.biometric_scans_p4 USING btree (user_id);


--
-- Name: idx_biometric_scans_p5_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p5_ai_analysis ON biometric_partitions.biometric_scans_p5 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p5_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p5_created_at ON biometric_partitions.biometric_scans_p5 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p5_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p5_template_hash ON biometric_partitions.biometric_scans_p5 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p5_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p5_user_id ON biometric_partitions.biometric_scans_p5 USING btree (user_id);


--
-- Name: idx_biometric_scans_p6_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p6_ai_analysis ON biometric_partitions.biometric_scans_p6 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p6_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p6_created_at ON biometric_partitions.biometric_scans_p6 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p6_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p6_template_hash ON biometric_partitions.biometric_scans_p6 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p6_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p6_user_id ON biometric_partitions.biometric_scans_p6 USING btree (user_id);


--
-- Name: idx_biometric_scans_p7_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p7_ai_analysis ON biometric_partitions.biometric_scans_p7 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p7_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p7_created_at ON biometric_partitions.biometric_scans_p7 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p7_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p7_template_hash ON biometric_partitions.biometric_scans_p7 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p7_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p7_user_id ON biometric_partitions.biometric_scans_p7 USING btree (user_id);


--
-- Name: idx_biometric_scans_p8_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p8_ai_analysis ON biometric_partitions.biometric_scans_p8 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p8_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p8_created_at ON biometric_partitions.biometric_scans_p8 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p8_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p8_template_hash ON biometric_partitions.biometric_scans_p8 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p8_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p8_user_id ON biometric_partitions.biometric_scans_p8 USING btree (user_id);


--
-- Name: idx_biometric_scans_p9_ai_analysis; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p9_ai_analysis ON biometric_partitions.biometric_scans_p9 USING gin (ai_analysis);


--
-- Name: idx_biometric_scans_p9_created_at; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p9_created_at ON biometric_partitions.biometric_scans_p9 USING btree (created_at DESC);


--
-- Name: idx_biometric_scans_p9_template_hash; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p9_template_hash ON biometric_partitions.biometric_scans_p9 USING btree (template_hash);


--
-- Name: idx_biometric_scans_p9_user_id; Type: INDEX; Schema: biometric_partitions; Owner: -
--

CREATE INDEX idx_biometric_scans_p9_user_id ON biometric_partitions.biometric_scans_p9 USING btree (user_id);


--
-- Name: access_notifications_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_company_id ON public.access_notifications USING btree (company_id);


--
-- Name: access_notifications_company_id_notification_type_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_company_id_notification_type_created_at ON public.access_notifications USING btree (company_id, notification_type, created_at);


--
-- Name: access_notifications_company_id_recipient_user_id_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_company_id_recipient_user_id_is_read ON public.access_notifications USING btree (company_id, recipient_user_id, is_read);


--
-- Name: access_notifications_compound1; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_compound1 ON public.access_notifications USING btree (company_id, recipient_user_id, is_read);


--
-- Name: access_notifications_compound2; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_compound2 ON public.access_notifications USING btree (company_id, notification_type, created_at);


--
-- Name: access_notifications_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_created_at ON public.access_notifications USING btree (created_at);


--
-- Name: access_notifications_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_expires_at ON public.access_notifications USING btree (expires_at);


--
-- Name: access_notifications_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_is_read ON public.access_notifications USING btree (is_read);


--
-- Name: access_notifications_notification_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_notification_type ON public.access_notifications USING btree (notification_type);


--
-- Name: access_notifications_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_priority ON public.access_notifications USING btree (priority);


--
-- Name: access_notifications_recipient_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_recipient_user_id ON public.access_notifications USING btree (recipient_user_id);


--
-- Name: access_notifications_related_kiosk_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_related_kiosk_id ON public.access_notifications USING btree (related_kiosk_id);


--
-- Name: access_notifications_related_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_related_user_id ON public.access_notifications USING btree (related_user_id);


--
-- Name: access_notifications_related_visitor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX access_notifications_related_visitor_id ON public.access_notifications USING btree (related_visitor_id);


--
-- Name: additional_role_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX additional_role_types_category ON public.additional_role_types USING btree (category);


--
-- Name: additional_role_types_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX additional_role_types_company_id ON public.additional_role_types USING btree (company_id);


--
-- Name: additional_role_types_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX additional_role_types_is_active ON public.additional_role_types USING btree (is_active);


--
-- Name: aponnt_staff_companies_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX aponnt_staff_companies_company_id ON public.aponnt_staff_companies USING btree (company_id);


--
-- Name: aponnt_staff_companies_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX aponnt_staff_companies_is_active ON public.aponnt_staff_companies USING btree (is_active);


--
-- Name: aponnt_staff_companies_staff_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX aponnt_staff_companies_staff_id ON public.aponnt_staff_companies USING btree (staff_id);


--
-- Name: aponnt_staff_companies_staff_id_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX aponnt_staff_companies_staff_id_company_id ON public.aponnt_staff_companies USING btree (staff_id, company_id);


--
-- Name: art_configurations_art_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX art_configurations_art_code ON public.art_configurations USING btree ("artCode");


--
-- Name: art_configurations_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX art_configurations_company_id ON public.art_configurations USING btree ("companyId");


--
-- Name: art_configurations_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX art_configurations_is_active ON public.art_configurations USING btree ("isActive");


--
-- Name: assistant_conversations_company_id_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_conversations_company_id_created_at ON public.assistant_conversations USING btree (company_id, created_at);


--
-- Name: assistant_conversations_company_id_module_name_helpful_created_; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_conversations_company_id_module_name_helpful_created_ ON public.assistant_conversations USING btree (company_id, module_name, helpful, created_at);


--
-- Name: assistant_conversations_helpful_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_conversations_helpful_created_at ON public.assistant_conversations USING btree (helpful, created_at);


--
-- Name: assistant_conversations_module_name_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_conversations_module_name_created_at ON public.assistant_conversations USING btree (module_name, created_at);


--
-- Name: assistant_conversations_user_id_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_conversations_user_id_created_at ON public.assistant_conversations USING btree (user_id, created_at);


--
-- Name: assistant_knowledge_base_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_knowledge_base_company_id ON public.assistant_knowledge_base USING btree (company_id);


--
-- Name: assistant_knowledge_base_company_id_module_name_helpful; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_knowledge_base_company_id_module_name_helpful ON public.assistant_knowledge_base USING btree (company_id, module_name, helpful);


--
-- Name: assistant_knowledge_base_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_knowledge_base_created_at ON public.assistant_knowledge_base USING btree (created_at);


--
-- Name: assistant_knowledge_base_helpful; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_knowledge_base_helpful ON public.assistant_knowledge_base USING btree (helpful);


--
-- Name: assistant_knowledge_base_module_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX assistant_knowledge_base_module_name ON public.assistant_knowledge_base USING btree (module_name);


--
-- Name: attendances__user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX attendances__user_id ON public.attendances USING btree ("UserId");


--
-- Name: attendances_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX attendances_date ON public.attendances USING btree (date);


--
-- Name: attendances_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX attendances_status ON public.attendances USING btree (status);


--
-- Name: audit_test_logs_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_company_id ON public.audit_test_logs USING btree (company_id);


--
-- Name: audit_test_logs_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_environment ON public.audit_test_logs USING btree (environment);


--
-- Name: audit_test_logs_execution_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_execution_id ON public.audit_test_logs USING btree (execution_id);


--
-- Name: audit_test_logs_module_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_module_name ON public.audit_test_logs USING btree (module_name);


--
-- Name: audit_test_logs_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_severity ON public.audit_test_logs USING btree (severity);


--
-- Name: audit_test_logs_started_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_started_at ON public.audit_test_logs USING btree (started_at);


--
-- Name: audit_test_logs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_status ON public.audit_test_logs USING btree (status);


--
-- Name: audit_test_logs_tags; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_tags ON public.audit_test_logs USING gin (tags);


--
-- Name: audit_test_logs_test_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX audit_test_logs_test_type ON public.audit_test_logs USING btree (test_type);


--
-- Name: biometric_data__user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX biometric_data__user_id ON public.biometric_data USING btree ("UserId");


--
-- Name: biometric_data__user_id_type_finger_index; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX biometric_data__user_id_type_finger_index ON public.biometric_data USING btree ("UserId", type, "fingerIndex");


--
-- Name: biometric_data_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX biometric_data_is_active ON public.biometric_data USING btree ("isActive");


--
-- Name: biometric_data_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX biometric_data_type ON public.biometric_data USING btree (type);


--
-- Name: branches_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX branches_code ON public.branches USING btree (code);


--
-- Name: branches_code_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX branches_code_company_id ON public.branches USING btree (code, company_id);


--
-- Name: branches_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX branches_company_id ON public.branches USING btree (company_id);


--
-- Name: branches_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX branches_is_active ON public.branches USING btree ("isActive");


--
-- Name: companies_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX companies_is_active ON public.companies USING btree (is_active);


--
-- Name: companies_license_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX companies_license_type ON public.companies USING btree (license_type);


--
-- Name: companies_slug; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX companies_slug ON public.companies USING btree (slug);


--
-- Name: companies_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX companies_status ON public.companies USING btree (status);


--
-- Name: companies_tax_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX companies_tax_id ON public.companies USING btree (tax_id);


--
-- Name: company_dependencies_company_id_dependency_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX company_dependencies_company_id_dependency_code ON public.company_dependencies USING btree (company_id, dependency_code);


--
-- Name: company_modules_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX company_modules_company_id ON public.company_modules USING btree (company_id);


--
-- Name: company_modules_system_module_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX company_modules_system_module_id ON public.company_modules USING btree (system_module_id);


--
-- Name: company_modules_unique_company_module; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX company_modules_unique_company_module ON public.company_modules USING btree (company_id, system_module_id);


--
-- Name: company_support_assignments_assigned_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX company_support_assignments_assigned_vendor_id ON public.company_support_assignments USING btree (assigned_vendor_id);


--
-- Name: company_support_assignments_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX company_support_assignments_company_id ON public.company_support_assignments USING btree (company_id);


--
-- Name: company_support_assignments_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX company_support_assignments_is_active ON public.company_support_assignments USING btree (is_active);


--
-- Name: concept_dependencies_concept_id_dependency_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX concept_dependencies_concept_id_dependency_id ON public.concept_dependencies USING btree (concept_id, dependency_id);


--
-- Name: consent_audit_log_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_audit_log_action ON public.consent_audit_log USING btree (action);


--
-- Name: consent_audit_log_changed_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_audit_log_changed_by ON public.consent_audit_log USING btree (changed_by);


--
-- Name: consent_audit_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_audit_log_created_at ON public.consent_audit_log USING btree (created_at);


--
-- Name: consent_audit_log_user_consent_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_audit_log_user_consent_id ON public.consent_audit_log USING btree (user_consent_id);


--
-- Name: consent_audit_log_user_consent_id_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_audit_log_user_consent_id_created_at ON public.consent_audit_log USING btree (user_consent_id, created_at);


--
-- Name: consent_definitions_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_definitions_category ON public.consent_definitions USING btree (category);


--
-- Name: consent_definitions_consent_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX consent_definitions_consent_key ON public.consent_definitions USING btree (consent_key);


--
-- Name: consent_definitions_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_definitions_is_active ON public.consent_definitions USING btree (is_active);


--
-- Name: consent_definitions_is_required; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_definitions_is_required ON public.consent_definitions USING btree (is_required);


--
-- Name: consent_definitions_version; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX consent_definitions_version ON public.consent_definitions USING btree (version);


--
-- Name: contracts_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX contracts_company_id ON public.contracts USING btree (company_id);


--
-- Name: departments_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX departments_company_id ON public.departments USING btree (company_id);


--
-- Name: departments_gps_lat_gps_lng; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX departments_gps_lat_gps_lng ON public.departments USING btree (gps_lat, gps_lng);


--
-- Name: departments_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX departments_is_active ON public.departments USING btree (is_active);


--
-- Name: departments_name; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX departments_name ON public.departments USING btree (name) WHERE (deleted_at IS NULL);


--
-- Name: departments_name_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX departments_name_company_id ON public.departments USING btree (name, company_id) WHERE (deleted_at IS NULL);


--
-- Name: email_verification_tokens_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX email_verification_tokens_email ON public.email_verification_tokens USING btree (email);


--
-- Name: email_verification_tokens_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX email_verification_tokens_expires_at ON public.email_verification_tokens USING btree (expires_at);


--
-- Name: email_verification_tokens_is_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX email_verification_tokens_is_verified ON public.email_verification_tokens USING btree (is_verified);


--
-- Name: email_verification_tokens_token; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX email_verification_tokens_token ON public.email_verification_tokens USING btree (token);


--
-- Name: email_verification_tokens_user_id_user_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX email_verification_tokens_user_id_user_type ON public.email_verification_tokens USING btree (user_id, user_type);


--
-- Name: employee_locations_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_company_id ON public.employee_locations USING btree (company_id);


--
-- Name: employee_locations_company_id_reported_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_company_id_reported_at ON public.employee_locations USING btree (company_id, "reportedAt");


--
-- Name: employee_locations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_created_at ON public.employee_locations USING btree ("createdAt");


--
-- Name: employee_locations_current_activity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_current_activity ON public.employee_locations USING btree ("currentActivity");


--
-- Name: employee_locations_is_in_geofence; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_is_in_geofence ON public.employee_locations USING btree ("isInGeofence");


--
-- Name: employee_locations_is_working_hours; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_is_working_hours ON public.employee_locations USING btree ("isWorkingHours");


--
-- Name: employee_locations_latitude_longitude; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_latitude_longitude ON public.employee_locations USING btree (latitude, longitude);


--
-- Name: employee_locations_reported_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_reported_at ON public.employee_locations USING btree ("reportedAt");


--
-- Name: employee_locations_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_user_id ON public.employee_locations USING btree ("userId");


--
-- Name: employee_locations_user_id_reported_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX employee_locations_user_id_reported_at ON public.employee_locations USING btree ("userId", "reportedAt");


--
-- Name: facial_biometric_data_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX facial_biometric_data_company_id ON public.facial_biometric_data USING btree (company_id);


--
-- Name: facial_biometric_data_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX facial_biometric_data_created_at ON public.facial_biometric_data USING btree (created_at);


--
-- Name: facial_biometric_data_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX facial_biometric_data_is_active ON public.facial_biometric_data USING btree (is_active);


--
-- Name: facial_biometric_data_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX facial_biometric_data_user_id ON public.facial_biometric_data USING btree (user_id);


--
-- Name: holidays_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX holidays_country ON public.holidays USING btree (country);


--
-- Name: holidays_country_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX holidays_country_date ON public.holidays USING btree (country, date);


--
-- Name: holidays_country_state_province_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX holidays_country_state_province_date ON public.holidays USING btree (country, state_province, date);


--
-- Name: holidays_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX holidays_date ON public.holidays USING btree (date);


--
-- Name: holidays_year; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX holidays_year ON public.holidays USING btree (year);


--
-- Name: idx_absence_cases_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_company ON public.absence_cases USING btree (company_id);


--
-- Name: idx_absence_cases_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_dates ON public.absence_cases USING btree (start_date, end_date);


--
-- Name: idx_absence_cases_doctor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_doctor ON public.absence_cases USING btree (assigned_doctor_id);


--
-- Name: idx_absence_cases_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_employee ON public.absence_cases USING btree (employee_id);


--
-- Name: idx_absence_cases_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_status ON public.absence_cases USING btree (case_status);


--
-- Name: idx_absence_cases_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_absence_cases_type ON public.absence_cases USING btree (absence_type);


--
-- Name: idx_access_log_company_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_access_log_company_date ON public.access_audit_log USING btree (company_id, created_at DESC);


--
-- Name: idx_access_log_denied; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_access_log_denied ON public.access_audit_log USING btree (was_allowed, created_at DESC) WHERE (was_allowed = false);


--
-- Name: idx_access_log_user_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_access_log_user_date ON public.access_audit_log USING btree (user_id, created_at DESC);


--
-- Name: idx_account_notif_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_account_notif_company ON public.company_account_notifications USING btree (company_id);


--
-- Name: idx_account_notif_unread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_account_notif_unread ON public.company_account_notifications USING btree (company_id, is_read) WHERE (is_read = false);


--
-- Name: idx_account_notif_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_account_notif_user ON public.company_account_notifications USING btree (user_id);


--
-- Name: idx_actions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_actions_company ON public.notification_actions_log USING btree (company_id, action_at DESC);


--
-- Name: idx_actions_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_actions_notification ON public.notification_actions_log USING btree (notification_id, action_at DESC);


--
-- Name: idx_actions_thread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_actions_thread ON public.notification_actions_log USING btree (thread_id, action_at DESC);


--
-- Name: idx_activity_restrictions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_restrictions_company ON public.user_activity_restrictions USING btree (company_id);


--
-- Name: idx_activity_restrictions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_restrictions_user ON public.user_activity_restrictions USING btree (user_id);


--
-- Name: idx_additional_role_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_additional_role_types_active ON public.additional_role_types USING btree (is_active);


--
-- Name: idx_additional_role_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_additional_role_types_category ON public.additional_role_types USING btree (category);


--
-- Name: idx_additional_role_types_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_additional_role_types_company ON public.additional_role_types USING btree (company_id);


--
-- Name: idx_additional_role_types_key_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_additional_role_types_key_company ON public.additional_role_types USING btree (role_key, company_id) WHERE (company_id IS NOT NULL);


--
-- Name: idx_admin_task_assigned; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_task_assigned ON public.aponnt_admin_tasks USING btree (assigned_to);


--
-- Name: idx_admin_task_due; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_task_due ON public.aponnt_admin_tasks USING btree (due_date);


--
-- Name: idx_admin_task_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_task_priority ON public.aponnt_admin_tasks USING btree (priority);


--
-- Name: idx_admin_task_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_task_status ON public.aponnt_admin_tasks USING btree (status);


--
-- Name: idx_admin_task_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_task_type ON public.aponnt_admin_tasks USING btree (task_type);


--
-- Name: idx_admin_tasks_assigned_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_assigned_to ON public.administrative_tasks USING btree (assigned_to);


--
-- Name: idx_admin_tasks_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_company ON public.administrative_tasks USING btree (company_id);


--
-- Name: idx_admin_tasks_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_created_at ON public.administrative_tasks USING btree (created_at DESC);


--
-- Name: idx_admin_tasks_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_due_date ON public.administrative_tasks USING btree (due_date) WHERE ((status)::text = ANY ((ARRAY['PENDING'::character varying, 'ASSIGNED'::character varying, 'IN_PROGRESS'::character varying])::text[]));


--
-- Name: idx_admin_tasks_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_priority ON public.administrative_tasks USING btree (priority);


--
-- Name: idx_admin_tasks_queue; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_queue ON public.administrative_tasks USING btree (status, priority DESC, created_at) WHERE ((status)::text = ANY ((ARRAY['PENDING'::character varying, 'ASSIGNED'::character varying, 'IN_PROGRESS'::character varying])::text[]));


--
-- Name: idx_admin_tasks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_status ON public.administrative_tasks USING btree (status);


--
-- Name: idx_admin_tasks_task_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_task_type ON public.administrative_tasks USING btree (task_type);


--
-- Name: idx_admin_tasks_trace_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_admin_tasks_trace_id ON public.administrative_tasks USING btree (trace_id);


--
-- Name: idx_ai_learning_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_learning_category ON public.notification_ai_learning USING btree (category, module, is_active);


--
-- Name: idx_ai_learning_pattern; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_learning_pattern ON public.notification_ai_learning USING gin (question_keywords);


--
-- Name: idx_ai_suggestions_group; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_suggestions_group ON public.notification_ai_suggestions USING btree (group_id);


--
-- Name: idx_ai_suggestions_message; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_suggestions_message ON public.notification_ai_suggestions USING btree (trigger_message_id);


--
-- Name: idx_ai_suggestions_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_suggestions_pending ON public.notification_ai_suggestions USING btree (status) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_ai_suggestions_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_suggestions_recipient ON public.notification_ai_suggestions USING btree (recipient_id);


--
-- Name: idx_alert_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alert_config_company ON public.oh_certification_alert_config USING btree (company_id);


--
-- Name: idx_alert_config_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alert_config_enabled ON public.oh_certification_alert_config USING btree (alerts_enabled);


--
-- Name: idx_allergies_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_allergies_company ON public.user_allergies USING btree (company_id);


--
-- Name: idx_allergies_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_allergies_user ON public.user_allergies USING btree (user_id);


--
-- Name: idx_allowances_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_allowances_benefit ON public.benefit_expense_allowances USING btree (employee_benefit_id);


--
-- Name: idx_allowances_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_allowances_period ON public.benefit_expense_allowances USING btree (period_start, period_end);


--
-- Name: idx_allowances_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_allowances_status ON public.benefit_expense_allowances USING btree (status);


--
-- Name: idx_analytics_cache_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_analytics_cache_expires ON public.attendance_analytics_cache USING btree (expires_at) WHERE (expires_at IS NOT NULL);


--
-- Name: idx_analytics_cache_jsonb; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_analytics_cache_jsonb ON public.attendance_analytics_cache USING gin (cached_data);


--
-- Name: idx_analytics_cache_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_analytics_cache_key ON public.attendance_analytics_cache USING btree (company_id, cache_key);


--
-- Name: idx_analytics_cache_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_analytics_cache_type ON public.attendance_analytics_cache USING btree (company_id, cache_type);


--
-- Name: idx_anthropometric_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_anthropometric_company ON public.user_anthropometric_data USING btree (company_id);


--
-- Name: idx_anthropometric_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_anthropometric_date ON public.user_anthropometric_data USING btree (measurement_date);


--
-- Name: idx_anthropometric_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_anthropometric_user ON public.user_anthropometric_data USING btree (user_id);


--
-- Name: idx_aponnt_email_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_email_active ON public.aponnt_email_config USING btree (is_active);


--
-- Name: idx_aponnt_staff_area_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_area_country ON public.aponnt_staff USING btree (area, country) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_country ON public.aponnt_staff USING btree (country) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_email ON public.aponnt_staff USING btree (email) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_level ON public.aponnt_staff USING btree (level) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_reports_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_reports_to ON public.aponnt_staff USING btree (reports_to_staff_id) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_reports_to_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_reports_to_active ON public.aponnt_staff USING btree (reports_to_staff_id, is_active) WHERE (reports_to_staff_id IS NOT NULL);


--
-- Name: idx_aponnt_staff_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_role ON public.aponnt_staff USING btree (role_id) WHERE (is_active = true);


--
-- Name: idx_aponnt_staff_role_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_role_active ON public.aponnt_staff USING btree (role_id, is_active);


--
-- Name: idx_aponnt_staff_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_user ON public.aponnt_staff USING btree (user_id) WHERE (user_id IS NOT NULL);


--
-- Name: idx_aponnt_staff_vendors; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_aponnt_staff_vendors ON public.aponnt_staff USING btree (area, country) WHERE ((is_active = true) AND ((area)::text = 'ventas'::text) AND (accepts_support_packages = true));


--
-- Name: idx_approval_history_approver; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_history_approver ON public.benefit_approval_history USING btree (approver_user_id);


--
-- Name: idx_approval_history_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_history_benefit ON public.benefit_approval_history USING btree (employee_benefit_id);


--
-- Name: idx_approval_history_decision; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_history_decision ON public.benefit_approval_history USING btree (decision);


--
-- Name: idx_approval_workflows_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_workflows_benefit ON public.benefit_approval_workflows USING btree (benefit_type_id, company_id);


--
-- Name: idx_approval_workflows_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_approval_workflows_level ON public.benefit_approval_workflows USING btree (approval_level);


--
-- Name: idx_art_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_art_active ON public.multiple_art_configurations USING btree ("isActive");


--
-- Name: idx_art_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_art_priority ON public.multiple_art_configurations USING btree (priority, "isActive");


--
-- Name: idx_assets_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assets_benefit ON public.employee_assigned_assets USING btree (employee_benefit_id);


--
-- Name: idx_assets_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assets_employee ON public.employee_assigned_assets USING btree (user_id);


--
-- Name: idx_assets_maintenance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assets_maintenance ON public.employee_assigned_assets USING btree (next_maintenance_date) WHERE ((asset_type)::text = 'VEHICLE'::text);


--
-- Name: idx_assets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assets_status ON public.employee_assigned_assets USING btree (status);


--
-- Name: idx_assets_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assets_type ON public.employee_assigned_assets USING btree (asset_type);


--
-- Name: idx_assigned_tasks_assigned_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_assigned_by ON public.user_assigned_tasks USING btree (assigned_by);


--
-- Name: idx_assigned_tasks_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_company ON public.user_assigned_tasks USING btree (company_id);


--
-- Name: idx_assigned_tasks_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_due_date ON public.user_assigned_tasks USING btree (due_date) WHERE (due_date IS NOT NULL);


--
-- Name: idx_assigned_tasks_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_priority ON public.user_assigned_tasks USING btree (priority);


--
-- Name: idx_assigned_tasks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_status ON public.user_assigned_tasks USING btree (status);


--
-- Name: idx_assigned_tasks_task; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_task ON public.user_assigned_tasks USING btree (task_id);


--
-- Name: idx_assigned_tasks_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assigned_tasks_user ON public.user_assigned_tasks USING btree (user_id);


--
-- Name: idx_assignments_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assignments_active ON public.associate_employee_assignments USING btree (contract_id, is_active) WHERE (is_active = true);


--
-- Name: idx_assignments_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assignments_contract ON public.associate_employee_assignments USING btree (contract_id);


--
-- Name: idx_assignments_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_assignments_employee ON public.associate_employee_assignments USING btree (employee_id);


--
-- Name: idx_associates_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_associates_active ON public.aponnt_associates USING btree (is_active, is_verified);


--
-- Name: idx_associates_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_associates_category ON public.aponnt_associates USING btree (category);


--
-- Name: idx_associates_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_associates_rating ON public.aponnt_associates USING btree (rating_average DESC);


--
-- Name: idx_associates_regions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_associates_regions ON public.aponnt_associates USING gin (service_regions);


--
-- Name: idx_attendance_batch_processing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_batch_processing ON public.attendances USING btree (batch_id, processing_queue) WHERE (is_processed = false);


--
-- Name: idx_attendance_clock_in_fast; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_clock_in_fast ON public.attendances USING btree ("checkInTime", "UserId");


--
-- Name: idx_attendance_incomplete; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_incomplete ON public.attendances USING btree ("UserId", "checkInTime") WHERE ("checkOutTime" IS NULL);


--
-- Name: idx_attendance_profiles_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_profiles_category ON public.attendance_profiles USING btree (company_id, profile_category);


--
-- Name: idx_attendance_profiles_dept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_profiles_dept ON public.attendance_profiles USING btree (department_id, scoring_total DESC);


--
-- Name: idx_attendance_profiles_scoring; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_profiles_scoring ON public.attendance_profiles USING btree (company_id, scoring_total DESC);


--
-- Name: idx_attendance_profiles_updated; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_profiles_updated ON public.attendance_profiles USING btree (updated_at);


--
-- Name: idx_attendance_profiles_user_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_attendance_profiles_user_company ON public.attendance_profiles USING btree (user_id, company_id);


--
-- Name: idx_attendance_rankings_dept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_rankings_dept ON public.attendance_rankings USING btree (department_id, rank_department);


--
-- Name: idx_attendance_rankings_global; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_rankings_global ON public.attendance_rankings USING btree (company_id, rank_global);


--
-- Name: idx_attendance_rankings_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_attendance_rankings_unique ON public.attendance_rankings USING btree (company_id, user_id);


--
-- Name: idx_attendance_user_date_primary; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendance_user_date_primary ON public.attendances USING btree ("UserId", work_date);


--
-- Name: idx_attendances_authorization_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_authorization_status ON public.attendances USING btree (authorization_status, authorization_requested_at) WHERE ((authorization_status)::text = 'pending'::text);


--
-- Name: idx_attendances_authorization_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_authorization_token ON public.attendances USING btree (authorization_token) WHERE (authorization_token IS NOT NULL);


--
-- Name: idx_attendances_authorized_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_authorized_by ON public.attendances USING btree (authorized_by_user_id, authorized_at);


--
-- Name: idx_attendances_checkin_gps; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_checkin_gps ON public.attendances USING btree (check_in_latitude, check_in_longitude) WHERE (check_in_latitude IS NOT NULL);


--
-- Name: idx_attendances_checkout_gps; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_checkout_gps ON public.attendances USING btree (check_out_latitude, check_out_longitude) WHERE (check_out_latitude IS NOT NULL);


--
-- Name: idx_attendances_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_company ON public.attendances USING btree (company_id);


--
-- Name: idx_attendances_date_weather; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_date_weather ON public.attendances USING btree (date, weather_pattern);


--
-- Name: idx_attendances_kiosk_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_kiosk_id ON public.attendances USING btree (kiosk_id);


--
-- Name: idx_attendances_open_checkins; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_open_checkins ON public.attendances USING btree ("UserId", date) WHERE ("checkOutTime" IS NULL);


--
-- Name: idx_attendances_origin_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_origin_type ON public.attendances USING btree (origin_type);


--
-- Name: idx_attendances_weather_pattern; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_attendances_weather_pattern ON public.attendances USING btree (weather_pattern);


--
-- Name: idx_audit_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_action ON public.audit_logs USING btree (action);


--
-- Name: idx_audit_logs_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_company_id ON public.audit_logs USING btree (company_id);


--
-- Name: idx_audit_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_created_at ON public.audit_logs USING btree (created_at);


--
-- Name: idx_audit_logs_module_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_module_id ON public.audit_logs USING btree (module_id);


--
-- Name: idx_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_logs_user_id ON public.audit_logs USING btree (user_id);


--
-- Name: idx_audit_test_logs_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_company_id ON public.audit_test_logs USING btree (company_id);


--
-- Name: idx_audit_test_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_created_at ON public.audit_test_logs USING btree (created_at DESC);


--
-- Name: idx_audit_test_logs_execution_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_execution_id ON public.audit_test_logs USING btree (execution_id);


--
-- Name: idx_audit_test_logs_execution_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_execution_status ON public.audit_test_logs USING btree (execution_id, status);


--
-- Name: idx_audit_test_logs_fix_applied; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_fix_applied ON public.audit_test_logs USING btree (fix_applied);


--
-- Name: idx_audit_test_logs_metadata_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_metadata_gin ON public.audit_test_logs USING gin (metadata);


--
-- Name: idx_audit_test_logs_module_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_module_name ON public.audit_test_logs USING btree (module_name);


--
-- Name: idx_audit_test_logs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_test_logs_status ON public.audit_test_logs USING btree (status);


--
-- Name: idx_audit_timeline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audit_timeline ON public.medical_record_audit_log USING btree (record_id, action_at);


--
-- Name: idx_auth_log_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auth_log_company ON public.afip_auth_log USING btree (company_id);


--
-- Name: idx_auth_log_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auth_log_expiration ON public.afip_auth_log USING btree (expiration_time);


--
-- Name: idx_auth_log_service; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_auth_log_service ON public.afip_auth_log USING btree (service);


--
-- Name: idx_benchmarks_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benchmarks_category ON public.risk_benchmarks USING btree (work_category);


--
-- Name: idx_benchmarks_ciuo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benchmarks_ciuo ON public.risk_benchmarks USING btree (ciuo_code);


--
-- Name: idx_benchmarks_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benchmarks_country ON public.risk_benchmarks USING btree (country_code);


--
-- Name: idx_benchmarks_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_benchmarks_unique ON public.risk_benchmarks USING btree (benchmark_code, country_code);


--
-- Name: idx_benefit_doc_reqs_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_doc_reqs_benefit ON public.benefit_document_requirements USING btree (benefit_type_id);


--
-- Name: idx_benefit_doc_reqs_doctype; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_doc_reqs_doctype ON public.benefit_document_requirements USING btree (document_type_id);


--
-- Name: idx_benefit_docs_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_docs_benefit ON public.employee_benefit_documents USING btree (employee_benefit_id);


--
-- Name: idx_benefit_docs_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_docs_expiration ON public.employee_benefit_documents USING btree (expiration_date) WHERE (is_current = true);


--
-- Name: idx_benefit_docs_requirement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_docs_requirement ON public.employee_benefit_documents USING btree (requirement_id);


--
-- Name: idx_benefit_docs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_docs_status ON public.employee_benefit_documents USING btree (verification_status);


--
-- Name: idx_benefit_payroll_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_payroll_benefit ON public.benefit_payroll_concepts USING btree (benefit_type_id);


--
-- Name: idx_benefit_payroll_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_payroll_company ON public.benefit_payroll_concepts USING btree (company_id);


--
-- Name: idx_benefit_payroll_concept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_payroll_concept ON public.benefit_payroll_concepts USING btree (payroll_concept_type_id);


--
-- Name: idx_benefit_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_types_active ON public.benefit_types USING btree (is_active);


--
-- Name: idx_benefit_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_benefit_types_category ON public.benefit_types USING btree (category);


--
-- Name: idx_biometric_ai_company_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_ai_company_date ON public.biometric_ai_analysis USING btree (company_id, processed_at DESC);


--
-- Name: idx_biometric_ai_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_ai_employee ON public.biometric_ai_analysis USING btree (employee_id, processed_at DESC);


--
-- Name: idx_biometric_ai_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_ai_template ON public.biometric_ai_analysis USING btree (template_id) WHERE (template_id IS NOT NULL);


--
-- Name: idx_biometric_attempts_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_attempts_timestamp ON public.biometric_capture_attempts USING btree ("timestamp");


--
-- Name: idx_biometric_attempts_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_attempts_user ON public.biometric_capture_attempts USING btree (user_id);


--
-- Name: idx_biometric_devices_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_devices_active ON public.biometric_devices USING btree (device_id, is_active) WHERE (is_active = true);


--
-- Name: idx_biometric_devices_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_devices_company ON public.biometric_devices USING btree (company_id, is_active);


--
-- Name: idx_biometric_events_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_events_company_id ON public.biometric_events USING btree (company_id);


--
-- Name: idx_biometric_events_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_events_timestamp ON public.biometric_events USING btree ("timestamp");


--
-- Name: idx_biometric_events_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_events_type ON public.biometric_events USING btree (event_type);


--
-- Name: idx_biometric_events_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_events_user_id ON public.biometric_events USING btree (user_id);


--
-- Name: idx_biometric_templates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_templates_company ON public.biometric_templates USING btree (company_id);


--
-- Name: idx_biometric_templates_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_templates_employee ON public.biometric_templates USING btree (employee_id);


--
-- Name: idx_biometric_templates_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_biometric_templates_hash ON public.biometric_templates USING btree (embedding_hash);


--
-- Name: idx_branch_fiscal_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_branch_fiscal_active ON public.branch_offices_fiscal USING btree (is_active);


--
-- Name: idx_branch_fiscal_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_branch_fiscal_company ON public.branch_offices_fiscal USING btree (company_id);


--
-- Name: idx_branch_fiscal_punto_venta; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_branch_fiscal_punto_venta ON public.branch_offices_fiscal USING btree (company_id, punto_venta);


--
-- Name: idx_budgets_budget_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_budget_code ON public.budgets USING btree (budget_code);


--
-- Name: idx_budgets_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_company ON public.budgets USING btree (company_id);


--
-- Name: idx_budgets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_status ON public.budgets USING btree (status);


--
-- Name: idx_budgets_trace_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_trace_id ON public.budgets USING btree (trace_id);


--
-- Name: idx_budgets_valid_until; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_valid_until ON public.budgets USING btree (valid_until) WHERE ((status)::text = ANY ((ARRAY['PENDING'::character varying, 'SENT'::character varying, 'VIEWED'::character varying])::text[]));


--
-- Name: idx_budgets_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budgets_vendor ON public.budgets USING btree (vendor_id);


--
-- Name: idx_cae_log_cae; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cae_log_cae ON public.afip_cae_log USING btree (cae);


--
-- Name: idx_cae_log_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cae_log_company ON public.afip_cae_log USING btree (company_id);


--
-- Name: idx_cae_log_comprobante; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cae_log_comprobante ON public.afip_cae_log USING btree (company_id, punto_venta, tipo_comprobante, numero_comprobante);


--
-- Name: idx_cae_log_factura; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cae_log_factura ON public.afip_cae_log USING btree (factura_id);


--
-- Name: idx_cajas_activo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cajas_activo ON public.siac_cajas USING btree (activo);


--
-- Name: idx_cajas_punto_venta; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cajas_punto_venta ON public.siac_cajas USING btree (punto_venta_id);


--
-- Name: idx_cert_alerts_certification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_alerts_certification ON public.oh_certification_alerts USING btree (certification_id);


--
-- Name: idx_cert_alerts_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_alerts_company ON public.oh_certification_alerts USING btree (company_id);


--
-- Name: idx_cert_alerts_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_alerts_employee ON public.oh_certification_alerts USING btree (employee_id);


--
-- Name: idx_cert_alerts_sent_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_alerts_sent_at ON public.oh_certification_alerts USING btree (sent_at);


--
-- Name: idx_cert_alerts_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_alerts_type ON public.oh_certification_alerts USING btree (alert_type);


--
-- Name: idx_cert_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_types_active ON public.oh_certification_types USING btree (is_active);


--
-- Name: idx_cert_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_cert_types_category ON public.oh_certification_types USING btree (category);


--
-- Name: idx_children_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_children_company ON public.user_children USING btree (company_id);


--
-- Name: idx_children_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_children_user ON public.user_children USING btree (user_id);


--
-- Name: idx_chronic_conditions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_chronic_conditions_company ON public.user_chronic_conditions USING btree (company_id);


--
-- Name: idx_chronic_conditions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_chronic_conditions_user ON public.user_chronic_conditions USING btree (user_id);


--
-- Name: idx_chronic_v2_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_chronic_v2_company ON public.user_chronic_conditions_v2 USING btree (company_id);


--
-- Name: idx_chronic_v2_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_chronic_v2_user ON public.user_chronic_conditions_v2 USING btree (user_id);


--
-- Name: idx_clientes_bloqueados; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_bloqueados ON public.siac_clientes USING btree (bloqueo_por_vencimiento, bloqueo_por_credito);


--
-- Name: idx_clientes_condicion_fiscal; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_condicion_fiscal ON public.siac_clientes USING btree (condicion_fiscal_code);


--
-- Name: idx_clientes_cuenta_corriente; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_cuenta_corriente ON public.siac_clientes USING btree (cuenta_corriente_habilitada) WHERE (cuenta_corriente_habilitada = true);


--
-- Name: idx_clientes_pais; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_pais ON public.siac_clientes USING btree (pais);


--
-- Name: idx_clientes_provincia; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_provincia ON public.siac_clientes USING btree (provincia);


--
-- Name: idx_clientes_vendedor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_vendedor ON public.siac_clientes USING btree (vendedor_id);


--
-- Name: idx_clientes_zona; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_clientes_zona ON public.siac_clientes USING btree (zona_comercial);


--
-- Name: idx_comm_liq_breakdown_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_breakdown_gin ON public.commission_liquidations USING gin (commission_breakdown);


--
-- Name: idx_comm_liq_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_company ON public.commission_liquidations USING btree (company_id);


--
-- Name: idx_comm_liq_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_date ON public.commission_liquidations USING btree (liquidation_date DESC);


--
-- Name: idx_comm_liq_invoice; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_invoice ON public.commission_liquidations USING btree (invoice_id);


--
-- Name: idx_comm_liq_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_payment_date ON public.commission_liquidations USING btree (payment_scheduled_date) WHERE ((status)::text = ANY ((ARRAY['PAYMENT_PENDING'::character varying, 'PAYMENT_IN_PROGRESS'::character varying])::text[]));


--
-- Name: idx_comm_liq_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_period ON public.commission_liquidations USING btree (period_start, period_end);


--
-- Name: idx_comm_liq_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_status ON public.commission_liquidations USING btree (status);


--
-- Name: idx_comm_liq_trace_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_trace_id ON public.commission_liquidations USING btree (trace_id);


--
-- Name: idx_comm_liq_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_liq_type ON public.commission_liquidations USING btree (liquidation_type);


--
-- Name: idx_comm_pay_batch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_batch ON public.commission_payments USING btree (payment_batch_id) WHERE (payment_batch_id IS NOT NULL);


--
-- Name: idx_comm_pay_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_code ON public.commission_payments USING btree (payment_code);


--
-- Name: idx_comm_pay_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_company ON public.commission_payments USING btree (company_id);


--
-- Name: idx_comm_pay_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_date ON public.commission_payments USING btree (payment_date DESC);


--
-- Name: idx_comm_pay_liquidation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_liquidation ON public.commission_payments USING btree (liquidation_id);


--
-- Name: idx_comm_pay_scheduled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_scheduled ON public.commission_payments USING btree (scheduled_date) WHERE ((status)::text = ANY ((ARRAY['PENDING'::character varying, 'SCHEDULED'::character varying])::text[]));


--
-- Name: idx_comm_pay_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_status ON public.commission_payments USING btree (status);


--
-- Name: idx_comm_pay_trace_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_trace_id ON public.commission_payments USING btree (trace_id);


--
-- Name: idx_comm_pay_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comm_pay_vendor ON public.commission_payments USING btree (vendor_id);


--
-- Name: idx_companies_assigned_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_assigned_vendor ON public.companies USING btree (assigned_vendor_id);


--
-- Name: idx_companies_assigned_vendor_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_assigned_vendor_active ON public.companies USING btree (assigned_vendor_id, is_active) WHERE (assigned_vendor_id IS NOT NULL);


--
-- Name: idx_companies_contact_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_contact_email ON public.companies USING btree (contact_email);


--
-- Name: idx_companies_created_by_staff; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_created_by_staff ON public.companies USING btree (created_by_staff_id);


--
-- Name: idx_companies_license_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_license_type ON public.companies USING btree (license_type);


--
-- Name: idx_companies_modules_trial_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_modules_trial_gin ON public.companies USING gin (modules_trial);


--
-- Name: idx_companies_onboarding_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_onboarding_status ON public.companies USING btree (onboarding_status);


--
-- Name: idx_companies_onboarding_trace; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_onboarding_trace ON public.companies USING btree (onboarding_trace_id);


--
-- Name: idx_companies_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_status ON public.companies USING btree (status);


--
-- Name: idx_companies_supervision; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_supervision ON public.companies USING btree (requiere_supervision_factura) WHERE (requiere_supervision_factura = true);


--
-- Name: idx_companies_support_sla_plan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_support_sla_plan ON public.companies USING btree (support_sla_plan_id);


--
-- Name: idx_companies_support_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_support_vendor ON public.companies USING btree (support_vendor_id);


--
-- Name: idx_companies_support_vendor_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_support_vendor_active ON public.companies USING btree (support_vendor_id, is_active) WHERE (support_vendor_id IS NOT NULL);


--
-- Name: idx_companies_tax_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_tax_id ON public.companies USING btree (tax_id);


--
-- Name: idx_companies_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_companies_vendor ON public.companies USING btree (vendor_id);


--
-- Name: idx_company_benefits_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_benefits_active ON public.company_benefit_policies USING btree (is_active, company_id);


--
-- Name: idx_company_benefits_benefit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_benefits_benefit ON public.company_benefit_policies USING btree (benefit_type_id);


--
-- Name: idx_company_benefits_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_benefits_company ON public.company_benefit_policies USING btree (company_id);


--
-- Name: idx_company_branches_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_branches_company ON public.company_branches USING btree (company_id);


--
-- Name: idx_company_branches_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_branches_country ON public.company_branches USING btree (country_id);


--
-- Name: idx_company_comms_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_comms_company ON public.company_communications USING btree (company_id);


--
-- Name: idx_company_comms_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_comms_created ON public.company_communications USING btree (created_at DESC);


--
-- Name: idx_company_comms_direction; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_comms_direction ON public.company_communications USING btree (direction);


--
-- Name: idx_company_comms_parent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_comms_parent ON public.company_communications USING btree (parent_id);


--
-- Name: idx_company_comms_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_comms_status ON public.company_communications USING btree (status);


--
-- Name: idx_company_dependencies_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_dependencies_active ON public.company_dependencies USING btree (company_id, is_active);


--
-- Name: idx_company_dependencies_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_dependencies_company ON public.company_dependencies USING btree (company_id);


--
-- Name: idx_company_dependencies_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_dependencies_type ON public.company_dependencies USING btree (dependency_type_id);


--
-- Name: idx_company_email_config_bidirectional; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_email_config_bidirectional ON public.company_email_config USING btree (bidirectional_enabled) WHERE (bidirectional_enabled = true);


--
-- Name: idx_company_email_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_email_config_company ON public.company_email_config USING btree (company_id);


--
-- Name: idx_company_email_config_imap_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_email_config_imap_enabled ON public.company_email_config USING btree (imap_enabled) WHERE (imap_enabled = true);


--
-- Name: idx_company_inbox_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_inbox_company ON public.company_inbox_processed USING btree (company_id);


--
-- Name: idx_company_inbox_message_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_inbox_message_id ON public.company_inbox_processed USING btree (message_id);


--
-- Name: idx_company_medical_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_medical_company ON public.company_medical_staff USING btree (company_id);


--
-- Name: idx_company_medical_partner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_medical_partner ON public.company_medical_staff USING btree (partner_id);


--
-- Name: idx_company_modules_activo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_modules_activo ON public.company_modules USING btree (activo);


--
-- Name: idx_company_modules_bundled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_modules_bundled ON public.company_modules USING btree (company_id, is_bundled, bundled_with);


--
-- Name: idx_company_modules_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_modules_company_id ON public.company_modules USING btree (company_id);


--
-- Name: idx_company_modules_system_module_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_modules_system_module_id ON public.company_modules USING btree (system_module_id);


--
-- Name: idx_company_risk_config; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_company_risk_config ON public.company_risk_config USING btree (company_id);


--
-- Name: idx_company_support_assignments_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_support_assignments_active ON public.company_support_assignments USING btree (is_active);


--
-- Name: idx_company_support_assignments_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_support_assignments_company ON public.company_support_assignments USING btree (company_id);


--
-- Name: idx_company_support_assignments_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_support_assignments_vendor ON public.company_support_assignments USING btree (assigned_vendor_id);


--
-- Name: idx_company_tasks_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_tasks_active ON public.company_tasks USING btree (is_active);


--
-- Name: idx_company_tasks_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_tasks_category ON public.company_tasks USING btree (task_category);


--
-- Name: idx_company_tasks_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_tasks_company ON public.company_tasks USING btree (company_id);


--
-- Name: idx_company_tasks_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_tasks_template ON public.company_tasks USING btree (is_template);


--
-- Name: idx_company_tax_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_company_tax_config_company ON public.company_tax_config USING btree (company_id);


--
-- Name: idx_comparative_cube; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comparative_cube ON public.comparative_analytics USING btree (company_id, cube_id);


--
-- Name: idx_comparative_dimensions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comparative_dimensions ON public.comparative_analytics USING btree (dimension_org, dimension_org_value, dimension_time_value);


--
-- Name: idx_comparative_measure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comparative_measure ON public.comparative_analytics USING btree (company_id, measure_name, calculated_at DESC);


--
-- Name: idx_comparative_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_comparative_time ON public.comparative_analytics USING btree (dimension_time, dimension_time_value);


--
-- Name: idx_concept_dependencies_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_dependencies_company ON public.concept_dependencies USING btree (company_id);


--
-- Name: idx_concept_dependencies_concept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_dependencies_concept ON public.concept_dependencies USING btree (concept_id);


--
-- Name: idx_concept_dependencies_dependency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_dependencies_dependency ON public.concept_dependencies USING btree (dependency_id);


--
-- Name: idx_concept_rates_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_rates_country ON public.payroll_concept_type_rates USING btree (country_id);


--
-- Name: idx_concept_rates_effective; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_rates_effective ON public.payroll_concept_type_rates USING btree (effective_from, effective_to);


--
-- Name: idx_concept_rates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_rates_type ON public.payroll_concept_type_rates USING btree (concept_type_id);


--
-- Name: idx_concept_types_classification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_types_classification ON public.payroll_concept_types USING btree (classification_id);


--
-- Name: idx_concept_types_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_types_company ON public.payroll_concept_types USING btree (company_id);


--
-- Name: idx_concept_types_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_concept_types_country ON public.payroll_concept_types USING btree (country_id);


--
-- Name: idx_consciousness_log_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consciousness_log_company ON public.system_consciousness_log USING btree (company_id);


--
-- Name: idx_consciousness_log_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consciousness_log_created ON public.system_consciousness_log USING btree (created_at DESC);


--
-- Name: idx_consciousness_log_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consciousness_log_module ON public.system_consciousness_log USING btree (module_key);


--
-- Name: idx_consciousness_log_result; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consciousness_log_result ON public.system_consciousness_log USING btree (result);


--
-- Name: idx_consciousness_log_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consciousness_log_type ON public.system_consciousness_log USING btree (event_type);


--
-- Name: idx_consent_audit_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_audit_created_at ON public.consent_audit_log USING btree (created_at DESC);


--
-- Name: idx_consent_audit_user_consent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_audit_user_consent ON public.consent_audit_log USING btree (user_consent_id);


--
-- Name: idx_consent_change_log_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_change_log_company ON public.consent_change_log USING btree (company_id);


--
-- Name: idx_consent_change_log_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_change_log_type ON public.consent_change_log USING btree (change_type);


--
-- Name: idx_consent_change_log_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_change_log_user ON public.consent_change_log USING btree (user_id);


--
-- Name: idx_consent_definitions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_definitions_active ON public.consent_definitions USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_consent_definitions_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_definitions_key ON public.consent_definitions USING btree (consent_key);


--
-- Name: idx_consent_definitions_roles; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consent_definitions_roles ON public.consent_definitions USING gin (applicable_roles);


--
-- Name: idx_consents_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_active ON public.biometric_consents USING btree (company_id, user_id, consent_type) WHERE (revoked = false);


--
-- Name: idx_consents_company_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_company_status ON public.biometric_consents USING btree (company_id, consent_given, revoked);


--
-- Name: idx_consents_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_expires ON public.biometric_consents USING btree (expires_at) WHERE (expires_at IS NOT NULL);


--
-- Name: idx_consents_method; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_method ON public.biometric_consents USING btree (acceptance_method);


--
-- Name: idx_consents_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_token ON public.biometric_consents USING btree (consent_token) WHERE (consent_token IS NOT NULL);


--
-- Name: idx_consents_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_type ON public.biometric_consents USING btree (consent_type);


--
-- Name: idx_consents_user_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_consents_user_company ON public.biometric_consents USING btree (user_id, company_id);


--
-- Name: idx_contact_history_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contact_history_user ON public.user_contact_history USING btree (user_id);


--
-- Name: idx_contract_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contract_types_category ON public.contract_template_types USING btree (category);


--
-- Name: idx_contracts_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_active ON public.company_associate_contracts USING btree (company_id, status) WHERE (status = 'active'::public.contract_status);


--
-- Name: idx_contracts_asset; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_asset ON public.asset_contracts USING btree (asset_assignment_id);


--
-- Name: idx_contracts_associate; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_associate ON public.company_associate_contracts USING btree (associate_id);


--
-- Name: idx_contracts_budget; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_budget ON public.contracts USING btree (budget_id);


--
-- Name: idx_contracts_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_company ON public.contracts USING btree (company_id);


--
-- Name: idx_contracts_contract_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_contract_code ON public.contracts USING btree (contract_code);


--
-- Name: idx_contracts_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_dates ON public.asset_contracts USING btree (contract_start_date, contract_end_date);


--
-- Name: idx_contracts_end_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_end_date ON public.contracts USING btree (end_date);


--
-- Name: idx_contracts_grace_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_grace_period ON public.contracts USING btree (grace_period_end) WHERE ((status)::text = 'GRACE_PERIOD'::text);


--
-- Name: idx_contracts_renewal_alert; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_renewal_alert ON public.contracts USING btree (next_renewal_alert_date) WHERE ((status)::text = ANY ((ARRAY['ACTIVE'::character varying, 'RENEWAL_PENDING'::character varying, 'GRACE_PERIOD'::character varying])::text[]));


--
-- Name: idx_contracts_signed_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_signed_at ON public.contracts USING btree (signed_at);


--
-- Name: idx_contracts_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_status ON public.contracts USING btree (status);


--
-- Name: idx_contracts_trace_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_trace_id ON public.contracts USING btree (trace_id);


--
-- Name: idx_contracts_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contracts_vendor ON public.contracts USING btree (vendor_id);


--
-- Name: idx_dep_evaluations_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dep_evaluations_company ON public.dependency_evaluations USING btree (company_id);


--
-- Name: idx_dep_evaluations_concept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dep_evaluations_concept ON public.dependency_evaluations USING btree (concept_id);


--
-- Name: idx_dep_evaluations_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dep_evaluations_period ON public.dependency_evaluations USING btree (payroll_period);


--
-- Name: idx_dep_evaluations_run; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dep_evaluations_run ON public.dependency_evaluations USING btree (payroll_run_id) WHERE (payroll_run_id IS NOT NULL);


--
-- Name: idx_dep_evaluations_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dep_evaluations_user ON public.dependency_evaluations USING btree (user_id);


--
-- Name: idx_departments_allow_gps_attendance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_departments_allow_gps_attendance ON public.departments USING btree (allow_gps_attendance);


--
-- Name: idx_departments_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_departments_company_id ON public.departments USING btree (company_id);


--
-- Name: idx_departments_default_kiosk_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_departments_default_kiosk_id ON public.departments USING btree (default_kiosk_id);


--
-- Name: idx_departments_name_lower; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_departments_name_lower ON public.departments USING btree (lower((name)::text));


--
-- Name: idx_dependency_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dependency_types_active ON public.dependency_types USING btree (is_active);


--
-- Name: idx_dependency_types_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dependency_types_code ON public.dependency_types USING btree (type_code);


--
-- Name: idx_dept_aliases_alias; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dept_aliases_alias ON public.department_aliases USING btree (lower((alias)::text), company_id);


--
-- Name: idx_detections_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_detections_company ON public.biometric_detections USING btree (company_id);


--
-- Name: idx_detections_company_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_detections_company_time ON public.biometric_detections USING btree (company_id, detection_timestamp);


--
-- Name: idx_detections_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_detections_employee ON public.biometric_detections USING btree (employee_id);


--
-- Name: idx_detections_registered; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_detections_registered ON public.biometric_detections USING btree (was_registered);


--
-- Name: idx_detections_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_detections_timestamp ON public.biometric_detections USING btree (detection_timestamp DESC);


--
-- Name: idx_disciplinary_actions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_disciplinary_actions_company ON public.user_disciplinary_actions USING btree (company_id);


--
-- Name: idx_disciplinary_actions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_disciplinary_actions_user ON public.user_disciplinary_actions USING btree (user_id);


--
-- Name: idx_dms_access_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_access_action ON public.dms_access_log USING btree (action, created_at DESC);


--
-- Name: idx_dms_access_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_access_company ON public.dms_access_log USING btree (company_id, created_at DESC);


--
-- Name: idx_dms_access_document; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_access_document ON public.dms_access_log USING btree (document_id, created_at DESC);


--
-- Name: idx_dms_access_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_access_user ON public.dms_access_log USING btree (user_id, created_at DESC);


--
-- Name: idx_dms_alerts; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_alerts ON public.dms_document_alerts USING btree (user_id, is_read, is_dismissed);


--
-- Name: idx_dms_alerts_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_alerts_company ON public.dms_document_alerts USING btree (company_id, created_at DESC);


--
-- Name: idx_dms_approvals; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_approvals ON public.dms_workflow_approvals USING btree (assigned_to, decision) WHERE ((decision)::text = 'pending'::text);


--
-- Name: idx_dms_approvals_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_approvals_company ON public.dms_workflow_approvals USING btree (company_id, decision);


--
-- Name: idx_dms_docs_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_active ON public.dms_documents USING btree (company_id, created_at DESC) WHERE ((is_deleted = false) AND ((status)::text <> ALL ((ARRAY['DELETED'::character varying, 'ARCHIVED'::character varying])::text[])));


--
-- Name: idx_dms_docs_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_category ON public.dms_documents USING btree (category_code, type_code) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_company ON public.dms_documents USING btree (company_id) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_expiration ON public.dms_documents USING btree (expiration_date) WHERE ((is_deleted = false) AND (expiration_date IS NOT NULL));


--
-- Name: idx_dms_docs_folder; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_folder ON public.dms_documents USING btree (folder_id) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_owner ON public.dms_documents USING btree (owner_type, owner_id) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_search; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_search ON public.dms_documents USING gin (search_vector);


--
-- Name: idx_dms_docs_source; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_source ON public.dms_documents USING btree (source_module, source_entity_type, source_entity_id) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_status ON public.dms_documents USING btree (status) WHERE (is_deleted = false);


--
-- Name: idx_dms_docs_tags; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_tags ON public.dms_documents USING gin (tags);


--
-- Name: idx_dms_docs_user_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_docs_user_active ON public.dms_documents USING btree (owner_id, category_code, created_at DESC) WHERE ((is_deleted = false) AND ((owner_type)::text = 'user'::text));


--
-- Name: idx_dms_documents_owner_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_documents_owner_module ON public.dms_documents USING btree (owner_id, source_module);


--
-- Name: idx_dms_documents_source_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_documents_source_entity ON public.dms_documents USING btree (source_entity_type, source_entity_id);


--
-- Name: idx_dms_documents_source_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_documents_source_module ON public.dms_documents USING btree (source_module);


--
-- Name: idx_dms_folders_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_folders_company ON public.dms_folders USING btree (company_id) WHERE (is_active = true);


--
-- Name: idx_dms_folders_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_folders_owner ON public.dms_folders USING btree (owner_type, owner_id);


--
-- Name: idx_dms_folders_parent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_folders_parent ON public.dms_folders USING btree (parent_id);


--
-- Name: idx_dms_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_metadata ON public.dms_document_metadata USING btree (metadata_key, metadata_value) WHERE (is_searchable = true);


--
-- Name: idx_dms_permissions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_permissions ON public.dms_document_permissions USING btree (document_id, grantee_type, grantee_id) WHERE (is_active = true);


--
-- Name: idx_dms_requests; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_requests ON public.dms_document_requests USING btree (requested_from_id, status);


--
-- Name: idx_dms_requests_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_requests_company ON public.dms_document_requests USING btree (company_id, status);


--
-- Name: idx_dms_versions; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_versions ON public.dms_document_versions USING btree (document_id, version_number DESC);


--
-- Name: idx_dms_workflows; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_workflows ON public.dms_workflow_instances USING btree (document_id, status);


--
-- Name: idx_dms_workflows_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dms_workflows_company ON public.dms_workflow_instances USING btree (company_id, status);


--
-- Name: idx_driver_licenses_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_driver_licenses_active ON public.user_driver_licenses USING btree (is_active);


--
-- Name: idx_driver_licenses_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_driver_licenses_company ON public.user_driver_licenses USING btree (company_id);


--
-- Name: idx_driver_licenses_expiry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_driver_licenses_expiry ON public.user_driver_licenses USING btree (expiry_date) WHERE (expiry_date IS NOT NULL);


--
-- Name: idx_driver_licenses_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_driver_licenses_type ON public.user_driver_licenses USING btree (license_type);


--
-- Name: idx_driver_licenses_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_driver_licenses_user ON public.user_driver_licenses USING btree (user_id);


--
-- Name: idx_ecosystem_file_cache_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_file_cache_type ON public.ecosystem_file_cache USING btree (file_type, file_category);


--
-- Name: idx_ecosystem_file_cache_valid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_file_cache_valid ON public.ecosystem_file_cache USING btree (is_valid);


--
-- Name: idx_ecosystem_tasks_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_tasks_module ON public.ecosystem_tasks USING btree (assigned_module);


--
-- Name: idx_ecosystem_tasks_phase; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_tasks_phase ON public.ecosystem_tasks USING btree (phase_id);


--
-- Name: idx_ecosystem_tasks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_tasks_status ON public.ecosystem_tasks USING btree (status);


--
-- Name: idx_ecosystem_workflows_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ecosystem_workflows_module ON public.ecosystem_workflows USING btree (module_key);


--
-- Name: idx_education_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_education_company ON public.user_education USING btree (company_id);


--
-- Name: idx_education_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_education_user ON public.user_education USING btree (user_id);


--
-- Name: idx_email_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_config_active ON public.email_configurations USING btree (is_active, is_verified);


--
-- Name: idx_email_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_config_company ON public.email_configurations USING btree (company_id);


--
-- Name: idx_email_config_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_config_email ON public.email_configurations USING btree (institutional_email);


--
-- Name: idx_email_logs_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_category ON public.email_logs USING btree (category);


--
-- Name: idx_email_logs_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_created ON public.email_logs USING btree (created_at DESC);


--
-- Name: idx_email_logs_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_recipient ON public.email_logs USING btree (recipient_email);


--
-- Name: idx_email_logs_sender; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_sender ON public.email_logs USING btree (sender_type, sender_id);


--
-- Name: idx_email_logs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_status ON public.email_logs USING btree (status);


--
-- Name: idx_email_logs_tracking; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_tracking ON public.email_logs USING btree (tracking_id);


--
-- Name: idx_email_templates_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_templates_category ON public.email_templates USING btree (category);


--
-- Name: idx_email_templates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_templates_company ON public.email_templates USING btree (company_id);


--
-- Name: idx_email_templates_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_templates_key ON public.email_templates USING btree (template_key);


--
-- Name: idx_email_verification_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_verification_expires ON public.email_verification_tokens USING btree (expires_at) WHERE (is_verified = false);


--
-- Name: idx_email_verification_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_verification_token ON public.email_verification_tokens USING btree (token) WHERE (is_verified = false);


--
-- Name: idx_email_verification_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_verification_user ON public.email_verification_tokens USING btree (user_id, user_type);


--
-- Name: idx_emergency_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emergency_priority ON public.user_emergency_contacts USING btree (user_id, priority);


--
-- Name: idx_emergency_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emergency_user_id ON public.user_emergency_contacts USING btree (user_id);


--
-- Name: idx_emotional_analysis_fatigue; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emotional_analysis_fatigue ON public.biometric_emotional_analysis USING btree (company_id, fatigue_score DESC) WHERE (fatigue_score > 0.6);


--
-- Name: idx_emotional_analysis_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emotional_analysis_timestamp ON public.biometric_emotional_analysis USING btree (scan_timestamp DESC);


--
-- Name: idx_emotional_analysis_user_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emotional_analysis_user_time ON public.biometric_emotional_analysis USING btree (company_id, user_id, scan_timestamp DESC);


--
-- Name: idx_emp_cert_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_active ON public.oh_employee_certifications USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_emp_cert_alerts; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_alerts ON public.oh_employee_certifications USING btree (company_id, status, expiration_date, deleted_at) WHERE ((deleted_at IS NULL) AND ((status)::text = ANY ((ARRAY['active'::character varying, 'expiring_soon'::character varying])::text[])));


--
-- Name: idx_emp_cert_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_company ON public.oh_employee_certifications USING btree (company_id);


--
-- Name: idx_emp_cert_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_employee ON public.oh_employee_certifications USING btree (employee_id);


--
-- Name: idx_emp_cert_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_expiration ON public.oh_employee_certifications USING btree (expiration_date);


--
-- Name: idx_emp_cert_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_status ON public.oh_employee_certifications USING btree (status);


--
-- Name: idx_emp_cert_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_cert_type ON public.oh_employee_certifications USING btree (certification_type_id);


--
-- Name: idx_emp_dep_docs_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_company ON public.employee_dependency_documents USING btree (company_id);


--
-- Name: idx_emp_dep_docs_current; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_current ON public.employee_dependency_documents USING btree (user_id, dependency_id, is_current) WHERE (is_current = true);


--
-- Name: idx_emp_dep_docs_dependency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_dependency ON public.employee_dependency_documents USING btree (dependency_id);


--
-- Name: idx_emp_dep_docs_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_expiration ON public.employee_dependency_documents USING btree (expiration_date) WHERE (expiration_date IS NOT NULL);


--
-- Name: idx_emp_dep_docs_family; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_family ON public.employee_dependency_documents USING btree (family_member_type, family_member_id);


--
-- Name: idx_emp_dep_docs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_status ON public.employee_dependency_documents USING btree (status);


--
-- Name: idx_emp_dep_docs_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emp_dep_docs_user ON public.employee_dependency_documents USING btree (user_id);


--
-- Name: idx_employee_benefits_active_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_benefits_active_dates ON public.employee_benefits USING btree (effective_from, effective_until) WHERE ((status)::text = 'active'::text);


--
-- Name: idx_employee_benefits_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_benefits_company ON public.employee_benefits USING btree (company_id);


--
-- Name: idx_employee_benefits_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_benefits_employee ON public.employee_benefits USING btree (user_id);


--
-- Name: idx_employee_benefits_policy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_benefits_policy ON public.employee_benefits USING btree (company_benefit_policy_id);


--
-- Name: idx_employee_benefits_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_benefits_status ON public.employee_benefits USING btree (status);


--
-- Name: idx_employee_doc_alerts; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_doc_alerts ON public.employee_documents USING btree ("expiryDate", "alertDays", "lastAlertSent");


--
-- Name: idx_employee_doc_expiry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_doc_expiry ON public.employee_documents USING btree ("expiryDate", status);


--
-- Name: idx_employee_doc_number; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_doc_number ON public.employee_documents USING btree ("documentNumber", "documentType");


--
-- Name: idx_employee_doc_user_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_employee_doc_user_type ON public.employee_documents USING btree ("userId", "documentType", "isActive");


--
-- Name: idx_entity_categories_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_categories_company ON public.payroll_entity_categories USING btree (company_id);


--
-- Name: idx_entity_categories_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_categories_country ON public.payroll_entity_categories USING btree (country_id);


--
-- Name: idx_entity_categories_flow; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_categories_flow ON public.payroll_entity_categories USING btree (flow_direction);


--
-- Name: idx_entity_settlement_details_settlement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlement_details_settlement ON public.payroll_entity_settlement_details USING btree (settlement_id);


--
-- Name: idx_entity_settlement_details_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlement_details_user ON public.payroll_entity_settlement_details USING btree (user_id);


--
-- Name: idx_entity_settlements_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlements_company ON public.payroll_entity_settlements USING btree (company_id);


--
-- Name: idx_entity_settlements_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlements_entity ON public.payroll_entity_settlements USING btree (entity_id);


--
-- Name: idx_entity_settlements_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlements_period ON public.payroll_entity_settlements USING btree (period_year, period_month);


--
-- Name: idx_entity_settlements_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entity_settlements_status ON public.payroll_entity_settlements USING btree (status);


--
-- Name: idx_entity_settlements_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_entity_settlements_unique ON public.payroll_entity_settlements USING btree (company_id, entity_id, period_year, period_month);


--
-- Name: idx_epp_catalog_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_catalog_category ON public.epp_catalog USING btree (category_id);


--
-- Name: idx_epp_catalog_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_catalog_company ON public.epp_catalog USING btree (company_id);


--
-- Name: idx_epp_deliveries_catalog; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_deliveries_catalog ON public.epp_deliveries USING btree (epp_catalog_id);


--
-- Name: idx_epp_deliveries_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_deliveries_company ON public.epp_deliveries USING btree (company_id);


--
-- Name: idx_epp_deliveries_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_deliveries_employee ON public.epp_deliveries USING btree (employee_id);


--
-- Name: idx_epp_deliveries_expiring; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_deliveries_expiring ON public.epp_deliveries USING btree (calculated_replacement_date) WHERE ((status)::text = 'active'::text);


--
-- Name: idx_epp_deliveries_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_deliveries_status ON public.epp_deliveries USING btree (status, calculated_replacement_date);


--
-- Name: idx_epp_inspections_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_inspections_date ON public.epp_inspections USING btree (inspection_date);


--
-- Name: idx_epp_inspections_delivery; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_inspections_delivery ON public.epp_inspections USING btree (delivery_id);


--
-- Name: idx_epp_role_req_catalog; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_role_req_catalog ON public.epp_role_requirements USING btree (epp_catalog_id);


--
-- Name: idx_epp_role_req_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_role_req_company ON public.epp_role_requirements USING btree (company_id);


--
-- Name: idx_epp_role_req_position; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_epp_role_req_position ON public.epp_role_requirements USING btree (position_id);


--
-- Name: idx_escalations_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_escalations_created ON public.support_ticket_escalations USING btree (created_at DESC);


--
-- Name: idx_escalations_ticket; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_escalations_ticket ON public.support_ticket_escalations USING btree (ticket_id);


--
-- Name: idx_extraordinary_license_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_extraordinary_license_active ON public.extraordinary_licenses USING btree (is_active);


--
-- Name: idx_extraordinary_license_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_extraordinary_license_company ON public.extraordinary_licenses USING btree (company_id);


--
-- Name: idx_extraordinary_license_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_extraordinary_license_type ON public.extraordinary_licenses USING btree (type, is_active);


--
-- Name: idx_facial_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facial_active ON public.facial_biometric_data USING btree (is_active);


--
-- Name: idx_facial_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facial_company_id ON public.facial_biometric_data USING btree (company_id);


--
-- Name: idx_facial_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facial_user_id ON public.facial_biometric_data USING btree (user_id);


--
-- Name: idx_facturas_cae; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_cae ON public.siac_facturas USING btree (cae) WHERE (cae IS NOT NULL);


--
-- Name: idx_facturas_caja; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_caja ON public.siac_facturas USING btree (caja_id);


--
-- Name: idx_facturas_cliente_cuit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_cliente_cuit ON public.siac_facturas USING btree (cliente_cuit) WHERE (cliente_cuit IS NOT NULL);


--
-- Name: idx_facturas_cliente_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_cliente_id ON public.siac_facturas USING btree (cliente_id);


--
-- Name: idx_facturas_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_estado ON public.siac_facturas USING btree (estado);


--
-- Name: idx_facturas_estado_afip; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_estado_afip ON public.siac_facturas USING btree (estado_afip);


--
-- Name: idx_facturas_fecha; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_fecha ON public.siac_facturas USING btree (fecha_factura);


--
-- Name: idx_facturas_impuestos_factura; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_impuestos_factura ON public.siac_facturas_impuestos USING btree (factura_id);


--
-- Name: idx_facturas_impuestos_tipo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_impuestos_tipo ON public.siac_facturas_impuestos USING btree (tipo_impuesto);


--
-- Name: idx_facturas_items_codigo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_items_codigo ON public.siac_facturas_items USING btree (producto_codigo);


--
-- Name: idx_facturas_items_factura; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_items_factura ON public.siac_facturas_items USING btree (factura_id);


--
-- Name: idx_facturas_items_producto_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_items_producto_id ON public.siac_facturas_items USING btree (producto_id);


--
-- Name: idx_facturas_numero_completo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_numero_completo ON public.siac_facturas USING btree (numero_completo);


--
-- Name: idx_facturas_pagos_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_pagos_estado ON public.siac_facturas_pagos USING btree (estado_pago);


--
-- Name: idx_facturas_pagos_factura; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_pagos_factura ON public.siac_facturas_pagos USING btree (factura_id);


--
-- Name: idx_facturas_pagos_forma; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_pagos_forma ON public.siac_facturas_pagos USING btree (forma_pago);


--
-- Name: idx_facturas_punto_venta; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_punto_venta ON public.siac_facturas USING btree (company_id, punto_venta);


--
-- Name: idx_facturas_tipo_afip; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_facturas_tipo_afip ON public.siac_facturas USING btree (tipo_comprobante_afip);


--
-- Name: idx_family_members_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_family_members_company ON public.user_family_members USING btree (company_id);


--
-- Name: idx_family_members_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_family_members_user ON public.user_family_members USING btree (user_id);


--
-- Name: idx_faq_patterns_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faq_patterns_active ON public.notification_faq_patterns USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_faq_patterns_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_faq_patterns_category ON public.notification_faq_patterns USING btree (category);


--
-- Name: idx_fingerprint_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fingerprint_company_id ON public.fingerprint_biometric_data USING btree (company_id);


--
-- Name: idx_fingerprint_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fingerprint_user_id ON public.fingerprint_biometric_data USING btree (user_id);


--
-- Name: idx_fiscal_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiscal_config_active ON public.company_fiscal_config USING btree (is_active);


--
-- Name: idx_fiscal_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiscal_config_company ON public.company_fiscal_config USING btree (company_id);


--
-- Name: idx_fiscal_config_cuit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_fiscal_config_cuit ON public.company_fiscal_config USING btree (cuit);


--
-- Name: idx_habits_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_habits_company ON public.user_healthy_habits USING btree (company_id);


--
-- Name: idx_habits_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_habits_user ON public.user_healthy_habits USING btree (user_id);


--
-- Name: idx_hb_budgets_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_budgets_company ON public.hour_bank_budgets USING btree (company_id);


--
-- Name: idx_hb_budgets_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_budgets_period ON public.hour_bank_budgets USING btree (period_start, period_end);


--
-- Name: idx_hb_budgets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_budgets_status ON public.hour_bank_budgets USING btree (status, alert_level);


--
-- Name: idx_hb_metrics_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_metrics_company ON public.hour_bank_metrics_aggregated USING btree (company_id);


--
-- Name: idx_hb_metrics_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_metrics_level ON public.hour_bank_metrics_aggregated USING btree (aggregation_level);


--
-- Name: idx_hb_metrics_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_metrics_period ON public.hour_bank_metrics_aggregated USING btree (period_type, period_date);


--
-- Name: idx_hb_risk_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_risk_company ON public.hour_bank_risk_analysis USING btree (company_id);


--
-- Name: idx_hb_risk_score; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_risk_score ON public.hour_bank_risk_analysis USING btree (health_score);


--
-- Name: idx_hb_risk_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_risk_user ON public.hour_bank_risk_analysis USING btree (user_id);


--
-- Name: idx_hb_risk_vicious; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hb_risk_vicious ON public.hour_bank_risk_analysis USING btree (vicious_cycle_risk);


--
-- Name: idx_hba_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hba_active ON public.hour_bank_agreements USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_hba_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hba_user ON public.hour_bank_agreements USING btree (user_id);


--
-- Name: idx_hbb_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbb_company ON public.hour_bank_balances USING btree (company_id);


--
-- Name: idx_hbb_expiry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbb_expiry ON public.hour_bank_balances USING btree (next_expiry_date) WHERE (next_expiry_date IS NOT NULL);


--
-- Name: idx_hbb_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbb_user ON public.hour_bank_balances USING btree (user_id);


--
-- Name: idx_hbbd_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbbd_company ON public.hour_bank_blackout_dates USING btree (company_id);


--
-- Name: idx_hbbd_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbbd_dates ON public.hour_bank_blackout_dates USING btree (start_date, end_date);


--
-- Name: idx_hbpd_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbpd_expires ON public.hour_bank_pending_decisions USING btree (expires_at) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_hbpd_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbpd_status ON public.hour_bank_pending_decisions USING btree (status);


--
-- Name: idx_hbpd_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbpd_user ON public.hour_bank_pending_decisions USING btree (user_id);


--
-- Name: idx_hbr_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbr_company ON public.hour_bank_requests USING btree (company_id);


--
-- Name: idx_hbr_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbr_date ON public.hour_bank_requests USING btree (requested_date);


--
-- Name: idx_hbr_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbr_status ON public.hour_bank_requests USING btree (status);


--
-- Name: idx_hbr_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbr_user ON public.hour_bank_requests USING btree (user_id);


--
-- Name: idx_hbt_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbt_branch ON public.hour_bank_templates USING btree (branch_id);


--
-- Name: idx_hbt_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbt_company ON public.hour_bank_templates USING btree (company_id);


--
-- Name: idx_hbt_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbt_country ON public.hour_bank_templates USING btree (country_code);


--
-- Name: idx_hbt_unique_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_hbt_unique_code ON public.hour_bank_templates USING btree (company_id, template_code) WHERE (is_current_version = true);


--
-- Name: idx_hbtx_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_company ON public.hour_bank_transactions USING btree (company_id);


--
-- Name: idx_hbtx_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_created ON public.hour_bank_transactions USING btree (created_at DESC);


--
-- Name: idx_hbtx_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_expires ON public.hour_bank_transactions USING btree (expires_at) WHERE (is_expired = false);


--
-- Name: idx_hbtx_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_status ON public.hour_bank_transactions USING btree (status);


--
-- Name: idx_hbtx_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_type ON public.hour_bank_transactions USING btree (transaction_type);


--
-- Name: idx_hbtx_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hbtx_user ON public.hour_bank_transactions USING btree (user_id);


--
-- Name: idx_holidays_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_holidays_country ON public.holidays USING btree (country);


--
-- Name: idx_holidays_country_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_holidays_country_date ON public.holidays USING btree (country, date);


--
-- Name: idx_holidays_country_state_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_holidays_country_state_date ON public.holidays USING btree (country, state_province, date);


--
-- Name: idx_holidays_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_holidays_date ON public.holidays USING btree (date);


--
-- Name: idx_holidays_year; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_holidays_year ON public.holidays USING btree (year);


--
-- Name: idx_household_relationship; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_household_relationship ON public.user_household_members USING btree (relationship);


--
-- Name: idx_household_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_household_user_id ON public.user_household_members USING btree (user_id);


--
-- Name: idx_hse_cases_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hse_cases_company ON public.hse_cases USING btree (company_id);


--
-- Name: idx_hse_cases_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hse_cases_created ON public.hse_cases USING btree (created_at);


--
-- Name: idx_hse_cases_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hse_cases_status ON public.hse_cases USING btree (investigation_status);


--
-- Name: idx_hse_cases_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hse_cases_type ON public.hse_cases USING btree (case_type);


--
-- Name: idx_hse_cases_violations; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_hse_cases_violations ON public.hse_cases USING gin (indicated_violations);


--
-- Name: idx_inbound_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_created_at ON public.email_inbound_log USING btree (created_at DESC);


--
-- Name: idx_inbound_from_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_from_email ON public.email_inbound_log USING btree (from_email);


--
-- Name: idx_inbound_in_reply_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_in_reply_to ON public.email_inbound_log USING btree (in_reply_to);


--
-- Name: idx_inbound_linked_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_linked_notification ON public.email_inbound_log USING btree (linked_notification_id);


--
-- Name: idx_inbound_linked_thread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_linked_thread ON public.email_inbound_log USING btree (linked_thread_id);


--
-- Name: idx_inbound_message_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_message_id ON public.email_inbound_log USING btree (message_id);


--
-- Name: idx_inbound_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_status ON public.email_inbound_log USING btree (processing_status);


--
-- Name: idx_inbound_to_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_inbound_to_email ON public.email_inbound_log USING btree (to_email);


--
-- Name: idx_job_app_notes_application; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_app_notes_application ON public.job_application_notes USING btree (application_id);


--
-- Name: idx_job_applications_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_company ON public.job_applications USING btree (company_id);


--
-- Name: idx_job_applications_dni; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_dni ON public.job_applications USING btree (candidate_dni);


--
-- Name: idx_job_applications_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_email ON public.job_applications USING btree (candidate_email);


--
-- Name: idx_job_applications_hired; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_hired ON public.job_applications USING btree (employee_user_id) WHERE (employee_user_id IS NOT NULL);


--
-- Name: idx_job_applications_pending_medical; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_pending_medical ON public.job_applications USING btree (company_id, status) WHERE ((status)::text = ANY ((ARRAY['aprobado_administrativo'::character varying, 'examen_pendiente'::character varying])::text[]));


--
-- Name: idx_job_applications_posting; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_posting ON public.job_applications USING btree (job_posting_id);


--
-- Name: idx_job_applications_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_applications_status ON public.job_applications USING btree (status);


--
-- Name: idx_job_postings_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_postings_active ON public.job_postings USING btree (company_id, status) WHERE ((status)::text = 'active'::text);


--
-- Name: idx_job_postings_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_postings_company ON public.job_postings USING btree (company_id);


--
-- Name: idx_job_postings_department; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_postings_department ON public.job_postings USING btree (department_id);


--
-- Name: idx_job_postings_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_job_postings_status ON public.job_postings USING btree (status);


--
-- Name: idx_kb_question_trgm; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_kb_question_trgm ON public.assistant_knowledge_base USING gin (question public.gin_trgm_ops);


--
-- Name: idx_kiosks_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_kiosks_company_id ON public.kiosks USING btree (company_id);


--
-- Name: idx_kiosks_gps; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_kiosks_gps ON public.kiosks USING btree (gps_lat, gps_lng) WHERE (gps_lat IS NOT NULL);


--
-- Name: idx_kiosks_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_kiosks_is_active ON public.kiosks USING btree (is_active);


--
-- Name: idx_kiosks_is_configured; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_kiosks_is_configured ON public.kiosks USING btree (is_configured);


--
-- Name: idx_kiosks_unique_gps_per_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_kiosks_unique_gps_per_company ON public.kiosks USING btree (gps_lat, gps_lng, company_id) WHERE ((gps_lat IS NOT NULL) AND (gps_lng IS NOT NULL) AND (deleted_at IS NULL));


--
-- Name: idx_knowledge_base_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_company_id ON public.assistant_knowledge_base USING btree (company_id);


--
-- Name: idx_knowledge_base_company_module_helpful; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_company_module_helpful ON public.assistant_knowledge_base USING btree (company_id, module_name, helpful);


--
-- Name: idx_knowledge_base_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_created_at ON public.assistant_knowledge_base USING btree (created_at DESC);


--
-- Name: idx_knowledge_base_helpful; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_helpful ON public.assistant_knowledge_base USING btree (helpful) WHERE (helpful = true);


--
-- Name: idx_knowledge_base_module_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_module_name ON public.assistant_knowledge_base USING btree (module_name);


--
-- Name: idx_knowledge_base_question_normalized; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_question_normalized ON public.assistant_knowledge_base USING gin (to_tsvector('spanish'::regconfig, question_normalized));


--
-- Name: idx_knowledge_base_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_knowledge_base_verified ON public.assistant_knowledge_base USING btree (verified_at) WHERE (verified_at IS NOT NULL);


--
-- Name: idx_labor_agreements_v2_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_labor_agreements_v2_company ON public.labor_agreements_v2 USING btree (company_id);


--
-- Name: idx_labor_agreements_v2_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_labor_agreements_v2_country ON public.labor_agreements_v2 USING btree (country_id);


--
-- Name: idx_late_arrival_auth_authorizer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_late_arrival_auth_authorizer ON public.late_arrival_authorizations USING btree (requested_authorizer_id);


--
-- Name: idx_late_arrival_auth_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_late_arrival_auth_company ON public.late_arrival_authorizations USING btree (company_id);


--
-- Name: idx_late_arrival_auth_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_late_arrival_auth_date ON public.late_arrival_authorizations USING btree (request_date);


--
-- Name: idx_late_arrival_auth_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_late_arrival_auth_employee ON public.late_arrival_authorizations USING btree (employee_id);


--
-- Name: idx_late_arrival_auth_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_late_arrival_auth_status ON public.late_arrival_authorizations USING btree (status);


--
-- Name: idx_learned_responses_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learned_responses_category ON public.notification_learned_responses USING btree (category, subcategory);


--
-- Name: idx_learned_responses_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learned_responses_company ON public.notification_learned_responses USING btree (company_id);


--
-- Name: idx_learned_responses_confidence; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learned_responses_confidence ON public.notification_learned_responses USING btree (confidence_score DESC) WHERE (is_active = true);


--
-- Name: idx_learned_responses_keywords; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learned_responses_keywords ON public.notification_learned_responses USING gin (question_keywords);


--
-- Name: idx_learned_responses_temporal; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learned_responses_temporal ON public.notification_learned_responses USING btree (valid_until) WHERE (is_temporal = true);


--
-- Name: idx_learning_patterns_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_learning_patterns_module ON public.learning_patterns USING btree (module_key);


--
-- Name: idx_legal_ai_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_ai_case ON public.legal_ai_analysis USING btree (case_id);


--
-- Name: idx_legal_ai_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_ai_company ON public.legal_ai_analysis USING btree (company_id);


--
-- Name: idx_legal_ai_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_ai_type ON public.legal_ai_analysis USING btree (analysis_type);


--
-- Name: idx_legal_auth_authorized_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_authorized_by ON public.legal_edit_authorizations USING btree (authorized_by);


--
-- Name: idx_legal_auth_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_company ON public.legal_edit_authorizations USING btree (company_id);


--
-- Name: idx_legal_auth_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_notification ON public.legal_edit_authorizations USING btree (notification_id);


--
-- Name: idx_legal_auth_pending_step; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_pending_step ON public.legal_edit_authorizations USING btree (status, current_step) WHERE ((status)::text = ANY ((ARRAY['pending'::character varying, 'escalated'::character varying])::text[]));


--
-- Name: idx_legal_auth_record; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_record ON public.legal_edit_authorizations USING btree (record_id, record_table);


--
-- Name: idx_legal_auth_requested_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_requested_by ON public.legal_edit_authorizations USING btree (requested_by);


--
-- Name: idx_legal_auth_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_auth_status ON public.legal_edit_authorizations USING btree (status);


--
-- Name: idx_legal_cases_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_active ON public.legal_cases USING btree (is_active);


--
-- Name: idx_legal_cases_assigned; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_assigned ON public.legal_cases USING btree (assigned_to);


--
-- Name: idx_legal_cases_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_company ON public.legal_cases USING btree (company_id);


--
-- Name: idx_legal_cases_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_dates ON public.legal_cases USING btree (filing_date, notification_date);


--
-- Name: idx_legal_cases_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_employee ON public.legal_cases USING btree (employee_id);


--
-- Name: idx_legal_cases_stage; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_stage ON public.legal_cases USING btree (current_stage);


--
-- Name: idx_legal_cases_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_cases_type ON public.legal_cases USING btree (case_type);


--
-- Name: idx_legal_comm_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_company ON public.legal_communications USING btree (company_id);


--
-- Name: idx_legal_comm_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_created ON public.legal_communications USING btree (created_at);


--
-- Name: idx_legal_comm_deadline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_deadline ON public.legal_communications USING btree (response_deadline);


--
-- Name: idx_legal_comm_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_employee ON public.legal_communications USING btree (employee_id);


--
-- Name: idx_legal_comm_reference; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_reference ON public.legal_communications USING btree (reference_number);


--
-- Name: idx_legal_comm_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_status ON public.legal_communications USING btree (status);


--
-- Name: idx_legal_comm_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_type ON public.legal_communications USING btree (type_id);


--
-- Name: idx_legal_comm_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_types_active ON public.legal_communication_types USING btree (is_active);


--
-- Name: idx_legal_comm_types_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_types_category ON public.legal_communication_types USING btree (category);


--
-- Name: idx_legal_comm_types_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_comm_types_severity ON public.legal_communication_types USING btree (severity);


--
-- Name: idx_legal_deadlines_assigned; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_assigned ON public.legal_deadlines USING btree (assigned_to);


--
-- Name: idx_legal_deadlines_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_case ON public.legal_deadlines USING btree (case_id);


--
-- Name: idx_legal_deadlines_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_company ON public.legal_deadlines USING btree (company_id);


--
-- Name: idx_legal_deadlines_due; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_due ON public.legal_deadlines USING btree (due_date);


--
-- Name: idx_legal_deadlines_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_pending ON public.legal_deadlines USING btree (status, due_date) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_legal_deadlines_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_deadlines_status ON public.legal_deadlines USING btree (status);


--
-- Name: idx_legal_doc_alerts_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_doc_alerts_company ON public.legal_document_alerts USING btree (company_id);


--
-- Name: idx_legal_doc_alerts_due; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_doc_alerts_due ON public.legal_document_alerts USING btree (due_date);


--
-- Name: idx_legal_doc_alerts_unresolved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_doc_alerts_unresolved ON public.legal_document_alerts USING btree (is_resolved) WHERE (is_resolved = false);


--
-- Name: idx_legal_docs_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_docs_case ON public.legal_case_documents USING btree (case_id);


--
-- Name: idx_legal_docs_company_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_docs_company_active ON public.consent_legal_documents USING btree (company_id, is_active);


--
-- Name: idx_legal_docs_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_docs_date ON public.legal_case_documents USING btree (document_date);


--
-- Name: idx_legal_docs_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_docs_type ON public.legal_case_documents USING btree (document_type);


--
-- Name: idx_legal_docs_version; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_docs_version ON public.consent_legal_documents USING btree (version);


--
-- Name: idx_legal_issues_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_issues_company ON public.user_legal_issues USING btree (company_id);


--
-- Name: idx_legal_issues_employment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_issues_employment ON public.user_legal_issues USING btree (affects_employment);


--
-- Name: idx_legal_issues_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_issues_status ON public.user_legal_issues USING btree (status);


--
-- Name: idx_legal_issues_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_issues_type ON public.user_legal_issues USING btree (issue_type);


--
-- Name: idx_legal_issues_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_issues_user ON public.user_legal_issues USING btree (user_id);


--
-- Name: idx_legal_parties_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_parties_case ON public.legal_case_parties USING btree (case_id);


--
-- Name: idx_legal_parties_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_parties_type ON public.legal_case_parties USING btree (party_type);


--
-- Name: idx_legal_stages_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_stages_case ON public.legal_case_stages USING btree (case_id);


--
-- Name: idx_legal_stages_stage; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_stages_stage ON public.legal_case_stages USING btree (stage);


--
-- Name: idx_legal_timeline_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_timeline_case ON public.legal_case_timeline_events USING btree (case_id);


--
-- Name: idx_legal_timeline_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_timeline_date ON public.legal_case_timeline_events USING btree (event_date);


--
-- Name: idx_legal_timeline_milestone; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_timeline_milestone ON public.legal_case_timeline_events USING btree (is_milestone) WHERE (is_milestone = true);


--
-- Name: idx_legal_timeline_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_legal_timeline_type ON public.legal_case_timeline_events USING btree (event_type);


--
-- Name: idx_loans_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_loans_status ON public.hour_bank_loans USING btree (status) WHERE ((status)::text = 'active'::text);


--
-- Name: idx_loans_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_loans_user ON public.hour_bank_loans USING btree (company_id, user_id);


--
-- Name: idx_mapping_group; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mapping_group ON public.email_thread_mapping USING btree (group_id);


--
-- Name: idx_mapping_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mapping_notification ON public.email_thread_mapping USING btree (notification_id);


--
-- Name: idx_mapping_outbound_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mapping_outbound_id ON public.email_thread_mapping USING btree (outbound_message_id);


--
-- Name: idx_mapping_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mapping_recipient ON public.email_thread_mapping USING btree (recipient_email);


--
-- Name: idx_mapping_thread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_mapping_thread ON public.email_thread_mapping USING btree (thread_id);


--
-- Name: idx_marital_status_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_marital_status_user ON public.user_marital_status USING btree (user_id);


--
-- Name: idx_medical_audit_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_action ON public.medical_record_audit_log USING btree (action);


--
-- Name: idx_medical_audit_action_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_action_at ON public.medical_record_audit_log USING btree (action_at);


--
-- Name: idx_medical_audit_action_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_action_by ON public.medical_record_audit_log USING btree (action_by);


--
-- Name: idx_medical_audit_authorization; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_authorization ON public.medical_record_audit_log USING btree (authorization_id);


--
-- Name: idx_medical_audit_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_company ON public.medical_record_audit_log USING btree (company_id);


--
-- Name: idx_medical_audit_record; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_record ON public.medical_record_audit_log USING btree (record_id);


--
-- Name: idx_medical_audit_timeline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_audit_timeline ON public.medical_record_audit_log USING btree (record_id, action_at DESC);


--
-- Name: idx_medical_auth_authorized_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_authorized_by ON public.medical_edit_authorizations USING btree (authorized_by);


--
-- Name: idx_medical_auth_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_company ON public.medical_edit_authorizations USING btree (company_id);


--
-- Name: idx_medical_auth_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_notification ON public.medical_edit_authorizations USING btree (notification_id);


--
-- Name: idx_medical_auth_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_pending ON public.medical_edit_authorizations USING btree (company_id, status) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_medical_auth_record; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_record ON public.medical_edit_authorizations USING btree (record_id);


--
-- Name: idx_medical_auth_requested_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_requested_by ON public.medical_edit_authorizations USING btree (requested_by);


--
-- Name: idx_medical_auth_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_auth_status ON public.medical_edit_authorizations USING btree (status);


--
-- Name: idx_medical_certificates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_certificates_company ON public.medical_certificates USING btree (company_id);


--
-- Name: idx_medical_certificates_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_certificates_dates ON public.medical_certificates USING btree (start_date, end_date);


--
-- Name: idx_medical_certificates_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_certificates_status ON public.medical_certificates USING btree (status);


--
-- Name: idx_medical_certificates_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_certificates_user ON public.medical_certificates USING btree (user_id);


--
-- Name: idx_medical_comm_case; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_comm_case ON public.medical_communications USING btree (absence_case_id);


--
-- Name: idx_medical_comm_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_comm_company ON public.medical_communications USING btree (company_id);


--
-- Name: idx_medical_comm_receiver; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_comm_receiver ON public.medical_communications USING btree (receiver_type, receiver_id);


--
-- Name: idx_medical_comm_sender; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_comm_sender ON public.medical_communications USING btree (sender_type, sender_id);


--
-- Name: idx_medical_comm_unread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_comm_unread ON public.medical_communications USING btree (is_read) WHERE (is_read = false);


--
-- Name: idx_medical_documents_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_documents_company ON public.user_medical_documents USING btree (company_id);


--
-- Name: idx_medical_documents_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_documents_user ON public.user_medical_documents USING btree (user_id);


--
-- Name: idx_medical_exams_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_exams_company ON public.user_medical_exams USING btree (company_id);


--
-- Name: idx_medical_exams_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_exams_user ON public.user_medical_exams USING btree (user_id);


--
-- Name: idx_medical_leaves_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_leaves_company ON public.medical_leaves USING btree (company_id);


--
-- Name: idx_medical_leaves_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_leaves_dates ON public.medical_leaves USING btree (start_date, end_date);


--
-- Name: idx_medical_leaves_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_leaves_status ON public.medical_leaves USING btree (status);


--
-- Name: idx_medical_leaves_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_leaves_user ON public.medical_leaves USING btree (user_id);


--
-- Name: idx_medical_records_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_active ON public.medical_records USING btree (company_id, employee_id) WHERE (is_deleted = false);


--
-- Name: idx_medical_records_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_company ON public.medical_records USING btree (company_id);


--
-- Name: idx_medical_records_deleted; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_deleted ON public.medical_records USING btree (is_deleted);


--
-- Name: idx_medical_records_editable; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_editable ON public.medical_records USING btree (editable_until);


--
-- Name: idx_medical_records_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_employee ON public.medical_records USING btree (employee_id);


--
-- Name: idx_medical_records_exam_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_exam_date ON public.medical_records USING btree (exam_date);


--
-- Name: idx_medical_records_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_expiration ON public.medical_records USING btree (expiration_date);


--
-- Name: idx_medical_records_locked; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_locked ON public.medical_records USING btree (is_locked);


--
-- Name: idx_medical_records_result; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_result ON public.medical_records USING btree (result);


--
-- Name: idx_medical_records_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_records_type ON public.medical_records USING btree (record_type);


--
-- Name: idx_medical_templates_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_templates_active ON public.medical_exam_templates USING btree (is_active);


--
-- Name: idx_medical_templates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_templates_company ON public.medical_exam_templates USING btree (company_id);


--
-- Name: idx_medical_templates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medical_templates_type ON public.medical_exam_templates USING btree (exam_type);


--
-- Name: idx_medications_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medications_company ON public.user_medications USING btree (company_id);


--
-- Name: idx_medications_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_medications_user ON public.user_medications USING btree (user_id);


--
-- Name: idx_modules_registry_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_modules_registry_active ON public.system_modules_registry USING btree (is_active);


--
-- Name: idx_modules_registry_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_modules_registry_category ON public.system_modules_registry USING btree (module_category);


--
-- Name: idx_modules_registry_dependencies; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_modules_registry_dependencies ON public.system_modules_registry USING gin (dependencies);


--
-- Name: idx_modules_registry_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_modules_registry_key ON public.system_modules_registry USING btree (module_key);


--
-- Name: idx_modules_registry_provides_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_modules_registry_provides_to ON public.system_modules_registry USING gin (provides_to);


--
-- Name: idx_notif_msg_deadline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_deadline ON public.notification_messages USING btree (deadline_at) WHERE (deadline_at IS NOT NULL);


--
-- Name: idx_notif_msg_escalation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_escalation ON public.notification_messages USING btree (escalation_status) WHERE ((escalation_status)::text <> 'none'::text);


--
-- Name: idx_notif_msg_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_recipient ON public.notification_messages USING btree (recipient_id);


--
-- Name: idx_notif_msg_requires_response; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_requires_response ON public.notification_messages USING btree (requires_response) WHERE (requires_response = true);


--
-- Name: idx_notif_msg_sender; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_sender ON public.notification_messages USING btree (sender_id);


--
-- Name: idx_notif_msg_sla_breach; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_msg_sla_breach ON public.notification_messages USING btree (sla_breach) WHERE (sla_breach = true);


--
-- Name: idx_notif_threads_commercial; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notif_threads_commercial ON public.notification_threads USING btree (commercial_flow, company_id) WHERE (commercial_flow IS NOT NULL);


--
-- Name: idx_notification_actions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_actions_company ON public.notification_actions_log USING btree (company_id, action_at DESC);


--
-- Name: idx_notification_actions_notification; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_actions_notification ON public.notification_actions_log USING btree (notification_id, action_at DESC);


--
-- Name: idx_notification_actions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_actions_type ON public.notification_actions_log USING btree (action, action_at);


--
-- Name: idx_notification_actions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_actions_user ON public.notification_actions_log USING btree (action_by, action_at DESC);


--
-- Name: idx_notification_templates_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_templates_module ON public.notification_templates USING btree (module, is_active);


--
-- Name: idx_notifications_action_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_action_status ON public.notifications USING btree (action_status, requires_action) WHERE (requires_action = true);


--
-- Name: idx_notifications_company_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_company_module ON public.notifications USING btree (company_id, module, created_at DESC) WHERE (deleted_at IS NULL);


--
-- Name: idx_notifications_escalation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_escalation ON public.notifications USING btree (escalation_level, escalated_from_notification_id) WHERE (escalation_level > 0);


--
-- Name: idx_notifications_metadata_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_metadata_gin ON public.notifications USING gin (metadata);


--
-- Name: idx_notifications_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_priority ON public.notifications USING btree (priority, action_deadline);


--
-- Name: idx_notifications_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_recipient ON public.notifications USING btree (recipient_user_id, is_read, deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_notifications_related_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_related_entity ON public.notifications USING btree (related_entity_type, related_entity_id);


--
-- Name: idx_numeracion_caja; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_numeracion_caja ON public.siac_numeracion_comprobantes USING btree (caja_id);


--
-- Name: idx_numeracion_tipo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_numeracion_tipo ON public.siac_numeracion_comprobantes USING btree (tipo_comprobante_id);


--
-- Name: idx_oh_claim_docs_claim; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_docs_claim ON public.oh_claim_documents USING btree (claim_id);


--
-- Name: idx_oh_claim_docs_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_docs_type ON public.oh_claim_documents USING btree (document_type);


--
-- Name: idx_oh_claim_history_claim; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_history_claim ON public.oh_claim_status_history USING btree (claim_id);


--
-- Name: idx_oh_claim_history_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_history_date ON public.oh_claim_status_history USING btree (changed_at);


--
-- Name: idx_oh_claim_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_types_active ON public.oh_claim_types USING btree (is_active);


--
-- Name: idx_oh_claim_types_region; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_claim_types_region ON public.oh_claim_types USING btree (region);


--
-- Name: idx_oh_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_config_active ON public.oh_screening_config USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_oh_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_config_company ON public.oh_screening_config USING btree (company_id);


--
-- Name: idx_oh_config_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_config_country ON public.oh_screening_config USING btree (country_code);


--
-- Name: idx_oh_docs_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_docs_company ON public.oh_screening_documents USING btree (company_id);


--
-- Name: idx_oh_docs_screening; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_docs_screening ON public.oh_screening_documents USING btree (screening_id);


--
-- Name: idx_oh_docs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_docs_status ON public.oh_screening_documents USING btree (status);


--
-- Name: idx_oh_docs_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_docs_type ON public.oh_screening_documents USING btree (document_type);


--
-- Name: idx_oh_results_attention; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_results_attention ON public.oh_screening_results USING btree (requires_attention) WHERE (requires_attention = true);


--
-- Name: idx_oh_results_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_results_category ON public.oh_screening_results USING btree (test_category);


--
-- Name: idx_oh_results_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_results_company ON public.oh_screening_results USING btree (company_id);


--
-- Name: idx_oh_results_screening; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_results_screening ON public.oh_screening_results USING btree (screening_id);


--
-- Name: idx_oh_results_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_results_status ON public.oh_screening_results USING btree (result_status);


--
-- Name: idx_oh_screening_types_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screening_types_active ON public.oh_screening_types USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_oh_screening_types_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screening_types_code ON public.oh_screening_types USING btree (code);


--
-- Name: idx_oh_screening_types_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screening_types_country ON public.oh_screening_types USING gin (country_codes);


--
-- Name: idx_oh_screening_types_region; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screening_types_region ON public.oh_screening_types USING btree (region);


--
-- Name: idx_oh_screenings_approved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_approved ON public.oh_pre_employment_screenings USING btree (approved_for_hiring);


--
-- Name: idx_oh_screenings_candidate_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_candidate_email ON public.oh_pre_employment_screenings USING btree (candidate_email);


--
-- Name: idx_oh_screenings_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_company ON public.oh_pre_employment_screenings USING btree (company_id);


--
-- Name: idx_oh_screenings_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_country ON public.oh_pre_employment_screenings USING btree (country_code);


--
-- Name: idx_oh_screenings_overall_result; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_overall_result ON public.oh_pre_employment_screenings USING btree (overall_result);


--
-- Name: idx_oh_screenings_scheduled_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_scheduled_date ON public.oh_pre_employment_screenings USING btree (scheduled_date);


--
-- Name: idx_oh_screenings_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_status ON public.oh_pre_employment_screenings USING btree (status);


--
-- Name: idx_oh_screenings_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_type ON public.oh_pre_employment_screenings USING btree (screening_type_id);


--
-- Name: idx_oh_screenings_valid_until; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_screenings_valid_until ON public.oh_pre_employment_screenings USING btree (valid_until);


--
-- Name: idx_oh_wc_claims_claim_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_claim_type ON public.oh_workers_compensation_claims USING btree (claim_type_id);


--
-- Name: idx_oh_wc_claims_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_company ON public.oh_workers_compensation_claims USING btree (company_id);


--
-- Name: idx_oh_wc_claims_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_country ON public.oh_workers_compensation_claims USING btree (country_code);


--
-- Name: idx_oh_wc_claims_deleted; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_deleted ON public.oh_workers_compensation_claims USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_oh_wc_claims_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_employee ON public.oh_workers_compensation_claims USING btree (employee_id);


--
-- Name: idx_oh_wc_claims_incident_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_incident_date ON public.oh_workers_compensation_claims USING btree (incident_date);


--
-- Name: idx_oh_wc_claims_number; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_number ON public.oh_workers_compensation_claims USING btree (claim_number);


--
-- Name: idx_oh_wc_claims_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_oh_wc_claims_status ON public.oh_workers_compensation_claims USING btree (status);


--
-- Name: idx_org_positions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_active ON public.organizational_positions USING btree (company_id, is_active);


--
-- Name: idx_org_positions_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_branch ON public.organizational_positions USING btree (company_id, branch_code);


--
-- Name: idx_org_positions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_company ON public.organizational_positions USING btree (company_id);


--
-- Name: idx_org_positions_hierarchy_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_hierarchy_level ON public.organizational_positions USING btree (company_id, hierarchy_level);


--
-- Name: idx_org_positions_parent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_parent ON public.organizational_positions USING btree (parent_position_id);


--
-- Name: idx_org_positions_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_positions_template ON public.organizational_positions USING btree (payslip_template_id);


--
-- Name: idx_partner_commissions_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partner_commissions_active ON public.partner_commissions USING btree (partner_id, is_active) WHERE (is_active = true);


--
-- Name: idx_partner_commissions_partner_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partner_commissions_partner_id ON public.partner_commissions USING btree (partner_id);


--
-- Name: idx_partners_account_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_account_status ON public.partners USING btree (account_status) WHERE (account_status = 'pending_verification'::public.partner_account_status);


--
-- Name: idx_partners_approval_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_approval_status ON public.partners USING btree (approval_status) WHERE (is_active = true);


--
-- Name: idx_partners_dni; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_dni ON public.partners USING btree (dni);


--
-- Name: idx_partners_dni_auth; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_dni_auth ON public.partners USING btree (dni);


--
-- Name: idx_partners_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_email ON public.partners USING btree (email);


--
-- Name: idx_partners_email_auth; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_email_auth ON public.partners USING btree (email) WHERE ((approval_status)::text = 'approved'::text);


--
-- Name: idx_partners_email_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_email_verified ON public.partners USING btree (email_verified);


--
-- Name: idx_partners_pending_consents; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_pending_consents ON public.partners USING gin (pending_consents);


--
-- Name: idx_partners_username; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_partners_username ON public.partners USING btree (username) WHERE (((approval_status)::text = 'approved'::text) AND (is_active = true));


--
-- Name: idx_password_auth_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_password_auth_company ON public.password_auth_attempts USING btree (company_id);


--
-- Name: idx_password_auth_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_password_auth_employee ON public.password_auth_attempts USING btree (employee_id);


--
-- Name: idx_password_auth_requires_review; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_password_auth_requires_review ON public.password_auth_attempts USING btree (requires_hr_review);


--
-- Name: idx_password_auth_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_password_auth_timestamp ON public.password_auth_attempts USING btree ("timestamp");


--
-- Name: idx_patterns_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_patterns_category ON public.attendance_patterns USING btree (pattern_category, detection_date DESC);


--
-- Name: idx_patterns_company_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_patterns_company_active ON public.attendance_patterns USING btree (company_id, status) WHERE ((status)::text = 'active'::text);


--
-- Name: idx_patterns_pattern_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_patterns_pattern_id ON public.attendance_patterns USING btree (pattern_id, company_id);


--
-- Name: idx_patterns_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_patterns_severity ON public.attendance_patterns USING btree (company_id, severity) WHERE (requires_action = true);


--
-- Name: idx_patterns_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_patterns_user ON public.attendance_patterns USING btree (user_id, detection_date DESC);


--
-- Name: idx_payroll_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_company ON public.user_payroll_records USING btree (company_id);


--
-- Name: idx_payroll_countries_gdpr; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_countries_gdpr ON public.payroll_countries USING btree (is_gdpr_equivalent);


--
-- Name: idx_payroll_countries_privacy_law; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_countries_privacy_law ON public.payroll_countries USING btree (privacy_law_name);


--
-- Name: idx_payroll_entities_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_entities_category ON public.payroll_entities USING btree (category_id);


--
-- Name: idx_payroll_entities_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_payroll_entities_code ON public.payroll_entities USING btree (company_id, entity_code) WHERE (company_id IS NOT NULL);


--
-- Name: idx_payroll_entities_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_entities_company ON public.payroll_entities USING btree (company_id);


--
-- Name: idx_payroll_entities_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_entities_country ON public.payroll_entities USING btree (country_id);


--
-- Name: idx_payroll_entities_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_entities_type ON public.payroll_entities USING btree (entity_type);


--
-- Name: idx_payroll_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_period ON public.user_payroll_records USING btree (period_year, period_month);


--
-- Name: idx_payroll_run_details_run; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_run_details_run ON public.payroll_run_details USING btree (run_id);


--
-- Name: idx_payroll_run_details_snapshot_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_run_details_snapshot_gin ON public.payroll_run_details USING gin (employee_snapshot);


--
-- Name: idx_payroll_run_details_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_run_details_user ON public.payroll_run_details USING btree (user_id);


--
-- Name: idx_payroll_runs_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_runs_company ON public.payroll_runs USING btree (company_id);


--
-- Name: idx_payroll_runs_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_runs_period ON public.payroll_runs USING btree (period_year, period_month);


--
-- Name: idx_payroll_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_status ON public.user_payroll_records USING btree (status);


--
-- Name: idx_payroll_templates_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_templates_branch ON public.payroll_templates USING btree (branch_id);


--
-- Name: idx_payroll_templates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_templates_company ON public.payroll_templates USING btree (company_id);


--
-- Name: idx_payroll_templates_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_templates_country ON public.payroll_templates USING btree (country_id);


--
-- Name: idx_payroll_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payroll_user ON public.user_payroll_records USING btree (user_id);


--
-- Name: idx_payslip_templates_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payslip_templates_active ON public.payroll_payslip_templates USING btree (is_active);


--
-- Name: idx_payslip_templates_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payslip_templates_company ON public.payroll_payslip_templates USING btree (company_id);


--
-- Name: idx_payslip_templates_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payslip_templates_country ON public.payroll_payslip_templates USING btree (country_id);


--
-- Name: idx_pcs_partner_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pcs_partner_period ON public.partner_commission_summaries USING btree (partner_id, year, month);


--
-- Name: idx_pcs_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pcs_status ON public.partner_commission_summaries USING btree (status);


--
-- Name: idx_pct_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pct_company ON public.partner_commission_transactions USING btree (company_id);


--
-- Name: idx_pct_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pct_date ON public.partner_commission_transactions USING btree (transaction_date);


--
-- Name: idx_pct_partner_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pct_partner_id ON public.partner_commission_transactions USING btree (partner_id);


--
-- Name: idx_pct_reference; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pct_reference ON public.partner_commission_transactions USING btree (reference_type, reference_id);


--
-- Name: idx_pct_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pct_status ON public.partner_commission_transactions USING btree (status);


--
-- Name: idx_permission_requests_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_permission_requests_company ON public.user_permission_requests USING btree (company_id);


--
-- Name: idx_permission_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_permission_requests_status ON public.user_permission_requests USING btree (status);


--
-- Name: idx_permission_requests_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_permission_requests_user ON public.user_permission_requests USING btree (user_id);


--
-- Name: idx_ppe_detections_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ppe_detections_company ON public.hse_ppe_detections USING btree (company_id);


--
-- Name: idx_ppe_detections_missing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ppe_detections_missing ON public.hse_ppe_detections USING gin (missing_ppe);


--
-- Name: idx_ppe_detections_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ppe_detections_status ON public.hse_ppe_detections USING btree (status);


--
-- Name: idx_ppe_detections_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ppe_detections_timestamp ON public.hse_ppe_detections USING btree (detection_timestamp);


--
-- Name: idx_ppe_stats_company_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ppe_stats_company_date ON public.hse_ppe_stats USING btree (company_id, stat_date);


--
-- Name: idx_pre_invoice_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pre_invoice_code ON public.aponnt_pre_invoices USING btree (pre_invoice_code);


--
-- Name: idx_pre_invoice_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pre_invoice_company ON public.aponnt_pre_invoices USING btree (company_id);


--
-- Name: idx_pre_invoice_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pre_invoice_contract ON public.aponnt_pre_invoices USING btree (contract_id);


--
-- Name: idx_pre_invoice_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_pre_invoice_status ON public.aponnt_pre_invoices USING btree (status);


--
-- Name: idx_primary_physician_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_primary_physician_user ON public.user_primary_physician USING btree (user_id);


--
-- Name: idx_procedure_acks_procedure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_acks_procedure ON public.procedure_acknowledgements USING btree (procedure_id);


--
-- Name: idx_procedure_acks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_acks_status ON public.procedure_acknowledgements USING btree (status);


--
-- Name: idx_procedure_acks_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_acks_user ON public.procedure_acknowledgements USING btree (user_id);


--
-- Name: idx_procedure_draft_locks_procedure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_draft_locks_procedure ON public.procedure_draft_locks USING btree (procedure_id);


--
-- Name: idx_procedure_draft_locks_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_draft_locks_user ON public.procedure_draft_locks USING btree (locked_by);


--
-- Name: idx_procedure_roles_position; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_roles_position ON public.procedure_roles USING btree (organizational_position_id);


--
-- Name: idx_procedure_roles_procedure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_roles_procedure ON public.procedure_roles USING btree (procedure_id);


--
-- Name: idx_procedure_versions_procedure; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_versions_procedure ON public.procedure_versions USING btree (procedure_id);


--
-- Name: idx_procedure_versions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedure_versions_status ON public.procedure_versions USING btree (status);


--
-- Name: idx_procedures_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_branch ON public.procedures USING btree (branch_id);


--
-- Name: idx_procedures_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_code ON public.procedures USING btree (code);


--
-- Name: idx_procedures_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_company ON public.procedures USING btree (company_id);


--
-- Name: idx_procedures_company_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_company_level ON public.procedures USING btree (company_id, hierarchy_level);


--
-- Name: idx_procedures_department; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_department ON public.procedures USING btree (department_id);


--
-- Name: idx_procedures_draft_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_draft_expires ON public.procedures USING btree (draft_expires_at) WHERE (draft_expires_at IS NOT NULL);


--
-- Name: idx_procedures_draft_locked_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_draft_locked_by ON public.procedures USING btree (draft_locked_by) WHERE (draft_locked_by IS NOT NULL);


--
-- Name: idx_procedures_hierarchy_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_hierarchy_level ON public.procedures USING btree (hierarchy_level);


--
-- Name: idx_procedures_hierarchy_path; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_hierarchy_path ON public.procedures USING btree (hierarchy_path);


--
-- Name: idx_procedures_owners; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_owners ON public.procedures USING gin (owners);


--
-- Name: idx_procedures_parent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_parent ON public.procedures USING btree (parent_id);


--
-- Name: idx_procedures_parent_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_parent_status ON public.procedures USING btree (parent_id, status);


--
-- Name: idx_procedures_scope_entities; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_scope_entities ON public.procedures USING gin (scope_entities);


--
-- Name: idx_procedures_scope_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_scope_type ON public.procedures USING btree (scope_type);


--
-- Name: idx_procedures_sector; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_sector ON public.procedures USING btree (sector_id);


--
-- Name: idx_procedures_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_status ON public.procedures USING btree (status);


--
-- Name: idx_procedures_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_procedures_type ON public.procedures USING btree (type);


--
-- Name: idx_professional_licenses_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_active ON public.user_professional_licenses USING btree (is_active);


--
-- Name: idx_professional_licenses_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_company ON public.user_professional_licenses USING btree (company_id);


--
-- Name: idx_professional_licenses_expiry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_expiry ON public.user_professional_licenses USING btree (expiry_date) WHERE (expiry_date IS NOT NULL);


--
-- Name: idx_professional_licenses_profession; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_profession ON public.user_professional_licenses USING btree (profession);


--
-- Name: idx_professional_licenses_suspended; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_suspended ON public.user_professional_licenses USING btree (is_suspended);


--
-- Name: idx_professional_licenses_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_professional_licenses_user ON public.user_professional_licenses USING btree (user_id);


--
-- Name: idx_psychiatric_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psychiatric_company ON public.user_psychiatric_treatments USING btree (company_id);


--
-- Name: idx_psychiatric_current; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psychiatric_current ON public.user_psychiatric_treatments USING btree (is_current);


--
-- Name: idx_psychiatric_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_psychiatric_user ON public.user_psychiatric_treatments USING btree (user_id);


--
-- Name: idx_puntos_venta_activo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_puntos_venta_activo ON public.siac_puntos_venta USING btree (activo);


--
-- Name: idx_puntos_venta_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_puntos_venta_company ON public.siac_puntos_venta USING btree (company_id);


--
-- Name: idx_redemption_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_company ON public.hour_bank_redemption_requests USING btree (company_id);


--
-- Name: idx_redemption_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_date ON public.hour_bank_redemption_requests USING btree (scheduled_date);


--
-- Name: idx_redemption_history_request; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_history_request ON public.hour_bank_redemption_history USING btree (request_id);


--
-- Name: idx_redemption_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_status ON public.hour_bank_redemption_requests USING btree (status);


--
-- Name: idx_redemption_supervisor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_supervisor ON public.hour_bank_redemption_requests USING btree (supervisor_id, status);


--
-- Name: idx_redemption_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_redemption_user ON public.hour_bank_redemption_requests USING btree (user_id);


--
-- Name: idx_renewal_logs_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_renewal_logs_contract ON public.contract_renewal_logs USING btree (contract_id);


--
-- Name: idx_renewal_logs_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_renewal_logs_created ON public.contract_renewal_logs USING btree (created_at);


--
-- Name: idx_role_definitions_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_definitions_category ON public.role_definitions USING btree (category);


--
-- Name: idx_role_definitions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_role_definitions_company ON public.role_definitions USING btree (company_id);


--
-- Name: idx_role_key_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_role_key_company ON public.additional_role_types USING btree (role_key, company_id);


--
-- Name: idx_run_concept_details_run; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_run_concept_details_run ON public.payroll_run_concept_details USING btree (run_detail_id);


--
-- Name: idx_salary_categories_v2_agreement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_categories_v2_agreement ON public.salary_categories_v2 USING btree (labor_agreement_id);


--
-- Name: idx_salary_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_config_company ON public.user_salary_config USING btree (company_id);


--
-- Name: idx_salary_config_next_review; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_config_next_review ON public.user_salary_config USING btree (next_salary_review_date) WHERE (next_salary_review_date IS NOT NULL);


--
-- Name: idx_salary_config_payment_frequency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_config_payment_frequency ON public.user_salary_config USING btree (payment_frequency);


--
-- Name: idx_salary_config_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_config_user ON public.user_salary_config USING btree (user_id);


--
-- Name: idx_salary_v2_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_v2_company ON public.user_salary_config_v2 USING btree (company_id);


--
-- Name: idx_salary_v2_current; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_v2_current ON public.user_salary_config_v2 USING btree (is_current);


--
-- Name: idx_salary_v2_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_salary_v2_user ON public.user_salary_config_v2 USING btree (user_id);


--
-- Name: idx_sanction_history_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanction_history_created_at ON public.sanction_history USING btree (created_at DESC);


--
-- Name: idx_sanction_history_sanction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanction_history_sanction_id ON public.sanction_history USING btree (sanction_id);


--
-- Name: idx_sanctions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_company ON public.sanctions USING btree (company_id);


--
-- Name: idx_sanctions_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_date ON public.sanctions USING btree (sanction_date);


--
-- Name: idx_sanctions_employee_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_employee_company ON public.sanctions USING btree (employee_id, company_id);


--
-- Name: idx_sanctions_lawyer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_lawyer ON public.sanctions USING btree (lawyer_id);


--
-- Name: idx_sanctions_pending_hr; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_pending_hr ON public.sanctions USING btree (company_id, workflow_status) WHERE ((workflow_status)::text = 'pending_hr'::text);


--
-- Name: idx_sanctions_pending_lawyer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_pending_lawyer ON public.sanctions USING btree (company_id, workflow_status) WHERE ((workflow_status)::text = 'pending_lawyer'::text);


--
-- Name: idx_sanctions_requester; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_requester ON public.sanctions USING btree (requester_id);


--
-- Name: idx_sanctions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_status ON public.sanctions USING btree (status);


--
-- Name: idx_sanctions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_type ON public.sanctions USING btree (sanction_type);


--
-- Name: idx_sanctions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_user ON public.sanctions USING btree (user_id);


--
-- Name: idx_sanctions_workflow_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sanctions_workflow_status ON public.sanctions USING btree (workflow_status);


--
-- Name: idx_scheduled_redemption_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scheduled_redemption_date ON public.hour_bank_scheduled_redemptions USING btree (scheduled_date, company_id);


--
-- Name: idx_scheduled_redemption_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scheduled_redemption_user ON public.hour_bank_scheduled_redemptions USING btree (user_id, scheduled_date);


--
-- Name: idx_scoring_history_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scoring_history_date ON public.scoring_history USING btree (snapshot_date DESC);


--
-- Name: idx_scoring_history_trends; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scoring_history_trends ON public.scoring_history USING btree (company_id, trend, snapshot_date DESC);


--
-- Name: idx_scoring_history_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scoring_history_user ON public.scoring_history USING btree (user_id, snapshot_date DESC);


--
-- Name: idx_sectors_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sectors_active ON public.sectors USING btree (company_id, is_active);


--
-- Name: idx_sectors_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sectors_company ON public.sectors USING btree (company_id);


--
-- Name: idx_sectors_department; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sectors_department ON public.sectors USING btree (department_id);


--
-- Name: idx_sectors_supervisor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sectors_supervisor ON public.sectors USING btree (supervisor_id);


--
-- Name: idx_sesiones_caja_caja; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sesiones_caja_caja ON public.siac_sesiones_caja USING btree (caja_id);


--
-- Name: idx_sesiones_caja_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sesiones_caja_estado ON public.siac_sesiones_caja USING btree (estado);


--
-- Name: idx_sesiones_caja_fecha; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sesiones_caja_fecha ON public.siac_sesiones_caja USING btree (fecha_apertura);


--
-- Name: idx_shifts_branch_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_shifts_branch_id ON public.shifts USING btree (branch_id);


--
-- Name: idx_shifts_global_cycle; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_shifts_global_cycle ON public.shifts USING btree (global_cycle_start_date) WHERE (global_cycle_start_date IS NOT NULL);


--
-- Name: idx_siac_categorias_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_categorias_company ON public.siac_productos_categorias USING btree (company_id);


--
-- Name: idx_siac_clientes_codigo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_clientes_codigo ON public.siac_clientes USING btree (codigo_cliente);


--
-- Name: idx_siac_clientes_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_clientes_company_id ON public.siac_clientes USING btree (company_id);


--
-- Name: idx_siac_clientes_documento; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_clientes_documento ON public.siac_clientes USING btree (documento_numero);


--
-- Name: idx_siac_clientes_razon_social; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_clientes_razon_social ON public.siac_clientes USING btree (razon_social);


--
-- Name: idx_siac_configuracion_terminal_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_configuracion_terminal_company ON public.siac_configuracion_terminal USING btree (company_id, activo);


--
-- Name: idx_siac_contactos_cliente; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_contactos_cliente ON public.siac_clientes_contactos USING btree (cliente_id);


--
-- Name: idx_siac_direcciones_cliente; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_direcciones_cliente ON public.siac_clientes_direcciones USING btree (cliente_id);


--
-- Name: idx_siac_facturas_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_facturas_company ON public.siac_facturas USING btree (company_id);


--
-- Name: idx_siac_facturas_presupuesto; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_facturas_presupuesto ON public.siac_facturas USING btree (presupuesto_id);


--
-- Name: idx_siac_marcas_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_marcas_company ON public.siac_productos_marcas USING btree (company_id);


--
-- Name: idx_siac_numeracion_company_tipo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_numeracion_company_tipo ON public.siac_numeracion_log USING btree (company_id, tipo_comprobante);


--
-- Name: idx_siac_numeracion_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_numeracion_timestamp ON public.siac_numeracion_log USING btree (timestamp_asignacion);


--
-- Name: idx_siac_precios_cliente; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_precios_cliente ON public.siac_clientes_precios_especiales USING btree (cliente_id);


--
-- Name: idx_siac_precios_lista; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_precios_lista ON public.siac_productos_precios USING btree (lista_precios_id);


--
-- Name: idx_siac_precios_producto; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_precios_producto ON public.siac_productos_precios USING btree (producto_id);


--
-- Name: idx_siac_presupuestos_auto_billing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_auto_billing ON public.siac_presupuestos USING btree (tipo_facturacion, estado, proximo_periodo_facturacion) WHERE (((tipo_facturacion)::text = 'RECURRENTE'::text) AND ((estado)::text = 'ACTIVO'::text));


--
-- Name: idx_siac_presupuestos_cliente; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_cliente ON public.siac_presupuestos USING btree (cliente_id);


--
-- Name: idx_siac_presupuestos_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_company ON public.siac_presupuestos USING btree (company_id);


--
-- Name: idx_siac_presupuestos_contract; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_contract ON public.siac_presupuestos USING btree (contract_id);


--
-- Name: idx_siac_presupuestos_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_estado ON public.siac_presupuestos USING btree (estado);


--
-- Name: idx_siac_presupuestos_fecha_emision; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_fecha_emision ON public.siac_presupuestos USING btree (fecha_emision);


--
-- Name: idx_siac_presupuestos_numero; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_numero ON public.siac_presupuestos USING btree (numero_presupuesto);


--
-- Name: idx_siac_presupuestos_proximo_periodo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_proximo_periodo ON public.siac_presupuestos USING btree (proximo_periodo_facturacion);


--
-- Name: idx_siac_presupuestos_tipo_facturacion; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_presupuestos_tipo_facturacion ON public.siac_presupuestos USING btree (tipo_facturacion);


--
-- Name: idx_siac_productos_barras; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_barras ON public.siac_productos USING btree (codigo_barras);


--
-- Name: idx_siac_productos_categoria; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_categoria ON public.siac_productos USING btree (categoria_id);


--
-- Name: idx_siac_productos_codigo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_codigo ON public.siac_productos USING btree (codigo_producto);


--
-- Name: idx_siac_productos_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_company ON public.siac_productos USING btree (company_id);


--
-- Name: idx_siac_productos_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_estado ON public.siac_productos USING btree (estado);


--
-- Name: idx_siac_productos_marca; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_productos_marca ON public.siac_productos USING btree (marca_id);


--
-- Name: idx_siac_sesiones_company_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_sesiones_company_active ON public.siac_sesiones_locales USING btree (company_id, is_active);


--
-- Name: idx_siac_sesiones_last_activity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_sesiones_last_activity ON public.siac_sesiones_locales USING btree (last_activity);


--
-- Name: idx_siac_sesiones_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_sesiones_session_id ON public.siac_sesiones_locales USING btree (session_id);


--
-- Name: idx_siac_sesiones_terminal_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_sesiones_terminal_active ON public.siac_sesiones_locales USING btree (terminal_id, is_active);


--
-- Name: idx_siac_stock_fecha; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_stock_fecha ON public.siac_stock_movimientos USING btree (fecha_movimiento);


--
-- Name: idx_siac_stock_producto; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_stock_producto ON public.siac_stock_movimientos USING btree (producto_id);


--
-- Name: idx_siac_transacciones_session_estado; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_siac_transacciones_session_estado ON public.siac_transacciones_pendientes USING btree (session_id, estado);


--
-- Name: idx_sla_records_breach; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sla_records_breach ON public.notification_sla_records USING btree (sla_met) WHERE (sla_met = false);


--
-- Name: idx_sla_records_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sla_records_company ON public.notification_sla_records USING btree (company_id);


--
-- Name: idx_sla_records_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sla_records_employee ON public.notification_sla_records USING btree (employee_id);


--
-- Name: idx_sla_records_sla_met; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sla_records_sla_met ON public.notification_sla_records USING btree (sla_met);


--
-- Name: idx_sports_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sports_company ON public.user_sports_activities USING btree (company_id);


--
-- Name: idx_sports_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_sports_user ON public.user_sports_activities USING btree (user_id);


--
-- Name: idx_staff_bank_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_bank_verified ON public.aponnt_staff USING btree (bank_data_verified) WHERE (bank_data_verified = true);


--
-- Name: idx_staff_cbu; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_cbu ON public.aponnt_staff USING btree (cbu) WHERE (cbu IS NOT NULL);


--
-- Name: idx_staff_companies_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_companies_active ON public.aponnt_staff_companies USING btree (is_active, assigned_at);


--
-- Name: idx_staff_companies_assigned_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_companies_assigned_by ON public.aponnt_staff_companies USING btree (assigned_by);


--
-- Name: idx_staff_companies_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_companies_company ON public.aponnt_staff_companies USING btree (company_id) WHERE (is_active = true);


--
-- Name: idx_staff_companies_staff; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_companies_staff ON public.aponnt_staff_companies USING btree (staff_id) WHERE (is_active = true);


--
-- Name: idx_staff_payment_method; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_payment_method ON public.aponnt_staff USING btree (payment_method_preference);


--
-- Name: idx_staff_roles_area; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_roles_area ON public.aponnt_staff_roles USING btree (role_area);


--
-- Name: idx_staff_roles_country_specific; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_roles_country_specific ON public.aponnt_staff_roles USING btree (is_country_specific);


--
-- Name: idx_staff_roles_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_roles_level ON public.aponnt_staff_roles USING btree (level);


--
-- Name: idx_staff_roles_reports_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_staff_roles_reports_to ON public.aponnt_staff_roles USING btree (reports_to_role_code);


--
-- Name: idx_submissions_allowance; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_submissions_allowance ON public.benefit_expense_submissions USING btree (allowance_id);


--
-- Name: idx_submissions_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_submissions_date ON public.benefit_expense_submissions USING btree (expense_date);


--
-- Name: idx_submissions_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_submissions_employee ON public.benefit_expense_submissions USING btree (user_id);


--
-- Name: idx_submissions_reimbursement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_submissions_reimbursement ON public.benefit_expense_submissions USING btree (reimbursement_status);


--
-- Name: idx_submissions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_submissions_status ON public.benefit_expense_submissions USING btree (verification_status);


--
-- Name: idx_super_users_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_super_users_active ON public.super_users USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_super_users_username; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_super_users_username ON public.super_users USING btree (username);


--
-- Name: idx_support_activity_log_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_activity_log_company ON public.support_activity_log USING btree (company_id);


--
-- Name: idx_support_activity_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_activity_log_created_at ON public.support_activity_log USING btree (created_at DESC);


--
-- Name: idx_support_activity_log_session; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_activity_log_session ON public.support_activity_log USING btree (session_id);


--
-- Name: idx_support_activity_log_support_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_activity_log_support_user ON public.support_activity_log USING btree (support_user_id);


--
-- Name: idx_support_activity_log_ticket; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_activity_log_ticket ON public.support_activity_log USING btree (ticket_id);


--
-- Name: idx_support_assistant_attempts_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_assistant_attempts_created_at ON public.support_assistant_attempts USING btree (attempted_at DESC);


--
-- Name: idx_support_assistant_attempts_satisfied; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_assistant_attempts_satisfied ON public.support_assistant_attempts USING btree (user_satisfied);


--
-- Name: idx_support_assistant_attempts_ticket; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_assistant_attempts_ticket ON public.support_assistant_attempts USING btree (ticket_id);


--
-- Name: idx_support_assistant_attempts_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_assistant_attempts_type ON public.support_assistant_attempts USING btree (assistant_type);


--
-- Name: idx_support_escalations_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_escalations_created_at ON public.support_escalations USING btree (escalated_at DESC);


--
-- Name: idx_support_escalations_from; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_escalations_from ON public.support_escalations USING btree (escalated_from_user_id);


--
-- Name: idx_support_escalations_ticket; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_escalations_ticket ON public.support_escalations USING btree (ticket_id);


--
-- Name: idx_support_escalations_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_escalations_to ON public.support_escalations USING btree (escalated_to_user_id);


--
-- Name: idx_support_ticket_messages_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_ticket_messages_created_at ON public.support_ticket_messages USING btree (created_at DESC);


--
-- Name: idx_support_ticket_messages_ticket; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_ticket_messages_ticket ON public.support_ticket_messages USING btree (ticket_id);


--
-- Name: idx_support_tickets_assigned_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_assigned_to ON public.support_tickets USING btree (assigned_to_vendor_id);


--
-- Name: idx_support_tickets_assistant_attempted; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_assistant_attempted ON public.support_tickets USING btree (assistant_attempted);


--
-- Name: idx_support_tickets_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_company ON public.support_tickets USING btree (company_id);


--
-- Name: idx_support_tickets_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_created_at ON public.support_tickets USING btree (created_at DESC);


--
-- Name: idx_support_tickets_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_created_by ON public.support_tickets USING btree (created_by_user_id);


--
-- Name: idx_support_tickets_escalated_to_supervisor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_escalated_to_supervisor ON public.support_tickets USING btree (escalated_to_supervisor_id);


--
-- Name: idx_support_tickets_sla_escalation_deadline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_sla_escalation_deadline ON public.support_tickets USING btree (sla_escalation_deadline);


--
-- Name: idx_support_tickets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_status ON public.support_tickets USING btree (status);


--
-- Name: idx_support_tickets_thread_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_tickets_thread_id ON public.support_tickets USING btree (thread_id);


--
-- Name: idx_support_vendor_stats_period; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_vendor_stats_period ON public.support_vendor_stats USING btree (period_start, period_end);


--
-- Name: idx_support_vendor_stats_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_vendor_stats_vendor ON public.support_vendor_stats USING btree (vendor_id);


--
-- Name: idx_support_vendor_supervisors_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_vendor_supervisors_active ON public.support_vendor_supervisors USING btree (is_active);


--
-- Name: idx_support_vendor_supervisors_supervisor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_vendor_supervisors_supervisor ON public.support_vendor_supervisors USING btree (supervisor_id);


--
-- Name: idx_support_vendor_supervisors_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_support_vendor_supervisors_vendor ON public.support_vendor_supervisors USING btree (vendor_id);


--
-- Name: idx_surgeries_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_surgeries_company ON public.user_surgeries USING btree (company_id);


--
-- Name: idx_surgeries_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_surgeries_user ON public.user_surgeries USING btree (user_id);


--
-- Name: idx_suspension_blocks_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_suspension_blocks_active ON public.suspension_blocks USING btree (employee_id, is_active, end_date) WHERE (is_active = true);


--
-- Name: idx_suspension_blocks_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_suspension_blocks_company ON public.suspension_blocks USING btree (company_id, is_active);


--
-- Name: idx_system_metadata_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_metadata_active ON public.system_metadata USING btree (is_active);


--
-- Name: idx_system_metadata_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_metadata_key ON public.system_metadata USING btree (metadata_key);


--
-- Name: idx_system_metadata_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_metadata_type ON public.system_metadata USING btree (metadata_type);


--
-- Name: idx_system_modules_available_in; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_modules_available_in ON public.system_modules USING btree (available_in) WHERE (is_active = true);


--
-- Name: idx_system_modules_bundled_modules; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_modules_bundled_modules ON public.system_modules USING gin (bundled_modules);


--
-- Name: idx_system_modules_is_core; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_modules_is_core ON public.system_modules USING btree (is_core) WHERE (is_active = true);


--
-- Name: idx_system_modules_requirements; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_modules_requirements ON public.system_modules USING gin (requirements);


--
-- Name: idx_system_modules_ui_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_modules_ui_metadata ON public.system_modules USING gin (ui_metadata);


--
-- Name: idx_task_compat_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_compat_company ON public.task_compatibility USING btree (company_id);


--
-- Name: idx_task_compat_cover; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_compat_cover ON public.task_compatibility USING btree (cover_user_id, is_active);


--
-- Name: idx_task_compat_primary; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_compat_primary ON public.task_compatibility USING btree (primary_user_id, is_active);


--
-- Name: idx_task_compat_score; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_compat_score ON public.task_compatibility USING btree (compatibility_score, is_active);


--
-- Name: idx_tax_concepts_template_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tax_concepts_template_order ON public.tax_concepts USING btree (tax_template_id, calculation_order);


--
-- Name: idx_tax_conditions_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tax_conditions_template ON public.tax_conditions USING btree (tax_template_id);


--
-- Name: idx_tax_rates_concept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tax_rates_concept ON public.tax_rates USING btree (tax_concept_id);


--
-- Name: idx_tax_templates_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tax_templates_country ON public.tax_templates USING btree (country_code);


--
-- Name: idx_template_concepts_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_template_concepts_entity ON public.payroll_template_concepts USING btree (entity_id);


--
-- Name: idx_template_concepts_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_template_concepts_template ON public.payroll_template_concepts USING btree (template_id);


--
-- Name: idx_templates_country; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_templates_country ON public.contract_templates USING btree (country_code);


--
-- Name: idx_templates_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_templates_default ON public.contract_templates USING btree (is_default, country_code, template_type_id);


--
-- Name: idx_templates_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_templates_status ON public.contract_templates USING btree (status);


--
-- Name: idx_templates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_templates_type ON public.contract_templates USING btree (template_type_id);


--
-- Name: idx_test_executions_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_company_id ON public.test_executions USING btree (company_id);


--
-- Name: idx_test_executions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_created_at ON public.test_executions USING btree (created_at DESC);


--
-- Name: idx_test_executions_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_environment ON public.test_executions USING btree (environment);


--
-- Name: idx_test_executions_execution_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_execution_id ON public.test_executions USING btree (execution_id);


--
-- Name: idx_test_executions_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_module ON public.test_executions USING btree (module);


--
-- Name: idx_test_executions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_executions_status ON public.test_executions USING btree (status);


--
-- Name: idx_test_results_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_results_module ON public.test_results USING btree (module_key);


--
-- Name: idx_test_results_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_test_results_timestamp ON public.test_results USING btree (test_timestamp DESC);


--
-- Name: idx_testing_tickets_assigned; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_assigned ON public.testing_tickets USING btree (assigned_to);


--
-- Name: idx_testing_tickets_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_created ON public.testing_tickets USING btree (created_at DESC);


--
-- Name: idx_testing_tickets_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_module ON public.testing_tickets USING btree (module_name);


--
-- Name: idx_testing_tickets_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_pending ON public.testing_tickets USING btree (status, priority DESC) WHERE ((status)::text = ANY ((ARRAY['PENDING_REPAIR'::character varying, 'IN_REPAIR'::character varying, 'FIXED'::character varying, 'RETESTING'::character varying])::text[]));


--
-- Name: idx_testing_tickets_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_priority ON public.testing_tickets USING btree (priority);


--
-- Name: idx_testing_tickets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_testing_tickets_status ON public.testing_tickets USING btree (status);


--
-- Name: idx_thread_analysis_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_thread_analysis_company ON public.notification_thread_analysis USING btree (company_id);


--
-- Name: idx_thread_analysis_group; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_thread_analysis_group ON public.notification_thread_analysis USING btree (group_id);


--
-- Name: idx_thread_analysis_unresolved; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_thread_analysis_unresolved ON public.notification_thread_analysis USING btree (is_resolved) WHERE (is_resolved = false);


--
-- Name: idx_threads_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_threads_company ON public.notification_threads USING btree (company_id, status, last_message_at DESC);


--
-- Name: idx_threads_initiator; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_threads_initiator ON public.notification_threads USING btree (initiator_id, status);


--
-- Name: idx_threads_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_threads_module ON public.notification_threads USING btree (module, category);


--
-- Name: idx_tipos_comprobantes_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tipos_comprobantes_company ON public.siac_tipos_comprobantes USING btree (company_id);


--
-- Name: idx_tipos_comprobantes_letra; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tipos_comprobantes_letra ON public.siac_tipos_comprobantes USING btree (letra_comprobante);


--
-- Name: idx_training_assignments_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_training_assignments_company ON public.training_assignments USING btree (company_id);


--
-- Name: idx_training_assignments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_training_assignments_status ON public.training_assignments USING btree (status);


--
-- Name: idx_training_assignments_training; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_training_assignments_training ON public.training_assignments USING btree (training_id);


--
-- Name: idx_training_assignments_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_training_assignments_user ON public.training_assignments USING btree (user_id);


--
-- Name: idx_trainings_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_trainings_category ON public.trainings USING btree (category);


--
-- Name: idx_trainings_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_trainings_company ON public.trainings USING btree (company_id);


--
-- Name: idx_transactions_redemption; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transactions_redemption ON public.hour_bank_transactions USING btree (source_type, source_request_id) WHERE ((source_type)::text = 'redemption'::text);


--
-- Name: idx_unauthorized_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unauthorized_company ON public.unauthorized_access_attempts USING btree (company_id);


--
-- Name: idx_unauthorized_employee; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unauthorized_employee ON public.unauthorized_access_attempts USING btree (employee_id);


--
-- Name: idx_unauthorized_kiosk; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unauthorized_kiosk ON public.unauthorized_access_attempts USING btree (kiosk_id);


--
-- Name: idx_unauthorized_requires_review; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unauthorized_requires_review ON public.unauthorized_access_attempts USING btree (requires_hr_review);


--
-- Name: idx_unauthorized_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unauthorized_timestamp ON public.unauthorized_access_attempts USING btree ("timestamp");


--
-- Name: idx_unified_help_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_help_company ON public.unified_help_interactions USING btree (company_id);


--
-- Name: idx_unified_help_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_help_created ON public.unified_help_interactions USING btree (created_at DESC);


--
-- Name: idx_unified_help_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_help_type ON public.unified_help_interactions USING btree (interaction_type);


--
-- Name: idx_unified_help_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_help_user ON public.unified_help_interactions USING btree (user_id);


--
-- Name: idx_unified_notif_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_action ON public.unified_notifications USING btree (action_status, action_deadline) WHERE ((requires_action = true) AND (deleted_at IS NULL));


--
-- Name: idx_unified_notif_aponnt_dept; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_aponnt_dept ON public.unified_notifications USING btree (aponnt_department, created_at DESC) WHERE (aponnt_department IS NOT NULL);


--
-- Name: idx_unified_notif_commercial; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_commercial ON public.unified_notifications USING btree (is_commercial, company_id, created_at DESC) WHERE (is_commercial = true);


--
-- Name: idx_unified_notif_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_company ON public.unified_notifications USING btree (company_id, created_at DESC) WHERE (deleted_at IS NULL);


--
-- Name: idx_unified_notif_direction; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_direction ON public.unified_notifications USING btree (direction, company_id, created_at DESC) WHERE ((direction)::text = ANY ((ARRAY['inbound'::character varying, 'outbound'::character varying])::text[]));


--
-- Name: idx_unified_notif_hierarchy; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_hierarchy ON public.unified_notifications USING btree (recipient_hierarchy_level, company_id) WHERE (deleted_at IS NULL);


--
-- Name: idx_unified_notif_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_metadata ON public.unified_notifications USING gin (metadata);


--
-- Name: idx_unified_notif_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_module ON public.unified_notifications USING btree (module, category) WHERE (deleted_at IS NULL);


--
-- Name: idx_unified_notif_origin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_origin ON public.unified_notifications USING btree (origin_type, origin_id) WHERE (deleted_at IS NULL);


--
-- Name: idx_unified_notif_recipient; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_recipient ON public.unified_notifications USING btree (recipient_id, is_read, deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_unified_notif_sla; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_sla ON public.unified_notifications USING btree (sla_deadline) WHERE ((sla_deadline IS NOT NULL) AND (sla_breached = false));


--
-- Name: idx_unified_notif_thread; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_thread ON public.unified_notifications USING btree (thread_id, sequence_in_thread) WHERE (thread_id IS NOT NULL);


--
-- Name: idx_unified_notif_trace; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_trace ON public.unified_notifications USING btree (trace_id) WHERE (trace_id IS NOT NULL);


--
-- Name: idx_unified_notif_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_unified_notif_vendor ON public.unified_notifications USING btree (vendor_id, created_at DESC) WHERE (vendor_id IS NOT NULL);


--
-- Name: idx_union_affiliation_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_active ON public.user_union_affiliation USING btree (is_active);


--
-- Name: idx_union_affiliation_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_company ON public.user_union_affiliation USING btree (company_id);


--
-- Name: idx_union_affiliation_delegate; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_delegate ON public.user_union_affiliation USING btree (workplace_delegate);


--
-- Name: idx_union_affiliation_fuero; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_fuero ON public.user_union_affiliation USING btree (has_fuero_sindical);


--
-- Name: idx_union_affiliation_union; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_union ON public.user_union_affiliation USING btree (union_name);


--
-- Name: idx_union_affiliation_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_union_affiliation_user ON public.user_union_affiliation USING btree (user_id);


--
-- Name: idx_unique_active_template_per_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_unique_active_template_per_branch ON public.hour_bank_templates USING btree (company_id, COALESCE(branch_id, '-1'::integer)) WHERE ((is_current_version = true) AND (is_enabled = true));


--
-- Name: idx_unique_aponnt_master; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_unique_aponnt_master ON public.companies USING btree (is_aponnt_master) WHERE (is_aponnt_master = true);


--
-- Name: idx_user_audit_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_action ON public.user_audit_logs USING btree (action);


--
-- Name: idx_user_audit_logs_changed_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_changed_by ON public.user_audit_logs USING btree (changed_by_user_id);


--
-- Name: idx_user_audit_logs_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_company_id ON public.user_audit_logs USING btree (company_id);


--
-- Name: idx_user_audit_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_created_at ON public.user_audit_logs USING btree (created_at DESC);


--
-- Name: idx_user_audit_logs_field_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_field_name ON public.user_audit_logs USING btree (field_name);


--
-- Name: idx_user_audit_logs_user_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_user_date ON public.user_audit_logs USING btree (user_id, created_at DESC);


--
-- Name: idx_user_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_audit_logs_user_id ON public.user_audit_logs USING btree (user_id);


--
-- Name: idx_user_bonuses_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_bonuses_company ON public.user_payroll_bonuses USING btree (company_id);


--
-- Name: idx_user_bonuses_next_payment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_bonuses_next_payment ON public.user_payroll_bonuses USING btree (next_payment_date);


--
-- Name: idx_user_bonuses_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_bonuses_user ON public.user_payroll_bonuses USING btree (user_id);


--
-- Name: idx_user_concept_overrides_assignment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_concept_overrides_assignment ON public.user_payroll_concept_overrides USING btree (assignment_id);


--
-- Name: idx_user_concept_overrides_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_concept_overrides_user ON public.user_payroll_concept_overrides USING btree (user_id);


--
-- Name: idx_user_consents_consent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_consents_consent ON public.user_consents USING btree (consent_id);


--
-- Name: idx_user_consents_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_consents_pending ON public.user_consents USING btree (user_id, user_type, status) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_user_consents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_consents_status ON public.user_consents USING btree (status);


--
-- Name: idx_user_consents_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_consents_user ON public.user_consents USING btree (user_id, user_type);


--
-- Name: idx_user_documents_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_documents_company ON public.user_documents USING btree (company_id);


--
-- Name: idx_user_documents_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_documents_user ON public.user_documents USING btree (user_id);


--
-- Name: idx_user_emails_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_emails_active ON public.user_emails USING btree (is_active);


--
-- Name: idx_user_emails_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_emails_company ON public.user_emails USING btree (company_id);


--
-- Name: idx_user_emails_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_emails_email ON public.user_emails USING btree (email);


--
-- Name: idx_user_emails_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_emails_user ON public.user_emails USING btree (user_id);


--
-- Name: idx_user_emails_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_emails_verified ON public.user_emails USING btree (is_verified);


--
-- Name: idx_user_notification_prefs; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_notification_prefs ON public.user_notification_preferences USING btree (user_id, module);


--
-- Name: idx_user_payroll_assignment_template; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_payroll_assignment_template ON public.user_payroll_assignment USING btree (template_id);


--
-- Name: idx_user_payroll_assignment_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_payroll_assignment_user ON public.user_payroll_assignment USING btree (user_id);


--
-- Name: idx_user_roles_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_roles_active ON public.user_role_assignments USING btree (user_id, is_active) WHERE (is_active = true);


--
-- Name: idx_user_roles_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_roles_role ON public.user_role_assignments USING btree (role_id);


--
-- Name: idx_user_roles_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_roles_user ON public.user_role_assignments USING btree (user_id);


--
-- Name: idx_user_salary_config_v2_agreement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_salary_config_v2_agreement ON public.user_salary_config_v2 USING btree (labor_agreement_id);


--
-- Name: idx_user_salary_config_v2_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_salary_config_v2_category ON public.user_salary_config_v2 USING btree (salary_category_id);


--
-- Name: idx_user_salary_config_v2_current; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_salary_config_v2_current ON public.user_salary_config_v2 USING btree (is_current) WHERE (is_current = true);


--
-- Name: idx_user_shift_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shift_active ON public.user_shift_assignments USING btree (user_id, is_active, join_date DESC) WHERE (is_active = true);


--
-- Name: idx_user_shift_company_shift; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shift_company_shift ON public.user_shift_assignments USING btree (company_id, shift_id, is_active);


--
-- Name: idx_user_shift_phase; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shift_phase ON public.user_shift_assignments USING btree (assigned_phase, is_active) WHERE (is_active = true);


--
-- Name: idx_user_shift_sector; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shift_sector ON public.user_shift_assignments USING btree (sector, company_id) WHERE (sector IS NOT NULL);


--
-- Name: idx_user_shift_unique_active; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_user_shift_unique_active ON public.user_shift_assignments USING btree (user_id) WHERE (is_active = true);


--
-- Name: idx_user_shifts_shift_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shifts_shift_id ON public.user_shifts USING btree (shift_id);


--
-- Name: idx_user_shifts_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_shifts_user_id ON public.user_shifts USING btree (user_id);


--
-- Name: idx_users_account_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_account_status ON public.users USING btree (account_status) WHERE (account_status = 'pending_verification'::public.user_account_status);


--
-- Name: idx_users_ai_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_ai_enabled ON public.users USING btree (ai_analysis_enabled, company_id) WHERE (ai_analysis_enabled = true);


--
-- Name: idx_users_authorized_departments_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_authorized_departments_gin ON public.users USING gin (authorized_departments);


--
-- Name: idx_users_biometric_enrolled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_biometric_enrolled ON public.users USING btree (biometric_enrolled, company_id) WHERE (biometric_enrolled = true);


--
-- Name: idx_users_biometric_flags; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_biometric_flags ON public.users USING btree (has_fingerprint, has_facial_data, is_active);


--
-- Name: idx_users_biometric_photo_expiration; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_biometric_photo_expiration ON public.users USING btree (biometric_photo_expiration) WHERE (biometric_photo_expiration IS NOT NULL);


--
-- Name: idx_users_branch_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_branch_active ON public.users USING btree (default_branch_id, is_active);


--
-- Name: idx_users_branch_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_branch_id ON public.users USING btree (branch_id);


--
-- Name: idx_users_branch_scope; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_branch_scope ON public.users USING gin (branch_scope);


--
-- Name: idx_users_can_authorize; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_can_authorize ON public.users USING btree (can_authorize_late_arrivals, is_active) WHERE (can_authorize_late_arrivals = true);


--
-- Name: idx_users_can_use_kiosk; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_can_use_kiosk ON public.users USING btree (can_use_kiosk);


--
-- Name: idx_users_can_use_mobile_app; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_can_use_mobile_app ON public.users USING btree (can_use_mobile_app);


--
-- Name: idx_users_company_biometric; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_company_biometric ON public.users USING btree (company_id, biometric_enrolled) WHERE (biometric_enrolled = true);


--
-- Name: idx_users_department_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_department_active ON public.users USING btree (department_id, is_active);


--
-- Name: idx_users_email_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_email_active ON public.users USING btree (email, is_active);


--
-- Name: idx_users_email_verified; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_email_verified ON public.users USING btree (email_verified);


--
-- Name: idx_users_employee_id_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_employee_id_active ON public.users USING btree ("employeeId", is_active);


--
-- Name: idx_users_force_password_change; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_force_password_change ON public.users USING btree (force_password_change) WHERE (force_password_change = true);


--
-- Name: idx_users_gps_enabled; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_gps_enabled ON public.users USING btree (gps_enabled, is_active);


--
-- Name: idx_users_has_flexible_schedule; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_has_flexible_schedule ON public.users USING btree (has_flexible_schedule);


--
-- Name: idx_users_health_insurance_expiry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_health_insurance_expiry ON public.users USING btree (health_insurance_expiry) WHERE (health_insurance_expiry IS NOT NULL);


--
-- Name: idx_users_is_core; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_is_core ON public.users USING btree (is_core_user) WHERE (is_core_user = true);


--
-- Name: idx_users_last_login; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_last_login ON public.users USING btree (last_login);


--
-- Name: idx_users_last_scan; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_last_scan ON public.users USING btree (last_biometric_scan, company_id) WHERE (last_biometric_scan IS NOT NULL);


--
-- Name: idx_users_onboarding_trace; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_onboarding_trace ON public.users USING btree (onboarding_trace_id);


--
-- Name: idx_users_one_core_per_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_users_one_core_per_company ON public.users USING btree (company_id) WHERE (is_core_user = true);


--
-- Name: idx_users_org_position; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_org_position ON public.users USING btree (organizational_position_id);


--
-- Name: idx_users_pending_consents; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_pending_consents ON public.users USING gin (pending_consents);


--
-- Name: idx_users_permissions_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_permissions_gin ON public.users USING gin (permissions);


--
-- Name: idx_users_role_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_role_active ON public.users USING btree (role, is_active);


--
-- Name: idx_users_salary_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_salary_category ON public.users USING btree (salary_category_id);


--
-- Name: idx_users_search; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_search ON public.users USING gin ("firstName" public.gin_trgm_ops, "lastName" public.gin_trgm_ops, "employeeId" public.gin_trgm_ops);


--
-- Name: idx_users_sector; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_sector ON public.users USING btree (sector_id);


--
-- Name: idx_users_work_schedule_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_work_schedule_gin ON public.users USING gin (work_schedule);


--
-- Name: idx_ux_discoveries_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ux_discoveries_company ON public.ux_discoveries USING btree (company_id);


--
-- Name: idx_ux_discoveries_context; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ux_discoveries_context ON public.ux_discoveries USING btree (module_key, context);


--
-- Name: idx_ux_discoveries_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ux_discoveries_type ON public.ux_discoveries USING btree (discovery_type);


--
-- Name: idx_ux_discoveries_validation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ux_discoveries_validation ON public.ux_discoveries USING btree (validation_status);


--
-- Name: idx_vacation_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_config_active ON public.vacation_configurations USING btree (company_id, is_active);


--
-- Name: idx_vacation_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_config_company ON public.vacation_configurations USING btree (company_id);


--
-- Name: idx_vacation_req_approval; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_approval ON public.vacation_requests USING btree (approved_by, approval_date);


--
-- Name: idx_vacation_req_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_company ON public.vacation_requests USING btree (company_id);


--
-- Name: idx_vacation_req_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_dates ON public.vacation_requests USING btree (start_date, end_date, status);


--
-- Name: idx_vacation_req_source; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_source ON public.vacation_requests USING btree (source);


--
-- Name: idx_vacation_req_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_type ON public.vacation_requests USING btree (request_type, status);


--
-- Name: idx_vacation_req_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_user ON public.vacation_requests USING btree (user_id);


--
-- Name: idx_vacation_req_user_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_req_user_status ON public.vacation_requests USING btree (user_id, status);


--
-- Name: idx_vacation_requests_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_requests_company ON public.vacation_requests USING btree (company_id);


--
-- Name: idx_vacation_requests_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_requests_dates ON public.vacation_requests USING btree (start_date, end_date);


--
-- Name: idx_vacation_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_requests_status ON public.vacation_requests USING btree (status);


--
-- Name: idx_vacation_requests_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_requests_user ON public.vacation_requests USING btree (user_id);


--
-- Name: idx_vacation_requests_year; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_requests_year ON public.vacation_requests USING btree (user_id, EXTRACT(year FROM start_date));


--
-- Name: idx_vacation_scale_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_scale_company ON public.vacation_scales USING btree (company_id);


--
-- Name: idx_vacation_scale_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_scale_priority ON public.vacation_scales USING btree (priority, is_active);


--
-- Name: idx_vacation_scale_range; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vacation_scale_range ON public.vacation_scales USING btree (years_from, years_to, is_active);


--
-- Name: idx_vaccinations_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vaccinations_company ON public.user_vaccinations USING btree (company_id);


--
-- Name: idx_vaccinations_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vaccinations_user ON public.user_vaccinations USING btree (user_id);


--
-- Name: idx_vendor_commissions_company_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_commissions_company_active ON public.vendor_commissions USING btree (company_id, is_active);


--
-- Name: idx_vendor_commissions_original_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_commissions_original_vendor_id ON public.vendor_commissions USING btree (original_vendor_id) WHERE (original_vendor_id IS NOT NULL);


--
-- Name: idx_vendor_commissions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_commissions_type ON public.vendor_commissions USING btree (commission_type);


--
-- Name: idx_vendor_commissions_vendor_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_commissions_vendor_active ON public.vendor_commissions USING btree (vendor_id, is_active);


--
-- Name: idx_vendor_commissions_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_commissions_vendor_id ON public.vendor_commissions USING btree (vendor_id);


--
-- Name: idx_vendor_ratings_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_ratings_company ON public.vendor_ratings USING btree (company_id);


--
-- Name: idx_vendor_ratings_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_ratings_rating ON public.vendor_ratings USING btree (rating);


--
-- Name: idx_vendor_ratings_vendor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_ratings_vendor ON public.vendor_ratings USING btree (vendor_id);


--
-- Name: idx_vendor_referrals_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_referrals_level ON public.vendor_referrals USING btree (level);


--
-- Name: idx_vendor_referrals_referred; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_referrals_referred ON public.vendor_referrals USING btree (referred_id);


--
-- Name: idx_vendor_referrals_referrer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_referrals_referrer ON public.vendor_referrals USING btree (referrer_id);


--
-- Name: idx_vendor_referrals_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_referrals_status ON public.vendor_referrals USING btree (status);


--
-- Name: idx_vendor_statistics_grand_total; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_statistics_grand_total ON public.vendor_statistics USING btree (grand_total_commission_usd DESC);


--
-- Name: idx_vendor_statistics_rating; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_statistics_rating ON public.vendor_statistics USING btree (rating DESC);


--
-- Name: idx_vendor_statistics_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vendor_statistics_vendor_id ON public.vendor_statistics USING btree (vendor_id);


--
-- Name: idx_violation_catalog_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_catalog_active ON public.hse_violation_catalog USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_violation_catalog_ai; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_catalog_ai ON public.hse_violation_catalog USING btree (is_detectable_by_ai) WHERE (is_detectable_by_ai = true);


--
-- Name: idx_violation_catalog_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_catalog_category ON public.hse_violation_catalog USING btree (category);


--
-- Name: idx_violation_catalog_medical; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_violation_catalog_medical ON public.hse_violation_catalog USING btree (is_medical_selectable) WHERE (is_medical_selectable = true);


--
-- Name: idx_work_history_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_work_history_company ON public.user_work_history USING btree (company_id);


--
-- Name: idx_work_history_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_work_history_user ON public.user_work_history USING btree (user_id);


--
-- Name: idx_work_restrictions_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_work_restrictions_company ON public.user_work_restrictions USING btree (company_id);


--
-- Name: idx_work_restrictions_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_work_restrictions_user ON public.user_work_restrictions USING btree (user_id);


--
-- Name: idx_workflows_company_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workflows_company_module ON public.notification_workflows USING btree (company_id, module, is_active);


--
-- Name: idx_zone_config_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_zone_config_active ON public.hse_zone_configurations USING btree (is_active) WHERE (is_active = true);


--
-- Name: idx_zone_config_branch; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_zone_config_branch ON public.hse_zone_configurations USING btree (branch_id);


--
-- Name: idx_zone_config_company; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_zone_config_company ON public.hse_zone_configurations USING btree (company_id);


--
-- Name: kiosks_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX kiosks_company_id ON public.kiosks USING btree (company_id);


--
-- Name: kiosks_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX kiosks_is_active ON public.kiosks USING btree (is_active);


--
-- Name: kiosks_is_configured; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX kiosks_is_configured ON public.kiosks USING btree (is_configured);


--
-- Name: kiosks_unique_device_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX kiosks_unique_device_id ON public.kiosks USING btree (device_id) WHERE ((deleted_at IS NULL) AND (device_id IS NOT NULL));


--
-- Name: kiosks_unique_gps_per_company; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX kiosks_unique_gps_per_company ON public.kiosks USING btree (gps_lat, gps_lng, company_id) WHERE ((deleted_at IS NULL) AND (gps_lat IS NOT NULL) AND (gps_lng IS NOT NULL));


--
-- Name: labor_agreements_v2_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX labor_agreements_v2_company_id ON public.labor_agreements_v2 USING btree (company_id);


--
-- Name: labor_agreements_v2_country_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX labor_agreements_v2_country_id ON public.labor_agreements_v2 USING btree (country_id);


--
-- Name: labor_agreements_v2_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX labor_agreements_v2_is_active ON public.labor_agreements_v2 USING btree (is_active);


--
-- Name: medical_certificates_auditor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_certificates_auditor_id ON public.medical_certificates USING btree ("auditorId");


--
-- Name: medical_certificates_issue_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_certificates_issue_date ON public.medical_certificates USING btree ("issueDate");


--
-- Name: medical_certificates_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_certificates_status ON public.medical_certificates USING btree (status);


--
-- Name: medical_certificates_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_certificates_user_id ON public.medical_certificates USING btree ("userId");


--
-- Name: medical_diagnoses_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_diagnoses_category ON public.medical_diagnoses USING btree (category);


--
-- Name: medical_diagnoses_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_diagnoses_code ON public.medical_diagnoses USING btree (code);


--
-- Name: medical_diagnoses_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_diagnoses_is_active ON public.medical_diagnoses USING btree ("isActive");


--
-- Name: medical_diagnoses_requires_audit; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_diagnoses_requires_audit ON public.medical_diagnoses USING btree ("requiresAudit");


--
-- Name: medical_edit_authorizations_authorized_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_authorized_by ON public.medical_edit_authorizations USING btree (authorized_by);


--
-- Name: medical_edit_authorizations_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_company_id ON public.medical_edit_authorizations USING btree (company_id);


--
-- Name: medical_edit_authorizations_notification_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_notification_id ON public.medical_edit_authorizations USING btree (notification_id);


--
-- Name: medical_edit_authorizations_record_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_record_id ON public.medical_edit_authorizations USING btree (record_id);


--
-- Name: medical_edit_authorizations_requested_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_requested_by ON public.medical_edit_authorizations USING btree (requested_by);


--
-- Name: medical_edit_authorizations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_edit_authorizations_status ON public.medical_edit_authorizations USING btree (status);


--
-- Name: medical_exam_templates_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_exam_templates_company_id ON public.medical_exam_templates USING btree (company_id);


--
-- Name: medical_exam_templates_exam_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_exam_templates_exam_type ON public.medical_exam_templates USING btree (exam_type);


--
-- Name: medical_exam_templates_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_exam_templates_is_active ON public.medical_exam_templates USING btree (is_active);


--
-- Name: medical_record_audit_log_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_action ON public.medical_record_audit_log USING btree (action);


--
-- Name: medical_record_audit_log_action_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_action_at ON public.medical_record_audit_log USING btree (action_at);


--
-- Name: medical_record_audit_log_action_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_action_by ON public.medical_record_audit_log USING btree (action_by);


--
-- Name: medical_record_audit_log_authorization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_authorization_id ON public.medical_record_audit_log USING btree (authorization_id);


--
-- Name: medical_record_audit_log_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_company_id ON public.medical_record_audit_log USING btree (company_id);


--
-- Name: medical_record_audit_log_record_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_record_audit_log_record_id ON public.medical_record_audit_log USING btree (record_id);


--
-- Name: medical_records_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_company_id ON public.medical_records USING btree (company_id);


--
-- Name: medical_records_employee_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_employee_id ON public.medical_records USING btree (employee_id);


--
-- Name: medical_records_exam_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_exam_date ON public.medical_records USING btree (exam_date);


--
-- Name: medical_records_expiration_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_expiration_date ON public.medical_records USING btree (expiration_date);


--
-- Name: medical_records_is_deleted; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_is_deleted ON public.medical_records USING btree (is_deleted);


--
-- Name: medical_records_is_locked; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_is_locked ON public.medical_records USING btree (is_locked);


--
-- Name: medical_records_record_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_record_type ON public.medical_records USING btree (record_type);


--
-- Name: medical_records_result; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX medical_records_result ON public.medical_records USING btree (result);


--
-- Name: messages_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX messages_expires_at ON public.messages USING btree ("expiresAt");


--
-- Name: messages_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX messages_is_read ON public.messages USING btree ("isRead");


--
-- Name: messages_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX messages_priority ON public.messages USING btree (priority);


--
-- Name: messages_recipient_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX messages_recipient_id ON public.messages USING btree ("recipientId");


--
-- Name: messages_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX messages_type ON public.messages USING btree (type);


--
-- Name: notification_queue_company_id_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX notification_queue_company_id_status ON public.notification_queue USING btree (company_id, status);


--
-- Name: notification_queue_status_scheduled_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX notification_queue_status_scheduled_at ON public.notification_queue USING btree (status, scheduled_at);


--
-- Name: notifications_enterprise_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX notifications_enterprise_company_id ON public.notifications_enterprise USING btree (company_id);


--
-- Name: notifications_enterprise_company_id_status_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX notifications_enterprise_company_id_status_priority ON public.notifications_enterprise USING btree (company_id, status, priority);


--
-- Name: notifications_enterprise_to_user_id_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX notifications_enterprise_to_user_id_status ON public.notifications_enterprise USING btree (to_user_id, status);


--
-- Name: payroll_entity_settlements_company_id_entity_id_period_year_per; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX payroll_entity_settlements_company_id_entity_id_period_year_per ON public.payroll_entity_settlements USING btree (company_id, entity_id, period_year, period_month);


--
-- Name: payroll_template_concepts_concept_type_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_template_concepts_concept_type_id ON public.payroll_template_concepts USING btree (concept_type_id);


--
-- Name: payroll_template_concepts_display_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_template_concepts_display_order ON public.payroll_template_concepts USING btree (display_order);


--
-- Name: payroll_template_concepts_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_template_concepts_is_active ON public.payroll_template_concepts USING btree (is_active);


--
-- Name: payroll_template_concepts_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_template_concepts_template_id ON public.payroll_template_concepts USING btree (template_id);


--
-- Name: payroll_templates_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_templates_company_id ON public.payroll_templates USING btree (company_id);


--
-- Name: payroll_templates_company_id_template_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX payroll_templates_company_id_template_code ON public.payroll_templates USING btree (company_id, template_code);


--
-- Name: payroll_templates_country_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_templates_country_id ON public.payroll_templates USING btree (country_id);


--
-- Name: payroll_templates_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_templates_is_active ON public.payroll_templates USING btree (is_active);


--
-- Name: payroll_templates_labor_agreement_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX payroll_templates_labor_agreement_id ON public.payroll_templates USING btree (labor_agreement_id);


--
-- Name: permissions__user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX permissions__user_id ON public.permissions USING btree ("UserId");


--
-- Name: permissions_end_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX permissions_end_date ON public.permissions USING btree ("endDate");


--
-- Name: permissions_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX permissions_start_date ON public.permissions USING btree ("startDate");


--
-- Name: permissions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX permissions_status ON public.permissions USING btree (status);


--
-- Name: permissions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX permissions_type ON public.permissions USING btree (type);


--
-- Name: sectors_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX sectors_company_id ON public.sectors USING btree (company_id);


--
-- Name: sectors_company_id_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX sectors_company_id_is_active ON public.sectors USING btree (company_id, is_active);


--
-- Name: sectors_department_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX sectors_department_id ON public.sectors USING btree (department_id);


--
-- Name: sectors_department_id_name; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX sectors_department_id_name ON public.sectors USING btree (department_id, name) WHERE (is_active = true);


--
-- Name: sectors_supervisor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX sectors_supervisor_id ON public.sectors USING btree (supervisor_id);


--
-- Name: shifts_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_company_id ON public.shifts USING btree (company_id);


--
-- Name: shifts_cycle_start_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_cycle_start_date ON public.shifts USING btree ("cycleStartDate");


--
-- Name: shifts_flash_start_date_flash_end_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_flash_start_date_flash_end_date ON public.shifts USING btree ("flashStartDate", "flashEndDate");


--
-- Name: shifts_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_is_active ON public.shifts USING btree ("isActive");


--
-- Name: shifts_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_name ON public.shifts USING btree (name);


--
-- Name: shifts_shift_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX shifts_shift_type ON public.shifts USING btree ("shiftType");


--
-- Name: support_activity_log_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_activity_log_company_id ON public.support_activity_log USING btree (company_id);


--
-- Name: support_activity_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_activity_log_created_at ON public.support_activity_log USING btree (created_at);


--
-- Name: support_activity_log_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_activity_log_session_id ON public.support_activity_log USING btree (session_id);


--
-- Name: support_activity_log_support_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_activity_log_support_user_id ON public.support_activity_log USING btree (support_user_id);


--
-- Name: support_activity_log_ticket_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_activity_log_ticket_id ON public.support_activity_log USING btree (ticket_id);


--
-- Name: support_assistant_attempts_assistant_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_assistant_attempts_assistant_type ON public.support_assistant_attempts USING btree (assistant_type);


--
-- Name: support_assistant_attempts_attempted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_assistant_attempts_attempted_at ON public.support_assistant_attempts USING btree (attempted_at);


--
-- Name: support_assistant_attempts_ticket_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_assistant_attempts_ticket_id ON public.support_assistant_attempts USING btree (ticket_id);


--
-- Name: support_assistant_attempts_user_satisfied; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_assistant_attempts_user_satisfied ON public.support_assistant_attempts USING btree (user_satisfied);


--
-- Name: support_escalations_escalated_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_escalations_escalated_at ON public.support_escalations USING btree (escalated_at);


--
-- Name: support_escalations_escalated_from_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_escalations_escalated_from_user_id ON public.support_escalations USING btree (escalated_from_user_id);


--
-- Name: support_escalations_escalated_to_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_escalations_escalated_to_user_id ON public.support_escalations USING btree (escalated_to_user_id);


--
-- Name: support_escalations_ticket_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_escalations_ticket_id ON public.support_escalations USING btree (ticket_id);


--
-- Name: support_sla_plans_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_sla_plans_is_active ON public.support_sla_plans USING btree (is_active);


--
-- Name: support_ticket_messages_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_ticket_messages_created_at ON public.support_ticket_messages USING btree (created_at);


--
-- Name: support_ticket_messages_ticket_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_ticket_messages_ticket_id ON public.support_ticket_messages USING btree (ticket_id);


--
-- Name: support_tickets_assigned_to_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_assigned_to_vendor_id ON public.support_tickets USING btree (assigned_to_vendor_id);


--
-- Name: support_tickets_assistant_attempted; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_assistant_attempted ON public.support_tickets USING btree (assistant_attempted);


--
-- Name: support_tickets_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_company_id ON public.support_tickets USING btree (company_id);


--
-- Name: support_tickets_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_created_at ON public.support_tickets USING btree (created_at);


--
-- Name: support_tickets_created_by_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_created_by_user_id ON public.support_tickets USING btree (created_by_user_id);


--
-- Name: support_tickets_escalated_to_supervisor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_escalated_to_supervisor_id ON public.support_tickets USING btree (escalated_to_supervisor_id);


--
-- Name: support_tickets_sla_escalation_deadline; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_sla_escalation_deadline ON public.support_tickets USING btree (sla_escalation_deadline);


--
-- Name: support_tickets_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_tickets_status ON public.support_tickets USING btree (status);


--
-- Name: support_vendor_stats_period_start_period_end; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_vendor_stats_period_start_period_end ON public.support_vendor_stats USING btree (period_start, period_end);


--
-- Name: support_vendor_stats_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_vendor_stats_vendor_id ON public.support_vendor_stats USING btree (vendor_id);


--
-- Name: support_vendor_supervisors_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_vendor_supervisors_is_active ON public.support_vendor_supervisors USING btree (is_active);


--
-- Name: support_vendor_supervisors_supervisor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_vendor_supervisors_supervisor_id ON public.support_vendor_supervisors USING btree (supervisor_id);


--
-- Name: support_vendor_supervisors_vendor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX support_vendor_supervisors_vendor_id ON public.support_vendor_supervisors USING btree (vendor_id);


--
-- Name: system_modules_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX system_modules_category ON public.system_modules USING btree (category);


--
-- Name: system_modules_display_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX system_modules_display_order ON public.system_modules USING btree (display_order);


--
-- Name: system_modules_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX system_modules_is_active ON public.system_modules USING btree (is_active);


--
-- Name: system_modules_is_core; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX system_modules_is_core ON public.system_modules USING btree (is_core);


--
-- Name: system_modules_module_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX system_modules_module_key ON public.system_modules USING btree (module_key);


--
-- Name: test_executions_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_company_id ON public.test_executions USING btree (company_id);


--
-- Name: test_executions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_created_at ON public.test_executions USING btree (created_at);


--
-- Name: test_executions_environment; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_environment ON public.test_executions USING btree (environment);


--
-- Name: test_executions_execution_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_execution_id ON public.test_executions USING btree (execution_id);


--
-- Name: test_executions_module; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_module ON public.test_executions USING btree (module);


--
-- Name: test_executions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX test_executions_status ON public.test_executions USING btree (status);


--
-- Name: training_assignments_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX training_assignments_company_id ON public.training_assignments USING btree (company_id);


--
-- Name: training_assignments_company_id_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX training_assignments_company_id_status ON public.training_assignments USING btree (company_id, status);


--
-- Name: training_assignments_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX training_assignments_status ON public.training_assignments USING btree (status);


--
-- Name: training_assignments_training_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX training_assignments_training_id ON public.training_assignments USING btree (training_id);


--
-- Name: training_assignments_training_id_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX training_assignments_training_id_user_id ON public.training_assignments USING btree (training_id, user_id);


--
-- Name: training_assignments_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX training_assignments_user_id ON public.training_assignments USING btree (user_id);


--
-- Name: trainings_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX trainings_company_id ON public.trainings USING btree (company_id);


--
-- Name: unique_company_template_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_company_template_key ON public.notification_templates USING btree (company_id, template_key);


--
-- Name: unique_company_workflow_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_company_workflow_key ON public.notification_workflows USING btree (company_id, workflow_key);


--
-- Name: unique_user_company_module; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_user_company_module ON public.user_notification_preferences USING btree (user_id, company_id, module);


--
-- Name: unique_vendor_period; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_vendor_period ON public.support_vendor_stats USING btree (vendor_id, period_start, period_end);


--
-- Name: unique_vendor_supervisor; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_vendor_supervisor ON public.support_vendor_supervisors USING btree (vendor_id, supervisor_id);


--
-- Name: user_audit_logs_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_action ON public.user_audit_logs USING btree (action);


--
-- Name: user_audit_logs_changed_by_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_changed_by_user_id ON public.user_audit_logs USING btree (changed_by_user_id);


--
-- Name: user_audit_logs_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_company_id ON public.user_audit_logs USING btree (company_id);


--
-- Name: user_audit_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_created_at ON public.user_audit_logs USING btree (created_at);


--
-- Name: user_audit_logs_field_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_field_name ON public.user_audit_logs USING btree (field_name);


--
-- Name: user_audit_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_audit_logs_user_id ON public.user_audit_logs USING btree (user_id);


--
-- Name: user_consents_accepted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_accepted_at ON public.user_consents USING btree (accepted_at);


--
-- Name: user_consents_consent_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_consent_id ON public.user_consents USING btree (consent_id);


--
-- Name: user_consents_rejected_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_rejected_at ON public.user_consents USING btree (rejected_at);


--
-- Name: user_consents_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_status ON public.user_consents USING btree (status);


--
-- Name: user_consents_user_id_consent_id_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_user_id_consent_id_status ON public.user_consents USING btree (user_id, consent_id, status);


--
-- Name: user_consents_user_id_user_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_consents_user_id_user_type ON public.user_consents USING btree (user_id, user_type);


--
-- Name: user_payroll_assignment_branch_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_assignment_branch_id ON public.user_payroll_assignment USING btree (branch_id);


--
-- Name: user_payroll_assignment_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_assignment_category_id ON public.user_payroll_assignment USING btree (category_id);


--
-- Name: user_payroll_assignment_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_assignment_template_id ON public.user_payroll_assignment USING btree (template_id);


--
-- Name: user_payroll_assignment_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_assignment_user_id ON public.user_payroll_assignment USING btree (user_id);


--
-- Name: user_payroll_bonuses_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_bonuses_company_id ON public.user_payroll_bonuses USING btree (company_id);


--
-- Name: user_payroll_bonuses_frequency; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_bonuses_frequency ON public.user_payroll_bonuses USING btree (frequency);


--
-- Name: user_payroll_bonuses_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_bonuses_is_active ON public.user_payroll_bonuses USING btree (is_active);


--
-- Name: user_payroll_bonuses_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_bonuses_user_id ON public.user_payroll_bonuses USING btree (user_id);


--
-- Name: user_payroll_bonuses_user_id_effective_from; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_bonuses_user_id_effective_from ON public.user_payroll_bonuses USING btree (user_id, effective_from);


--
-- Name: user_payroll_concept_overrides_assignment_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_payroll_concept_overrides_assignment_id ON public.user_payroll_concept_overrides USING btree (assignment_id);


--
-- Name: users_dni; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX users_dni ON public.users USING btree (dni);


--
-- Name: users_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX users_email ON public.users USING btree (email);


--
-- Name: users_employee_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX users_employee_id ON public.users USING btree ("employeeId");


--
-- Name: users_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX users_role ON public.users USING btree (role);


--
-- Name: vendor_commissions_commission_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX vendor_commissions_commission_type ON public.vendor_commissions USING btree (commission_type);


--
-- Name: vendor_commissions_company_id_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX vendor_commissions_company_id_is_active ON public.vendor_commissions USING btree (company_id, is_active);


--
-- Name: vendor_commissions_vendor_id_company_id_commission_type; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX vendor_commissions_vendor_id_company_id_commission_type ON public.vendor_commissions USING btree (vendor_id, company_id, commission_type);


--
-- Name: vendor_commissions_vendor_id_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX vendor_commissions_vendor_id_is_active ON public.vendor_commissions USING btree (vendor_id, is_active);


--
-- Name: visitor_gps_tracking_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitor_gps_tracking_company_id ON public.visitor_gps_tracking USING btree (company_id);


--
-- Name: visitor_gps_tracking_is_inside_facility; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitor_gps_tracking_is_inside_facility ON public.visitor_gps_tracking USING btree (is_inside_facility);


--
-- Name: visitor_gps_tracking_recorded_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitor_gps_tracking_recorded_at ON public.visitor_gps_tracking USING btree (recorded_at);


--
-- Name: visitor_gps_tracking_visitor_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitor_gps_tracking_visitor_id ON public.visitor_gps_tracking USING btree (visitor_id);


--
-- Name: visitors_authorization_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_authorization_status ON public.visitors USING btree (authorization_status);


--
-- Name: visitors_check_in; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_check_in ON public.visitors USING btree (check_in);


--
-- Name: visitors_check_out; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_check_out ON public.visitors USING btree (check_out);


--
-- Name: visitors_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_company_id ON public.visitors USING btree (company_id);


--
-- Name: visitors_dni_company_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_dni_company_id ON public.visitors USING btree (dni, company_id);


--
-- Name: visitors_responsible_employee_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_responsible_employee_id ON public.visitors USING btree (responsible_employee_id);


--
-- Name: visitors_scheduled_visit_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_scheduled_visit_date ON public.visitors USING btree (scheduled_visit_date);


--
-- Name: visitors_unique_keyring_id; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX visitors_unique_keyring_id ON public.visitors USING btree (keyring_id) WHERE ((deleted_at IS NULL) AND (keyring_id IS NOT NULL));


--
-- Name: visitors_visiting_department_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX visitors_visiting_department_id ON public.visitors USING btree (visiting_department_id);


--
-- Name: biometric_alerts_p0_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p0_pkey;


--
-- Name: biometric_alerts_p10_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p10_pkey;


--
-- Name: biometric_alerts_p11_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p11_pkey;


--
-- Name: biometric_alerts_p12_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p12_pkey;


--
-- Name: biometric_alerts_p13_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p13_pkey;


--
-- Name: biometric_alerts_p14_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p14_pkey;


--
-- Name: biometric_alerts_p15_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p15_pkey;


--
-- Name: biometric_alerts_p1_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p1_pkey;


--
-- Name: biometric_alerts_p2_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p2_pkey;


--
-- Name: biometric_alerts_p3_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p3_pkey;


--
-- Name: biometric_alerts_p4_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p4_pkey;


--
-- Name: biometric_alerts_p5_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p5_pkey;


--
-- Name: biometric_alerts_p6_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p6_pkey;


--
-- Name: biometric_alerts_p7_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p7_pkey;


--
-- Name: biometric_alerts_p8_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p8_pkey;


--
-- Name: biometric_alerts_p9_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_alerts ATTACH PARTITION biometric_partitions.biometric_alerts_p9_pkey;


--
-- Name: biometric_scans_p0_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p0_pkey;


--
-- Name: biometric_scans_p10_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p10_pkey;


--
-- Name: biometric_scans_p11_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p11_pkey;


--
-- Name: biometric_scans_p12_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p12_pkey;


--
-- Name: biometric_scans_p13_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p13_pkey;


--
-- Name: biometric_scans_p14_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p14_pkey;


--
-- Name: biometric_scans_p15_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p15_pkey;


--
-- Name: biometric_scans_p1_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p1_pkey;


--
-- Name: biometric_scans_p2_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p2_pkey;


--
-- Name: biometric_scans_p3_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p3_pkey;


--
-- Name: biometric_scans_p4_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p4_pkey;


--
-- Name: biometric_scans_p5_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p5_pkey;


--
-- Name: biometric_scans_p6_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p6_pkey;


--
-- Name: biometric_scans_p7_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p7_pkey;


--
-- Name: biometric_scans_p8_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p8_pkey;


--
-- Name: biometric_scans_p9_pkey; Type: INDEX ATTACH; Schema: biometric_partitions; Owner: -
--

ALTER INDEX public.pk_biometric_scans ATTACH PARTITION biometric_partitions.biometric_scans_p9_pkey;


--
-- Name: v_active_kiosks _RETURN; Type: RULE; Schema: public; Owner: -
--

CREATE OR REPLACE VIEW public.v_active_kiosks AS
 SELECT k.id,
    k.name,
    k.description,
    k.device_id,
    k.gps_lat,
    k.gps_lng,
    k.is_configured,
    k.company_id,
    c.name AS company_name,
    c.slug AS company_slug,
    k.created_at,
    count(DISTINCT a.id) AS total_attendances
   FROM ((public.kiosks k
     JOIN public.companies c ON ((k.company_id = c.company_id)))
     LEFT JOIN public.attendances a ON ((a.kiosk_id = k.id)))
  WHERE ((k.is_active = true) AND (k.deleted_at IS NULL))
  GROUP BY k.id, c.name, c.slug;


--
-- Name: administrative_tasks admin_tasks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER admin_tasks_updated_at BEFORE UPDATE ON public.administrative_tasks FOR EACH ROW EXECUTE FUNCTION public.update_admin_tasks_timestamp();


--
-- Name: budgets budgets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER budgets_updated_at BEFORE UPDATE ON public.budgets FOR EACH ROW EXECUTE FUNCTION public.update_budgets_timestamp();


--
-- Name: commission_liquidations comm_liq_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER comm_liq_updated_at BEFORE UPDATE ON public.commission_liquidations FOR EACH ROW EXECUTE FUNCTION public.update_comm_liq_timestamp();


--
-- Name: commission_payments comm_pay_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER comm_pay_updated_at BEFORE UPDATE ON public.commission_payments FOR EACH ROW EXECUTE FUNCTION public.update_comm_pay_timestamp();


--
-- Name: companies companies_validate_modules_trial; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER companies_validate_modules_trial BEFORE INSERT OR UPDATE OF modules_trial ON public.companies FOR EACH ROW EXECUTE FUNCTION public.validate_modules_trial_structure();


--
-- Name: contracts contracts_auto_hash; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER contracts_auto_hash BEFORE UPDATE ON public.contracts FOR EACH ROW EXECUTE FUNCTION public.auto_generate_signature_hash();


--
-- Name: contracts contracts_set_renewal_alert; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER contracts_set_renewal_alert BEFORE INSERT OR UPDATE OF end_date, status ON public.contracts FOR EACH ROW EXECUTE FUNCTION public.calculate_renewal_alert_date();


--
-- Name: contracts contracts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER contracts_updated_at BEFORE UPDATE ON public.contracts FOR EACH ROW EXECUTE FUNCTION public.update_contracts_timestamp();


--
-- Name: siac_clientes siac_clientes_before_insert_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER siac_clientes_before_insert_trigger BEFORE INSERT ON public.siac_clientes FOR EACH ROW EXECUTE FUNCTION public.siac_clientes_before_insert();


--
-- Name: siac_productos siac_productos_calcular_precios_trigger; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER siac_productos_calcular_precios_trigger BEFORE INSERT OR UPDATE ON public.siac_productos FOR EACH ROW EXECUTE FUNCTION public.siac_productos_calcular_precios();


--
-- Name: testing_tickets testing_tickets_update_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER testing_tickets_update_timestamp BEFORE UPDATE ON public.testing_tickets FOR EACH ROW EXECUTE FUNCTION public.update_testing_tickets_timestamp();


--
-- Name: siac_facturas_impuestos tr_actualizar_totales_impuestos; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_actualizar_totales_impuestos AFTER INSERT OR DELETE OR UPDATE ON public.siac_facturas_impuestos FOR EACH ROW EXECUTE FUNCTION public.trigger_actualizar_totales_factura();


--
-- Name: siac_facturas_items tr_actualizar_totales_items; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_actualizar_totales_items AFTER INSERT OR DELETE OR UPDATE ON public.siac_facturas_items FOR EACH ROW EXECUTE FUNCTION public.trigger_actualizar_totales_factura();


--
-- Name: company_communications tr_company_comms_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_company_comms_updated BEFORE UPDATE ON public.company_communications FOR EACH ROW EXECUTE FUNCTION public.update_company_comms_timestamp();


--
-- Name: siac_facturas tr_formatear_numero_factura; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_formatear_numero_factura BEFORE INSERT OR UPDATE ON public.siac_facturas FOR EACH ROW EXECUTE FUNCTION public.trigger_formatear_numero_factura();


--
-- Name: oh_claim_documents tr_oh_claim_docs_count; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_oh_claim_docs_count AFTER INSERT OR DELETE ON public.oh_claim_documents FOR EACH ROW EXECUTE FUNCTION public.update_claim_documents_count();


--
-- Name: oh_workers_compensation_claims tr_oh_claim_status_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER tr_oh_claim_status_change AFTER UPDATE ON public.oh_workers_compensation_claims FOR EACH ROW EXECUTE FUNCTION public.log_claim_status_change();


--
-- Name: aponnt_associates trg_aponnt_associates_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_aponnt_associates_updated_at BEFORE UPDATE ON public.aponnt_associates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();


--
-- Name: attendance_patterns trg_attendance_patterns_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_attendance_patterns_updated_at BEFORE UPDATE ON public.attendance_patterns FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: attendance_profiles trg_attendance_profiles_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_attendance_profiles_updated_at BEFORE UPDATE ON public.attendance_profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: medical_records trg_audit_medical_records; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_audit_medical_records AFTER INSERT OR UPDATE ON public.medical_records FOR EACH ROW EXECUTE FUNCTION public.audit_medical_record_changes();


--
-- Name: asset_contracts trg_auto_assign_contract_template; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_auto_assign_contract_template BEFORE INSERT ON public.asset_contracts FOR EACH ROW EXECUTE FUNCTION public.auto_assign_contract_template();


--
-- Name: TRIGGER trg_auto_assign_contract_template ON asset_contracts; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TRIGGER trg_auto_assign_contract_template ON public.asset_contracts IS 'Auto-asigna template de contrato segn pas del empleado';


--
-- Name: users trg_auto_create_user_salary_config; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_auto_create_user_salary_config AFTER INSERT OR UPDATE ON public.users FOR EACH ROW WHEN ((new.company_id IS NOT NULL)) EXECUTE FUNCTION public.fn_auto_create_user_salary_config();


--
-- Name: user_anthropometric_data trg_calculate_bmi; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_calculate_bmi BEFORE INSERT OR UPDATE ON public.user_anthropometric_data FOR EACH ROW EXECUTE FUNCTION public.calculate_bmi();


--
-- Name: epp_deliveries trg_calculate_epp_replacement; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_calculate_epp_replacement BEFORE INSERT ON public.epp_deliveries FOR EACH ROW EXECUTE FUNCTION public.calculate_epp_replacement_date();


--
-- Name: user_payroll_records trg_calculate_payroll; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_calculate_payroll BEFORE INSERT OR UPDATE ON public.user_payroll_records FOR EACH ROW EXECUTE FUNCTION public.calculate_payroll_totals();


--
-- Name: hour_bank_templates trg_check_unique_active_template; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_check_unique_active_template BEFORE INSERT OR UPDATE ON public.hour_bank_templates FOR EACH ROW EXECUTE FUNCTION public.check_unique_active_template_v2();


--
-- Name: users trg_check_user_shift; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_check_user_shift AFTER INSERT OR UPDATE OF "isActive" ON public.users FOR EACH ROW EXECUTE FUNCTION public.check_user_shift_on_activate();


--
-- Name: company_associate_contracts trg_company_associate_contracts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_company_associate_contracts_updated_at BEFORE UPDATE ON public.company_associate_contracts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();


--
-- Name: company_dependencies trg_company_dependencies_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_company_dependencies_updated BEFORE UPDATE ON public.company_dependencies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: concept_dependencies trg_concept_dependencies_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_concept_dependencies_updated BEFORE UPDATE ON public.concept_dependencies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: consent_definitions trg_consent_definitions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_consent_definitions_updated_at BEFORE UPDATE ON public.consent_definitions FOR EACH ROW EXECUTE FUNCTION public.update_consent_definitions_timestamp();


--
-- Name: contextual_help trg_contextual_help_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_contextual_help_updated_at BEFORE UPDATE ON public.contextual_help FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();


--
-- Name: hour_bank_redemption_requests trg_create_scheduled_redemption; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_create_scheduled_redemption AFTER UPDATE ON public.hour_bank_redemption_requests FOR EACH ROW EXECUTE FUNCTION public.create_scheduled_redemption();


--
-- Name: sanctions trg_create_suspension_block; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_create_suspension_block BEFORE UPDATE ON public.sanctions FOR EACH ROW EXECUTE FUNCTION public.create_suspension_block_on_activate();


--
-- Name: legal_case_documents trg_document_edit_window; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_document_edit_window BEFORE INSERT ON public.legal_case_documents FOR EACH ROW EXECUTE FUNCTION public.set_document_edit_window();


--
-- Name: employee_dependency_documents trg_emp_dep_docs_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_emp_dep_docs_updated BEFORE UPDATE ON public.employee_dependency_documents FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_salary_config_v2 trg_flag_payroll_recalculation; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_flag_payroll_recalculation AFTER UPDATE ON public.user_salary_config_v2 FOR EACH ROW WHEN ((old.base_salary IS DISTINCT FROM new.base_salary)) EXECUTE FUNCTION public.fn_flag_payroll_recalculation();


--
-- Name: hse_cases trg_hse_case_number; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_hse_case_number BEFORE INSERT ON public.hse_cases FOR EACH ROW WHEN ((new.case_number IS NULL)) EXECUTE FUNCTION public.generate_hse_case_number();


--
-- Name: legal_edit_authorizations trg_legal_auth_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_legal_auth_updated_at BEFORE UPDATE ON public.legal_edit_authorizations FOR EACH ROW EXECUTE FUNCTION public.update_legal_auth_updated_at();


--
-- Name: legal_cases trg_legal_case_number; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_legal_case_number BEFORE INSERT ON public.legal_cases FOR EACH ROW EXECUTE FUNCTION public.generate_legal_case_number();


--
-- Name: legal_cases trg_legal_cases_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_legal_cases_updated_at BEFORE UPDATE ON public.legal_cases FOR EACH ROW EXECUTE FUNCTION public.update_legal_cases_updated_at();


--
-- Name: legal_cases trg_legal_stage_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_legal_stage_change AFTER UPDATE ON public.legal_cases FOR EACH ROW EXECUTE FUNCTION public.log_legal_stage_change();


--
-- Name: user_consents trg_log_consent_changes; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_log_consent_changes AFTER INSERT OR UPDATE ON public.user_consents FOR EACH ROW EXECUTE FUNCTION public.log_consent_changes();


--
-- Name: job_applications trg_log_status_change; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_log_status_change BEFORE UPDATE ON public.job_applications FOR EACH ROW EXECUTE FUNCTION public.log_application_status_change();


--
-- Name: medical_edit_authorizations trg_medical_authorizations_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_medical_authorizations_updated BEFORE UPDATE ON public.medical_edit_authorizations FOR EACH ROW EXECUTE FUNCTION public.update_medical_updated_at();


--
-- Name: medical_records trg_medical_record_editable_until; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_medical_record_editable_until BEFORE INSERT ON public.medical_records FOR EACH ROW EXECUTE FUNCTION public.set_medical_record_editable_until();


--
-- Name: medical_records trg_medical_record_expiration; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_medical_record_expiration BEFORE INSERT OR UPDATE ON public.medical_records FOR EACH ROW EXECUTE FUNCTION public.set_medical_record_expiration();


--
-- Name: medical_records trg_medical_records_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_medical_records_updated BEFORE UPDATE ON public.medical_records FOR EACH ROW EXECUTE FUNCTION public.update_medical_updated_at();


--
-- Name: medical_exam_templates trg_medical_templates_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_medical_templates_updated BEFORE UPDATE ON public.medical_exam_templates FOR EACH ROW EXECUTE FUNCTION public.update_medical_updated_at();


--
-- Name: module_definitions trg_module_definitions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_module_definitions_updated_at BEFORE UPDATE ON public.module_definitions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();


--
-- Name: unified_notifications trg_notif_thread_counters; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_notif_thread_counters AFTER INSERT OR UPDATE ON public.unified_notifications FOR EACH ROW WHEN ((new.thread_id IS NOT NULL)) EXECUTE FUNCTION public.update_thread_counters();


--
-- Name: employee_benefits trg_notify_benefit_approved; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_notify_benefit_approved AFTER UPDATE ON public.employee_benefits FOR EACH ROW WHEN (((new.status)::text IS DISTINCT FROM (old.status)::text)) EXECUTE FUNCTION public.notify_benefit_approved();


--
-- Name: TRIGGER trg_notify_benefit_approved ON employee_benefits; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TRIGGER trg_notify_benefit_approved ON public.employee_benefits IS 'Genera notificacin cuando un beneficio es aprobado';


--
-- Name: payroll_payslip_templates trg_payslip_template_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_payslip_template_updated BEFORE UPDATE ON public.payroll_payslip_templates FOR EACH ROW EXECUTE FUNCTION public.update_payslip_template_timestamp();


--
-- Name: attendances trg_prevent_duplicate_checkin; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_prevent_duplicate_checkin BEFORE INSERT OR UPDATE ON public.attendances FOR EACH ROW EXECUTE FUNCTION public.prevent_duplicate_checkin();


--
-- Name: procedures trg_procedure_initial_owner; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_procedure_initial_owner AFTER INSERT ON public.procedures FOR EACH ROW EXECUTE FUNCTION public.trigger_add_initial_owner();


--
-- Name: labor_agreements_v2 trg_propagate_agreement_multipliers; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_propagate_agreement_multipliers AFTER UPDATE ON public.labor_agreements_v2 FOR EACH ROW EXECUTE FUNCTION public.fn_propagate_agreement_multipliers();


--
-- Name: salary_categories trg_propagate_salary_category; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_propagate_salary_category AFTER UPDATE ON public.salary_categories FOR EACH ROW EXECUTE FUNCTION public.fn_propagate_salary_category_changes();


--
-- Name: salary_categories_v2 trg_propagate_salary_category_v2; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_propagate_salary_category_v2 AFTER UPDATE ON public.salary_categories_v2 FOR EACH ROW EXECUTE FUNCTION public.fn_propagate_salary_category_v2_changes();


--
-- Name: hour_bank_redemption_requests trg_redemption_status_log; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_redemption_status_log AFTER UPDATE ON public.hour_bank_redemption_requests FOR EACH ROW EXECUTE FUNCTION public.log_redemption_status_change();


--
-- Name: role_definitions trg_role_definitions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_role_definitions_updated_at BEFORE UPDATE ON public.role_definitions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at();


--
-- Name: sanction_types trg_sanction_types_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_sanction_types_updated_at BEFORE UPDATE ON public.sanction_types FOR EACH ROW EXECUTE FUNCTION public.update_sanction_types_updated_at();


--
-- Name: oh_pre_employment_screenings trg_screening_expiration_check; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_screening_expiration_check BEFORE UPDATE ON public.oh_pre_employment_screenings FOR EACH ROW WHEN ((new.valid_until IS NOT NULL)) EXECUTE FUNCTION public.check_screening_expiration();


--
-- Name: suspension_blocks trg_suspension_blocks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_suspension_blocks_updated_at BEFORE UPDATE ON public.suspension_blocks FOR EACH ROW EXECUTE FUNCTION public.update_suspension_blocks_updated_at();


--
-- Name: company_modules trg_sync_active_modules; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_sync_active_modules AFTER INSERT OR DELETE OR UPDATE ON public.company_modules FOR EACH ROW EXECUTE FUNCTION public.sync_active_modules_from_company_modules();


--
-- Name: users trg_sync_user_position; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_sync_user_position AFTER UPDATE OF organizational_position_id ON public.users FOR EACH ROW EXECUTE FUNCTION public.sync_user_position_name();


--
-- Name: notification_threads trg_threads_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_threads_updated BEFORE UPDATE ON public.notification_threads FOR EACH ROW EXECUTE FUNCTION public.update_notification_updated_at();


--
-- Name: unified_notifications trg_unified_notif_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_unified_notif_updated BEFORE UPDATE ON public.unified_notifications FOR EACH ROW EXECUTE FUNCTION public.update_notification_updated_at();


--
-- Name: benefit_expense_submissions trg_update_allowance_consumption; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_allowance_consumption AFTER INSERT OR UPDATE ON public.benefit_expense_submissions FOR EACH ROW EXECUTE FUNCTION public.update_allowance_consumption();


--
-- Name: TRIGGER trg_update_allowance_consumption ON benefit_expense_submissions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TRIGGER trg_update_allowance_consumption ON public.benefit_expense_submissions IS 'Actualiza consumo de allowance cuando se aprueba una rendicin';


--
-- Name: job_applications trg_update_applications_count; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_applications_count AFTER INSERT OR DELETE ON public.job_applications FOR EACH ROW EXECUTE FUNCTION public.update_job_posting_applications_count();


--
-- Name: employee_benefit_documents trg_update_benefit_docs_status; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_benefit_docs_status AFTER INSERT OR UPDATE ON public.employee_benefit_documents FOR EACH ROW EXECUTE FUNCTION public.update_benefit_documents_status();


--
-- Name: TRIGGER trg_update_benefit_docs_status ON employee_benefit_documents; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TRIGGER trg_update_benefit_docs_status ON public.employee_benefit_documents IS 'Actualiza estado de documentacin del beneficio';


--
-- Name: hour_bank_transactions trg_update_budget_on_transaction; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_budget_on_transaction AFTER INSERT ON public.hour_bank_transactions FOR EACH ROW EXECUTE FUNCTION public.update_budget_on_accrual();


--
-- Name: partner_commission_transactions trg_update_commission_summary; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_commission_summary AFTER INSERT OR DELETE OR UPDATE ON public.partner_commission_transactions FOR EACH ROW EXECUTE FUNCTION public.trigger_update_commission_summary();


--
-- Name: oh_screening_documents trg_update_documents_count; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_documents_count AFTER INSERT OR DELETE OR UPDATE ON public.oh_screening_documents FOR EACH ROW EXECUTE FUNCTION public.update_screening_documents_count();


--
-- Name: notification_messages trg_update_group_activity; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_group_activity AFTER INSERT OR UPDATE ON public.notification_messages FOR EACH ROW EXECUTE FUNCTION public.update_group_last_activity();


--
-- Name: user_household_members trg_update_household_size; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_household_size AFTER INSERT OR DELETE OR UPDATE ON public.user_household_members FOR EACH ROW EXECUTE FUNCTION public.update_household_size();


--
-- Name: procedures trg_update_procedure_path; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_procedure_path AFTER INSERT ON public.procedures FOR EACH ROW EXECUTE FUNCTION public.update_procedure_hierarchy_path();


--
-- Name: notification_learned_responses trg_update_response_confidence; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_response_confidence BEFORE UPDATE ON public.notification_learned_responses FOR EACH ROW WHEN (((old.times_suggested IS DISTINCT FROM new.times_suggested) OR (old.times_accepted IS DISTINCT FROM new.times_accepted) OR (old.times_rejected IS DISTINCT FROM new.times_rejected) OR (old.is_verified IS DISTINCT FROM new.is_verified))) EXECUTE FUNCTION public.update_response_confidence();


--
-- Name: unified_notifications trg_update_thread_unread; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_update_thread_unread AFTER INSERT OR UPDATE OF is_read ON public.unified_notifications FOR EACH ROW WHEN ((new.thread_id IS NOT NULL)) EXECUTE FUNCTION public.update_thread_unread_count();


--
-- Name: users trg_user_branch_change_consent; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_user_branch_change_consent AFTER UPDATE OF branch_id, default_branch_id ON public.users FOR EACH ROW EXECUTE FUNCTION public.fn_handle_user_branch_change();


--
-- Name: user_consents trg_user_consents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_user_consents_updated_at BEFORE UPDATE ON public.user_consents FOR EACH ROW EXECUTE FUNCTION public.update_user_consents_timestamp();


--
-- Name: notifications trg_validate_notification_recipient; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_validate_notification_recipient BEFORE INSERT OR UPDATE ON public.notifications FOR EACH ROW EXECUTE FUNCTION public.validate_notification_recipient();


--
-- Name: procedures trg_validate_procedure_hierarchy; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_validate_procedure_hierarchy BEFORE INSERT OR UPDATE ON public.procedures FOR EACH ROW EXECUTE FUNCTION public.validate_procedure_hierarchy();


--
-- Name: vacation_requests trg_validate_vacation_balance; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trg_validate_vacation_balance BEFORE INSERT OR UPDATE ON public.vacation_requests FOR EACH ROW EXECUTE FUNCTION public.validate_vacation_balance();


--
-- Name: aponnt_admin_tasks trigger_admin_tasks_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_admin_tasks_updated BEFORE UPDATE ON public.aponnt_admin_tasks FOR EACH ROW EXECUTE FUNCTION public.update_aponnt_tables_timestamp();


--
-- Name: assistant_knowledge_base trigger_assistant_knowledge_base_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_assistant_knowledge_base_updated_at BEFORE UPDATE ON public.assistant_knowledge_base FOR EACH ROW EXECUTE FUNCTION public.update_assistant_knowledge_base_updated_at();


--
-- Name: partners trigger_auto_assign_partner_username; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_auto_assign_partner_username BEFORE UPDATE ON public.partners FOR EACH ROW WHEN (((new.approval_status)::text IS DISTINCT FROM (old.approval_status)::text)) EXECUTE FUNCTION public.auto_assign_partner_username();


--
-- Name: siac_clientes trigger_calculate_credito; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_calculate_credito BEFORE INSERT OR UPDATE OF credito_maximo, credito_utilizado ON public.siac_clientes FOR EACH ROW EXECUTE FUNCTION public.calculate_credito_disponible();


--
-- Name: company_tax_config trigger_company_tax_config_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_company_tax_config_updated_at BEFORE UPDATE ON public.company_tax_config FOR EACH ROW EXECUTE FUNCTION public.update_tax_updated_at();


--
-- Name: aponnt_email_config trigger_email_config_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_email_config_updated BEFORE UPDATE ON public.aponnt_email_config FOR EACH ROW EXECUTE FUNCTION public.update_aponnt_tables_timestamp();


--
-- Name: support_tickets trigger_expire_temp_password; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_expire_temp_password BEFORE UPDATE ON public.support_tickets FOR EACH ROW EXECUTE FUNCTION public.expire_temp_password_on_close();


--
-- Name: company_fiscal_config trigger_fiscal_config_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_fiscal_config_updated BEFORE UPDATE ON public.company_fiscal_config FOR EACH ROW EXECUTE FUNCTION public.update_fiscal_config_timestamp();


--
-- Name: legal_communication_types trigger_legal_comm_types_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_legal_comm_types_updated_at BEFORE UPDATE ON public.legal_communication_types FOR EACH ROW EXECUTE FUNCTION public.update_legal_communications_updated_at();


--
-- Name: aponnt_pre_invoices trigger_pre_invoices_updated; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_pre_invoices_updated BEFORE UPDATE ON public.aponnt_pre_invoices FOR EACH ROW EXECUTE FUNCTION public.update_aponnt_tables_timestamp();


--
-- Name: email_configurations trigger_reset_email_counters; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_reset_email_counters BEFORE UPDATE ON public.email_configurations FOR EACH ROW EXECUTE FUNCTION public.reset_email_counters();


--
-- Name: support_tickets trigger_set_ticket_sla_deadlines; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_set_ticket_sla_deadlines BEFORE INSERT ON public.support_tickets FOR EACH ROW EXECUTE FUNCTION public.set_ticket_sla_deadlines();


--
-- Name: users trigger_sync_user_email; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_sync_user_email AFTER INSERT OR UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.sync_user_email();


--
-- Name: tax_concepts trigger_tax_concepts_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_tax_concepts_updated_at BEFORE UPDATE ON public.tax_concepts FOR EACH ROW EXECUTE FUNCTION public.update_tax_updated_at();


--
-- Name: tax_templates trigger_tax_templates_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_tax_templates_updated_at BEFORE UPDATE ON public.tax_templates FOR EACH ROW EXECUTE FUNCTION public.update_tax_updated_at();


--
-- Name: absence_cases trigger_update_absence_cases_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_absence_cases_timestamp BEFORE UPDATE ON public.absence_cases FOR EACH ROW EXECUTE FUNCTION public.update_medical_timestamp();


--
-- Name: siac_configuracion_terminal trigger_update_configuracion_terminal_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_configuracion_terminal_updated_at BEFORE UPDATE ON public.siac_configuracion_terminal FOR EACH ROW EXECUTE FUNCTION public.update_sesiones_updated_at();


--
-- Name: email_configurations trigger_update_email_config_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_email_config_timestamp BEFORE UPDATE ON public.email_configurations FOR EACH ROW EXECUTE FUNCTION public.update_email_timestamp();


--
-- Name: kiosks trigger_update_kiosks_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_kiosks_timestamp BEFORE UPDATE ON public.kiosks FOR EACH ROW EXECUTE FUNCTION public.update_kiosks_timestamp();


--
-- Name: partners trigger_update_partners_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_partners_updated_at BEFORE UPDATE ON public.partners FOR EACH ROW EXECUTE FUNCTION public.update_partners_updated_at();


--
-- Name: siac_sesiones_locales trigger_update_sesiones_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_sesiones_updated_at BEFORE UPDATE ON public.siac_sesiones_locales FOR EACH ROW EXECUTE FUNCTION public.update_sesiones_updated_at();


--
-- Name: siac_presupuestos trigger_update_siac_presupuestos_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_siac_presupuestos_timestamp BEFORE UPDATE ON public.siac_presupuestos FOR EACH ROW EXECUTE FUNCTION public.update_siac_presupuestos_timestamp();


--
-- Name: aponnt_staff_companies trigger_update_staff_companies_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_staff_companies_updated_at BEFORE UPDATE ON public.aponnt_staff_companies FOR EACH ROW EXECUTE FUNCTION public.update_staff_companies_updated_at();


--
-- Name: test_executions trigger_update_test_executions_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_test_executions_timestamp BEFORE UPDATE ON public.test_executions FOR EACH ROW EXECUTE FUNCTION public.update_test_executions_timestamp();


--
-- Name: user_emails trigger_update_user_emails_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_user_emails_timestamp BEFORE UPDATE ON public.user_emails FOR EACH ROW EXECUTE FUNCTION public.update_email_timestamp();


--
-- Name: companies trigger_update_vendor_stats_on_company; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_update_vendor_stats_on_company AFTER INSERT OR UPDATE ON public.companies FOR EACH ROW EXECUTE FUNCTION public.update_vendor_statistics_on_company_change();


--
-- Name: email_configurations trigger_validate_email_config; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_validate_email_config BEFORE INSERT OR UPDATE ON public.email_configurations FOR EACH ROW EXECUTE FUNCTION public.validate_email_config();


--
-- Name: user_activity_restrictions update_activity_restrictions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_activity_restrictions_updated_at BEFORE UPDATE ON public.user_activity_restrictions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_allergies update_allergies_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_allergies_updated_at BEFORE UPDATE ON public.user_allergies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_assigned_tasks update_assigned_tasks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_assigned_tasks_updated_at BEFORE UPDATE ON public.user_assigned_tasks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: biometric_devices update_biometric_devices_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_biometric_devices_updated_at BEFORE UPDATE ON public.biometric_devices FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: biometric_settings update_biometric_settings_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_biometric_settings_updated_at BEFORE UPDATE ON public.biometric_settings FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_children update_children_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_children_updated_at BEFORE UPDATE ON public.user_children FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_chronic_conditions update_chronic_conditions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_chronic_conditions_updated_at BEFORE UPDATE ON public.user_chronic_conditions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: company_tasks update_company_tasks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_company_tasks_updated_at BEFORE UPDATE ON public.company_tasks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_disciplinary_actions update_disciplinary_actions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_disciplinary_actions_updated_at BEFORE UPDATE ON public.user_disciplinary_actions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_driver_licenses update_driver_licenses_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_driver_licenses_updated_at BEFORE UPDATE ON public.user_driver_licenses FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_education update_education_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_education_updated_at BEFORE UPDATE ON public.user_education FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: extraordinary_licenses update_extraordinary_licenses_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_extraordinary_licenses_timestamp BEFORE UPDATE ON public.extraordinary_licenses FOR EACH ROW EXECUTE FUNCTION public.update_vacation_timestamp();


--
-- Name: facial_biometric_data update_facial_biometric_data_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_facial_biometric_data_updated_at BEFORE UPDATE ON public.facial_biometric_data FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_family_members update_family_members_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_family_members_updated_at BEFORE UPDATE ON public.user_family_members FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: fingerprint_biometric_data update_fingerprint_biometric_data_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_fingerprint_biometric_data_updated_at BEFORE UPDATE ON public.fingerprint_biometric_data FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_legal_issues update_legal_issues_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_legal_issues_updated_at BEFORE UPDATE ON public.user_legal_issues FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_marital_status update_marital_status_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_marital_status_updated_at BEFORE UPDATE ON public.user_marital_status FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_medical_documents update_medical_documents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_medical_documents_updated_at BEFORE UPDATE ON public.user_medical_documents FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_medical_exams update_medical_exams_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_medical_exams_updated_at BEFORE UPDATE ON public.user_medical_exams FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_medications update_medications_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_medications_updated_at BEFORE UPDATE ON public.user_medications FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_permission_requests update_permission_requests_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_permission_requests_updated_at BEFORE UPDATE ON public.user_permission_requests FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_primary_physician update_primary_physician_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_primary_physician_updated_at BEFORE UPDATE ON public.user_primary_physician FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_professional_licenses update_professional_licenses_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_professional_licenses_updated_at BEFORE UPDATE ON public.user_professional_licenses FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_salary_config update_salary_config_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_salary_config_updated_at BEFORE UPDATE ON public.user_salary_config FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: support_sla_plans update_support_sla_plans_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_support_sla_plans_updated_at BEFORE UPDATE ON public.support_sla_plans FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: support_tickets update_support_tickets_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_support_tickets_updated_at BEFORE UPDATE ON public.support_tickets FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: task_compatibility update_task_compatibility_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_task_compatibility_timestamp BEFORE UPDATE ON public.task_compatibility FOR EACH ROW EXECUTE FUNCTION public.update_vacation_timestamp();


--
-- Name: user_union_affiliation update_union_affiliation_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_union_affiliation_updated_at BEFORE UPDATE ON public.user_union_affiliation FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_documents update_user_documents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_documents_updated_at BEFORE UPDATE ON public.user_documents FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: vacation_configurations update_vacation_configurations_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_vacation_configurations_timestamp BEFORE UPDATE ON public.vacation_configurations FOR EACH ROW EXECUTE FUNCTION public.update_vacation_timestamp();


--
-- Name: vacation_requests update_vacation_requests_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_vacation_requests_timestamp BEFORE UPDATE ON public.vacation_requests FOR EACH ROW EXECUTE FUNCTION public.update_vacation_timestamp();


--
-- Name: vacation_scales update_vacation_scales_timestamp; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_vacation_scales_timestamp BEFORE UPDATE ON public.vacation_scales FOR EACH ROW EXECUTE FUNCTION public.update_vacation_timestamp();


--
-- Name: user_vaccinations update_vaccinations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_vaccinations_updated_at BEFORE UPDATE ON public.user_vaccinations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_work_history update_work_history_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_work_history_updated_at BEFORE UPDATE ON public.user_work_history FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_work_restrictions update_work_restrictions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_work_restrictions_updated_at BEFORE UPDATE ON public.user_work_restrictions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: users users_core_immutable; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER users_core_immutable BEFORE UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.prevent_core_user_immutable_changes();


--
-- Name: users users_prevent_core_deletion; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER users_prevent_core_deletion BEFORE DELETE ON public.users FOR EACH ROW EXECUTE FUNCTION public.prevent_core_user_deletion();


--
-- Name: attendances validate_attendance_company; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER validate_attendance_company BEFORE INSERT OR UPDATE ON public.attendances FOR EACH ROW EXECUTE FUNCTION public.check_attendance_company();


--
-- Name: user_shift_assignments validate_shift_assignment_company; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER validate_shift_assignment_company BEFORE INSERT OR UPDATE ON public.user_shift_assignments FOR EACH ROW EXECUTE FUNCTION public.check_shift_assignment_company();


--
-- Name: users validate_user_department_company; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER validate_user_department_company BEFORE INSERT OR UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.check_user_department_company();


--
-- Name: UserShifts UserShifts_ShiftId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."UserShifts"
    ADD CONSTRAINT "UserShifts_ShiftId_fkey" FOREIGN KEY ("ShiftId") REFERENCES public.shifts(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: UserShifts UserShifts_UserUserId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."UserShifts"
    ADD CONSTRAINT "UserShifts_UserUserId_fkey" FOREIGN KEY ("UserUserId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: absence_cases absence_cases_assigned_doctor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_assigned_doctor_id_fkey FOREIGN KEY (assigned_doctor_id) REFERENCES public.partners(id);


--
-- Name: absence_cases absence_cases_certificate_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_certificate_id_fkey FOREIGN KEY (certificate_id) REFERENCES public.medical_certificates(id);


--
-- Name: absence_cases absence_cases_closed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_closed_by_fkey FOREIGN KEY (closed_by) REFERENCES public.users(user_id);


--
-- Name: absence_cases absence_cases_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: absence_cases absence_cases_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: absence_cases absence_cases_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: absence_cases absence_cases_last_modified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_last_modified_by_fkey FOREIGN KEY (last_modified_by) REFERENCES public.users(user_id);


--
-- Name: absence_cases absence_cases_notification_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.absence_cases
    ADD CONSTRAINT absence_cases_notification_group_id_fkey FOREIGN KEY (notification_group_id) REFERENCES public.notification_groups(id);


--
-- Name: access_audit_log access_audit_log_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_audit_log
    ADD CONSTRAINT access_audit_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: access_audit_log access_audit_log_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.access_audit_log
    ADD CONSTRAINT access_audit_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: additional_role_types additional_role_types_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.additional_role_types
    ADD CONSTRAINT additional_role_types_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: administrative_tasks administrative_tasks_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.aponnt_staff(staff_id) ON DELETE SET NULL;


--
-- Name: administrative_tasks administrative_tasks_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.aponnt_staff(staff_id) ON DELETE SET NULL;


--
-- Name: administrative_tasks administrative_tasks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: administrative_tasks administrative_tasks_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: administrative_tasks administrative_tasks_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.administrative_tasks
    ADD CONSTRAINT administrative_tasks_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.aponnt_staff(staff_id) ON DELETE SET NULL;


--
-- Name: afip_auth_log afip_auth_log_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_auth_log
    ADD CONSTRAINT afip_auth_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: afip_cae_log afip_cae_log_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log
    ADD CONSTRAINT afip_cae_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: afip_cae_log afip_cae_log_factura_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.afip_cae_log
    ADD CONSTRAINT afip_cae_log_factura_id_fkey FOREIGN KEY (factura_id) REFERENCES public.siac_facturas(id) ON DELETE SET NULL;


--
-- Name: aponnt_admin_tasks aponnt_admin_tasks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_admin_tasks
    ADD CONSTRAINT aponnt_admin_tasks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: aponnt_associates aponnt_associates_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_associates
    ADD CONSTRAINT aponnt_associates_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: aponnt_pre_invoices aponnt_pre_invoices_budget_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices
    ADD CONSTRAINT aponnt_pre_invoices_budget_id_fkey FOREIGN KEY (budget_id) REFERENCES public.budgets(id) ON DELETE SET NULL;


--
-- Name: aponnt_pre_invoices aponnt_pre_invoices_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices
    ADD CONSTRAINT aponnt_pre_invoices_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: aponnt_pre_invoices aponnt_pre_invoices_contract_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_pre_invoices
    ADD CONSTRAINT aponnt_pre_invoices_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id) ON DELETE SET NULL;


--
-- Name: aponnt_staff aponnt_staff_bank_data_verified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_bank_data_verified_by_fkey FOREIGN KEY (bank_data_verified_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: aponnt_staff_companies aponnt_staff_companies_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff_companies
    ADD CONSTRAINT aponnt_staff_companies_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: aponnt_staff aponnt_staff_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: aponnt_staff aponnt_staff_reports_to_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_reports_to_staff_id_fkey FOREIGN KEY (reports_to_staff_id) REFERENCES public.aponnt_staff(staff_id) ON DELETE SET NULL;


--
-- Name: aponnt_staff aponnt_staff_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.aponnt_staff_roles(role_id) ON DELETE RESTRICT;


--
-- Name: aponnt_staff aponnt_staff_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: aponnt_staff aponnt_staff_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.aponnt_staff
    ADD CONSTRAINT aponnt_staff_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: approved_shift_swaps approved_shift_swaps_notification_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.approved_shift_swaps
    ADD CONSTRAINT approved_shift_swaps_notification_group_id_fkey FOREIGN KEY (notification_group_id) REFERENCES public.notification_groups(id);


--
-- Name: asset_contracts asset_contracts_asset_assignment_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_asset_assignment_id_fkey FOREIGN KEY (asset_assignment_id) REFERENCES public.employee_assigned_assets(id) ON DELETE CASCADE;


--
-- Name: asset_contracts asset_contracts_company_signed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_company_signed_by_fkey FOREIGN KEY (company_signed_by) REFERENCES public.users(user_id);


--
-- Name: asset_contracts asset_contracts_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: asset_contracts asset_contracts_employee_signed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_employee_signed_by_fkey FOREIGN KEY (employee_signed_by) REFERENCES public.users(user_id);


--
-- Name: asset_contracts asset_contracts_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.asset_contracts
    ADD CONSTRAINT asset_contracts_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.contract_templates(id);


--
-- Name: assistant_conversations assistant_conversations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_conversations
    ADD CONSTRAINT assistant_conversations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: assistant_conversations assistant_conversations_knowledge_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_conversations
    ADD CONSTRAINT assistant_conversations_knowledge_entry_id_fkey FOREIGN KEY (knowledge_entry_id) REFERENCES public.assistant_knowledge_base(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- Name: assistant_conversations assistant_conversations_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_conversations
    ADD CONSTRAINT assistant_conversations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: assistant_knowledge_base assistant_knowledge_base_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_knowledge_base
    ADD CONSTRAINT assistant_knowledge_base_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: assistant_knowledge_base assistant_knowledge_base_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_knowledge_base
    ADD CONSTRAINT assistant_knowledge_base_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: assistant_knowledge_base assistant_knowledge_base_verified_by_admin_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.assistant_knowledge_base
    ADD CONSTRAINT assistant_knowledge_base_verified_by_admin_fkey FOREIGN KEY (verified_by_admin) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: associate_employee_assignments associate_employee_assignments_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(user_id);


--
-- Name: associate_employee_assignments associate_employee_assignments_contract_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.company_associate_contracts(id) ON DELETE CASCADE;


--
-- Name: associate_employee_assignments associate_employee_assignments_deactivated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_deactivated_by_fkey FOREIGN KEY (deactivated_by) REFERENCES public.users(user_id);


--
-- Name: associate_employee_assignments associate_employee_assignments_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.associate_employee_assignments
    ADD CONSTRAINT associate_employee_assignments_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: attendances attendances_BranchId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT "attendances_BranchId_fkey" FOREIGN KEY ("BranchId") REFERENCES public.branches(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- Name: attendances attendances_UserId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT "attendances_UserId_fkey" FOREIGN KEY ("UserId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: attendances attendances_authorized_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT attendances_authorized_by_user_id_fkey FOREIGN KEY (authorized_by_user_id) REFERENCES public.users(user_id);


--
-- Name: attendances attendances_kiosk_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendances
    ADD CONSTRAINT attendances_kiosk_id_fkey FOREIGN KEY (kiosk_id) REFERENCES public.kiosks(id) ON DELETE SET NULL;


--
-- Name: audit_test_logs audit_test_logs_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audit_test_logs
    ADD CONSTRAINT audit_test_logs_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: benefit_approval_history benefit_approval_history_approver_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_history
    ADD CONSTRAINT benefit_approval_history_approver_user_id_fkey FOREIGN KEY (approver_user_id) REFERENCES public.users(user_id);


--
-- Name: benefit_approval_history benefit_approval_history_employee_benefit_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_history
    ADD CONSTRAINT benefit_approval_history_employee_benefit_id_fkey FOREIGN KEY (employee_benefit_id) REFERENCES public.employee_benefits(id) ON DELETE CASCADE;


--
-- Name: benefit_approval_history benefit_approval_history_workflow_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_history
    ADD CONSTRAINT benefit_approval_history_workflow_id_fkey FOREIGN KEY (workflow_id) REFERENCES public.benefit_approval_workflows(id) ON DELETE RESTRICT;


--
-- Name: benefit_approval_workflows benefit_approval_workflows_approver_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows
    ADD CONSTRAINT benefit_approval_workflows_approver_user_id_fkey FOREIGN KEY (approver_user_id) REFERENCES public.users(user_id);


--
-- Name: benefit_approval_workflows benefit_approval_workflows_benefit_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows
    ADD CONSTRAINT benefit_approval_workflows_benefit_type_id_fkey FOREIGN KEY (benefit_type_id) REFERENCES public.benefit_types(id) ON DELETE CASCADE;


--
-- Name: benefit_approval_workflows benefit_approval_workflows_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_approval_workflows
    ADD CONSTRAINT benefit_approval_workflows_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: benefit_document_requirements benefit_document_requirements_benefit_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_document_requirements
    ADD CONSTRAINT benefit_document_requirements_benefit_type_id_fkey FOREIGN KEY (benefit_type_id) REFERENCES public.benefit_types(id) ON DELETE CASCADE;


--
-- Name: benefit_document_requirements benefit_document_requirements_document_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_document_requirements
    ADD CONSTRAINT benefit_document_requirements_document_type_id_fkey FOREIGN KEY (document_type_id) REFERENCES public.document_types(id) ON DELETE RESTRICT;


--
-- Name: benefit_expense_allowances benefit_expense_allowances_employee_benefit_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_allowances
    ADD CONSTRAINT benefit_expense_allowances_employee_benefit_id_fkey FOREIGN KEY (employee_benefit_id) REFERENCES public.employee_benefits(id) ON DELETE CASCADE;


--
-- Name: benefit_expense_submissions benefit_expense_submissions_allowance_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions
    ADD CONSTRAINT benefit_expense_submissions_allowance_id_fkey FOREIGN KEY (allowance_id) REFERENCES public.benefit_expense_allowances(id) ON DELETE CASCADE;


--
-- Name: benefit_expense_submissions benefit_expense_submissions_submitted_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions
    ADD CONSTRAINT benefit_expense_submissions_submitted_by_fkey FOREIGN KEY (submitted_by) REFERENCES public.users(user_id);


--
-- Name: benefit_expense_submissions benefit_expense_submissions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions
    ADD CONSTRAINT benefit_expense_submissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: benefit_expense_submissions benefit_expense_submissions_verified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_expense_submissions
    ADD CONSTRAINT benefit_expense_submissions_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(user_id);


--
-- Name: benefit_payroll_concepts benefit_payroll_concepts_benefit_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts
    ADD CONSTRAINT benefit_payroll_concepts_benefit_type_id_fkey FOREIGN KEY (benefit_type_id) REFERENCES public.benefit_types(id) ON DELETE CASCADE;


--
-- Name: benefit_payroll_concepts benefit_payroll_concepts_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts
    ADD CONSTRAINT benefit_payroll_concepts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: benefit_payroll_concepts benefit_payroll_concepts_payroll_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_payroll_concepts
    ADD CONSTRAINT benefit_payroll_concepts_payroll_concept_type_id_fkey FOREIGN KEY (payroll_concept_type_id) REFERENCES public.payroll_concept_types(id) ON DELETE RESTRICT;


--
-- Name: benefit_types benefit_types_payroll_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.benefit_types
    ADD CONSTRAINT benefit_types_payroll_concept_type_id_fkey FOREIGN KEY (payroll_concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: biometric_ai_analysis biometric_ai_analysis_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_ai_analysis
    ADD CONSTRAINT biometric_ai_analysis_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_ai_analysis biometric_ai_analysis_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_ai_analysis
    ADD CONSTRAINT biometric_ai_analysis_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: biometric_company_config biometric_company_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_company_config
    ADD CONSTRAINT biometric_company_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_consents biometric_consents_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: biometric_consents biometric_consents_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_consents biometric_consents_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: biometric_consents biometric_consents_previous_consent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_previous_consent_id_fkey FOREIGN KEY (previous_consent_id) REFERENCES public.biometric_consents(id);


--
-- Name: biometric_consents biometric_consents_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_consents
    ADD CONSTRAINT biometric_consents_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: biometric_data biometric_data_UserId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_data
    ADD CONSTRAINT "biometric_data_UserId_fkey" FOREIGN KEY ("UserId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: biometric_detections biometric_detections_attendance_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_detections
    ADD CONSTRAINT biometric_detections_attendance_id_fkey FOREIGN KEY (attendance_id) REFERENCES public.attendances(id);


--
-- Name: biometric_devices biometric_devices_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_devices
    ADD CONSTRAINT biometric_devices_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_devices biometric_devices_registered_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_devices
    ADD CONSTRAINT biometric_devices_registered_by_fkey FOREIGN KEY (registered_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: biometric_emotional_analysis biometric_emotional_analysis_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_emotional_analysis
    ADD CONSTRAINT biometric_emotional_analysis_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_emotional_analysis biometric_emotional_analysis_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_emotional_analysis
    ADD CONSTRAINT biometric_emotional_analysis_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: branch_offices_fiscal branch_offices_fiscal_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branch_offices_fiscal
    ADD CONSTRAINT branch_offices_fiscal_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: branches branches_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.branches
    ADD CONSTRAINT branches_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: budgets budgets_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: budgets budgets_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: budgets budgets_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budgets
    ADD CONSTRAINT budgets_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.aponnt_staff(staff_id) ON DELETE RESTRICT;


--
-- Name: calendar_events calendar_events_calendar_integration_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_events
    ADD CONSTRAINT calendar_events_calendar_integration_id_fkey FOREIGN KEY (calendar_integration_id) REFERENCES public.calendar_integrations(id);


--
-- Name: calendar_events calendar_events_notification_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.calendar_events
    ADD CONSTRAINT calendar_events_notification_group_id_fkey FOREIGN KEY (notification_group_id) REFERENCES public.notification_groups(id);


--
-- Name: commission_liquidations commission_liquidations_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: commission_liquidations commission_liquidations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: commission_liquidations commission_liquidations_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_liquidations
    ADD CONSTRAINT commission_liquidations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: commission_payments commission_payments_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: commission_payments commission_payments_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: commission_payments commission_payments_liquidation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_liquidation_id_fkey FOREIGN KEY (liquidation_id) REFERENCES public.commission_liquidations(id) ON DELETE CASCADE;


--
-- Name: commission_payments commission_payments_reconciled_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_reconciled_by_fkey FOREIGN KEY (reconciled_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: commission_payments commission_payments_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.commission_payments
    ADD CONSTRAINT commission_payments_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.aponnt_staff(staff_id) ON DELETE RESTRICT;


--
-- Name: companies companies_support_sla_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.companies
    ADD CONSTRAINT companies_support_sla_plan_id_fkey FOREIGN KEY (support_sla_plan_id) REFERENCES public.support_sla_plans(plan_id) ON DELETE SET NULL;


--
-- Name: companies companies_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.companies
    ADD CONSTRAINT companies_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.aponnt_staff(staff_id) ON DELETE SET NULL;


--
-- Name: company_account_notifications company_account_notifications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_account_notifications
    ADD CONSTRAINT company_account_notifications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_associate_contracts company_associate_contracts_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: company_associate_contracts company_associate_contracts_associate_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_associate_id_fkey FOREIGN KEY (associate_id) REFERENCES public.aponnt_associates(id) ON DELETE CASCADE;


--
-- Name: company_associate_contracts company_associate_contracts_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_associate_contracts company_associate_contracts_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: company_associate_contracts company_associate_contracts_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.role_definitions(id);


--
-- Name: company_associate_contracts company_associate_contracts_terminated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_associate_contracts
    ADD CONSTRAINT company_associate_contracts_terminated_by_fkey FOREIGN KEY (terminated_by) REFERENCES public.users(user_id);


--
-- Name: company_benefit_policies company_benefit_policies_benefit_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies
    ADD CONSTRAINT company_benefit_policies_benefit_type_id_fkey FOREIGN KEY (benefit_type_id) REFERENCES public.benefit_types(id) ON DELETE RESTRICT;


--
-- Name: company_benefit_policies company_benefit_policies_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies
    ADD CONSTRAINT company_benefit_policies_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_benefit_policies company_benefit_policies_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_benefit_policies
    ADD CONSTRAINT company_benefit_policies_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: company_branches company_branches_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_branches company_branches_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: company_branches company_branches_default_agreement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_default_agreement_id_fkey FOREIGN KEY (default_agreement_id) REFERENCES public.labor_agreements_catalog(id);


--
-- Name: company_branches company_branches_default_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_branches
    ADD CONSTRAINT company_branches_default_template_id_fkey FOREIGN KEY (default_template_id) REFERENCES public.payroll_templates(id);


--
-- Name: company_communications company_communications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_communications
    ADD CONSTRAINT company_communications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_communications company_communications_from_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_communications
    ADD CONSTRAINT company_communications_from_staff_id_fkey FOREIGN KEY (from_staff_id) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: company_communications company_communications_parent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_communications
    ADD CONSTRAINT company_communications_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.company_communications(id);


--
-- Name: company_dependencies company_dependencies_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies
    ADD CONSTRAINT company_dependencies_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_dependencies company_dependencies_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies
    ADD CONSTRAINT company_dependencies_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: company_dependencies company_dependencies_dependency_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_dependencies
    ADD CONSTRAINT company_dependencies_dependency_type_id_fkey FOREIGN KEY (dependency_type_id) REFERENCES public.dependency_types(id);


--
-- Name: company_email_config company_email_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_email_config
    ADD CONSTRAINT company_email_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_fiscal_config company_fiscal_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_fiscal_config
    ADD CONSTRAINT company_fiscal_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_inbox_processed company_inbox_processed_linked_inbound_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_inbox_processed
    ADD CONSTRAINT company_inbox_processed_linked_inbound_id_fkey FOREIGN KEY (linked_inbound_id) REFERENCES public.email_inbound_log(id);


--
-- Name: company_medical_staff company_medical_staff_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_medical_staff
    ADD CONSTRAINT company_medical_staff_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(user_id);


--
-- Name: company_medical_staff company_medical_staff_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_medical_staff
    ADD CONSTRAINT company_medical_staff_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_medical_staff company_medical_staff_partner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_medical_staff
    ADD CONSTRAINT company_medical_staff_partner_id_fkey FOREIGN KEY (partner_id) REFERENCES public.partners(id) ON DELETE CASCADE;


--
-- Name: company_risk_config company_risk_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_risk_config
    ADD CONSTRAINT company_risk_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_risk_config company_risk_config_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_risk_config
    ADD CONSTRAINT company_risk_config_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(user_id);


--
-- Name: company_support_assignments company_support_assignments_assigned_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_support_assignments
    ADD CONSTRAINT company_support_assignments_assigned_by_user_id_fkey FOREIGN KEY (assigned_by_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: company_support_assignments company_support_assignments_assigned_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_support_assignments
    ADD CONSTRAINT company_support_assignments_assigned_vendor_id_fkey FOREIGN KEY (assigned_vendor_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: company_support_assignments company_support_assignments_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_support_assignments
    ADD CONSTRAINT company_support_assignments_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_support_assignments company_support_assignments_original_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_support_assignments
    ADD CONSTRAINT company_support_assignments_original_vendor_id_fkey FOREIGN KEY (original_vendor_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: company_tasks company_tasks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tasks
    ADD CONSTRAINT company_tasks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: company_tasks company_tasks_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tasks
    ADD CONSTRAINT company_tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: company_tax_config company_tax_config_tax_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_tax_config
    ADD CONSTRAINT company_tax_config_tax_template_id_fkey FOREIGN KEY (tax_template_id) REFERENCES public.tax_templates(id);


--
-- Name: compliance_violations compliance_violations_rule_code_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.compliance_violations
    ADD CONSTRAINT compliance_violations_rule_code_fkey FOREIGN KEY (rule_code) REFERENCES public.compliance_rules(rule_code);


--
-- Name: concept_dependencies concept_dependencies_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies
    ADD CONSTRAINT concept_dependencies_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: concept_dependencies concept_dependencies_concept_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies
    ADD CONSTRAINT concept_dependencies_concept_id_fkey FOREIGN KEY (concept_id) REFERENCES public.payroll_template_concepts(id) ON DELETE CASCADE;


--
-- Name: concept_dependencies concept_dependencies_dependency_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.concept_dependencies
    ADD CONSTRAINT concept_dependencies_dependency_id_fkey FOREIGN KEY (dependency_id) REFERENCES public.company_dependencies(id) ON DELETE CASCADE;


--
-- Name: consent_audit_log consent_audit_log_user_consent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_audit_log
    ADD CONSTRAINT consent_audit_log_user_consent_id_fkey FOREIGN KEY (user_consent_id) REFERENCES public.user_consents(user_consent_id) ON DELETE CASCADE;


--
-- Name: contract_apk_licenses contract_apk_licenses_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_apk_licenses
    ADD CONSTRAINT contract_apk_licenses_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: contract_apk_licenses contract_apk_licenses_contract_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_apk_licenses
    ADD CONSTRAINT contract_apk_licenses_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id) ON DELETE CASCADE;


--
-- Name: contract_renewal_logs contract_renewal_logs_contract_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_renewal_logs
    ADD CONSTRAINT contract_renewal_logs_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id) ON DELETE CASCADE;


--
-- Name: contract_templates contract_templates_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates
    ADD CONSTRAINT contract_templates_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: contract_templates contract_templates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates
    ADD CONSTRAINT contract_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: contract_templates contract_templates_template_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contract_templates
    ADD CONSTRAINT contract_templates_template_type_id_fkey FOREIGN KEY (template_type_id) REFERENCES public.contract_template_types(id) ON DELETE RESTRICT;


--
-- Name: contracts contracts_budget_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_budget_id_fkey FOREIGN KEY (budget_id) REFERENCES public.budgets(id) ON DELETE CASCADE;


--
-- Name: contracts contracts_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: contracts contracts_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: contracts contracts_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contracts
    ADD CONSTRAINT contracts_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: cost_transactions cost_transactions_notification_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.cost_transactions
    ADD CONSTRAINT cost_transactions_notification_group_id_fkey FOREIGN KEY (notification_group_id) REFERENCES public.notification_groups(id);


--
-- Name: departments departments_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id) ON DELETE SET NULL;


--
-- Name: departments departments_default_kiosk_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_default_kiosk_id_fkey FOREIGN KEY (default_kiosk_id) REFERENCES public.kiosks(id) ON DELETE SET NULL;


--
-- Name: departments departments_manager_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT departments_manager_user_id_fkey FOREIGN KEY (manager_user_id) REFERENCES public.users(user_id);


--
-- Name: dependency_evaluations dependency_evaluations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations
    ADD CONSTRAINT dependency_evaluations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: dependency_evaluations dependency_evaluations_concept_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations
    ADD CONSTRAINT dependency_evaluations_concept_id_fkey FOREIGN KEY (concept_id) REFERENCES public.payroll_template_concepts(id);


--
-- Name: dependency_evaluations dependency_evaluations_dependency_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations
    ADD CONSTRAINT dependency_evaluations_dependency_id_fkey FOREIGN KEY (dependency_id) REFERENCES public.company_dependencies(id);


--
-- Name: dependency_evaluations dependency_evaluations_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dependency_evaluations
    ADD CONSTRAINT dependency_evaluations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: dms_document_alerts dms_document_alerts_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_alerts
    ADD CONSTRAINT dms_document_alerts_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_document_alerts dms_document_alerts_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_alerts
    ADD CONSTRAINT dms_document_alerts_request_id_fkey FOREIGN KEY (request_id) REFERENCES public.dms_document_requests(id);


--
-- Name: dms_document_metadata dms_document_metadata_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_metadata
    ADD CONSTRAINT dms_document_metadata_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id) ON DELETE CASCADE;


--
-- Name: dms_document_permissions dms_document_permissions_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_permissions
    ADD CONSTRAINT dms_document_permissions_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id) ON DELETE CASCADE;


--
-- Name: dms_document_requests dms_document_requests_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_requests
    ADD CONSTRAINT dms_document_requests_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_document_types dms_document_types_category_code_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_types
    ADD CONSTRAINT dms_document_types_category_code_fkey FOREIGN KEY (category_code) REFERENCES public.dms_document_categories(code);


--
-- Name: dms_document_versions dms_document_versions_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_document_versions
    ADD CONSTRAINT dms_document_versions_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id) ON DELETE CASCADE;


--
-- Name: dms_documents dms_documents_folder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_documents
    ADD CONSTRAINT dms_documents_folder_id_fkey FOREIGN KEY (folder_id) REFERENCES public.dms_folders(id);


--
-- Name: dms_documents dms_documents_parent_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_documents
    ADD CONSTRAINT dms_documents_parent_document_id_fkey FOREIGN KEY (parent_document_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_documents dms_documents_superseded_by_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_documents
    ADD CONSTRAINT dms_documents_superseded_by_id_fkey FOREIGN KEY (superseded_by_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_documents dms_documents_supersedes_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_documents
    ADD CONSTRAINT dms_documents_supersedes_id_fkey FOREIGN KEY (supersedes_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_folders dms_folders_parent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_folders
    ADD CONSTRAINT dms_folders_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.dms_folders(id) ON DELETE CASCADE;


--
-- Name: dms_workflow_approvals dms_workflow_approvals_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_approvals
    ADD CONSTRAINT dms_workflow_approvals_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_workflow_approvals dms_workflow_approvals_workflow_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_approvals
    ADD CONSTRAINT dms_workflow_approvals_workflow_id_fkey FOREIGN KEY (workflow_id) REFERENCES public.dms_workflow_instances(id);


--
-- Name: dms_workflow_instances dms_workflow_instances_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_instances
    ADD CONSTRAINT dms_workflow_instances_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.dms_documents(id);


--
-- Name: dms_workflow_instances dms_workflow_instances_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dms_workflow_instances
    ADD CONSTRAINT dms_workflow_instances_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.dms_workflow_templates(id);


--
-- Name: document_categories document_categories_parent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_categories
    ADD CONSTRAINT document_categories_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.document_categories(id);


--
-- Name: ecosystem_tasks ecosystem_tasks_phase_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ecosystem_tasks
    ADD CONSTRAINT ecosystem_tasks_phase_id_fkey FOREIGN KEY (phase_id) REFERENCES public.ecosystem_phases(id) ON DELETE SET NULL;


--
-- Name: email_configurations email_configurations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations
    ADD CONSTRAINT email_configurations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: email_configurations email_configurations_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations
    ADD CONSTRAINT email_configurations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: email_configurations email_configurations_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_configurations
    ADD CONSTRAINT email_configurations_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(user_id);


--
-- Name: email_logs email_logs_email_config_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs
    ADD CONSTRAINT email_logs_email_config_id_fkey FOREIGN KEY (email_config_id) REFERENCES public.email_configurations(id);


--
-- Name: email_templates email_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT email_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: email_templates email_templates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT email_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: employee_assigned_assets employee_assigned_assets_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_assigned_assets
    ADD CONSTRAINT employee_assigned_assets_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(user_id);


--
-- Name: employee_assigned_assets employee_assigned_assets_employee_benefit_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_assigned_assets
    ADD CONSTRAINT employee_assigned_assets_employee_benefit_id_fkey FOREIGN KEY (employee_benefit_id) REFERENCES public.employee_benefits(id) ON DELETE CASCADE;


--
-- Name: employee_assigned_assets employee_assigned_assets_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_assigned_assets
    ADD CONSTRAINT employee_assigned_assets_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: employee_benefit_documents employee_benefit_documents_employee_benefit_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents
    ADD CONSTRAINT employee_benefit_documents_employee_benefit_id_fkey FOREIGN KEY (employee_benefit_id) REFERENCES public.employee_benefits(id) ON DELETE CASCADE;


--
-- Name: employee_benefit_documents employee_benefit_documents_requirement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents
    ADD CONSTRAINT employee_benefit_documents_requirement_id_fkey FOREIGN KEY (requirement_id) REFERENCES public.benefit_document_requirements(id) ON DELETE RESTRICT;


--
-- Name: employee_benefit_documents employee_benefit_documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents
    ADD CONSTRAINT employee_benefit_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(user_id);


--
-- Name: employee_benefit_documents employee_benefit_documents_verified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefit_documents
    ADD CONSTRAINT employee_benefit_documents_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(user_id);


--
-- Name: employee_benefits employee_benefits_company_benefit_policy_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_company_benefit_policy_id_fkey FOREIGN KEY (company_benefit_policy_id) REFERENCES public.company_benefit_policies(id) ON DELETE RESTRICT;


--
-- Name: employee_benefits employee_benefits_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: employee_benefits employee_benefits_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: employee_benefits employee_benefits_status_changed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_status_changed_by_fkey FOREIGN KEY (status_changed_by) REFERENCES public.users(user_id);


--
-- Name: employee_benefits employee_benefits_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_benefits
    ADD CONSTRAINT employee_benefits_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: employee_dependency_documents employee_dependency_documents_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: employee_dependency_documents employee_dependency_documents_dependency_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_dependency_id_fkey FOREIGN KEY (dependency_id) REFERENCES public.company_dependencies(id) ON DELETE CASCADE;


--
-- Name: employee_dependency_documents employee_dependency_documents_replaced_by_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_replaced_by_id_fkey FOREIGN KEY (replaced_by_id) REFERENCES public.employee_dependency_documents(id);


--
-- Name: employee_dependency_documents employee_dependency_documents_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(user_id);


--
-- Name: employee_dependency_documents employee_dependency_documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(user_id);


--
-- Name: employee_dependency_documents employee_dependency_documents_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_dependency_documents
    ADD CONSTRAINT employee_dependency_documents_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: employee_documents employee_documents_userId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_documents
    ADD CONSTRAINT "employee_documents_userId_fkey" FOREIGN KEY ("userId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: employee_locations employee_locations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_locations
    ADD CONSTRAINT employee_locations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: employee_locations employee_locations_userId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.employee_locations
    ADD CONSTRAINT "employee_locations_userId_fkey" FOREIGN KEY ("userId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: epp_catalog epp_catalog_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_catalog
    ADD CONSTRAINT epp_catalog_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.epp_categories(id);


--
-- Name: epp_catalog epp_catalog_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_catalog
    ADD CONSTRAINT epp_catalog_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: epp_deliveries epp_deliveries_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries
    ADD CONSTRAINT epp_deliveries_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: epp_deliveries epp_deliveries_epp_catalog_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries
    ADD CONSTRAINT epp_deliveries_epp_catalog_id_fkey FOREIGN KEY (epp_catalog_id) REFERENCES public.epp_catalog(id) ON DELETE RESTRICT;


--
-- Name: epp_deliveries epp_deliveries_replaced_by_delivery_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries
    ADD CONSTRAINT epp_deliveries_replaced_by_delivery_id_fkey FOREIGN KEY (replaced_by_delivery_id) REFERENCES public.epp_deliveries(id);


--
-- Name: epp_deliveries epp_deliveries_requirement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_deliveries
    ADD CONSTRAINT epp_deliveries_requirement_id_fkey FOREIGN KEY (requirement_id) REFERENCES public.epp_role_requirements(id) ON DELETE SET NULL;


--
-- Name: epp_inspections epp_inspections_delivery_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_inspections
    ADD CONSTRAINT epp_inspections_delivery_id_fkey FOREIGN KEY (delivery_id) REFERENCES public.epp_deliveries(id) ON DELETE CASCADE;


--
-- Name: epp_role_requirements epp_role_requirements_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements
    ADD CONSTRAINT epp_role_requirements_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: epp_role_requirements epp_role_requirements_epp_catalog_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements
    ADD CONSTRAINT epp_role_requirements_epp_catalog_id_fkey FOREIGN KEY (epp_catalog_id) REFERENCES public.epp_catalog(id) ON DELETE CASCADE;


--
-- Name: epp_role_requirements epp_role_requirements_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.epp_role_requirements
    ADD CONSTRAINT epp_role_requirements_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.organizational_positions(id) ON DELETE CASCADE;


--
-- Name: extraordinary_licenses extraordinary_licenses_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.extraordinary_licenses
    ADD CONSTRAINT extraordinary_licenses_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_certification_alert_config fk_alert_config_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alert_config
    ADD CONSTRAINT fk_alert_config_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: attendance_analytics_cache fk_analytics_cache_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_analytics_cache
    ADD CONSTRAINT fk_analytics_cache_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_anthropometric_data fk_anthropometric_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_anthropometric_data
    ADD CONSTRAINT fk_anthropometric_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: attendance_patterns fk_attendance_patterns_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_patterns
    ADD CONSTRAINT fk_attendance_patterns_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: attendance_patterns fk_attendance_patterns_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_patterns
    ADD CONSTRAINT fk_attendance_patterns_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: attendance_profiles fk_attendance_profiles_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_profiles
    ADD CONSTRAINT fk_attendance_profiles_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: attendance_profiles fk_attendance_profiles_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.attendance_profiles
    ADD CONSTRAINT fk_attendance_profiles_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: biometric_events fk_biometric_events_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_events
    ADD CONSTRAINT fk_biometric_events_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: biometric_events fk_biometric_events_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_events
    ADD CONSTRAINT fk_biometric_events_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: biometric_settings fk_biometric_settings_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_settings
    ADD CONSTRAINT fk_biometric_settings_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_employee_certifications fk_cert_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications
    ADD CONSTRAINT fk_cert_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_chronic_conditions_v2 fk_chronic_v2_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions_v2
    ADD CONSTRAINT fk_chronic_v2_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: oh_workers_compensation_claims fk_claim_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_workers_compensation_claims
    ADD CONSTRAINT fk_claim_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_claim_documents fk_claim_doc_claim; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_documents
    ADD CONSTRAINT fk_claim_doc_claim FOREIGN KEY (claim_id) REFERENCES public.oh_workers_compensation_claims(id) ON DELETE CASCADE;


--
-- Name: oh_claim_status_history fk_claim_history_claim; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_status_history
    ADD CONSTRAINT fk_claim_history_claim FOREIGN KEY (claim_id) REFERENCES public.oh_workers_compensation_claims(id) ON DELETE CASCADE;


--
-- Name: biometric_detections fk_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_detections
    ADD CONSTRAINT fk_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: company_modules fk_company_modules_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.company_modules
    ADD CONSTRAINT fk_company_modules_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: comparative_analytics fk_comparative_analytics_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.comparative_analytics
    ADD CONSTRAINT fk_comparative_analytics_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: departments fk_departments_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.departments
    ADD CONSTRAINT fk_departments_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: biometric_detections fk_employee; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.biometric_detections
    ADD CONSTRAINT fk_employee FOREIGN KEY (employee_id) REFERENCES public.users(user_id);


--
-- Name: facial_biometric_data fk_facial_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.facial_biometric_data
    ADD CONSTRAINT fk_facial_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: facial_biometric_data fk_facial_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.facial_biometric_data
    ADD CONSTRAINT fk_facial_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: fingerprint_biometric_data fk_fingerprint_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fingerprint_biometric_data
    ADD CONSTRAINT fk_fingerprint_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: fingerprint_biometric_data fk_fingerprint_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.fingerprint_biometric_data
    ADD CONSTRAINT fk_fingerprint_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_healthy_habits fk_habits_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_healthy_habits
    ADD CONSTRAINT fk_habits_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: consent_legal_documents fk_legal_doc_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_legal_documents
    ADD CONSTRAINT fk_legal_doc_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: consent_legal_documents fk_legal_doc_creator; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.consent_legal_documents
    ADD CONSTRAINT fk_legal_doc_creator FOREIGN KEY (created_by_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: medical_communications fk_medical_comm_absence_case; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_communications
    ADD CONSTRAINT fk_medical_comm_absence_case FOREIGN KEY (absence_case_id) REFERENCES public.absence_cases(id) ON DELETE CASCADE;


--
-- Name: user_payroll_records fk_payroll_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_records
    ADD CONSTRAINT fk_payroll_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_psychiatric_treatments fk_psychiatric_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_psychiatric_treatments
    ADD CONSTRAINT fk_psychiatric_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_salary_config_v2 fk_salary_v2_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config_v2
    ADD CONSTRAINT fk_salary_v2_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: scoring_history fk_scoring_history_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scoring_history
    ADD CONSTRAINT fk_scoring_history_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: scoring_history fk_scoring_history_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scoring_history
    ADD CONSTRAINT fk_scoring_history_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: siac_facturas fk_siac_facturas_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT fk_siac_facturas_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: siac_facturas fk_siac_facturas_presupuesto; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT fk_siac_facturas_presupuesto FOREIGN KEY (presupuesto_id) REFERENCES public.siac_presupuestos(id) ON DELETE SET NULL;


--
-- Name: siac_presupuestos fk_siac_presupuestos_cliente; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_presupuestos
    ADD CONSTRAINT fk_siac_presupuestos_cliente FOREIGN KEY (cliente_id) REFERENCES public.siac_clientes(id) ON DELETE SET NULL;


--
-- Name: siac_presupuestos fk_siac_presupuestos_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_presupuestos
    ADD CONSTRAINT fk_siac_presupuestos_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_sports_activities fk_sports_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sports_activities
    ADD CONSTRAINT fk_sports_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_surgeries fk_surgeries_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_surgeries
    ADD CONSTRAINT fk_surgeries_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_shift_assignments fk_user_shift_assigned_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT fk_user_shift_assigned_by FOREIGN KEY (assigned_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: user_shift_assignments fk_user_shift_company; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT fk_user_shift_company FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_shift_assignments fk_user_shift_deactivated_by; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT fk_user_shift_deactivated_by FOREIGN KEY (deactivated_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: user_shift_assignments fk_user_shift_shift; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT fk_user_shift_shift FOREIGN KEY (shift_id) REFERENCES public.shifts(id) ON DELETE CASCADE;


--
-- Name: user_shift_assignments fk_user_shift_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shift_assignments
    ADD CONSTRAINT fk_user_shift_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_shifts fk_user_shifts_shift; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shifts
    ADD CONSTRAINT fk_user_shifts_shift FOREIGN KEY (shift_id) REFERENCES public.shifts(id) ON DELETE CASCADE;


--
-- Name: user_shifts fk_user_shifts_user; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_shifts
    ADD CONSTRAINT fk_user_shifts_user FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: vendor_commissions fk_vendor_commissions_original_vendor_staff; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions
    ADD CONSTRAINT fk_vendor_commissions_original_vendor_staff FOREIGN KEY (original_vendor_id) REFERENCES public.aponnt_staff(staff_id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- Name: CONSTRAINT fk_vendor_commissions_original_vendor_staff ON vendor_commissions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT fk_vendor_commissions_original_vendor_staff ON public.vendor_commissions IS 'FK a aponnt_staff. Define el vendedor original antes de una transferencia';


--
-- Name: vendor_commissions fk_vendor_commissions_vendor_staff; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions
    ADD CONSTRAINT fk_vendor_commissions_vendor_staff FOREIGN KEY (vendor_id) REFERENCES public.aponnt_staff(staff_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: CONSTRAINT fk_vendor_commissions_vendor_staff ON vendor_commissions; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON CONSTRAINT fk_vendor_commissions_vendor_staff ON public.vendor_commissions IS 'FK a aponnt_staff. Define el vendedor que recibe la comisin';


--
-- Name: hour_bank_agreements hour_bank_agreements_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_agreements
    ADD CONSTRAINT hour_bank_agreements_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_agreements hour_bank_agreements_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_agreements
    ADD CONSTRAINT hour_bank_agreements_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_agreements hour_bank_agreements_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_agreements
    ADD CONSTRAINT hour_bank_agreements_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_balances hour_bank_balances_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_balances hour_bank_balances_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_balances hour_bank_balances_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_balances hour_bank_balances_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_balances
    ADD CONSTRAINT hour_bank_balances_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_blackout_dates hour_bank_blackout_dates_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates
    ADD CONSTRAINT hour_bank_blackout_dates_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_blackout_dates hour_bank_blackout_dates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates
    ADD CONSTRAINT hour_bank_blackout_dates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_blackout_dates hour_bank_blackout_dates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates
    ADD CONSTRAINT hour_bank_blackout_dates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: hour_bank_blackout_dates hour_bank_blackout_dates_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_blackout_dates
    ADD CONSTRAINT hour_bank_blackout_dates_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_budgets hour_bank_budgets_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_budgets
    ADD CONSTRAINT hour_bank_budgets_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_budgets hour_bank_budgets_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_budgets
    ADD CONSTRAINT hour_bank_budgets_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_loans hour_bank_loans_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_loans
    ADD CONSTRAINT hour_bank_loans_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_loans hour_bank_loans_redemption_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_loans
    ADD CONSTRAINT hour_bank_loans_redemption_request_id_fkey FOREIGN KEY (redemption_request_id) REFERENCES public.hour_bank_redemption_requests(id);


--
-- Name: hour_bank_loans hour_bank_loans_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_loans
    ADD CONSTRAINT hour_bank_loans_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_metrics_aggregated hour_bank_metrics_aggregated_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_metrics_aggregated
    ADD CONSTRAINT hour_bank_metrics_aggregated_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_pending_decisions hour_bank_pending_decisions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_pending_decisions
    ADD CONSTRAINT hour_bank_pending_decisions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_pending_decisions hour_bank_pending_decisions_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_pending_decisions
    ADD CONSTRAINT hour_bank_pending_decisions_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.hour_bank_transactions(id);


--
-- Name: hour_bank_pending_decisions hour_bank_pending_decisions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_pending_decisions
    ADD CONSTRAINT hour_bank_pending_decisions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_redemption_history hour_bank_redemption_history_changed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_history
    ADD CONSTRAINT hour_bank_redemption_history_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES public.users(user_id);


--
-- Name: hour_bank_redemption_history hour_bank_redemption_history_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_history
    ADD CONSTRAINT hour_bank_redemption_history_request_id_fkey FOREIGN KEY (request_id) REFERENCES public.hour_bank_redemption_requests(id) ON DELETE CASCADE;


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_hr_approver_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_hr_approver_id_fkey FOREIGN KEY (hr_approver_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_supervisor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_supervisor_id_fkey FOREIGN KEY (supervisor_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.hour_bank_transactions(id);


--
-- Name: hour_bank_redemption_requests hour_bank_redemption_requests_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_redemption_requests
    ADD CONSTRAINT hour_bank_redemption_requests_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_requests hour_bank_requests_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_requests hour_bank_requests_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_requests hour_bank_requests_hr_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_hr_id_fkey FOREIGN KEY (hr_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_requests hour_bank_requests_supervisor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_supervisor_id_fkey FOREIGN KEY (supervisor_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_requests hour_bank_requests_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_requests hour_bank_requests_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.hour_bank_transactions(id);


--
-- Name: hour_bank_requests hour_bank_requests_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_requests
    ADD CONSTRAINT hour_bank_requests_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_risk_analysis hour_bank_risk_analysis_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_risk_analysis
    ADD CONSTRAINT hour_bank_risk_analysis_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_scheduled_redemptions hour_bank_scheduled_redemptions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_scheduled_redemptions
    ADD CONSTRAINT hour_bank_scheduled_redemptions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_scheduled_redemptions hour_bank_scheduled_redemptions_request_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_scheduled_redemptions
    ADD CONSTRAINT hour_bank_scheduled_redemptions_request_id_fkey FOREIGN KEY (request_id) REFERENCES public.hour_bank_redemption_requests(id) ON DELETE CASCADE;


--
-- Name: hour_bank_scheduled_redemptions hour_bank_scheduled_redemptions_shift_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_scheduled_redemptions
    ADD CONSTRAINT hour_bank_scheduled_redemptions_shift_id_fkey FOREIGN KEY (shift_id) REFERENCES public.shifts(id);


--
-- Name: hour_bank_scheduled_redemptions hour_bank_scheduled_redemptions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_scheduled_redemptions
    ADD CONSTRAINT hour_bank_scheduled_redemptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hour_bank_templates hour_bank_templates_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates
    ADD CONSTRAINT hour_bank_templates_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_templates hour_bank_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates
    ADD CONSTRAINT hour_bank_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_templates hour_bank_templates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates
    ADD CONSTRAINT hour_bank_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: hour_bank_templates hour_bank_templates_parent_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_templates
    ADD CONSTRAINT hour_bank_templates_parent_template_id_fkey FOREIGN KEY (parent_template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_transactions hour_bank_transactions_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: hour_bank_transactions hour_bank_transactions_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: hour_bank_transactions hour_bank_transactions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: hour_bank_transactions hour_bank_transactions_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: hour_bank_transactions hour_bank_transactions_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.hour_bank_templates(id);


--
-- Name: hour_bank_transactions hour_bank_transactions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hour_bank_transactions
    ADD CONSTRAINT hour_bank_transactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: hse_company_config hse_company_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_company_config
    ADD CONSTRAINT hse_company_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: hse_company_config hse_company_config_hse_manager_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_company_config
    ADD CONSTRAINT hse_company_config_hse_manager_role_id_fkey FOREIGN KEY (hse_manager_role_id) REFERENCES public.organizational_positions(id);


--
-- Name: hse_ppe_detections hse_ppe_detections_zone_config_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.hse_ppe_detections
    ADD CONSTRAINT hse_ppe_detections_zone_config_id_fkey FOREIGN KEY (zone_config_id) REFERENCES public.hse_zone_configurations(id);


--
-- Name: invoices invoices_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: job_application_notes job_application_notes_application_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_application_notes
    ADD CONSTRAINT job_application_notes_application_id_fkey FOREIGN KEY (application_id) REFERENCES public.job_applications(id) ON DELETE CASCADE;


--
-- Name: job_application_notes job_application_notes_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_application_notes
    ADD CONSTRAINT job_application_notes_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_admin_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_admin_approved_by_fkey FOREIGN KEY (admin_approved_by) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_assigned_department_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_assigned_department_id_fkey FOREIGN KEY (assigned_department_id) REFERENCES public.departments(id);


--
-- Name: job_applications job_applications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: job_applications job_applications_employee_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_employee_user_id_fkey FOREIGN KEY (employee_user_id) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_hired_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_hired_by_fkey FOREIGN KEY (hired_by) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_interviewer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_interviewer_id_fkey FOREIGN KEY (interviewer_id) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_job_posting_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_job_posting_id_fkey FOREIGN KEY (job_posting_id) REFERENCES public.job_postings(id) ON DELETE CASCADE;


--
-- Name: job_applications job_applications_medical_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_medical_approved_by_fkey FOREIGN KEY (medical_approved_by) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_medical_record_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_medical_record_id_fkey FOREIGN KEY (medical_record_id) REFERENCES public.medical_records(id);


--
-- Name: job_applications job_applications_referrer_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_referrer_employee_id_fkey FOREIGN KEY (referrer_employee_id) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_rejected_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_rejected_by_fkey FOREIGN KEY (rejected_by) REFERENCES public.users(user_id);


--
-- Name: job_applications job_applications_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_applications
    ADD CONSTRAINT job_applications_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(user_id);


--
-- Name: job_postings job_postings_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: job_postings job_postings_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: job_postings job_postings_department_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_department_id_fkey FOREIGN KEY (department_id) REFERENCES public.departments(id);


--
-- Name: job_postings job_postings_hiring_manager_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_hiring_manager_id_fkey FOREIGN KEY (hiring_manager_id) REFERENCES public.users(user_id);


--
-- Name: job_postings job_postings_recruiter_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.job_postings
    ADD CONSTRAINT job_postings_recruiter_id_fkey FOREIGN KEY (recruiter_id) REFERENCES public.users(user_id);


--
-- Name: kiosks kiosks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.kiosks
    ADD CONSTRAINT kiosks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: labor_agreements_v2 labor_agreements_v2_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_v2
    ADD CONSTRAINT labor_agreements_v2_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: labor_agreements_v2 labor_agreements_v2_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.labor_agreements_v2
    ADD CONSTRAINT labor_agreements_v2_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_actual_authorizer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_actual_authorizer_id_fkey FOREIGN KEY (actual_authorizer_id) REFERENCES public.users(user_id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_requested_authorizer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_requested_authorizer_id_fkey FOREIGN KEY (requested_authorizer_id) REFERENCES public.users(user_id);


--
-- Name: late_arrival_authorizations late_arrival_authorizations_shift_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.late_arrival_authorizations
    ADD CONSTRAINT late_arrival_authorizations_shift_id_fkey FOREIGN KEY (shift_id) REFERENCES public.shifts(id);


--
-- Name: legal_ai_analysis legal_ai_analysis_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_ai_analysis legal_ai_analysis_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: legal_ai_analysis legal_ai_analysis_related_deadline_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_related_deadline_id_fkey FOREIGN KEY (related_deadline_id) REFERENCES public.legal_deadlines(id);


--
-- Name: legal_ai_analysis legal_ai_analysis_related_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_related_document_id_fkey FOREIGN KEY (related_document_id) REFERENCES public.legal_case_documents(id);


--
-- Name: legal_ai_analysis legal_ai_analysis_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_ai_analysis
    ADD CONSTRAINT legal_ai_analysis_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(user_id);


--
-- Name: legal_case_documents legal_case_documents_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_case_documents legal_case_documents_response_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_response_document_id_fkey FOREIGN KEY (response_document_id) REFERENCES public.legal_case_documents(id);


--
-- Name: legal_case_documents legal_case_documents_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.legal_case_stages(id);


--
-- Name: legal_case_documents legal_case_documents_timeline_event_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_timeline_event_id_fkey FOREIGN KEY (timeline_event_id) REFERENCES public.legal_case_timeline_events(id);


--
-- Name: legal_case_documents legal_case_documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_documents
    ADD CONSTRAINT legal_case_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(user_id);


--
-- Name: legal_case_parties legal_case_parties_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_parties
    ADD CONSTRAINT legal_case_parties_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_case_parties legal_case_parties_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_parties
    ADD CONSTRAINT legal_case_parties_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: legal_case_stages legal_case_stages_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_stages
    ADD CONSTRAINT legal_case_stages_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_case_stages legal_case_stages_recorded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_stages
    ADD CONSTRAINT legal_case_stages_recorded_by_fkey FOREIGN KEY (recorded_by) REFERENCES public.users(user_id);


--
-- Name: legal_case_timeline_events legal_case_timeline_events_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events
    ADD CONSTRAINT legal_case_timeline_events_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_case_timeline_events legal_case_timeline_events_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events
    ADD CONSTRAINT legal_case_timeline_events_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: legal_case_timeline_events legal_case_timeline_events_related_event_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events
    ADD CONSTRAINT legal_case_timeline_events_related_event_id_fkey FOREIGN KEY (related_event_id) REFERENCES public.legal_case_timeline_events(id);


--
-- Name: legal_case_timeline_events legal_case_timeline_events_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_case_timeline_events
    ADD CONSTRAINT legal_case_timeline_events_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.legal_case_stages(id);


--
-- Name: legal_cases legal_cases_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(user_id);


--
-- Name: legal_cases legal_cases_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: legal_cases legal_cases_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: legal_cases legal_cases_defendant_lawyer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_defendant_lawyer_id_fkey FOREIGN KEY (defendant_lawyer_id) REFERENCES public.users(user_id);


--
-- Name: legal_cases legal_cases_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_cases
    ADD CONSTRAINT legal_cases_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id);


--
-- Name: legal_communications legal_communications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: legal_communications legal_communications_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: legal_communications legal_communications_deleted_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_deleted_by_fkey FOREIGN KEY (deleted_by) REFERENCES public.users(user_id);


--
-- Name: legal_communications legal_communications_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: legal_communications legal_communications_last_edited_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_last_edited_by_fkey FOREIGN KEY (last_edited_by) REFERENCES public.users(user_id);


--
-- Name: legal_communications legal_communications_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_communications
    ADD CONSTRAINT legal_communications_type_id_fkey FOREIGN KEY (type_id) REFERENCES public.legal_communication_types(id);


--
-- Name: legal_deadlines legal_deadlines_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(user_id);


--
-- Name: legal_deadlines legal_deadlines_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_deadlines legal_deadlines_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: legal_deadlines legal_deadlines_completed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.users(user_id);


--
-- Name: legal_deadlines legal_deadlines_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: legal_deadlines legal_deadlines_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_deadlines
    ADD CONSTRAINT legal_deadlines_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.legal_case_stages(id);


--
-- Name: legal_document_alerts legal_document_alerts_case_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts
    ADD CONSTRAINT legal_document_alerts_case_id_fkey FOREIGN KEY (case_id) REFERENCES public.legal_cases(id) ON DELETE CASCADE;


--
-- Name: legal_document_alerts legal_document_alerts_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts
    ADD CONSTRAINT legal_document_alerts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: legal_document_alerts legal_document_alerts_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts
    ADD CONSTRAINT legal_document_alerts_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.legal_case_documents(id) ON DELETE CASCADE;


--
-- Name: legal_document_alerts legal_document_alerts_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_document_alerts
    ADD CONSTRAINT legal_document_alerts_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(user_id);


--
-- Name: legal_edit_authorizations legal_edit_authorizations_authorized_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_edit_authorizations
    ADD CONSTRAINT legal_edit_authorizations_authorized_by_fkey FOREIGN KEY (authorized_by) REFERENCES public.users(user_id);


--
-- Name: legal_edit_authorizations legal_edit_authorizations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_edit_authorizations
    ADD CONSTRAINT legal_edit_authorizations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: legal_edit_authorizations legal_edit_authorizations_requested_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.legal_edit_authorizations
    ADD CONSTRAINT legal_edit_authorizations_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES public.users(user_id);


--
-- Name: medical_certificates medical_certificates_auditor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_auditor_id_fkey FOREIGN KEY (auditor_id) REFERENCES public.users(user_id);


--
-- Name: medical_certificates medical_certificates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_certificates medical_certificates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: medical_certificates medical_certificates_last_modified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_last_modified_by_fkey FOREIGN KEY (last_modified_by) REFERENCES public.users(user_id);


--
-- Name: medical_certificates medical_certificates_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_certificates
    ADD CONSTRAINT medical_certificates_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: medical_communications medical_communications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_communications
    ADD CONSTRAINT medical_communications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_edit_authorizations medical_edit_authorizations_authorized_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations
    ADD CONSTRAINT medical_edit_authorizations_authorized_by_fkey FOREIGN KEY (authorized_by) REFERENCES public.users(user_id);


--
-- Name: medical_edit_authorizations medical_edit_authorizations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations
    ADD CONSTRAINT medical_edit_authorizations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_edit_authorizations medical_edit_authorizations_record_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations
    ADD CONSTRAINT medical_edit_authorizations_record_id_fkey FOREIGN KEY (record_id) REFERENCES public.medical_records(id) ON DELETE CASCADE;


--
-- Name: medical_edit_authorizations medical_edit_authorizations_requested_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_edit_authorizations
    ADD CONSTRAINT medical_edit_authorizations_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES public.users(user_id);


--
-- Name: medical_exam_templates medical_exam_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_exam_templates
    ADD CONSTRAINT medical_exam_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_exam_templates medical_exam_templates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_exam_templates
    ADD CONSTRAINT medical_exam_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: medical_leaves medical_leaves_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_leaves
    ADD CONSTRAINT medical_leaves_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: medical_leaves medical_leaves_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_leaves
    ADD CONSTRAINT medical_leaves_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: medical_leaves medical_leaves_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_leaves
    ADD CONSTRAINT medical_leaves_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_records medical_records_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_deleted_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_deleted_by_fkey FOREIGN KEY (deleted_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_deletion_authorized_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_deletion_authorized_by_fkey FOREIGN KEY (deletion_authorized_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: medical_records medical_records_last_edited_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_last_edited_by_fkey FOREIGN KEY (last_edited_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_locked_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_locked_by_fkey FOREIGN KEY (locked_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_signed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_signed_by_fkey FOREIGN KEY (signed_by) REFERENCES public.users(user_id);


--
-- Name: medical_records medical_records_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_records
    ADD CONSTRAINT medical_records_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.medical_exam_templates(id);


--
-- Name: medical_staff medical_staff_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: medical_staff medical_staff_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: medical_staff medical_staff_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.medical_staff
    ADD CONSTRAINT medical_staff_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: messages messages_recipientId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.messages
    ADD CONSTRAINT "messages_recipientId_fkey" FOREIGN KEY ("recipientId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: notification_actions_log notification_actions_log_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_actions_log
    ADD CONSTRAINT notification_actions_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: notification_ai_learning notification_ai_learning_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_ai_learning
    ADD CONSTRAINT notification_ai_learning_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: notification_context_data notification_context_data_notification_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_context_data
    ADD CONSTRAINT notification_context_data_notification_message_id_fkey FOREIGN KEY (notification_message_id) REFERENCES public.notification_messages(id) ON DELETE CASCADE;


--
-- Name: notification_escalations notification_escalations_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_escalations
    ADD CONSTRAINT notification_escalations_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.notification_messages(id);


--
-- Name: notification_flow_templates notification_flow_templates_request_type_code_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_flow_templates
    ADD CONSTRAINT notification_flow_templates_request_type_code_fkey FOREIGN KEY (request_type_code) REFERENCES public.request_types(code);


--
-- Name: notification_messages notification_messages_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_messages
    ADD CONSTRAINT notification_messages_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.notification_groups(id) ON DELETE CASCADE;


--
-- Name: notification_sla_records notification_sla_records_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_sla_records
    ADD CONSTRAINT notification_sla_records_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.notification_messages(id) ON DELETE CASCADE;


--
-- Name: notification_templates notification_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_templates
    ADD CONSTRAINT notification_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: notification_threads notification_threads_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_threads
    ADD CONSTRAINT notification_threads_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: notification_workflows notification_workflows_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_workflows
    ADD CONSTRAINT notification_workflows_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: notifications notifications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_certification_alerts oh_certification_alerts_certification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_certification_alerts
    ADD CONSTRAINT oh_certification_alerts_certification_id_fkey FOREIGN KEY (certification_id) REFERENCES public.oh_employee_certifications(id) ON DELETE CASCADE;


--
-- Name: oh_claim_documents oh_claim_documents_claim_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_documents
    ADD CONSTRAINT oh_claim_documents_claim_id_fkey FOREIGN KEY (claim_id) REFERENCES public.oh_workers_compensation_claims(id) ON DELETE CASCADE;


--
-- Name: oh_claim_status_history oh_claim_status_history_claim_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_claim_status_history
    ADD CONSTRAINT oh_claim_status_history_claim_id_fkey FOREIGN KEY (claim_id) REFERENCES public.oh_workers_compensation_claims(id) ON DELETE CASCADE;


--
-- Name: oh_employee_certifications oh_employee_certifications_certification_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications
    ADD CONSTRAINT oh_employee_certifications_certification_type_id_fkey FOREIGN KEY (certification_type_id) REFERENCES public.oh_certification_types(id);


--
-- Name: oh_employee_certifications oh_employee_certifications_is_renewal_of_certification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications
    ADD CONSTRAINT oh_employee_certifications_is_renewal_of_certification_id_fkey FOREIGN KEY (is_renewal_of_certification_id) REFERENCES public.oh_employee_certifications(id);


--
-- Name: oh_employee_certifications oh_employee_certifications_renewed_by_certification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_employee_certifications
    ADD CONSTRAINT oh_employee_certifications_renewed_by_certification_id_fkey FOREIGN KEY (renewed_by_certification_id) REFERENCES public.oh_employee_certifications(id);


--
-- Name: oh_pre_employment_screenings oh_pre_employment_screenings_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_pre_employment_screenings
    ADD CONSTRAINT oh_pre_employment_screenings_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_pre_employment_screenings oh_pre_employment_screenings_screening_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_pre_employment_screenings
    ADD CONSTRAINT oh_pre_employment_screenings_screening_type_id_fkey FOREIGN KEY (screening_type_id) REFERENCES public.oh_screening_types(id);


--
-- Name: oh_screening_config oh_screening_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_config
    ADD CONSTRAINT oh_screening_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_screening_documents oh_screening_documents_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_documents
    ADD CONSTRAINT oh_screening_documents_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_screening_documents oh_screening_documents_screening_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_documents
    ADD CONSTRAINT oh_screening_documents_screening_id_fkey FOREIGN KEY (screening_id) REFERENCES public.oh_pre_employment_screenings(id) ON DELETE CASCADE;


--
-- Name: oh_screening_results oh_screening_results_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_results
    ADD CONSTRAINT oh_screening_results_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: oh_screening_results oh_screening_results_screening_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_screening_results
    ADD CONSTRAINT oh_screening_results_screening_id_fkey FOREIGN KEY (screening_id) REFERENCES public.oh_pre_employment_screenings(id) ON DELETE CASCADE;


--
-- Name: oh_workers_compensation_claims oh_workers_compensation_claims_claim_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.oh_workers_compensation_claims
    ADD CONSTRAINT oh_workers_compensation_claims_claim_type_id_fkey FOREIGN KEY (claim_type_id) REFERENCES public.oh_claim_types(id);


--
-- Name: organizational_positions organizational_positions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: organizational_positions organizational_positions_parent_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_parent_position_id_fkey FOREIGN KEY (parent_position_id) REFERENCES public.organizational_positions(id);


--
-- Name: organizational_positions organizational_positions_payroll_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_payroll_template_id_fkey FOREIGN KEY (payroll_template_id) REFERENCES public.payroll_templates(id);


--
-- Name: organizational_positions organizational_positions_payslip_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_payslip_template_id_fkey FOREIGN KEY (payslip_template_id) REFERENCES public.payroll_payslip_templates(id);


--
-- Name: organizational_positions organizational_positions_salary_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizational_positions
    ADD CONSTRAINT organizational_positions_salary_category_id_fkey FOREIGN KEY (salary_category_id) REFERENCES public.salary_categories_v2(id);


--
-- Name: partner_commission_summaries partner_commission_summaries_partner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_summaries
    ADD CONSTRAINT partner_commission_summaries_partner_id_fkey FOREIGN KEY (partner_id) REFERENCES public.partners(id) ON DELETE CASCADE;


--
-- Name: partner_commission_transactions partner_commission_transactions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_transactions
    ADD CONSTRAINT partner_commission_transactions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: partner_commission_transactions partner_commission_transactions_partner_commission_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_transactions
    ADD CONSTRAINT partner_commission_transactions_partner_commission_id_fkey FOREIGN KEY (partner_commission_id) REFERENCES public.partner_commissions(id) ON DELETE SET NULL;


--
-- Name: partner_commission_transactions partner_commission_transactions_partner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commission_transactions
    ADD CONSTRAINT partner_commission_transactions_partner_id_fkey FOREIGN KEY (partner_id) REFERENCES public.partners(id) ON DELETE CASCADE;


--
-- Name: partner_commissions partner_commissions_partner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.partner_commissions
    ADD CONSTRAINT partner_commissions_partner_id_fkey FOREIGN KEY (partner_id) REFERENCES public.partners(id) ON DELETE CASCADE;


--
-- Name: password_auth_attempts password_auth_attempts_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.password_auth_attempts
    ADD CONSTRAINT password_auth_attempts_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id);


--
-- Name: password_auth_attempts password_auth_attempts_kiosk_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.password_auth_attempts
    ADD CONSTRAINT password_auth_attempts_kiosk_id_fkey FOREIGN KEY (kiosk_id) REFERENCES public.kiosks(id);


--
-- Name: payments payments_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: payments payments_invoice_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.invoices(id) ON DELETE CASCADE;


--
-- Name: payroll_concept_type_rates payroll_concept_type_rates_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_type_rates
    ADD CONSTRAINT payroll_concept_type_rates_concept_type_id_fkey FOREIGN KEY (concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: payroll_concept_type_rates payroll_concept_type_rates_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_type_rates
    ADD CONSTRAINT payroll_concept_type_rates_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_concept_types payroll_concept_types_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types
    ADD CONSTRAINT payroll_concept_types_classification_id_fkey FOREIGN KEY (classification_id) REFERENCES public.payroll_concept_classifications(id);


--
-- Name: payroll_concept_types payroll_concept_types_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types
    ADD CONSTRAINT payroll_concept_types_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_concept_types payroll_concept_types_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_concept_types
    ADD CONSTRAINT payroll_concept_types_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_entities payroll_entities_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entities
    ADD CONSTRAINT payroll_entities_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.payroll_entity_categories(id);


--
-- Name: payroll_entities payroll_entities_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entities
    ADD CONSTRAINT payroll_entities_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_entities payroll_entities_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entities
    ADD CONSTRAINT payroll_entities_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_entity_categories payroll_entity_categories_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_categories
    ADD CONSTRAINT payroll_entity_categories_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_entity_categories payroll_entity_categories_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_categories
    ADD CONSTRAINT payroll_entity_categories_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_entity_settlement_details payroll_entity_settlement_details_run_detail_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlement_details
    ADD CONSTRAINT payroll_entity_settlement_details_run_detail_id_fkey FOREIGN KEY (run_detail_id) REFERENCES public.payroll_run_details(id);


--
-- Name: payroll_entity_settlement_details payroll_entity_settlement_details_settlement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlement_details
    ADD CONSTRAINT payroll_entity_settlement_details_settlement_id_fkey FOREIGN KEY (settlement_id) REFERENCES public.payroll_entity_settlements(settlement_id) ON DELETE CASCADE;


--
-- Name: payroll_entity_settlement_details payroll_entity_settlement_details_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlement_details
    ADD CONSTRAINT payroll_entity_settlement_details_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_entity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.payroll_entities(entity_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_generated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_generated_by_fkey FOREIGN KEY (generated_by) REFERENCES public.users(user_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(user_id);


--
-- Name: payroll_entity_settlements payroll_entity_settlements_run_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_entity_settlements
    ADD CONSTRAINT payroll_entity_settlements_run_id_fkey FOREIGN KEY (run_id) REFERENCES public.payroll_runs(id);


--
-- Name: payroll_payslip_templates payroll_payslip_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_templates
    ADD CONSTRAINT payroll_payslip_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_payslip_templates payroll_payslip_templates_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_payslip_templates
    ADD CONSTRAINT payroll_payslip_templates_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_run_concept_details payroll_run_concept_details_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details
    ADD CONSTRAINT payroll_run_concept_details_concept_type_id_fkey FOREIGN KEY (concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: payroll_run_concept_details payroll_run_concept_details_entity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details
    ADD CONSTRAINT payroll_run_concept_details_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.payroll_entities(entity_id);


--
-- Name: payroll_run_concept_details payroll_run_concept_details_run_detail_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details
    ADD CONSTRAINT payroll_run_concept_details_run_detail_id_fkey FOREIGN KEY (run_detail_id) REFERENCES public.payroll_run_details(id) ON DELETE CASCADE;


--
-- Name: payroll_run_concept_details payroll_run_concept_details_template_concept_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_concept_details
    ADD CONSTRAINT payroll_run_concept_details_template_concept_id_fkey FOREIGN KEY (template_concept_id) REFERENCES public.payroll_template_concepts(id);


--
-- Name: payroll_run_details payroll_run_details_assignment_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_details
    ADD CONSTRAINT payroll_run_details_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES public.user_payroll_assignment(id);


--
-- Name: payroll_run_details payroll_run_details_run_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_details
    ADD CONSTRAINT payroll_run_details_run_id_fkey FOREIGN KEY (run_id) REFERENCES public.payroll_runs(id) ON DELETE CASCADE;


--
-- Name: payroll_run_details payroll_run_details_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_run_details
    ADD CONSTRAINT payroll_run_details_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id);


--
-- Name: payroll_runs payroll_runs_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: payroll_runs payroll_runs_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: payroll_runs payroll_runs_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: payroll_runs payroll_runs_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_runs
    ADD CONSTRAINT payroll_runs_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: payroll_template_concepts payroll_template_concepts_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts
    ADD CONSTRAINT payroll_template_concepts_concept_type_id_fkey FOREIGN KEY (concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: payroll_template_concepts payroll_template_concepts_entity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts
    ADD CONSTRAINT payroll_template_concepts_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.payroll_entities(entity_id);


--
-- Name: payroll_template_concepts payroll_template_concepts_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_template_concepts
    ADD CONSTRAINT payroll_template_concepts_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.payroll_templates(id) ON DELETE CASCADE;


--
-- Name: payroll_templates payroll_templates_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: payroll_templates payroll_templates_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: payroll_templates payroll_templates_country_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.payroll_countries(id);


--
-- Name: payroll_templates payroll_templates_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: payroll_templates payroll_templates_labor_agreement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_labor_agreement_id_fkey FOREIGN KEY (labor_agreement_id) REFERENCES public.labor_agreements_v2(id);


--
-- Name: payroll_templates payroll_templates_parent_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payroll_templates
    ADD CONSTRAINT payroll_templates_parent_template_id_fkey FOREIGN KEY (parent_template_id) REFERENCES public.payroll_templates(id);


--
-- Name: permissions permissions_UserId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.permissions
    ADD CONSTRAINT "permissions_UserId_fkey" FOREIGN KEY ("UserId") REFERENCES public.users(user_id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: proactive_executions proactive_executions_rule_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.proactive_executions
    ADD CONSTRAINT proactive_executions_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES public.proactive_rules(id);


--
-- Name: procedure_acknowledgements procedure_acknowledgements_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_acknowledgements
    ADD CONSTRAINT procedure_acknowledgements_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_acknowledgements procedure_acknowledgements_procedure_version_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_acknowledgements
    ADD CONSTRAINT procedure_acknowledgements_procedure_version_id_fkey FOREIGN KEY (procedure_version_id) REFERENCES public.procedure_versions(id) ON DELETE SET NULL;


--
-- Name: procedure_acknowledgements procedure_acknowledgements_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_acknowledgements
    ADD CONSTRAINT procedure_acknowledgements_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: procedure_attachments procedure_attachments_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_attachments
    ADD CONSTRAINT procedure_attachments_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_attachments procedure_attachments_procedure_version_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_attachments
    ADD CONSTRAINT procedure_attachments_procedure_version_id_fkey FOREIGN KEY (procedure_version_id) REFERENCES public.procedure_versions(id) ON DELETE SET NULL;


--
-- Name: procedure_attachments procedure_attachments_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_attachments
    ADD CONSTRAINT procedure_attachments_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedure_comments procedure_comments_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_comments
    ADD CONSTRAINT procedure_comments_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_comments procedure_comments_procedure_version_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_comments
    ADD CONSTRAINT procedure_comments_procedure_version_id_fkey FOREIGN KEY (procedure_version_id) REFERENCES public.procedure_versions(id) ON DELETE SET NULL;


--
-- Name: procedure_comments procedure_comments_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_comments
    ADD CONSTRAINT procedure_comments_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedure_comments procedure_comments_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_comments
    ADD CONSTRAINT procedure_comments_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: procedure_draft_locks procedure_draft_locks_locked_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_draft_locks
    ADD CONSTRAINT procedure_draft_locks_locked_by_fkey FOREIGN KEY (locked_by) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: procedure_draft_locks procedure_draft_locks_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_draft_locks
    ADD CONSTRAINT procedure_draft_locks_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_roles procedure_roles_organizational_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_roles
    ADD CONSTRAINT procedure_roles_organizational_position_id_fkey FOREIGN KEY (organizational_position_id) REFERENCES public.organizational_positions(id) ON DELETE CASCADE;


--
-- Name: procedure_roles procedure_roles_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_roles
    ADD CONSTRAINT procedure_roles_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_versions procedure_versions_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_versions
    ADD CONSTRAINT procedure_versions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedure_versions procedure_versions_procedure_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_versions
    ADD CONSTRAINT procedure_versions_procedure_id_fkey FOREIGN KEY (procedure_id) REFERENCES public.procedures(id) ON DELETE CASCADE;


--
-- Name: procedure_versions procedure_versions_published_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedure_versions
    ADD CONSTRAINT procedure_versions_published_by_fkey FOREIGN KEY (published_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedures procedures_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedures procedures_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: procedures procedures_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedures procedures_draft_locked_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_draft_locked_by_fkey FOREIGN KEY (draft_locked_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedures procedures_parent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.procedures(id) ON DELETE RESTRICT;


--
-- Name: procedures procedures_published_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_published_by_fkey FOREIGN KEY (published_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: procedures procedures_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.procedures
    ADD CONSTRAINT procedures_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: report_access_log report_access_log_report_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.report_access_log
    ADD CONSTRAINT report_access_log_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.audit_reports(id) ON DELETE CASCADE;


--
-- Name: role_definitions role_definitions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_definitions
    ADD CONSTRAINT role_definitions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: role_definitions role_definitions_inherits_from_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_definitions
    ADD CONSTRAINT role_definitions_inherits_from_fkey FOREIGN KEY (inherits_from) REFERENCES public.role_definitions(id);


--
-- Name: role_template_permissions role_template_permissions_action_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.role_template_permissions
    ADD CONSTRAINT role_template_permissions_action_id_fkey FOREIGN KEY (action_id) REFERENCES public.module_actions(id);


--
-- Name: salary_categories salary_categories_labor_agreement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories
    ADD CONSTRAINT salary_categories_labor_agreement_id_fkey FOREIGN KEY (labor_agreement_id) REFERENCES public.labor_agreements_catalog(id);


--
-- Name: salary_categories_v2 salary_categories_v2_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories_v2
    ADD CONSTRAINT salary_categories_v2_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: salary_categories_v2 salary_categories_v2_labor_agreement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.salary_categories_v2
    ADD CONSTRAINT salary_categories_v2_labor_agreement_id_fkey FOREIGN KEY (labor_agreement_id) REFERENCES public.labor_agreements_v2(id);


--
-- Name: sanction_history sanction_history_actor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_history
    ADD CONSTRAINT sanction_history_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES public.users(user_id);


--
-- Name: sanction_history sanction_history_sanction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_history
    ADD CONSTRAINT sanction_history_sanction_id_fkey FOREIGN KEY (sanction_id) REFERENCES public.sanctions(id) ON DELETE CASCADE;


--
-- Name: sanction_types sanction_types_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanction_types
    ADD CONSTRAINT sanction_types_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: sanctions sanctions_appeal_resolved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_appeal_resolved_by_fkey FOREIGN KEY (appeal_resolved_by) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: sanctions sanctions_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_hr_confirmation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_hr_confirmation_id_fkey FOREIGN KEY (hr_confirmation_id) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_lawyer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_lawyer_id_fkey FOREIGN KEY (lawyer_id) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_rejected_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_rejected_by_fkey FOREIGN KEY (rejected_by) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_requester_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES public.users(user_id);


--
-- Name: sanctions sanctions_sanction_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_sanction_type_id_fkey FOREIGN KEY (sanction_type_id) REFERENCES public.sanction_types(id);


--
-- Name: sanctions sanctions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sanctions
    ADD CONSTRAINT sanctions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: sectors sectors_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sectors
    ADD CONSTRAINT sectors_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: sectors sectors_department_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sectors
    ADD CONSTRAINT sectors_department_id_fkey FOREIGN KEY (department_id) REFERENCES public.departments(id) ON DELETE CASCADE;


--
-- Name: sectors sectors_supervisor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.sectors
    ADD CONSTRAINT sectors_supervisor_id_fkey FOREIGN KEY (supervisor_id) REFERENCES public.users(user_id);


--
-- Name: shifts shifts_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.shifts
    ADD CONSTRAINT shifts_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id) ON DELETE SET NULL;


--
-- Name: shifts shifts_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.shifts
    ADD CONSTRAINT shifts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: siac_cajas siac_cajas_punto_venta_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_cajas
    ADD CONSTRAINT siac_cajas_punto_venta_id_fkey FOREIGN KEY (punto_venta_id) REFERENCES public.siac_puntos_venta(id) ON DELETE CASCADE;


--
-- Name: siac_facturas siac_facturas_caja_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT siac_facturas_caja_id_fkey FOREIGN KEY (caja_id) REFERENCES public.siac_cajas(id) ON DELETE RESTRICT;


--
-- Name: siac_facturas_impuestos siac_facturas_impuestos_factura_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_impuestos
    ADD CONSTRAINT siac_facturas_impuestos_factura_id_fkey FOREIGN KEY (factura_id) REFERENCES public.siac_facturas(id) ON DELETE CASCADE;


--
-- Name: siac_facturas_items siac_facturas_items_factura_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_items
    ADD CONSTRAINT siac_facturas_items_factura_id_fkey FOREIGN KEY (factura_id) REFERENCES public.siac_facturas(id) ON DELETE CASCADE;


--
-- Name: siac_facturas_pagos siac_facturas_pagos_factura_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas_pagos
    ADD CONSTRAINT siac_facturas_pagos_factura_id_fkey FOREIGN KEY (factura_id) REFERENCES public.siac_facturas(id) ON DELETE CASCADE;


--
-- Name: siac_facturas siac_facturas_tipo_comprobante_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_facturas
    ADD CONSTRAINT siac_facturas_tipo_comprobante_id_fkey FOREIGN KEY (tipo_comprobante_id) REFERENCES public.siac_tipos_comprobantes(id) ON DELETE RESTRICT;


--
-- Name: siac_numeracion_comprobantes siac_numeracion_comprobantes_caja_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_comprobantes
    ADD CONSTRAINT siac_numeracion_comprobantes_caja_id_fkey FOREIGN KEY (caja_id) REFERENCES public.siac_cajas(id) ON DELETE CASCADE;


--
-- Name: siac_numeracion_comprobantes siac_numeracion_comprobantes_tipo_comprobante_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_numeracion_comprobantes
    ADD CONSTRAINT siac_numeracion_comprobantes_tipo_comprobante_id_fkey FOREIGN KEY (tipo_comprobante_id) REFERENCES public.siac_tipos_comprobantes(id) ON DELETE CASCADE;


--
-- Name: siac_productos siac_productos_categoria_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos
    ADD CONSTRAINT siac_productos_categoria_id_fkey FOREIGN KEY (categoria_id) REFERENCES public.siac_productos_categorias(id);


--
-- Name: siac_productos_categorias siac_productos_categorias_categoria_padre_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_categorias
    ADD CONSTRAINT siac_productos_categorias_categoria_padre_id_fkey FOREIGN KEY (categoria_padre_id) REFERENCES public.siac_productos_categorias(id);


--
-- Name: siac_productos_componentes siac_productos_componentes_producto_componente_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_componentes
    ADD CONSTRAINT siac_productos_componentes_producto_componente_id_fkey FOREIGN KEY (producto_componente_id) REFERENCES public.siac_productos(id) ON DELETE CASCADE;


--
-- Name: siac_productos_componentes siac_productos_componentes_producto_padre_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_componentes
    ADD CONSTRAINT siac_productos_componentes_producto_padre_id_fkey FOREIGN KEY (producto_padre_id) REFERENCES public.siac_productos(id) ON DELETE CASCADE;


--
-- Name: siac_productos siac_productos_marca_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos
    ADD CONSTRAINT siac_productos_marca_id_fkey FOREIGN KEY (marca_id) REFERENCES public.siac_productos_marcas(id);


--
-- Name: siac_productos_precios siac_productos_precios_lista_precios_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_precios
    ADD CONSTRAINT siac_productos_precios_lista_precios_id_fkey FOREIGN KEY (lista_precios_id) REFERENCES public.siac_listas_precios(id) ON DELETE CASCADE;


--
-- Name: siac_productos_precios siac_productos_precios_producto_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_productos_precios
    ADD CONSTRAINT siac_productos_precios_producto_id_fkey FOREIGN KEY (producto_id) REFERENCES public.siac_productos(id) ON DELETE CASCADE;


--
-- Name: siac_puntos_venta siac_puntos_venta_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_puntos_venta
    ADD CONSTRAINT siac_puntos_venta_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: siac_sesiones_caja siac_sesiones_caja_caja_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_sesiones_caja
    ADD CONSTRAINT siac_sesiones_caja_caja_id_fkey FOREIGN KEY (caja_id) REFERENCES public.siac_cajas(id) ON DELETE RESTRICT;


--
-- Name: siac_stock_movimientos siac_stock_movimientos_producto_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_stock_movimientos
    ADD CONSTRAINT siac_stock_movimientos_producto_id_fkey FOREIGN KEY (producto_id) REFERENCES public.siac_productos(id);


--
-- Name: siac_tipos_comprobantes siac_tipos_comprobantes_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.siac_tipos_comprobantes
    ADD CONSTRAINT siac_tipos_comprobantes_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: support_activity_log support_activity_log_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_activity_log
    ADD CONSTRAINT support_activity_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: support_activity_log support_activity_log_support_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_activity_log
    ADD CONSTRAINT support_activity_log_support_user_id_fkey FOREIGN KEY (support_user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_activity_log support_activity_log_ticket_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_activity_log
    ADD CONSTRAINT support_activity_log_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(ticket_id) ON DELETE CASCADE;


--
-- Name: support_assistant_attempts support_assistant_attempts_ticket_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_assistant_attempts
    ADD CONSTRAINT support_assistant_attempts_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(ticket_id) ON DELETE CASCADE;


--
-- Name: support_escalations support_escalations_escalated_from_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_escalations
    ADD CONSTRAINT support_escalations_escalated_from_user_id_fkey FOREIGN KEY (escalated_from_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_escalations support_escalations_escalated_to_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_escalations
    ADD CONSTRAINT support_escalations_escalated_to_user_id_fkey FOREIGN KEY (escalated_to_user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_escalations support_escalations_ticket_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_escalations
    ADD CONSTRAINT support_escalations_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(ticket_id) ON DELETE CASCADE;


--
-- Name: support_ticket_escalations support_ticket_escalations_from_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_escalations
    ADD CONSTRAINT support_ticket_escalations_from_staff_id_fkey FOREIGN KEY (from_staff_id) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: support_ticket_escalations support_ticket_escalations_ticket_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_escalations
    ADD CONSTRAINT support_ticket_escalations_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(ticket_id);


--
-- Name: support_ticket_escalations support_ticket_escalations_to_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_escalations
    ADD CONSTRAINT support_ticket_escalations_to_staff_id_fkey FOREIGN KEY (to_staff_id) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: support_ticket_messages support_ticket_messages_ticket_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_messages
    ADD CONSTRAINT support_ticket_messages_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(ticket_id) ON DELETE CASCADE;


--
-- Name: support_ticket_messages support_ticket_messages_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_ticket_messages
    ADD CONSTRAINT support_ticket_messages_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_tickets support_tickets_assigned_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_assigned_staff_id_fkey FOREIGN KEY (assigned_staff_id) REFERENCES public.aponnt_staff(staff_id);


--
-- Name: support_tickets support_tickets_assigned_to_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_assigned_to_vendor_id_fkey FOREIGN KEY (assigned_to_vendor_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_tickets support_tickets_closed_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_closed_by_user_id_fkey FOREIGN KEY (closed_by_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_tickets support_tickets_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: support_tickets support_tickets_created_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_created_by_user_id_fkey FOREIGN KEY (created_by_user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_tickets support_tickets_escalated_to_supervisor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_escalated_to_supervisor_id_fkey FOREIGN KEY (escalated_to_supervisor_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_tickets support_tickets_temp_support_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_temp_support_user_id_fkey FOREIGN KEY (temp_support_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_vendor_stats support_vendor_stats_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_stats
    ADD CONSTRAINT support_vendor_stats_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_vendor_supervisors support_vendor_supervisors_assigned_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_supervisors
    ADD CONSTRAINT support_vendor_supervisors_assigned_by_user_id_fkey FOREIGN KEY (assigned_by_user_id) REFERENCES public.users(user_id) ON DELETE SET NULL;


--
-- Name: support_vendor_supervisors support_vendor_supervisors_supervisor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_supervisors
    ADD CONSTRAINT support_vendor_supervisors_supervisor_id_fkey FOREIGN KEY (supervisor_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: support_vendor_supervisors support_vendor_supervisors_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.support_vendor_supervisors
    ADD CONSTRAINT support_vendor_supervisors_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: suspension_blocks suspension_blocks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks
    ADD CONSTRAINT suspension_blocks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: suspension_blocks suspension_blocks_deactivated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks
    ADD CONSTRAINT suspension_blocks_deactivated_by_fkey FOREIGN KEY (deactivated_by) REFERENCES public.users(user_id);


--
-- Name: suspension_blocks suspension_blocks_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks
    ADD CONSTRAINT suspension_blocks_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: suspension_blocks suspension_blocks_sanction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.suspension_blocks
    ADD CONSTRAINT suspension_blocks_sanction_id_fkey FOREIGN KEY (sanction_id) REFERENCES public.sanctions(id) ON DELETE CASCADE;


--
-- Name: task_compatibility task_compatibility_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility
    ADD CONSTRAINT task_compatibility_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: task_compatibility task_compatibility_cover_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility
    ADD CONSTRAINT task_compatibility_cover_user_id_fkey FOREIGN KEY (cover_user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: task_compatibility task_compatibility_primary_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_compatibility
    ADD CONSTRAINT task_compatibility_primary_user_id_fkey FOREIGN KEY (primary_user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: tax_concepts tax_concepts_tax_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_concepts
    ADD CONSTRAINT tax_concepts_tax_template_id_fkey FOREIGN KEY (tax_template_id) REFERENCES public.tax_templates(id) ON DELETE CASCADE;


--
-- Name: tax_conditions tax_conditions_tax_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_conditions
    ADD CONSTRAINT tax_conditions_tax_template_id_fkey FOREIGN KEY (tax_template_id) REFERENCES public.tax_templates(id) ON DELETE CASCADE;


--
-- Name: tax_rates tax_rates_tax_concept_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tax_rates
    ADD CONSTRAINT tax_rates_tax_concept_id_fkey FOREIGN KEY (tax_concept_id) REFERENCES public.tax_concepts(id) ON DELETE CASCADE;


--
-- Name: test_executions test_executions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.test_executions
    ADD CONSTRAINT test_executions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: training_assignments training_assignments_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.training_assignments
    ADD CONSTRAINT training_assignments_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: training_assignments training_assignments_training_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.training_assignments
    ADD CONSTRAINT training_assignments_training_id_fkey FOREIGN KEY (training_id) REFERENCES public.trainings(id) ON DELETE CASCADE;


--
-- Name: training_assignments training_assignments_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.training_assignments
    ADD CONSTRAINT training_assignments_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: trainings trainings_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trainings
    ADD CONSTRAINT trainings_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: trainings trainings_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.trainings
    ADD CONSTRAINT trainings_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: unauthorized_access_attempts unauthorized_access_attempts_employee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unauthorized_access_attempts
    ADD CONSTRAINT unauthorized_access_attempts_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.users(user_id);


--
-- Name: unauthorized_access_attempts unauthorized_access_attempts_kiosk_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unauthorized_access_attempts
    ADD CONSTRAINT unauthorized_access_attempts_kiosk_id_fkey FOREIGN KEY (kiosk_id) REFERENCES public.kiosks(id);


--
-- Name: unified_notifications unified_notifications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unified_notifications
    ADD CONSTRAINT unified_notifications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: unified_notifications unified_notifications_escalated_from_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unified_notifications
    ADD CONSTRAINT unified_notifications_escalated_from_id_fkey FOREIGN KEY (escalated_from_id) REFERENCES public.unified_notifications(id);


--
-- Name: unified_notifications unified_notifications_parent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.unified_notifications
    ADD CONSTRAINT unified_notifications_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.unified_notifications(id) ON DELETE SET NULL;


--
-- Name: used_tokens used_tokens_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.used_tokens
    ADD CONSTRAINT used_tokens_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.notification_messages(id);


--
-- Name: user_activity_restrictions user_activity_restrictions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_activity_restrictions
    ADD CONSTRAINT user_activity_restrictions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_activity_restrictions user_activity_restrictions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_activity_restrictions
    ADD CONSTRAINT user_activity_restrictions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_allergies user_allergies_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_allergies
    ADD CONSTRAINT user_allergies_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_allergies user_allergies_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_allergies
    ADD CONSTRAINT user_allergies_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_assigned_tasks user_assigned_tasks_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: user_assigned_tasks user_assigned_tasks_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(user_id);


--
-- Name: user_assigned_tasks user_assigned_tasks_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_assigned_tasks user_assigned_tasks_task_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.company_tasks(id) ON DELETE CASCADE;


--
-- Name: user_assigned_tasks user_assigned_tasks_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_assigned_tasks
    ADD CONSTRAINT user_assigned_tasks_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_children user_children_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_children
    ADD CONSTRAINT user_children_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_children user_children_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_children
    ADD CONSTRAINT user_children_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_chronic_conditions user_chronic_conditions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions
    ADD CONSTRAINT user_chronic_conditions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_chronic_conditions user_chronic_conditions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions
    ADD CONSTRAINT user_chronic_conditions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_chronic_conditions_v2 user_chronic_conditions_v2_condition_catalog_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_chronic_conditions_v2
    ADD CONSTRAINT user_chronic_conditions_v2_condition_catalog_id_fkey FOREIGN KEY (condition_catalog_id) REFERENCES public.chronic_conditions_catalog(id);


--
-- Name: user_consents user_consents_consent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_consents
    ADD CONSTRAINT user_consents_consent_id_fkey FOREIGN KEY (consent_id) REFERENCES public.consent_definitions(consent_id) ON DELETE CASCADE;


--
-- Name: user_contact_history user_contact_history_changed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contact_history
    ADD CONSTRAINT user_contact_history_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES public.users(user_id);


--
-- Name: user_contact_history user_contact_history_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contact_history
    ADD CONSTRAINT user_contact_history_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_contact_history user_contact_history_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_contact_history
    ADD CONSTRAINT user_contact_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_disciplinary_actions user_disciplinary_actions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_disciplinary_actions
    ADD CONSTRAINT user_disciplinary_actions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_disciplinary_actions user_disciplinary_actions_issued_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_disciplinary_actions
    ADD CONSTRAINT user_disciplinary_actions_issued_by_fkey FOREIGN KEY (issued_by) REFERENCES public.users(user_id);


--
-- Name: user_disciplinary_actions user_disciplinary_actions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_disciplinary_actions
    ADD CONSTRAINT user_disciplinary_actions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_documents user_documents_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_documents
    ADD CONSTRAINT user_documents_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_documents user_documents_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_documents
    ADD CONSTRAINT user_documents_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_driver_licenses user_driver_licenses_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_driver_licenses
    ADD CONSTRAINT user_driver_licenses_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_driver_licenses user_driver_licenses_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_driver_licenses
    ADD CONSTRAINT user_driver_licenses_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_education user_education_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_education
    ADD CONSTRAINT user_education_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_education user_education_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_education
    ADD CONSTRAINT user_education_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_emails user_emails_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emails
    ADD CONSTRAINT user_emails_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_emails user_emails_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emails
    ADD CONSTRAINT user_emails_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_emergency_contacts user_emergency_contacts_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_emergency_contacts
    ADD CONSTRAINT user_emergency_contacts_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_family_members user_family_members_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_family_members
    ADD CONSTRAINT user_family_members_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_family_members user_family_members_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_family_members
    ADD CONSTRAINT user_family_members_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_household_members user_household_members_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_household_members
    ADD CONSTRAINT user_household_members_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_legal_issues user_legal_issues_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues
    ADD CONSTRAINT user_legal_issues_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_legal_issues user_legal_issues_deleted_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues
    ADD CONSTRAINT user_legal_issues_deleted_by_fkey FOREIGN KEY (deleted_by) REFERENCES public.users(user_id);


--
-- Name: user_legal_issues user_legal_issues_last_edited_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues
    ADD CONSTRAINT user_legal_issues_last_edited_by_fkey FOREIGN KEY (last_edited_by) REFERENCES public.users(user_id);


--
-- Name: user_legal_issues user_legal_issues_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_legal_issues
    ADD CONSTRAINT user_legal_issues_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_marital_status user_marital_status_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_marital_status
    ADD CONSTRAINT user_marital_status_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_marital_status user_marital_status_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_marital_status
    ADD CONSTRAINT user_marital_status_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_medical_documents user_medical_documents_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_documents
    ADD CONSTRAINT user_medical_documents_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_medical_documents user_medical_documents_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_documents
    ADD CONSTRAINT user_medical_documents_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_medical_exams user_medical_exams_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_exams
    ADD CONSTRAINT user_medical_exams_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_medical_exams user_medical_exams_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medical_exams
    ADD CONSTRAINT user_medical_exams_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_medications user_medications_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medications
    ADD CONSTRAINT user_medications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_medications user_medications_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_medications
    ADD CONSTRAINT user_medications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_notification_preferences user_notification_preferences_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_notification_preferences
    ADD CONSTRAINT user_notification_preferences_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_payroll_assignment user_payroll_assignment_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.company_branches(id);


--
-- Name: user_payroll_assignment user_payroll_assignment_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.salary_categories_v2(id);


--
-- Name: user_payroll_assignment user_payroll_assignment_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: user_payroll_assignment user_payroll_assignment_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: user_payroll_assignment user_payroll_assignment_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.payroll_templates(id);


--
-- Name: user_payroll_assignment user_payroll_assignment_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_assignment
    ADD CONSTRAINT user_payroll_assignment_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_payroll_bonuses user_payroll_bonuses_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: user_payroll_bonuses user_payroll_bonuses_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id);


--
-- Name: user_payroll_bonuses user_payroll_bonuses_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_concept_type_id_fkey FOREIGN KEY (concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: user_payroll_bonuses user_payroll_bonuses_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: user_payroll_bonuses user_payroll_bonuses_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_bonuses
    ADD CONSTRAINT user_payroll_bonuses_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_assignment_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES public.user_payroll_assignment(id) ON DELETE CASCADE;


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_concept_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_concept_type_id_fkey FOREIGN KEY (concept_type_id) REFERENCES public.payroll_concept_types(id);


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_template_concept_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_template_concept_id_fkey FOREIGN KEY (template_concept_id) REFERENCES public.payroll_template_concepts(id);


--
-- Name: user_payroll_concept_overrides user_payroll_concept_overrides_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_payroll_concept_overrides
    ADD CONSTRAINT user_payroll_concept_overrides_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_permission_requests user_permission_requests_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permission_requests
    ADD CONSTRAINT user_permission_requests_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: user_permission_requests user_permission_requests_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permission_requests
    ADD CONSTRAINT user_permission_requests_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_permission_requests user_permission_requests_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permission_requests
    ADD CONSTRAINT user_permission_requests_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_permissions user_permissions_action_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permissions
    ADD CONSTRAINT user_permissions_action_id_fkey FOREIGN KEY (action_id) REFERENCES public.module_actions(id);


--
-- Name: user_permissions user_permissions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permissions
    ADD CONSTRAINT user_permissions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_permissions user_permissions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_permissions
    ADD CONSTRAINT user_permissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_primary_physician user_primary_physician_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_primary_physician
    ADD CONSTRAINT user_primary_physician_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_primary_physician user_primary_physician_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_primary_physician
    ADD CONSTRAINT user_primary_physician_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_professional_licenses user_professional_licenses_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_professional_licenses
    ADD CONSTRAINT user_professional_licenses_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_professional_licenses user_professional_licenses_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_professional_licenses
    ADD CONSTRAINT user_professional_licenses_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_role_assignments user_role_assignments_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(user_id);


--
-- Name: user_role_assignments user_role_assignments_deactivated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_deactivated_by_fkey FOREIGN KEY (deactivated_by) REFERENCES public.users(user_id);


--
-- Name: user_role_assignments user_role_assignments_role_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.role_definitions(id) ON DELETE CASCADE;


--
-- Name: user_role_assignments user_role_assignments_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_role_assignments
    ADD CONSTRAINT user_role_assignments_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_salary_config user_salary_config_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config
    ADD CONSTRAINT user_salary_config_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_salary_config user_salary_config_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config
    ADD CONSTRAINT user_salary_config_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(user_id);


--
-- Name: user_salary_config user_salary_config_last_updated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config
    ADD CONSTRAINT user_salary_config_last_updated_by_fkey FOREIGN KEY (last_updated_by) REFERENCES public.users(user_id);


--
-- Name: user_salary_config user_salary_config_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config
    ADD CONSTRAINT user_salary_config_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_salary_config_v2 user_salary_config_v2_labor_agreement_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config_v2
    ADD CONSTRAINT user_salary_config_v2_labor_agreement_id_fkey FOREIGN KEY (labor_agreement_id) REFERENCES public.labor_agreements_catalog(id);


--
-- Name: user_salary_config_v2 user_salary_config_v2_salary_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_salary_config_v2
    ADD CONSTRAINT user_salary_config_v2_salary_category_id_fkey FOREIGN KEY (salary_category_id) REFERENCES public.salary_categories(id);


--
-- Name: user_sports_activities user_sports_activities_sport_catalog_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_sports_activities
    ADD CONSTRAINT user_sports_activities_sport_catalog_id_fkey FOREIGN KEY (sport_catalog_id) REFERENCES public.sports_catalog(id);


--
-- Name: user_union_affiliation user_union_affiliation_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_union_affiliation
    ADD CONSTRAINT user_union_affiliation_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_union_affiliation user_union_affiliation_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_union_affiliation
    ADD CONSTRAINT user_union_affiliation_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_vaccinations user_vaccinations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_vaccinations
    ADD CONSTRAINT user_vaccinations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_vaccinations user_vaccinations_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_vaccinations
    ADD CONSTRAINT user_vaccinations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_work_history user_work_history_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_history
    ADD CONSTRAINT user_work_history_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_work_history user_work_history_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_history
    ADD CONSTRAINT user_work_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: user_work_restrictions user_work_restrictions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_restrictions
    ADD CONSTRAINT user_work_restrictions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: user_work_restrictions user_work_restrictions_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_work_restrictions
    ADD CONSTRAINT user_work_restrictions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: users users_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id) ON DELETE SET NULL;


--
-- Name: users users_default_branch_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_default_branch_id_fkey FOREIGN KEY (default_branch_id) REFERENCES public.branches(id) ON DELETE SET NULL;


--
-- Name: users users_organizational_position_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_organizational_position_id_fkey FOREIGN KEY (organizational_position_id) REFERENCES public.organizational_positions(id);


--
-- Name: users users_salary_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_salary_category_id_fkey FOREIGN KEY (salary_category_id) REFERENCES public.salary_categories_v2(id);


--
-- Name: users users_sector_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_sector_id_fkey FOREIGN KEY (sector_id) REFERENCES public.sectors(id);


--
-- Name: vacation_configurations vacation_configurations_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_configurations
    ADD CONSTRAINT vacation_configurations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: vacation_requests vacation_requests_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_requests
    ADD CONSTRAINT vacation_requests_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(user_id);


--
-- Name: vacation_requests vacation_requests_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_requests
    ADD CONSTRAINT vacation_requests_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: vacation_requests vacation_requests_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_requests
    ADD CONSTRAINT vacation_requests_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: vacation_scales vacation_scales_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vacation_scales
    ADD CONSTRAINT vacation_scales_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: vendor_commissions vendor_commissions_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions
    ADD CONSTRAINT vendor_commissions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: vendor_commissions vendor_commissions_referral_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_commissions
    ADD CONSTRAINT vendor_commissions_referral_id_fkey FOREIGN KEY (referral_id) REFERENCES public.vendor_referrals(id) ON DELETE SET NULL;


--
-- Name: vendor_ratings vendor_ratings_company_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_ratings
    ADD CONSTRAINT vendor_ratings_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(company_id) ON DELETE CASCADE;


--
-- Name: vendor_ratings vendor_ratings_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_ratings
    ADD CONSTRAINT vendor_ratings_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: vendor_referrals vendor_referrals_referred_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals
    ADD CONSTRAINT vendor_referrals_referred_id_fkey FOREIGN KEY (referred_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- Name: vendor_referrals vendor_referrals_referrer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vendor_referrals
    ADD CONSTRAINT vendor_referrals_referrer_id_fkey FOREIGN KEY (referrer_id) REFERENCES public.users(user_id) ON DELETE CASCADE;


--
-- PostgreSQL database dump complete
--

\unrestrict bzCMb2LlePJtvACPfEvlBrY4KgeROMn3aJ6ajt7cgYcFCAfBymn6lBDo54JjAlX

