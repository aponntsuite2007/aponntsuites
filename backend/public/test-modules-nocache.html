<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TEST - Verificar kiosks-apk NO aparece</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .module { padding: 10px; margin: 5px 0; background: white; border-left: 4px solid #4CAF50; }
        .apk { border-left-color: red !important; background: #ffe0e0; }
        h1 { color: #333; }
        pre { background: #f9f9f9; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ TEST - Verificar Filtros SSOT</h1>
    <p><strong>Objetivo:</strong> Verificar que kiosks-apk NO aparece en la API</p>

    <div id="result"></div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>‚è≥ Consultando API...</p>';

            try {
                const response = await fetch('/api/v1/company-modules/11', {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });

                const data = await response.json();

                if (!data.success) {
                    resultDiv.innerHTML = `<p class="error">‚ùå Error: ${data.error || 'API fall√≥'}</p>`;
                    return;
                }

                const modules = data.modules || [];
                const total = modules.length;

                // Buscar kiosks-apk
                const kioskApk = modules.find(m => m.module_key === 'kiosks-apk');
                const kiosks = modules.find(m => m.module_key === 'kiosks');

                let html = '<h2>üìä Resultados:</h2>';
                html += `<p><strong>Total m√≥dulos:</strong> ${total}</p>`;

                if (kioskApk) {
                    html += '<p class="error">‚ùå ERROR: kiosks-apk APARECE en la API (NO DEBER√çA)</p>';
                    html += '<div class="module apk">‚ö†Ô∏è kiosks-apk encontrado: ' + JSON.stringify(kioskApk) + '</div>';
                } else {
                    html += '<p class="success">‚úÖ CORRECTO: kiosks-apk NO aparece en la API</p>';
                }

                if (kiosks) {
                    html += '<p class="success">‚úÖ CORRECTO: kiosks S√ç aparece (m√≥dulo padre)</p>';
                    html += '<div class="module">üìü kiosks: ' + kiosks.name + '</div>';
                } else {
                    html += '<p class="error">‚ùå ERROR: kiosks NO aparece (DEBER√çA)</p>';
                }

                html += '<h3>üìã Lista de m√≥dulos:</h3>';
                html += '<pre>' + modules.map(m => `- ${m.module_key} (${m.name})`).join('\\n') + '</pre>';

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error consultando API: ${error.message}</p>`;
            }
        }

        // Ejecutar al cargar
        testAPI();

        // Agregar bot√≥n para refrescar
        setTimeout(() => {
            const btn = document.createElement('button');
            btn.textContent = 'üîÑ Refrescar Test';
            btn.style.cssText = 'padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 20px;';
            btn.onclick = testAPI;
            document.body.appendChild(btn);
        }, 1000);
    </script>
</body>
</html>
