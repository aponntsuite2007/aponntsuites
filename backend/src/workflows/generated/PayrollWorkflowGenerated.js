/**
 * ============================================================================
 * PAYROLL WORKFLOW - AUTO-GENERATED
 * ============================================================================
 *
 * ⚠️ ARCHIVO AUTO-GENERADO - NO EDITAR MANUALMENTE
 *
 * Este archivo es regenerado automáticamente por UniversalWorkflowGenerator
 * cuando cambia el código de los servicios relacionados.
 *
 * FUENTES:
 * * - PayrollService.js
 * * - PayrollLiquidationService.js
 *
 * Brain detecta este archivo via LIVE_CODE_SCAN y extrae los STAGES.
 * Cualquier cambio en los servicios fuente regenerará este archivo.
 *
 * Generado: 2025-12-15T17:51:00.595Z
 * Versión: 2.0.20251215-auto
 * Módulo: payroll
 *
 * ESTADÍSTICAS:
 * - Total stages: 8
 * - Core: 5
 * - Existentes: 0
 * - Auto-generados: 0
 * - Estados finales: 3
 *
 * ============================================================================
 */

class PayrollWorkflowGenerated {
    /**
     * STAGES - Detectados automáticamente por Brain via LIVE_CODE_SCAN
     */
    static STAGES = {
        PERIOD_OPENED: {
            name: 'Período Abierto',
            order: 1,
            category: 'intake',
            description: 'Stage core de Payroll Workflow',
            transitions_to: [],
            isCore: true,
        },

        DATA_COLLECTION: {
            name: 'Recolección de Datos',
            order: 2,
            category: 'process',
            description: 'Stage core de Payroll Workflow',
            transitions_to: [],
            isCore: true,
        },

        CALCULATION: {
            name: 'Cálculo',
            order: 3,
            category: 'process',
            description: 'Stage core de Payroll Workflow',
            transitions_to: [],
            isCore: true,
        },

        REVIEW: {
            name: 'Revisión',
            order: 4,
            category: 'validation',
            description: 'Stage core de Payroll Workflow',
            transitions_to: [],
            isCore: true,
        },

        PAYMENT: {
            name: 'Pago',
            order: 5,
            category: 'outcome',
            description: 'Stage core de Payroll Workflow',
            transitions_to: [],
            isCore: true,
        },

        PAYROLL_COMPLETED: {
            name: 'Liquidación Completada',
            order: 6,
            category: 'success',
            description: 'Estado final',
            transitions_to: [],
            is_final: true,
            is_success: true,
        },

        PAYROLL_ERROR: {
            name: 'Error en Liquidación',
            order: 7,
            category: 'rejection',
            description: 'Estado final',
            transitions_to: [],
            is_final: true,
            is_rejection: true,
        },

        PERIOD_CLOSED: {
            name: 'Período Cerrado',
            order: 8,
            category: 'final',
            description: 'Estado final',
            transitions_to: [],
            is_final: true,
        },

    };

    /**
     * WORKFLOW METADATA
     */
    static WORKFLOW_METADATA = {
        name: 'Payroll Workflow',
        module: 'payroll',
        version: '2.0.20251215-auto',
        isAutoGenerated: true,
        generatedAt: '2025-12-15T17:51:00.595Z',
        sourceFiles: ["PayrollService.js","PayrollLiquidationService.js"],
        entry_point: 'PERIOD_OPENED',
        final_states: {
            success: ["PAYROLL_COMPLETED"],
            rejection: ["PAYROLL_ERROR"]
        },
        stats: {"total":8,"core":5,"existing":0,"autoGenerated":0,"outcomes":3}
    };

    /**
     * Obtener stages en orden
     */
    static getStagesInOrder() {
        return Object.entries(this.STAGES)
            .map(([key, stage]) => ({ key, ...stage }))
            .sort((a, b) => (a.order || 999) - (b.order || 999));
    }

    /**
     * Obtener stages finales
     */
    static getFinalStages() {
        return Object.entries(this.STAGES)
            .filter(([_, stage]) => stage.is_final)
            .map(([key, stage]) => ({ key, ...stage }));
    }

    /**
     * Validar transición
     */
    static isValidTransition(fromStage, toStage) {
        const from = this.STAGES[fromStage];
        if (!from || !from.transitions_to) return false;
        return from.transitions_to.includes(toStage);
    }

    /**
     * Obtener siguiente stage sugerido
     */
    static getNextSuggestedStage(currentStage) {
        const current = this.STAGES[currentStage];
        if (!current || !current.transitions_to || current.transitions_to.length === 0) return null;
        return current.transitions_to[0];
    }

    /**
     * Obtener tutorial steps para este workflow
     */
    static getTutorialSteps() {
        return this.getStagesInOrder()
            .filter(s => !s.is_final)
            .map((stage, index) => ({
                step: index + 1,
                stageId: stage.key,
                title: stage.name,
                description: stage.description || '',
                category: stage.category,
                validations: stage.validations || [],
                nextStages: stage.transitions_to || []
            }));
    }
}

module.exports = PayrollWorkflowGenerated;
