/**
 * ============================================================================
 * PROCEDURES WORKFLOW - AUTO-GENERATED
 * ============================================================================
 *
 * ⚠️ ARCHIVO AUTO-GENERADO - NO EDITAR MANUALMENTE
 *
 * Este archivo es regenerado automáticamente por UniversalWorkflowGenerator
 * cuando cambia el código de los servicios relacionados.
 *
 * FUENTES:
 * * - ProceduresService.js
 *
 * Brain detecta este archivo via LIVE_CODE_SCAN y extrae los STAGES.
 * Cualquier cambio en los servicios fuente regenerará este archivo.
 *
 * Generado: 2026-01-28T03:59:02.068Z
 * Versión: 2.0.20260128-auto
 * Módulo: procedures
 *
 * ESTADÍSTICAS:
 * - Total stages: 25
 * - Core: 3
 * - Existentes: 0
 * - Auto-generados: 20
 * - Estados finales: 2
 *
 * ============================================================================
 */

class ProceduresWorkflowGenerated {
    /**
     * STAGES - Detectados automáticamente por Brain via LIVE_CODE_SCAN
     */
    static STAGES = {
        PROCEDURE_INITIATED: {
            name: 'Procedimiento Iniciado',
            order: 1,
            category: 'intake',
            description: 'Stage core de Procedures Workflow',
            transitions_to: [],
            isCore: true,
        },

        EXECUTION: {
            name: 'Ejecución',
            order: 2,
            category: 'process',
            description: 'Stage core de Procedures Workflow',
            transitions_to: [],
            isCore: true,
        },

        COMPLETION: {
            name: 'Completado',
            order: 3,
            category: 'outcome',
            description: 'Stage core de Procedures Workflow',
            transitions_to: [],
            isCore: true,
        },

        CREATE: {
            name: 'Create',
            order: 4,
            category: 'persistence',
            description: 'Auto-detectado desde ProceduresService.create()',
            source: {
                file: 'ProceduresService.js',
                function: 'create',
                line: 37
            },
            validations: ["docType !== 'politica' && !data.parent_id","docType === 'politica' && data.parent_id"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_BY_ID: {
            name: 'Get By Id',
            order: 5,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getById()',
            source: {
                file: 'ProceduresService.js',
                function: 'getById',
                line: 127
            },
            validations: ["procedures || procedures.length === 0"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        UPDATE: {
            name: 'Update',
            order: 6,
            category: 'process',
            description: 'Auto-detectado desde ProceduresService.update()',
            source: {
                file: 'ProceduresService.js',
                function: 'update',
                line: 256
            },
            validations: ["current || current.length === 0","current[0].status !== 'draft'"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        ASSIGN_ROLES: {
            name: 'Assign Roles',
            order: 7,
            category: 'process',
            description: 'Auto-detectado desde ProceduresService.assignRoles()',
            source: {
                file: 'ProceduresService.js',
                function: 'assignRoles',
                line: 383
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_TARGET_USERS: {
            name: 'Get Target Users',
            order: 8,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getTargetUsers()',
            source: {
                file: 'ProceduresService.js',
                function: 'getTargetUsers',
                line: 420
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        CREATE_NEW_VERSION: {
            name: 'Create New Version',
            order: 9,
            category: 'persistence',
            description: 'Auto-detectado desde ProceduresService.createNewVersion()',
            source: {
                file: 'ProceduresService.js',
                function: 'createNewVersion',
                line: 603
            },
            validations: ["procedures || procedures.length === 0","procedure.status !== 'published'"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_PENDING_ACKNOWLEDGEMENTS: {
            name: 'Get Pending Acknowledgements',
            order: 10,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getPendingAcknowledgements()',
            source: {
                file: 'ProceduresService.js',
                function: 'getPendingAcknowledgements',
                line: 724
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_EMPLOYEE_PROCEDURES: {
            name: 'Get Employee Procedures',
            order: 11,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getEmployeeProcedures()',
            source: {
                file: 'ProceduresService.js',
                function: 'getEmployeeProcedures',
                line: 763
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_EMPLOYEE_PROCEDURES_SUMMARY: {
            name: 'Get Employee Procedures Summary',
            order: 12,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getEmployeeProceduresSummary()',
            source: {
                file: 'ProceduresService.js',
                function: 'getEmployeeProceduresSummary',
                line: 813
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GENERATE_CODE: {
            name: 'Generate Code',
            order: 13,
            category: 'process',
            description: 'Auto-detectado desde ProceduresService.generateCode()',
            source: {
                file: 'ProceduresService.js',
                function: 'generateCode',
                line: 878
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        SEND_PUBLICATION_NOTIFICATIONS: {
            name: 'Send Publication Notifications',
            order: 14,
            category: 'notification',
            description: 'Auto-detectado desde ProceduresService.sendPublicationNotifications()',
            source: {
                file: 'ProceduresService.js',
                function: 'sendPublicationNotifications',
                line: 902
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_SCOPE_ENTITIES: {
            name: 'Get Scope Entities',
            order: 15,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getScopeEntities()',
            source: {
                file: 'ProceduresService.js',
                function: 'getScopeEntities',
                line: 945
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_SCOPE_USERS: {
            name: 'Get Scope Users',
            order: 16,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getScopeUsers()',
            source: {
                file: 'ProceduresService.js',
                function: 'getScopeUsers',
                line: 1069
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_DRAFT_LOCK_STATUS: {
            name: 'Get Draft Lock Status',
            order: 17,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getDraftLockStatus()',
            source: {
                file: 'ProceduresService.js',
                function: 'getDraftLockStatus',
                line: 1160
            },
            validations: ["result"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_DRAFT_LOCK_HISTORY: {
            name: 'Get Draft Lock History',
            order: 18,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getDraftLockHistory()',
            source: {
                file: 'ProceduresService.js',
                function: 'getDraftLockHistory',
                line: 1239
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_DOCUMENT_TREE: {
            name: 'Get Document Tree',
            order: 19,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getDocumentTree()',
            source: {
                file: 'ProceduresService.js',
                function: 'getDocumentTree',
                line: 1275
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_AVAILABLE_PARENTS: {
            name: 'Get Available Parents',
            order: 20,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getAvailableParents()',
            source: {
                file: 'ProceduresService.js',
                function: 'getAvailableParents',
                line: 1300
            },
            validations: ["documentType === 'politica'"],
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_CHILDREN: {
            name: 'Get Children',
            order: 21,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getChildren()',
            source: {
                file: 'ProceduresService.js',
                function: 'getChildren',
                line: 1346
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_ANCESTORS: {
            name: 'Get Ancestors',
            order: 22,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getAncestors()',
            source: {
                file: 'ProceduresService.js',
                function: 'getAncestors',
                line: 1371
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        GET_HIERARCHY_VIEW: {
            name: 'Get Hierarchy View',
            order: 23,
            category: 'lookup',
            description: 'Auto-detectado desde ProceduresService.getHierarchyView()',
            source: {
                file: 'ProceduresService.js',
                function: 'getHierarchyView',
                line: 1459
            },
            transitions_to: [],
            isAutoGenerated: true,
        },

        PROCEDURE_COMPLETED: {
            name: 'Procedimiento Completado',
            order: 24,
            category: 'success',
            description: 'Estado final',
            transitions_to: [],
            is_final: true,
            is_success: true,
        },

        PROCEDURE_CANCELLED: {
            name: 'Procedimiento Cancelado',
            order: 25,
            category: 'rejection',
            description: 'Estado final',
            transitions_to: [],
            is_final: true,
            is_rejection: true,
        },

    };

    /**
     * WORKFLOW METADATA
     */
    static WORKFLOW_METADATA = {
        name: 'Procedures Workflow',
        module: 'procedures',
        version: '2.0.20260128-auto',
        isAutoGenerated: true,
        generatedAt: '2026-01-28T03:59:02.068Z',
        sourceFiles: ["ProceduresService.js"],
        entry_point: 'PROCEDURE_INITIATED',
        final_states: {
            success: ["PROCEDURE_COMPLETED"],
            rejection: ["PROCEDURE_CANCELLED"]
        },
        stats: {"total":25,"core":3,"existing":0,"autoGenerated":20,"outcomes":2}
    };

    /**
     * Obtener stages en orden
     */
    static getStagesInOrder() {
        return Object.entries(this.STAGES)
            .map(([key, stage]) => ({ key, ...stage }))
            .sort((a, b) => (a.order || 999) - (b.order || 999));
    }

    /**
     * Obtener stages finales
     */
    static getFinalStages() {
        return Object.entries(this.STAGES)
            .filter(([_, stage]) => stage.is_final)
            .map(([key, stage]) => ({ key, ...stage }));
    }

    /**
     * Validar transición
     */
    static isValidTransition(fromStage, toStage) {
        const from = this.STAGES[fromStage];
        if (!from || !from.transitions_to) return false;
        return from.transitions_to.includes(toStage);
    }

    /**
     * Obtener siguiente stage sugerido
     */
    static getNextSuggestedStage(currentStage) {
        const current = this.STAGES[currentStage];
        if (!current || !current.transitions_to || current.transitions_to.length === 0) return null;
        return current.transitions_to[0];
    }

    /**
     * Obtener tutorial steps para este workflow
     */
    static getTutorialSteps() {
        return this.getStagesInOrder()
            .filter(s => !s.is_final)
            .map((stage, index) => ({
                step: index + 1,
                stageId: stage.key,
                title: stage.name,
                description: stage.description || '',
                category: stage.category,
                validations: stage.validations || [],
                nextStages: stage.transitions_to || []
            }));
    }
}

module.exports = ProceduresWorkflowGenerated;
